

<!DOCTYPE html>
<html class="no-js sub-menu">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <link href="/images/favicon.png" rel="icon" size="32x32">
    <!-- web fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes"><!-- ios -->
    <meta name="mobile-web-app-capable" content="yes"><!-- android -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <title>A New Attack Surface on MS Exchange Part 1 - ProxyLogon! | DEVCORE</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/modernizr-custom.js"></script>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/site.js"></script>
    <meta name="description" property="og:description" content="ProxyLogon! The most severe and impactful vulnerability in the Exchange Server history ever." />
    <meta name="keywords" content="CVE-2021-26855, CVE-2021-27065" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="A New Attack Surface on MS Exchange Part 1 - ProxyLogon! | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://devco.re/assets/img/blog/20210806/1/cover.png" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="A New Attack Surface on MS Exchange Part 1 - ProxyLogon! | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="ProxyLogon! The most severe and impactful vulnerability in the Exchange Server history ever.">
    <meta name="twitter:creator" content="d3vc0r3">
    <meta name="twitter:image:src" content="https://devco.re/assets/img/blog/20210806/1/cover.png">
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />
    <meta property="fb:admins" content="120968921404653" />

    <link rel="canonical" href="https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="https://devco.re/rss">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GHXJ9PS005"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GHXJ9PS005');
    </script>
    <link rel="stylesheet" href="/fonts/inter.css" />
    <link rel="stylesheet" href="/css/highlighter.css" />
    <!-- <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script> -->
</head>
<body class="en">
    <!-- 導覽列 start -->
    <header class="header">
<div class="container">
    <!-- logo start -->
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
    </div>
    <!-- logo end -->
    <!-- 主選單 start -->
    <nav class="nav">
        <ul class="menu">
            <li class="dropdown">
                <div class="menuLable">
                    <span>Services<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/services/red-team/">
                            <div class="item">

                                <h2>
                                    <i class="icon menu service-red-team"></i>
                                    Red Team Assessment
                                </h2>
                                <p class="two-line">
                                    Simulation of real-world attacks to identify vulnerabilities and achieve objectives without disrupting business operations.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/penetration-test/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-penetration-test"></i>
                                    Penetration Testing
                                </h2>
                                <p class="two-line">
                                    Infiltration of designated enterprise systems to uncover potential vulnerabilities and assess the risks or damages.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-consulting/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-consulting"></i>
                                    Security Consulting
                                </h2>
                                <p class="two-line">
                                    Consultation of resource distribution and long-term defensive strategies from the attacker’s perspective.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-training/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-training"></i>
                                    Security Training
                                </h2>
                                <p class="two-line">
                                    Instruction on defending and preventing incidents with the hacker mindset, also the response procedures and analysis of attacks when incidents happen.
                                </p>
                            </div>
                        </a>

                    </div>
                </div>
            </li>

            <li class="dropdown">
                <div class="menuLable">
                    <span>Research<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/research/overview/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu search-circle"></i>
                                    Overview
                                </h2>
                                <p class="two-line">
                                    Research of updated cybersecurity techniques and trends, assess the security of products, and evolve the red team with broad experience.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/awards/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu badge-check"></i>
                                    Competitions and Awards
                                </h2>
                                <p class="two-line">
                                    Awards from international cybersecurity competitions.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/bug-bounty/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu puzzle"></i>
                                    Enterprise Vulnerability Reports
                                </h2>
                                <p class="two-line">
                                    Research of the risk of enterprise systems, identification of potential weaknesses, and report to vendors.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/talks/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu globe"></i>
                                    International Conferences
                                </h2>
                                <p class="two-line">
                                    Sharing vulnerability research and security knowledge at international cybersecurity conferences.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/cve/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu view-list"></i>
                                    CVE List
                                </h2>
                                <p class="two-line">
                                    Discovery of critical vulnerabilities in leading international products and services.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>


            </li>

            <li class="dropdown">
                <div class="menuLable" href="#">
                    <span>Company<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/company/about/">
                        <div class="item">
                            <h2>
                                <i class="icon menu company"></i>
                                Company Overview
                            </h2>
                            <p>
                                Founded by a world-class white hat hacker team, providing cybersecurity services including Red Team Assessment,  Penetration Testing, Security Consulting, and Security Training.
                            </p>
                        </div>
                        </a>
                        <a href="/en/company/our-team/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu team"></i>
                                    Team Members
                                </h2>
                                <p class="two-line">
                                    Composed of cybersecurity experts with the hacker mindset, exploring innovative exploitation techniques with high morality and extreme caution.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/history/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu milestone"></i>
                                    Achievements
                                </h2>
                                <p class="two-line">
                                    DEVCORE has been invited to leading cybersecurity conferences, has uncovered hundreds of critical product vulnerabilities, and helped enterprises improve their defensive capabilities.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/csr/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu heart"></i>
                                    Corporate Social Responsibility
                                </h2>
                                <p class="two-line">
                                    We provide diverse internship channels and programs to nurture the next generation and promote cybersecurity awareness.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/jobs/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu briefcase"></i>
                                    Job Opportunities
                                </h2>
                                <p class="two-line">
                                    Join us to secure the world and improve the cybersecurity industry together.
                                </p>
                            </div>
                        </a>
                        <a href="https://conf.devco.re/" target="_blank">
                            <div class="item">
                                <h2>
                                    <i class="icon menu conference"></i>
                                    DEVCORE CONFERENCE <i class="icon open-in-new"></i>
                                </h2>
                                <p class="two-line">
                                    DEVCORE’s annual technical conference focused on offensive security research, red team insights, and novel attack vectors from real-world operations.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li class="dropdown">
                <div class="menuLable">
                    <span>News<i class="icon arrow_down"></i></span>
                    <div class="menuItem">
                        <a href="/en/blog/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu newspaper"></i>
                                    BLOG
                                </h2>
                                <p>
                                    Latest news
                                </p>
                            </div>
                        </a>
                        <a href="/en/media-kit/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu download"></i>
                                    Media Resources
                                </h2>
                                <p>
                                    Media Kit, Logo and Usage Guideline
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li>
                <a class="menuLable" href="/en/search/">Search</a>
            </li>
            <li>
                <a class="menuLable" href="/en/contact/">Contact</a>
            </li>
        </ul>
    </nav>
    <!-- 主選單 end -->
</div>


<!-- 手機板選單  start-->
<nav class="nav-m" id="menu-m">
    <ul class="menu">
        <li>
            <div class="menuLable">
                <span>Services</span>
                <div class="menuItem">
                    <a href="/en/services/red-team/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-red-team"></i>
                                Red Team Assessment
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/penetration-test/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-penetration-test"></i>
                                Penetration Testing
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-consulting/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-consulting"></i>
                                Security Consulting
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-training/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-training"></i>
                                Security Training
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>Research</span>
                <div class="menuItem">
                    <a href="/en/research/overview/" class="fullwidth">
                        <div class="item">
                            <h2>Overview</h2>
                        </div>
                    </a>
                    <a href="/en/research/awards/">
                        <div class="item">
                            <h2>Competitions and Awards</h2>
                        </div>
                    </a>
                    <a href="/en/research/bug-bounty/">
                        <div class="item">
                            <h2>Enterprise Vulnerability Reports</h2>
                        </div>
                    </a>
                    <a href="/en/research/talks/">
                        <div class="item">
                            <h2>International Conferences</h2>
                        </div>
                    </a>
                    <a href="/en/research/cve/">
                        <div class="item">
                            <h2>CVE List</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>

        <li>
            <div class="menuLable">
                <span>Company</span>
                <div class="menuItem">
                    <a href="/en/company/about/" class="fullwidth">
                        <div class="item">
                            <h2>Company Overview</h2>
                        </div>
                    </a>
                    <a href="/en/company/our-team/">
                        <div class="item">
                            <h2>Team Members</h2>
                        </div>
                    </a>
                    <a href="/en/company/history/">
                        <div class="item">
                            <h2>Achievements</h2>
                        </div>
                    </a>
                    <a href="/en/company/csr/">
                        <div class="item">
                            <h2>Corporate Social Responsibility</h2>
                        </div>
                    </a>
                    <a href="/en/company/jobs/">
                        <div class="item">
                            <h2>Job Opportunities</h2>
                        </div>
                    </a>
                    <a href="https://conf.devco.re/" target="_blank">
                        <div class="item">
                            <h2>DEVCORE CONFERENCE</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>News</span>
                <div class="menuItem">
                    <a href="/en/blog/">
                        <div class="item">
                            <h2>BLOG</h2>
                        </div>
                    </a>
                    <a href="/en/media-kit/">
                        <div class="item">
                            <h2>Media Resources</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <div class="menuItem">
                    <a href="/en/search/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon search"></i>
                                Search
                            </h2>
                        </div>
                    </a>
                    <a href="/en/contact/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon chat-alt"></i>
                                Contact
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span><i class="icon translate"></i>Language</span>
                <div class="menuItem">
                    <a href="/">
                    <div class="item">
                        <h2>中文</h2>
                    </div>
                    </a>
                    <a href="/en">
                        <div class="item">
                            <h2>English</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
    </ul>
</nav>
<!-- 手機板選單  end-->
    </header>
    <!-- 導覽列 end -->

    <!-- tab 選單 start -->
    <div class="sub-nav">
        <div class="container">
            <h1>BLOG</h1>
            <ul class="tab">
                <li>
                    <a href="/en/blog/">All Articles</a>
                </li>
                <li>
                    <a href="/en/blog/category/Tech%20Editorials/">Tech Editorials</a>
                </li>
                <li>
                    <a href="/en/media-kit/">Media Resources</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- tab 選單 end -->
    
    <div class="main">
        <!-- 文章外層layer -->
        <section class="narrow">
            <!-- 文章 start -->
            <article class="article_body">
                <div class="content">
                    <a class="category" href="/en/blog/category/Tech Editorials">Tech Editorials</a>
                    <span class="tag">

                      <a href="/en/blog/tag/Advisory/">#Advisory</a> <a href="/en/blog/tag/CVE/">#CVE</a> <a href="/en/blog/tag/RCE/">#RCE</a> <a href="/en/blog/tag/Exchange/">#Exchange</a> <a href="/en/blog/tag/SSRF/">#SSRF</a> <a href="/en/blog/tag/Pwn2Own/">#Pwn2Own</a> 
                    </span>
                    <h1>
                        A New Attack Surface on MS Exchange Part 1 - ProxyLogon!
                    </h1>
                    
                    
                    <div class="author_detail">
                        <span class="avatar">
                            <a href="/en/blog/author/orange">
                                <div class="circle">
                                    <i class="user" style="background-image: url('/assets/img/avatar/orig/orange.png');" ></i>
                                </div>
                            </a>
                        </span>
                        <span class="author"><a href="/en/blog/author/orange">Orange Tsai</a></span>
                        <span class="date">2021-08-06</span>
                    </div>
                    
                    
                    <div class="article_img">
                        <img src="https://devco.re/assets/img/blog/20210806/1/cover.png"/>
                    </div>
                    

                    <hr>

                    <!-- 文章內容 -->
                    <div class="article_content">
<style type="text/css">
    table {
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: 0.6em;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
    .center-image {
        margin: 0 auto;
        display: block;
    }
</style>

<p>The series of A New Attack Surface on MS Exchange:</p>
<ul>
  <li><a href="/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/">A New Attack Surface on MS Exchange Part 1 - ProxyLogon!</a></li>
  <li><a href="/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle/">A New Attack Surface on MS Exchange Part 2 - ProxyOracle!</a></li>
  <li><a href="/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell/">A New Attack Surface on MS Exchange Part 3 - ProxyShell!</a></li>
  <li><a href="/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay/">A New Attack Surface on MS Exchange Part 4 - ProxyRelay!</a></li>
</ul>

<p>Microsoft Exchange, as one of the most common email solutions in the world, has become part of the daily operation and security connection for governments and enterprises. This January, we reported a series of vulnerabilities of Exchange Server to Microsoft and named it as <a href="https://proxylogon.com/">ProxyLogon</a>. ProxyLogon might be the most severe and impactful vulnerability in the Exchange history ever. If you were paying attention to the industry news, you must have heard it.</p>

<p>While looking into ProxyLogon from the architectural level, we found it is not just a vulnerability, but an attack surface that is totally new and no one has ever mentioned before. This attack surface could lead the hackers or security researchers to more vulnerabilities. Therefore, we decided to focus on this attack surface and eventually found at least 8 vulnerabilities. These vulnerabilities cover from server side, client side, and even crypto bugs. We chained these vulnerabilities into 3 attacks:</p>

<ol>
  <li>ProxyLogon: The most well-known and impactful Exchange exploit chain</li>
  <li>ProxyOracle: The attack which could recover any password in plaintext format of Exchange users</li>
  <li>ProxyShell: The exploit chain we demonstrated at <a href="https://twitter.com/thezdi/status/1379467992862449664">Pwn2Own 2021</a> to take over Exchange and earn $200,000 bounty</li>
</ol>

<p>I would like to highlight that all vulnerabilities we unveiled here are logic bugs, which means they could be reproduced and exploited more easily than any memory corruption bugs. We have presented our research at <a href="https://www.blackhat.com/us-21/briefings/schedule/index.html#proxylogon-is-just-the-tip-of-the-iceberg-a-new-attack-surface-on-microsoft-exchange-server-23442">Black Hat USA</a> and <a href="https://www.defcon.org/html/defcon-29/dc-29-speakers.html">DEFCON</a>, and won the Best Server-Side bug of <a href="https://pwnies.com/winners/">Pwnie Awards 2021</a>. You can check our presentation materials here:</p>

<ul>
  <li>ProxyLogon is Just the Tip of the Iceberg: A New Attack Surface on Microsoft Exchange Server! <a href="https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-ProxyLogon-Is-Just-The-Tip-Of-The-Iceberg-A-New-Attack-Surface-On-Microsoft-Exchange-Server.pdf">[Slides]</a> <a href="https://www.youtube.com/watch?v=5mqid-7zp8k">[Video]</a></li>
</ul>

<p>By understanding the basics of this new attack surface, you won’t be surprised why we can pop out 0days easily!</p>

<h1 id="intro">Intro</h1>

<p>I would like to state that all the vulnerabilities mentioned have been reported via the responsible vulnerability disclosure process and patched by Microsoft. You could find more detail of the CVEs and the report timeline from the following table.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Report Time</th>
      <th style="text-align: center">Name</th>
      <th style="text-align: center">CVE</th>
      <th style="text-align: center">Patch Time</th>
      <th style="text-align: center">CAS<sup>[1]</sup></th>
      <th style="text-align: center">Reported By</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Jan 05, 2021</td>
      <td style="text-align: center">ProxyLogon</td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855">CVE-2021-26855</a></td>
      <td style="text-align: center">Mar 02, 2021</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: center">Orange Tsai, Volexity and MSTIC</td>
    </tr>
    <tr>
      <td style="text-align: center">Jan 05, 2021</td>
      <td style="text-align: center">ProxyLogon</td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065">CVE-2021-27065</a></td>
      <td style="text-align: center">Mar 02, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Orange Tsai, Volexity and MSTIC</td>
    </tr>
    <tr>
      <td style="text-align: center">Jan 17, 2021</td>
      <td style="text-align: center">ProxyOracle</td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31196">CVE-2021-31196</a></td>
      <td style="text-align: center">Jul 13, 2021</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: center">Orange Tsai</td>
    </tr>
    <tr>
      <td style="text-align: center">Jan 17, 2021</td>
      <td style="text-align: center">ProxyOracle</td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195">CVE-2021-31195</a></td>
      <td style="text-align: center">May 11, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Orange Tsai</td>
    </tr>
    <tr>
      <td style="text-align: center">Apr 02, 2021</td>
      <td style="text-align: center">ProxyShell<sup>[2]</sup></td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473">CVE-2021-34473</a></td>
      <td style="text-align: center">Apr 13, 2021</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: center">Orange Tsai working with ZDI</td>
    </tr>
    <tr>
      <td style="text-align: center">Apr 02, 2021</td>
      <td style="text-align: center">ProxyShell<sup>[2]</sup></td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34523">CVE-2021-34523</a></td>
      <td style="text-align: center">Apr 13, 2021</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: center">Orange Tsai working with ZDI</td>
    </tr>
    <tr>
      <td style="text-align: center">Apr 02, 2021</td>
      <td style="text-align: center">ProxyShell<sup>[2]</sup></td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31207">CVE-2021-31207</a></td>
      <td style="text-align: center">May 11, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Orange Tsai working with ZDI</td>
    </tr>
    <tr>
      <td style="text-align: center">Jun 02, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Yes</td>
      <td style="text-align: center">Orange Tsai</td>
    </tr>
    <tr>
      <td style="text-align: center">Jun 02, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center"><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-33768">CVE-2021-33768</a></td>
      <td style="text-align: center">Jul 13, 2021</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">Orange Tsai and Dlive</td>
    </tr>
  </tbody>
</table>

<div style="font-size:0.6em; line-height: 1.6;">
<br /><em>[1] Bugs relate to this new attack surface direclty</em><br />
<em>[2] Pwn2Own 2021 bugs</em>
</div>

<p>Why did Exchange Server become a hot topic? From my point of view, the whole ProxyLogon attack surface is actually located at an early stage of Exchange request processing. For instance, if the entrance of Exchange is 0, and 100 is the core business logic, ProxyLogon is somewhere around 10. Again, since the vulnerability is located at the beginning place, I believe anyone who has reviewed the security of Exchange carefully would spot the attack surface. This was also <a href="https://twitter.com/orange_8361/status/1346401788811825153">why I tweeted my worry</a> about bug collision after reporting to Microsoft. The vulnerability was so impactful, yet it’s a simple one and located at such an early stage.</p>

<p>You all know what happened next, Volexity found that an APT group was leveraging the same SSRF (<a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855">CVE-2021-26855</a>) to access users’ emails in early January 2021 and reported to Microsoft. Microsoft also released the urgent patches in March. From the <a href="https://youtu.be/rB255D-wnw0?t=999">public information</a> released afterwards, we found that even though they used the same SSRF, the APT group was exploiting it in a very different way from us. We completed the ProxyLogon attack chain through <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065">CVE-2021-27065</a>, while the APT group used EWS and two unknown vulnerabilities in their attack. This has convinced us that there is a bug collision on the SSRF vulnerability.</p>

<p><img src="/assets/img/blog/20210806/1/1.png" alt="" />
<em><small>Image from <a href="https://www.microsoft.com/security/blog/2021/03/25/analyzing-attacks-taking-advantage-of-the-exchange-server-vulnerabilities/">Microsoft Blog</a></small></em></p>

<p>Regarding the ProxyLogon PoC we reported to MSRC appeared in the wild in late February, we were as curious as everyone after eliminating the possibility of leakage from our side through a thorough investigation. With a clearer timeline appearing and more discussion occurring, it seems like this is <a href="https://msrc-blog.microsoft.com/2012/03/16/proof-of-concept-code-available-for-ms12-020/">not the first time that something like this happened to Microsoft</a>. Maybe you would be interested in learning some <a href="https://www.wsj.com/articles/microsoft-probing-whether-leak-played-role-in-suspected-chinese-hack-11615575793">interesting stories from here</a>.</p>

<h1 id="why-targeting-on-exchange-server">Why targeting on Exchange Server?</h1>

<p>Mail server is a highly valuable asset that holds the most confidential secrets and corporate data. In other words, controlling a mail server means controlling the lifeline of a company. As the most common-use email solution, Exchange Server has been the top target for hackers for a long time. Based on our research, there are more than four hundred thousands Exchange Servers exposed on the Internet. Each server represents a company, and you can imagine how horrible it is while a severe vulnerability appeared in Exchange Server.</p>

<p>Normally, I will review the existing papers and bugs before starting a research. Among the whole Exchange history, is there any interesting case? Of course. Although most vulnerabilities are based on known attack vectors, such as the deserialization or bad input validation, there are still several bugs that are worth mentioning.</p>

<h3 id="the-most-special">The most special</h3>
<p>The most special one is the <a href="https://msrc-blog.microsoft.com/2017/07/20/englishmansdentist-exploit-analysis/">arsenal</a> from <a href="https://en.wikipedia.org/wiki/Equation_Group">Equation Group</a> in 2017. It’s the only practical and public pre-auth RCE in the Exchange history. Unfortunately, the arsenal only works on an ancient Exchange Server 2003. If the arsenal leak happened earlier, it could end up with another nuclear-level crisis.</p>

<h3 id="the-most-interesting">The most interesting</h3>
<p>The most interesting one is <a href="https://www.zerodayinitiative.com/blog/2018/12/19/an-insincere-form-of-flattery-impersonating-users-on-microsoft-exchange">CVE-2018-8581</a> disclosed by someone who cooperated with ZDI. Though it was simply an SSRF, with the feature, it could be combined with NTLM Relay, the attacker could turn a boring SSRF into <a href="https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/">something really fancy</a>. For instance, it could directly control the whole Domain Controller through a low privilege account.</p>

<h3 id="the-most-surprising">The most surprising</h3>
<p>The most surprising one is <a href="https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys">CVE-2020-0688</a>, which was also disclosed by someone working with ZDI. The root cause of this bug is due to a hard-coded cryptographic key in Microsoft Exchange. With this hard-coded key, an attacker with low privilege can take over the whole Exchange Server. And as you can see, even in 2020, a silly, hard-coded cryptographic key could still be found in an essential software like Exchange. This indicated that Exchange is lacking security reviews, which also inspired me to dig more into the Exchange security.</p>

<p><img src="/assets/img/blog/20210806/1/2.gif" alt="" class="center-image" /></p>

<h1 id="where-is-the-new-attack-surface">Where is the new attack surface</h1>

<p>Exchange is a very sophisticated application. Since 2000, Exchange has released a new version every 3 years. Whenever Exchange releases a new version, the architecture changes a lot and becomes different. The changes of architecture and iterations make it difficult to upgrade an Exchange Server. In order to ensure the compatibility between the new architecture and old ones, several design debts were incurred to Exchange Server and led to the new attack surface we found.</p>

<p><img src="/assets/img/blog/20210806/1/3.png" alt="" /></p>

<p>Where did we focus at Microsoft Exchange? We focused on the Client Access Service, CAS. CAS is a fundamental component of Exchange. Back to the version 2000/2003, CAS was an independent Frontend Server in charge of all the Frontend web rendering logics. After several renaming, integrating, and version differences, CAS has been downgraded to a service under the Mailbox Role. The <a href="https://docs.microsoft.com/en-us/exchange/architecture/architecture?view=exchserver-2019">official documentation from Microsoft</a> indicates that:</p>

<blockquote>
  <p>Mailbox servers contain the Client Access services that <strong>accept client connections for all protocols</strong>. These frontend services are <strong>responsible for routing or proxying connections</strong> to the corresponding backend services on a Mailbox server</p>
</blockquote>

<p>From the narrative you could realize the importance of CAS, and you could imagine how critical it is when bugs are found in such infrastructure. CAS was where we focused on, and where the attack surface appeared.</p>

<h1 id="the-cas-architecture">The CAS architecture</h1>

<p>CAS is the fundamental component in charge of accepting all the connections from the client side, no matter if it’s HTTP, POP3, IMAP or SMTP, and proxies the connections to the corresponding Backend Service. As a Web Security researcher, I focused on the Web implementation of CAS.</p>

<p><img src="/assets/img/blog/20210806/1/4.png" alt="" /></p>

<p>The CAS web is built on Microsoft IIS. As you can see, there are two websites inside the IIS. The “Default Website” is the Frontend we mentioned before, and the “Exchange Backend” is where the business logic is. After looking into the configuration carefully, we notice that the Frontend is binding with ports 80 and 443, and the Backend is listening on ports 81 and 444. All the ports are binding with <code class="language-plaintext highlighter-rouge">0.0.0.0</code>, which means anyone could access the Frontend and Backend of Exchange directly. Wouldn’t it be dangerous? Please keep this question in mind and we will answer that later.</p>

<p><img src="/assets/img/blog/20210806/1/5.png" alt="" /></p>

<p>Exchange implements the logic of Frontend and Backend via IIS module. There are several modules in Frontend and Backend to complete different tasks, such as the filter, validation, and logging. The Frontend must contain a Proxy Module. The Proxy Module picks up the HTTP request from the client side and adds some internal settings, then forwards the request to the Backend. As for the Backend, all the applications include the Rehydration Module, which is in charge of parsing Frontend requests, populating the client information back, and continuing to process the business logic. Later we will be elaborating how Proxy Module and Rehydration Module work.</p>

<p><img src="/assets/img/blog/20210806/1/6.png" alt="" /></p>

<h2 id="frontend-proxy-module">Frontend Proxy Module</h2>

<p>Proxy Module chooses a handler based on the current <code class="language-plaintext highlighter-rouge">ApplicationPath</code> to process the HTTP request from the client side. For instance, visiting <code class="language-plaintext highlighter-rouge">/EWS</code> will use <code class="language-plaintext highlighter-rouge">EwsProxyRequestHandler</code>, as for <code class="language-plaintext highlighter-rouge">/OWA</code> will trigger <code class="language-plaintext highlighter-rouge">OwaProxyRequestHandler</code>. All the handlers in Exchange inherit the class from <code class="language-plaintext highlighter-rouge">ProxyRequestHandler</code> and implement its core logic, such as how to deal with the HTTP request from the user, which URL from Backend to proxy to, and how to synchronize the information with the Backend. The class is also the most centric part of the whole Proxy Module, we will separate <code class="language-plaintext highlighter-rouge">ProxyRequestHandler</code> into 3 sections:</p>

<p><img src="/assets/img/blog/20210806/1/7.png" alt="" /></p>

<h3 id="frontend-reqeust-section">Frontend Reqeust Section</h3>

<p>The Request section will parse the HTTP request from the client and determine which cookie and header could be proxied to the Backend. Frontend and Backend relied on HTTP Headers to synchronize information and proxy internal status. Therefore, Exchange has defined a blacklist to avoid some internal Headers being misused.</p>

<p><strong>HttpProxy\ProxyRequestHandler.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">ShouldCopyHeaderToServerRequest</span><span class="p">(</span><span class="kt">string</span> <span class="n">headerName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"X-CommonAccessToken"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"X-IsFromCafe"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"X-SourceCafeServer"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"msExchProxyUri"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"X-MSExchangeActivityCtx"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"return-client-request-id"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">headerName</span><span class="p">,</span> <span class="s">"X-Forwarded-For"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">&amp;&amp;</span> <span class="p">(!</span><span class="n">headerName</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"X-Backend-Diag-"</span><span class="p">,</span> <span class="n">OrdinalIgnoreCase</span><span class="p">)</span> 
      <span class="p">||</span> <span class="k">this</span><span class="p">.</span><span class="n">ClientRequest</span><span class="p">.</span><span class="nf">GetHttpRequestBase</span><span class="p">().</span><span class="nf">IsProbeRequest</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the last stage of Request, Proxy Module will call the method <code class="language-plaintext highlighter-rouge">AddProtocolSpecificHeadersToServerRequest</code> implemented by the handler to add the information to be communicated with the Backend in the HTTP header. This section will also serialize the information from the current login user and put it in a new HTTP header <code class="language-plaintext highlighter-rouge">X-CommonAccessToken</code>, which will be forwarded to the Backend later.</p>

<p>For instance, If I log into Outlook Web Access (OWA) with the name Orange, the <code class="language-plaintext highlighter-rouge">X-CommonAccessToken</code> that Frontend proxy to Backend will be:</p>

<p><img src="/assets/img/blog/20210806/1/8.png" alt="" /></p>

<h3 id="frontend-proxy-section">Frontend Proxy Section</h3>

<p>The Proxy Section first uses the <code class="language-plaintext highlighter-rouge">GetTargetBackendServerURL</code> method to calculate which Backend URL should the HTTP request be forwarded to. Then initialize a new HTTP Client request with the method <code class="language-plaintext highlighter-rouge">CreateServerRequest</code>.</p>

<p><strong>HttpProxy\ProxyRequestHandler.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="n">HttpWebRequest</span> <span class="nf">CreateServerRequest</span><span class="p">(</span><span class="n">Uri</span> <span class="n">targetUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">HttpWebRequest</span> <span class="n">httpWebRequest</span> <span class="p">=</span> <span class="p">(</span><span class="n">HttpWebRequest</span><span class="p">)</span><span class="n">WebRequest</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">targetUrl</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">HttpProxySettings</span><span class="p">.</span><span class="n">UseDefaultWebProxy</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Proxy</span> <span class="p">=</span> <span class="n">NullWebProxy</span><span class="p">.</span><span class="n">Instance</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">ServicePoint</span><span class="p">.</span><span class="n">ConnectionLimit</span> <span class="p">=</span> <span class="n">HttpProxySettings</span><span class="p">.</span><span class="n">ServicePointConnectionLimit</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Method</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ClientRequest</span><span class="p">.</span><span class="n">HttpMethod</span><span class="p">;</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-FE-ClientIP"</span><span class="p">]</span> <span class="p">=</span> <span class="n">ClientEndpointResolver</span><span class="p">.</span><span class="nf">GetClientIP</span><span class="p">(</span><span class="n">SharedHttpContextWrapper</span><span class="p">.</span><span class="nf">GetWrapper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">));</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-Forwarded-For"</span><span class="p">]</span> <span class="p">=</span> <span class="n">ClientEndpointResolver</span><span class="p">.</span><span class="nf">GetClientProxyChainIPs</span><span class="p">(</span><span class="n">SharedHttpContextWrapper</span><span class="p">.</span><span class="nf">GetWrapper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">));</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-Forwarded-Port"</span><span class="p">]</span> <span class="p">=</span> <span class="n">ClientEndpointResolver</span><span class="p">.</span><span class="nf">GetClientPort</span><span class="p">(</span><span class="n">SharedHttpContextWrapper</span><span class="p">.</span><span class="nf">GetWrapper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">));</span>
    <span class="n">httpWebRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-MS-EdgeIP"</span><span class="p">]</span> <span class="p">=</span> <span class="n">Utilities</span><span class="p">.</span><span class="nf">GetEdgeServerIpAsProxyHeader</span><span class="p">(</span><span class="n">SharedHttpContextWrapper</span><span class="p">.</span><span class="nf">GetWrapper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">).</span><span class="n">Request</span><span class="p">);</span>
    
    <span class="c1">// ...</span>
    
    <span class="k">return</span> <span class="n">httpWebRequest</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Exchange will also generate a Kerberos ticket via the HTTP Service-Class of the Backend and put it in the <code class="language-plaintext highlighter-rouge">Authorization</code> header. This header is designed to prevent anonymous users from accessing the Backend directly. With the Kerberos Ticket, the Backend could validate the access from the Frontend.</p>

<p><strong>HttpProxy\ProxyRequestHandler.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">ProxyKerberosAuthentication</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">serverRequest</span><span class="p">.</span><span class="n">ConnectionGroupName</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">ClientRequest</span><span class="p">.</span><span class="n">UserHostAddress</span> <span class="p">+</span> <span class="s">":"</span> <span class="p">+</span> <span class="n">GccUtils</span><span class="p">.</span><span class="nf">GetClientPort</span><span class="p">(</span><span class="n">SharedHttpContextWrapper</span><span class="p">.</span><span class="nf">GetWrapper</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">AuthBehavior</span><span class="p">.</span><span class="n">AuthState</span> <span class="p">==</span> <span class="n">AuthState</span><span class="p">.</span><span class="n">BackEndFullAuth</span> <span class="p">||</span> <span class="k">this</span><span class="p">.</span>
    <span class="nf">ShouldBackendRequestBeAnonymous</span><span class="p">()</span> <span class="p">||</span> <span class="p">(</span><span class="n">HttpProxySettings</span><span class="p">.</span><span class="n">TestBackEndSupportEnabled</span><span class="p">.</span><span class="n">Value</span>  
    <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">ClientRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"TestBackEndUrl"</span><span class="p">])))</span> <span class="p">{</span>
    <span class="n">serverRequest</span><span class="p">.</span><span class="n">ConnectionGroupName</span> <span class="p">=</span> <span class="s">"Unauthenticated"</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">serverRequest</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"Authorization"</span><span class="p">]</span> <span class="p">=</span> <span class="n">KerberosUtilities</span><span class="p">.</span><span class="nf">GenerateKerberosAuthHeader</span><span class="p">(</span>
        <span class="n">serverRequest</span><span class="p">.</span><span class="n">Address</span><span class="p">.</span><span class="n">Host</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">TraceContext</span><span class="p">,</span> 
        <span class="k">ref</span> <span class="k">this</span><span class="p">.</span><span class="n">authenticationContext</span><span class="p">,</span> <span class="k">ref</span> <span class="k">this</span><span class="p">.</span><span class="n">kerberosChallenge</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>HttpProxy\KerberosUtilities.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">internal</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GenerateKerberosAuthHeader</span><span class="p">(</span><span class="kt">string</span> <span class="n">host</span><span class="p">,</span> <span class="kt">int</span> <span class="n">traceContext</span><span class="p">,</span> <span class="k">ref</span> <span class="n">AuthenticationContext</span> <span class="n">authenticationContext</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">string</span> <span class="n">kerberosChallenge</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="kt">byte</span><span class="p">[]</span> <span class="n">bytes</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="c1">// ...</span>
    <span class="n">authenticationContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthenticationContext</span><span class="p">();</span>
    <span class="kt">string</span> <span class="n">text</span> <span class="p">=</span> <span class="s">"HTTP/"</span> <span class="p">+</span> <span class="n">host</span><span class="p">;</span>
    <span class="n">authenticationContext</span><span class="p">.</span><span class="nf">InitializeForOutboundNegotiate</span><span class="p">(</span><span class="n">AuthenticationMechanism</span><span class="p">.</span><span class="n">Kerberos</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">SecurityStatus</span> <span class="n">securityStatus</span> <span class="p">=</span> <span class="n">authenticationContext</span><span class="p">.</span><span class="nf">NegotiateSecurityContext</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">,</span> <span class="k">out</span> <span class="n">bytes</span><span class="p">);</span>
    <span class="c1">// ...</span>
    <span class="kt">string</span> <span class="n">@string</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">.</span><span class="nf">GetString</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
    <span class="k">return</span> <span class="s">"Negotiate "</span> <span class="p">+</span> <span class="n">@string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Therefore, a Client request proxied to the Backend will be added with several HTTP Headers for internal use. The two most essential Headers are <code class="language-plaintext highlighter-rouge">X-CommonAccessToken</code>, which indicates the mail users’ log in identity, and Kerberos Ticket, which represents legal access from the Frontend.</p>

<p><img src="/assets/img/blog/20210806/1/9.png" alt="" /></p>

<h3 id="frontend-response-section">Frontend Response Section</h3>

<p>The last is the section of Response. It receives the response from the Backend and decides which headers or cookies are allowed to be sent back to the Frontend.</p>

<h2 id="backend-rehydration-module">Backend Rehydration Module</h2>

<p>Now let’s move on and check  how the Backend processes the request from the Frontend. The Backend first uses the method <code class="language-plaintext highlighter-rouge">IsAuthenticated</code> to check whether the incoming request is authenticated. Then the Backend will verify whether the request is equipped with an extended right called <code class="language-plaintext highlighter-rouge">ms-Exch-EPI-Token-Serialization</code>. With the default setting, only Exchange Machine Account would have such authorization. This is also why the Kerberos Ticket generated by the Frontend could pass the checkpoint but you can’t access the Backend directly with a low authorized account.</p>

<p>After passing the check, Exchange will restore the login identity used in the Frontend, through deserializing the header <code class="language-plaintext highlighter-rouge">X-CommonAccessToken</code> back to the original Access Token, and then put it in the <code class="language-plaintext highlighter-rouge">httpContext</code> object to progress to the business logic in the Backend.</p>

<p><strong>Authentication\BackendRehydrationModule.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">OnAuthenticateRequest</span><span class="p">(</span><span class="kt">object</span> <span class="n">source</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">httpContext</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">IsAuthenticated</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">ProcessRequest</span><span class="p">(</span><span class="n">httpContext</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">void</span> <span class="nf">ProcessRequest</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">httpContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CommonAccessToken</span> <span class="n">token</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">TryGetCommonAccessToken</span><span class="p">(</span><span class="n">httpContext</span><span class="p">,</span> <span class="k">out</span> <span class="n">token</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="nf">TryGetCommonAccessToken</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">httpContext</span><span class="p">,</span> <span class="k">out</span> <span class="n">CommonAccessToken</span> <span class="n">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="n">text</span> <span class="p">=</span> <span class="n">httpContext</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">Headers</span><span class="p">[</span><span class="s">"X-CommonAccessToken"</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">text</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
        
    <span class="kt">bool</span> <span class="n">flag</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">flag</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">IsTokenSerializationAllowed</span><span class="p">(</span><span class="n">httpContext</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="n">Identity</span> <span class="k">as</span> <span class="n">WindowsIdentity</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="n">httpContext</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="s">"BEValidateCATRightsLatency"</span><span class="p">]</span> <span class="p">=</span> <span class="n">stopwatch</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span> <span class="p">-</span> <span class="n">elapsedMilliseconds</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">token</span> <span class="p">=</span> <span class="n">CommonAccessToken</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="n">httpContext</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="s">"Item-CommonAccessToken"</span><span class="p">]</span> <span class="p">=</span> <span class="n">token</span><span class="p">;</span>
    
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="k">private</span> <span class="kt">bool</span> <span class="nf">IsTokenSerializationAllowed</span><span class="p">(</span><span class="n">WindowsIdentity</span> <span class="n">windowsIdentity</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">flag2</span> <span class="p">=</span> <span class="n">LocalServer</span><span class="p">.</span><span class="nf">AllowsTokenSerializationBy</span><span class="p">(</span><span class="n">clientSecurityContext</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">flag2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">AllowsTokenSerializationBy</span><span class="p">(</span><span class="n">ClientSecurityContext</span> <span class="n">clientContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">LocalServer</span><span class="p">.</span><span class="nf">HasExtendedRightOnServer</span><span class="p">(</span><span class="n">clientContext</span><span class="p">,</span> 
        <span class="n">WellKnownGuid</span><span class="p">.</span><span class="n">TokenSerializationRightGuid</span><span class="p">);</span>  <span class="c1">// ms-Exch-EPI-Token-Serialization</span>

<span class="p">}</span>
</code></pre></div></div>

<h1 id="the-attack-surface">The attack surface</h1>

<p>After a brief introduction to the architecture of CAS, we now realize that CAS is just a well-written HTTP Proxy (or Client), and we know that implementing Proxy isn’t easy.  So I was wondering:</p>

<blockquote>
  <p>Could I use a single HTTP request to access different contexts in Frontend and Backend respectively to cause some confusion?</p>
</blockquote>

<p>If we could do that, maaaaaybe I could bypass some Frontend restrictions to access arbitrary Backends and abuse some internal API. Or, we can confuse the context to leverage the inconsistency of the definition of dangerous HTTP headers between the Frontend and Backend to do further interesting attacks.</p>

<p>With these thoughts in mind, let’s start hunting!</p>

<h1 id="the-proxylogon">The ProxyLogon</h1>

<p>The first exploit is the ProxyLogon. As introduced before, this may be the most severe vulnerability in the Exchange history ever. ProxyLogon is chained with 2 bugs:</p>

<ul>
  <li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855">CVE-2021-26855</a> - Pre-auth SSRF leads to Authentication Bypass</li>
  <li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065">CVE-2021-27065</a> - Post-auth Arbitrary-File-Write leads to RCE</li>
</ul>

<h2 id="cve-2021-26855---pre-auth-ssrf">CVE-2021-26855 - Pre-auth SSRF</h2>

<p>There are more than 20 handlers corresponding to different application paths in the Frontend. While reviewing the implementations, we found the method <code class="language-plaintext highlighter-rouge">GetTargetBackEndServerUrl</code>, which is responsible for calculating the Backend URL in the static resource handler, assigns the Backend target by cookies directly.</p>

<p>Now you figure out how simple this vulnerability is after learning the architecture!</p>

<p><strong>HttpProxy\ProxyRequestHandler.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">virtual</span> <span class="n">Uri</span> <span class="nf">GetTargetBackEndServerUrl</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">LogElapsedTime</span><span class="p">(</span><span class="s">"E_TargetBEUrl"</span><span class="p">);</span>
    <span class="n">Uri</span> <span class="n">result</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">UrlAnchorMailbox</span> <span class="n">urlAnchorMailbox</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">AnchoredRoutingTarget</span><span class="p">.</span><span class="n">AnchorMailbox</span> <span class="k">as</span> <span class="n">UrlAnchorMailbox</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">urlAnchorMailbox</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">urlAnchorMailbox</span><span class="p">.</span><span class="n">Url</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">UriBuilder</span> <span class="n">clientUrlForProxy</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">GetClientUrlForProxy</span><span class="p">();</span>
            <span class="n">clientUrlForProxy</span><span class="p">.</span><span class="n">Scheme</span> <span class="p">=</span> <span class="n">Uri</span><span class="p">.</span><span class="n">UriSchemeHttps</span><span class="p">;</span>
            <span class="n">clientUrlForProxy</span><span class="p">.</span><span class="n">Host</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">AnchoredRoutingTarget</span><span class="p">.</span><span class="n">BackEndServer</span><span class="p">.</span><span class="n">Fqdn</span><span class="p">;</span>
            <span class="n">clientUrlForProxy</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="m">444</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">AnchoredRoutingTarget</span><span class="p">.</span><span class="n">BackEndServer</span><span class="p">.</span><span class="n">Version</span> <span class="p">&lt;</span> <span class="n">Server</span><span class="p">.</span><span class="n">E15MinVersion</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">ProxyToDownLevel</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="n">RequestDetailsLoggerBase</span><span class="p">&lt;</span><span class="n">RequestDetailsLogger</span><span class="p">&gt;.</span><span class="nf">SafeAppendGenericInfo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Logger</span><span class="p">,</span> <span class="s">"ProxyToDownLevel"</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="n">clientUrlForProxy</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="m">443</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">clientUrlForProxy</span><span class="p">.</span><span class="n">Uri</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">finally</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">LogElapsedTime</span><span class="p">(</span><span class="s">"L_TargetBEUrl"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>From the code snippet, you can see the property <code class="language-plaintext highlighter-rouge">BackEndServer.Fqdn</code> of <code class="language-plaintext highlighter-rouge">AnchoredRoutingTarget</code> is assigned from the cookie directly.</p>

<p><strong>HttpProxy\OwaResourceProxyRequestHandler.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">override</span> <span class="n">AnchorMailbox</span> <span class="nf">ResolveAnchorMailbox</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">HttpCookie</span> <span class="n">httpCookie</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="n">ClientRequest</span><span class="p">.</span><span class="n">Cookies</span><span class="p">[</span><span class="s">"X-AnonResource-Backend"</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">httpCookie</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">savedBackendServer</span> <span class="p">=</span> <span class="n">httpCookie</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">savedBackendServer</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">base</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">"X-AnonResource-Backend-Cookie"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ExTraceGlobals</span><span class="p">.</span><span class="n">VerboseTracer</span><span class="p">.</span><span class="nf">IsTraceEnabled</span><span class="p">(</span><span class="m">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">ExTraceGlobals</span><span class="p">.</span><span class="n">VerboseTracer</span><span class="p">.</span><span class="n">TraceDebug</span><span class="p">&lt;</span><span class="n">HttpCookie</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;((</span><span class="kt">long</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nf">GetHashCode</span><span class="p">(),</span> <span class="s">"[OwaResourceProxyRequestHandler::ResolveAnchorMailbox]: AnonResourceBackend cookie used: {0}; context {1}."</span><span class="p">,</span> <span class="n">httpCookie</span><span class="p">,</span> <span class="k">base</span><span class="p">.</span><span class="n">TraceContext</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ServerInfoAnchorMailbox</span><span class="p">(</span><span class="n">BackEndServer</span><span class="p">.</span><span class="nf">FromString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">savedBackendServer</span><span class="p">),</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">AnonymousAnchorMailbox</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Though we can only control the <code class="language-plaintext highlighter-rouge">Host</code> part of the URL, but hang on, isn’t <a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">manipulating a URL Parser</a> exactly what I am good at? Exchange builds the Backend URL by built-in <code class="language-plaintext highlighter-rouge">UriBuilder</code>. However, since C# didn’t verify the <code class="language-plaintext highlighter-rouge">Host</code>, so we can enclose the whole URL with some special characters to access arbitrary servers and ports.</p>

<blockquote>
  <p>https://[foo]@example.com:443/path#]:444/owa/auth/x.js</p>
</blockquote>

<p><img src="/assets/img/blog/20210806/1/10.png" alt="" /></p>

<p>So far we have a super SSRF that can control almost all the HTTP requests and get all the replies. The most impressive thing is that the Frontend of Exchange will generate a Kerberos Ticket for us, which means even when we are attacking a protected and domain-joined HTTP service, we can still hack with the authentication of Exchange Machine Account.</p>

<p>So, what is the root cause of this arbitrary Backend assignment? As mentioned, the Exchange Server changes its architecture while releasing new versions. It might have different functions in different versions even with the same component under the same name. Microsoft has put great effort into ensuring the architectural capability between new and old versions. This cookie is a quick solution and the design debt of Exchange making the Frontend in the new architecture could identify where the old Backend is.</p>

<h2 id="cve-2021-27065---post-auth-arbitrary-file-write">CVE-2021-27065 - Post-auth Arbitrary-File-Write</h2>

<p>Thanks to the super SSRF allowing us to access the Backend without restriction. The next is to find a RCE bug to chain together. Here we leverage a Backend internal API <code class="language-plaintext highlighter-rouge">/proxyLogon.ecp</code> to become the admin. The API is also the reason why we called it ProxyLogon.</p>

<p>Because we leverage the Frontend handler of static resources to access the ECExchange Control Panel (ECP) Backend, the header <code class="language-plaintext highlighter-rouge">msExchLogonMailbox</code>, which is a special HTTP header in the ECP Backend, will not be blocked by the Frontend. By leveraging this minor inconsistency, we can specify ourselves as the SYSTEM user and generate a valid ECP session with the internal API.</p>

<p><img src="/assets/img/blog/20210806/1/11.png" alt="" /></p>

<p>With the inconsistency between the Frontend and Backend, we can access all the functions on ECP by Header forgery and internal Backend API abuse. Next, we have to find an RCE bug on the ECP interface to chain them together. The ECP wraps the Exchange PowerShell commands as an abstract interface by <code class="language-plaintext highlighter-rouge">/ecp/DDI/DDIService.svc</code>. The <code class="language-plaintext highlighter-rouge">DDIService</code> defines several PowerShell executing pipelines by XAML so that it can be accessed by Web. While verifying the DDI implementation, we found the tag of WriteFileActivity did not check the file path properly and led to an arbitrary-file-write.</p>

<p><strong>DDIService\WriteFileActivity.cs</strong></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">override</span> <span class="n">RunResult</span> <span class="nf">Run</span><span class="p">(</span><span class="n">DataRow</span> <span class="n">input</span><span class="p">,</span> <span class="n">DataTable</span> <span class="n">dataTable</span><span class="p">,</span> <span class="n">DataObjectStore</span> <span class="n">store</span><span class="p">,</span> <span class="n">Type</span> <span class="n">codeBehind</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">.</span><span class="n">UpdateTableDelegate</span> <span class="n">updateTableDelegate</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DataRow</span> <span class="n">dataRow</span> <span class="p">=</span> <span class="n">dataTable</span><span class="p">.</span><span class="n">Rows</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="kt">string</span> <span class="k">value</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">input</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="n">InputVariable</span><span class="p">];</span>
    <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">input</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="n">OutputFileNameVariable</span><span class="p">];</span>
    <span class="n">RunResult</span> <span class="n">runResult</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RunResult</span><span class="p">();</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">runResult</span><span class="p">.</span><span class="n">ErrorOccur</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">streamWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">CreateNew</span><span class="p">)))</span>
        <span class="p">{</span>
            <span class="n">streamWriter</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">runResult</span><span class="p">.</span><span class="n">ErrorOccur</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are several paths to trigger the vulnerability of arbitrary-file-write. Here we use <code class="language-plaintext highlighter-rouge">ResetOABVirtualDirectory.xaml</code> as an example and write the result of <code class="language-plaintext highlighter-rouge">Set-OABVirtualDirectory</code> to the webroot to be our Webshell.</p>

<p><img src="/assets/img/blog/20210806/1/12.png" alt="" /></p>

<p>Now we have a working pre-auth RCE exploit chain. An unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an exposed 443 port. Here is an <a href="https://www.youtube.com/watch?v=SvjGMo9aMwE">demonstration video</a>:</p>

<div style="text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/SvjGMo9aMwE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>

<h1 id="epilogue">Epilogue</h1>

<p>As the first blog of this series, ProxyLogon perfectly shows how severe this attack surface could be. We will have more examples to come. Stay tuned!</p>


                    </div>
                    <!-- 文章內容 -->
                </div>
            </article>
            <!-- 文章 end -->
        </section>
        
         <!-- 作者 -->
        <section>
            <div class="container article_footer">
                <div class="author_info">
                    <a href="/en/blog/author/orange">
                        <div class="circle" style="background-image: url(/assets/img/avatar/orig/orange.png);"></div>
                    </a>
                    <div>
                        <a class="author" href="/en/blog/author/orange">
                            <h3>Orange Tsai</h3>
                        </a>
                        <span>Principal Security Researcher</span>
                        <p>
                            I am Orange : )
                        </p>
                    </div>
                </div>
            </div>
        </section>
        

    </div>

    <!-- footer -->
    <footer>
<div class="container footer">
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
        <div class="social">
            <a href="https://www.facebook.com/D3VC0RE"><i class="icon facebook"></i></a>
            <a href="https://twitter.com/d3vc0r3"><i class="icon twitter"></i></a>
        </div>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Services</h6>
        <ul>
            <li><a href="/en/services/red-team/">Red Team Assessment</a></li>
            <li><a href="/en/services/penetration-test/">Penetration Testing</a></li>
            <li><a href="/en/services/security-consulting/">Security Consulting</a></li>
            <li><a href="/en/services/security-training/">Security Training</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Research</h6>
        <ul>
            <li><a href="/en/research/overview/">Overview</a></li>
            <li><a href="/en/research/awards/">Competitions and Awards</a></li>
            <li><a href="/en/research/bug-bounty/">Enterprise Vulnerability Reports</a></li>
            <li><a href="/en/research/talks/">International Conferences</a></li>
            <li><a href="/en/research/cve/">CVE List</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Company</h6>
        <ul>
            <li><a href="/en/company/about/">Company Overview</a></li>
            <li><a href="/en/company/our-team/">Team Members</a></li>
            <li><a href="/en/company/history/">Achievements</a></li>
            <li><a href="/en/company/csr/">Corporate Social Responsibility</a></li>
            <li><a href="/en/company/jobs/">Job Opportunities</a></li>
            <li><a href="/en/contact/">Contact</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">News</h6>
        <ul>
            <li><a href="/en/blog/">Blog</a></li>
            <li><a href="/en/media-kit/">Media Resources</a></li>
        </ul>
    </div>

    <!-- divider 分隔線 -->
    <div class="divider"></div>

    <div class="copyright">
        <div class="info">
            <span>© 2025 DEVCORE <b class="line-block">All rights reserved.</b></span>
            <span><a href="/en/privacy-policy/">Privacy Policy</a></span>
        </div>
        <div class="lang">
            <!-- <i class="icon translate"></i>
            <select>
                <option value="">Language</option>
                <option value="">中文</option>
                <option value="">English</option>
            </select> -->
            <span>Language :<a href="/">中文</a>|<a href="/en/">English</a></span>
        </div>
    </div>

</div>
    </footer>
</body>
</html>










