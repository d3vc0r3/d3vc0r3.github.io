
<!DOCTYPE html>
<html class="no-js " lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
  <head>
    <title>
      手機應用程式開發上被忽略的 SSL 處理 | DEVCORE 戴夫寇爾
    </title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <meta name="description" property="og:description" content="在手機應用程式上，使用 HTTPS 連線來保護敏感訊息的傳遞是甚為重要的一環。但許多手機應用程式開發商在這個部分並沒有妥善處理好，以下我們就幾個常見的成因做基本的探討。" />
    <meta name="keywords" content="SSL, MITM, 中間人攻擊, 手機開發" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="手機應用程式開發上被忽略的 SSL 處理 | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="http://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lh5.googleusercontent.com/Fd1iUVkdWXPxlYucic4NznDQT9L4CQCR2gYL3KI-2Qs=w514-h686-no" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="手機應用程式開發上被忽略的 SSL 處理 | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="在手機應用程式上，使用 HTTPS 連線來保護敏感訊息的傳遞是甚為重要的一環。但許多手機應用程式開發商在這個部分並沒有妥善處理好，以下我們就幾個常見的成因做基本的探討。">
    <meta name="twitter:creator" content="d3vc0r3">
    <meta name="twitter:image:src" content="https://lh5.googleusercontent.com/Fd1iUVkdWXPxlYucic4NznDQT9L4CQCR2gYL3KI-2Qs=w514-h686-no">
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />

    <link rel="canonical" href="http://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="http://devco.re/rss">
    <link rel="publisher" href="https://plus.google.com/118439315679478709768/" />

    <link href="/assets/themes/devcore/images/favicon.png" rel="icon" size="32x32">
    <link href="/assets/themes/devcore/stylesheets/all.min.css" media="screen" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]><link href="/stylesheets/ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]--><!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->
  </head>
  <body class="off-canvas" data-offset="48" data-spy="scroll" data-target=".quick-nav">
    <div class="wrapper">
      <div class="outside">
        <div class="page-width">
          <div class="close-menu-btn-wrapper">
            <div class="close-menu-btn-wrapper-inner">
              <a class="close-menu-btn" href="#close-menu">×</a>
            </div>
          </div>
        </div>
        <div class="outside-inner">
          <div class="main-nav" data-set="main-nav">
            <ul>
              <li>
                <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="zh">
                    服務
                  </div>
                  <div class="en">
                    Services
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                      <div class="zh">
                        滲透測試服務
                      </div>
                      <div class="en">
                        Penetration Test
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-training" title="資安教育訓練 Security Training">
                      <div class="zh">
                        資安教育訓練
                      </div>
                      <div class="en">
                        Security Training
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/incident-response" title="資安事件處理 Incident Response">
                      <div class="zh">
                        資安事件處理
                      </div>
                      <div class="en">
                        Incident Response
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                      <div class="zh">
                        資安顧問服務
                      </div>
                      <div class="en">
                        Security Consulting
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">
                      <div class="zh">
                        網站安全標章
                      </div>
                      <div class="en">
                        Security Seal
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/blog/" title="部落格 Blog">
                  <div class="zh">
                    部落格
                  </div>
                  <div class="en">
                    Blog
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/blog/category/%E6%9C%80%E6%96%B0%E6%B6%88%E6%81%AF/" title="最新消息 News">
                      <div class="zh">
                        最新消息
                      </div>
                      <div class="en">
                        News
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%A1%88%E4%BE%8B%E5%89%96%E6%9E%90/" title="案例剖析 Case Study">
                      <div class="zh">
                        案例剖析
                      </div>
                      <div class="en">
                        Case Study
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%8A%80%E8%A1%93%E5%B0%88%E6%AC%84/" title="技術專欄 Technical">
                      <div class="zh">
                        技術專欄
                      </div>
                      <div class="en">
                        Technical
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E7%A7%91%E6%99%AE%E6%96%87%E7%AB%A0/" title="科普文章 For Muggle">
                      <div class="zh">
                        科普文章
                      </div>
                      <div class="en">
                        For Muggle
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/about/" title="關於 About">
                  <div class="zh">
                    關於
                  </div>
                  <div class="en">
                    About
                  </div>
                </a>
              </li>
              <li>
                <a href="/contact/" title="聯絡 Contact">
                  <div class="zh">
                    聯絡
                  </div>
                  <div class="en">
                    Contact
                  </div>
                </a>
              </li>
              <li>
                <a href="/partners/" title="合作夥伴 Partners">
                  <div class="zh">
                    合作夥伴
                  </div>
                  <div class="en">
                    Partners
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="page">
        <div class="header">
          <div class="header-inner">
            <div class="main-nav" data-set="main-nav">
              <ul>
                <li>
                  <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                </li>
                <li>
                  <a href="/blog/" title="部落格 Blog">Blog</a>
                </li>
                <li>
                  <a href="/about/" title="關於 About">About</a>
                </li>
                <li>
                  <a href="/contact/" title="聯絡 Contact">Contact</a>
                </li>
                <li>
                  <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                </li>
                <li class="menu-button">
                  <a class="open-menu-btn" href="#open-menu">・・・</a>
                </li>
              </ul>
            </div>
            <h1 class="logo">
              <a href="/" title="DEVCORE 戴夫寇爾">手機應用程式開發上被忽略的 SSL 處理</a>
            </h1>
          </div>
        </div>
        <div class="main">
          

          <div class="page-header">
            <div class="container">
              <h2 class="page-header-title">
                部落格 <small> Blog </small>
              </h2>
            </div>
          </div>
          <div class="page-content">
            <div class="container">
              <div class="post">
                <div class="post-main">
                  <div class="post-switch">
                    <a class="prev" href="/blog/2014/07/18/waf-configuration-security-issue/" title="設備不良設定帶來的安全風險：以 WAF 為例">上一篇文章</a>
                    <a class="next" href="/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/" title="被遺忘的資訊洩漏－重點回顧">下一篇文章</a>
                  </div>
                  <div itemscope itemtype="http://schema.org/Article" class="post-content">
                    <h2 itemprop="name" class="post-title">
                      手機應用程式開發上被忽略的 SSL 處理
                    </h2>
                    <div class="post-info">
                      
                      
                      
<span class="post-category"><a href="/blog/category/技術專欄/" title="技術專欄">技術專欄</a></span><span class="posted">Posted </span>by <a class="poster" href="/blog/author/anfa"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Anfa Sam</span></span></a>on <span class="post-time" itemprop="datePublished" content="2014-08-15">2014-08-15</span>


                    </div>
                    <div class="post-tag">
                      
                      Tags: <a href="/blog/tag/Mobile/">Mobile</a>, <a href="/blog/tag/Android/">Android</a>, <a href="/blog/tag/iOS/">iOS</a>, <a href="/blog/tag/SSL/">SSL</a>, <a href="/blog/tag/MITM/">MITM</a>
                    </div>
                    <span itemprop="articleBody">
                      
<p><img src="https://lh5.googleusercontent.com/Fd1iUVkdWXPxlYucic4NznDQT9L4CQCR2gYL3KI-2Qs=w514-h686-no" alt="SSL" />
<!-- Credit: http://natashenka.ca/printable-ssl-posters/ --></p>

<p>在網路上傳輸敏感資訊時，通常會使用 HTTPS 協定，讓客戶端與伺服器端對資料進行 SSL 加密處理，以降低資料在傳輸過程中被監聽或中間人攻擊的風險。HTTPS 的重要性逐漸被重視，Google 除了預設開啟 HTTPS 之外，未來更會將 <a href="http://googlewebmastercentral.blogspot.tw/2014/08/https-as-ranking-signal.html">HTTPS 的網站搜尋排名加分</a>。但為了確保傳輸的安全，過程中客戶端會核對伺服器的憑證鏈 (certificate chain) 是否有效，若判定為無效時會作出警告。(詳見<a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer">Wikipedia</a>)</p>

<!-- more -->
<p><img src="https://lh5.googleusercontent.com/-3KUlB8qAxng/U-oq77eBmvI/AAAAAAAAAlw/Ul4v9jNaSXY/w846-h577-no/desktop_browser_insecure_warning.png" alt="Desktop 警告圖" />
而在手機應用程式上 HTTPS 同樣重要，例如網路銀行、線上購物等。系統同樣會做憑證核對，但對被判定為無效的憑證就需要開發者作出額外的處理了。許多手機應用程式開發商在這個部分並沒有妥善處理好，以下我們就幾個常見的成因做基本的探討。</p>

<h3 id="section">會被系統判定為無效的常見成因？</h3>
<p>在探討該如何處理這個問題之前，這裡先列出一些有可能被系統判定成無效憑證的成因。</p>

<h4 id="note1">1. 系統支援問題 <sup id="fnref:note1"><a href="#fn:note1" class="footnote">1</a></sup></h4>
<p>在 Android 2.2 及之前的版本，對 SSL 的支援上存在著一些問題，像是 <a href="https://code.google.com/p/android/issues/detail?id=12908">SNI</a> 和 <a href="https://code.google.com/p/android/issues/detail?id=26542">Multiple Chain</a>。而 Android 上不接受缺少中繼 CA 憑證的憑證鏈，例如：<a href="https://egov.uscis.gov/">https://egov.uscis.gov/</a></p>

<h4 id="section-1">2. 相關憑證未被預載到系統中</h4>
<p>以 GCA 簽發的 SSL 憑證為例，在 Windows 上被判定為有效，但在 iOS 系統上卻因為 CA 不在系統的預載清單中而被判定為無效。</p>

<p><img src="https://lh4.googleusercontent.com/-1Aeo7DIPjMg/U-o1hpl5ZTI/AAAAAAAAAmk/jodyNvjqpTs/w741-h654-no/windows_recognize_gca.png" alt="Windows" />
<img src="https://lh4.googleusercontent.com/kXM1zDdNKQitgCAvIqIkTAz8fgi_QgPA3rBb8kP49jg=w457-h686-no" alt="iPhone" /></p>

<h4 id="section-2">3. 使用自行簽發的憑證</h4>
<p>這種情況常出現在應用程式開發階段的內部測試環境中，由於是內部測試環境一般都不會花錢去申請憑證。</p>

<h4 id="mitm">4. 連線被中間人(MITM)攻擊</h4>
<p>當連線被 MITM 攻擊時，使用者原本的連線目的地會被導到攻擊者的設備上，此時伺服器憑證也會被取代成攻擊者自行簽發的憑證，造成原本正常的連線出現異常。</p>

<h3 id="section-3">開發者該如何處理？</h3>

<p>理想情況下，客戶端的支援度充足，伺服器憑證鏈的來源及設定正確，只需使用系統原有的方式去檢查憑證即可達到安全效果。但若非得要相容低版本系統或是自行簽發憑證的時候，就得自行做額外的檢查。</p>

<p>在處理方式上，普遍是使用憑證綁定 (certificate pinning) 的方式，把需要比對的憑證預先存放在應用程式裡，待要進行 SSL Handshake 的時候再與伺服器的憑證做比對。</p>

<p>可是在實務上，大多開發人員採用消極的方法，把錯誤警告略過讓連線繼續進行，使得本來使用 SSL 加密連線帶來的安全性形同虛設。據 2012 年 <a href="http://android-ssl.org/files/p50-fahl.pdf">Why Eve and Mallory Love Android: An Analysis of SSL (In)Security on Android</a> 這篇論文指出，在 Google Play 上 13500 個免費熱門應用程式當中，共有 1074 個 (8%) 應用程式因錯誤的 SSL 處理而導致使用者陷入 MITM 攻擊的風險中。</p>

<p>下面我們整理了一些在手機應用開發上，常見的 SSL 處理錯誤，以及其對應適當的處理方法。</p>

<h4 id="android-1">Android 錯誤處理情況1</h4>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno">1</span> <span class="nd">@Override</span>
<span class="lineno">2</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceivedSslError</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">SslErrorHandler</span> <span class="n">handler</span><span class="o">,</span> <span class="n">SslError</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">3</span>     <span class="n">handler</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
<span class="lineno">4</span> <span class="o">}</span></code></pre></div>

<p>當透過 WebView 元件訪問 HTTPS 網站發生 SSL 錯誤時，會觸發 onReceivedSslError 這個函數。根據官方文件指出，可藉由執行 handler.proceed() 或是 handler.cancel() 來決定是否讓連線繼續進行。在不覆寫這函數的情況下預設會執行 handler.cancel()。而上面的做法卻讓異常的連線繼續進行了。</p>

<p>較為恰當的做法是使用 handler.cancel() 讓連線終止，或是限制在開發階段才執行 handler.proceed()。像 <a href="https://github.com/apache/cordova-android/blob/3.5.1/framework/src/org/apache/cordova/CordovaWebViewClient.java#L298">Apache Coradova</a> 和 <a href="https://github.com/facebook/facebook-android-sdk/blob/sdk-version-3.15.0/facebook/src/com/facebook/widget/WebDialog.java#L420">Facebook Android SDK</a> 皆有對這部分做控管。</p>

<h4 id="android-2">Android 錯誤處理情況2</h4>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="n">TrustManager</span><span class="o">[]</span> <span class="n">trustAllManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TrustManager</span><span class="o">[]</span> <span class="o">{</span> <span class="k">new</span> <span class="nf">X509TrustManager</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 2</span>     <span class="nd">@Override</span>
<span class="lineno"> 3</span>     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkClientTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno"> 4</span>     <span class="o">}</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>     <span class="nd">@Override</span>
<span class="lineno"> 7</span>     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkServerTrusted</span><span class="o">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="o">,</span> <span class="n">String</span> <span class="n">authType</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno"> 8</span>     <span class="o">}</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span>     <span class="nd">@Override</span>
<span class="lineno">11</span>     <span class="kd">public</span> <span class="n">X509Certificate</span><span class="o">[]</span> <span class="nf">getAcceptedIssuers</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno">12</span>         <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="lineno">13</span>     <span class="o">}</span>
<span class="lineno">14</span> <span class="o">}</span> <span class="o">};</span>
<span class="lineno">15</span> 
<span class="lineno">16</span> <span class="n">SSLContext</span> <span class="n">sslContext</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
<span class="lineno">17</span> <span class="n">sslContext</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">trustAllManager</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span></code></pre></div>

<p>本用來檢查伺服器憑證的 checkServerTrusted 被留空，導致警告被略過。Google 建議不要自行實作 TrustManager，而是把憑證放到 KeyStore，再把 KeyStore 放到 TrustManagerFactory，最後從 TrustManagerFactory 產出相關的 TrustManager，開發文件中有提供處理的<a href="https://developer.android.com/training/articles/security-ssl.html#UnknownCa">範例</a>。OWASP 的 WIKI 上也有提供自行實作 TrustManager 做 certificate pinning 的<a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning#Android">範例</a>。<sup id="fnref:note2"><a href="#fn:note2" class="footnote">2</a></sup></p>

<p>下面節錄 Android 官方文件上的範例：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="n">KeyStore</span> <span class="n">keyStore</span> <span class="o">=</span> <span class="o">...;</span>
<span class="lineno"> 2</span> <span class="n">String</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getDefaultAlgorithm</span><span class="o">();</span>
<span class="lineno"> 3</span> <span class="n">TrustManagerFactory</span> <span class="n">tmf</span> <span class="o">=</span> <span class="n">TrustManagerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">algorithm</span><span class="o">);</span>
<span class="lineno"> 4</span> <span class="n">tmf</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">keyStore</span><span class="o">);</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="n">SSLContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;TLS&quot;</span><span class="o">);</span>
<span class="lineno"> 7</span> <span class="n">context</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">tmf</span><span class="o">.</span><span class="na">getTrustManagers</span><span class="o">(),</span> <span class="kc">null</span><span class="o">);</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s">&quot;https://www.example.com/&quot;</span><span class="o">);</span>
<span class="lineno">10</span> <span class="n">HttpsURLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpsURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
<span class="lineno">11</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">setSSLSocketFactory</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSocketFactory</span><span class="o">());</span>
<span class="lineno">12</span> <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span></code></pre></div>

<h4 id="android-3">Android 錯誤處理情況3</h4>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno">1</span> <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s">&quot;https://www.example.com/&quot;</span><span class="o">);</span>
<span class="lineno">2</span> <span class="n">HttpsURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpsURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
<span class="lineno">3</span> <span class="n">conn</span><span class="o">.</span><span class="na">setHostnameVerifier</span><span class="o">(</span><span class="n">SSLSocketFactory</span><span class="o">.</span><span class="na">ALLOW_ALL_HOSTNAME_VERIFIER</span><span class="o">);</span></code></pre></div>

<p>或是</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno">1</span> <span class="n">HostnameVerifier</span> <span class="n">allHostVerifier</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">HostnameVerifier</span><span class="o">()</span> <span class="o">{</span>
<span class="lineno">2</span>     <span class="nd">@Override</span>
<span class="lineno">3</span>     <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="n">String</span> <span class="n">hostname</span><span class="o">,</span> <span class="n">SSLSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
<span class="lineno">4</span>         <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="lineno">5</span>     <span class="o">}</span>
<span class="lineno">6</span> <span class="o">};</span></code></pre></div>

<p>上述寫法略過了憑證中的 hostname 檢查，導致即使連線端與憑證中指定的 hostname 不一致也能通過。較為恰當的做法是不特別設定，讓他使用預設的 DefaultHostnameVerifier，或是採用更為嚴謹的 StrictHostnameVerifier。</p>

<h4 id="ios-1">iOS 錯誤處理情況1</h4>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno">1</span> <span class="k">@implementation</span> <span class="bp">NSURLRequest</span> <span class="nl">(IgnoreSSL)</span>
<span class="lineno">2</span> <span class="p">+</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">allowsAnyHTTPSCertificateForHost:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">host</span>
<span class="lineno">3</span> <span class="p">{</span>
<span class="lineno">4</span>     <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="lineno">5</span> <span class="p">}</span>
<span class="lineno">6</span> <span class="k">@end</span></code></pre></div>

<p>此情況使用到 Framework 中的 Private API，雖然這種寫法會因為不能通過 Apple 的審查而不會出現在 AppStore 上(使用回避技巧不在這討論範圍內)，但仍有機會在無需經過 Apple 審查的 Enterprise App 中使用。較為適當的做法是用 “#if DEBUG”，”#endif” 包起來以確保該段程式在編譯時只能對開發中的 debug 版上有作用。</p>

<h4 id="ios-2">iOS 錯誤處理情況2</h4>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno"> 1</span> <span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">connection:</span><span class="p">(</span><span class="bp">NSURLConnection</span> <span class="o">*</span><span class="p">)</span><span class="nv">connection</span> <span class="nf">canAuthenticateAgainstProtectionSpace:</span><span class="p">(</span><span class="bp">NSURLProtectionSpace</span> <span class="o">*</span><span class="p">)</span><span class="nv">protectionSpace</span> <span class="p">{</span>
<span class="lineno"> 2</span>     <span class="k">return</span> <span class="p">[</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">authenticationMethod</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">NSURLAuthenticationMethodServerTrust</span><span class="p">];</span>
<span class="lineno"> 3</span> <span class="p">}</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">connection:</span><span class="p">(</span><span class="bp">NSURLConnection</span> <span class="o">*</span><span class="p">)</span><span class="nv">connection</span> <span class="nf">didReceiveAuthenticationChallenge:</span><span class="p">(</span><span class="bp">NSURLAuthenticationChallenge</span> <span class="o">*</span><span class="p">)</span><span class="nv">challenge</span> <span class="p">{</span>
<span class="lineno"> 6</span>     <span class="k">if</span> <span class="p">([</span><span class="n">challenge</span><span class="p">.</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">authenticationMethod</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">NSURLAuthenticationMethodServerTrust</span><span class="p">])</span>
<span class="lineno"> 7</span>         <span class="p">[</span><span class="n">challenge</span><span class="p">.</span><span class="n">sender</span> <span class="nl">useCredential</span><span class="p">:[</span><span class="bp">NSURLCredential</span> <span class="nl">credentialForTrust</span><span class="p">:</span><span class="n">challenge</span><span class="p">.</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">serverTrust</span><span class="p">]</span> <span class="nl">forAuthenticationChallenge</span><span class="p">:</span><span class="n">challenge</span><span class="p">];</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>     <span class="p">[</span><span class="n">challenge</span><span class="p">.</span><span class="n">sender</span> <span class="nl">continueWithoutCredentialForAuthenticationChallenge</span><span class="p">:</span><span class="n">challenge</span><span class="p">];</span>
<span class="lineno">10</span> <span class="p">}</span></code></pre></div>

<p>上面的做法會讓使用 NSURLConnection 的連線略過憑證檢查，容許任意憑證通過。下面節錄 OWASP WIKI 上的範例：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno"> 1</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">connection:</span><span class="p">(</span><span class="bp">NSURLConnection</span> <span class="o">*</span><span class="p">)</span><span class="nv">connection</span> <span class="nf">didReceiveAuthenticationChallenge:</span>
<span class="lineno"> 2</span>                    <span class="p">(</span><span class="bp">NSURLAuthenticationChallenge</span> <span class="o">*</span><span class="p">)</span><span class="nv">challenge</span>
<span class="lineno"> 3</span> <span class="p">{</span>
<span class="lineno"> 4</span>     <span class="k">if</span> <span class="p">([[[</span><span class="n">challenge</span> <span class="n">protectionSpace</span><span class="p">]</span> <span class="n">authenticationMethod</span><span class="p">]</span> <span class="nl">isEqualToString</span><span class="p">:</span> <span class="n">NSURLAuthenticationMethodServerTrust</span><span class="p">])</span>
<span class="lineno"> 5</span>     <span class="p">{</span>
<span class="lineno"> 6</span>         <span class="k">do</span>
<span class="lineno"> 7</span>         <span class="p">{</span>
<span class="lineno"> 8</span>             <span class="n">SecTrustRef</span> <span class="n">serverTrust</span> <span class="o">=</span> <span class="p">[[</span><span class="n">challenge</span> <span class="n">protectionSpace</span><span class="p">]</span> <span class="n">serverTrust</span><span class="p">];</span>
<span class="lineno"> 9</span>             <span class="k">if</span><span class="p">(</span><span class="nb">nil</span> <span class="o">==</span> <span class="n">serverTrust</span><span class="p">)</span>
<span class="lineno">10</span>                 <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>             <span class="n">OSStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">SecTrustEvaluate</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="lineno">13</span>             <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">errSecSuccess</span> <span class="o">==</span> <span class="n">status</span><span class="p">))</span>
<span class="lineno">14</span>                 <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">15</span> 
<span class="lineno">16</span>             <span class="n">SecCertificateRef</span> <span class="n">serverCertificate</span> <span class="o">=</span> <span class="n">SecTrustGetCertificateAtIndex</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="lineno">17</span>             <span class="k">if</span><span class="p">(</span><span class="nb">nil</span> <span class="o">==</span> <span class="n">serverCertificate</span><span class="p">)</span>
<span class="lineno">18</span>             <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">19</span> 
<span class="lineno">20</span>             <span class="n">CFDataRef</span> <span class="n">serverCertificateData</span> <span class="o">=</span> <span class="n">SecCertificateCopyData</span><span class="p">(</span><span class="n">serverCertificate</span><span class="p">);</span>
<span class="lineno">21</span>             <span class="p">[(</span><span class="kt">id</span><span class="p">)</span><span class="n">serverCertificateData</span> <span class="n">autorelease</span><span class="p">];</span>
<span class="lineno">22</span>             <span class="k">if</span><span class="p">(</span><span class="nb">nil</span> <span class="o">==</span> <span class="n">serverCertificateData</span><span class="p">)</span>
<span class="lineno">23</span>                 <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>             <span class="k">const</span> <span class="kt">UInt8</span><span class="o">*</span> <span class="k">const</span> <span class="n">data</span> <span class="o">=</span> <span class="n">CFDataGetBytePtr</span><span class="p">(</span><span class="n">serverCertificateData</span><span class="p">);</span>
<span class="lineno">26</span>             <span class="k">const</span> <span class="n">CFIndex</span> <span class="n">size</span> <span class="o">=</span> <span class="n">CFDataGetLength</span><span class="p">(</span><span class="n">serverCertificateData</span><span class="p">);</span>
<span class="lineno">27</span>             <span class="bp">NSData</span><span class="o">*</span> <span class="n">cert1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithBytes</span><span class="p">:</span><span class="n">data</span> <span class="nl">length</span><span class="p">:(</span><span class="bp">NSUInteger</span><span class="p">)</span><span class="n">size</span><span class="p">];</span>
<span class="lineno">28</span> 
<span class="lineno">29</span>             <span class="bp">NSString</span> <span class="o">*</span><span class="n">file</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@&quot;random-org&quot;</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@&quot;der&quot;</span><span class="p">];</span>
<span class="lineno">30</span>             <span class="bp">NSData</span><span class="o">*</span> <span class="n">cert2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfFile</span><span class="p">:</span><span class="n">file</span><span class="p">];</span>
<span class="lineno">31</span> 
<span class="lineno">32</span>             <span class="k">if</span><span class="p">(</span><span class="nb">nil</span> <span class="o">==</span> <span class="n">cert1</span> <span class="o">||</span> <span class="nb">nil</span> <span class="o">==</span> <span class="n">cert2</span><span class="p">)</span>
<span class="lineno">33</span>                 <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">34</span> 
<span class="lineno">35</span>             <span class="k">const</span> <span class="kt">BOOL</span> <span class="n">equal</span> <span class="o">=</span> <span class="p">[</span><span class="n">cert1</span> <span class="nl">isEqualToData</span><span class="p">:</span><span class="n">cert2</span><span class="p">];</span>
<span class="lineno">36</span>             <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">equal</span><span class="p">)</span>
<span class="lineno">37</span>                 <span class="k">break</span><span class="p">;</span> <span class="cm">/* failed */</span>
<span class="lineno">38</span> 
<span class="lineno">39</span>             <span class="c1">// The only good exit point</span>
<span class="lineno">40</span>             <span class="k">return</span> <span class="p">[[</span><span class="n">challenge</span> <span class="n">sender</span><span class="p">]</span> <span class="nl">useCredential</span><span class="p">:</span> <span class="p">[</span><span class="bp">NSURLCredential</span> <span class="nl">credentialForTrust</span><span class="p">:</span> <span class="n">serverTrust</span><span class="p">]</span>
<span class="lineno">41</span>                         <span class="nl">forAuthenticationChallenge</span><span class="p">:</span> <span class="n">challenge</span><span class="p">];</span>
<span class="lineno">42</span>         <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="lineno">43</span>     <span class="p">}</span>
<span class="lineno">44</span> 
<span class="lineno">45</span>     <span class="c1">// Bad dog</span>
<span class="lineno">46</span>     <span class="k">return</span> <span class="p">[[</span><span class="n">challenge</span> <span class="n">sender</span><span class="p">]</span> <span class="nl">cancelAuthenticationChallenge</span><span class="p">:</span> <span class="n">challenge</span><span class="p">];</span>
<span class="lineno">47</span> <span class="p">}</span></code></pre></div>

<p>處理方式與前面的 Android 情況2類同，做了 certificate pinning。</p>

<h4 id="ios-3">iOS 錯誤處理情況3</h4>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno"> 1</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">URLSession:</span><span class="p">(</span><span class="bp">NSURLSession</span> <span class="o">*</span><span class="p">)</span><span class="nv">session</span>
<span class="lineno"> 2</span> <span class="nf">didReceiveChallenge:</span><span class="p">(</span><span class="bp">NSURLAuthenticationChallenge</span> <span class="o">*</span><span class="p">)</span><span class="nv">challenge</span>
<span class="lineno"> 3</span>   <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSURLSessionAuthChallengeDisposition</span> <span class="n">disposition</span><span class="p">,</span>
<span class="lineno"> 4</span>                               <span class="bp">NSURLCredential</span> <span class="o">*</span><span class="n">credential</span><span class="p">))</span><span class="n">completionHandler</span>
<span class="lineno"> 5</span> <span class="p">{</span>
<span class="lineno"> 6</span>     <span class="bp">NSURLProtectionSpace</span> <span class="o">*</span> <span class="n">protectionSpace</span> <span class="o">=</span> <span class="n">challenge</span><span class="p">.</span><span class="n">protectionSpace</span><span class="p">;</span>
<span class="lineno"> 7</span>     <span class="k">if</span> <span class="p">([</span><span class="n">protectionSpace</span><span class="p">.</span><span class="n">authenticationMethod</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">NSURLAuthenticationMethodServerTrust</span><span class="p">])</span> <span class="p">{</span>
<span class="lineno"> 8</span>         <span class="n">SecTrustRef</span> <span class="n">serverTrust</span> <span class="o">=</span> <span class="n">protectionSpace</span><span class="p">.</span><span class="n">serverTrust</span><span class="p">;</span>
<span class="lineno"> 9</span>         <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengeUseCredential</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSURLCredential</span> <span class="nl">credentialForTrust</span><span class="p">:</span> <span class="n">serverTrust</span><span class="p">]);</span>
<span class="lineno">10</span>     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="lineno">11</span>         <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengePerformDefaultHandling</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="lineno">12</span>     <span class="p">}</span>
<span class="lineno">13</span> <span class="p">}</span></code></pre></div>

<p>與前面 NSURLConnection 的情況類同，只是這裡使用到的是 iOS7  新增的 NSURLSession 元件。對應的處理方式如下：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="lineno"> 1</span> <span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">URLSession:</span><span class="p">(</span><span class="bp">NSURLSession</span> <span class="o">*</span><span class="p">)</span><span class="nv">session</span>
<span class="lineno"> 2</span> <span class="nf">didReceiveChallenge:</span><span class="p">(</span><span class="bp">NSURLAuthenticationChallenge</span> <span class="o">*</span><span class="p">)</span><span class="nv">challenge</span>
<span class="lineno"> 3</span>   <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSURLSessionAuthChallengeDisposition</span> <span class="n">disposition</span><span class="p">,</span>
<span class="lineno"> 4</span>                               <span class="bp">NSURLCredential</span> <span class="o">*</span><span class="n">credential</span><span class="p">))</span><span class="n">completionHandler</span>
<span class="lineno"> 5</span> <span class="p">{</span>
<span class="lineno"> 6</span>     <span class="k">if</span> <span class="p">([[[</span><span class="n">challenge</span> <span class="n">protectionSpace</span><span class="p">]</span> <span class="n">authenticationMethod</span><span class="p">]</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">NSURLAuthenticationMethodServerTrust</span><span class="p">])</span> <span class="p">{</span>
<span class="lineno"> 7</span>         <span class="n">SecTrustRef</span> <span class="n">serverTrust</span> <span class="o">=</span> <span class="p">[[</span><span class="n">challenge</span> <span class="n">protectionSpace</span><span class="p">]</span> <span class="n">serverTrust</span><span class="p">];</span>
<span class="lineno"> 8</span>         <span class="k">if</span> <span class="p">(</span><span class="n">serverTrust</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 9</span>             <span class="n">OSStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">SecTrustEvaluate</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="lineno">10</span>             <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">errSecSuccess</span> <span class="o">==</span> <span class="n">status</span><span class="p">))</span> <span class="p">{</span>
<span class="lineno">11</span>                 <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="lineno">12</span>                 <span class="k">return</span><span class="p">;</span>
<span class="lineno">13</span>             <span class="p">}</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>             <span class="bp">NSData</span> <span class="o">*</span><span class="n">localCertData</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfFile</span><span class="p">:[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span>
<span class="lineno">16</span>                                                    <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@&quot;random-org&quot;</span>
<span class="lineno">17</span>                                                             <span class="nl">ofType</span><span class="p">:</span><span class="s">@&quot;der&quot;</span><span class="p">]];</span>
<span class="lineno">18</span> 
<span class="lineno">19</span>             <span class="n">SecCertificateRef</span> <span class="n">remoteServerCert</span> <span class="o">=</span> <span class="n">SecTrustGetCertificateAtIndex</span><span class="p">(</span><span class="n">serverTrust</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="lineno">20</span>             <span class="n">CFDataRef</span> <span class="n">remoteCertData</span> <span class="o">=</span> <span class="n">SecCertificateCopyData</span><span class="p">(</span><span class="n">remoteServerCert</span><span class="p">);</span>
<span class="lineno">21</span>             <span class="kt">BOOL</span> <span class="n">isMatch</span> <span class="o">=</span> <span class="p">[</span><span class="n">localCertData</span> <span class="nl">isEqualToData</span><span class="p">:</span> <span class="p">(</span><span class="k">__bridge</span> <span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="n">remoteCertData</span><span class="p">];</span>
<span class="lineno">22</span>             <span class="n">CFRelease</span><span class="p">(</span><span class="n">remoteCertData</span><span class="p">);</span>
<span class="lineno">23</span> 
<span class="lineno">24</span>             <span class="k">if</span> <span class="p">(</span><span class="n">isMatch</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">25</span>                 <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengeUseCredential</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSURLCredential</span> <span class="nl">credentialForTrust</span><span class="p">:</span><span class="n">serverTrust</span><span class="p">]);</span>
<span class="lineno">26</span>             <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="lineno">27</span>                 <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="lineno">28</span>             <span class="p">}</span>
<span class="lineno">29</span>         <span class="p">}</span>
<span class="lineno">30</span>     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="lineno">31</span>         <span class="n">completionHandler</span><span class="p">(</span><span class="n">NSURLSessionAuthChallengePerformDefaultHandling</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
<span class="lineno">32</span>     <span class="p">}</span>
<span class="lineno">33</span> <span class="p">}</span></code></pre></div>

<h4 id="webview-">對 WebView 的一些補充</h4>
<p>在對 WebView 做處理上，除了對 SSL 錯誤直接略過外，目前無論是在 Android 還是 iOS 上，SDK API 都尚未直接提供方法讓開發者能在 SSL Handshake 的途中作 Server Certificate Pinning。其中一個替代方法是，利用其他能夠作 Pinning 的元件將資料下載回來，接著把資料傳到 WebView 進行讀取，避開原本用 WebView 直接設定連線網址。蘋果公司有提供這種處理的<a href="https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/Introduction/Intro.html">範例</a>。</p>

<h3 id="section-4">結語</h3>
<p>本來為了提高安全性而使用的 SSL 加密連線，卻由於程式處理不當讓原來的保護形同虛設。觀念不足與為節省時間而沒做好處理相信是主要原因。網路上大量的文章在引指開發者略過錯誤警告的時候，卻沒有提醒他們這樣做帶來的影響，也助長了不當處理的發生。</p>

<p>除了 SSL 處理問題外，手機應用程式開發還有許多要注意的安全問題，像是 OWASP 列出的 <a href="https://www.owasp.org/index.php/Projects/OWASP_Mobile_Security_Project_-_Top_Ten_Mobile_Risks">Top 10 Mobile Risks</a>、由日本智慧型手機安全協會發佈 <a href="http://www.jssec.org/report/android_securecoding_en_20140801.html">Android Application Secure Design/Secure Coding Guidebook</a> 裡面所建議的。開發商有責任做好安全把關以保障雙方權益。</p>

<h3 id="section-5">參考</h3>
<ul>
  <li><a href="http://android-ssl.org">Rethinking SSL Development in an Appified World</a></li>
  <li><a href="http://android-developers.blogspot.com/2012/03/unifying-key-store-access-in-ics.html">Unifying Key Store Access in ICS | Android Developers Blog</a></li>
  <li><a href="http://commonsware.com/blog/2013/03/04/ssl-android-basics.html">The CommonsBlog — SSL on Android: The Basics</a></li>
  <li><a href="https://developer.android.com/training/articles/security-ssl.html">Security with HTTPS and SSL | Android Developers</a></li>
  <li><a href="https://developer.apple.com/librarY/mac/documentation/NetworkingInternet/Conceptual/NetworkingTopics/Articles/OverridingSSLChainValidationCorrectly.html">Networking Programming Topics: Overriding TLS Chain Validation Correctly</a></li>
  <li><a href="https://developer.apple.com/library/ios/technotes/tn2232/_index.html">Technical Note TN2232: HTTPS Server Trust Evaluation</a></li>
  <li><a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">Certificate and Public Key Pinning - OWASP</a></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:note1">
      <p>Google 基於效能及有效性的考量，在 Android 系統上預設停用<a href="https://code.google.com/p/android/issues/detail?id=68643">憑證撤銷檢查</a><br /> <a href="#fnref:note1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:note2">
      <p>OWASP 的 Android 範例中，內含的 PUB_KEY 是錯誤的 (最後更改日期 2014/08/14) <a href="#fnref:note2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </span>
                    
                    <div class="author-area">
                      <h4 class="page-content-title page-content-title-with-line">
                        <span>作者資訊</span>
                      </h4>

                      <div class="author" style="overflow: hidden; margin-bottom: 30px;">
                        <div class="authoe-avatar" style="float: left; width: 160px;">
                          <img src="/assets/themes/devcore/images/avatar/anfasam.jpg" style="margin: 0px auto; " alt="Anfa Sam" title="Anfa Sam" />
                        </div>
                        <div class="authoe-desc" style="margin-left: 200px;">
                          <h4 class="author-name">
                            <a href="/blog/author/anfa">Anfa Sam</a>
                          </h4>
                          <div class="author-role">
                            Full Stack Developer
                          </div>
                          <div class="author-intro">
                            熟識各種平台架構，以全面的思維評估問題，持續關注最新技術。現專注於 Android、iOS 等手機平台的安全問題上。
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="post-switch">
                      <a class="prev" href="/blog/2014/07/18/waf-configuration-security-issue/" title="設備不良設定帶來的安全風險：以 WAF 為例">上一篇文章</a>
                      <a class="next" href="/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/" title="被遺忘的資訊洩漏－重點回顧">下一篇文章</a>
                    </div>
                    <div class="social-share" style="line-height: 10px; margin: 20px 0;">
                      <div style="float: right;">
                        <div class="fb-like" data-href="http://devco.re/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
                      </div>
                      <a href="#" style="dispaly:none; border-bottom:none;"> </a>
                      <a href="https://twitter.com/share?" class="twitter-share-button">Tweet</a>
                      <div class="g-plusone" data-size="medium"></div>
                      <script type="text/javascript">
                        (function() {
                          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                          po.src = 'https://apis.google.com/js/platform.js';
                          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                        })();
                      </script>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                    </div>
                  </div>
                  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'd3vc0r3'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




                </div>
                <div class="post-sidebar">
                  <!--文章分類-->
                  <div class="widget">
                    <div class="widget-title">
                      文章分類
                    </div>
                    <ul class="widget-list">
                      
                                        
                    
                      <li>
                        <a href="/blog/category/最新消息/">最新消息 <span class="count">(2)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/案例剖析/">案例剖析 <span class="count">(9)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/技術專欄/">技術專欄 <span class="count">(16)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/科普文章/">科普文章 <span class="count">(3)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/資安新聞/">資安新聞 <span class="count">(1)</span></a>
                      </li>
                    
                  
                      <li>
                        <a href="/blog/archive"><div class="widget-list-title">所有文章列表 »</div></a>
                      </li>
                      <li>
                        <gcse:search></gcse:search>
                      </li>

                    </ul>
                  </div>
                  <!--文章分類 end--><!--最新文章-->
                  <div class="widget">
                    <div class="widget-title">
                      最新文章
                    </div>
                    <ul class="widget-list">
                        
                      <li>
                        <a href="/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/">
                          <div class="widget-list-title">
                            How I Hacked Facebook, and Found Someone's Backdoor Script
                          </div>
                          <div class="widget-list-date">
                            2016-04-21
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/">
                          <div class="widget-list-title">
                            滲透 Facebook 的思路與發現
                          </div>
                          <div class="widget-list-date">
                            2016-04-21
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/08/19/devcore-2015-recruit/">
                          <div class="widget-list-title">
                            [已結束] DEVCORE 徵求行政出納人才
                          </div>
                          <div class="widget-list-date">
                            2015-08-19
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/07/24/the-vulnerability-of-dynamic-render-paths-in-rails/">
                          <div class="widget-list-title">
                            Rails 動態樣板路徑的風險
                          </div>
                          <div class="widget-list-date">
                            2015-07-24
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/01/30/cookie-security-insight-acer/">
                          <div class="widget-list-title">
                            談 Cookie 認證安全－以宏碁雲端售票為例
                          </div>
                          <div class="widget-list-date">
                            2015-01-30
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/01/09/information-security-insight-kham/">
                          <div class="widget-list-title">
                            從寬宏售票談資安
                          </div>
                          <div class="widget-list-date">
                            2015-01-09
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/10/13/android-webview-left-shortcuts-for-hacker/">
                          <div class="widget-list-title">
                            Android WebView 為你的使用者打開了漏洞之門你知道嗎？
                          </div>
                          <div class="widget-list-date">
                            2014-10-13
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/09/30/shellshock-CVE-2014-6271/">
                          <div class="widget-list-title">
                            Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌
                          </div>
                          <div class="widget-list-date">
                            2014-09-30
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/09/24/security-of-ip-camera-and-nvr/">
                          <div class="widget-list-title">
                            網路攝影機、DVR、NVR 的資安議題 - 你知道我在看你嗎？
                          </div>
                          <div class="widget-list-date">
                            2014-09-24
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/">
                          <div class="widget-list-title">
                            被遺忘的資訊洩漏－重點回顧
                          </div>
                          <div class="widget-list-date">
                            2014-08-26
                          </div>
                        </a>
                      </li>
  

                    </ul>
                  </div>
                  <!--最新文章 end--><!--文章標籤-->
                  <div class="widget">
                    <div class="widget-title">
                      文章標籤
                    </div>
                    <ul class="widget-tags">
                      
                                        
                    
                      <li><a href="/blog/tag/公告/">公告 <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/JavaScript/">JavaScript <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/Hijack/">Hijack <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/HTTP Header/">HTTP Header <span class="count">(6)</span></a></li>
                    
                      <li><a href="/blog/tag/Defense/">Defense <span class="count">(9)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSource/">OpenSource <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Vulnerability/">Vulnerability <span class="count">(8)</span></a></li>
                    
                      <li><a href="/blog/tag/Mail/">Mail <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Phishing/">Phishing <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/XSS/">XSS <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSSL/">OpenSSL <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/CVE/">CVE <span class="count">(8)</span></a></li>
                    
                      <li><a href="/blog/tag/WordPress/">WordPress <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Brute-force/">Brute-force <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/PHP/">PHP <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/LFI/">LFI <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/DNS/">DNS <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Reconnaissance/">Reconnaissance <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/SVN/">SVN <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IM/">IM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Facebook/">Facebook <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/Session/">Session <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Cookie/">Cookie <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Statistics/">Statistics <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/WAF/">WAF <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Proxy/">Proxy <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Mobile/">Mobile <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Android/">Android <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/iOS/">iOS <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/SSL/">SSL <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/MITM/">MITM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/infoleak/">infoleak <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IoT/">IoT <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IP Camera/">IP Camera <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Shell/">Shell <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/WebView/">WebView <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/UXSS/">UXSS <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Cashflow/">Cashflow <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Vulreport/">Vulreport <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Rails/">Rails <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/RCE/">RCE <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/IDOR/">IDOR <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/徵才/">徵才 <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/BugBounty/">BugBounty <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Backdoor/">Backdoor <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Pentest/">Pentest <span class="count">(2)</span></a></li>
                    
                  
                

                    </ul>
                  </div>
                  <!--文章標籤 end-->
                </div>
              </div>
              <div id="fb-root"></div>
              <script>(function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                fjs.parentNode.insertBefore(js, fjs);
              }(document, 'script', 'facebook-jssdk'));</script>
            </div>
          </div>


        </div>
        <div class="footer">
          <div class="footer-inner">
            <div class="footer-top">
              <div class="footer-services">
                <a class="footer-service col" href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="footer-service-icon service-icon service-icon-penetration-test"></div>
                  <div class="footer-service-title">
                    滲透測試服務
                  </div>
                </a><a class="footer-service col" href="/services/security-training" title="資安教育訓練 Security Training">
                  <div class="footer-service-icon service-icon service-icon-security-training"></div>
                  <div class="footer-service-title">
                    資安教育訓練
                  </div>
                </a><a class="footer-service col" href="/services/incident-response" title="資安事件處理 Incident Response">
                  <div class="footer-service-icon service-icon service-icon-incident-response"></div>
                  <div class="footer-service-title">
                    資安事件處理
                  </div>
                </a><a class="footer-service col" href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                  <div class="footer-service-icon service-icon service-icon-security-consulting"></div>
                  <div class="footer-service-title">
                    資安顧問服務
                  </div>
                </a>
              </div>
            </div>
            <div class="footer-bottom">
              <div class="footer-links-group">
                <ul class="footer-links">
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                  </li>
                  <li>
                    <a href="/blog/" title="部落格 Blog">Blog</a>
                  </li>
                  <li>
                    <a href="/about/" title="關於 About">About</a>
                  </li>
                  <li>
                    <a href="/contact/" title="聯絡 Contact">Contact</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">Security Seal</a>
                  </li>
                  <li>
                    <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="https://www.facebook.com/D3VC0RE" title="DEVCORE Facebook 粉絲團" target="_blank">Facebook</a>
                  </li>
                  <li>
                    <a href="https://plus.google.com/118439315679478709768/posts" title="DEVCORE Google+ 專頁" target="_blank">Google+</a>
                  </li>
                  <li>
                    <a href="https://twitter.com/d3vc0r3" title="DEVCORE Twitter" target="_blank">Twitter</a>
                  </li>
                </ul>
              </div>
              <ul class="footer-info">
                <li>
                  電話：02-2718-0156
                </li>
                <li>
                  Email：contact [at] devco.re
                </li>
                <li>
                  統編：53955237
                </li>
              </ul>
              <ul class="footer-info">
                <li>
                  地址：10487 台北市中山區復興北路 168 號 10 樓
                </li>
                <li>
                  ©2016 DEVCORE 戴夫寇爾
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="off-canvas-mask"></div>
      </div>
    </div>
    <script src="/assets/themes/devcore/javascripts/vender/modernizr.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/off-canvas.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/all.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/gcse.js" type="text/javascript"></script>
    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30830800-1']);
  _gaq.push(['_trackPageview', location.pathname + location.search + location.hash]);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




    <!-- Google Tag Manager -->
    <noscript>
      <iframe src="//www.googletagmanager.com/ns.html?id=GTM-K5B8NW" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-K5B8NW');
    </script>
    <!-- End Google Tag Manager -->
  </body>
</html>

