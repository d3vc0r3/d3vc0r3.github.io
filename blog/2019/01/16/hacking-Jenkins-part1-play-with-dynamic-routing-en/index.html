

<!DOCTYPE html>
<html class="no-js sub-menu">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <link href="/images/favicon.png" rel="icon" size="32x32">
    <!-- web fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes"><!-- ios -->
    <meta name="mobile-web-app-capable" content="yes"><!-- android -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <title>Hacking Jenkins Part 1 - Play with Dynamic Routing (EN) | DEVCORE</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/modernizr-custom.js"></script>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/site.js"></script>
    <meta name="description" property="og:description" content="This article is mainly about a brief security review on Jenkins in the last year. During this review, we found 5 vulnerabilities including: CVE-2018-1999002(Arbitrary file read vulnerability), CVE-2018-1000600(CSRF and missing permission checks in GitHub Plugin), CVE-2018-1999046(Unauthorized users could access agent logs), CVE-2018-1000861(Code execution through crafted URLs), CVE-2019-pending(Sandbox Bypass in Script Security and Pipeline Plugins)" />
    <meta name="keywords" content="Advisory, CVE-2018-1999002, CVE-2018-1000600, CVE-2018-1999046, CVE-2018-1000861" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="Hacking Jenkins Part 1 - Play with Dynamic Routing (EN) | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://devco.re/assets/img/blog/20190116/cover.jpg" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="Hacking Jenkins Part 1 - Play with Dynamic Routing (EN) | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="This article is mainly about a brief security review on Jenkins in the last year. During this review, we found 5 vulnerabilities including: CVE-2018-1999002(Arbitrary file read vulnerability), CVE-2018-1000600(CSRF and missing permission checks in GitHub Plugin), CVE-2018-1999046(Unauthorized users could access agent logs), CVE-2018-1000861(Code execution through crafted URLs), CVE-2019-pending(Sandbox Bypass in Script Security and Pipeline Plugins)">
    <meta name="twitter:creator" content="d3vc0r3">
    <meta name="twitter:image:src" content="https://devco.re/assets/img/blog/20190116/cover.jpg">
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />
    <meta property="fb:admins" content="120968921404653" />

    <link rel="canonical" href="https://devco.re/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="https://devco.re/rss">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GHXJ9PS005"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GHXJ9PS005');
    </script>
    <link rel="stylesheet" href="/fonts/inter.css" />
    <link rel="stylesheet" href="/css/highlighter.css" />
    <!-- <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script> -->
</head>
<body class="en">
    <!-- 導覽列 start -->
    <header class="header">
<div class="container">
    <!-- logo start -->
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
    </div>
    <!-- logo end -->
    <!-- 主選單 start -->
    <nav class="nav">
        <ul class="menu">
            <li class="dropdown">
                <div class="menuLable">
                    <span>Services<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/services/red-team/">
                            <div class="item">

                                <h2>
                                    <i class="icon menu service-red-team"></i>
                                    Red Team Assessment
                                </h2>
                                <p class="two-line">
                                    Simulation of real-world attacks to identify vulnerabilities and achieve objectives without disrupting business operations.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/penetration-test/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-penetration-test"></i>
                                    Penetration Testing
                                </h2>
                                <p class="two-line">
                                    Infiltration of designated enterprise systems to uncover potential vulnerabilities and assess the risks or damages.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-consulting/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-consulting"></i>
                                    Security Consulting
                                </h2>
                                <p class="two-line">
                                    Consultation of resource distribution and long-term defensive strategies from the attacker’s perspective.
                                </p>
                            </div>
                        </a>
                        <a href="/en/services/security-training/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu service-security-training"></i>
                                    Security Training
                                </h2>
                                <p class="two-line">
                                    Instruction on defending and preventing incidents with the hacker mindset, also the response procedures and analysis of attacks when incidents happen.
                                </p>
                            </div>
                        </a>
                        <a href="https://training.devco.re/" target="_blank">
                            <div class="item">
                                <h2>
                                    <i class="icon menu offsec"></i>
                                    OffSec Advanced Training <i class="icon open-in-new"></i>
                                </h2>
                                <p class="two-line">
                                    Structured in-person (OffSec Live Training) and online training, featuring up-to-date offensive security skills with OffSec certification and resources.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>

            <li class="dropdown">
                <div class="menuLable">
                    <span>Research<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/research/overview/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu search-circle"></i>
                                    Overview
                                </h2>
                                <p class="two-line">
                                    Research of updated cybersecurity techniques and trends, assess the security of products, and evolve the red team with broad experience.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/awards/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu badge-check"></i>
                                    Competitions and Awards
                                </h2>
                                <p class="two-line">
                                    Awards from international cybersecurity competitions.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/bug-bounty/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu puzzle"></i>
                                    Enterprise Vulnerability Reports
                                </h2>
                                <p class="two-line">
                                    Research of the risk of enterprise systems, identification of potential weaknesses, and report to vendors.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/talks/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu globe"></i>
                                    International Conferences
                                </h2>
                                <p class="two-line">
                                    Sharing vulnerability research and security knowledge at international cybersecurity conferences.
                                </p>
                            </div>
                        </a>
                        <a href="/en/research/cve/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu view-list"></i>
                                    CVE List
                                </h2>
                                <p class="two-line">
                                    Discovery of critical vulnerabilities in leading international products and services.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>


            </li>

            <li class="dropdown">
                <div class="menuLable" href="#">
                    <span>Company<i class="icon arrow_down"></i></span>

                    <div class="menuItem">
                        <a href="/en/company/about/">
                        <div class="item">
                            <h2>
                                <i class="icon menu company"></i>
                                Company Overview
                            </h2>
                            <p>
                                Founded by a world-class white hat hacker team, providing cybersecurity services including Red Team Assessment,  Penetration Testing, Security Consulting, and Security Training.
                            </p>
                        </div>
                        </a>
                        <a href="/en/company/our-team/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu team"></i>
                                    Team Members
                                </h2>
                                <p class="two-line">
                                    Composed of cybersecurity experts with the hacker mindset, exploring innovative exploitation techniques with high morality and extreme caution.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/history/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu milestone"></i>
                                    Achievements
                                </h2>
                                <p class="two-line">
                                    DEVCORE has been invited to leading cybersecurity conferences, has uncovered hundreds of critical product vulnerabilities, and helped enterprises improve their defensive capabilities.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/csr/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu heart"></i>
                                    Corporate Social Responsibility
                                </h2>
                                <p class="two-line">
                                    We provide diverse internship channels and programs to nurture the next generation and promote cybersecurity awareness.
                                </p>
                            </div>
                        </a>
                        <a href="/en/company/jobs/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu briefcase"></i>
                                    Job Opportunities
                                </h2>
                                <p class="two-line">
                                    Join us to secure the world and improve the cybersecurity industry together.
                                </p>
                            </div>
                        </a>
                        <a href="https://conf.devco.re/" target="_blank">
                            <div class="item">
                                <h2>
                                    <i class="icon menu conference"></i>
                                    DEVCORE CONFERENCE <i class="icon open-in-new"></i>
                                </h2>
                                <p class="two-line">
                                    DEVCORE’s annual technical conference focused on offensive security research, red team insights, and novel attack vectors from real-world operations.
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li class="dropdown">
                <div class="menuLable">
                    <span>News<i class="icon arrow_down"></i></span>
                    <div class="menuItem">
                        <a href="/en/blog/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu newspaper"></i>
                                    BLOG
                                </h2>
                                <p>
                                    Latest news
                                </p>
                            </div>
                        </a>
                        <a href="/en/media-kit/">
                            <div class="item">
                                <h2>
                                    <i class="icon menu download"></i>
                                    Media Resources
                                </h2>
                                <p>
                                    Media Kit, Logo and Usage Guideline
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li>
                <a class="menuLable" href="/en/search/">Search</a>
            </li>
            <li>
                <a class="menuLable" href="/en/contact/">Contact</a>
            </li>
        </ul>
    </nav>
    <!-- 主選單 end -->
</div>


<!-- 手機板選單  start-->
<nav class="nav-m" id="menu-m">
    <ul class="menu">
        <li>
            <div class="menuLable">
                <span>Services</span>
                <div class="menuItem">
                    <a href="/en/services/red-team/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-red-team"></i>
                                Red Team Assessment
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/penetration-test/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-penetration-test"></i>
                                Penetration Testing
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-consulting/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-consulting"></i>
                                Security Consulting
                            </h2>
                        </div>
                    </a>
                    <a href="/en/services/security-training/" class="fullwidth">
                        <div class="item">
                            <h2>
                                <i class="icon service-security-training"></i>
                                Security Training
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>Research</span>
                <div class="menuItem">
                    <a href="/en/research/overview/" class="fullwidth">
                        <div class="item">
                            <h2>Overview</h2>
                        </div>
                    </a>
                    <a href="/en/research/awards/">
                        <div class="item">
                            <h2>Competitions and Awards</h2>
                        </div>
                    </a>
                    <a href="/en/research/bug-bounty/">
                        <div class="item">
                            <h2>Enterprise Vulnerability Reports</h2>
                        </div>
                    </a>
                    <a href="/en/research/talks/">
                        <div class="item">
                            <h2>International Conferences</h2>
                        </div>
                    </a>
                    <a href="/en/research/cve/">
                        <div class="item">
                            <h2>CVE List</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>

        <li>
            <div class="menuLable">
                <span>Company</span>
                <div class="menuItem">
                    <a href="/en/company/about/" class="fullwidth">
                        <div class="item">
                            <h2>Company Overview</h2>
                        </div>
                    </a>
                    <a href="/en/company/our-team/">
                        <div class="item">
                            <h2>Team Members</h2>
                        </div>
                    </a>
                    <a href="/en/company/history/">
                        <div class="item">
                            <h2>Achievements</h2>
                        </div>
                    </a>
                    <a href="/en/company/csr/">
                        <div class="item">
                            <h2>Corporate Social Responsibility</h2>
                        </div>
                    </a>
                    <a href="/en/company/jobs/">
                        <div class="item">
                            <h2>Job Opportunities</h2>
                        </div>
                    </a>
                    <a href="https://conf.devco.re/" target="_blank">
                        <div class="item">
                            <h2>DEVCORE CONFERENCE</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span>News</span>
                <div class="menuItem">
                    <a href="/en/blog/">
                        <div class="item">
                            <h2>BLOG</h2>
                        </div>
                    </a>
                    <a href="/en/media-kit/">
                        <div class="item">
                            <h2>Media Resources</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <div class="menuItem">
                    <a href="/en/search/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon search"></i>
                                Search
                            </h2>
                        </div>
                    </a>
                    <a href="/en/contact/" class="fullwidth">
                        <div class="item">
                            <h2 class="center">
                                <i class="icon chat-alt"></i>
                                Contact
                            </h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
        <li>
            <div class="menuLable">
                <span><i class="icon translate"></i>Language</span>
                <div class="menuItem">
                    <a href="/">
                    <div class="item">
                        <h2>中文</h2>
                    </div>
                    </a>
                    <a href="/en">
                        <div class="item">
                            <h2>English</h2>
                        </div>
                    </a>
                </div>
            </div>
        </li>
    </ul>
</nav>
<!-- 手機板選單  end-->
    </header>
    <!-- 導覽列 end -->

    <!-- tab 選單 start -->
    <div class="sub-nav">
        <div class="container">
            <h1>BLOG</h1>
            <ul class="tab">
                <li>
                    <a href="/en/blog/">All Articles</a>
                </li>
                <li>
                    <a href="/en/blog/category/Tech%20Editorials/">Tech Editorials</a>
                </li>
                <li>
                    <a href="/en/media-kit/">Media Resources</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- tab 選單 end -->
    
    <div class="main">
        <!-- 文章外層layer -->
        <section class="narrow">
            <!-- 文章 start -->
            <article class="article_body">
                <div class="content">
                    <a class="category" href="/en/blog/category/Tech Editorials">Tech Editorials</a>
                    <span class="tag">

                      <a href="/en/blog/tag/Advisory/">#Advisory</a> <a href="/en/blog/tag/CVE/">#CVE</a> <a href="/en/blog/tag/infoleak/">#infoleak</a> <a href="/en/blog/tag/SSRF/">#SSRF</a> 
                    </span>
                    <h1>
                        Hacking Jenkins Part 1 - Play with Dynamic Routing (EN)
                    </h1>
                    
                    
                    <div class="author_detail">
                        <span class="avatar">
                            <a href="/en/blog/author/orange">
                                <div class="circle">
                                    <i class="user" style="background-image: url('/assets/img/avatar/orig/orange.png');" ></i>
                                </div>
                            </a>
                        </span>
                        <span class="author"><a href="/en/blog/author/orange">Orange Tsai</a></span>
                        <span class="date">2019-01-16</span>
                    </div>
                    
                    
                    <div class="article_img">
                        <img src="https://devco.re/assets/img/blog/20190116/cover.jpg"/>
                    </div>
                    

                    <hr>

                    <!-- 文章內容 -->
                    <div class="article_content">
<p><a href="/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing-en/">English Version</a>
<a href="/blog/2019/01/16/hacking-Jenkins-part1-play-with-dynamic-routing/">中文版本</a></p>

<p>In software engineering, the <a href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a> and <a href="https://en.wikipedia.org/wiki/Continuous_delivery">Continuous Delivery</a> is a best practice for developers to reduce routine works. In the CI/CD, the most well-known tool is Jenkins. Due to its ease of use, awesome Pipeline system and integration of Container, Jenkins is also the most widely used CI/CD application in the world. According to the <a href="https://snyk.io/blog/jvm-ecosystem-report-2018-tools">JVM Ecosystem Report</a> by Snyk in 2018, Jenkins held about 60% market share on the survey of CI/CD server.</p>

<p>For Red Teamers, Jenkins is also the battlefield that every hacker would like to control. If someone takes control of the Jenkins server, he can gain amounts of source code and credential, or even control the Jenkins node! In our DEVCORE Red Team cases, there are also several cases that the whole corporation is compromised from simply a Jenkins server as our entry point!</p>

<p>This article is mainly about a brief security review on Jenkins in the last year. During this review, we found 5 vulnerabilities including:</p>

<ul>
  <li><a href="https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914">CVE-2018-1999002 - Arbitrary file read vulnerability</a></li>
  <li><a href="https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915">CVE-2018-1000600 - CSRF and missing permission checks in GitHub Plugin</a></li>
  <li><a href="https://jenkins.io/security/advisory/2018-08-15/#SECURITY-1071">CVE-2018-1999046 - Unauthorized users could access agent logs</a></li>
  <li><a href="https://jenkins.io/security/advisory/2018-12-05/#SECURITY-595">CVE-2018-1000861 - Code execution through crafted URLs</a></li>
  <li><a href="https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08">CVE-2019-1003000 - Sandbox Bypass in Script Security and Pipeline Plugins</a></li>
  <li><a href="https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08">CVE-2019-1003001 - Sandbox Bypass in Script Security and Pipeline Plugins</a></li>
  <li><a href="https://jenkins.io/security/advisory/2019-01-08/#jenkins-security-advisory-2019-01-08">CVE-2019-1003002 - Sandbox Bypass in Script Security and Pipeline Plugins</a></li>
</ul>

<p>Among them, the more discussed one is the vulnerability CVE-2018-1999002. This is an arbitrary file read vulnerability through an unusual attack vector! Tencent YunDing security lab has written a <a href="https://cloud.tencent.com/developer/article/1165414">detailed advisory</a> about that, and also demonstrated how to exploit this vulnerability from arbitrary file reading to RCE on a real Jenkins site which found from <a href="https://www.shodan.io/search?query=jenkins">Shodan</a>!</p>

<p>However, we are not going to discuss that in this article. Instead, this post is about another vulnerability found while digging into Stapler framework in order to find a way to bypass the least privilege requirement <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=True</code> of CVE-2018-1999002! If you merely take a look at the advisory description, you may be curious – Is it reality to gain code execution with just a crafted URL?</p>

<p>From my own perspective, this vulnerability is just an Access Control List(ACL) bypass, but because this is a problem of the architecture rather than a single program, there are various ways to exploit this bug! In order to pay off the design debt, Jenkins team also takes lots of efforts (patches in <a href="https://github.com/jenkinsci/jenkins/commit/47f38d714c99e1841fb737ad1005618eb26ed852">Jenkins side</a> and <a href="https://github.com/stapler/stapler/commit/28e8eba822a0df9dcd64d20eb63d8ab5f6ee2980">Stapler side</a>) to fix that. The patch not only introduces a new routing blacklist and whitelist but also extends the original <a href="https://wiki.jenkins.io/display/JENKINS/Plugins+affected+by+the+SECURITY-595+fix">Service Provider Interface (SPI)</a> to protect Jenkins’ routing. Now let’s figure out why Jenkins need to make such a huge code modification!</p>

<p><br /></p>

<h2 id="review-scope">Review Scope</h2>
<hr />

<p>This is not a complete code review (An overall security review takes lots of time…), so this review just aims at high impact bugs. The review scope includes:</p>

<ul>
  <li>Jenkins Core</li>
  <li>Stapler Web Framework</li>
  <li>Suggested Plugins</li>
</ul>

<p>During the installation, Jenkins asks whether you want to install suggested plugins such as Git, GitHub, SVN and Pipeline. Basically, most people choose yes, or they will get an inconvenient and hard-to-use Jenkins.</p>

<p><img src="/assets/img/blog/20190116/1.png" alt="" /></p>

<p><img src="/assets/img/blog/20190116/2.png" alt="" /></p>

<p><br /></p>

<h2 id="privilege-levels">Privilege Levels</h2>
<hr />

<p>Because the vulnerability is an ACL bypass, we need to introduce the privilege level in Jenkins first! In Jenkins, there are different kinds of ACL roles, Jenkins even has a specialized plugin <a href="https://plugins.jenkins.io/matrix-auth">Matrix Authorization Strategy Plugin</a>(also in the suggested plugin list) to configure the detailed permission per project. From an attacker’s view, we roughly classify the ACL into 3 types:</p>

<h3 id="1-full-access">1. Full Access</h3>

<p>You can fully control Jenkins. Once the attacker gets this permission, he can execute arbitrary Groovy code via <a href="http://jenkins.local/script">Script Console</a>!</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">print</span> <span class="s2">"uname -a"</span><span class="o">.</span><span class="na">execute</span><span class="o">().</span><span class="na">text</span>
</code></pre></div></div>

<p>This is the most hacker-friendly scenario, but it’s hard to see this configuration publicly now due to the increase of security awareness and lots of bots scanning all the IPv4.</p>

<h3 id="2-read-only-mode">2. Read-only Mode</h3>

<p>This can be enabled from the <a href="http://jenkins.local/configureSecurity">Configure Global Security</a> and check the radio box:</p>
<blockquote>
  <p>Allow anonymous read access</p>
</blockquote>

<p>Under this mode, all contents are visible and readable. Such as agent logs and job/node information. For attackers, the best benefit of this mode is the accessibility of a bunch of private source codes! However, the attacker cannot do anything further or execute Groovy scripts!</p>

<p>Although this is not the default setting, for DevOps, they may still open this option for automations. According to a little survey on <a href="https://www.shodan.io/search?query=jenkins">Shodan</a>, there are about 12% servers enabled this mode! We will call this mode <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=True</code> in the following sections.</p>

<h3 id="3-authenticated-mode">3. Authenticated Mode</h3>

<p>This is the default mode. Without a valid credential, you can’t see any information! We will use <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=False</code> to call this mode in following sections.</p>

<p><br /></p>

<h2 id="vulnerability-analysis">Vulnerability Analysis</h2>

<p>To explain this vulnerability, we will start with Jenkins’ <a href="https://jenkins.io/doc/developer/handling-requests/routing/">Dynamic Routing</a>. In order to provide developers more flexibilities, Jenkins uses a naming convention to resolve the URL and invoke the method dynamically. Jenkins first tokenizes all the URL by <code class="language-plaintext highlighter-rouge">/</code>, and begins from <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java">jenkins.model.Jenkins</a> as the entry point to match the token one by one. If the token matches (1)public class member or (2)public class method correspond to following naming conventions, Jenkins invokes recursively!</p>

<blockquote>
  <ol>
    <li>get&lt;token&gt;()</li>
    <li>get&lt;token&gt;(String)</li>
    <li>get&lt;token&gt;(Int)</li>
    <li>get&lt;token&gt;(Long)</li>
    <li>get&lt;token&gt;(StaplerRequest)</li>
    <li>getDynamic(String, …)</li>
    <li>doDynamic(…)</li>
    <li>do&lt;token&gt;(…)</li>
    <li>js&lt;token&gt;(…)</li>
    <li>Class method with @WebMethod annotation</li>
    <li>Class method with @JavaScriptMethod annotation</li>
  </ol>
</blockquote>

<p>It looks like Jenkins provides developers a lot of flexibility. However, too much freedom is not always a good thing. There are two problems based on this naming convention!</p>

<h3 id="1-everything-is-the-subclass-of-javalangobject">1. Everything is the Subclass of <code class="language-plaintext highlighter-rouge">java.lang.Object</code></h3>

<p>In Java, everything is a subclass of <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html">java.lang.Object</a>. Therefore, all objects must exist the method - <code class="language-plaintext highlighter-rouge">getClass()</code>, and the name of <code class="language-plaintext highlighter-rouge">getClass()</code> just matches the naming convention rule <code class="language-plaintext highlighter-rouge">#1</code>! So the method <code class="language-plaintext highlighter-rouge">getClass()</code> can be also invoked during Jenkins dynamic routing!</p>

<h3 id="2-whitelist-bypass">2. Whitelist Bypass</h3>

<p>As mentioned before, the biggest difference between <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=True</code> and <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=False</code> is, if the flag set to <code class="language-plaintext highlighter-rouge">False</code>, the entry point will do one more check in <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java#L4682">jenkins.model.Jenkins#getTarget()</a>. The check is a white-list based URL prefix check and here is the list:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ImmutableSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="no">ALWAYS_READABLE_PATHS</span> <span class="o">=</span> <span class="nc">ImmutableSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
    <span class="s">"/login"</span><span class="o">,</span>
    <span class="s">"/logout"</span><span class="o">,</span>
    <span class="s">"/accessDenied"</span><span class="o">,</span>
    <span class="s">"/adjuncts/"</span><span class="o">,</span>
    <span class="s">"/error"</span><span class="o">,</span>
    <span class="s">"/oops"</span><span class="o">,</span>
    <span class="s">"/signup"</span><span class="o">,</span>
    <span class="s">"/tcpSlaveAgentListener"</span><span class="o">,</span>
    <span class="s">"/federatedLoginService/"</span><span class="o">,</span>
    <span class="s">"/securityRealm"</span><span class="o">,</span>
    <span class="s">"/instance-identity"</span>
<span class="o">);</span>
</code></pre></div></div>

<p>That means you are restricted to those entrances, but if you can find a cross reference from the white-list entrance jump to other objects, you can still bypass this URL prefix check! It seems a little bit hard to understand. Let’s give a simple example to demonstrate the dynamic routing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://jenkin.local/adjuncts/whatever/class/classLoader/resource/index.jsp/content
</code></pre></div></div>

<p>The above URL will invoke following methods in sequence!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jenkins</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">Jenkins</span><span class="o">.</span><span class="na">getAdjuncts</span><span class="o">(</span><span class="s">"whatever"</span><span class="o">)</span> 
<span class="o">.</span><span class="na">getClass</span><span class="o">()</span>
<span class="o">.</span><span class="na">getClassLoader</span><span class="o">()</span>
<span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">"index.jsp"</span><span class="o">)</span>
<span class="o">.</span><span class="na">getContent</span><span class="o">()</span>
</code></pre></div></div>

<p>This execution chain seems smooth, but sadly, it can not retrieve the result. Therefore, this is not a potential risk, but it’s still a good case to understand the mechanism!</p>

<p>Once we realize the principle, the remaining part is like solving a maze. <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/jenkins/model/Jenkins.java">jenkins.model.Jenkins</a> is the entry point. Every member in this object can references to a new object, so our work is to chain the object layer by layer till the exit door, that is, the dangerous method invocation!</p>

<p>By the way, the saddest thing is that this vulnerability cannot invoke the SETTER, otherwise this would definitely be another interesting classLoader manipulation bug just like <a href="https://cwiki.apache.org/confluence/display/WW/S2-020">Struts2 RCE</a> and <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1622">Spring Framework RCE</a>!!</p>

<p><br /></p>

<h2 id="how-to-exploit">How to Exploit?</h2>
<hr />

<p>How to exploit? In brief, the whole thing this bug can achieve is to use cross reference objects to bypass ACL policy. To leverage it, we need to find a proper gadget so that we can invoke the object we prefer in this object-forest more conveniently! Here we choose the gadget:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/securityRealm/user/[username]/descriptorByName/[descriptor_name]/
</code></pre></div></div>

<p>The gadget will invoke following methods sequencely.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jenkins</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">Jenkins</span><span class="o">.</span><span class="na">getSecurityRealm</span><span class="o">()</span>
<span class="o">.</span><span class="na">getUser</span><span class="o">([</span><span class="n">username</span><span class="o">])</span>
<span class="o">.</span><span class="na">getDescriptorByName</span><span class="o">([</span><span class="n">descriptor_name</span><span class="o">])</span>
</code></pre></div></div>

<p>In Jenkins, all configurable objects will extend the type <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/Descriptor.java">hudson.model.Descriptor</a>. And, any class who extends the <code class="language-plaintext highlighter-rouge">Descriptor</code> type is accessible by method <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/DescriptorByNameOwner.java#L51">hudson.model.DescriptorByNameOwner#getDescriptorByName(String)</a>. In general, there are totally about 500 class types can be accessed! But due to the architecture of Jenkins. Most developers will check the permission before the dangerous action again. So even we can find a object reference to the <a href="http://jenkins.local/script">Script Console</a>, without the permission <code class="language-plaintext highlighter-rouge">Jenkins.RUN_SCRIPTS</code>, we still can’t do anything :(</p>

<p>Even so, this vulnerability can still be considered as a stepping stone to bypass the first ACL restriction and to chain other bugs. We will show 3 vulnerability-chains as our case study! (Although we just show 3 cases, there are more than 3! If you are intersted, it’s highly recommended to find others by yourself :P )</p>

<p>P.S. It should be noted that in the method <code class="language-plaintext highlighter-rouge">getUser([username])</code>, it will invoke <code class="language-plaintext highlighter-rouge">getOrCreateById(...)</code> with <code class="language-plaintext highlighter-rouge">create</code> flag set to <code class="language-plaintext highlighter-rouge">True</code>. This result to the creation of a temporary user in memory(which will be listed in the user list but can’t sign in). Although it’s harmless, it is still recognized as a security issue in <a href="https://jenkins.io/security/advisory/2018-10-10/">SECURITY-1128</a>.</p>

<p><br /></p>

<h3 id="1-pre-auth-user-information-leakage">1. Pre-auth User Information Leakage</h3>

<p>While testing Jenkins, it’s a common scenario that you want to perform a brute-force attack but you don’t know which account you can try(a valid credential can read the source at least so it’s worth to be the first attempt).</p>

<p>In this situation, this vulnerability is useful!
Due to the lack of permission check on search functionality. By modifying the <code class="language-plaintext highlighter-rouge">keyword</code> from a to z, an attacker can list all users on Jenkins!</p>

<h4 id="poc">PoC:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://jenkins.local/securityRealm/user/admin/search/index?q=[keyword]
</code></pre></div></div>

<p><img src="/assets/img/blog/20190116/3.png" alt="" /></p>

<p>Also, this vulnerability can be also chained with <a href="https://jenkins.io/security/advisory/2017-10-11/#user-remote-api-disclosed-users-email-addresses">SECURITY-514</a> which reported by <code class="language-plaintext highlighter-rouge">Ananthapadmanabhan S R</code> to leak user’s email address! Such as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://jenkins.local/securityRealm/user/admin/api/xml
</code></pre></div></div>

<p><br /></p>

<h3 id="2-chained-with-cve-2018-1000600-to-a-pre-auth-fully-responded-ssrf">2. Chained with CVE-2018-1000600 to a Pre-auth Fully-responded SSRF</h3>

<p>The next bug is <a href="https://jenkins.io/security/advisory/2018-06-25/#SECURITY-915">CVE-2018-1000600</a>, this bug is reported by <a href="https://twitter.com/orange_8361">Orange Tsai</a>(Yes, it’s me :P). About this vulnerability, the official description is:</p>

<blockquote>
  <p>CSRF vulnerability and missing permission checks in GitHub Plugin allowed capturing credentials</p>
</blockquote>

<p>It can extract any stored credentials with known credentials ID in Jenkins. But the credentials ID is a random UUID if there is no user-supplied value provided. So it seems impossible to exploit this?(Or if someone know how to obtain credentials ID, please tell me!)</p>

<p>Although it can’t extract any credentials without known credentials ID, there is still another attack primitive - a fully-response SSRF! We all know how hard it is to exploit a Blind SSRF, so that’s why a fully-responded SSRF is so valuable!</p>

<h4 id="poc-1">PoC:</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://jenkins.local/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword
?apiUrl=http://169.254.169.254/%23
&amp;login=orange
&amp;password=tsai
</code></pre></div></div>

<p><img src="/assets/img/blog/20190116/4.png" alt="" /></p>

<p><br /></p>

<h3 id="3-pre-auth-remote-code-execution">3. Pre-auth Remote Code Execution</h3>

<blockquote>
  <p>PLEASE DON’T BULLSHIT, WHERE IS THE RCE!!!</p>
</blockquote>

<p>In order to maximize the impact, I also find an <strong>INTERESTING</strong> remote code execution can be chained with this vulnerability to a well-deserved pre-auth RCE! But it’s still on the responsible disclosure process. Please wait and see the Part 2! (Will be published on February 19th :P)</p>

<p><br /></p>

<h2 id="todo">TODO</h2>
<hr />

<p>Here is my todo list which can make this vulnerability more perfect. If you find any of them please tell me, really appreciate it :P</p>

<ul>
  <li>Get the <code class="language-plaintext highlighter-rouge">Plugin</code> object reference under <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=False</code>. If this can be done, it can bypass the ACL restriction of <a href="https://jenkins.io/security/advisory/2018-07-18/#SECURITY-914">CVE-2018-1999002</a> and <a href="https://jenkins.io/security/advisory/2018-02-14/#SECURITY-705">CVE-2018-6356</a> to a indeed pre-auth arbitrary file reading!</li>
  <li>Find another gadget to invoke the method <code class="language-plaintext highlighter-rouge">getDescriptorByName(String)</code> under <code class="language-plaintext highlighter-rouge">ANONYMOUS_READ=False</code>. In order to fix <a href="https://jenkins.io/security/advisory/2018-08-15/#SECURITY-672">SECURITY-672</a>, Jenkins applies a <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java#L1026">check</a> on <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/User.java">hudson.model.User</a> to ensure the least privilege <code class="language-plaintext highlighter-rouge">Jenkins.READ</code>. So the original gadget will fail after Jenkins version 2.138.</li>
</ul>

<p><br /></p>

<h2 id="acknowledgement">Acknowledgement</h2>
<hr />

<p>Thanks Jenkins Security team especially Daniel Beck for the coordination and bug fixing! Here is the brief timeline:</p>

<ul>
  <li>May 30, 2018 - Report vulnerabilities to Jenkins</li>
  <li>Jun 15, 2018 - Jenkins patched the bug and assigned CVE-2018-1000600</li>
  <li>Jul 18, 2018 - Jenkins patched the bug and assigned CVE-2018-1999002</li>
  <li>Aug 15, 2018 - Jenkins patched the bug and assigned CVE-2018-1999046</li>
  <li>Dec 05, 2018 - Jenkins patched the bug and assigned CVE-2018-1000861</li>
  <li>Dec 20, 2018 - Report Groovy vulnerability to Jenkins</li>
  <li>Jan 08, 2019 - Jenkins patched Groovy vulnerability and assigned CVE-2019-1003000, CVE-2019-1003001 and CVE-2019-1003002</li>
</ul>


                    </div>
                    <!-- 文章內容 -->
                </div>
            </article>
            <!-- 文章 end -->
        </section>
        
         <!-- 作者 -->
        <section>
            <div class="container article_footer">
                <div class="author_info">
                    <a href="/en/blog/author/orange">
                        <div class="circle" style="background-image: url(/assets/img/avatar/orig/orange.png);"></div>
                    </a>
                    <div>
                        <a class="author" href="/en/blog/author/orange">
                            <h3>Orange Tsai</h3>
                        </a>
                        <span>Principal Security Researcher</span>
                        <p>
                            I am Orange : )
                        </p>
                    </div>
                </div>
            </div>
        </section>
        

    </div>

    <!-- footer -->
    <footer>
<div class="container footer">
    <div class="logo">
        <a href="/en/">
            <img src="/images/logo.svg"/>
        </a>
        <div class="social">
            <a href="https://www.facebook.com/D3VC0RE"><i class="icon facebook"></i></a>
            <a href="https://twitter.com/d3vc0r3"><i class="icon twitter"></i></a>
        </div>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Services</h6>
        <ul>
            <li><a href="/en/services/red-team/">Red Team Assessment</a></li>
            <li><a href="/en/services/penetration-test/">Penetration Testing</a></li>
            <li><a href="/en/services/security-consulting/">Security Consulting</a></li>
            <li><a href="/en/services/security-training/">Security Training</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Research</h6>
        <ul>
            <li><a href="/en/research/overview/">Overview</a></li>
            <li><a href="/en/research/awards/">Competitions and Awards</a></li>
            <li><a href="/en/research/bug-bounty/">Enterprise Vulnerability Reports</a></li>
            <li><a href="/en/research/talks/">International Conferences</a></li>
            <li><a href="/en/research/cve/">CVE List</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">Company</h6>
        <ul>
            <li><a href="/en/company/about/">Company Overview</a></li>
            <li><a href="/en/company/our-team/">Team Members</a></li>
            <li><a href="/en/company/history/">Achievements</a></li>
            <li><a href="/en/company/csr/">Corporate Social Responsibility</a></li>
            <li><a href="/en/company/jobs/">Job Opportunities</a></li>
            <li><a href="/en/contact/">Contact</a></li>
        </ul>
    </div>

    <div class="column">
        <h6 class="mobile_toggle">News</h6>
        <ul>
            <li><a href="/en/blog/">Blog</a></li>
            <li><a href="/en/media-kit/">Media Resources</a></li>
        </ul>
    </div>

    <!-- divider 分隔線 -->
    <div class="divider"></div>

    <div class="copyright">
        <div class="info">
            <span>© 2025 DEVCORE <b class="line-block">All rights reserved.</b></span>
            <span><a href="/en/privacy-policy/">Privacy Policy</a></span>
        </div>
        <div class="lang">
            <!-- <i class="icon translate"></i>
            <select>
                <option value="">Language</option>
                <option value="">中文</option>
                <option value="">English</option>
            </select> -->
            <span>Language :<a href="/">中文</a>|<a href="/en/">English</a></span>
        </div>
    </div>

</div>
    </footer>
</body>
</html>










