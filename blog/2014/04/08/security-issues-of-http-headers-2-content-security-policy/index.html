
<!DOCTYPE html>
<html class="no-js " lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
  <head>
    <title>
      Content-Security-Policy - HTTP Headers 的資安議題 (2) | DEVCORE 戴夫寇爾
    </title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <meta name="description" property="og:description" content="Content-Security-Policy 主要目的是用來防止 Cross-Site Scripting (XSS) 跟網頁樣式置換，本文將介紹 Content-Security-Policy 的使用方式、實際使用案例、常見誤用案例。" />
    <meta name="keywords" content="HTTP header,Defense,JavaScript,XSS" />
    <meta property="og:site_name" content="DEVCORE 戴夫寇爾" />
    <meta property="og:title" content="Content-Security-Policy - HTTP Headers 的資安議題 (2) | DEVCORE 戴夫寇爾" />
    <meta property="og:url" content="http://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy/" />
    <meta property="og:type" content="website" />
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="d3vc0r3">
    <meta name="twitter:title" content="Content-Security-Policy - HTTP Headers 的資安議題 (2) | DEVCORE 戴夫寇爾">
    <meta name="twitter:description" content="Content-Security-Policy 主要目的是用來防止 Cross-Site Scripting (XSS) 跟網頁樣式置換，本文將介紹 Content-Security-Policy 的使用方式、實際使用案例、常見誤用案例。">
    <meta name="twitter:creator" content="d3vc0r3">
    
    <meta name="twitter:domain" content="devco.re">
    <meta name="google-site-verification" content="lMNi_XT6UmeGqeYI_vLHu5PDRi_uNVfnA2NdDGS4-lM" />
    <meta name="msvalidate.01" content="119FDBB7730BE45B162515BBB1FF6B33" />
    <meta name="alexaVerifyID" content="j-Es9N9SD7ckfA2EokOz9SZzhok" />
    <meta name='yandex-verification' content='4561963cf1d18fe3' />

    <link rel="canonical" href="http://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy/"/>
    <link rel="alternate" type="application/rss+xml" title="DEVCORE 戴夫寇爾" href="http://devco.re/rss">
    <link rel="publisher" href="https://plus.google.com/118439315679478709768/" />

    <link href="/assets/themes/devcore/images/favicon.png" rel="icon" size="32x32">
    <link href="/assets/themes/devcore/stylesheets/all.min.css" media="screen" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]><link href="/stylesheets/ie8.css" media="screen" rel="stylesheet" type="text/css" /><![endif]--><!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script><![endif]-->
  </head>
  <body class="off-canvas" data-offset="48" data-spy="scroll" data-target=".quick-nav">
    <div class="wrapper">
      <div class="outside">
        <div class="page-width">
          <div class="close-menu-btn-wrapper">
            <div class="close-menu-btn-wrapper-inner">
              <a class="close-menu-btn" href="#close-menu">×</a>
            </div>
          </div>
        </div>
        <div class="outside-inner">
          <div class="main-nav" data-set="main-nav">
            <ul>
              <li>
                <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="zh">
                    服務
                  </div>
                  <div class="en">
                    Services
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                      <div class="zh">
                        滲透測試服務
                      </div>
                      <div class="en">
                        Penetration Test
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-training" title="資安教育訓練 Security Training">
                      <div class="zh">
                        資安教育訓練
                      </div>
                      <div class="en">
                        Security Training
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/incident-response" title="資安事件處理 Incident Response">
                      <div class="zh">
                        資安事件處理
                      </div>
                      <div class="en">
                        Incident Response
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                      <div class="zh">
                        資安顧問服務
                      </div>
                      <div class="en">
                        Security Consulting
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">
                      <div class="zh">
                        網站安全標章
                      </div>
                      <div class="en">
                        Security Seal
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/blog/" title="部落格 Blog">
                  <div class="zh">
                    部落格
                  </div>
                  <div class="en">
                    Blog
                  </div>
                </a>
                <ul>
                  <li>
                    <a href="/blog/category/%E6%9C%80%E6%96%B0%E6%B6%88%E6%81%AF/" title="最新消息 News">
                      <div class="zh">
                        最新消息
                      </div>
                      <div class="en">
                        News
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%A1%88%E4%BE%8B%E5%89%96%E6%9E%90/" title="案例剖析 Case Study">
                      <div class="zh">
                        案例剖析
                      </div>
                      <div class="en">
                        Case Study
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E6%8A%80%E8%A1%93%E5%B0%88%E6%AC%84/" title="技術專欄 Technical">
                      <div class="zh">
                        技術專欄
                      </div>
                      <div class="en">
                        Technical
                      </div>
                    </a>
                  </li>
                  <li>
                    <a href="/blog/category/%E7%A7%91%E6%99%AE%E6%96%87%E7%AB%A0/" title="科普文章 For Muggle">
                      <div class="zh">
                        科普文章
                      </div>
                      <div class="en">
                        For Muggle
                      </div>
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/about/" title="關於 About">
                  <div class="zh">
                    關於
                  </div>
                  <div class="en">
                    About
                  </div>
                </a>
              </li>
              <li>
                <a href="/contact/" title="聯絡 Contact">
                  <div class="zh">
                    聯絡
                  </div>
                  <div class="en">
                    Contact
                  </div>
                </a>
              </li>
              <li>
                <a href="/partners/" title="合作夥伴 Partners">
                  <div class="zh">
                    合作夥伴
                  </div>
                  <div class="en">
                    Partners
                  </div>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="page">
        <div class="header">
          <div class="header-inner">
            <div class="main-nav" data-set="main-nav">
              <ul>
                <li>
                  <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                </li>
                <li>
                  <a href="/blog/" title="部落格 Blog">Blog</a>
                </li>
                <li>
                  <a href="/about/" title="關於 About">About</a>
                </li>
                <li>
                  <a href="/contact/" title="聯絡 Contact">Contact</a>
                </li>
                <li>
                  <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                </li>
                <li class="menu-button">
                  <a class="open-menu-btn" href="#open-menu">・・・</a>
                </li>
              </ul>
            </div>
            <h1 class="logo">
              <a href="/" title="DEVCORE 戴夫寇爾">Content-Security-Policy - HTTP Headers 的資安議題 (2)</a>
            </h1>
          </div>
        </div>
        <div class="main">
          

          <div class="page-header">
            <div class="container">
              <h2 class="page-header-title">
                部落格 <small> Blog </small>
              </h2>
            </div>
          </div>
          <div class="page-content">
            <div class="container">
              <div class="post">
                <div class="post-main">
                  <div class="post-switch">
                    <a class="prev" href="/blog/2014/03/31/Google-Account-Phishing-Scam/" title="Google 帳號釣魚案例">上一篇文章</a>
                    <a class="next" href="/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/" title="OpenSSL CVE-2014-0160 Heartbleed 嚴重漏洞 ">下一篇文章</a>
                  </div>
                  <div itemscope itemtype="http://schema.org/Article" class="post-content">
                    <h2 itemprop="name" class="post-title">
                      Content-Security-Policy - HTTP Headers 的資安議題 (2)
                    </h2>
                    <div class="post-info">
                      
                      
                      
<span class="post-category"><a href="/blog/category/技術專欄/" title="技術專欄">技術專欄</a></span><span class="posted">Posted </span>by <a class="poster" href="/blog/author/bowenhsu"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Bowen Hsu</span></span></a>on <span class="post-time" itemprop="datePublished" content="2014-04-08">2014-04-08</span>


                    </div>
                    <div class="post-tag">
                      
                      Tags: <a href="/blog/tag/HTTP header/">HTTP header</a>, <a href="/blog/tag/Defense/">Defense</a>, <a href="/blog/tag/JavaScript/">JavaScript</a>, <a href="/blog/tag/XSS/">XSS</a>
                    </div>
                    <span itemprop="articleBody">
                      
<h3 id="content-security-policy">Content-Security-Policy</h3>

<p>還記得在上一篇 <a href="http://devco.re/blog/2014/03/10/security-issues-of-http-headers-1/">HTTP headers 的資安議題 (1)</a> 文章中，我們提到了多種資安相關的 HTTP headers 嗎？接下來的幾篇文章我們會介紹幾個專門對付 XSS 的 HTTP headers，首先就由 Content-Security-Policy 打頭陣。</p>

<p><a href="https://www.owasp.org/index.php/Content_Security_Policy">Content-Security-Policy</a>（以下簡稱 CSP）是從 2010 年被提出來的一項 Web 規格，主要目的是用來防止 Cross-Site Scripting（以下簡稱 XSS）跟網頁樣式置換（例如<a href="http://udn.com/NEWS/NATIONAL/NAT5/8554327.shtml">科技部被惡搞</a>就是一個最好的例子）。經過五年發展，CSP 1.0 已從 W3C 的 TR (Technical Report) 變成 <a href="http://www.w3.org/TR/CSP/">Candidate Recommendation</a>，應該不久就會將成為 W3C 推薦標準。新的 <a href="http://w3c.github.io/webappsec/specs/content-security-policy/csp-specification.dev.html">CSP 1.1</a> 則仍在草案階段。</p>

<p>CSP 家族龐大，總共有三個類別，六個項目：</p>

<ul>
  <li>Content-Security-Policy</li>
  <li>Content-Security-Policy-Report-Only</li>
  <li>X-Content-Security-Policy</li>
  <li>X-Content-Security-Policy-Report-Only</li>
  <li>X-WebKit-CSP</li>
  <li>X-WebKit-CSP-Report-Only</li>
</ul>

<p>在 CSP 發展初期，主流瀏覽器並未全部依照同一標準來開發，因此發展成這三種類別。目前由於 CSP 1.0 即將成為標準，大多數瀏覽器已支援 Content-Security-Policy 這個類別，因此狀況已逐漸收斂。主流瀏覽器的支援列表如下圖：</p>

<p><a href="https://lh3.googleusercontent.com/-qJvtcG9lvq8/Ux6DrOeqNhI/AAAAAAAAALQ/gzQ2EbNrOHA/w531-h105-no/csp-browser-support-list.png" title="Content-Security-Policy 瀏覽器支援列表"><img src="https://lh3.googleusercontent.com/-qJvtcG9lvq8/Ux6DrOeqNhI/AAAAAAAAALQ/gzQ2EbNrOHA/w531-h105-no/csp-browser-support-list.png" alt="Content-Security-Policy 瀏覽器支援列表" title="Content-Security-Policy 瀏覽器支援列表" /></a></p>

<p>從列表中可看到，只要使用 Content-Security-Policy 與 X-Content-Security-Policy 就已有很高的覆蓋率，除非要支援 Safari 6，否則不用特意使用 X-WebKit-CSP。更詳細的瀏覽器支援列表可參考 <a href="http://caniuse.com/contentsecuritypolicy">Can I use</a>。</p>

<!-- more -->

<h3 id="csp-10-">CSP 1.0 主要作用</h3>

<ul>
  <li>
    <p>載入來源白名單</p>

    <p>宣告一組受信任的白名單與資源種類（如 JavaScript, CSS, image 等等），使瀏覽器只能從此白名單中載入資源，藉此防止攻擊者從外部引入含有惡意程式碼的資源。</p>

    <p>例：Content-Security-Policy: default-src ‘self’; script-src ‘self’ http://js.devco.re; style-src ‘self’ http://css.devco.re; img-src ‘self’ data:; frame-src ‘none’</p>

    <p>效果：限定 script 資源只能從 http://js.devco.re 載入；限定 style 資源只能從 http://css.devco.re 載入；限定 img 只能從相同 domain 載入，並且支援 data scheme；限定 frame 不能從任何來源載入；除了 script、style、img、frame 之外的資源，則只能從同樣 domain 以及同樣協定的來源載入。</p>
  </li>
  <li>
    <p>禁止 inline 程式碼</p>

    <p>一般人開發網站時為求便利，經常會在 HTML 中寫入一些 inline 程式碼，但攻擊者意圖入侵網站時也常用此手法。然而瀏覽器其實無法分辨這些 inline 程式碼究竟是開發人員寫的，還是攻擊者植入的。因此 CSP 乾脆強迫開發者必須把所有 inline 程式碼移到外部檔案，完全杜絕在 HTML 中出現 inline 程式碼的狀況。因此除非你在 CSP 宣告時有註明 ‘unsafe-inline’，否則 CSP 預設禁止使用 inline script 或 inline CSS。</p>

    <p>例：Content-Security-Policy: default-src ‘self’; script-src ‘unsafe-inline’</p>
  </li>
  <li>
    <p>禁止 eval 函式</p>

    <p>eval() 對許多開發者來說一直是個非常方便的函式，然而若缺乏資安觀念，使用此函式時很可能會導致潛在的 XSS 風險。因此除非你在 CSP 宣告時有註明 ‘unsafe-eval’，否則 CSP 預設禁止使用 eval() 函式。</p>

    <p>例：Content-Security-Policy: default-src ‘self’; script-src ‘unsafe-eval’</p>
  </li>
  <li>
    <p>防止 sniffer</p>

    <p>由於 CSP 可指定載入資源時強制使用 https 協定，因此可降低被 sniffing 的機率。</p>

    <p>例：Content-Security-Policy: default-src http://devco.re; img-src https:</p>

    <p>效果：限定圖片只能從 https 協定載入，不限定 domain。而除了圖片之外的資源則可從任意來源載入。</p>
  </li>
</ul>

<h3 id="csp-demo">CSP Demo</h3>

<p>下面這一段程式碼，使用 default-src * 讓相關資源可正常顯示：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Security-Policy: default-src *&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;html&gt;</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">        &lt;title&gt;CSP Demo Site&lt;/title&gt;</span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;h3&gt;Content Security Policy Demo Site&lt;/h3&gt;</span>
<span class="x">        &lt;img width=&quot;200&quot; height=&quot;200&quot; src=&quot;http://devco.re/assets/themes/devcore/images/double-sticker.png&quot;&gt;&lt;/img&gt;</span>
<span class="x">        &lt;iframe frameborder=&#39;0&#39; width=&#39;300&#39; height=&#39;200&#39; src=&#39;http://www.youtube.com/embed/E-BGf1MwecU&#39;&gt;&lt;/iframe&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span></code></pre></div>

<p><a href="https://lh3.googleusercontent.com/-DVXEu8Xe4GQ/Ux6DqiVHyBI/AAAAAAAAALU/88qSfa5aJkY/w754-h633-no/csp-demo-1.png" title="使用最寬鬆的 Content-Security-Policy 規則"><img src="https://lh3.googleusercontent.com/-DVXEu8Xe4GQ/Ux6DqiVHyBI/AAAAAAAAALU/88qSfa5aJkY/w754-h633-no/csp-demo-1.png" alt="使用最寬鬆的 Content-Security-Policy 規則" title="使用最寬鬆的 Content-Security-Policy 規則" /></a></p>

<p>接下來我們將 php header 的那一行程式碼修改如下並且 reload 瀏覽器頁面：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Security-Policy: default-src *; img-src https:; frame-src &#39;none&#39;&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p><a href="https://lh5.googleusercontent.com/-iisyWwpo5IY/Ux6Dqn3FBgI/AAAAAAAAALM/MahpofJ2sK0/w754-h633-no/csp-demo-2.png" title="使用 Content-Security-Policy 限制 img 與 frame 的來源"><img src="https://lh5.googleusercontent.com/-iisyWwpo5IY/Ux6Dqn3FBgI/AAAAAAAAALM/MahpofJ2sK0/w754-h633-no/csp-demo-2.png" alt="使用 Content-Security-Policy 限制 img 與 frame 的來源" title="使用 Content-Security-Policy 限制 img 與 frame 的來源" /></a></p>

<p>使用 CSP 限制 img 與 frame 的來源種類後，我們可以從上圖 Chrome Inspector 的紅字觀察到，網站的圖片與 iframe 影片已被瀏覽器擋掉，無法載入。</p>

<p>如果擔心直接使用 CSP 會影響網站營運，但又想嘗試 CSP，可以先使用 Content-Security-Policy-Report-Only，示範如下：</p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Security-Policy-Report-Only: default-src *; img-src https:; frame-src &#39;none&#39;; report-uri http://devco.re/demo&quot;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span></code></pre></div>

<p><a href="https://lh5.googleusercontent.com/-zLXj9r2aIxc/UyGO-Bzi_5I/AAAAAAAAANU/nbwz6lAfTLc/w754-h594-no/csp-demo-report-only.png" title="Content-Security-Policy-Report-Only"><img src="https://lh5.googleusercontent.com/-zLXj9r2aIxc/UyGO-Bzi_5I/AAAAAAAAANU/nbwz6lAfTLc/w754-h594-no/csp-demo-report-only.png" alt="Content-Security-Policy-Report-Only" title="Content-Security-Policy-Report-Only" /></a></p>

<p>由上圖可以看到，此 header 不會直接阻擋不符合 CSP 規範的資源，但是會根據使用者所違反的規則發送相對應的 POST request 至指定的 URI，發送內容如下：</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;csp-report&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;blocked-uri&quot;</span><span class="p">:</span><span class="s2">&quot;http://devco.re/&quot;</span><span class="p">,</span>
    <span class="nt">&quot;document-uri&quot;</span><span class="p">:</span><span class="s2">&quot;http://yoursite.com/csp.php&quot;</span><span class="p">,</span>
    <span class="nt">&quot;original-policy&quot;</span><span class="p">:</span><span class="s2">&quot;default-src *; img-src https:; frame-src &#39;none&#39;; report-uri http://devco.re/demo&quot;</span><span class="p">,</span>
    <span class="nt">&quot;referrer&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;status-code&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
    <span class="nt">&quot;violated-directive&quot;</span><span class="p">:</span><span class="s2">&quot;img-src https:&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>由發送內容可看出這個 request 因為違反了「img-src https:」規則而將「http://devco.re/」這個來源擋掉。經由此方式，可一邊修改網站一邊觀察是否仍有不符合 CSP 規範之處，等到所有違規的內容都修正完畢後，再將 CSP 套用到正式上線環境。</p>

<table>
  <tbody>
    <tr>
      <td>由於宣告方式非常多種，在這邊就不一一條列，若有興趣可前往 <a href="http://content-security-policy.com/">Content Security Policy Reference &amp; Examples</a>、[Using Content Security Policy - Security</td>
      <td>MDN](https://developer.mozilla.org/en-US/docs/Security/CSP/Using_Content_Security_Policy) 等網頁，有更完整的使用情境與範例可供參考。另外也有 <a href="http://benvinegar.github.io/csp-talk-2013/">Slide</a> (by Ben Vinegar) 跟 <a href="https://www.youtube.com/watch?v=pocsv39pNXA">YouTube 影片</a> (by Adam Barth) 可參考。</td>
    </tr>
  </tbody>
</table>

<p>若欲使用 CSP 卻一直未能成功時，可到 <a href="http://www.cspplayground.com/csp_validator">Content Security Policy Playground</a> 驗證您所寫的設定是否正確。</p>

<h3 id="csp-">CSP 實際使用案例</h3>

<p>目前採用 CSP 的案例較少，比較知名的使用案例是 <a href="https://github.com/">GitHub</a>，在 2013 年 4 月 <a href="https://github.com/blog/1477-content-security-policy">GitHub 還寫了一篇專文</a>公告表示他們已開始採用 CSP。另外一個案例廠商可能較廣為人知，是在 2013 年當紅的免費儲存空間 <a href="https://mega.co.nz/">MEGA</a>。兩個案例的實際內容可見於下圖：</p>

<p><a href="https://lh4.googleusercontent.com/-WPU1UT9T6WA/Ux6DrfiQ_EI/AAAAAAAAALc/s0XmlPFKmoc/w1169-h758-no/http-headers-github-and-mega.jpg" title="GitHub 與 MEGA 使用 CSP 後的 HTTP response"><img src="https://lh4.googleusercontent.com/-WPU1UT9T6WA/Ux6DrfiQ_EI/AAAAAAAAALc/s0XmlPFKmoc/w1169-h758-no/http-headers-github-and-mega.jpg" alt="GitHub 與 MEGA 使用 CSP 後的 HTTP response" title="GitHub 與 MEGA 使用 CSP 後的 HTTP response" /></a></p>

<p>另一項知名使用案例是 Google 明定<a href="http://developer.chrome.com/extensions/contentSecurityPolicy">開發 Chrome Extension 時必須使用 CSP</a>，以追求更高的安全性。Mozilla 也在 <a href="https://wiki.mozilla.org/Security/CSP/Specification">MozillaWiki 開了一頁</a>存放相關技術細節。若您想觀察其他使用案例，可使用 Chrome Inspector 或 curl 觀察以下幾個網站：<a href="https://lastpass.com/">LastPass</a>，<a href="https://support.twitter.com/">Twitter Help Center</a>，<a href="https://adblockplus.org/en/chrome">Adblock Plus</a>，<a href="https://www.sendsafely.com/">Sendsafely</a>，<a href="http://likealyzer.com/">LikeAlyzer</a>。</p>

<h3 id="csp--1">CSP 常見誤用案例</h3>

<ul>
  <li>
    <p>directives 後面不需加冒號</p>

    <p>錯誤：default-src: ‘self’</p>

    <p>正確：<strong>default-src ‘self’</strong></p>
  </li>
  <li>
    <p>directives 之間以分號區隔</p>

    <p>錯誤：default-src ‘self’, script-src ‘self’</p>

    <p>正確：<strong>default-src ‘self’; script-src ‘self’</strong></p>
  </li>
  <li>
    <p>多個 source 之間僅以空白區隔</p>

    <p>錯誤：default-src ‘self’; img-src ‘self’, img1.devco.re, img2.devco.re</p>

    <p>正確：<strong>default-src ‘self’; img-src ‘self’ img1.devco.re img2.devco.re</strong></p>
  </li>
  <li>
    <p>某些 source 必須加冒號（https:、data:）</p>

    <p>錯誤：default-src ‘self’; img-src ‘self’ https data</p>

    <p>正確：<strong>default-src ‘self’; img-src ‘self’ https: data:</strong></p>
  </li>
  <li>
    <p>某些 source 必須用單引號括起來（’none’、’self’、’unsafe-inline’、’unsafe-eval’）</p>

    <p>錯誤：script-src self unsafe-inline unsafe-eval</p>

    <p>正確：<strong>script-src ‘self’ ‘unsafe-inline’ ‘unsafe-eval’</strong></p>
  </li>
</ul>

<h3 id="section">結論</h3>

<p>使用 CSP 可以有效提升攻擊難度，讓許多常見的 XSS 攻擊失效，是一個非常推薦開發者使用的 HTTP header。但由於目前的開發者在 HTML 裡面寫 inline script 及 inline CSS 的比例非常高，同時也有一些網路服務預設都需要使用 inline script（例如 Google Analytics，相關解法可參考<a href="http://stackoverflow.com/questions/3870345/new-google-analytics-code-into-external-file">這裡</a>），因此要享受這樣的安全之前，可能需要先付出許多時間與心力將網站大幅整理，套用 CSP 規範後網頁才能正常運作。</p>

                    </span>
                    
                    <div class="author-area">
                      <h4 class="page-content-title page-content-title-with-line">
                        <span>作者資訊</span>
                      </h4>

                      <div class="author" style="overflow: hidden; margin-bottom: 30px;">
                        <div class="authoe-avatar" style="float: left; width: 160px;">
                          <img src="/assets/themes/devcore/images/avatar/bowenhsu.jpg" style="margin: 0px auto; " alt="Bowen Hsu" title="Bowen Hsu" />
                        </div>
                        <div class="authoe-desc" style="margin-left: 200px;">
                          <h4 class="author-name">
                            <a href="/blog/author/bowenhsu">Bowen Hsu</a>
                          </h4>
                          <div class="author-role">
                            Security Reseacher
                          </div>
                          <div class="author-intro">
                            「如果你不想讓別人進來一探究竟，你有責任將它打造得更好。」正是這種熱血的使命讓我一腳踏入資訊安全。專長於滲透測試，喜歡用 Python 寫各種資安工具！
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="post-switch">
                      <a class="prev" href="/blog/2014/03/31/Google-Account-Phishing-Scam/" title="Google 帳號釣魚案例">上一篇文章</a>
                      <a class="next" href="/blog/2014/04/09/openssl-heartbleed-CVE-2014-0160/" title="OpenSSL CVE-2014-0160 Heartbleed 嚴重漏洞 ">下一篇文章</a>
                    </div>
                    <div class="social-share" style="line-height: 10px; margin: 20px 0;">
                      <div style="float: right;">
                        <div class="fb-like" data-href="http://devco.re/blog/2014/04/08/security-issues-of-http-headers-2-content-security-policy/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
                      </div>
                      <a href="#" style="dispaly:none; border-bottom:none;"> </a>
                      <a href="https://twitter.com/share?" class="twitter-share-button">Tweet</a>
                      <div class="g-plusone" data-size="medium"></div>
                      <script type="text/javascript">
                        (function() {
                          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                          po.src = 'https://apis.google.com/js/platform.js';
                          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                        })();
                      </script>
                      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                    </div>
                  </div>
                  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'd3vc0r3'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




                </div>
                <div class="post-sidebar">
                  <!--文章分類-->
                  <div class="widget">
                    <div class="widget-title">
                      文章分類
                    </div>
                    <ul class="widget-list">
                      
                                        
                    
                      <li>
                        <a href="/blog/category/最新消息/">最新消息 <span class="count">(1)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/案例剖析/">案例剖析 <span class="count">(6)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/技術專欄/">技術專欄 <span class="count">(15)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/科普文章/">科普文章 <span class="count">(2)</span></a>
                      </li>
                    
                      <li>
                        <a href="/blog/category/資安新聞/">資安新聞 <span class="count">(1)</span></a>
                      </li>
                    
                  
                      <li>
                        <a href="/blog/archive"><div class="widget-list-title">所有文章列表 »</div></a>
                      </li>
                      <li>
                        <gcse:search></gcse:search>
                      </li>

                    </ul>
                  </div>
                  <!--文章分類 end--><!--最新文章-->
                  <div class="widget">
                    <div class="widget-title">
                      最新文章
                    </div>
                    <ul class="widget-list">
                        
                      <li>
                        <a href="/blog/2014/10/13/android-webview-left-shortcuts-for-hacker/">
                          <div class="widget-list-title">
                            Android WebView 為你的使用者打開了漏洞之門你知道嗎？
                          </div>
                          <div class="widget-list-date">
                            2014-10-13
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/09/30/shellshock-CVE-2014-6271/">
                          <div class="widget-list-title">
                            Shellshock (Bash CVE-2014-6271) 威脅仍在擴大中，但無需過度恐慌
                          </div>
                          <div class="widget-list-date">
                            2014-09-30
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/09/24/security-of-ip-camera-and-nvr/">
                          <div class="widget-list-title">
                            網路攝影機、DVR、NVR 的資安議題 - 你知道我在看你嗎？
                          </div>
                          <div class="widget-list-date">
                            2014-09-24
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/08/26/information-leakage-in-taiwan-HITCON2014/">
                          <div class="widget-list-title">
                            被遺忘的資訊洩漏－重點回顧
                          </div>
                          <div class="widget-list-date">
                            2014-08-26
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/08/15/ssl-mishandling-on-mobile-app-development/">
                          <div class="widget-list-title">
                            手機應用程式開發上被忽略的 SSL 處理
                          </div>
                          <div class="widget-list-date">
                            2014-08-15
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/07/18/waf-configuration-security-issue/">
                          <div class="widget-list-title">
                            設備不良設定帶來的安全風險：以 WAF 為例
                          </div>
                          <div class="widget-list-date">
                            2014-07-18
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/07/03/apple-id-phishing-scam/">
                          <div class="widget-list-title">
                            Apple ID 釣魚郵件案例
                          </div>
                          <div class="widget-list-date">
                            2014-07-03
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/06/19/client-ip-detection/">
                          <div class="widget-list-title">
                            如何正確的取得使用者 IP？
                          </div>
                          <div class="widget-list-date">
                            2014-06-19
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/06/13/zone-transfer-statistics-of-alexa-top-1m/">
                          <div class="widget-list-title">
                            Zone Transfer Statistics of Alexa Top 1 Million
                          </div>
                          <div class="widget-list-date">
                            2014-06-13
                          </div>
                        </a>
                      </li>
  
                      <li>
                        <a href="/blog/2014/06/11/setcookie-httponly-security-issues-of-http-headers-3/">
                          <div class="widget-list-title">
                            HttpOnly - HTTP Headers 的資安議題 (3)
                          </div>
                          <div class="widget-list-date">
                            2014-06-11
                          </div>
                        </a>
                      </li>
  

                    </ul>
                  </div>
                  <!--最新文章 end--><!--文章標籤-->
                  <div class="widget">
                    <div class="widget-title">
                      文章標籤
                    </div>
                    <ul class="widget-tags">
                      
                                        
                    
                      <li><a href="/blog/tag/公告/">公告 <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/JavaScript/">JavaScript <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/Hijack/">Hijack <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/HTTP header/">HTTP header <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/Defense/">Defense <span class="count">(7)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSource/">OpenSource <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Vulnerability/">Vulnerability <span class="count">(7)</span></a></li>
                    
                      <li><a href="/blog/tag/Mail/">Mail <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Phishing/">Phishing <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/XSS/">XSS <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/OpenSSL/">OpenSSL <span class="count">(4)</span></a></li>
                    
                      <li><a href="/blog/tag/CVE/">CVE <span class="count">(8)</span></a></li>
                    
                      <li><a href="/blog/tag/WordPress/">WordPress <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Brute-force/">Brute-force <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/PHP/">PHP <span class="count">(3)</span></a></li>
                    
                      <li><a href="/blog/tag/LFI/">LFI <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/DNS/">DNS <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Reconnaissance/">Reconnaissance <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/SVN/">SVN <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IM/">IM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Facebook/">Facebook <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Session/">Session <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Cookie/">Cookie <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Statistics/">Statistics <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/HTTP Header/">HTTP Header <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/WAF/">WAF <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Proxy/">Proxy <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Mobile/">Mobile <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/Android/">Android <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/iOS/">iOS <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/SSL/">SSL <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/MITM/">MITM <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/infoleak/">infoleak <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/IoT/">IoT <span class="count">(2)</span></a></li>
                    
                      <li><a href="/blog/tag/IP Camera/">IP Camera <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/Shell/">Shell <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/WebView/">WebView <span class="count">(1)</span></a></li>
                    
                      <li><a href="/blog/tag/UXSS/">UXSS <span class="count">(1)</span></a></li>
                    
                  
                

                    </ul>
                  </div>
                  <!--文章標籤 end-->
                </div>
              </div>
              <div id="fb-root"></div>
              <script>(function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                fjs.parentNode.insertBefore(js, fjs);
              }(document, 'script', 'facebook-jssdk'));</script>
            </div>
          </div>


        </div>
        <div class="footer">
          <div class="footer-inner">
            <div class="footer-top">
              <div class="footer-services">
                <a class="footer-service col" href="/services/penetration-test" title="滲透測試服務 Penetration Test">
                  <div class="footer-service-icon service-icon service-icon-penetration-test"></div>
                  <div class="footer-service-title">
                    滲透測試服務
                  </div>
                </a><a class="footer-service col" href="/services/security-training" title="資安教育訓練 Security Training">
                  <div class="footer-service-icon service-icon service-icon-security-training"></div>
                  <div class="footer-service-title">
                    資安教育訓練
                  </div>
                </a><a class="footer-service col" href="/services/incident-response" title="資安事件處理 Incident Response">
                  <div class="footer-service-icon service-icon service-icon-incident-response"></div>
                  <div class="footer-service-title">
                    資安事件處理
                  </div>
                </a><a class="footer-service col" href="/services/security-consulting" title="資安顧問服務 Security Consulting">
                  <div class="footer-service-icon service-icon service-icon-security-consulting"></div>
                  <div class="footer-service-title">
                    資安顧問服務
                  </div>
                </a>
              </div>
            </div>
            <div class="footer-bottom">
              <div class="footer-links-group">
                <ul class="footer-links">
                  <li>
                    <a href="/services/penetration-test" title="滲透測試服務 Penetration Test">Services</a>
                  </li>
                  <li>
                    <a href="/blog/" title="部落格 Blog">Blog</a>
                  </li>
                  <li>
                    <a href="/about/" title="關於 About">About</a>
                  </li>
                  <li>
                    <a href="/contact/" title="聯絡 Contact">Contact</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="/services/security-seal" title="網站安全標章 Security Seal">Security Seal</a>
                  </li>
                  <li>
                    <a href="/partners/" title="合作夥伴 Partners">Partners</a>
                  </li>
                </ul>
                <ul class="footer-links">
                  <li>
                    <a href="https://www.facebook.com/D3VC0RE" title="DEVCORE Facebook 粉絲團" target="_blank">Facebook</a>
                  </li>
                  <li>
                    <a href="https://plus.google.com/118439315679478709768/posts" title="DEVCORE Google+ 專頁" target="_blank">Google+</a>
                  </li>
                  <li>
                    <a href="https://twitter.com/d3vc0r3" title="DEVCORE Twitter" target="_blank">Twitter</a>
                  </li>
                </ul>
              </div>
              <ul class="footer-info">
                <li>
                  電話：02-2314-7696
                </li>
                <li>
                  Email：contact [at] devco.re
                </li>
                <li>
                  統編：53955237
                </li>
              </ul>
              <ul class="footer-info">
                <li>
                  地址：台北市萬華區長沙街二段 91 號 3 樓之 15
                </li>
                <li>
                  ©2014 DEVCORE 戴夫寇爾
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="off-canvas-mask"></div>
      </div>
    </div>
    <script src="/assets/themes/devcore/javascripts/vender/modernizr.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/off-canvas.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/all.min.js" type="text/javascript"></script>
    <script src="/assets/themes/devcore/javascripts/gcse.js" type="text/javascript"></script>
    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30830800-1']);
  _gaq.push(['_trackPageview', location.pathname + location.search + location.hash]);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




    <!-- Google Tag Manager -->
    <noscript>
      <iframe src="//www.googletagmanager.com/ns.html?id=GTM-K5B8NW" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-K5B8NW');
    </script>
    <!-- End Google Tag Manager -->
  </body>
</html>

